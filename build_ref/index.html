

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Generic TriBITS Project, Build, Test, and Install Reference Guide</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >
          

          
            <a href="../index.html" class="icon icon-home"> TriBITS
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#"><span class="sectnum">1</span> Introduction</a></li>
<li><a class="reference internal" href="#getting-set-up-to-use-cmake"><span class="sectnum">2</span> Getting set up to use CMake</a><ul>
<li><a class="reference internal" href="#installing-a-binary-release-of-cmake-casual-users"><span class="sectnum">2.1</span> Installing a binary release of CMake [casual users]</a></li>
<li><a class="reference internal" href="#installing-cmake-from-source-developers-and-experienced-users"><span class="sectnum">2.2</span> Installing CMake from source [developers and experienced users]</a></li>
<li><a class="reference internal" href="#installing-ninja-from-source"><span class="sectnum">2.3</span> Installing Ninja from Source</a></li>
</ul>
</li>
<li><a class="reference internal" href="#getting-cmake-help"><span class="sectnum">3</span> Getting CMake Help</a><ul>
<li><a class="reference internal" href="#finding-cmake-help-at-the-website"><span class="sectnum">3.1</span> Finding CMake help at the website</a></li>
<li><a class="reference internal" href="#building-cmake-help-locally"><span class="sectnum">3.2</span> Building CMake help locally</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-makefile-ninja-and-other-generators"><span class="sectnum">4</span> Configuring (Makefile, Ninja and other Generators)</a><ul>
<li><a class="reference internal" href="#setting-up-a-build-directory"><span class="sectnum">4.1</span> Setting up a build directory</a></li>
<li><a class="reference internal" href="#basic-configuration"><span class="sectnum">4.2</span> Basic configuration</a></li>
<li><a class="reference internal" href="#selecting-the-list-of-packages-to-enable"><span class="sectnum">4.3</span> Selecting the list of packages to enable</a><ul>
<li><a class="reference internal" href="#determine-the-list-of-packages-that-can-be-enabled"><span class="sectnum">4.3.1</span> Determine the list of packages that can be enabled</a></li>
<li><a class="reference internal" href="#print-package-dependencies"><span class="sectnum">4.3.2</span> Print package dependencies</a></li>
<li><a class="reference internal" href="#enable-a-set-of-packages"><span class="sectnum">4.3.3</span> Enable a set of packages</a></li>
<li><a class="reference internal" href="#enable-or-disable-tests-for-specific-packages"><span class="sectnum">4.3.4</span> Enable or disable tests for specific packages</a></li>
<li><a class="reference internal" href="#enable-to-test-all-effects-of-changing-a-given-package-s"><span class="sectnum">4.3.5</span> Enable to test all effects of changing a given package(s)</a></li>
<li><a class="reference internal" href="#enable-all-packages-and-optionally-all-tests"><span class="sectnum">4.3.6</span> Enable all packages (and optionally all tests)</a></li>
<li><a class="reference internal" href="#disable-a-package-and-all-its-dependencies"><span class="sectnum">4.3.7</span> Disable a package and all its dependencies</a></li>
<li><a class="reference internal" href="#remove-all-package-enables-in-the-cache"><span class="sectnum">4.3.8</span> Remove all package enables in the cache</a></li>
</ul>
</li>
<li><a class="reference internal" href="#selecting-compiler-and-linker-options"><span class="sectnum">4.4</span> Selecting compiler and linker options</a><ul>
<li><a class="reference internal" href="#configuring-to-build-with-default-debug-or-release-compiler-flags"><span class="sectnum">4.4.1</span> Configuring to build with default debug or release compiler flags</a></li>
<li><a class="reference internal" href="#adding-arbitrary-compiler-flags-but-keeping-default-build-type-flags"><span class="sectnum">4.4.2</span> Adding arbitrary compiler flags but keeping default build-type flags</a></li>
<li><a class="reference internal" href="#overriding-cmake-build-type-debug-release-compiler-options"><span class="sectnum">4.4.3</span> Overriding CMAKE_BUILD_TYPE debug/release compiler options</a></li>
<li><a class="reference internal" href="#appending-arbitrary-libraries-and-link-flags-every-executable"><span class="sectnum">4.4.4</span> Appending arbitrary libraries and link flags every executable</a></li>
<li><a class="reference internal" href="#turning-off-strong-warnings-for-individual-packages"><span class="sectnum">4.4.5</span> Turning off strong warnings for individual packages</a></li>
<li><a class="reference internal" href="#overriding-all-strong-warnings-and-debug-release-compiler-options"><span class="sectnum">4.4.6</span> Overriding all (strong warnings and debug/release) compiler options</a></li>
<li><a class="reference internal" href="#enable-and-disable-shadowing-warnings-for-all-project-packages"><span class="sectnum">4.4.7</span> Enable and disable shadowing warnings for all &lt;Project&gt; packages</a></li>
<li><a class="reference internal" href="#removing-warnings-as-errors-for-cleaned-packages"><span class="sectnum">4.4.8</span> Removing warnings as errors for CLEANED packages</a></li>
<li><a class="reference internal" href="#adding-debug-symbols-to-the-build"><span class="sectnum">4.4.9</span> Adding debug symbols to the build</a></li>
</ul>
</li>
<li><a class="reference internal" href="#enabling-support-for-ninja"><span class="sectnum">4.5</span> Enabling support for Ninja</a></li>
<li><a class="reference internal" href="#limiting-parallel-compile-and-link-jobs-for-ninja-builds"><span class="sectnum">4.6</span> Limiting parallel compile and link jobs for Ninja builds</a></li>
<li><a class="reference internal" href="#disabling-explicit-template-instantiation-for-c"><span class="sectnum">4.7</span> Disabling explicit template instantiation for C++</a></li>
<li><a class="reference internal" href="#disabling-the-fortran-compiler-and-all-fortran-code"><span class="sectnum">4.8</span> Disabling the Fortran compiler and all Fortran code</a></li>
<li><a class="reference internal" href="#enabling-runtime-debug-checking"><span class="sectnum">4.9</span> Enabling runtime debug checking</a></li>
<li><a class="reference internal" href="#configuring-with-mpi-support"><span class="sectnum">4.10</span> Configuring with MPI support</a></li>
<li><a class="reference internal" href="#configuring-for-openmp-support"><span class="sectnum">4.11</span> Configuring for OpenMP support</a></li>
<li><a class="reference internal" href="#building-shared-libraries"><span class="sectnum">4.12</span> Building shared libraries</a></li>
<li><a class="reference internal" href="#building-static-libraries-and-executables"><span class="sectnum">4.13</span> Building static libraries and executables</a></li>
<li><a class="reference internal" href="#enabling-the-usage-of-resource-files-to-reduce-length-of-build-lines"><span class="sectnum">4.14</span> Enabling the usage of resource files to reduce length of build lines</a></li>
<li><a class="reference internal" href="#enabling-support-for-an-optional-third-party-library-tpl"><span class="sectnum">4.15</span> Enabling support for an optional Third-Party Library (TPL)</a></li>
<li><a class="reference internal" href="#disabling-support-for-a-third-party-library-tpl"><span class="sectnum">4.16</span> Disabling support for a Third-Party Library (TPL)</a></li>
<li><a class="reference internal" href="#disabling-tentatively-enabled-tpls"><span class="sectnum">4.17</span> Disabling tentatively enabled TPLs</a></li>
<li><a class="reference internal" href="#require-all-tpl-libraries-be-found"><span class="sectnum">4.18</span> Require all TPL libraries be found</a></li>
<li><a class="reference internal" href="#disable-warnings-from-tpl-header-files"><span class="sectnum">4.19</span> Disable warnings from TPL header files</a></li>
<li><a class="reference internal" href="#xsdk-configuration-options"><span class="sectnum">4.20</span> xSDK Configuration Options</a></li>
<li><a class="reference internal" href="#generating-verbose-output"><span class="sectnum">4.21</span> Generating verbose output</a></li>
<li><a class="reference internal" href="#enabling-disabling-deprecated-warnings"><span class="sectnum">4.22</span> Enabling/disabling deprecated warnings</a></li>
<li><a class="reference internal" href="#disabling-deprecated-code"><span class="sectnum">4.23</span> Disabling deprecated code</a></li>
<li><a class="reference internal" href="#outputting-package-dependency-information"><span class="sectnum">4.24</span> Outputting package dependency information</a></li>
<li><a class="reference internal" href="#test-related-configuration-settings"><span class="sectnum">4.25</span> Test-related configuration settings</a><ul>
<li><a class="reference internal" href="#enabling-different-test-categories"><span class="sectnum">4.25.1</span> Enabling different test categories</a></li>
<li><a class="reference internal" href="#disabling-specific-tests"><span class="sectnum">4.25.2</span> Disabling specific tests</a></li>
<li><a class="reference internal" href="#disabling-specific-test-executable-builds"><span class="sectnum">4.25.3</span> Disabling specific test executable builds</a></li>
<li><a class="reference internal" href="#disabling-just-the-ctest-tests-but-not-the-test-executables"><span class="sectnum">4.25.4</span> Disabling just the ctest tests but not the test executables</a></li>
<li><a class="reference internal" href="#set-specific-tests-to-run-in-serial"><span class="sectnum">4.25.5</span> Set specific tests to run in serial</a></li>
<li><a class="reference internal" href="#trace-test-addition-or-exclusion"><span class="sectnum">4.25.6</span> Trace test addition or exclusion</a></li>
<li><a class="reference internal" href="#enable-advanced-test-start-and-end-times-and-timing-blocks"><span class="sectnum">4.25.7</span> Enable advanced test start and end times and timing blocks</a></li>
<li><a class="reference internal" href="#setting-test-timeouts-at-configure-time"><span class="sectnum">4.25.8</span> Setting test timeouts at configure time</a></li>
<li><a class="reference internal" href="#scaling-test-timeouts-at-configure-time"><span class="sectnum">4.25.9</span> Scaling test timeouts at configure time</a></li>
<li><a class="reference internal" href="#spreading-out-and-limiting-tests-running-on-gpus"><span class="sectnum">4.25.10</span> Spreading out and limiting tests running on GPUs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#enabling-support-for-coverage-testing"><span class="sectnum">4.26</span> Enabling support for coverage testing</a></li>
<li><a class="reference internal" href="#viewing-configure-options-and-documentation"><span class="sectnum">4.27</span> Viewing configure options and documentation</a></li>
<li><a class="reference internal" href="#enabling-extra-repositories-with-add-on-packages"><span class="sectnum">4.28</span> Enabling extra repositories with add-on packages:</a></li>
<li><a class="reference internal" href="#enabling-extra-repositories-through-a-file"><span class="sectnum">4.29</span> Enabling extra repositories through a file</a></li>
<li><a class="reference internal" href="#selecting-a-different-source-location-for-a-package"><span class="sectnum">4.30</span> Selecting a different source location for a package</a></li>
<li><a class="reference internal" href="#reconfiguring-completely-from-scratch"><span class="sectnum">4.31</span> Reconfiguring completely from scratch</a></li>
<li><a class="reference internal" href="#viewing-configure-errors"><span class="sectnum">4.32</span> Viewing configure errors</a></li>
<li><a class="reference internal" href="#adding-configure-timers"><span class="sectnum">4.33</span> Adding configure timers</a></li>
<li><a class="reference internal" href="#generating-export-files"><span class="sectnum">4.34</span> Generating export files</a></li>
<li><a class="reference internal" href="#generating-a-project-repo-version-file"><span class="sectnum">4.35</span> Generating a project repo version file</a></li>
<li><a class="reference internal" href="#generating-git-version-date-files"><span class="sectnum">4.36</span> Generating git version date files</a></li>
<li><a class="reference internal" href="#cmake-configure-time-development-mode-and-debug-checking"><span class="sectnum">4.37</span> CMake configure-time development mode and debug checking</a></li>
</ul>
</li>
<li><a class="reference internal" href="#building-makefile-generator"><span class="sectnum">5</span> Building (Makefile generator)</a><ul>
<li><a class="reference internal" href="#building-all-targets"><span class="sectnum">5.1</span> Building all targets</a></li>
<li><a class="reference internal" href="#discovering-what-targets-are-available-to-build"><span class="sectnum">5.2</span> Discovering what targets are available to build</a></li>
<li><a class="reference internal" href="#building-all-of-the-targets-for-a-package"><span class="sectnum">5.3</span> Building all of the targets for a package</a></li>
<li><a class="reference internal" href="#building-all-of-the-libraries-for-a-package"><span class="sectnum">5.4</span> Building all of the libraries for a package</a></li>
<li><a class="reference internal" href="#building-all-of-the-libraries-for-all-enabled-packages"><span class="sectnum">5.5</span> Building all of the libraries for all enabled packages</a></li>
<li><a class="reference internal" href="#building-a-single-object-file"><span class="sectnum">5.6</span> Building a single object file</a></li>
<li><a class="reference internal" href="#building-with-verbose-output-without-reconfiguring"><span class="sectnum">5.7</span> Building with verbose output without reconfiguring</a></li>
<li><a class="reference internal" href="#relink-a-target-without-considering-dependencies"><span class="sectnum">5.8</span> Relink a target without considering dependencies</a></li>
</ul>
</li>
<li><a class="reference internal" href="#building-ninja-generator"><span class="sectnum">6</span> Building (Ninja generator)</a><ul>
<li><a class="reference internal" href="#building-in-parallel-with-ninja"><span class="sectnum">6.1</span> Building in parallel with Ninja</a></li>
<li><a class="reference internal" href="#building-in-a-subdirectory-with-ninja"><span class="sectnum">6.2</span> Building in a subdirectory with Ninja</a></li>
<li><a class="reference internal" href="#building-verbose-without-reconfiguring-with-ninja"><span class="sectnum">6.3</span> Building verbose without reconfiguring with Ninja</a></li>
<li><a class="reference internal" href="#discovering-what-targets-are-available-to-build-with-ninja"><span class="sectnum">6.4</span> Discovering what targets are available to build with Ninja</a></li>
<li><a class="reference internal" href="#building-specific-targets-with-ninja"><span class="sectnum">6.5</span> Building specific targets with Ninja</a></li>
<li><a class="reference internal" href="#building-single-object-files-with-ninja"><span class="sectnum">6.6</span> Building single object files with Ninja</a></li>
<li><a class="reference internal" href="#cleaning-build-targets-with-ninja"><span class="sectnum">6.7</span> Cleaning build targets with Ninja</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing-with-ctest"><span class="sectnum">7</span> Testing with CTest</a><ul>
<li><a class="reference internal" href="#running-all-tests"><span class="sectnum">7.1</span> Running all tests</a></li>
<li><a class="reference internal" href="#only-running-tests-for-a-single-package"><span class="sectnum">7.2</span> Only running tests for a single package</a></li>
<li><a class="reference internal" href="#running-a-single-test-with-full-output-to-the-console"><span class="sectnum">7.3</span> Running a single test with full output to the console</a></li>
<li><a class="reference internal" href="#overriding-test-timeouts"><span class="sectnum">7.4</span> Overriding test timeouts</a></li>
<li><a class="reference internal" href="#running-memory-checking"><span class="sectnum">7.5</span> Running memory checking</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installing"><span class="sectnum">8</span> Installing</a><ul>
<li><a class="reference internal" href="#setting-the-install-prefix"><span class="sectnum">8.1</span> Setting the install prefix</a></li>
<li><a class="reference internal" href="#setting-install-ownership-and-permissions"><span class="sectnum">8.2</span> Setting install ownership and permissions</a></li>
<li><a class="reference internal" href="#setting-install-rpath"><span class="sectnum">8.3</span> Setting install RPATH</a></li>
<li><a class="reference internal" href="#avoiding-installing-libraries-and-headers"><span class="sectnum">8.4</span> Avoiding installing libraries and headers</a></li>
<li><a class="reference internal" href="#installing-the-software"><span class="sectnum">8.5</span> Installing the software</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installation-testing"><span class="sectnum">9</span> Installation Testing</a></li>
<li><a class="reference internal" href="#packaging"><span class="sectnum">10</span> Packaging</a><ul>
<li><a class="reference internal" href="#creating-a-tarball-of-the-source-tree"><span class="sectnum">10.1</span> Creating a tarball of the source tree</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dashboard-submissions"><span class="sectnum">11</span> Dashboard submissions</a><ul>
<li><a class="reference internal" href="#setting-options-to-change-behavior-of-dashboard-target"><span class="sectnum">11.1</span> Setting options to change behavior of ‘dashboard’ target</a></li>
<li><a class="reference internal" href="#common-options-and-use-cases-for-the-dashboard-target"><span class="sectnum">11.2</span> Common options and use cases for the ‘dashboard’ target</a></li>
<li><a class="reference internal" href="#changing-the-cdash-sites-for-the-dashboard-target"><span class="sectnum">11.3</span> Changing the CDash sites for the ‘dashboard’ target</a></li>
<li><a class="reference internal" href="#configuring-from-scratch-needed-if-dashboard-target-aborts-early"><span class="sectnum">11.4</span> Configuring from scratch needed if ‘dashboard’ target aborts early</a></li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">TriBITS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
        
      <li><span class="sectnum">1</span> Introduction</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p class="rubric">Generic TriBITS Project, Build, Test, and Install Reference Guide</p>
<dl class="field-list simple">
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Roscoe A. Bartlett</p>
</dd>
<dt class="field-even">Contact</dt>
<dd class="field-even"><p><a class="reference external" href="mailto:bartlett&#46;roscoe&#37;&#52;&#48;gmail&#46;com">bartlett<span>&#46;</span>roscoe<span>&#64;</span>gmail<span>&#46;</span>com</a></p>
</dd>
<dt class="field-odd">Date</dt>
<dd class="field-odd"><p>2021-09-10
:Version: .. include:: ../copied_files/TribitsGitVersion.txt</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Abstract</dt>
<dd class="field-odd"><p>This document is generated from the generic template body document <code class="docutils literal notranslate"><span class="pre">TribitsBuildReferenceBody.rst</span></code> and provides a general project-independent reference on how to configure, build, test, and install a project that uses the TriBITS CMake build system.  The primary audience of this particular build of this document are TriBITS project developers themselves.  A project-specific version of this document should be created and accessed by users of a particular TriBITS-based project.</p>
</dd>
</dl>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="auto-toc simple">
<li><p><a class="reference internal" href="#introduction" id="id1"><span class="sectnum">1</span> Introduction</a></p></li>
<li><p><a class="reference internal" href="#getting-set-up-to-use-cmake" id="id2"><span class="sectnum">2</span> Getting set up to use CMake</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#installing-a-binary-release-of-cmake-casual-users" id="id3"><span class="sectnum">2.1</span> Installing a binary release of CMake [casual users]</a></p></li>
<li><p><a class="reference internal" href="#installing-cmake-from-source-developers-and-experienced-users" id="id4"><span class="sectnum">2.2</span> Installing CMake from source [developers and experienced users]</a></p></li>
<li><p><a class="reference internal" href="#installing-ninja-from-source" id="id5"><span class="sectnum">2.3</span> Installing Ninja from Source</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#getting-cmake-help" id="id6"><span class="sectnum">3</span> Getting CMake Help</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#finding-cmake-help-at-the-website" id="id7"><span class="sectnum">3.1</span> Finding CMake help at the website</a></p></li>
<li><p><a class="reference internal" href="#building-cmake-help-locally" id="id8"><span class="sectnum">3.2</span> Building CMake help locally</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#configuring-makefile-ninja-and-other-generators" id="id9"><span class="sectnum">4</span> Configuring (Makefile, Ninja and other Generators)</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#setting-up-a-build-directory" id="id10"><span class="sectnum">4.1</span> Setting up a build directory</a></p></li>
<li><p><a class="reference internal" href="#basic-configuration" id="id11"><span class="sectnum">4.2</span> Basic configuration</a></p></li>
<li><p><a class="reference internal" href="#selecting-the-list-of-packages-to-enable" id="id12"><span class="sectnum">4.3</span> Selecting the list of packages to enable</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#determine-the-list-of-packages-that-can-be-enabled" id="id13"><span class="sectnum">4.3.1</span> Determine the list of packages that can be enabled</a></p></li>
<li><p><a class="reference internal" href="#print-package-dependencies" id="id14"><span class="sectnum">4.3.2</span> Print package dependencies</a></p></li>
<li><p><a class="reference internal" href="#enable-a-set-of-packages" id="id15"><span class="sectnum">4.3.3</span> Enable a set of packages</a></p></li>
<li><p><a class="reference internal" href="#enable-or-disable-tests-for-specific-packages" id="id16"><span class="sectnum">4.3.4</span> Enable or disable tests for specific packages</a></p></li>
<li><p><a class="reference internal" href="#enable-to-test-all-effects-of-changing-a-given-package-s" id="id17"><span class="sectnum">4.3.5</span> Enable to test all effects of changing a given package(s)</a></p></li>
<li><p><a class="reference internal" href="#enable-all-packages-and-optionally-all-tests" id="id18"><span class="sectnum">4.3.6</span> Enable all packages (and optionally all tests)</a></p></li>
<li><p><a class="reference internal" href="#disable-a-package-and-all-its-dependencies" id="id19"><span class="sectnum">4.3.7</span> Disable a package and all its dependencies</a></p></li>
<li><p><a class="reference internal" href="#remove-all-package-enables-in-the-cache" id="id20"><span class="sectnum">4.3.8</span> Remove all package enables in the cache</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#selecting-compiler-and-linker-options" id="id21"><span class="sectnum">4.4</span> Selecting compiler and linker options</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#configuring-to-build-with-default-debug-or-release-compiler-flags" id="id22"><span class="sectnum">4.4.1</span> Configuring to build with default debug or release compiler flags</a></p></li>
<li><p><a class="reference internal" href="#adding-arbitrary-compiler-flags-but-keeping-default-build-type-flags" id="id23"><span class="sectnum">4.4.2</span> Adding arbitrary compiler flags but keeping default build-type flags</a></p></li>
<li><p><a class="reference internal" href="#overriding-cmake-build-type-debug-release-compiler-options" id="id24"><span class="sectnum">4.4.3</span> Overriding CMAKE_BUILD_TYPE debug/release compiler options</a></p></li>
<li><p><a class="reference internal" href="#appending-arbitrary-libraries-and-link-flags-every-executable" id="id25"><span class="sectnum">4.4.4</span> Appending arbitrary libraries and link flags every executable</a></p></li>
<li><p><a class="reference internal" href="#turning-off-strong-warnings-for-individual-packages" id="id26"><span class="sectnum">4.4.5</span> Turning off strong warnings for individual packages</a></p></li>
<li><p><a class="reference internal" href="#overriding-all-strong-warnings-and-debug-release-compiler-options" id="id27"><span class="sectnum">4.4.6</span> Overriding all (strong warnings and debug/release) compiler options</a></p></li>
<li><p><a class="reference internal" href="#enable-and-disable-shadowing-warnings-for-all-project-packages" id="id28"><span class="sectnum">4.4.7</span> Enable and disable shadowing warnings for all &lt;Project&gt; packages</a></p></li>
<li><p><a class="reference internal" href="#removing-warnings-as-errors-for-cleaned-packages" id="id29"><span class="sectnum">4.4.8</span> Removing warnings as errors for CLEANED packages</a></p></li>
<li><p><a class="reference internal" href="#adding-debug-symbols-to-the-build" id="id30"><span class="sectnum">4.4.9</span> Adding debug symbols to the build</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#enabling-support-for-ninja" id="id31"><span class="sectnum">4.5</span> Enabling support for Ninja</a></p></li>
<li><p><a class="reference internal" href="#limiting-parallel-compile-and-link-jobs-for-ninja-builds" id="id32"><span class="sectnum">4.6</span> Limiting parallel compile and link jobs for Ninja builds</a></p></li>
<li><p><a class="reference internal" href="#disabling-explicit-template-instantiation-for-c" id="id33"><span class="sectnum">4.7</span> Disabling explicit template instantiation for C++</a></p></li>
<li><p><a class="reference internal" href="#disabling-the-fortran-compiler-and-all-fortran-code" id="id34"><span class="sectnum">4.8</span> Disabling the Fortran compiler and all Fortran code</a></p></li>
<li><p><a class="reference internal" href="#enabling-runtime-debug-checking" id="id35"><span class="sectnum">4.9</span> Enabling runtime debug checking</a></p></li>
<li><p><a class="reference internal" href="#configuring-with-mpi-support" id="id36"><span class="sectnum">4.10</span> Configuring with MPI support</a></p></li>
<li><p><a class="reference internal" href="#configuring-for-openmp-support" id="id37"><span class="sectnum">4.11</span> Configuring for OpenMP support</a></p></li>
<li><p><a class="reference internal" href="#building-shared-libraries" id="id38"><span class="sectnum">4.12</span> Building shared libraries</a></p></li>
<li><p><a class="reference internal" href="#building-static-libraries-and-executables" id="id39"><span class="sectnum">4.13</span> Building static libraries and executables</a></p></li>
<li><p><a class="reference internal" href="#enabling-the-usage-of-resource-files-to-reduce-length-of-build-lines" id="id40"><span class="sectnum">4.14</span> Enabling the usage of resource files to reduce length of build lines</a></p></li>
<li><p><a class="reference internal" href="#enabling-support-for-an-optional-third-party-library-tpl" id="id41"><span class="sectnum">4.15</span> Enabling support for an optional Third-Party Library (TPL)</a></p></li>
<li><p><a class="reference internal" href="#disabling-support-for-a-third-party-library-tpl" id="id42"><span class="sectnum">4.16</span> Disabling support for a Third-Party Library (TPL)</a></p></li>
<li><p><a class="reference internal" href="#disabling-tentatively-enabled-tpls" id="id43"><span class="sectnum">4.17</span> Disabling tentatively enabled TPLs</a></p></li>
<li><p><a class="reference internal" href="#require-all-tpl-libraries-be-found" id="id44"><span class="sectnum">4.18</span> Require all TPL libraries be found</a></p></li>
<li><p><a class="reference internal" href="#disable-warnings-from-tpl-header-files" id="id45"><span class="sectnum">4.19</span> Disable warnings from TPL header files</a></p></li>
<li><p><a class="reference internal" href="#xsdk-configuration-options" id="id46"><span class="sectnum">4.20</span> xSDK Configuration Options</a></p></li>
<li><p><a class="reference internal" href="#generating-verbose-output" id="id47"><span class="sectnum">4.21</span> Generating verbose output</a></p></li>
<li><p><a class="reference internal" href="#enabling-disabling-deprecated-warnings" id="id48"><span class="sectnum">4.22</span> Enabling/disabling deprecated warnings</a></p></li>
<li><p><a class="reference internal" href="#disabling-deprecated-code" id="id49"><span class="sectnum">4.23</span> Disabling deprecated code</a></p></li>
<li><p><a class="reference internal" href="#outputting-package-dependency-information" id="id50"><span class="sectnum">4.24</span> Outputting package dependency information</a></p></li>
<li><p><a class="reference internal" href="#test-related-configuration-settings" id="id51"><span class="sectnum">4.25</span> Test-related configuration settings</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#enabling-different-test-categories" id="id52"><span class="sectnum">4.25.1</span> Enabling different test categories</a></p></li>
<li><p><a class="reference internal" href="#disabling-specific-tests" id="id53"><span class="sectnum">4.25.2</span> Disabling specific tests</a></p></li>
<li><p><a class="reference internal" href="#disabling-specific-test-executable-builds" id="id54"><span class="sectnum">4.25.3</span> Disabling specific test executable builds</a></p></li>
<li><p><a class="reference internal" href="#disabling-just-the-ctest-tests-but-not-the-test-executables" id="id55"><span class="sectnum">4.25.4</span> Disabling just the ctest tests but not the test executables</a></p></li>
<li><p><a class="reference internal" href="#set-specific-tests-to-run-in-serial" id="id56"><span class="sectnum">4.25.5</span> Set specific tests to run in serial</a></p></li>
<li><p><a class="reference internal" href="#trace-test-addition-or-exclusion" id="id57"><span class="sectnum">4.25.6</span> Trace test addition or exclusion</a></p></li>
<li><p><a class="reference internal" href="#enable-advanced-test-start-and-end-times-and-timing-blocks" id="id58"><span class="sectnum">4.25.7</span> Enable advanced test start and end times and timing blocks</a></p></li>
<li><p><a class="reference internal" href="#setting-test-timeouts-at-configure-time" id="id59"><span class="sectnum">4.25.8</span> Setting test timeouts at configure time</a></p></li>
<li><p><a class="reference internal" href="#scaling-test-timeouts-at-configure-time" id="id60"><span class="sectnum">4.25.9</span> Scaling test timeouts at configure time</a></p></li>
<li><p><a class="reference internal" href="#spreading-out-and-limiting-tests-running-on-gpus" id="id61"><span class="sectnum">4.25.10</span> Spreading out and limiting tests running on GPUs</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#enabling-support-for-coverage-testing" id="id62"><span class="sectnum">4.26</span> Enabling support for coverage testing</a></p></li>
<li><p><a class="reference internal" href="#viewing-configure-options-and-documentation" id="id63"><span class="sectnum">4.27</span> Viewing configure options and documentation</a></p></li>
<li><p><a class="reference internal" href="#enabling-extra-repositories-with-add-on-packages" id="id64"><span class="sectnum">4.28</span> Enabling extra repositories with add-on packages:</a></p></li>
<li><p><a class="reference internal" href="#enabling-extra-repositories-through-a-file" id="id65"><span class="sectnum">4.29</span> Enabling extra repositories through a file</a></p></li>
<li><p><a class="reference internal" href="#selecting-a-different-source-location-for-a-package" id="id66"><span class="sectnum">4.30</span> Selecting a different source location for a package</a></p></li>
<li><p><a class="reference internal" href="#reconfiguring-completely-from-scratch" id="id67"><span class="sectnum">4.31</span> Reconfiguring completely from scratch</a></p></li>
<li><p><a class="reference internal" href="#viewing-configure-errors" id="id68"><span class="sectnum">4.32</span> Viewing configure errors</a></p></li>
<li><p><a class="reference internal" href="#adding-configure-timers" id="id69"><span class="sectnum">4.33</span> Adding configure timers</a></p></li>
<li><p><a class="reference internal" href="#generating-export-files" id="id70"><span class="sectnum">4.34</span> Generating export files</a></p></li>
<li><p><a class="reference internal" href="#generating-a-project-repo-version-file" id="id71"><span class="sectnum">4.35</span> Generating a project repo version file</a></p></li>
<li><p><a class="reference internal" href="#generating-git-version-date-files" id="id72"><span class="sectnum">4.36</span> Generating git version date files</a></p></li>
<li><p><a class="reference internal" href="#cmake-configure-time-development-mode-and-debug-checking" id="id73"><span class="sectnum">4.37</span> CMake configure-time development mode and debug checking</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#building-makefile-generator" id="id74"><span class="sectnum">5</span> Building (Makefile generator)</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#building-all-targets" id="id75"><span class="sectnum">5.1</span> Building all targets</a></p></li>
<li><p><a class="reference internal" href="#discovering-what-targets-are-available-to-build" id="id76"><span class="sectnum">5.2</span> Discovering what targets are available to build</a></p></li>
<li><p><a class="reference internal" href="#building-all-of-the-targets-for-a-package" id="id77"><span class="sectnum">5.3</span> Building all of the targets for a package</a></p></li>
<li><p><a class="reference internal" href="#building-all-of-the-libraries-for-a-package" id="id78"><span class="sectnum">5.4</span> Building all of the libraries for a package</a></p></li>
<li><p><a class="reference internal" href="#building-all-of-the-libraries-for-all-enabled-packages" id="id79"><span class="sectnum">5.5</span> Building all of the libraries for all enabled packages</a></p></li>
<li><p><a class="reference internal" href="#building-a-single-object-file" id="id80"><span class="sectnum">5.6</span> Building a single object file</a></p></li>
<li><p><a class="reference internal" href="#building-with-verbose-output-without-reconfiguring" id="id81"><span class="sectnum">5.7</span> Building with verbose output without reconfiguring</a></p></li>
<li><p><a class="reference internal" href="#relink-a-target-without-considering-dependencies" id="id82"><span class="sectnum">5.8</span> Relink a target without considering dependencies</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#building-ninja-generator" id="id83"><span class="sectnum">6</span> Building (Ninja generator)</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#building-in-parallel-with-ninja" id="id84"><span class="sectnum">6.1</span> Building in parallel with Ninja</a></p></li>
<li><p><a class="reference internal" href="#building-in-a-subdirectory-with-ninja" id="id85"><span class="sectnum">6.2</span> Building in a subdirectory with Ninja</a></p></li>
<li><p><a class="reference internal" href="#building-verbose-without-reconfiguring-with-ninja" id="id86"><span class="sectnum">6.3</span> Building verbose without reconfiguring with Ninja</a></p></li>
<li><p><a class="reference internal" href="#discovering-what-targets-are-available-to-build-with-ninja" id="id87"><span class="sectnum">6.4</span> Discovering what targets are available to build with Ninja</a></p></li>
<li><p><a class="reference internal" href="#building-specific-targets-with-ninja" id="id88"><span class="sectnum">6.5</span> Building specific targets with Ninja</a></p></li>
<li><p><a class="reference internal" href="#building-single-object-files-with-ninja" id="id89"><span class="sectnum">6.6</span> Building single object files with Ninja</a></p></li>
<li><p><a class="reference internal" href="#cleaning-build-targets-with-ninja" id="id90"><span class="sectnum">6.7</span> Cleaning build targets with Ninja</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#testing-with-ctest" id="id91"><span class="sectnum">7</span> Testing with CTest</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#running-all-tests" id="id92"><span class="sectnum">7.1</span> Running all tests</a></p></li>
<li><p><a class="reference internal" href="#only-running-tests-for-a-single-package" id="id93"><span class="sectnum">7.2</span> Only running tests for a single package</a></p></li>
<li><p><a class="reference internal" href="#running-a-single-test-with-full-output-to-the-console" id="id94"><span class="sectnum">7.3</span> Running a single test with full output to the console</a></p></li>
<li><p><a class="reference internal" href="#overriding-test-timeouts" id="id95"><span class="sectnum">7.4</span> Overriding test timeouts</a></p></li>
<li><p><a class="reference internal" href="#running-memory-checking" id="id96"><span class="sectnum">7.5</span> Running memory checking</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#installing" id="id97"><span class="sectnum">8</span> Installing</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#setting-the-install-prefix" id="id98"><span class="sectnum">8.1</span> Setting the install prefix</a></p></li>
<li><p><a class="reference internal" href="#setting-install-ownership-and-permissions" id="id99"><span class="sectnum">8.2</span> Setting install ownership and permissions</a></p></li>
<li><p><a class="reference internal" href="#setting-install-rpath" id="id100"><span class="sectnum">8.3</span> Setting install RPATH</a></p></li>
<li><p><a class="reference internal" href="#avoiding-installing-libraries-and-headers" id="id101"><span class="sectnum">8.4</span> Avoiding installing libraries and headers</a></p></li>
<li><p><a class="reference internal" href="#installing-the-software" id="id102"><span class="sectnum">8.5</span> Installing the software</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#installation-testing" id="id103"><span class="sectnum">9</span> Installation Testing</a></p></li>
<li><p><a class="reference internal" href="#packaging" id="id104"><span class="sectnum">10</span> Packaging</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#creating-a-tarball-of-the-source-tree" id="id105"><span class="sectnum">10.1</span> Creating a tarball of the source tree</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#dashboard-submissions" id="id106"><span class="sectnum">11</span> Dashboard submissions</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#setting-options-to-change-behavior-of-dashboard-target" id="id107"><span class="sectnum">11.1</span> Setting options to change behavior of ‘dashboard’ target</a></p></li>
<li><p><a class="reference internal" href="#common-options-and-use-cases-for-the-dashboard-target" id="id108"><span class="sectnum">11.2</span> Common options and use cases for the ‘dashboard’ target</a></p></li>
<li><p><a class="reference internal" href="#changing-the-cdash-sites-for-the-dashboard-target" id="id109"><span class="sectnum">11.3</span> Changing the CDash sites for the ‘dashboard’ target</a></p></li>
<li><p><a class="reference internal" href="#configuring-from-scratch-needed-if-dashboard-target-aborts-early" id="id110"><span class="sectnum">11.4</span> Configuring from scratch needed if ‘dashboard’ target aborts early</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h1><a class="toc-backref" href="#id1"><span class="sectnum">1</span> Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<p>This document is created using the script <code class="docutils literal notranslate"><span class="pre">create-build-ref.sh</span></code> in this
directory which just runs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./create-project-build-ref.py \
  --project-name=&quot;&lt;Project&gt;&quot; \
  --project-template-file=TribitsBuildReferenceTemplate.rst \
  --file-base=TribitsBuildReference
</pre></div>
</div>
<p>In a project-specific version, <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;</span></code> is replaced with the actual
project name (e.g. <code class="docutils literal notranslate"><span class="pre">Trilinos</span></code>).  This version of the generated document is
referred to by the general TribitsDeveloperGuide.[rst,html,pdf] document.</p>
<p>Below are given genetic versions of the sections that show up in every
project-specific build of this document.</p>
</div>
<div class="section" id="getting-set-up-to-use-cmake">
<h1><a class="toc-backref" href="#id2"><span class="sectnum">2</span> Getting set up to use CMake</a><a class="headerlink" href="#getting-set-up-to-use-cmake" title="Permalink to this headline">¶</a></h1>
<p>Before one can configure &lt;Project&gt; to be built, one must first obtain a
version of CMake on the system newer than 3.17.0 This guide assumes
that once CMake is installed that it will be in the default path with the name
<code class="docutils literal notranslate"><span class="pre">cmake</span></code>.</p>
<div class="section" id="installing-a-binary-release-of-cmake-casual-users">
<h2><a class="toc-backref" href="#id3"><span class="sectnum">2.1</span> Installing a binary release of CMake [casual users]</a><a class="headerlink" href="#installing-a-binary-release-of-cmake-casual-users" title="Permalink to this headline">¶</a></h2>
<p>Download and install the binary (version 3.17.0 or greater is
recommended) from:</p>
<blockquote>
<div><p><a class="reference external" href="http://www.cmake.org/cmake/resources/software.html">http://www.cmake.org/cmake/resources/software.html</a></p>
</div></blockquote>
</div>
<div class="section" id="installing-cmake-from-source-developers-and-experienced-users">
<h2><a class="toc-backref" href="#id4"><span class="sectnum">2.2</span> Installing CMake from source [developers and experienced users]</a><a class="headerlink" href="#installing-cmake-from-source-developers-and-experienced-users" title="Permalink to this headline">¶</a></h2>
<p>If you have access to the &lt;Project&gt; git repositories (which which includes a
snapshot of TriBITS), then install CMake with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd &lt;some-scratch-space&gt;/
$ export TRIBITS_BASE_DIR=&lt;project-base-dir&gt;/cmake/tribits
$ $TRIBITS_BASE_DIR/devtools_install/install-cmake.py \
   --install-dir-base=&lt;INSTALL_BASE_DIR&gt; --cmake-version=X.Y.Z \
   --do-all
</pre></div>
</div>
<p>This will result in cmake and related CMake tools being installed in
<code class="docutils literal notranslate"><span class="pre">&lt;INSTALL_BASE_DIR&gt;/cmake-X.Y.Z/bin/</span></code> (see the instructions printed at the
end on how to update your <code class="docutils literal notranslate"><span class="pre">PATH</span></code> env var).</p>
<p>To get help for installing CMake with this script use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ $TRIBITS_BASE_DIR/devtools_install/install-cmake.py --help
</pre></div>
</div>
<p>NOTE: You will want to read the help message about how to install CMake to
share with other users and maintainers and how to install with sudo if needed.</p>
</div>
<div class="section" id="installing-ninja-from-source">
<h2><a class="toc-backref" href="#id5"><span class="sectnum">2.3</span> Installing Ninja from Source</a><a class="headerlink" href="#installing-ninja-from-source" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://ninja-build.org">Ninja</a> tool allows for much faster parallel builds for some large CMake
projects and performs much faster dependency analysis than the Makefiles
back-end build system.  It also provides some other nice features like <code class="docutils literal notranslate"><span class="pre">ninja</span>
<span class="pre">-n</span> <span class="pre">-d</span> <span class="pre">explain</span></code> to show why the build system decides to (re)build the targets
that it decides to build.</p>
<p>The Kitware fork of Ninja at:</p>
<blockquote>
<div><p><a class="reference external" href="https://github.com/Kitware/ninja/releases">https://github.com/Kitware/ninja/releases</a></p>
</div></blockquote>
<p>provides releases of Ninja that allows CMake 3.7.0+ to build Fortran code with
Ninja.  For example, the Kitware Ninja release <code class="docutils literal notranslate"><span class="pre">1.7.2.git.kitware.dyndep-1</span></code>
works with Fortran.  As of Ninja 1.10+, Fortran support is part of the
official Google-maintained version of Ninja as can be obtained from:</p>
<blockquote>
<div><p><a class="reference external" href="https://github.com/ninja-build/ninja/releases">https://github.com/ninja-build/ninja/releases</a></p>
</div></blockquote>
<p>and as of CMake 3.17+, cmake will recognize native Fortran support for Ninja
1.10+ (see <a class="reference external" href="https://cmake.org/cmake/help/latest/generator/Ninja.html">CMake Ninja Fortran Support</a>).</p>
<p>Ninja is easy to install from source on almost any machine.  On Unix/Linux
systems it is as simple as <code class="docutils literal notranslate"><span class="pre">configure</span> <span class="pre">--prefix=&lt;dir&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">make</span></code> and <code class="docutils literal notranslate"><span class="pre">make</span>
<span class="pre">install</span></code>.</p>
</div>
</div>
<div class="section" id="getting-cmake-help">
<h1><a class="toc-backref" href="#id6"><span class="sectnum">3</span> Getting CMake Help</a><a class="headerlink" href="#getting-cmake-help" title="Permalink to this headline">¶</a></h1>
<div class="section" id="finding-cmake-help-at-the-website">
<h2><a class="toc-backref" href="#id7"><span class="sectnum">3.1</span> Finding CMake help at the website</a><a class="headerlink" href="#finding-cmake-help-at-the-website" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p><a class="reference external" href="http://www.cmake.org">http://www.cmake.org</a></p>
</div></blockquote>
</div>
<div class="section" id="building-cmake-help-locally">
<h2><a class="toc-backref" href="#id8"><span class="sectnum">3.2</span> Building CMake help locally</a><a class="headerlink" href="#building-cmake-help-locally" title="Permalink to this headline">¶</a></h2>
<p>To get help on CMake input options, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cmake --help
</pre></div>
</div>
<p>To get help on a single CMake function, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cmake --help-command &lt;command&gt;
</pre></div>
</div>
<p>To generate the entire documentation at once, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cmake --help-full cmake.help.html
</pre></div>
</div>
<p>(Open your web browser to the file cmake.help.html)</p>
</div>
</div>
<div class="section" id="configuring-makefile-ninja-and-other-generators">
<h1><a class="toc-backref" href="#id9"><span class="sectnum">4</span> Configuring (Makefile, Ninja and other Generators)</a><a class="headerlink" href="#configuring-makefile-ninja-and-other-generators" title="Permalink to this headline">¶</a></h1>
<p>CMake supports a number of different build generators (e.g. Ninja, Eclipse,
XCode, MS Visual Studio, etc.) but the primary generator most people use on
Unix/Linux system is <code class="docutils literal notranslate"><span class="pre">make</span></code> (using the default cmake option <code class="docutils literal notranslate"><span class="pre">-G&quot;Unix</span>
<span class="pre">Makefiles&quot;</span></code>) and CMake generated Makefiles.  Another (increasingly) popular
generator is Ninja (using cmake option <code class="docutils literal notranslate"><span class="pre">-GNinja</span></code>).  Most of the material in
this section applies to all generators but most experience is for the
Makefiles and Ninja generators.</p>
<div class="section" id="setting-up-a-build-directory">
<h2><a class="toc-backref" href="#id10"><span class="sectnum">4.1</span> Setting up a build directory</a><a class="headerlink" href="#setting-up-a-build-directory" title="Permalink to this headline">¶</a></h2>
<p>In order to configure, one must set up a build directory.  &lt;Project&gt; does
<strong>not</strong> support in-source builds so the build tree must be separate from the
source tree.  The build tree can be created under the source tree such as
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd &lt;src-dir&gt;/
$ mkdir &lt;build-dir&gt;
$ cd &lt;build-dir&gt;/
</pre></div>
</div>
<p>but it is generally recommended to create a build directory parallel from the
source tree such as with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">some</span><span class="o">-</span><span class="n">base</span><span class="o">-</span><span class="nb">dir</span><span class="o">&gt;/</span>
  <span class="o">&lt;</span><span class="n">src</span><span class="o">-</span><span class="nb">dir</span><span class="o">&gt;/</span>
  <span class="o">&lt;</span><span class="n">build</span><span class="o">-</span><span class="nb">dir</span><span class="o">&gt;/</span>
</pre></div>
</div>
<p>NOTE: If you mistakenly try to configure for an in-source build (e.g. with
‘cmake .’) you will get an error message and instructions on how to resolve
the problem by deleting the generated CMakeCache.txt file (and other generated
files) and then follow directions on how to create a different build directory
as shown above.</p>
</div>
<div class="section" id="basic-configuration">
<h2><a class="toc-backref" href="#id11"><span class="sectnum">4.2</span> Basic configuration</a><a class="headerlink" href="#basic-configuration" title="Permalink to this headline">¶</a></h2>
<p>A few different approaches for configuring are given below.</p>
<ol class="loweralpha">
<li><p>Create a ‘do-configure’ script such as [Recommended]:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash
cmake \
  -D CMAKE_BUILD_TYPE=DEBUG \
  -D &lt;Project&gt;_ENABLE_TESTS=ON \
  &quot;$@&quot; \
  ${SOURCE_BASE}
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div><p>and then run it with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">do</span><span class="o">-</span><span class="n">configure</span> <span class="p">[</span><span class="n">OTHER</span> <span class="n">OPTIONS</span><span class="p">]</span> <span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_</span><span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;=</span><span class="n">ON</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> is a valid SE Package name (see above), etc. and
<code class="docutils literal notranslate"><span class="pre">SOURCE_BASE</span></code> is set to the &lt;Project&gt; source base directory (or your can
just give it explicitly in the script).</p>
<p>See <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;/sampleScripts/*</span></code> for examples of real <code class="docutils literal notranslate"><span class="pre">do-configure</span></code>
scripts for different platforms.</p>
<p>NOTE: If one has already configured once and one needs to configure from
scratch (needs to wipe clean defaults for cache variables, updates
compilers, other types of changes) then one will want to delete the local
CMakeCache.txt and other CMake-generated files before configuring again (see
<a class="reference internal" href="#reconfiguring-completely-from-scratch">Reconfiguring completely from scratch</a>).</p>
</div></blockquote>
<ol class="loweralpha simple" id="project-configure-options-file" start="2">
<li><p>Create a <code class="docutils literal notranslate"><span class="pre">*.cmake</span></code> file and point to it [Most Recommended].</p></li>
</ol>
<blockquote>
<div><p>Create a do-configure script like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash
cmake \
  -D &lt;Project&gt;_CONFIGURE_OPTIONS_FILE=MyConfigureOptions.cmake \
  -D &lt;Project&gt;_ENABLE_TESTS=ON \
  &quot;$@&quot; \
  ${SOURCE_BASE}
</pre></div>
</div>
<p>where MyConfigureOptions.cmake (in the current working directory) might look
like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">CMAKE_BUILD_TYPE</span> <span class="n">DEBUG</span> <span class="n">CACHE</span> <span class="n">STRING</span> <span class="s2">&quot;Set in MyConfigureOptions.cmake&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_CHECKED_STL</span> <span class="n">ON</span> <span class="n">CACHE</span> <span class="n">BOOL</span> <span class="s2">&quot;Set in MyConfigureOptions.cmake&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="n">BUILD_SHARED_LIBS</span> <span class="n">ON</span> <span class="n">CACHE</span> <span class="n">BOOL</span> <span class="s2">&quot;Set in MyConfigureOptions.cmake&quot;</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Using a configuration fragment <code class="docutils literal notranslate"><span class="pre">*.cmake</span></code> file allows for better reuse of
configure options across different configure scripts and better version
control of configure options.  Using the comment <code class="docutils literal notranslate"><span class="pre">&quot;Set</span> <span class="pre">in</span>
<span class="pre">MyConfigureOptions.cmake&quot;</span></code> makes it easy see where that variable got set
when looking an the generated <code class="docutils literal notranslate"><span class="pre">CMakeCache.txt</span></code> file.  Also, when this
<code class="docutils literal notranslate"><span class="pre">*.cmake</span></code> fragment file changes, CMake will automatically trigger a
reconfgure during a make (because it knows about the file and will check its
time stamp, unlike when using <code class="docutils literal notranslate"><span class="pre">-C</span> <span class="pre">&lt;file-name&gt;.cmake</span></code>, see below).</p>
<p>One can use the <code class="docutils literal notranslate"><span class="pre">FORCE</span></code> option in the <code class="docutils literal notranslate"><span class="pre">set()</span></code> commands shown above and
that will override any value of the options that might already be set.
However, that will not allow the user to override the options on the CMake
command-line using <code class="docutils literal notranslate"><span class="pre">-D&lt;VAR&gt;=&lt;value&gt;</span></code> so it is generally <strong>not</strong> desired to
use <code class="docutils literal notranslate"><span class="pre">FORCE</span></code>.</p>
<p>One can also pass in a list of configuration fragment files separated by
commas <code class="docutils literal notranslate"><span class="pre">','</span></code> which will be read in the order they are given as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_CONFIGURE_OPTIONS_FILE</span><span class="o">=&lt;</span><span class="n">file0</span><span class="o">&gt;.</span><span class="n">cmake</span><span class="p">,</span><span class="o">&lt;</span><span class="n">file1</span><span class="o">&gt;.</span><span class="n">cmake</span><span class="p">,</span><span class="o">...</span>
</pre></div>
</div>
<p>One can read in configure option files under the project source directory by
using the type <code class="docutils literal notranslate"><span class="pre">STRING</span></code> such as with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_CONFIGURE_OPTIONS_FILE</span><span class="p">:</span><span class="n">STRING</span><span class="o">=</span><span class="n">cmake</span><span class="o">/</span><span class="n">MpiConfig1</span><span class="o">.</span><span class="n">cmake</span>
</pre></div>
</div>
<p>In this case, the relative paths will be with respect to the project base
source directory, not the current working directory (unlike when using <code class="docutils literal notranslate"><span class="pre">-C</span>
<span class="pre">&lt;file-name&gt;.cmake</span></code>, see below).  (By specifying the type <code class="docutils literal notranslate"><span class="pre">STRING</span></code>, one
turns off CMake interpretation as a <code class="docutils literal notranslate"><span class="pre">FILEPATH</span></code>.  Otherwise, the type
<code class="docutils literal notranslate"><span class="pre">FILEPATH</span></code> causes CMake to always interpret relative paths with respect to
the current working directory and set the absolute path).</p>
<p>Note that CMake options files can also be read in using the built-in CMake
argument <code class="docutils literal notranslate"><span class="pre">-C</span> <span class="pre">&lt;file&gt;.cmake</span></code> as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cmake -C &lt;file0&gt;.cmake -C &lt;file1&gt;.cmake ... [other options] \
  ${SOURCE_BASE}
</pre></div>
</div>
<p>However, there are some differences to using
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_CONFIGURE_OPTIONS_FILE</span></code> vs. <code class="docutils literal notranslate"><span class="pre">-C</span></code> to read in <code class="docutils literal notranslate"><span class="pre">*.cmake</span></code> files
to be aware of as described below:</p>
<p>1) One can use
<code class="docutils literal notranslate"><span class="pre">-D&lt;Project&gt;_CONFIGURE_OPTIONS_FILE:STRING=&lt;rel-path&gt;/&lt;file-name&gt;.cmake</span></code>
with a relative path w.r.t. to the source tree to make it easier to point to
options files in the project source.  Using <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-C</span>
<span class="pre">&lt;abs-path&gt;/&lt;file-name&gt;.cmake</span></code> would require having to give the absolute
path <code class="docutils literal notranslate"><span class="pre">&lt;abs-path&gt;</span></code> or a longer relative path from the build directory back
to the source directory.  Having to give the absolute path to files in the
source tree complicates configure scripts in some cases (i.e. where the
project source directory location may not be known or easy to get).</p>
<p>2) When configuration files are read in using
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_CONFIGURE_OPTIONS_FILE</span></code>, the will get reprocessed on every
reconfigure (such as when reconfigure happens automatically when running
<code class="docutils literal notranslate"><span class="pre">make</span></code>).  That means that if options change in those included <code class="docutils literal notranslate"><span class="pre">*.cmake</span></code>
files from the initial configure, then those updated options will get
automatically picked up in a reconfigure.  But when processing <code class="docutils literal notranslate"><span class="pre">*.cmake</span></code>
files using the built-in <code class="docutils literal notranslate"><span class="pre">-C</span> <span class="pre">&lt;file-name&gt;.cmake</span></code> argument, updated options
will not get set.  Therefore, if one wants to have the <code class="docutils literal notranslate"><span class="pre">*.cmake</span></code> files
automatically be reprocessed, then one should use
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_CONFIGURE_OPTIONS_FILE</span></code>.  But if one does not want to have the
contents of the <code class="docutils literal notranslate"><span class="pre">*.cmake</span></code> file reread on reconfigures, then one would want
to use <code class="docutils literal notranslate"><span class="pre">-C</span></code>.</p>
<p>3) One can create and use parametrized <code class="docutils literal notranslate"><span class="pre">*.cmake</span></code> files that can be used
with multiple TriBITS projects.  For example, one can have set statements
like <code class="docutils literal notranslate"><span class="pre">set(${PROJECT_NAME}_ENABLE_Fortran</span> <span class="pre">OFF</span> <span class="pre">...)</span></code> since <code class="docutils literal notranslate"><span class="pre">PROJECT_NAME</span></code>
is known before the file is included.  One can’t do that with <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-C</span></code>
and instead would have to the full variables names specific for a given
project.</p>
<p>4) Non-cache project-level variables can be set in a <code class="docutils literal notranslate"><span class="pre">*.cmake</span></code> file that
will impact the configuration.  When using the <code class="docutils literal notranslate"><span class="pre">-C</span></code> option, only variables
set with <code class="docutils literal notranslate"><span class="pre">set(&lt;varName&gt;</span> <span class="pre">CACHE</span> <span class="pre">&lt;TYPE&gt;</span> <span class="pre">...)</span></code> will impact the configuration.</p>
<p>5) However, the <code class="docutils literal notranslate"><span class="pre">*.cmake</span></code> files specified by
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_CONFIGURE_OPTIONS_FILE</span></code> will only get read in <strong>after</strong> the
project’s <code class="docutils literal notranslate"><span class="pre">ProjectName.cmake</span></code> and other <code class="docutils literal notranslate"><span class="pre">set()</span></code> statements are called at
the top of the project’s top-level <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file.  So any CMake
cache variables that are set in this early CMake code will override cache
defaults set in the included <code class="docutils literal notranslate"><span class="pre">*.cmake</span></code> file.  (This is why TriBITS
projects must be careful <strong>not</strong> to set default values for cache variables
directly like this but instead should set indirect
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_&lt;VarName&gt;_DEFAULT</span></code> non-cache variables.)  But when a
<code class="docutils literal notranslate"><span class="pre">*.cmake</span></code> file is read in using <code class="docutils literal notranslate"><span class="pre">-C</span></code>, then the <code class="docutils literal notranslate"><span class="pre">set()</span></code> statements in
those files will get processed before any in the project’s
<code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file.  So be careful about this difference in behavior
and carefully watch cache variable values actually set in the generated
<code class="docutils literal notranslate"><span class="pre">CMakeCache.txt</span></code> file.</p>
<p>In other words, the context and impact of what get be set from a <code class="docutils literal notranslate"><span class="pre">*.cmake</span></code>
file read in through the <code class="docutils literal notranslate"><span class="pre">-C</span></code> argument is more limited while the code
listed in the <code class="docutils literal notranslate"><span class="pre">*.cmake</span></code> file behaves just like regular CMake statements
executed in the project’s top-level <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file.</p>
</div></blockquote>
<ol class="loweralpha simple" start="3">
<li><p>Using the QT CMake configuration GUI:</p></li>
</ol>
<blockquote>
<div><p>On systems where the QT CMake GUI is installed (e.g. Windows) the CMake GUI
can be a nice way to configure &lt;Project&gt; (or just explore options) if you
are a user.  To make your configuration easily repeatable, you might want to
create a fragment file and just load it by setting
<a class="reference internal" href="#project-configure-options-file">&lt;Project&gt;_CONFIGURE_OPTIONS_FILE</a> in the GUI.</p>
</div></blockquote>
<p>Likely the most recommended approach to manage complex configurations is to
use <code class="docutils literal notranslate"><span class="pre">*.cmake</span></code> fragment files passed in through the
<a class="reference internal" href="#project-configure-options-file">&lt;Project&gt;_CONFIGURE_OPTIONS_FILE</a> option.  This offers the greatest
flexibility and the ability to version-control the configuration settings.</p>
</div>
<div class="section" id="selecting-the-list-of-packages-to-enable">
<h2><a class="toc-backref" href="#id12"><span class="sectnum">4.3</span> Selecting the list of packages to enable</a><a class="headerlink" href="#selecting-the-list-of-packages-to-enable" title="Permalink to this headline">¶</a></h2>
<p>The &lt;Project&gt; project is broken up into a set of packages that can be enabled
(or disabled).  For details and generic examples, see <a class="reference external" href="TribitsUsersGuide.html#package-dependencies-and-enable-disable-logic">Package Dependencies and
Enable/Disable Logic</a> and <a class="reference external" href="TribitsUsersGuide.html#tribits-dependency-handling-behaviors">TriBITS Dependency Handling Behaviors</a>.</p>
<p>See the following use cases:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#determine-the-list-of-packages-that-can-be-enabled">Determine the list of packages that can be enabled</a></p></li>
<li><p><a class="reference internal" href="#print-package-dependencies">Print package dependencies</a></p></li>
<li><p><a class="reference internal" href="#enable-a-set-of-packages">Enable a set of packages</a></p></li>
<li><p><a class="reference internal" href="#enable-or-disable-tests-for-specific-packages">Enable or disable tests for specific packages</a></p></li>
<li><p><a class="reference internal" href="#enable-to-test-all-effects-of-changing-a-given-package-s">Enable to test all effects of changing a given package(s)</a></p></li>
<li><p><a class="reference internal" href="#enable-all-packages-and-optionally-all-tests">Enable all packages (and optionally all tests)</a></p></li>
<li><p><a class="reference internal" href="#disable-a-package-and-all-its-dependencies">Disable a package and all its dependencies</a></p></li>
<li><p><a class="reference internal" href="#remove-all-package-enables-in-the-cache">Remove all package enables in the cache</a></p></li>
</ul>
<div class="section" id="determine-the-list-of-packages-that-can-be-enabled">
<h3><a class="toc-backref" href="#id13"><span class="sectnum">4.3.1</span> Determine the list of packages that can be enabled</a><a class="headerlink" href="#determine-the-list-of-packages-that-can-be-enabled" title="Permalink to this headline">¶</a></h3>
<p>In order to see the list of available &lt;Project&gt; SE Packages to enable, just
run a basic CMake configure, enabling nothing, and then grep the output to see
what packages are available to enable.  The full set of defined packages is
contained the lines starting with <code class="docutils literal notranslate"><span class="pre">'Final</span> <span class="pre">set</span> <span class="pre">of</span> <span class="pre">enabled</span> <span class="pre">SE</span> <span class="pre">packages'</span></code> and
<code class="docutils literal notranslate"><span class="pre">'Final</span> <span class="pre">set</span> <span class="pre">of</span> <span class="pre">non-enabled</span> <span class="pre">SE</span> <span class="pre">packages'</span></code>.  If no SE packages are enabled by
default (which is base behavior), the full list of packages will be listed on
the line <code class="docutils literal notranslate"><span class="pre">'Final</span> <span class="pre">set</span> <span class="pre">of</span> <span class="pre">non-enabled</span> <span class="pre">SE</span> <span class="pre">packages'</span></code>.  Therefore, to see the
full list of defined packages, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">do</span><span class="o">-</span><span class="n">configure</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">|</span> <span class="n">grep</span> <span class="s2">&quot;Final set of .*enabled SE packages&quot;</span>
</pre></div>
</div>
<p>Any of the packages shown on those lines can potentially be enabled using <code class="docutils literal notranslate"><span class="pre">-D</span>
<span class="pre">&lt;Project&gt;_ENABLE_&lt;TRIBITS_PACKAGE&gt;=ON</span></code> (unless they are set to disabled
for some reason, see the CMake output for package disable warnings).</p>
<p>Another way to see the full list of SE packages that can be enabled is to
configure with <a class="reference internal" href="#project-dump-package-dependencies">&lt;Project&gt;_DUMP_PACKAGE_DEPENDENCIES</a> = <code class="docutils literal notranslate"><span class="pre">ON</span></code> and then grep
for <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_SE_PACKAGES</span></code> using, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">do</span><span class="o">-</span><span class="n">configure</span> <span class="mi">2</span><span class="o">&gt;&amp;</span><span class="mi">1</span> <span class="o">|</span> <span class="n">grep</span> <span class="s2">&quot;&lt;Project&gt;_SE_PACKAGES: &quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="print-package-dependencies">
<h3><a class="toc-backref" href="#id14"><span class="sectnum">4.3.2</span> Print package dependencies</a><a class="headerlink" href="#print-package-dependencies" title="Permalink to this headline">¶</a></h3>
<p id="project-dump-package-dependencies">The set of package dependencies can be printed in the <code class="docutils literal notranslate"><span class="pre">cmake</span></code> STDOUT by
setting the configure option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_DUMP_PACKAGE_DEPENDENCIES</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>This will print the basic forward/upstream dependencies for each SE package.
To find this output, look for the line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Printing</span> <span class="n">package</span> <span class="n">dependencies</span> <span class="o">...</span>
</pre></div>
</div>
<p>and the dependencies are listed below this for each SE package in the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="o">&lt;</span><span class="n">PKG</span><span class="o">&gt;</span><span class="n">_LIB_REQUIRED_DEP_TPLS</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">TPL0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">TPL1</span><span class="o">&gt;</span> <span class="o">...</span>
<span class="o">--</span> <span class="o">&lt;</span><span class="n">PKG</span><span class="o">&gt;</span><span class="n">_LIB_OPTIONAL_DEP_TPLS</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">TPL2</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">TPL3</span><span class="o">&gt;</span> <span class="o">...</span>
<span class="o">--</span> <span class="o">&lt;</span><span class="n">PKG</span><span class="o">&gt;</span><span class="n">_LIB_REQUIRED_DEP_PACKAGES</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">PKG0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="p">[</span><span class="n">PKG1</span><span class="o">&gt;</span> <span class="o">...</span>
<span class="o">--</span> <span class="o">&lt;</span><span class="n">PKG</span><span class="o">&gt;</span><span class="n">_LIB_OPTIONAL_DEP_PACKAGES</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">PKG2</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">PKG3</span><span class="o">&gt;</span> <span class="o">...</span>
<span class="o">--</span> <span class="o">&lt;</span><span class="n">PKG</span><span class="o">&gt;</span><span class="n">_TEST_REQUIRED_DEP_TPLS</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">TPL4</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">TPL5</span><span class="o">&gt;</span> <span class="o">...</span>
<span class="o">--</span> <span class="o">&lt;</span><span class="n">PKG</span><span class="o">&gt;</span><span class="n">_TEST_OPTIONAL_DEP_TPLS</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">TPL6</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">TPL7</span><span class="o">&gt;</span> <span class="o">...</span>
<span class="o">--</span> <span class="o">&lt;</span><span class="n">PKG</span><span class="o">&gt;</span><span class="n">_TEST_REQUIRED_DEP_PACKAGES</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">PKG4</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="p">[</span><span class="n">PKG5</span><span class="o">&gt;</span> <span class="o">...</span>
<span class="o">--</span> <span class="o">&lt;</span><span class="n">PKG</span><span class="o">&gt;</span><span class="n">_TEST_OPTIONAL_DEP_PACKAGES</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">PKG6</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">PKG7</span><span class="o">&gt;</span> <span class="o">...</span>
</pre></div>
</div>
<p>(Dependencies that don’t exist are left out of the output.  For example, if
there are no <code class="docutils literal notranslate"><span class="pre">&lt;PKG&gt;_LIB_OPTIONAL_DEP_PACKAGES</span></code> dependencies, then that line
is not printed.)</p>
<p>To also see the direct forward/downstream dependencies for each SE package,
also include:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_DUMP_FORWARD_PACKAGE_DEPENDENCIES</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>These dependencies are printed along with the backward/upstsream dependencies
as described above.</p>
<p>Both of these variables are automatically enabled when
<a class="reference internal" href="#project-verbose-configure">&lt;Project&gt;_VERBOSE_CONFIGURE</a> = <code class="docutils literal notranslate"><span class="pre">ON</span></code>.</p>
</div>
<div class="section" id="enable-a-set-of-packages">
<h3><a class="toc-backref" href="#id15"><span class="sectnum">4.3.3</span> Enable a set of packages</a><a class="headerlink" href="#enable-a-set-of-packages" title="Permalink to this headline">¶</a></h3>
<p id="project-enable-tests">To enable an SE package <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> (and optionally also its tests
and examples), configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_</span><span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_ALL_OPTIONAL_PACKAGES</span><span class="o">=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_TESTS</span><span class="o">=</span><span class="n">ON</span> \
</pre></div>
</div>
<p>This set of arguments allows a user to turn on <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> as well
as all packages that <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> can use.  All of the package’s
optional “can use” upstream dependent packages are enabled with
<code class="docutils literal notranslate"><span class="pre">-D&lt;Project&gt;_ENABLE_ALL_OPTIONAL_PACKAGES=ON</span></code>.  However,
<code class="docutils literal notranslate"><span class="pre">-D&lt;Project&gt;_ENABLE_TESTS=ON</span></code> will only enable tests and examples for
<code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> (or any other packages specifically enabled).</p>
<p>If a TriBITS package <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> has subpackages (e.g. <code class="docutils literal notranslate"><span class="pre">&lt;A&gt;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&lt;B&gt;</span></code>, etc.), then enabling the package is equivalent to setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_</span><span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;&lt;</span><span class="n">A</span><span class="o">&gt;=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_</span><span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;&lt;</span><span class="n">B</span><span class="o">&gt;=</span><span class="n">ON</span> \
 <span class="o">...</span>
</pre></div>
</div>
<p>However, a TriBITS subpackage will only be enabled if it is not already
disabled either explicitly or implicitly.</p>
<p>NOTE: The CMake cache variable type for all <code class="docutils literal notranslate"><span class="pre">XXX_ENABLE_YYY</span></code> variables is
actually <code class="docutils literal notranslate"><span class="pre">STRING</span></code> and not <code class="docutils literal notranslate"><span class="pre">BOOL</span></code>.  That is because these enable variables
take on the string enum values of <code class="docutils literal notranslate"><span class="pre">&quot;ON&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;OFF&quot;</span></code>, end empty <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.  An
empty enable means that the TriBITS dependency system is allowed to decide if
an enable should be turned on or off based on various logic.  The CMake GUI
will enforce the values of <code class="docutils literal notranslate"><span class="pre">&quot;ON&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;OFF&quot;</span></code>, and empty <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> but it will
not enforce this if you set the value on the command line or in a set()
statement in an input <code class="docutils literal notranslate"><span class="pre">`*.cmake</span></code> options files.  However, setting
<code class="docutils literal notranslate"><span class="pre">-DXXX_ENABLE_YYY=TRUE</span></code> and <code class="docutils literal notranslate"><span class="pre">-DXXX_ENABLE_YYY=FALSE</span></code> is allowed and will
be interpreted correctly..</p>
</div>
<div class="section" id="enable-or-disable-tests-for-specific-packages">
<h3><a class="toc-backref" href="#id16"><span class="sectnum">4.3.4</span> Enable or disable tests for specific packages</a><a class="headerlink" href="#enable-or-disable-tests-for-specific-packages" title="Permalink to this headline">¶</a></h3>
<p>The enable tests for explicitly enabled packages, configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_</span><span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE_1</span><span class="o">&gt;=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_</span><span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE_2</span><span class="o">&gt;=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_TESTS</span><span class="o">=</span><span class="n">ON</span> \
</pre></div>
</div>
<p>This will result in the enable of the test suites for any package that
explicitly enabled with <code class="docutils literal notranslate"><span class="pre">-D</span> <span class="pre">&lt;Project&gt;_ENABLE_&lt;TRIBITS_PACKAGE&gt;=ON</span></code>.  Note
that his will <strong>not</strong> result in the enable of the test suites for any packages
that may only be implicitly enabled in order to build the explicitly enabled
packages.</p>
<p id="tribits-package-enable-tests">If one wants to enable a package along with the enable of other packages, but
not the test suite for that package, then when can disable the tests for that
package by configuring with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_</span><span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE_1</span><span class="o">&gt;=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_</span><span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE_2</span><span class="o">&gt;=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_</span><span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE_3</span><span class="o">&gt;=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_TESTS</span><span class="o">=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE_2</span><span class="o">&gt;</span><span class="n">_ENABLE_TESTS</span><span class="o">=</span><span class="n">OFF</span> \
</pre></div>
</div>
<p>The above will enable the package test suites for <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKGE_1&gt;</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKGE_3&gt;</span></code> but <strong>not</strong> for <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE_2&gt;</span></code> (or any other
packages that might get implicitly enabled).  One might use this if one wants
to build and install package <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE_2&gt;</span></code> but does not want to
build and run the test suite for that package.</p>
<p>These and other options give the user complete control of what packages get
enabled or disabled and what package test suites are enabled or disabled.</p>
</div>
<div class="section" id="enable-to-test-all-effects-of-changing-a-given-package-s">
<h3><a class="toc-backref" href="#id17"><span class="sectnum">4.3.5</span> Enable to test all effects of changing a given package(s)</a><a class="headerlink" href="#enable-to-test-all-effects-of-changing-a-given-package-s" title="Permalink to this headline">¶</a></h3>
<p>To enable an SE package <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> to test it and all of its
down-stream packages, configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_</span><span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_ALL_FORWARD_DEP_PACKAGES</span><span class="o">=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_TESTS</span><span class="o">=</span><span class="n">ON</span> \
</pre></div>
</div>
<p>The above set of arguments will result in package <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> and
all packages that depend on <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> to be enabled and have all
of their tests turned on.  Tests will not be enabled in packages that do not
depend on <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> in this case.  This speeds up and robustifies
pre-push testing.</p>
</div>
<div class="section" id="enable-all-packages-and-optionally-all-tests">
<h3><a class="toc-backref" href="#id18"><span class="sectnum">4.3.6</span> Enable all packages (and optionally all tests)</a><a class="headerlink" href="#enable-all-packages-and-optionally-all-tests" title="Permalink to this headline">¶</a></h3>
<p>To enable all defined packages and subpakages add the configure option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_ALL_PACKAGES</span><span class="o">=</span><span class="n">ON</span> \
</pre></div>
</div>
<p>To also optionally enable the tests and examples in all of those enabled
packages, add the configure option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_TESTS</span><span class="o">=</span><span class="n">ON</span> \
</pre></div>
</div>
<p>Specific packages can be disabled (i.e. “black-listed”) by adding
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_&lt;TRIBITS_PACKAGE&gt;=OFF</span></code>.  This will also disable all
packages that depend on <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code>.</p>
<p>Note, all examples are also enabled by default when setting
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_TESTS=ON</span></code> (and so examples are considered a subset of the
tests).</p>
<p>By default, setting <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_ALL_PACKAGES=ON</span></code> only enables primary
tested (PT) packages and code.  To have this also enable all secondary tested
(ST) packages and ST code in PT packages code, one must also set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_SECONDARY_TESTED_CODE</span><span class="o">=</span><span class="n">ON</span> \
</pre></div>
</div>
<p>NOTE: If this project is a “meta-project”, then
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_ALL_PACKAGES=ON</span></code> may not enable <em>all</em> the SE packages but
only the project’s primary meta-project packages.  See <a class="reference external" href="TribitsUsersGuide.html#package-dependencies-and-enable-disable-logic">Package Dependencies
and Enable/Disable Logic</a> and <a class="reference external" href="TribitsUsersGuide.html#tribits-dependency-handling-behaviors">TriBITS Dependency Handling Behaviors</a> for
details.</p>
</div>
<div class="section" id="disable-a-package-and-all-its-dependencies">
<h3><a class="toc-backref" href="#id19"><span class="sectnum">4.3.7</span> Disable a package and all its dependencies</a><a class="headerlink" href="#disable-a-package-and-all-its-dependencies" title="Permalink to this headline">¶</a></h3>
<p>To disable an SE package and all of the packages that depend on it, add the
configure options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_</span><span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;=</span><span class="n">OFF</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_</span><span class="o">&lt;</span><span class="n">PACKAGE_A</span><span class="o">&gt;=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_ALL_OPTIONAL_PACKAGES</span><span class="o">=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_</span><span class="o">&lt;</span><span class="n">PACKAGE_B</span><span class="o">&gt;=</span><span class="n">ON</span> \
</pre></div>
</div>
<p>will enable <code class="docutils literal notranslate"><span class="pre">&lt;PACKAGE_A&gt;</span></code> and all of the packages that it depends on except
for <code class="docutils literal notranslate"><span class="pre">&lt;PACKAGE_B&gt;</span></code> and all of its forward dependencies.</p>
<p>If a TriBITS package <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> has subpackages (e.g. <code class="docutils literal notranslate"><span class="pre">&lt;A&gt;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&lt;B&gt;</span></code>, etc.), then disabling the package is equivalent to setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_</span><span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;&lt;</span><span class="n">A</span><span class="o">&gt;=</span><span class="n">OFF</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_</span><span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;&lt;</span><span class="n">B</span><span class="o">&gt;=</span><span class="n">OFF</span> \
<span class="o">...</span>
</pre></div>
</div>
<p>The disable of the subpackage is this case will override any enables.</p>
<p>If a disabled package is a required dependency of some explicitly enabled
downstream package, then the configure will error out if
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_DISABLE_ENABLED_FORWARD_DEP_PACKAGES=OFF</span></code>.  Otherwise, a WARNING
will be printed and the downstream package will be disabled and configuration
will continue.</p>
</div>
<div class="section" id="remove-all-package-enables-in-the-cache">
<h3><a class="toc-backref" href="#id20"><span class="sectnum">4.3.8</span> Remove all package enables in the cache</a><a class="headerlink" href="#remove-all-package-enables-in-the-cache" title="Permalink to this headline">¶</a></h3>
<p>To wipe the set of package enables in the <code class="docutils literal notranslate"><span class="pre">CMakeCache.txt</span></code> file so they can
be reset again from scratch, configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./-do-confiugre -D &lt;Project&gt;_UNENABLE_ENABLED_PACKAGES=TRUE
</pre></div>
</div>
<p>This option will set to empty ‘’ all package enables, leaving all other cache
variables as they are.  You can then reconfigure with a new set of package
enables for a different set of packages.  This allows you to avoid more
expensive configure time checks and to preserve other cache variables that you
have set and don’t want to loose.  For example, one would want to do this to
avoid compiler and TPL checks.</p>
</div>
</div>
<div class="section" id="selecting-compiler-and-linker-options">
<h2><a class="toc-backref" href="#id21"><span class="sectnum">4.4</span> Selecting compiler and linker options</a><a class="headerlink" href="#selecting-compiler-and-linker-options" title="Permalink to this headline">¶</a></h2>
<p>The compilers for C, C++, and Fortran will be found by default by CMake if
they are not otherwise specified as described below (see standard CMake
documentation for how default compilers are found).  The most direct way to
set the compilers are to set the CMake cache variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_</span><span class="o">&lt;</span><span class="n">LANG</span><span class="o">&gt;</span><span class="n">_COMPILER</span><span class="o">=&lt;</span><span class="n">path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">compiler</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The path to the compiler can be just a name of the compiler
(e.g. <code class="docutils literal notranslate"><span class="pre">-DCMAKE_C_COMPILER=gcc</span></code>) or can be an absolute path
(e.g. <code class="docutils literal notranslate"><span class="pre">-DCMAKE_C_COMPILER=/usr/local/bin/cc</span></code>).  The safest and more direct
approach to determine the compilers is to set the absolute paths using, for
example, the cache variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_C_COMPILER</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">my_install</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">gcc</span> \
<span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_CXX_COMPILER</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">my_install</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">g</span><span class="o">++</span> \
<span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_Fortran_COMPILER</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">my_install</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">gfortran</span>
</pre></div>
</div>
<p>or if <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_MPI=ON</span></code> (see <a class="reference internal" href="#configuring-with-mpi-support">Configuring with MPI support</a>) something
like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_C_COMPILER</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">my_install</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">mpicc</span> \
<span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_CXX_COMPILER</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">my_install</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">mpicxx</span> \
<span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_Fortran_COMPILER</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">my_install</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">mpif90</span>
</pre></div>
</div>
<p>If these the CMake cache variables are not set, then CMake will use the
compilers specified in the environment variables <code class="docutils literal notranslate"><span class="pre">CC</span></code>, <code class="docutils literal notranslate"><span class="pre">CXX</span></code>, and <code class="docutils literal notranslate"><span class="pre">FC</span></code>
for C, C++ and Fortran, respectively.  If one needs to drill down through
different layers of scripts, then it can be useful to set the compilers using
these environment variables.  But in general is it recommended to be explicit
and use the above CMake cache variables to set the absolute path to the
compilers to remove all ambiguity.</p>
<p>If absolute paths to the compilers are not specified using the CMake cache
variables or the environment variables as described above, then in MPI mode
(i.e. <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_MPI=ON</span></code>) TriBITS performs its own search for the MPI
compiler wrappers that will find the correct compilers for most MPI
distributions (see <a class="reference internal" href="#configuring-with-mpi-support">Configuring with MPI support</a>).  However, if in serial
mode (i.e. <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_MPI=OFF</span></code>), then CMake will do its own default
compiler search.  The algorithm by which raw CMake finds these compilers is
not precisely documented (and seems to change based on the platform).
However, on Linux systems, the observed algorithm appears to be:</p>
<ol class="arabic simple">
<li><p>Search for the C compiler first by looking in <code class="docutils literal notranslate"><span class="pre">PATH</span></code> (or the equivalent
on Windows), starting with a compiler with the name <code class="docutils literal notranslate"><span class="pre">cc</span></code> and then moving
on to other names like <code class="docutils literal notranslate"><span class="pre">gcc</span></code>, etc.  This first compiler found is set to
<code class="docutils literal notranslate"><span class="pre">CMAKE_C_COMPILER</span></code>.</p></li>
<li><p>Search for the C++ compiler with names like <code class="docutils literal notranslate"><span class="pre">c++</span></code>, <code class="docutils literal notranslate"><span class="pre">g++</span></code>, etc., but
restrict the search to the same directory specified by base path to the C
compiler given in the variable <code class="docutils literal notranslate"><span class="pre">CMAKE_C_COMPILER</span></code>.  The first compiler
that is found is set to <code class="docutils literal notranslate"><span class="pre">CMAKE_CXX_COMPILER</span></code>.</p></li>
<li><p>Search for the Fortran compiler with names like <code class="docutils literal notranslate"><span class="pre">f90</span></code>, <code class="docutils literal notranslate"><span class="pre">gfortran</span></code>,
etc., but restrict the search to the same directory specified by base path
to the C compiler given in the variable <code class="docutils literal notranslate"><span class="pre">CMAKE_C_COMPILER</span></code>.  The first
compiler that is found is set to <code class="docutils literal notranslate"><span class="pre">CMAKE_Fortran_COMPILER</span></code>.</p></li>
</ol>
<p><strong>WARNING:</strong> While this built-in CMake compiler search algorithm may seems
reasonable, it fails to find the correct compilers in many cases for a non-MPI
serial build.  For example, if a newer version of GCC is installed and is put
first in <code class="docutils literal notranslate"><span class="pre">PATH</span></code>, then CMake will fail to find the updated <code class="docutils literal notranslate"><span class="pre">gcc</span></code> compiler
and will instead find the default system <code class="docutils literal notranslate"><span class="pre">cc</span></code> compiler (usually under
<code class="docutils literal notranslate"><span class="pre">/usr/bin/cc</span></code> on Linux may systems) and will then only look for the C++ and
Fortran compilers under that directory.  This will fail to find the correct
updated compilers because GCC does not install a C compiler named <code class="docutils literal notranslate"><span class="pre">cc</span></code>!
Therefore, if you want to use the default CMake compiler search to find the
updated GCC compilers, you can set the CMake cache variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_C_COMPILER</span><span class="o">=</span><span class="n">gcc</span>
</pre></div>
</div>
<p>or can set the environment variable <code class="docutils literal notranslate"><span class="pre">CC=gcc</span></code>.  Either one of these will
result in CMake finding the updated GCC compilers found first in <code class="docutils literal notranslate"><span class="pre">PATH</span></code>.</p>
<p>Once one has specified the compilers, one can also set the compiler flags, but
the way that CMake does this is a little surprising to many people.  But the
&lt;Project&gt; TriBITS CMake build system offers the ability to tweak the built-in
CMake approach for setting compiler flags.  First some background is in order.
When CMake creates the object file build command for a given source file, it
passes in flags to the compiler in the order:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${CMAKE_&lt;LANG&gt;_FLAGS}  ${CMAKE_&lt;LANG&gt;_FLAGS_&lt;CMAKE_BUILD_TYPE&gt;}
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;LANG&gt;</span></code> = <code class="docutils literal notranslate"><span class="pre">C</span></code>, <code class="docutils literal notranslate"><span class="pre">CXX</span></code>, or <code class="docutils literal notranslate"><span class="pre">Fortran</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;CMAKE_BUILD_TYPE&gt;</span></code> =
<code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> or <code class="docutils literal notranslate"><span class="pre">RELEASE</span></code>.  Note that the options in
<code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS_&lt;CMAKE_BUILD_TYPE&gt;</span></code> come after and override those in
<code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS</span></code>!  The flags in <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS</span></code> apply to all
build types.  Optimization, debug, and other build-type-specific flags are set
in <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS_&lt;CMAKE_BUILD_TYPE&gt;</span></code>.  CMake automatically provides a
default set of debug and release optimization flags for
<code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS_&lt;CMAKE_BUILD_TYPE&gt;</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">CMAKE_CXX_FLAGS_DEBUG</span></code> is
typically <code class="docutils literal notranslate"><span class="pre">&quot;-g</span> <span class="pre">-O0&quot;</span></code> while <code class="docutils literal notranslate"><span class="pre">CMAKE_CXX_FLAGS_RELEASE</span></code> is typically
<code class="docutils literal notranslate"><span class="pre">&quot;-O3&quot;</span></code>).  This means that if you try to set the optimization level with
<code class="docutils literal notranslate"><span class="pre">-DCMAKE_CXX_FLAGS=&quot;-04&quot;</span></code>, then this level gets overridden by the flags
specified in <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS_BUILD</span></code> or <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS_RELEASE</span></code>.</p>
<p>TriBITS will set defaults for <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS</span></code> and
<code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS_&lt;CMAKE_BUILD_TYPE&gt;</span></code>, which may be different that what
raw CMake would set.  TriBITS provides a means for project and package
developers and users to set and override these compiler flag variables
globally and on a package-by-package basis.  Below, the facilities for
manipulating compiler flags is described.</p>
<p>To see that the full set of compiler flags one has to actually build a target
by running, for example, <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">VERBOSE=1</span> <span class="pre">&lt;target_name&gt;</span></code> (see <a class="reference internal" href="#building-with-verbose-output-without-reconfiguring">Building with
verbose output without reconfiguring</a>).  (NOTE: One can also see the exact
set of flags used for each target in the generated <code class="docutils literal notranslate"><span class="pre">build.ninja</span></code> file when
using the Ninja generator.) One cannot just look at the cache variables for
<code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS</span></code> and <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS_&lt;CMAKE_BUILD_TYPE&gt;</span></code> in the
file <code class="docutils literal notranslate"><span class="pre">CMakeCache.txt</span></code> and see the full set of flags are actually being used.
These variables can override the cache variables by TriBITS as project-level
local non-cache variables as described below (see <a class="reference internal" href="#overriding-cmake-build-type-debug-release-compiler-options">Overriding CMAKE_BUILD_TYPE
debug/release compiler options</a>).</p>
<p>The &lt;Project&gt; TriBITS CMake build system will set up default compile flags for
GCC (‘GNU’) in development mode
(i.e. <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_DEVELOPMENT_MODE=ON</span></code>) on order to help produce
portable code.  These flags set up strong warning options and enforce language
standards.  In release mode (i.e. <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_DEVELOPMENT_MODE=OFF</span></code>),
these flags are not set.  These flags get set internally into the variables
<code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS</span></code> (when processing packages, not at the global cache
variable level) but the user can append flags that override these as described
below.</p>
<div class="section" id="configuring-to-build-with-default-debug-or-release-compiler-flags">
<h3><a class="toc-backref" href="#id22"><span class="sectnum">4.4.1</span> Configuring to build with default debug or release compiler flags</a><a class="headerlink" href="#configuring-to-build-with-default-debug-or-release-compiler-flags" title="Permalink to this headline">¶</a></h3>
<p id="cmake-build-type">To build a debug version, pass into ‘cmake’:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_BUILD_TYPE</span><span class="o">=</span><span class="n">DEBUG</span>
</pre></div>
</div>
<p>This will result in debug flags getting passed to the compiler according to
what is set in <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS_DEBUG</span></code>.</p>
<p>To build a release (optimized) version, pass into ‘cmake’:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_BUILD_TYPE</span><span class="o">=</span><span class="n">RELEASE</span>
</pre></div>
</div>
<p>This will result in optimized flags getting passed to the compiler according
to what is in <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS_RELEASE</span></code>.</p>
<p>The default build type is typically <code class="docutils literal notranslate"><span class="pre">CMAKE_BUILD_TYPE=RELEASE</span></code> unless <code class="docutils literal notranslate"><span class="pre">-D</span>
<span class="pre">USE_XSDK_DEFAULTS=TRUE</span></code> is set in which case the default build type is
<code class="docutils literal notranslate"><span class="pre">CMAKE_BUILD_TYPE=DEBUG</span></code> as per the xSDK configure standard.</p>
</div>
<div class="section" id="adding-arbitrary-compiler-flags-but-keeping-default-build-type-flags">
<h3><a class="toc-backref" href="#id23"><span class="sectnum">4.4.2</span> Adding arbitrary compiler flags but keeping default build-type flags</a><a class="headerlink" href="#adding-arbitrary-compiler-flags-but-keeping-default-build-type-flags" title="Permalink to this headline">¶</a></h3>
<p>To append arbitrary compiler flags to <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS</span></code> (which may be
set internally by TriBITS) that apply to all build types, configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_</span><span class="o">&lt;</span><span class="n">LANG</span><span class="o">&gt;</span><span class="n">_FLAGS</span><span class="o">=</span><span class="s2">&quot;&lt;EXTRA_COMPILER_OPTIONS&gt;&quot;</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;EXTRA_COMPILER_OPTIONS&gt;</span></code> are your extra compiler options like
<code class="docutils literal notranslate"><span class="pre">&quot;-DSOME_MACRO_TO_DEFINE</span> <span class="pre">-funroll-loops&quot;</span></code>.  These options will get
appended to (i.e. come after) other internally defined compiler option and
therefore override them.  The options are then pass to the compiler in the
order:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;DEFAULT_TRIBITS_LANG_FLAGS&gt; &lt;EXTRA_COMPILER_OPTIONS&gt; \
  ${CMAKE_&lt;LANG&gt;_FLAGS_&lt;CMAKE_BUILD_TYPE&gt;}
</pre></div>
</div>
<p>This that setting <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS</span></code> can override the default flags that
TriBITS will set for <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS</span></code> but will <strong>not</strong> override flags
specified in <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS_&lt;CMAKE_BUILD_TYPE&gt;</span></code>.</p>
<p>Instead of directly setting the CMake cache variables <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS</span></code>
one can instead set environment variables <code class="docutils literal notranslate"><span class="pre">CFLAGS</span></code>, <code class="docutils literal notranslate"><span class="pre">CXXFLAGS</span></code> and
<code class="docutils literal notranslate"><span class="pre">FFLAGS</span></code> for <code class="docutils literal notranslate"><span class="pre">CMAKE_C_FLAGS</span></code>, <code class="docutils literal notranslate"><span class="pre">CMAKE_CXX_FLAGS</span></code> and
<code class="docutils literal notranslate"><span class="pre">CMAKE_Fortran_FLAGS</span></code>, respectively.</p>
<p>In addition, if <code class="docutils literal notranslate"><span class="pre">-DUSE_XSDK_DEFAULTS=TRUE</span></code> is set, then one can also pass
in Fortran flags using the environment variable <code class="docutils literal notranslate"><span class="pre">FCFLAGS</span></code> (raw CMake does
not recognize <code class="docutils literal notranslate"><span class="pre">FCFLAGS</span></code>).  But if <code class="docutils literal notranslate"><span class="pre">FFLAGS</span></code> and <code class="docutils literal notranslate"><span class="pre">FCFLAGS</span></code> are both set,
then they must be the same or a configure error will occur.</p>
<p>Options can also be targeted to a specific TriBITS package using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">LANG</span><span class="o">&gt;</span><span class="n">_FLAGS</span><span class="o">=</span><span class="s2">&quot;&lt;EXTRA_COMPILER_OPTIONS&gt;&quot;</span>
</pre></div>
</div>
<p>The package-specific options get appended to those already in
<code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS</span></code> and therefore override (but not replace) those set
globally in <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS</span></code> (either internally or by the user in the
cache).</p>
<p>NOTES:</p>
<p>1) Setting <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS</span></code> will override but will not replace any
other internally set flags in <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS</span></code> defined by the
&lt;Project&gt; CMake system because these flags will come after those set
internally.  To get rid of these project/TriBITS default flags, see below.</p>
<p>2) Given that CMake passes in flags in
<code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS_&lt;CMAKE_BUILD_TYPE&gt;</span></code> after those in
<code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS</span></code> means that users setting the <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS</span></code>
and <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;_&lt;LANG&gt;_FLAGS</span></code> will <strong>not</strong> override the flags in
<code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS_&lt;CMAKE_BUILD_TYPE&gt;</span></code> which come after on the compile
line.  Therefore, setting <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;_&lt;LANG&gt;_FLAGS</span></code> should only be used for options that will
not get overridden by the debug or release compiler flags in
<code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS_&lt;CMAKE_BUILD_TYPE&gt;</span></code>.  However, setting
<code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS</span></code> will work well for adding extra compiler defines
(e.g. -DSOMETHING) for example.</p>
<p>WARNING: Any options that you set through the cache variable
<code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS_&lt;CMAKE_BUILD_TYPE&gt;</span></code> will get overridden in the
&lt;Project&gt; CMake system for GNU compilers in development mode so don’t try to
manually set <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS_&lt;CMAKE_BUILD_TYPE&gt;</span></code> directly!  To
override those options, see
<code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS_&lt;CMAKE_BUILD_TYPE&gt;_OVERRIDE</span></code> below.</p>
</div>
<div class="section" id="overriding-cmake-build-type-debug-release-compiler-options">
<h3><a class="toc-backref" href="#id24"><span class="sectnum">4.4.3</span> Overriding CMAKE_BUILD_TYPE debug/release compiler options</a><a class="headerlink" href="#overriding-cmake-build-type-debug-release-compiler-options" title="Permalink to this headline">¶</a></h3>
<p>To override the default CMake-set options in
<code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS_&lt;CMAKE_BUILD_TYPE&gt;</span></code>, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_</span><span class="o">&lt;</span><span class="n">LANG</span><span class="o">&gt;</span><span class="n">_FLAGS_</span><span class="o">&lt;</span><span class="n">CMAKE_BUILD_TYPE</span><span class="o">&gt;</span><span class="n">_OVERRIDE</span><span class="o">=</span><span class="s2">&quot;&lt;OPTIONS_TO_OVERRIDE&gt;&quot;</span>
</pre></div>
</div>
<p>For example, to default debug options use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_C_FLAGS_DEBUG_OVERRIDE</span><span class="o">=</span><span class="s2">&quot;-g -O1&quot;</span> \
<span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_CXX_FLAGS_DEBUG_OVERRIDE</span><span class="o">=</span><span class="s2">&quot;-g -O1&quot;</span>
<span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_Fortran_FLAGS_DEBUG_OVERRIDE</span><span class="o">=</span><span class="s2">&quot;-g -O1&quot;</span>
</pre></div>
</div>
<p>and to override default release options use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_C_FLAGS_RELEASE_OVERRIDE</span><span class="o">=</span><span class="s2">&quot;-O3 -funroll-loops&quot;</span> \
<span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_CXX_FLAGS_RELEASE_OVERRIDE</span><span class="o">=</span><span class="s2">&quot;-03 -funroll-loops&quot;</span>
<span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_Fortran_FLAGS_RELEASE_OVERRIDE</span><span class="o">=</span><span class="s2">&quot;-03 -funroll-loops&quot;</span>
</pre></div>
</div>
<p>NOTES: The TriBITS CMake cache variable
<code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS_&lt;CMAKE_BUILD_TYPE&gt;_OVERRIDE</span></code> is used and not
<code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS_&lt;CMAKE_BUILD_TYPE&gt;</span></code> because is given a default
internally by CMake and the new variable is needed to make the override
explicit.</p>
</div>
<div class="section" id="appending-arbitrary-libraries-and-link-flags-every-executable">
<h3><a class="toc-backref" href="#id25"><span class="sectnum">4.4.4</span> Appending arbitrary libraries and link flags every executable</a><a class="headerlink" href="#appending-arbitrary-libraries-and-link-flags-every-executable" title="Permalink to this headline">¶</a></h3>
<p>In order to append any set of arbitrary libraries and link flags to your
executables use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_EXTRA_LINK_FLAGS</span><span class="o">=</span><span class="s2">&quot;&lt;EXTRA_LINK_LIBRARIES&gt;&quot;</span> \
<span class="o">-</span><span class="n">DCMAKE_EXE_LINKER_FLAGS</span><span class="o">=</span><span class="s2">&quot;&lt;EXTRA_LINK_FLAGG&gt;&quot;</span>
</pre></div>
</div>
<p>Above, you can pass any type of library and they will always be the last
libraries listed, even after all of the TPLs.</p>
<p>NOTE: This is how you must set extra libraries like Fortran libraries and
MPI libraries (when using raw compilers).  Please only use this variable
as a last resort.</p>
<p>NOTE: You must only pass in libraries in <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_EXTRA_LINK_FLAGS</span></code> and
<em>not</em> arbitrary linker flags.  To pass in extra linker flags that are not
libraries, use the built-in CMake variable <code class="docutils literal notranslate"><span class="pre">CMAKE_EXE_LINKER_FLAGS</span></code>
instead.  The TriBITS variable <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_EXTRA_LINK_FLAGS</span></code> is badly named
in this respect but the name remains due to backward compatibility
requirements.</p>
</div>
<div class="section" id="turning-off-strong-warnings-for-individual-packages">
<h3><a class="toc-backref" href="#id26"><span class="sectnum">4.4.5</span> Turning off strong warnings for individual packages</a><a class="headerlink" href="#turning-off-strong-warnings-for-individual-packages" title="Permalink to this headline">¶</a></h3>
<p id="tribits-package-disable-strong-warnings">To turn off strong warnings (for all languages) for a given TriBITS package,
set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;</span><span class="n">_DISABLE_STRONG_WARNINGS</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>This will only affect the compilation of the sources for
<code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGES&gt;</span></code>, not warnings generated from the header files in
downstream packages or client code.</p>
<p>Note that strong warnings are only enabled by default in development mode
(<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_DEVELOPMENT_MODE==ON</span></code>) but not release mode
(<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_DEVELOPMENT_MODE==ON</span></code>).  A release of &lt;Project&gt; should
therefore not have strong warning options enabled.</p>
</div>
<div class="section" id="overriding-all-strong-warnings-and-debug-release-compiler-options">
<h3><a class="toc-backref" href="#id27"><span class="sectnum">4.4.6</span> Overriding all (strong warnings and debug/release) compiler options</a><a class="headerlink" href="#overriding-all-strong-warnings-and-debug-release-compiler-options" title="Permalink to this headline">¶</a></h3>
<p>To override all compiler options, including both strong warning options
and debug/release options, configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_C_FLAGS</span><span class="o">=</span><span class="s2">&quot;-O3 -funroll-loops&quot;</span> \
<span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_CXX_FLAGS</span><span class="o">=</span><span class="s2">&quot;-03 -fexceptions&quot;</span> \
<span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_BUILD_TYPE</span><span class="o">=</span><span class="n">NONE</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_STRONG_C_COMPILE_WARNINGS</span><span class="o">=</span><span class="n">OFF</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_STRONG_CXX_COMPILE_WARNINGS</span><span class="o">=</span><span class="n">OFF</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_SHADOW_WARNINGS</span><span class="o">=</span><span class="n">OFF</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_COVERAGE_TESTING</span><span class="o">=</span><span class="n">OFF</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_CHECKED_STL</span><span class="o">=</span><span class="n">OFF</span> \
</pre></div>
</div>
<p>NOTE: Options like <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_SHADOW_WARNINGS</span></code>,
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_COVERAGE_TESTING</span></code>, and <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_CHECKED_STL</span></code>
do not need to be turned off by default but they are shown above to make it
clear what other CMake cache variables can add compiler and link arguments.</p>
<p>NOTE: By setting <code class="docutils literal notranslate"><span class="pre">CMAKE_BUILD_TYPE=NONE</span></code>, then <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS_NONE</span></code>
will be empty and therefore the options set in <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS</span></code> will
be all that is passed in.</p>
</div>
<div class="section" id="enable-and-disable-shadowing-warnings-for-all-project-packages">
<h3><a class="toc-backref" href="#id28"><span class="sectnum">4.4.7</span> Enable and disable shadowing warnings for all &lt;Project&gt; packages</a><a class="headerlink" href="#enable-and-disable-shadowing-warnings-for-all-project-packages" title="Permalink to this headline">¶</a></h3>
<p>To enable shadowing warnings for all &lt;Project&gt; packages (that don’t already
have them turned on) then use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_SHADOW_WARNINGS</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>To disable shadowing warnings for all &lt;Project&gt; packages (even those that
have them turned on by default) then use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_SHADOW_WARNINGS</span><span class="o">=</span><span class="n">OFF</span>
</pre></div>
</div>
<p>NOTE: The default value is empty ‘’ which lets each &lt;Project&gt; package
decide for itself if shadowing warnings will be turned on or off for that
package.</p>
</div>
<div class="section" id="removing-warnings-as-errors-for-cleaned-packages">
<h3><a class="toc-backref" href="#id29"><span class="sectnum">4.4.8</span> Removing warnings as errors for CLEANED packages</a><a class="headerlink" href="#removing-warnings-as-errors-for-cleaned-packages" title="Permalink to this headline">¶</a></h3>
<p>To remove the <code class="docutils literal notranslate"><span class="pre">-Werror</span></code> flag (or some other flag that is set) from being
applied to compile CLEANED packages (like the Trilinos package Teuchos), set
the following when configuring:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_WARNINGS_AS_ERRORS_FLAGS</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-debug-symbols-to-the-build">
<h3><a class="toc-backref" href="#id30"><span class="sectnum">4.4.9</span> Adding debug symbols to the build</a><a class="headerlink" href="#adding-debug-symbols-to-the-build" title="Permalink to this headline">¶</a></h3>
<p>To get the compiler to add debug symbols to the build, configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_DEBUG_SYMBOLS</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>This will add <code class="docutils literal notranslate"><span class="pre">-g</span></code> on most compilers.  NOTE: One does <strong>not</strong> generally
need to create a fully debug build to get debug symbols on most compilers.</p>
</div>
</div>
<div class="section" id="enabling-support-for-ninja">
<h2><a class="toc-backref" href="#id31"><span class="sectnum">4.5</span> Enabling support for Ninja</a><a class="headerlink" href="#enabling-support-for-ninja" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://ninja-build.org">Ninja</a> build tool can be used as the back-end build tool instead of
Makefiles by adding:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">GNinja</span>
</pre></div>
</div>
<p>to the CMake configure line (the default on most Linux and OSX platforms is
<code class="docutils literal notranslate"><span class="pre">-G&quot;Unix</span> <span class="pre">Makefiles&quot;</span></code>).  This instructs CMake to create the back-end
<code class="docutils literal notranslate"><span class="pre">ninja</span></code> build files instead of back-end Makefiles (see <a class="reference internal" href="#building-ninja-generator">Building (Ninja
generator)</a>).</p>
<p id="project-write-ninja-makefiles">In addition, the TriBITS build system will, by default, generate Makefiles in
every binary directory where there is a CMakeLists.txt file in the source
tree.  These Makefiles have targets scoped to that subdirectory that use
<code class="docutils literal notranslate"><span class="pre">ninja</span></code> to build targets in that subdirectory just like with the native
CMake recursive <code class="docutils literal notranslate"><span class="pre">-G</span> <span class="pre">&quot;Unix</span> <span class="pre">Makefiles&quot;</span></code> generator.  This allows one to <code class="docutils literal notranslate"><span class="pre">cd</span></code>
into any binary directory and type <code class="docutils literal notranslate"><span class="pre">make</span></code> to build just the targets in that
directory.  These TriBITS-generated Ninja makefiles also support <code class="docutils literal notranslate"><span class="pre">help</span></code> and
<code class="docutils literal notranslate"><span class="pre">help-objects</span></code> targets making it easy to build individual executables,
libraries and object files in any binary subdirectory.</p>
<p><strong>WARNING:</strong> Using <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">-j&lt;N&gt;</span></code> with these TriBITS-generated Ninja Makefiles
will <strong>not</strong> result in using <code class="docutils literal notranslate"><span class="pre">&lt;N&gt;</span></code> processes to build in parallel and will
instead use <strong>all</strong> of the free cores to build on the machine!  To control the
number of processes used, run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">NP=&lt;N&gt;</span></code> instead!  See <a class="reference internal" href="#building-in-parallel-with-ninja">Building in
parallel with Ninja</a>.</p>
<p>The generation of these Ninja makefiles can be disabled by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_WRITE_NINJA_MAKEFILES</span><span class="o">=</span><span class="n">OFF</span>
</pre></div>
</div>
<p>(But these Ninja Makefiles get created very quickly even for a very large
CMake project so there is usually little reason to not generate them.)</p>
</div>
<div class="section" id="limiting-parallel-compile-and-link-jobs-for-ninja-builds">
<h2><a class="toc-backref" href="#id32"><span class="sectnum">4.6</span> Limiting parallel compile and link jobs for Ninja builds</a><a class="headerlink" href="#limiting-parallel-compile-and-link-jobs-for-ninja-builds" title="Permalink to this headline">¶</a></h2>
<p>When the CMake generator Ninja is used (i.e. <code class="docutils literal notranslate"><span class="pre">-GNinja</span></code>), one can limit the
number of parallel jobs that are used for compiling object files by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_PARALLEL_COMPILE_JOBS_LIMIT</span><span class="o">=&lt;</span><span class="n">N</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>and/or limit the number of parallel jobs that are used for linking libraries
and executables by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_PARALLEL_LINK_JOBS_LIMIT</span><span class="o">=&lt;</span><span class="n">M</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;N&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;M&gt;</span></code> are integers like <code class="docutils literal notranslate"><span class="pre">20</span></code> and <code class="docutils literal notranslate"><span class="pre">4</span></code>.  If these are
not set, then the number of parallel jobs will be determined by the <code class="docutils literal notranslate"><span class="pre">-j&lt;P&gt;</span></code>
argument passed to <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">-j&lt;P&gt;</span></code> or by ninja automatically according to
machine load when running <code class="docutils literal notranslate"><span class="pre">ninja</span></code>.</p>
<p>Limiting the number of link jobs can be useful, for example, for certain
builds of large projects where linking many jobs in parallel can consume all
of the RAM on a given system and crash the build.</p>
<p>NOTE: These options are ignored when using Makefiles or other CMake
generators.  They only work for the Ninja generator.</p>
</div>
<div class="section" id="disabling-explicit-template-instantiation-for-c">
<h2><a class="toc-backref" href="#id33"><span class="sectnum">4.7</span> Disabling explicit template instantiation for C++</a><a class="headerlink" href="#disabling-explicit-template-instantiation-for-c" title="Permalink to this headline">¶</a></h2>
<p>By default, support for optional explicit template instantiation (ETI) for C++
code is enabled.  To disable support for optional ETI, configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_EXPLICIT_INSTANTIATION</span><span class="o">=</span><span class="n">OFF</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">OFF</span></code>, all packages that have templated C++ code will use implicit
template instantiation (unless they have hard-coded usage of ETI).</p>
<p>ETI can be enabled (<code class="docutils literal notranslate"><span class="pre">ON</span></code>) or disabled (<code class="docutils literal notranslate"><span class="pre">OFF</span></code>) for individual packages
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;</span><span class="n">_ENABLE_EXPLICIT_INSTANTIATION</span><span class="o">=</span><span class="p">[</span><span class="n">ON</span><span class="o">|</span><span class="n">OFF</span><span class="p">]</span>
</pre></div>
</div>
<p>The default value for <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;_ENABLE_EXPLICIT_INSTANTIATION</span></code> is
set by <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_EXPLICIT_INSTANTIATION</span></code>.</p>
<p>For packages that support it, explicit template instantiation can massively
reduce the compile times for the C++ code involved and can even avoid compiler
crashes in some cases.  To see what packages support explicit template
instantiation, just search the CMakeCache.txt file for variables with
<code class="docutils literal notranslate"><span class="pre">ENABLE_EXPLICIT_INSTANTIATION</span></code> in the name.</p>
</div>
<div class="section" id="disabling-the-fortran-compiler-and-all-fortran-code">
<h2><a class="toc-backref" href="#id34"><span class="sectnum">4.8</span> Disabling the Fortran compiler and all Fortran code</a><a class="headerlink" href="#disabling-the-fortran-compiler-and-all-fortran-code" title="Permalink to this headline">¶</a></h2>
<p>To disable the Fortran compiler and all &lt;Project&gt; code that depends on Fortran
set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_Fortran</span><span class="o">=</span><span class="n">OFF</span>
</pre></div>
</div>
<p>NOTE: The Fortran compiler may be disabled automatically by default on systems
like MS Windows.</p>
<p>NOTE: Most Apple Macs do not come with a compatible Fortran compiler by
default so you must turn off Fortran if you don’t have a compatible Fortran
compiler.</p>
</div>
<div class="section" id="enabling-runtime-debug-checking">
<h2><a class="toc-backref" href="#id35"><span class="sectnum">4.9</span> Enabling runtime debug checking</a><a class="headerlink" href="#enabling-runtime-debug-checking" title="Permalink to this headline">¶</a></h2>
<ol class="loweralpha simple">
<li><p>Enabling &lt;Project&gt; ifdefed runtime debug checking:</p></li>
</ol>
<blockquote>
<div><p>To turn on optional ifdefed runtime debug checking, configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_DEBUG</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>This will result in a number of ifdefs to be enabled that will perform a
number of runtime checks.  Nearly all of the debug checks in &lt;Project&gt; will
get turned on by default by setting this option.  This option can be set
independent of <code class="docutils literal notranslate"><span class="pre">CMAKE_BUILD_TYPE</span></code> (which sets the compiler debug/release
options).</p>
<p>NOTES:</p>
<ul class="simple">
<li><p>The variable <code class="docutils literal notranslate"><span class="pre">CMAKE_BUILD_TYPE</span></code> controls what compiler options are
passed to the compiler by default while <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_DEBUG</span></code>
controls what defines are set in config.h files that control ifdefed debug
checks.</p></li>
<li><p>Setting <code class="docutils literal notranslate"><span class="pre">-DCMAKE_BUILD_TYPE=DEBUG</span></code> will automatically set the
default <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_DEBUG=ON</span></code>.</p></li>
</ul>
</div></blockquote>
<ol class="loweralpha simple" start="2">
<li><p>Enabling checked STL implementation:</p></li>
</ol>
<blockquote>
<div><p>To turn on the checked STL implementation set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_CHECKED_STL</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>NOTES:</p>
<ul class="simple">
<li><p>By default, this will set -D_GLIBCXX_DEBUG as a compile option for all C++
code.  This only works with GCC currently.</p></li>
<li><p>This option is disabled by default because to enable it by default can
cause runtime segfaults when linked against C++ code that was compiled
without -D_GLIBCXX_DEBUG.</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="configuring-with-mpi-support">
<h2><a class="toc-backref" href="#id36"><span class="sectnum">4.10</span> Configuring with MPI support</a><a class="headerlink" href="#configuring-with-mpi-support" title="Permalink to this headline">¶</a></h2>
<p>To enable MPI support you must minimally set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">TPL_ENABLE_MPI</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>There is built-in logic to try to find the various MPI components on your
system but you can override (or make suggestions) with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">MPI_BASE_DIR</span><span class="o">=</span><span class="s2">&quot;path&quot;</span>
</pre></div>
</div>
<p>(Base path of a standard MPI installation which has the subdirs ‘bin’, ‘libs’,
‘include’ etc.)</p>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">MPI_BIN_DIR</span><span class="o">=</span><span class="s2">&quot;path1;path2;...;pathn&quot;</span>
</pre></div>
</div>
<p>which sets the paths where the MPI executables (e.g. mpiCC, mpicc, mpirun,
mpiexec) can be found.  By default this is set to <code class="docutils literal notranslate"><span class="pre">${MPI_BASE_DIR}/bin</span></code> if
<code class="docutils literal notranslate"><span class="pre">MPI_BASE_DIR</span></code> is set.</p>
<p><strong>NOTE:</strong> TriBITS uses the MPI compiler wrappers (e.g. mpiCC, mpicc, mpic++,
mpif90, etc.) which is more standard with other builds systems for HPC
computing using MPI (and the way that MPI implementations were meant to be
used).  But directly using the MPI compiler wrappers as the direct compilers
is inconsistent with the way that the standard CMake module <code class="docutils literal notranslate"><span class="pre">FindMPI.cmake</span></code>
which tries to “unwrap” the compiler wrappers and grab out the raw underlying
compilers and the raw compiler and linker command-line arguments.  In this
way, TriBITS is more consistent with standard usage in the HPC community but
is less consistent with CMake (see “HISTORICAL NOTE” below).</p>
<p>There are several different different variations for configuring with MPI
support:</p>
<ol class="loweralpha simple">
<li><p><strong>Configuring build using MPI compiler wrappers:</strong></p></li>
</ol>
<blockquote>
<div><p>The MPI compiler wrappers are turned on by default.  There is built-in logic
in TriBITS that will try to find the right MPI compiler wrappers.  However,
you can specifically select them by setting, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">MPI_C_COMPILER</span><span class="p">:</span><span class="n">FILEPATH</span><span class="o">=</span><span class="n">mpicc</span> \
<span class="o">-</span><span class="n">D</span> <span class="n">MPI_CXX_COMPILER</span><span class="p">:</span><span class="n">FILEPATH</span><span class="o">=</span><span class="n">mpic</span><span class="o">++</span> \
<span class="o">-</span><span class="n">D</span> <span class="n">MPI_Fortan_COMPILER</span><span class="p">:</span><span class="n">FILEPATH</span><span class="o">=</span><span class="n">mpif77</span>
</pre></div>
</div>
<p>which gives the name of the MPI C/C++/Fortran compiler wrapper executable.
In this case, just the names of the programs are given and absolute path of
the executables will be searched for under <code class="docutils literal notranslate"><span class="pre">${MPI_BIN_DIR}/</span></code> if the cache
variable <code class="docutils literal notranslate"><span class="pre">MPI_BIN_DIR</span></code> is set, or in the default path otherwise.  The
found programs will then be used to set the cache variables
<code class="docutils literal notranslate"><span class="pre">CMAKE_[C,CXX,Fortran]_COMPILER</span></code>.</p>
<p>One can avoid the search and just use the absolute paths with, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">MPI_C_COMPILER</span><span class="p">:</span><span class="n">FILEPATH</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">mpich</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">mpicc</span> \
<span class="o">-</span><span class="n">D</span> <span class="n">MPI_CXX_COMPILER</span><span class="p">:</span><span class="n">FILEPATH</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">mpich</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">mpic</span><span class="o">++</span> \
<span class="o">-</span><span class="n">D</span> <span class="n">MPI_Fortan_COMPILER</span><span class="p">:</span><span class="n">FILEPATH</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">mpich</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">mpif77</span>
</pre></div>
</div>
<p>However, you can also directly set the variables
<code class="docutils literal notranslate"><span class="pre">CMAKE_[C,CXX,Fortran]_COMPILER</span></code> with, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_C_COMPILER</span><span class="p">:</span><span class="n">FILEPATH</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">mpich</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">mpicc</span> \
<span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_CXX_COMPILER</span><span class="p">:</span><span class="n">FILEPATH</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">mpich</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">mpic</span><span class="o">++</span> \
<span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_Fortan_COMPILER</span><span class="p">:</span><span class="n">FILEPATH</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">mpich</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">mpif77</span>
</pre></div>
</div>
<p><strong>WARNING:</strong> If you set just the compiler names and not the absolute paths
with <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_COMPILER</span></code> in MPI mode, then a search will not be done
and these will be expected to be in the path at build time. (Note that his
is inconsistent the behavior of raw CMake in non-MPI mode described in
<a class="reference internal" href="#selecting-compiler-and-linker-options">Selecting compiler and linker options</a>).  If both
<code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_COMPILER</span></code> and <code class="docutils literal notranslate"><span class="pre">MPI_&lt;LANG&gt;_COMPILER</span></code> are set, however, then
<code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_COMPILER</span></code> will be used and <code class="docutils literal notranslate"><span class="pre">MPI_&lt;LANG&gt;_COMPILER</span></code> will be
ignored.</p>
<p>Note that when <code class="docutils literal notranslate"><span class="pre">USE_XSDK_DEFAULTS=FALSE</span></code> (see <a class="reference internal" href="#xsdk-configuration-options">xSDK Configuration
Options</a>), then the environment variables <code class="docutils literal notranslate"><span class="pre">CC</span></code>, <code class="docutils literal notranslate"><span class="pre">CXX</span></code> and <code class="docutils literal notranslate"><span class="pre">FC</span></code> are
ignored.  But when <code class="docutils literal notranslate"><span class="pre">USE_XSDK_DEFAULTS=TRUE</span></code> and the CMake cache variables
<code class="docutils literal notranslate"><span class="pre">CMAKE_[C,CXX,Fortran]_COMPILER</span></code> are not set, then the environment
variables <code class="docutils literal notranslate"><span class="pre">CC</span></code>, <code class="docutils literal notranslate"><span class="pre">CXX</span></code> and <code class="docutils literal notranslate"><span class="pre">FC</span></code> will be used for
<code class="docutils literal notranslate"><span class="pre">CMAKE_[C,CXX,Fortran]_COMPILER</span></code>, even if the CMake cache variables
<code class="docutils literal notranslate"><span class="pre">MPI_[C,CXX,Fortran]_COMPILER</span></code> are set!  So if one wants to make sure and
set the MPI compilers irrespective of the xSDK mode, then one should set
cmake cache variables <code class="docutils literal notranslate"><span class="pre">CMAKE_[C,CXX,Fortran]_COMPILER</span></code> to the absolute
path of the MPI compiler wrappers.</p>
<p><strong>HISTORICAL NOTE:</strong> The TriBITS system has its own custom MPI integration
support and does not (currently) use the standard CMake module
<code class="docutils literal notranslate"><span class="pre">FindMPI.cmake</span></code>.  This custom support for MPI was added to TriBITS in 2008
when it was found the built-in <code class="docutils literal notranslate"><span class="pre">FindMPI.cmake</span></code> module was not sufficient
for the needs of Trilinos and the approach taken by the module (still in use
as of CMake 3.4.x) which tries to unwrap the raw compilers and grab the list
of include directories, link libraries, etc, was not sufficiently portable
for the systems where Trilinos needed to be used.  But earlier versions of
TriBITS used the <code class="docutils literal notranslate"><span class="pre">FindMPI.cmake</span></code> module and that is why the CMake cache
variables <code class="docutils literal notranslate"><span class="pre">MPI_[C,CXX,Fortran]_COMPILER</span></code> are defined and still supported.</p>
</div></blockquote>
<ol class="loweralpha simple" start="2">
<li><p><strong>Configuring to build using raw compilers and flags/libraries:</strong></p></li>
</ol>
<blockquote>
<div><p>While using the MPI compiler wrappers as described above is the preferred
way to enable support for MPI, you can also just use the raw compilers and
then pass in all of the other information that will be used to compile and
link your code.</p>
<p>To turn off the MPI compiler wrappers, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">MPI_USE_COMPILER_WRAPPERS</span><span class="o">=</span><span class="n">OFF</span>
</pre></div>
</div>
<p>You will then need to manually pass in the compile and link lines needed to
compile and link MPI programs.  The compile flags can be set through:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_</span><span class="p">[</span><span class="n">C</span><span class="p">,</span><span class="n">CXX</span><span class="p">,</span><span class="n">Fortran</span><span class="p">]</span><span class="n">_FLAGS</span><span class="o">=</span><span class="s2">&quot;$EXTRA_COMPILE_FLAGS&quot;</span>
</pre></div>
</div>
<p>The link and library flags must be set through:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_EXTRA_LINK_FLAGS</span><span class="o">=</span><span class="s2">&quot;$EXTRA_LINK_FLAGS&quot;</span>
</pre></div>
</div>
<p>Above, you can pass any type of library or other linker flags in and they
will always be the last libraries listed, even after all of the TPLs.</p>
<p>NOTE: A good way to determine the extra compile and link flags for MPI is to
use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">EXTRA_COMPILE_FLAGS</span><span class="o">=</span><span class="s2">&quot;`$MPI_BIN_DIR/mpiCC --showme:compile`&quot;</span>

<span class="n">export</span> <span class="n">EXTRA_LINK_FLAGS</span><span class="o">=</span><span class="s2">&quot;`$MPI_BIN_DIR/mpiCC --showme:link`&quot;</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">MPI_BIN_DIR</span></code> is set to your MPI installations binary directory.</p>
</div></blockquote>
<ol class="loweralpha simple" start="3">
<li><p><strong>Setting up to run MPI programs:</strong></p></li>
</ol>
<blockquote>
<div><p>In order to use the ctest program to run MPI tests, you must set the mpi
run command and the options it takes.  The built-in logic will try to find
the right program and options but you will have to override them in many
cases.</p>
<p>MPI test and example executables are passed to CTest <code class="docutils literal notranslate"><span class="pre">add_test()</span></code> as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>add_test(
  ${MPI_EXEC} ${MPI_EXEC_PRE_NUMPROCS_FLAGS}
  ${MPI_EXEC_NUMPROCS_FLAG} &lt;NP&gt;
  ${MPI_EXEC_POST_NUMPROCS_FLAGS}
  &lt;TEST_EXECUTABLE_PATH&gt; &lt;TEST_ARGS&gt; )
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;TEST_EXECUTABLE_PATH&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;TEST_ARGS&gt;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&lt;NP&gt;</span></code> are specific
to the test being run.</p>
<p>The test-independent MPI arguments are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">MPI_EXEC</span><span class="p">:</span><span class="n">FILEPATH</span><span class="o">=</span><span class="s2">&quot;exec_name&quot;</span>
</pre></div>
</div>
<p>(The name of the MPI run command (e.g. mpirun, mpiexec) that is used to run
the MPI program.  This can be just the name of the program in which case
the full path will be looked for in <code class="docutils literal notranslate"><span class="pre">${MPI_BIN_DIR}</span></code> as described above.
If it is an absolute path, it will be used without modification.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">MPI_EXEC_DEFAULT_NUMPROCS</span><span class="o">=</span><span class="mi">4</span>
</pre></div>
</div>
<p>(The default number of processes to use when setting up and running
MPI test and example executables.  The default is set to ‘4’ and only
needs to be changed when needed or desired.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">MPI_EXEC_MAX_NUMPROCS</span><span class="o">=</span><span class="mi">4</span>
</pre></div>
</div>
<p>(The maximum number of processes to allow when setting up and running MPI
tests and examples that use MPI.  The default is set to ‘4’ but should be
set to the largest number that can be tolerated for the given machine or the
most cores on the machine that you want the test suite to be able to use.
Tests and examples that require more processes than this are excluded from
the CTest test suite at configure time.  <code class="docutils literal notranslate"><span class="pre">MPI_EXEC_MAX_NUMPROCS</span></code> is also
used to exclude tests in a non-MPI build (i.e. <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_MPI=OFF</span></code>) if
the number of required cores for a given test is greater than this value.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">MPI_EXEC_NUMPROCS_FLAG</span><span class="o">=-</span><span class="n">np</span>
</pre></div>
</div>
<p>(The command-line option just before the number of processes to use
<code class="docutils literal notranslate"><span class="pre">&lt;NP&gt;</span></code>.  The default value is based on the name of <code class="docutils literal notranslate"><span class="pre">${MPI_EXEC}</span></code>, for
example, which is <code class="docutils literal notranslate"><span class="pre">-np</span></code> for OpenMPI.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">MPI_EXEC_PRE_NUMPROCS_FLAGS</span><span class="o">=</span><span class="s2">&quot;arg1;arg2;...;argn&quot;</span>
</pre></div>
</div>
<p>(Other command-line arguments that must come <em>before</em> the numprocs
argument.  The default is empty “”.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">MPI_EXEC_POST_NUMPROCS_FLAGS</span><span class="o">=</span><span class="s2">&quot;arg1;arg2;...;argn&quot;</span>
</pre></div>
</div>
<p>(Other command-line arguments that must come <em>after</em> the numprocs
argument.  The default is empty “”.)</p>
<p>NOTE: Multiple arguments listed in <code class="docutils literal notranslate"><span class="pre">MPI_EXEC_PRE_NUMPROCS_FLAGS</span></code> and
<code class="docutils literal notranslate"><span class="pre">MPI_EXEC_POST_NUMPROCS_FLAGS</span></code> must be quoted and separated by <code class="docutils literal notranslate"><span class="pre">';'</span></code> as
these variables are interpreted as CMake arrays.</p>
</div></blockquote>
</div>
<div class="section" id="configuring-for-openmp-support">
<h2><a class="toc-backref" href="#id37"><span class="sectnum">4.11</span> Configuring for OpenMP support</a><a class="headerlink" href="#configuring-for-openmp-support" title="Permalink to this headline">¶</a></h2>
<p>To enable OpenMP support, one must set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_OpenMP</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>Note that if you enable OpenMP directly through a compiler option (e.g.,
<code class="docutils literal notranslate"><span class="pre">-fopenmp</span></code>), you will NOT enable OpenMP inside &lt;Project&gt; source code.</p>
<p>To skip adding flags for OpenMP for <code class="docutils literal notranslate"><span class="pre">&lt;LANG&gt;</span></code> = <code class="docutils literal notranslate"><span class="pre">C</span></code>, <code class="docutils literal notranslate"><span class="pre">CXX</span></code>, or
<code class="docutils literal notranslate"><span class="pre">Fortran</span></code>, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">OpenMP_</span><span class="o">&lt;</span><span class="n">LANG</span><span class="o">&gt;</span><span class="n">_FLAGS_OVERRIDE</span><span class="o">=</span><span class="s2">&quot; &quot;</span>
</pre></div>
</div>
<p>The single space ” ” will result in no flags getting added.  This is needed
since one can’t set the flags <code class="docutils literal notranslate"><span class="pre">OpenMP_&lt;LANG&gt;_FLAGS</span></code> to an empty string or
the <code class="docutils literal notranslate"><span class="pre">find_package(OpenMP)</span></code> command will fail.  Setting the variable
<code class="docutils literal notranslate"><span class="pre">-DOpenMP_&lt;LANG&gt;_FLAGS_OVERRIDE=</span> <span class="pre">&quot;</span> <span class="pre">&quot;</span></code> is the only way to enable OpenMP but
skip adding the OpenMP flags provided by <code class="docutils literal notranslate"><span class="pre">find_package(OpenMP)</span></code>.</p>
</div>
<div class="section" id="building-shared-libraries">
<h2><a class="toc-backref" href="#id38"><span class="sectnum">4.12</span> Building shared libraries</a><a class="headerlink" href="#building-shared-libraries" title="Permalink to this headline">¶</a></h2>
<p id="build-shared-libs">To configure to build shared libraries, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">BUILD_SHARED_LIBS</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>The above option will result in all shared libraries to be build on all
systems (i.e., <code class="docutils literal notranslate"><span class="pre">.so</span></code> on Unix/Linux systems, <code class="docutils literal notranslate"><span class="pre">.dylib</span></code> on Mac OS X, and
<code class="docutils literal notranslate"><span class="pre">.dll</span></code> on Windows systems).</p>
<p>NOTE: If the project has <code class="docutils literal notranslate"><span class="pre">USE_XSDK_DEFAULTS=ON</span></code> set, then this will set
<code class="docutils literal notranslate"><span class="pre">BUILD_SHARED_LIBS=TRUE</span></code> by default.  Otherwise, the default is
<code class="docutils literal notranslate"><span class="pre">BUILD_SHARED_LIBS=FALSE</span></code></p>
<p>Many systems support a feature called <code class="docutils literal notranslate"><span class="pre">RPATH</span></code> when shared libraries are used
that embeds the default locations to look for shared libraries when an
executable is run.  By default on most systems, CMake will automatically add
RPATH directories to shared libraries and executables inside of the build
directories.  This allows running CMake-built executables from inside the
build directory without needing to set <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> on any other
environment variables.  However, this can be disabled by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_SKIP_BUILD_RPATH</span><span class="o">=</span><span class="n">TRUE</span>
</pre></div>
</div>
<p>but it is hard to find a use case where that would be useful.</p>
</div>
<div class="section" id="building-static-libraries-and-executables">
<h2><a class="toc-backref" href="#id39"><span class="sectnum">4.13</span> Building static libraries and executables</a><a class="headerlink" href="#building-static-libraries-and-executables" title="Permalink to this headline">¶</a></h2>
<p>To build static libraries, turn off the shared library support:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">BUILD_SHARED_LIBS</span><span class="o">=</span><span class="n">OFF</span>
</pre></div>
</div>
<p>Some machines, such as the Cray XT5, require static executables.  To build
&lt;Project&gt; executables as static objects, a number of flags must be set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">BUILD_SHARED_LIBS</span><span class="o">=</span><span class="n">OFF</span> \
<span class="o">-</span><span class="n">D</span> <span class="n">TPL_FIND_SHARED_LIBS</span><span class="o">=</span><span class="n">OFF</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_LINK_SEARCH_START_STATIC</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>The first flag tells cmake to build static versions of the &lt;Project&gt;
libraries.  The second flag tells cmake to locate static library versions of
any required TPLs.  The third flag tells the auto-detection routines that
search for extra required libraries (such as the mpi library and the gfortran
library for gnu compilers) to locate static versions.</p>
</div>
<div class="section" id="enabling-the-usage-of-resource-files-to-reduce-length-of-build-lines">
<h2><a class="toc-backref" href="#id40"><span class="sectnum">4.14</span> Enabling the usage of resource files to reduce length of build lines</a><a class="headerlink" href="#enabling-the-usage-of-resource-files-to-reduce-length-of-build-lines" title="Permalink to this headline">¶</a></h2>
<p>When using the <code class="docutils literal notranslate"><span class="pre">Unix</span> <span class="pre">Makefile</span></code> generator and the <code class="docutils literal notranslate"><span class="pre">Ninja</span></code> generator, CMake
supports some very useful (undocumented) options for reducing the length of
the command-lines used to build object files, create libraries, and link
executables.  Using these options can avoid troublesome “command-line too
long” errors, “Error 127” library creation errors, and other similar errors
related to excessively long command-lines to build various targets.</p>
<p>When using the <code class="docutils literal notranslate"><span class="pre">Unix</span> <span class="pre">Makefile</span></code> generator, CMake responds to the three cache
variables <code class="docutils literal notranslate"><span class="pre">CMAKE_CXX_USE_RESPONSE_FILE_FOR_INCLUDES</span></code>,
<code class="docutils literal notranslate"><span class="pre">CMAKE_CXX_USE_RESPONSE_FILE_FOR_OBJECTS</span></code> and
<code class="docutils literal notranslate"><span class="pre">CMAKE_CXX_USE_RESPONSE_FILE_FOR_LIBRARIES</span></code> described below.</p>
<p>To aggregate the list of all of the include directories (e.g. <code class="docutils literal notranslate"><span class="pre">'-I</span>
<span class="pre">&lt;full_path&gt;'</span></code>) into a single <code class="docutils literal notranslate"><span class="pre">*.rsp</span></code> file for compiling object files, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_CXX_USE_RESPONSE_FILE_FOR_INCLUDES</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>To aggregate the list of all of the object files (e.g. <code class="docutils literal notranslate"><span class="pre">'&lt;path&gt;/&lt;name&gt;.o'</span></code>)
into a single <code class="docutils literal notranslate"><span class="pre">*.rsp</span></code> file for creating libraries or linking executables,
set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_CXX_USE_RESPONSE_FILE_FOR_OBJECTS</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>To aggregate the list of all of the libraries (e.g. <code class="docutils literal notranslate"><span class="pre">'&lt;path&gt;/&lt;libname&gt;.a'</span></code>)
into a single <code class="docutils literal notranslate"><span class="pre">*.rsp</span></code> file for creating shared libraries or linking
executables, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_CXX_USE_RESPONSE_FILE_FOR_LIBRARIES</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>When using the <code class="docutils literal notranslate"><span class="pre">Ninja</span></code> generator, CMake only responds to the single option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_NINJA_FORCE_RESPONSE_FILE</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>which turns on the usage of <code class="docutils literal notranslate"><span class="pre">*.rsp</span></code> response files for include directories,
object files, and libraries (and therefore is equivalent to setting the above
three <code class="docutils literal notranslate"><span class="pre">Unix</span> <span class="pre">Makefiles</span></code> generator options to <code class="docutils literal notranslate"><span class="pre">ON</span></code>).</p>
<p>This feature works well on most standard systems but there are problems in
some situations and therefore these options can only be safely enabled on
case-by-case basis – experimenting to ensure they are working correctly.
Some examples of some known problematic cases (as of CMake 3.11.2) are:</p>
<ul class="simple">
<li><p>CMake will only use resource files with static libraries created with GNU
<code class="docutils literal notranslate"><span class="pre">ar</span></code> (e.g. on Linux) but not BSD <code class="docutils literal notranslate"><span class="pre">ar</span></code> (e.g. on MacOS).  With BSD <code class="docutils literal notranslate"><span class="pre">ar</span></code>,
CMake may break up long command-lines (i.e. lots of object files) with
multiple calls to <code class="docutils literal notranslate"><span class="pre">ar</span></code> but that may only work with the <code class="docutils literal notranslate"><span class="pre">Unix</span> <span class="pre">Makefiles</span></code>
generator, not the <code class="docutils literal notranslate"><span class="pre">Ninja</span></code> generator.</p></li>
<li><p>Some versions of <code class="docutils literal notranslate"><span class="pre">gfortran</span></code> do not accept <code class="docutils literal notranslate"><span class="pre">*.rsp</span></code> files.</p></li>
<li><p>Some versions of <code class="docutils literal notranslate"><span class="pre">nvcc</span></code> (e.g. with CUDA 8.044) do not accept <code class="docutils literal notranslate"><span class="pre">*.rsp</span></code>
files for compilation or linking.</p></li>
</ul>
<p>Because of problems like these, TriBITS cannot robustly automatically turn on
these options.  Therefore, it is up to the user to try these options out to
see if they work with their specific version of CMake, compilers, and OS.</p>
<p>NOTE: When using the <code class="docutils literal notranslate"><span class="pre">Unix</span> <span class="pre">Makefiles</span></code> generator, one can decide to set any
combination of these three options based on need and preference and what
actually works with a given OS, version of CMake, and provided compilers.  For
example, on one system <code class="docutils literal notranslate"><span class="pre">CMAKE_CXX_USE_RESPONSE_FILE_FOR_OBJECTS=ON</span></code> may work
but <code class="docutils literal notranslate"><span class="pre">CMAKE_CXX_USE_RESPONSE_FILE_FOR_INCLUDES=ON</span></code> may not (which is the case
for <code class="docutils literal notranslate"><span class="pre">gfortran</span></code> mentioned above).  Therefore, one should experiment carefully
and inspect the build lines using <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">VERBOSE=1</span> <span class="pre">&lt;target&gt;</span></code> as described in
<a class="reference internal" href="#building-with-verbose-output-without-reconfiguring">Building with verbose output without reconfiguring</a> when deciding which of
these options to enable.</p>
<p>NOTE: Newer versions of CMake may automatically determine when these options
need to be turned on so watch for that in looking at the build lines.</p>
</div>
<div class="section" id="enabling-support-for-an-optional-third-party-library-tpl">
<h2><a class="toc-backref" href="#id41"><span class="sectnum">4.15</span> Enabling support for an optional Third-Party Library (TPL)</a><a class="headerlink" href="#enabling-support-for-an-optional-third-party-library-tpl" title="Permalink to this headline">¶</a></h2>
<p>To enable a given TPL, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">TPL_ENABLE_</span><span class="o">&lt;</span><span class="n">TPLNAME</span><span class="o">&gt;=</span><span class="n">ON</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;TPLNAME&gt;</span></code> = <code class="docutils literal notranslate"><span class="pre">BLAS</span></code>, <code class="docutils literal notranslate"><span class="pre">LAPACK</span></code> <code class="docutils literal notranslate"><span class="pre">Boost</span></code>, <code class="docutils literal notranslate"><span class="pre">Netcdf</span></code>, etc.</p>
<p>The full list of TPLs that is defined and can be enabled is shown by doing a
configure with CMake and then grepping the configure output for <code class="docutils literal notranslate"><span class="pre">Final</span> <span class="pre">set</span> <span class="pre">of</span>
<span class="pre">.*</span> <span class="pre">TPLs</span></code>.  The set of TPL names listed in <code class="docutils literal notranslate"><span class="pre">'Final</span> <span class="pre">set</span> <span class="pre">of</span> <span class="pre">enabled</span> <span class="pre">TPLs'</span></code> and
<code class="docutils literal notranslate"><span class="pre">'Final</span> <span class="pre">set</span> <span class="pre">of</span> <span class="pre">non-enabled</span> <span class="pre">TPLs'</span></code> gives the full list of TPLs that can be
enabled (or disabled).</p>
<p>Some TPLs require only libraries (e.g. Fortran libraries like BLAS or LAPACK),
some TPL require only include directories, and some TPLs require both.</p>
<p>Each TPL specification is defined in a <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;TPLNAME&gt;.cmake</span></code> module file.
The job of each of these of these module files is to set the CMake cache
variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TPL_&lt;TPLNAME&gt;_INCLUDE_DIRS:PATH</span></code>: List of paths to header files for the
TPL (if the TPL supplies header files).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TPL_&lt;TPLNAME&gt;_LIBRARIES:PATH</span></code>: List of (absolute) paths to libraries,
ordered as they will be on the link line (of the TPL supplies libraries).</p></li>
</ul>
<p>These variables are the only variables that are actually used in the CMake
build system.  Therefore, one can set these two variables as CMake cache
variables, for <code class="docutils literal notranslate"><span class="pre">SomeTPL</span></code> for example, with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">TPL_SomeTPL_INCLUDE_DIRS</span><span class="o">=</span><span class="s2">&quot;$</span><span class="si">{LIB_BASE}</span><span class="s2">/include/a;$</span><span class="si">{LIB_BASE}</span><span class="s2">/include/b&quot;</span> \
<span class="o">-</span><span class="n">D</span> <span class="n">TPL_SomeTPL_LIBRARIES</span><span class="o">=</span><span class="s2">&quot;$</span><span class="si">{LIB_BASE}</span><span class="s2">/lib/liblib1.so;$</span><span class="si">{LIB_BASE}</span><span class="s2">/lib/liblib2.so&quot;</span> \
</pre></div>
</div>
<p>Using this approach, one can be guaranteed that these libraries and these
include directories and will used in the compile and link lines for the
packages that depend on this TPL <code class="docutils literal notranslate"><span class="pre">SomeTPL</span></code>.</p>
<p><strong>WARNING:</strong> When specifying <code class="docutils literal notranslate"><span class="pre">TPL_&lt;TPLNAME&gt;_INCLUDE_DIRS</span></code> and/or
<code class="docutils literal notranslate"><span class="pre">TPL_&lt;TPLNAME&gt;_LIBRARIES</span></code>, the build system will use these without question.
It will <strong>not</strong> check for the existence of these directories or files so make
sure that these files and directories exist before these are used in the
compiles and links.  (This can actually be a feature in rare cases the
libraries and header files don’t actually get created until after the
configure step is complete but before the build step.)</p>
<p><strong>WARNING:</strong> Do <strong>not</strong> try to hack the system and set, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TPL_BLAS_LIBRARIES</span><span class="o">=</span><span class="s2">&quot;-L/some/dir -llib1 -llib2 ...&quot;</span>
</pre></div>
</div>
<p>This is not compatible with proper CMake usage and it not guaranteed to be
supported for all use cases or all platforms!  You should instead always use
the full library paths when setting <code class="docutils literal notranslate"><span class="pre">TPL_&lt;TPLNAME&gt;_LIBRARIES</span></code>.</p>
<p>When the variables <code class="docutils literal notranslate"><span class="pre">TPL_&lt;TPLNAME&gt;_INCLUDE_DIRS</span></code> and
<code class="docutils literal notranslate"><span class="pre">TPL_&lt;TPLNAME&gt;_LIBRARIES</span></code> are not specified, then most
<code class="docutils literal notranslate"><span class="pre">FindTPL&lt;TPLNAME&gt;.cmake</span></code> modules use a default find operation.  Some will
call <code class="docutils literal notranslate"><span class="pre">find_package(&lt;TPLNAME&gt;)</span></code> internally by default and some may implement
the default find in some other way.  To know for sure, see the documentation
for the specific TPL (e.g. looking in the <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;TPLNAME&gt;.cmake</span></code> file to
be sure).</p>
<p>Most TPLs, however, use a standard system for finding include directories
and/or libraries based on the function
<a class="reference external" href="TribitsUsersGuide.html#tribits-tpl-find-include-dirs-and-libraries">tribits_tpl_find_include_dirs_and_libraries()</a>.  These simple standard
<code class="docutils literal notranslate"><span class="pre">FindTPL&lt;TPLNAME&gt;.cmake</span></code> modules specify a set of header files and/or
libraries that must be found.  The directories where these header files and
library files are looked for are specified using the CMake cache variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;TPLNAME&gt;_INCLUDE_DIRS:PATH</span></code>: List of paths to search for header files
using <code class="docutils literal notranslate"><span class="pre">find_file()</span></code> for each header file, in order.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;TPLNAME&gt;_LIBRARY_NAMES:STRING</span></code>: List of unadorned library names, in the
order of the link line.  The platform-specific prefixes (e.g.. ‘lib’) and
postfixes (e.g. ‘.a’, ‘.lib’, or ‘.dll’) will be added automatically by
CMake.  For example, the library <code class="docutils literal notranslate"><span class="pre">libblas.so</span></code>, <code class="docutils literal notranslate"><span class="pre">libblas.a</span></code>, <code class="docutils literal notranslate"><span class="pre">blas.lib</span></code>
or <code class="docutils literal notranslate"><span class="pre">blas.dll</span></code> will all be found on the proper platform using the name
<code class="docutils literal notranslate"><span class="pre">blas</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;TPLNAME&gt;_LIBRARY_DIRS:PATH</span></code>: The list of directories where the library
files will be searched for using <code class="docutils literal notranslate"><span class="pre">find_library()</span></code>, for each library, in
order.</p></li>
</ul>
<p>Most <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;TPLNAME&gt;.cmake</span></code> modules will define a default set of libraries
to look for and therefore <code class="docutils literal notranslate"><span class="pre">&lt;TPLNAME&gt;_LIBRARY_NAMES</span></code> can typically be left
off.</p>
<p>In order to allow a TPL that normally requires one or more libraries to ignore
the libraries, one can set <code class="docutils literal notranslate"><span class="pre">&lt;TPLNAME&gt;_LIBRARY_NAMES</span></code> to empty, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">TPLNAME</span><span class="o">&gt;</span><span class="n">_LIBRARY_NAMES</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</pre></div>
</div>
<p>Optional package-specific support for a TPL can be turned off by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;</span><span class="n">_ENABLE_</span><span class="o">&lt;</span><span class="n">TPLNAME</span><span class="o">&gt;=</span><span class="n">OFF</span>
</pre></div>
</div>
<p>This gives the user full control over what TPLs are supported by which package
independently.</p>
<p>Support for an optional TPL can also be turned on implicitly by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;</span><span class="n">_ENABLE_</span><span class="o">&lt;</span><span class="n">TPLNAME</span><span class="o">&gt;=</span><span class="n">ON</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> is a TriBITS package that has an optional
dependency on <code class="docutils literal notranslate"><span class="pre">&lt;TPLNAME&gt;</span></code>.  That will result in setting
<code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_&lt;TPLNAME&gt;=ON</span></code> internally (but not set in the cache) if
<code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_&lt;TPLNAME&gt;=OFF</span></code> is not already set.</p>
<p>If all the parts of a TPL are not found on an initial configure the configure
will error out with a helpful error message.  In that case, one can change the
variables <code class="docutils literal notranslate"><span class="pre">&lt;TPLNAME&gt;_INCLUDE_DIRS</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;TPLNAME&gt;_LIBRARY_NAMES</span></code>, and/or
<code class="docutils literal notranslate"><span class="pre">&lt;TPLNAME&gt;_LIBRARY_DIRS</span></code> in order to help fund the parts of the TPL.  One
can do this over and over until the TPL is found. By reconfiguring, one avoid
a complete configure from scratch which saves time.  Or, one can avoid the
find operations by directly setting <code class="docutils literal notranslate"><span class="pre">TPL_&lt;TPLNAME&gt;_INCLUDE_DIRS</span></code> and
<code class="docutils literal notranslate"><span class="pre">TPL_&lt;TPLNAME&gt;_LIBRARIES</span></code>.</p>
<p><strong>WARNING:</strong> The cmake cache variable <code class="docutils literal notranslate"><span class="pre">TPL_&lt;TPLNAME&gt;_LIBRARY_DIRS</span></code> does
<strong>not</strong> control where libraries are found.  Instead, this variable is set
during the find processes and is not actually used in the CMake build system
at all.</p>
<p>In summary, this gives the user complete and direct control in specifying
exactly what is used in the build process.</p>
<p><strong>TPL Example 1: Standard BLAS Library</strong></p>
<p>Suppose one wants to find the standard BLAS library <code class="docutils literal notranslate"><span class="pre">blas</span></code> in the
directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span>
  <span class="n">libblas</span><span class="o">.</span><span class="n">so</span>
  <span class="n">libblas</span><span class="o">.</span><span class="n">a</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">FindTPLBLAS.cmake</span></code> module should be set up to automatically find the
BLAS TPL by simply enabling BLAS with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">TPL_ENABLE_BLAS</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>This will result in setting the CMake cache variable <code class="docutils literal notranslate"><span class="pre">TPL_BLAS_LIBRARIES</span></code> as
shown in the CMake output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">TPL_BLAS_LIBRARIES</span><span class="o">=</span><span class="s1">&#39;/user/lib/libblas.so&#39;</span>
</pre></div>
</div>
<p>(NOTE: The CMake <code class="docutils literal notranslate"><span class="pre">find_library()</span></code> command that is used internally will
always select the shared library by default if both shared and static
libraries are specified, unless told otherwise.  See <a class="reference internal" href="#building-static-libraries-and-executables">Building static
libraries and executables</a> for more details about the handling of shared and
static libraries.)</p>
<p>However, suppose one wants to find the <code class="docutils literal notranslate"><span class="pre">blas</span></code> library in a non-default
location, such as in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">projects</span><span class="o">/</span><span class="n">something</span><span class="o">/</span><span class="n">tpls</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libblas</span><span class="o">.</span><span class="n">so</span>
</pre></div>
</div>
<p>In this case, one could simply configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">TPL_ENABLE_BLAS</span><span class="o">=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="n">BLAS_LIBRARY_DIRS</span><span class="o">=/</span><span class="n">projects</span><span class="o">/</span><span class="n">something</span><span class="o">/</span><span class="n">tpls</span><span class="o">/</span><span class="n">lib</span> \
</pre></div>
</div>
<p>That will result in finding the library shown in the CMake output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">TPL_BLAS_LIBRARIES</span><span class="o">=</span><span class="s1">&#39;/projects/something/tpls/libblas.so&#39;</span>
</pre></div>
</div>
<p>And if one wants to make sure that this BLAS library is used, then one can
just directly set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">TPL_BLAS_LIBRARIES</span><span class="o">=/</span><span class="n">projects</span><span class="o">/</span><span class="n">something</span><span class="o">/</span><span class="n">tpls</span><span class="o">/</span><span class="n">libblas</span><span class="o">.</span><span class="n">so</span>
</pre></div>
</div>
<p><strong>TPL Example 2: Intel Math Kernel Library (MKL) for BLAS</strong></p>
<p>There are many cases where the list of libraries specified in the
<code class="docutils literal notranslate"><span class="pre">FindTPL&lt;TPLNAME&gt;.cmake</span></code> module is not correct for the TPL that one wants to
use or is present on the system.  In this case, one will need to set the CMake
cache variable <code class="docutils literal notranslate"><span class="pre">&lt;TPLNAME&gt;_LIBRARY_NAMES</span></code> to tell the
<a class="reference external" href="TribitsUsersGuide.html#tribits-tpl-find-include-dirs-and-libraries">tribits_tpl_find_include_dirs_and_libraries()</a> function what libraries to
search for, and in what order.</p>
<p>For example, the Intel Math Kernel Library (MKL) implementation for the BLAS
is usually given in several libraries.  The exact set of libraries needed
depends on the version of MKL, whether 32bit or 64bit libraries are needed,
etc.  Figuring out the correct set and ordering of these libraries for a given
platform may not be trivial.  But once the set and the order of the libraries
is known, then one can provide the correct list at configure time.</p>
<p>For example, suppose one wants to use the threaded MKL libraries listed in the
directories:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">intel</span><span class="o">/</span><span class="n">Compiler</span><span class="o">/</span><span class="mf">11.1</span><span class="o">/</span><span class="mi">064</span><span class="o">/</span><span class="n">mkl</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">em64t</span><span class="o">/</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">intel</span><span class="o">/</span><span class="n">Compiler</span><span class="o">/</span><span class="mf">11.1</span><span class="o">/</span><span class="mi">064</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">intel64</span><span class="o">/</span>
</pre></div>
</div>
<p>and the list of libraries being searched for is <code class="docutils literal notranslate"><span class="pre">mkl_intel_lp64</span></code>,
<code class="docutils literal notranslate"><span class="pre">mkl_intel_thread</span></code>, <code class="docutils literal notranslate"><span class="pre">mkl_core</span></code> and <code class="docutils literal notranslate"><span class="pre">iomp5</span></code>.</p>
<p>In this case, one could specify this with the following do-configure script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash

INTEL_DIR=/usr/local/intel/Compiler/11.1/064

cmake \
  -D TPL_ENABLE_BLAS=ON \
  -D BLAS_LIBRARY_DIRS=&quot;${INTEL_DIR}/em64t;${INTEL_DIR}/intel64&quot; \
  -D BLAS_LIBRARY_NAMES=&quot;mkl_intel_lp64;mkl_intel_thread;mkl_core;iomp5&quot; \
  ...
  ${PROJECT_SOURCE_DIR}
</pre></div>
</div>
<p>This would call <code class="docutils literal notranslate"><span class="pre">find_library()</span></code> on each of the listed library names in
these directories and would find them and list them in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">TPL_BLAS_LIBRARIES</span><span class="o">=</span><span class="s1">&#39;/usr/local/intel/Compiler/11.1/064/em64t/libmkl_intel_lp64.so;...&#39;</span>
</pre></div>
</div>
<p>(where <code class="docutils literal notranslate"><span class="pre">...</span></code> are the rest of the found libraries.)</p>
<p>NOTE: When shared libraries are used, one typically only needs to list the
direct libraries, not the indirect libraries, as the shared libraries are
linked to each other.</p>
<p>In this example, one could also play it super safe and manually list out the
libraries in the right order by configuring with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">TPL_BLAS_LIBRARIES</span><span class="o">=</span><span class="s2">&quot;$</span><span class="si">{INTEL_DIR}</span><span class="s2">/em64t/libmkl_intel_lp64.so;...&quot;</span>
</pre></div>
</div>
<p>(where <code class="docutils literal notranslate"><span class="pre">...</span></code> are the rest of the libraries found in order).</p>
</div>
<div class="section" id="disabling-support-for-a-third-party-library-tpl">
<h2><a class="toc-backref" href="#id42"><span class="sectnum">4.16</span> Disabling support for a Third-Party Library (TPL)</a><a class="headerlink" href="#disabling-support-for-a-third-party-library-tpl" title="Permalink to this headline">¶</a></h2>
<p>Disabling a TPL explicitly can be done using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">TPL_ENABLE_</span><span class="o">&lt;</span><span class="n">TPLNAME</span><span class="o">&gt;=</span><span class="n">OFF</span>
</pre></div>
</div>
<p>NOTE: If a disabled TPL is a required dependency of some explicitly enabled
downstream package, then the configure will error out if
&lt;Project&gt;_DISABLE_ENABLED_FORWARD_DEP_PACKAGES=OFF.  Otherwise, a WARNING will
be printed and the downstream package will be disabled and configuration will
continue.</p>
</div>
<div class="section" id="disabling-tentatively-enabled-tpls">
<h2><a class="toc-backref" href="#id43"><span class="sectnum">4.17</span> Disabling tentatively enabled TPLs</a><a class="headerlink" href="#disabling-tentatively-enabled-tpls" title="Permalink to this headline">¶</a></h2>
<p>To disable a tentatively enabled TPL, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">TPL_ENABLE_</span><span class="o">&lt;</span><span class="n">TPLNAME</span><span class="o">&gt;=</span><span class="n">OFF</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;TPLNAME&gt;</span></code> = <code class="docutils literal notranslate"><span class="pre">BinUtils</span></code>, <code class="docutils literal notranslate"><span class="pre">Boost</span></code>, etc.</p>
<p>NOTE: Some TPLs in &lt;Project&gt; are always tentatively enabled (e.g. BinUtils
for C++ stacktracing) and if all of the components for the TPL are found
(e.g. headers and libraries) then support for the TPL will be enabled,
otherwise it will be disabled.  This is to allow as much functionality as
possible to get automatically enabled without the user having to learn about
the TPL, explicitly enable the TPL, and then see if it is supported or not
on the given system.  However, if the TPL is not supported on a given
platform, then it may be better to explicitly disable the TPL (as shown
above) so as to avoid the output from the CMake configure process that shows
the tentatively enabled TPL being processes and then failing to be enabled.
Also, it is possible that the enable process for the TPL may pass, but the
TPL may not work correctly on the given platform.  In this case, one would
also want to explicitly disable the TPL as shown above.</p>
</div>
<div class="section" id="require-all-tpl-libraries-be-found">
<h2><a class="toc-backref" href="#id44"><span class="sectnum">4.18</span> Require all TPL libraries be found</a><a class="headerlink" href="#require-all-tpl-libraries-be-found" title="Permalink to this headline">¶</a></h2>
<p>By default, some TPLs don’t require that all of the libraries listed in
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIBRARY_NAMES</span></code> be found.  To change this behavior so that all
libraries for all enabled TPLs be found, one can set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_MUST_FIND_ALL_TPL_LIBS</span><span class="o">=</span><span class="n">TRUE</span>
</pre></div>
</div>
<p>This makes the configure process catch more mistakes with the env.</p>
</div>
<div class="section" id="disable-warnings-from-tpl-header-files">
<h2><a class="toc-backref" href="#id45"><span class="sectnum">4.19</span> Disable warnings from TPL header files</a><a class="headerlink" href="#disable-warnings-from-tpl-header-files" title="Permalink to this headline">¶</a></h2>
<p>To disable warnings coming from included TPL header files for C and C++ code,
set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_TPL_SYSTEM_INCLUDE_DIRS</span><span class="o">=</span><span class="n">TRUE</span>
</pre></div>
</div>
<p>On some systems and compilers (e.g. GNU), that will result is include
directories for all TPLs to be passed in to the compiler using <code class="docutils literal notranslate"><span class="pre">-isystem</span></code>
instead of <code class="docutils literal notranslate"><span class="pre">-I</span></code>.</p>
<p>WARNING: On some systems this will result in build failures involving gfortran
and module files.  Therefore, don’t enable this if Fortran code in your
project is pulling in module files from TPLs.</p>
</div>
<div class="section" id="xsdk-configuration-options">
<h2><a class="toc-backref" href="#id46"><span class="sectnum">4.20</span> xSDK Configuration Options</a><a class="headerlink" href="#xsdk-configuration-options" title="Permalink to this headline">¶</a></h2>
<p>The configure of &lt;Project&gt; will adhere to the xSDK configuration standard
(todo: put in reference to final document) simply by setting the CMake cache
variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">USE_XSDK_DEFAULTS</span><span class="o">=</span><span class="n">TRUE</span>
</pre></div>
</div>
<p>Setting this will have the following impact:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">BUILD_SHARED_LIBS</span></code> will be set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> by default instead of
<code class="docutils literal notranslate"><span class="pre">FALSE</span></code>, which is the default for raw CMake projects (see <a class="reference internal" href="#building-shared-libraries">Building shared
libraries</a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CMAKE_BUILD_TYPE</span></code> will be set to <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> by default instead of
<code class="docutils literal notranslate"><span class="pre">RELEASE</span></code> which is the standard TriBITS default (see <a class="reference internal" href="#cmake-build-type">CMAKE_BUILD_TYPE</a>).</p></li>
<li><p>The compilers in MPI mode <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_MPI=ON</span></code> or serial mode
<code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_MPI=OFF</span></code> will be read from the environment variables <code class="docutils literal notranslate"><span class="pre">CC</span></code>,
<code class="docutils literal notranslate"><span class="pre">CXX</span></code> and <code class="docutils literal notranslate"><span class="pre">FC</span></code> if they are set but the cmake cache variables
<code class="docutils literal notranslate"><span class="pre">CMAKE_C_COMPILER</span></code>, <code class="docutils literal notranslate"><span class="pre">CMAKE_C_COMPILER</span></code> and <code class="docutils literal notranslate"><span class="pre">CMAKE_C_COMPILER</span></code> are not
set.  Otherwise, the TriBITS default behavior is to ignore these environment
variables in MPI mode.</p></li>
<li><p>The Fortran flags will be read from environment variable <code class="docutils literal notranslate"><span class="pre">FCFLAGS</span></code> if the
environment variable <code class="docutils literal notranslate"><span class="pre">FFLAGS</span></code> and the CMake cache variable
<code class="docutils literal notranslate"><span class="pre">CMAKE_Fortran_FLAGS</span></code> are empty.  Otherwise, raw CMake ignores <code class="docutils literal notranslate"><span class="pre">FCFLAGS</span></code>
(see <a class="reference internal" href="#adding-arbitrary-compiler-flags-but-keeping-default-build-type-flags">Adding arbitrary compiler flags but keeping default build-type
flags</a>).</p></li>
</ul>
<p>The rest of the required xSDK configure standard is automatically satisfied by
every TriBITS CMake project, including the &lt;Project&gt; project.</p>
</div>
<div class="section" id="generating-verbose-output">
<h2><a class="toc-backref" href="#id47"><span class="sectnum">4.21</span> Generating verbose output</a><a class="headerlink" href="#generating-verbose-output" title="Permalink to this headline">¶</a></h2>
<p>There are several different ways to generate verbose output to debug problems
when they occur:</p>
<ol class="loweralpha simple" id="project-trace-file-processing">
<li><p><strong>Trace file processing during configure:</strong></p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_TRACE_FILE_PROCESSING</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>This will cause TriBITS to print out a trace for all of the project’s,
repository’s, and package’s files get processed on lines using the prefix
<code class="docutils literal notranslate"><span class="pre">File</span> <span class="pre">Trace:</span></code>.  This shows what files get processed and in what order they
get processed.  To get a clean listing of all the files processed by TriBITS
just grep out the lines starting with <code class="docutils literal notranslate"><span class="pre">--</span> <span class="pre">File</span> <span class="pre">Trace:</span></code>.  This can be
helpful in debugging configure problems without generating too much extra
output.</p>
<p>Note that <a class="reference internal" href="#project-trace-file-processing">&lt;Project&gt;_TRACE_FILE_PROCESSING</a> is set to <code class="docutils literal notranslate"><span class="pre">ON</span></code> automatically
when <a class="reference internal" href="#project-verbose-configure">&lt;Project&gt;_VERBOSE_CONFIGURE</a>  = <code class="docutils literal notranslate"><span class="pre">ON</span></code>.</p>
</div></blockquote>
<ol class="loweralpha simple" id="project-verbose-configure" start="2">
<li><p><strong>Getting verbose output from TriBITS configure:</strong></p></li>
</ol>
<blockquote>
<div><p>To do a complete debug dump for the TriBITS configure process, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_VERBOSE_CONFIGURE</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>However, this produces a <em>lot</em> of output so don’t enable this unless you are
very desperate.  But this level of details can be very useful when debugging
configuration problems.</p>
<p>To just view the package and TPL dependencies, it is recommended to use
<code class="docutils literal notranslate"><span class="pre">-D</span></code> <a class="reference internal" href="#project-dump-package-dependencies">&lt;Project&gt;_DUMP_PACKAGE_DEPENDENCIES</a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">ON</span></code>.</p>
<p>To just print the link libraries for each library and executable created,
use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_DUMP_LINK_LIBS</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>Of course <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_DUMP_PACKAGE_DEPENDENCIES</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_DUMP_LINK_LIBS</span></code> can be used together.  Also, note that
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_DUMP_PACKAGE_DEPENDENCIES</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_DUMP_LINK_LIBS</span></code>
both default t <code class="docutils literal notranslate"><span class="pre">ON</span></code> when <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_VERBOSE_CONFIGURE=ON</span></code> on the first
configure.</p>
</div></blockquote>
<ol class="loweralpha simple" start="3">
<li><p><strong>Getting verbose output from the makefile:</strong></p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">CMAKE_VERBOSE_MAKEFILE</span><span class="o">=</span><span class="n">TRUE</span>
</pre></div>
</div>
<p>NOTE: It is generally better to just pass in <code class="docutils literal notranslate"><span class="pre">VERBOSE=</span></code> when directly
calling <code class="docutils literal notranslate"><span class="pre">make</span></code> after configuration is finished.  See <a class="reference internal" href="#building-with-verbose-output-without-reconfiguring">Building with
verbose output without reconfiguring</a>.</p>
</div></blockquote>
<ol class="loweralpha simple" start="4">
<li><p><strong>Getting very verbose output from configure:</strong></p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_VERBOSE_CONFIGURE</span><span class="o">=</span><span class="n">ON</span> <span class="o">--</span><span class="n">debug</span><span class="o">-</span><span class="n">output</span> <span class="o">--</span><span class="n">trace</span>
</pre></div>
</div>
<p>NOTE: This will print a complete stack trace to show exactly where you are.</p>
</div></blockquote>
</div>
<div class="section" id="enabling-disabling-deprecated-warnings">
<h2><a class="toc-backref" href="#id48"><span class="sectnum">4.22</span> Enabling/disabling deprecated warnings</a><a class="headerlink" href="#enabling-disabling-deprecated-warnings" title="Permalink to this headline">¶</a></h2>
<p>To turn off all deprecated warnings, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_SHOW_DEPRECATED_WARNINGS</span><span class="o">=</span><span class="n">OFF</span>
</pre></div>
</div>
<p>This will disable, by default, all deprecated warnings in packages in
&lt;Project&gt;.  By default, deprecated warnings are enabled.</p>
<p>To enable/disable deprecated warnings for a single &lt;Project&gt; package, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;</span><span class="n">_SHOW_DEPRECATED_WARNINGS</span><span class="o">=</span><span class="n">OFF</span>
</pre></div>
</div>
<p>This will override the global behavior set by
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_SHOW_DEPRECATED_WARNINGS</span></code> for individual package
<code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code>.</p>
</div>
<div class="section" id="disabling-deprecated-code">
<h2><a class="toc-backref" href="#id49"><span class="sectnum">4.23</span> Disabling deprecated code</a><a class="headerlink" href="#disabling-deprecated-code" title="Permalink to this headline">¶</a></h2>
<p>To actually disable and remove deprecated code from being included in
compilation, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_HIDE_DEPRECATED_CODE</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>and a subset of deprecated code will actually be removed from the build.  This
is to allow testing of downstream client code that might otherwise ignore
deprecated warnings.  This allows one to certify that a downstream client code
is free of calling deprecated code.</p>
<p>To hide deprecated code for a single &lt;Project&gt; package set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;</span><span class="n">_HIDE_DEPRECATED_CODE</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>This will override the global behavior set by
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_HIDE_DEPRECATED_CODE</span></code> for individual package
<code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code>.</p>
</div>
<div class="section" id="outputting-package-dependency-information">
<h2><a class="toc-backref" href="#id50"><span class="sectnum">4.24</span> Outputting package dependency information</a><a class="headerlink" href="#outputting-package-dependency-information" title="Permalink to this headline">¶</a></h2>
<p id="project-deps-default-output-dir">To generate the various XML and HTML package dependency files, one can set the
output directory when configuring using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_DEPS_DEFAULT_OUTPUT_DIR</span><span class="p">:</span><span class="n">FILEPATH</span><span class="o">=&lt;</span><span class="n">SOME_PATH</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This will generate, by default, the output files
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;PackageDependencies.xml</span></code>,
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;PackageDependenciesTable.html</span></code>, and
<code class="docutils literal notranslate"><span class="pre">CDashSubprojectDependencies.xml</span></code>.  If <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_DEPS_DEFAULT_OUTPUT_DIR</span></code>
is not set, then the individual output files can be specified as described below.</p>
<p id="project-deps-xml-output-file">The filepath for &lt;Project&gt;PackageDependencies.xml can be overridden (or set
independently) using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_DEPS_XML_OUTPUT_FILE</span><span class="p">:</span><span class="n">FILEPATH</span><span class="o">=&lt;</span><span class="n">SOME_FILE_PATH</span><span class="o">&gt;</span>
</pre></div>
</div>
<p id="project-deps-html-output-file">The filepath for <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;PackageDependenciesTable.html</span></code> can be overridden
(or set independently) using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_DEPS_HTML_OUTPUT_FILE</span><span class="p">:</span><span class="n">FILEPATH</span><span class="o">=&lt;</span><span class="n">SOME_FILE_PATH</span><span class="o">&gt;</span>
</pre></div>
</div>
<p id="project-cdash-deps-xml-output-file">The filepath for CDashSubprojectDependencies.xml can be overridden (or set
independently) using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_CDASH_DEPS_XML_OUTPUT_FILE</span><span class="p">:</span><span class="n">FILEPATH</span><span class="o">=&lt;</span><span class="n">SOME_FILE_PATH</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>NOTES:</p>
<ul class="simple">
<li><p>One must start with a clean CMake cache for all of these defaults to work.</p></li>
<li><p>The files <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;PackageDependenciesTable.html</span></code> and
<code class="docutils literal notranslate"><span class="pre">CDashSubprojectDependencies.xml</span></code> will only get generated if support for
Python is enabled.</p></li>
</ul>
</div>
<div class="section" id="test-related-configuration-settings">
<h2><a class="toc-backref" href="#id51"><span class="sectnum">4.25</span> Test-related configuration settings</a><a class="headerlink" href="#test-related-configuration-settings" title="Permalink to this headline">¶</a></h2>
<p>Many options can be set at configure time to determine what tests are enabled
and how they are run.  The following subsections described these various
settings.</p>
<div class="section" id="enabling-different-test-categories">
<h3><a class="toc-backref" href="#id52"><span class="sectnum">4.25.1</span> Enabling different test categories</a><a class="headerlink" href="#enabling-different-test-categories" title="Permalink to this headline">¶</a></h3>
<p>To turn on a set a given set of tests by test category, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_TEST_CATEGORIES</span><span class="o">=</span><span class="s2">&quot;&lt;CATEGORY0&gt;;&lt;CATEGORY1&gt;;...&quot;</span>
</pre></div>
</div>
<p>Valid categories include <code class="docutils literal notranslate"><span class="pre">BASIC</span></code>, <code class="docutils literal notranslate"><span class="pre">CONTINUOUS</span></code>, <code class="docutils literal notranslate"><span class="pre">NIGHTLY</span></code>, <code class="docutils literal notranslate"><span class="pre">HEAVY</span></code> and
<code class="docutils literal notranslate"><span class="pre">PERFORMANCE</span></code>.  <code class="docutils literal notranslate"><span class="pre">BASIC</span></code> tests get built and run for pre-push testing, CI
testing, and nightly testing.  <code class="docutils literal notranslate"><span class="pre">CONTINUOUS</span></code> tests are for post-push testing
and nightly testing.  <code class="docutils literal notranslate"><span class="pre">NIGHTLY</span></code> tests are for nightly testing only.
<code class="docutils literal notranslate"><span class="pre">HEAVY</span></code> tests are for more expensive tests that require larger number of MPI
processes and longer run times.  These test categories are nested
(e.g. <code class="docutils literal notranslate"><span class="pre">HEAVY</span></code> contains all <code class="docutils literal notranslate"><span class="pre">NIGHTLY</span></code>, <code class="docutils literal notranslate"><span class="pre">NIGHTLY</span></code> contains all
<code class="docutils literal notranslate"><span class="pre">CONTINUOUS</span></code> and <code class="docutils literal notranslate"><span class="pre">CONTINUOUS</span></code> contains all <code class="docutils literal notranslate"><span class="pre">BASIC</span></code> tests).  However,
<code class="docutils literal notranslate"><span class="pre">PERFORMANCE</span></code> tests are special category used only for performance testing
and don’t nest with the other categories.</p>
</div>
<div class="section" id="disabling-specific-tests">
<h3><a class="toc-backref" href="#id53"><span class="sectnum">4.25.2</span> Disabling specific tests</a><a class="headerlink" href="#disabling-specific-tests" title="Permalink to this headline">¶</a></h3>
<p>Any TriBITS-added ctest test (i.e. listed in <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-N</span></code>) can be disabled at
configure time by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">fullTestName</span><span class="o">&gt;</span><span class="n">_DISABLE</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;fullTestName&gt;</span></code> must exactly match the test listed out by <code class="docutils literal notranslate"><span class="pre">ctest</span>
<span class="pre">-N</span></code>.  This will result in the printing of a line for the excluded test when
<a class="reference internal" href="#trace-test-addition-or-exclusion">Trace test addition or exclusion</a> is enabled and the test will not be added
with <code class="docutils literal notranslate"><span class="pre">add_test()</span></code> and therefore CTest (and CDash) will never see the
disabled test.</p>
<p>Another approach to disable a test is the set the ctest property <code class="docutils literal notranslate"><span class="pre">DISABLED</span></code>
and print and a message at configure time by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">fullTestName</span><span class="o">&gt;</span><span class="n">_SET_DISABLED_AND_MSG</span><span class="o">=</span><span class="s2">&quot;&lt;messageWhyDisabled&gt;&quot;</span>
</pre></div>
</div>
<p>In this case, the test will still be added with <code class="docutils literal notranslate"><span class="pre">add_test()</span></code> and seen by
CTest, but CTest will not run the test locally but will mark it as “Not Run”
(and post to CDash as “Not Run” tests with test details “Not Run (Disabled)”
in processes where tests get posted to CDash).  Also, <code class="docutils literal notranslate"><span class="pre">&lt;messageWhyDisabled&gt;</span></code>
will get printed to STDOUT when CMake is run to configure the project and
<code class="docutils literal notranslate"><span class="pre">-D&lt;Project&gt;_TRACE_ADD_TEST=ON</span></code> is set.</p>
<p>Also, note that if a test is currently disabled using the <code class="docutils literal notranslate"><span class="pre">DISABLED</span></code> option
in the CMakeLists.txt file, then that <code class="docutils literal notranslate"><span class="pre">DISABLE</span></code> property can be removed by
configuring with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">fullTestName</span><span class="o">&gt;</span><span class="n">_SET_DISABLED_AND_MSG</span><span class="o">=</span><span class="n">FALSE</span>
</pre></div>
</div>
<p>(or any value that CMake evaluates to FALSE like “FALSE”, “false”, “NO”, “no”,
“”, etc.).</p>
<p>Also note that other specific defined tests can also be excluded using the
<code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-E</span></code> argument.</p>
</div>
<div class="section" id="disabling-specific-test-executable-builds">
<h3><a class="toc-backref" href="#id54"><span class="sectnum">4.25.3</span> Disabling specific test executable builds</a><a class="headerlink" href="#disabling-specific-test-executable-builds" title="Permalink to this headline">¶</a></h3>
<p>Any TriBITS-added executable (i.e. listed in <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">help</span></code>) can be disabled
from being built by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">exeTargetName</span><span class="o">&gt;</span><span class="n">_EXE_DISABLE</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;exeTargetName&gt;</span></code> is the name of the target in the build system.</p>
<p>Note that one should also disable any ctest tests that might use this
executable as well with <code class="docutils literal notranslate"><span class="pre">-D&lt;fullTestName&gt;_DISABLE=ON</span></code> (see above).  This
will result in the printing of a line for the executable target being disabled
at configure time to CMake STDOUT.</p>
</div>
<div class="section" id="disabling-just-the-ctest-tests-but-not-the-test-executables">
<h3><a class="toc-backref" href="#id55"><span class="sectnum">4.25.4</span> Disabling just the ctest tests but not the test executables</a><a class="headerlink" href="#disabling-just-the-ctest-tests-but-not-the-test-executables" title="Permalink to this headline">¶</a></h3>
<p>To allow the building of the tests and examples in a package (enabled either
through setting <a class="reference internal" href="#project-enable-tests">&lt;Project&gt;_ENABLE_TESTS</a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">ON</span></code> or
<a class="reference internal" href="#tribits-package-enable-tests">&lt;TRIBITS_PACKAGE&gt;_ENABLE_TESTS</a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">ON</span></code>) but not actually define the ctest
tests that will get run, configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;</span><span class="n">_SKIP_CTEST_ADD_TEST</span><span class="o">=</span><span class="n">TRUE</span> \
</pre></div>
</div>
<p>(This has the effect of skipping calling the <code class="docutils literal notranslate"><span class="pre">add_test()</span></code> command in the
CMake code for the package <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code>.)</p>
<p>To avoid defining ctest tests for all of the enabled packages, configure
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_SKIP_CTEST_ADD_TEST</span><span class="o">=</span><span class="n">TRUE</span> \
</pre></div>
</div>
<p>(The default for <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;_SKIP_CTEST_ADD_TEST</span></code> for each TriBITS
package <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> is set to the project-wide option
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_SKIP_CTEST_ADD_TEST</span></code>.)</p>
<p>One can also use these options to “white-list” and “black-list” the set of
package tests that one will run.  For example, to enable the building of all
test and example targets but only actually defining ctest tests for two
specific packages (i.e. “white-listing”), one would configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_ALL_PACKAGES</span><span class="o">=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_TESTS</span><span class="o">=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_SKIP_CTEST_ADD_TEST</span><span class="o">=</span><span class="n">TRUE</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE_1</span><span class="o">&gt;</span><span class="n">_SKIP_CTEST_ADD_TEST</span><span class="o">=</span><span class="n">FALSE</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE_2</span><span class="o">&gt;</span><span class="n">_SKIP_CTEST_ADD_TEST</span><span class="o">=</span><span class="n">FALSE</span> \
</pre></div>
</div>
<p>Alternatively, to enable the building of all test and example targets and
allowing the ctest tests to be defined for all packages except for a couple of
specific packages (i.e. “black-listing”), one would configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_ALL_PACKAGES</span><span class="o">=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_TESTS</span><span class="o">=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE_1</span><span class="o">&gt;</span><span class="n">_SKIP_CTEST_ADD_TEST</span><span class="o">=</span><span class="n">TRUE</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE_2</span><span class="o">&gt;</span><span class="n">_SKIP_CTEST_ADD_TEST</span><span class="o">=</span><span class="n">TRUE</span> \
</pre></div>
</div>
<p>Using different values for <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_SKIP_CTEST_ADD_TEST</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;_SKIP_CTEST_ADD_TEST</span></code> in this way allows for building all
of the test and example targets for the enabled packages but not defining
ctest tests for any set of packages desired.  This allows setting up testing
scenarios where one wants to test the building of all test-related targets but
not actually run the tests with ctest for a subset of all of the enabled
packages.  (This can be useful in cases where the tests are very expensive and
one can’t afford to run all of them given the testing budget, or when running
tests on a given platform is very flaky, or when some packages have fragile or
poor quality tests that don’t port to new platforms very well.)</p>
<p>NOTE: These options avoid having to pass specific sets of labels when running
<code class="docutils literal notranslate"><span class="pre">ctest</span></code> itself (such as when defining <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-S</span> <span class="pre">&lt;script&gt;.cmake</span></code> scripts)
and instead the decisions as to the exact set of ctest tests to define is made
at configure time.  Therefore, all of the decisions about what test targets
should be build and which tests should be run can be made at configure time.</p>
</div>
<div class="section" id="set-specific-tests-to-run-in-serial">
<h3><a class="toc-backref" href="#id56"><span class="sectnum">4.25.5</span> Set specific tests to run in serial</a><a class="headerlink" href="#set-specific-tests-to-run-in-serial" title="Permalink to this headline">¶</a></h3>
<p>In order to cause a specific test to run by itself on the machine and not at
the same time as other tests (such as when running multiple tests at the same
time with something like <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-j16</span></code>), set at configure time:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">fullTestName</span><span class="o">&gt;</span><span class="n">_SET_RUN_SERIAL</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>This will set the CTest test property <code class="docutils literal notranslate"><span class="pre">RUN_SERIAL</span></code> for the test
<code class="docutils literal notranslate"><span class="pre">&lt;fullTestName&gt;</span></code>.</p>
<p>This can help to avoid longer runtimes and timeouts when some individual tests
don’t run as quickly when run beside other tests running at the same time on
the same machine.  These longer runtimes can often occur when running tests
with CUDA code on GPUs and with OpenMP code on some platforms with some OpenMP
options.</p>
<p>Also, if individual tests have <code class="docutils literal notranslate"><span class="pre">RUN_SERIAL</span></code> set by default internally, they
can have the <code class="docutils literal notranslate"><span class="pre">RUN_SERIAL</span></code> property removed by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">fullTestName</span><span class="o">&gt;</span><span class="n">_SET_RUN_SERIAL</span><span class="o">=</span><span class="n">OFF</span>
</pre></div>
</div>
</div>
<div class="section" id="trace-test-addition-or-exclusion">
<h3><a class="toc-backref" href="#id57"><span class="sectnum">4.25.6</span> Trace test addition or exclusion</a><a class="headerlink" href="#trace-test-addition-or-exclusion" title="Permalink to this headline">¶</a></h3>
<p>To see what tests get added and see those that don’t get added for various
reasons, configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_TRACE_ADD_TEST</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>That will print one line per test and will show if the test got added or not.
If the test is added, it shows some of the key test properties.  If the test
did not get added, then this line will show why the test was not added
(i.e. due to criteria related to the test’s <code class="docutils literal notranslate"><span class="pre">COMM</span></code>, <code class="docutils literal notranslate"><span class="pre">NUM_MPI_PROCS</span></code>,
<code class="docutils literal notranslate"><span class="pre">CATEGORIES</span></code>, <code class="docutils literal notranslate"><span class="pre">HOST</span></code>, <code class="docutils literal notranslate"><span class="pre">XHOST</span></code>, <code class="docutils literal notranslate"><span class="pre">HOSTTYPE</span></code>, or <code class="docutils literal notranslate"><span class="pre">XHOSTTYPE</span></code>
arguments).</p>
</div>
<div class="section" id="enable-advanced-test-start-and-end-times-and-timing-blocks">
<h3><a class="toc-backref" href="#id58"><span class="sectnum">4.25.7</span> Enable advanced test start and end times and timing blocks</a><a class="headerlink" href="#enable-advanced-test-start-and-end-times-and-timing-blocks" title="Permalink to this headline">¶</a></h3>
<p>For tests added using <code class="docutils literal notranslate"><span class="pre">tribits_add_advanced_test()</span></code>, one can see start and
end times for the tests and the timing for each <code class="docutils literal notranslate"><span class="pre">TEST_&lt;IDX&gt;</span></code> block in the
detailed test output by configuring with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_SHOW_TEST_START_END_DATE_TIME</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>The implementation of this feature currently uses <code class="docutils literal notranslate"><span class="pre">execute_process(date)</span></code>
and therefore will only work on many (but perhaps not all) Linux/Unix/Mac
systems and not native Windows systems.</p>
</div>
<div class="section" id="setting-test-timeouts-at-configure-time">
<h3><a class="toc-backref" href="#id59"><span class="sectnum">4.25.8</span> Setting test timeouts at configure time</a><a class="headerlink" href="#setting-test-timeouts-at-configure-time" title="Permalink to this headline">¶</a></h3>
<p id="dart-testing-timeout">A maximum default time limit (timeout) for all the tests can be set at
configure time using the cache variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">DART_TESTING_TIMEOUT</span><span class="o">=&lt;</span><span class="n">maxSeconds</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;maxSeconds&gt;</span></code> is the number of wall-clock seconds.  The default for
most projects is 1500 seconds (see the default value set in the CMake cache).
This value gets scaled by <a class="reference internal" href="#project-scale-test-timeout">&lt;Project&gt;_SCALE_TEST_TIMEOUT</a> and then set as the
field <code class="docutils literal notranslate"><span class="pre">TimeOut</span></code> in the CMake-generated file <code class="docutils literal notranslate"><span class="pre">DartConfiguration.tcl</span></code>.  The
value <code class="docutils literal notranslate"><span class="pre">TimeOut</span></code> from this file is what is directly read by the <code class="docutils literal notranslate"><span class="pre">ctest</span></code>
executable.  Timeouts for tests are important.  For example, when an MPI
program has a defect, it can easily hang (forever) until it is manually
killed.  If killed by a timeout, CTest will kill the test process and all of
its child processes correctly.</p>
<p>NOTES:</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">DART_TESTING_TIMEOUT</span></code> is not explicitly set by the user, then the
projects gives it a default value (typically 1500 seconds but see the value
in the CMakeCache.txt file).</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">DART_TESTING_TIMEOUT</span></code> is explicitly set to empty
(i.e. <code class="docutils literal notranslate"><span class="pre">-DDART_TESTING_TIMEOUT=</span></code>), then by default tests have no timeout
and can run forever until manually killed.</p></li>
<li><p>Individual tests may have their timeout limit set on a test-by-test basis
internally in the project’s <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> files (see the <code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code>
argument for <code class="docutils literal notranslate"><span class="pre">tribits_add_test()</span></code> and <code class="docutils literal notranslate"><span class="pre">tribits_add_advanced_test()</span></code>).
When this is the case, the global timeout set with <code class="docutils literal notranslate"><span class="pre">DART_TESTING_TIMEOUT</span></code>
has no impact on these individually set test timeouts.</p></li>
<li><p>Be careful not set the global test timeout too low since if a machine
becomes loaded tests can take longer to run and may result in timeouts that
would not otherwise occur.</p></li>
<li><p>The value of <code class="docutils literal notranslate"><span class="pre">DART_TESTING_TIMEOUT</span></code> and the timeouts for individual tests
can be scaled up or down using the cache variable
<a class="reference internal" href="#project-scale-test-timeout">&lt;Project&gt;_SCALE_TEST_TIMEOUT</a>.</p></li>
<li><p>To set or override the default global test timeout limit at runtime, see
<a class="reference internal" href="#overriding-test-timeouts">Overriding test timeouts</a>.</p></li>
</ul>
</div>
<div class="section" id="scaling-test-timeouts-at-configure-time">
<h3><a class="toc-backref" href="#id60"><span class="sectnum">4.25.9</span> Scaling test timeouts at configure time</a><a class="headerlink" href="#scaling-test-timeouts-at-configure-time" title="Permalink to this headline">¶</a></h3>
<p id="project-scale-test-timeout">The global default test timeout <a class="reference internal" href="#dart-testing-timeout">DART_TESTING_TIMEOUT</a> as well as all of the
timeouts for the individual tests that have their own timeout set (through the
<code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code> argument for each individual test) can be scaled by a constant
factor <code class="docutils literal notranslate"><span class="pre">&lt;testTimeoutScaleFactor&gt;</span></code> by configuring with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_SCALE_TEST_TIMEOUT</span><span class="o">=&lt;</span><span class="n">testTimeoutScaleFactor</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">&lt;testTimeoutScaleFactor&gt;</span></code> can be an integral number like <code class="docutils literal notranslate"><span class="pre">5</span></code> or can
be fractional number like <code class="docutils literal notranslate"><span class="pre">1.5</span></code>.</p>
<p>This feature is generally used to compensate for slower machines or overloaded
test machines and therefore only scaling factors greater than 1 are to be
used.  The primary use case for this feature is to add large scale factors
(e.g. <code class="docutils literal notranslate"><span class="pre">40</span></code> to <code class="docutils literal notranslate"><span class="pre">100</span></code>) to compensate for running tests using valgrind (see
<a class="reference internal" href="#running-memory-checking">Running memory checking</a>) but this can also be used for debug-mode builds
that create tests which run more slowly than for full release-mode optimized
builds.</p>
<p>NOTES:</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_SCALE_TEST_TIMEOUT</span></code> is not set, the the default value is set
to <code class="docutils literal notranslate"><span class="pre">1.0</span></code> (i.e. no scaling of test timeouts).</p></li>
<li><p>When scaling the timeouts, the timeout is first truncated to integral
seconds so an original timeout like <code class="docutils literal notranslate"><span class="pre">200.5</span></code> will be truncated to <code class="docutils literal notranslate"><span class="pre">200</span></code>
before it gets scaled.</p></li>
<li><p>Only the first fractional digit of <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_SCALE_TEST_TIMEOUT</span></code> is used
so <code class="docutils literal notranslate"><span class="pre">1.57</span></code> is truncated to <code class="docutils literal notranslate"><span class="pre">1.5</span></code>, for example, before scaling the test
timeouts.</p></li>
<li><p>The value of the variable <a class="reference internal" href="#dart-testing-timeout">DART_TESTING_TIMEOUT</a> is not changed in the
<code class="docutils literal notranslate"><span class="pre">CMakeCache.txt</span></code> file.  Only the value of <code class="docutils literal notranslate"><span class="pre">TimeOut</span></code> written into the
<code class="docutils literal notranslate"><span class="pre">DartConfiguration.tcl</span></code> file (which is directly read by <code class="docutils literal notranslate"><span class="pre">ctest</span></code>) will be
scaled.  (This ensures that running configure over and over again will not
increase <code class="docutils literal notranslate"><span class="pre">DART_TESTING_TIMEOUT</span></code> or <code class="docutils literal notranslate"><span class="pre">TimeOut</span></code> with each new configure.)</p></li>
</ul>
</div>
<div class="section" id="spreading-out-and-limiting-tests-running-on-gpus">
<h3><a class="toc-backref" href="#id61"><span class="sectnum">4.25.10</span> Spreading out and limiting tests running on GPUs</a><a class="headerlink" href="#spreading-out-and-limiting-tests-running-on-gpus" title="Permalink to this headline">¶</a></h3>
<p>For CUDA builds (i.e. <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_CUDA=ON</span></code>) with tests that run on a single
node which has multiple GPUs, there are settings that can help <code class="docutils literal notranslate"><span class="pre">ctest</span></code>
spread out the testing load over all of the GPUs and limit the number of
kernels that can run at the same time on a single GPU.</p>
<p>To instruct <code class="docutils literal notranslate"><span class="pre">ctest</span></code> to spread out the load on multiple GPUs, one can set the
following configure-time options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">TPL_ENABLE_CUDA</span><span class="o">=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_AUTOGENERATE_TEST_RESOURCE_FILE</span><span class="o">=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_CUDA_NUM_GPUS</span><span class="o">=&lt;</span><span class="n">num</span><span class="o">-</span><span class="n">gpus</span><span class="o">&gt;</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_CUDA_SLOTS_PER_GPU</span><span class="o">=&lt;</span><span class="n">slots</span><span class="o">-</span><span class="n">per</span><span class="o">-</span><span class="n">gpu</span><span class="o">&gt;</span> \
</pre></div>
</div>
<p>This will cause a file <code class="docutils literal notranslate"><span class="pre">ctest_resources.json</span></code> to get generated in the base
build directory that CTest will use to spread out the work across the
<code class="docutils literal notranslate"><span class="pre">&lt;num-gpus&gt;</span></code> GPUs with a maximum of <code class="docutils literal notranslate"><span class="pre">&lt;slots-per-gpu&gt;</span></code> processes running
kernels on any one GPU.  (This uses the <a class="reference external" href="https://cmake.org/cmake/help/latest/manual/ctest.1.html#resource-allocation">CTest Resource Allocation System</a>
first added in CMake 3.16 and made more usable in CMake 3.18.)</p>
<p>For example, when running on one node on a system with 4 GPUs per node
(allowing 5 kernels to run at a time on a single GPU) one would configure
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">TPL_ENABLE_CUDA</span><span class="o">=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_AUTOGENERATE_TEST_RESOURCE_FILE</span><span class="o">=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_CUDA_NUM_GPUS</span><span class="o">=</span><span class="mi">4</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_CUDA_SLOTS_PER_GPU</span><span class="o">=</span><span class="mi">5</span> \
</pre></div>
</div>
<p>This allows, for example, up to 5 tests using 4-rank MPI jobs, or 10 tests
using 2-rank MPI jobs, or 20 tests using 1-rank MPI jobs, to run at the same
time (or any combination of tests that add up to 20 or less total MPI
processes to run a the same time).  But a single 21-rank or above MPI test job
would not be allowed to run and would be listed as “Not Run” because it would
have required more than <code class="docutils literal notranslate"><span class="pre">&lt;slots-per-gpu&gt;</span> <span class="pre">=</span> <span class="pre">5</span></code> MPI processes running kernels
at one time on a single GPU.  (Therefore, one must set <code class="docutils literal notranslate"><span class="pre">&lt;slots-per-gpu&gt;</span></code>
large enough to allow all of the defined tests to run or one should avoid
defining tests that require too many slots for available GPUs.)</p>
<p>The CTest implementation uses a breath-first approach to spread out the work
across all the available GPUs before adding more work for each GPU.  For
example, when running two 2-rank MPI tests at the same time (e.g. using
<code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-j4</span></code>) in the above example, CTest will instruct these tests at
runtime to spread out across all 4 GPUs and therefore run the CUDA kernels for
just one MPI process on each GPU.  But when running four 2-rank MPI tests at
the same time (e.g. using <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-j8</span></code>), then each of the 4 GPUs would get
the work of two MPI processes (i.e. running two kernels at a time on each of
the 4 GPUs).</p>
<p>One can also manually create a <a class="reference external" href="https://cmake.org/cmake/help/latest/manual/ctest.1.html#ctest-resource-specification-file">CTest Resource Specification File</a> and point
to it by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">TPL_ENABLE_CUDA</span><span class="o">=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="n">CTEST_RESOURCE_SPEC_FILE</span><span class="o">=&lt;</span><span class="n">file</span><span class="o">-</span><span class="n">path</span><span class="o">&gt;</span> \
</pre></div>
</div>
<p>In all cases, ctest will not spread out and limit running on the GPUs unless
<code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_CUDA=ON</span></code> is set which causes TriBITS to add the
<a class="reference external" href="https://cmake.org/cmake/help/latest/prop_test/RESOURCE_GROUPS.html#prop_test:RESOURCE_GROUPS">RESOURCE_GROUPS</a> test property to each test.</p>
<p>NOTES:</p>
<ul class="simple">
<li><p>This setup assumes that a single MPI process will run just one kernel on its
assigned GPU and therefore take up one GPU “slot”.  So a 2-rank MPI test
will take up 2 total GPU “slots” (either on the same or two different GPUs,
as determined by CTest).</p></li>
<li><p>The underlying test executables/scripts themselves must be set up to read in
the <a class="reference external" href="https://cmake.org/cmake/help/latest/manual/ctest.1.html#environment-variables">CTest Resource Allocation Environment Variables</a> set specifically by
<code class="docutils literal notranslate"><span class="pre">ctest</span></code> on the fly for each test and then must run on the specific GPUs
specified in those environment variables.  (If the project is using a Kokkos
back-end implementation for running CUDA code on the GPU then this will work
automatically since Kokkos is set up to automatically look for these
CTest-set environment variables.  Without this CTest and TriBITS
implementation, when running 2-rank MPI tests on a node with 4 GPUs, Kokkos
would just utilize the first two GPUs and leave the other two GPUs idle.
One when running 1-rank MPI tests, Kokkos would only utilize the first GPU
and leave the last three GPUs idle.)</p></li>
<li><p>The option <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_AUTOGENERATE_TEST_RESOURCE_FILE=ON</span></code> sets the
built-in CMake variable <code class="docutils literal notranslate"><span class="pre">CTEST_RESOURCE_SPEC_FILE</span></code> to point to the
generated file <code class="docutils literal notranslate"><span class="pre">ctest_resources.json</span></code> in the build directory.</p></li>
<li><p>One can avoid setting the CMake cache variables
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_AUTOGENERATE_TEST_RESOURCE_FILE</span></code> or
<code class="docutils literal notranslate"><span class="pre">CTEST_RESOURCE_SPEC_FILE</span></code> at configure time and can instead directly pass
the path to the <a class="reference external" href="https://cmake.org/cmake/help/latest/manual/ctest.1.html#ctest-resource-specification-file">CTest Resource Specification File</a> directly into <code class="docutils literal notranslate"><span class="pre">ctest</span></code>
using the command-line option <code class="docutils literal notranslate"><span class="pre">--resource-spec-file</span></code> or the
<code class="docutils literal notranslate"><span class="pre">ctest_test()</span></code> function argument <code class="docutils literal notranslate"><span class="pre">RESOURCE_SPEC_FILE</span></code> (when using a
<code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-S</span></code> script driver).  (This allows using CMake 3.16+ since support
for the <code class="docutils literal notranslate"><span class="pre">CTEST_RESOURCE_SPEC_FILE</span></code> cache variable was not added until
CMake 3.18.)</p></li>
<li><p>CMake versions 3.18+ can be used to get built-in CMake/CTest support for the
<code class="docutils literal notranslate"><span class="pre">CTEST_RESOURCE_SPEC_FILE</span></code> cache variable.  This avoids needing to
explicitly pass the ctest resource file to <code class="docutils literal notranslate"><span class="pre">ctest</span></code> at runtime for
CMake/CTest versions 3.17.z.</p></li>
<li><p><strong>WARNING:</strong> This currently only works for a single node, not multiple
nodes.  (CTest needs to be extended to work correctly for multiple nodes
where each node has multiple GPUs.  Alternatively, TriBITS could be extended
to make this work for multiple nodes but will require considerable work and
will need to closely interact with the MPI launcher to control what nodes
are run on for each MPI job/test.)</p></li>
<li><p><strong>WARNING:</strong> This feature is still evolving in CMake/CTest and TriBITS and
therefore the input options and behavior of this may change in the future.</p></li>
</ul>
</div>
</div>
<div class="section" id="enabling-support-for-coverage-testing">
<h2><a class="toc-backref" href="#id62"><span class="sectnum">4.26</span> Enabling support for coverage testing</a><a class="headerlink" href="#enabling-support-for-coverage-testing" title="Permalink to this headline">¶</a></h2>
<p>To turn on support for coverage testing set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_COVERAGE_TESTING</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>This will set compile and link options -fprofile-arcs -ftest-coverage for GCC.
Use ‘make dashboard’ (see below) to submit coverage results to CDash</p>
</div>
<div class="section" id="viewing-configure-options-and-documentation">
<h2><a class="toc-backref" href="#id63"><span class="sectnum">4.27</span> Viewing configure options and documentation</a><a class="headerlink" href="#viewing-configure-options-and-documentation" title="Permalink to this headline">¶</a></h2>
<ol class="loweralpha simple">
<li><p>Viewing available configure-time options with documentation:</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd $BUILD_DIR
$ rm -rf CMakeCache.txt CMakeFiles/
$ cmake -LAH -D &lt;Project&gt;_ENABLE_ALL_PACKAGES=ON \
  $SOURCE_BASE
</pre></div>
</div>
<p>You can also just look at the text file CMakeCache.txt after configure which
gets created in the build directory and has all of the cache variables and
documentation.</p>
</div></blockquote>
<ol class="loweralpha simple" start="2">
<li><p>Viewing available configure-time options without documentation:</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd $BUILD_DIR
$ rm -rf CMakeCache.txt CMakeFiles/
$ cmake -LA &lt;SAME_AS_ABOVE&gt; $SOURCE_BASE
</pre></div>
</div>
</div></blockquote>
<ol class="loweralpha simple" start="3">
<li><p>Viewing current values of cache variables:</p></li>
</ol>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cmake -LA $SOURCE_BASE
</pre></div>
</div>
<p>or just examine and grep the file CMakeCache.txt.</p>
</div></blockquote>
</div>
<div class="section" id="enabling-extra-repositories-with-add-on-packages">
<h2><a class="toc-backref" href="#id64"><span class="sectnum">4.28</span> Enabling extra repositories with add-on packages:</a><a class="headerlink" href="#enabling-extra-repositories-with-add-on-packages" title="Permalink to this headline">¶</a></h2>
<p id="project-extra-repositories">To configure &lt;Project&gt; with an post extra set of packages in extra TriBITS
repositories, configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_EXTRA_REPOSITORIES</span><span class="o">=</span><span class="s2">&quot;&lt;REPO0&gt;,&lt;REPO1&gt;,...&quot;</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">&lt;REPOi&gt;</span></code> is the name of an extra repository that typically has been
cloned under the main &lt;Project&gt; source directory as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;/&lt;</span><span class="n">REPOi</span><span class="o">&gt;/</span>
</pre></div>
</div>
<p>For example, to add the packages from SomeExtraRepo one would configure as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd $SOURCE_BASE_DIR
$ git clone some_url.com/some/dir/SomeExtraRepo
$ cd $BUILD_DIR
$ ./do-configure -D&lt;Project&gt;_EXTRA_REPOSITORIES=SomeExtraRepo \
  [Other Options]
</pre></div>
</div>
<p>After that, all of the extra packages defined in <code class="docutils literal notranslate"><span class="pre">SomeExtraRepo</span></code> will appear
in the list of official &lt;Project&gt; packages (after all of the native packages)
and one is free to enable any of the defined add-on packages just like any
other native &lt;Project&gt; package.</p>
<p>NOTE: If <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_EXTRAREPOS_FILE</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_KNOWN_EXTERNAL_REPOS_TYPE</span></code> are specified, then the list of
extra repositories in <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_EXTRA_REPOSITORIES</span></code> must be a subset and in
the same order as the list extra repos read in from the file specified by
<a class="reference internal" href="#project-extrarepos-file">&lt;Project&gt;_EXTRAREPOS_FILE</a>.  (Also see the variable
<a class="reference internal" href="#project-pre-repositories">&lt;Project&gt;_PRE_REPOSITORIES</a> as well.)</p>
</div>
<div class="section" id="enabling-extra-repositories-through-a-file">
<h2><a class="toc-backref" href="#id65"><span class="sectnum">4.29</span> Enabling extra repositories through a file</a><a class="headerlink" href="#enabling-extra-repositories-through-a-file" title="Permalink to this headline">¶</a></h2>
<p id="project-enable-known-external-repos-type"><span id="project-extrarepos-file"></span>In order to provide the list of extra TriBITS repositories containing add-on
packages from a file, configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_EXTRAREPOS_FILE</span><span class="p">:</span><span class="n">FILEPATH</span><span class="o">=&lt;</span><span class="n">EXTRAREPOSFILE</span><span class="o">&gt;</span> \
<span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_KNOWN_EXTERNAL_REPOS_TYPE</span><span class="o">=</span><span class="n">Continuous</span>
</pre></div>
</div>
<p>Specifying extra repositories through an extra repos file allows greater
flexibility in the specification of extra repos.  This is not needed for a
basic configure of the project but is useful in generating version information
using <a class="reference internal" href="#project-generate-version-date-files">&lt;Project&gt;_GENERATE_VERSION_DATE_FILES</a> and
<a class="reference internal" href="#project-generate-repo-version-file">&lt;Project&gt;_GENERATE_REPO_VERSION_FILE</a> as well as in automated testing using
the ctest -S scripts with the <code class="docutils literal notranslate"><span class="pre">tribits_ctest_driver()</span></code> function and the
<code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool.</p>
<p>The valid values of <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_KNOWN_EXTERNAL_REPOS_TYPE</span></code> include
<code class="docutils literal notranslate"><span class="pre">Continuous</span></code>, <code class="docutils literal notranslate"><span class="pre">Nightly</span></code>, and <code class="docutils literal notranslate"><span class="pre">Experimental</span></code>.  Only repositories listed
in the file <code class="docutils literal notranslate"><span class="pre">&lt;EXTRAREPOSFILE&gt;</span></code> that match this type will be included.  Note
that <code class="docutils literal notranslate"><span class="pre">Nightly</span></code> matches <code class="docutils literal notranslate"><span class="pre">Continuous</span></code> and <code class="docutils literal notranslate"><span class="pre">Experimental</span></code> matches
<code class="docutils literal notranslate"><span class="pre">Nightly</span></code> and <code class="docutils literal notranslate"><span class="pre">Continuous</span></code> and therefore includes all repos by default.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_IGNORE_MISSING_EXTRA_REPOSITORIES</span></code> is set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then
any extra repositories selected who’s directory is missing will be ignored.
This is useful when the list of extra repos that a given developer develops or
tests is variable and one just wants TriBITS to pick up the list of existing
repos automatically.</p>
<p>If the file <code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</span></code> exists, then it
is used as the default value for <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_EXTRAREPOS_FILE</span></code>.  However, the
default value for <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_KNOWN_EXTERNAL_REPOS_TYPE</span></code> is empty so
no extra repositories are defined by default unless
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_KNOWN_EXTERNAL_REPOS_TYPE</span></code> is specifically set to one of
the allowed values.</p>
<p id="project-pre-repositories">NOTE: The set of extra repositories listed in the file
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_EXTRAREPOS_FILE</span></code> can be filtered down by setting the variables
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_PRE_REPOSITORIES</span></code> if PRE extra repos are listed and/or
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_EXTRA_REPOSITORIES</span></code> if POST extra repos are listed.</p>
</div>
<div class="section" id="selecting-a-different-source-location-for-a-package">
<h2><a class="toc-backref" href="#id66"><span class="sectnum">4.30</span> Selecting a different source location for a package</a><a class="headerlink" href="#selecting-a-different-source-location-for-a-package" title="Permalink to this headline">¶</a></h2>
<p>The source location for any package can be changed by configuring with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;</span><span class="n">_SOURCE_DIR_OVERRIDE</span><span class="p">:</span><span class="n">STRING</span><span class="o">=&lt;</span><span class="n">path</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">&lt;path&gt;</span></code> can be a relative path or an absolute path, but in both cases
must be under the project source directory (otherwise, an error will occur).
The relative path will then become the relative path for the package under the
binary tree as well.</p>
<p>This can be used, for example, to use a different repository for the
implementation of a package that is otherwise snapshotted into the base
project source repository (e.g. Kokkos in Trilinos).</p>
</div>
<div class="section" id="reconfiguring-completely-from-scratch">
<h2><a class="toc-backref" href="#id67"><span class="sectnum">4.31</span> Reconfiguring completely from scratch</a><a class="headerlink" href="#reconfiguring-completely-from-scratch" title="Permalink to this headline">¶</a></h2>
<p>To reconfigure from scratch, one needs to delete the the <code class="docutils literal notranslate"><span class="pre">CMakeCache.txt</span></code>
and base-level <code class="docutils literal notranslate"><span class="pre">CMakeFiles/</span></code> directory, for example, as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rm -rf CMakeCache.txt CMakeFiles/
$ ./do-configure [options]
</pre></div>
</div>
<p>Removing the <code class="docutils literal notranslate"><span class="pre">CMakeCache.txt</span></code> file is often needed when removing variables
from the configure line since they are already in the cache.  Removing the
<code class="docutils literal notranslate"><span class="pre">CMakeFiles/</span></code> directories is needed if there are changes in some CMake
modules or the CMake version itself.  However, usually removing just the
top-level <code class="docutils literal notranslate"><span class="pre">CMakeCache.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">CMakeFiles/</span></code> directory is enough to
guarantee a clean reconfigure from a dirty build directory.</p>
<p>If one really wants a clean slate, then try:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rm -rf `ls | grep -v do-configure`
$ ./do-configure [options]
</pre></div>
</div>
</div>
<div class="section" id="viewing-configure-errors">
<h2><a class="toc-backref" href="#id68"><span class="sectnum">4.32</span> Viewing configure errors</a><a class="headerlink" href="#viewing-configure-errors" title="Permalink to this headline">¶</a></h2>
<p>To view various configure errors, read the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$BUILD_BASE_DIR/CMakeFiles/CMakeError.log
</pre></div>
</div>
<p>This file contains detailed output from try-compile commands, Fortran/C name
mangling determination, and other CMake-specific information.</p>
</div>
<div class="section" id="adding-configure-timers">
<h2><a class="toc-backref" href="#id69"><span class="sectnum">4.33</span> Adding configure timers</a><a class="headerlink" href="#adding-configure-timers" title="Permalink to this headline">¶</a></h2>
<p>To add timers to various configure steps, configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_CONFIGURE_TIMING</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>This will do baulk timing for the major configure steps which is independent
of the number of packages in the project.</p>
<p>To additionally add timing for the configure of individual packages, configure
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_CONFIGURE_TIMING</span><span class="o">=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_PACKAGE_CONFIGURE_TIMING</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>If you are configuring a large number of packages (perhaps by including a lot
of add-on packages in extra repos) then you might not want to enable
package-by-package timing since it can add some significant overhead to the
configure times.</p>
<p>If you just want to time individual packages instead, you can enable that
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_CONFIGURE_TIMING</span><span class="o">=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE_0</span><span class="o">&gt;</span><span class="n">_PACKAGE_CONFIGURE_TIMING</span><span class="o">=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE_1</span><span class="o">&gt;</span><span class="n">_PACKAGE_CONFIGURE_TIMING</span><span class="o">=</span><span class="n">ON</span> \
<span class="o">...</span>
</pre></div>
</div>
<p>NOTES:</p>
<ul class="simple">
<li><p>This requires that you are running on a Linux/Unix system that has the
standard shell command <code class="docutils literal notranslate"><span class="pre">date</span></code>.  CMake does not have built-in timing
functions so this system command needs to be used instead.  This will report
timings to 0.001 seconds but note that the overall configure time will go up
due to the increased overhead of calling <code class="docutils literal notranslate"><span class="pre">date</span></code> as a process shell
command.</p></li>
<li><p>‘’’WARNING:’’’ Because this feature has to call the <code class="docutils literal notranslate"><span class="pre">data</span></code> using CMake’s
<code class="docutils literal notranslate"><span class="pre">execute_process()</span></code> command, it can be expensive.  Therefore, this should
really only be turned on for large projects (where the extra overhead is
small) or for smaller projects for extra informational purposes.</p></li>
</ul>
</div>
<div class="section" id="generating-export-files">
<h2><a class="toc-backref" href="#id70"><span class="sectnum">4.34</span> Generating export files</a><a class="headerlink" href="#generating-export-files" title="Permalink to this headline">¶</a></h2>
<p>The project &lt;Project&gt; can generate export files for external CMake projects or
external Makefile projects.  These export files provide the lists of
libraries, include directories, compilers and compiler options, etc.</p>
<p>To configure to generate CMake export files for the project, configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_INSTALL_CMAKE_CONFIG_FILES</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>This will generate the file <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;Config.cmake</span></code> for the project and the
files <code class="docutils literal notranslate"><span class="pre">&lt;Package&gt;Config.cmake</span></code> for each enabled package in the build tree.
In addition, this will install versions of these files into the install tree.</p>
<p>To configure Makefile export files, configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_EXPORT_MAKEFILES</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>which will generate the file <code class="docutils literal notranslate"><span class="pre">Makefile.export.&lt;Project&gt;</span></code> for the project and
the files <code class="docutils literal notranslate"><span class="pre">Makefile.export.&lt;Package&gt;</span></code> for each enabled package in the build
tree.  In addition, this will install versions of these files into the install
tree.</p>
<p>The list of export files generated can be reduced by specifying the exact list
of packages the files are requested for with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_GENERATE_EXPORT_FILES_FOR_ONLY_LISTED_SE_PACKAGES</span><span class="o">=</span><span class="s2">&quot;&lt;pkg0&gt;;&lt;pkg1&gt;&quot;</span>
</pre></div>
</div>
<p>NOTES:</p>
<ul class="simple">
<li><p>Only enabled packages will have their export files generated.</p></li>
<li><p>One would only want to limit the export files generated for very large
projects where the cost my be high for doing so.</p></li>
</ul>
</div>
<div class="section" id="generating-a-project-repo-version-file">
<h2><a class="toc-backref" href="#id71"><span class="sectnum">4.35</span> Generating a project repo version file</a><a class="headerlink" href="#generating-a-project-repo-version-file" title="Permalink to this headline">¶</a></h2>
<p id="project-generate-repo-version-file">When working with local git repos for the project sources, one can generate a
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;RepoVersion.txt</span></code> file which lists all of the repos and their
current versions using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_GENERATE_REPO_VERSION_FILE</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>This will cause a <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;RepoVersion.txt</span></code> file to get created in the
binary directory, get installed in the install directory, and get included in
the source distribution tarball.</p>
<p>NOTE: If the base <code class="docutils literal notranslate"><span class="pre">.git/</span></code> directory is missing, then no
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;RepoVersion.txt</span></code> file will get generated and a <code class="docutils literal notranslate"><span class="pre">NOTE</span></code> message is
printed to cmake STDOUT.</p>
</div>
<div class="section" id="generating-git-version-date-files">
<h2><a class="toc-backref" href="#id72"><span class="sectnum">4.36</span> Generating git version date files</a><a class="headerlink" href="#generating-git-version-date-files" title="Permalink to this headline">¶</a></h2>
<p id="project-generate-version-date-files">When working with local git repos for the project sources, one can generate
the files <code class="docutils literal notranslate"><span class="pre">VersionDate.cmake</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_version_date.h</span></code> in the build
directory by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_GENERATE_VERSION_DATE_FILES</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>These files are generated in the build directory and the file
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_version_date.h</span></code> is installed in the installation directory.  (In
addition, these files are also generated for each extra repository that are
also version-controlled repos, see <a class="reference internal" href="#project-extrarepos-file">&lt;Project&gt;_EXTRAREPOS_FILE</a>.)</p>
<p>These files contain <code class="docutils literal notranslate"><span class="pre">&lt;PROJECT_NAME_UC&gt;_VERSION_DATE</span></code> which is a 10-digit
date-time version integer.  This integer is created by first using git to
extract the commit date for <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> using the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="n">TZ</span><span class="o">=</span><span class="n">GMT</span> <span class="n">git</span> <span class="n">log</span> <span class="o">--</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%c</span><span class="s2">d&quot;</span> <span class="o">--</span><span class="n">date</span><span class="o">=</span><span class="n">iso</span><span class="o">-</span><span class="n">local</span> <span class="o">-</span><span class="mi">1</span> <span class="n">HEAD</span>
</pre></div>
</div>
<p>which returns the date and time for the commit date of <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> in the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;YYYY-MM-DD hh:mm:ss +0000&quot;</span>
</pre></div>
</div>
<p>This git commit date is then is used to create a 10-digit date/time integer of
the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">YYYYMMDDhh</span>
</pre></div>
</div>
<p>This 10-digit integer is set to a CMake variable
<code class="docutils literal notranslate"><span class="pre">&lt;PROJECT_NAME_UC&gt;_VERSION_DATE</span></code> in the generated <code class="docutils literal notranslate"><span class="pre">VersionDate.cmake</span></code> file
and a C/C++ preprocessor macro <code class="docutils literal notranslate"><span class="pre">&lt;PROJECT_NAME_UC&gt;_VERSION_DATE</span></code> in the
generated <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_version_date.h</span></code> header file.</p>
<p>This 10-digit date/time integer <code class="docutils literal notranslate"><span class="pre">YYYYMMDDhh</span></code> will fit in a signed 32-bit
integer with a maximum value of <code class="docutils literal notranslate"><span class="pre">2^32</span> <span class="pre">/</span> <span class="pre">2</span> <span class="pre">-</span> <span class="pre">1</span></code> = <code class="docutils literal notranslate"><span class="pre">2147483647</span></code>.  Therefore,
the maximum date that can be handled is the year 2147 with the max date/time
of <code class="docutils literal notranslate"><span class="pre">2147</span> <span class="pre">12</span> <span class="pre">31</span> <span class="pre">23</span></code> = <code class="docutils literal notranslate"><span class="pre">2147123123</span></code>.</p>
<p>The file <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_version_date.h</span></code> is meant to be included by downstream
codes to determine the version of <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;</span></code> being used and allows
<code class="docutils literal notranslate"><span class="pre">&lt;PROJECT_NAME_UC&gt;_VERSION_DATE</span></code> to be used in C/C++ <code class="docutils literal notranslate"><span class="pre">ifdefs</span></code> like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#if defined(&lt;PROJECT_NAME_UC&gt;_VERSION_DATE) &amp;&amp; &lt;PROJECT_NAME_UC&gt;_VERSION_DATE &gt;= 2019032704</span>
  <span class="o">/*</span> <span class="n">The</span> <span class="n">version</span> <span class="ow">is</span> <span class="n">newer</span> <span class="n">than</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">27</span> <span class="mi">04</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">UTC</span> <span class="o">*/</span>
  <span class="o">...</span>
<span class="c1">#else</span>
  <span class="o">/*</span> <span class="n">The</span> <span class="n">version</span> <span class="ow">is</span> <span class="n">older</span> <span class="n">than</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">27</span> <span class="mi">04</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span> <span class="n">UTC</span> <span class="o">*/</span>
  <span class="o">...</span>
<span class="c1">#endif</span>
</pre></div>
</div>
<p>This allows downstream codes to know the fine-grained version of &lt;Project&gt; at
configure and build time to adjust for the addition of new features,
deprecation of code, or breaks in backward compatibility (which occur in
specific commits with unique commit dates).</p>
<p>NOTE: If the branch is not hard-reset then the first-parent commits on that
branch will have monotonically increasing git commit dates (adjusted for UTC).
This assumption is required for the correct usage of the
<code class="docutils literal notranslate"><span class="pre">&lt;PROJECT_NAME_UC&gt;_VERSION_DATE</span></code> macro as demonstrated above.</p>
<p>NOTE: If the base <code class="docutils literal notranslate"><span class="pre">.git/</span></code> directory is missing or the version of git is not
2.10.0 or greater (needed for the <code class="docutils literal notranslate"><span class="pre">--date=iso-local</span></code> argument), then the
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_version_date.h</span></code> file will still get generated but will have an
undefined macro <code class="docutils literal notranslate"><span class="pre">&lt;PROJECT_NAME_UC&gt;_VERSION_DATE</span></code> and a <code class="docutils literal notranslate"><span class="pre">NOTE</span></code> message will
be printed to cmake STDOUT.</p>
</div>
<div class="section" id="cmake-configure-time-development-mode-and-debug-checking">
<h2><a class="toc-backref" href="#id73"><span class="sectnum">4.37</span> CMake configure-time development mode and debug checking</a><a class="headerlink" href="#cmake-configure-time-development-mode-and-debug-checking" title="Permalink to this headline">¶</a></h2>
<p>To turn off CMake configure-time development-mode checking, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_DEVELOPMENT_MODE</span><span class="o">=</span><span class="n">OFF</span>
</pre></div>
</div>
<p>This turns off a number of CMake configure-time checks for the &lt;Project&gt;
TriBITS/CMake files including checking the package dependencies and other
usage of TriBITS.  These checks can be expensive and may also not be
appropriate for a tarball release of the software.  However, this also turns
off strong compiler warnings so this is not recommended by default (see
<a class="reference internal" href="#tribits-package-disable-strong-warnings">&lt;TRIBITS_PACKAGE&gt;_DISABLE_STRONG_WARNINGS</a>).  For a release of &lt;Project&gt;
this option is set OFF by default.</p>
<p>One of the CMake configure-time debug-mode checks performed as part of
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_DEVELOPMENT_MODE=ON</span></code> is to assert the existence of TriBITS
package directories.  In development mode, the failure to find a package
directory is usually a programming error (i.e. a miss-spelled package
directory name).  But in a tarball release of the project, package directories
may be purposefully missing (see <a class="reference internal" href="#creating-a-tarball-of-the-source-tree">Creating a tarball of the source tree</a>) and
must be ignored.  When building from a reduced source tarball created from the
development sources, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ASSERT_MISSING_PACKAGES</span><span class="o">=</span><span class="n">OFF</span>
</pre></div>
</div>
<p>Setting this <code class="docutils literal notranslate"><span class="pre">OFF</span></code> will cause the TriBITS CMake configure to simply ignore
any missing packages and turn off all dependencies on these missing packages.</p>
<p>Another type of checking is for optional inserted/external packages
(e.g. packages who’s source can optionally be included and is flagged with
<code class="docutils literal notranslate"><span class="pre">tribits_allow_missing_external_packages()</span></code>).  Any of these package
directories that are missing result in the packages being silently ignored by
default.  However, notes on what missing packages are being ignored can
printed by configuring with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_WARN_ABOUT_MISSING_EXTERNAL_PACKAGES</span><span class="o">=</span><span class="n">TRUE</span>
</pre></div>
</div>
<p>These warnings (starting with ‘NOTE’, not ‘WARNING’ that would otherwise
trigger warnings in CDash) about missing inserted/external packages will print
regardless of the setting for <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ASSERT_MISSING_PACKAGES</span></code>.</p>
<p>Finally, <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_DEVELOPMENT_MODE=ON</span></code> results in a number of
checks for invalid usage of TriBITS in the project’s <code class="docutils literal notranslate"><span class="pre">CMakeList.txt</span></code> files
and will abort configure with a fatal error on the first check failure. This
is appropriate for development mode when a project is clean of all such
invalid usage patterns but there are times when it makes sense to report these
check failures in different ways (such as when upgrading TriBITS in a project
that has some invalid usage patterns that just happen work but may be
disallowed in future versions of TriBITS).  To change how these invalid usage
checks are handled, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ASSERT_CORRECT_TRIBITS_USAGE</span><span class="o">=&lt;</span><span class="n">check</span><span class="o">-</span><span class="n">mode</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;check-mode&gt;</span></code> can be ‘FATAL_ERROR’, ‘SEND_ERROR’, ‘WARNING’, or
‘IGNORE’.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_DEVELOPMENT_MODE=OFF</span></code>, the default for
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ASSERT_CORRECT_TRIBITS_USAGE</span></code> is actually set to <code class="docutils literal notranslate"><span class="pre">IGNORE</span></code>.</p>
</div>
</div>
<div class="section" id="building-makefile-generator">
<h1><a class="toc-backref" href="#id74"><span class="sectnum">5</span> Building (Makefile generator)</a><a class="headerlink" href="#building-makefile-generator" title="Permalink to this headline">¶</a></h1>
<p>This section described building using the default CMake Makefile generator.
Building with the Ninja is described in section <a class="reference internal" href="#building-ninja-generator">Building (Ninja generator)</a>.
But every other CMake generator is also supported such as Visual Studio on
Windows, XCode on Macs, and Eclipse project files but using those build
systems are not documented here (consult standard CMake and concrete build
tool documentation).</p>
<div class="section" id="building-all-targets">
<h2><a class="toc-backref" href="#id75"><span class="sectnum">5.1</span> Building all targets</a><a class="headerlink" href="#building-all-targets" title="Permalink to this headline">¶</a></h2>
<p>To build all targets use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make [-jN]
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">N</span></code> is the number of processes to use (i.e. 2, 4, 16, etc.) .</p>
</div>
<div class="section" id="discovering-what-targets-are-available-to-build">
<h2><a class="toc-backref" href="#id76"><span class="sectnum">5.2</span> Discovering what targets are available to build</a><a class="headerlink" href="#discovering-what-targets-are-available-to-build" title="Permalink to this headline">¶</a></h2>
<p>CMake generates Makefiles with a ‘help’ target!  To see the targets at the
current directory level type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make help
</pre></div>
</div>
<p>NOTE: In general, the <code class="docutils literal notranslate"><span class="pre">help</span></code> target only prints targets in the current
directory, not targets in subdirectories.  These targets can include object
files and all, anything that CMake defines a target for in the current
directory.  However, running <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">help</span></code> it from the base build directory
will print all major targets in the project (i.e. libraries, executables,
etc.) but not minor targets like object files.  Any of the printed targets can
be used as a target for <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">&lt;some-target&gt;</span></code>.  This is super useful for just
building a single object file, for example.</p>
</div>
<div class="section" id="building-all-of-the-targets-for-a-package">
<h2><a class="toc-backref" href="#id77"><span class="sectnum">5.3</span> Building all of the targets for a package</a><a class="headerlink" href="#building-all-of-the-targets-for-a-package" title="Permalink to this headline">¶</a></h2>
<p>To build only the targets for a given TriBITS package, one can use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make &lt;TRIBITS_PACKAGE&gt;_all
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd packages/&lt;TRIBITS_PACKAGE&gt;
$ make
</pre></div>
</div>
<p>This will build only the targets for TriBITS package <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> and
its required upstream targets.</p>
</div>
<div class="section" id="building-all-of-the-libraries-for-a-package">
<h2><a class="toc-backref" href="#id78"><span class="sectnum">5.4</span> Building all of the libraries for a package</a><a class="headerlink" href="#building-all-of-the-libraries-for-a-package" title="Permalink to this headline">¶</a></h2>
<p>To build only the libraries for given TriBITS package, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make &lt;TRIBITS_PACKAGE&gt;_libs
</pre></div>
</div>
</div>
<div class="section" id="building-all-of-the-libraries-for-all-enabled-packages">
<h2><a class="toc-backref" href="#id79"><span class="sectnum">5.5</span> Building all of the libraries for all enabled packages</a><a class="headerlink" href="#building-all-of-the-libraries-for-all-enabled-packages" title="Permalink to this headline">¶</a></h2>
<p>To build only the libraries for all enabled TriBITS packages, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make libs
</pre></div>
</div>
<p>NOTE: This target depends on the <code class="docutils literal notranslate"><span class="pre">&lt;PACKAGE&gt;_libs</span></code> targets for all of the
enabled <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;</span></code> packages.  You can also use the target name
<code class="docutils literal notranslate"><span class="pre">'&lt;Project&gt;_libs</span></code>.</p>
</div>
<div class="section" id="building-a-single-object-file">
<h2><a class="toc-backref" href="#id80"><span class="sectnum">5.6</span> Building a single object file</a><a class="headerlink" href="#building-a-single-object-file" title="Permalink to this headline">¶</a></h2>
<p>To build just a single object file (i.e. to debug a compile problem), first,
look for the target name for the object file build based on the source file,
for example for the source file <code class="docutils literal notranslate"><span class="pre">SomeSourceFile.cpp</span></code>, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make help | grep SomeSourceFile
</pre></div>
</div>
<p>The above will return a target name like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span> <span class="n">SomeSourceFile</span><span class="o">.</span><span class="n">o</span>
</pre></div>
</div>
<p>To find the name of the actual object file, do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ find . -name &quot;*SomeSourceFile*.o&quot;
</pre></div>
</div>
<p>that will return something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">CMakeFiles</span><span class="o">/&lt;</span><span class="n">source</span><span class="o">-</span><span class="nb">dir</span><span class="o">-</span><span class="n">path</span><span class="o">&gt;.</span><span class="n">dir</span><span class="o">/</span><span class="n">SomeSourceFile</span><span class="o">.</span><span class="n">cpp</span><span class="o">.</span><span class="n">o</span>
</pre></div>
</div>
<p>(but this file location and name depends on the source directory structure,
the version of CMake, and other factors).  Use the returned name (exactly) for
the object file returned in the above find operation to remove the object file
first, for example, as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rm ./CMakeFiles/&lt;source-dir-path&gt;.dir/SomeSourceFile.cpp.o
</pre></div>
</div>
<p>and then build it again, for example, with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make SomeSourceFile.o
</pre></div>
</div>
<p>Again, the names of the target and the object file name an location depend on
the CMake version, the structure of your source directories and other factors
but the general process of using <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">help</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">&lt;some-file-base-name&gt;</span></code> to
find the target name and then doing a find <code class="docutils literal notranslate"><span class="pre">find</span> <span class="pre">.</span> <span class="pre">-name</span>
<span class="pre">&quot;*&lt;some-file-base-name&gt;*&quot;</span></code> to find the actual object file path always works.</p>
<p>For this process to work correctly, you must be in the subdirectory where the
<code class="docutils literal notranslate"><span class="pre">tribits_add_library()</span></code> or <code class="docutils literal notranslate"><span class="pre">tribits_add_executable()</span></code> command is called
from its <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file, otherwise the object file targets will not be
listed by <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">help</span></code>.</p>
<p>NOTE: CMake does not seem to not check on dependencies when explicitly
building object files as shown above so you need to always delete the object
file first to make sure that it gets rebuilt correctly.</p>
</div>
<div class="section" id="building-with-verbose-output-without-reconfiguring">
<h2><a class="toc-backref" href="#id81"><span class="sectnum">5.7</span> Building with verbose output without reconfiguring</a><a class="headerlink" href="#building-with-verbose-output-without-reconfiguring" title="Permalink to this headline">¶</a></h2>
<p>One can get CMake to generate verbose make output at build time by just
setting the Makefile variable <code class="docutils literal notranslate"><span class="pre">VERBOSE=1</span></code>, for example, as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make  VERBOSE=1 [&lt;SOME_TARGET&gt;]
</pre></div>
</div>
<p>Any number of compile or linking problem can be quickly debugged by seeing the
raw compile and link lines.  See <a class="reference internal" href="#building-a-single-object-file">Building a single object file</a> for more
details.</p>
<p>NOTE: The libraries listed on the link line are often in the form
<code class="docutils literal notranslate"><span class="pre">-L&lt;lib-dir&gt;</span> <span class="pre">-l&lt;lib1&gt;</span> <span class="pre">-l&lt;lib2&gt;</span></code> even if one passed in full library paths for
TPLs through <code class="docutils literal notranslate"><span class="pre">TPL_&lt;TPLNAME&gt;_LIBRARIES</span></code> (see <a class="reference internal" href="#enabling-support-for-an-optional-third-party-library-tpl">Enabling support for an
optional Third-Party Library (TPL)</a>).  That is because CMake tries to keep
the link lines as short as possible and therefore it often does this
translation automatically (whether you want it to or not).</p>
</div>
<div class="section" id="relink-a-target-without-considering-dependencies">
<h2><a class="toc-backref" href="#id82"><span class="sectnum">5.8</span> Relink a target without considering dependencies</a><a class="headerlink" href="#relink-a-target-without-considering-dependencies" title="Permalink to this headline">¶</a></h2>
<p>CMake provides a way to rebuild a target without considering its dependencies
using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make &lt;SOME_TARGET&gt;/fast
</pre></div>
</div>
</div>
</div>
<div class="section" id="building-ninja-generator">
<h1><a class="toc-backref" href="#id83"><span class="sectnum">6</span> Building (Ninja generator)</a><a class="headerlink" href="#building-ninja-generator" title="Permalink to this headline">¶</a></h1>
<p>When using the Ninja back-end (see <a class="reference internal" href="#enabling-support-for-ninja">Enabling support for Ninja</a>), one can
build with simply:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ninja</span> <span class="o">-</span><span class="n">j</span><span class="o">&lt;</span><span class="n">N</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>or use any options and workflows that the raw <code class="docutils literal notranslate"><span class="pre">ninja</span></code> executable supports
(see <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">--help</span></code>).  In general, the <code class="docutils literal notranslate"><span class="pre">ninja</span></code> command can only be run
from the base project binary directory and running it from the subdirectory
will not work without having to use the <code class="docutils literal notranslate"><span class="pre">-C</span> <span class="pre">&lt;dir&gt;</span></code> option pointing to the
base dir and one will need to pass in specific target names or the entire
project targets will get built with the default <code class="docutils literal notranslate"><span class="pre">all</span></code> target.</p>
<p>But if the TriBITS-created Ninja makefiles are also generated (see
<a class="reference internal" href="#project-write-ninja-makefiles">&lt;Project&gt;_WRITE_NINJA_MAKEFILES</a>), then <code class="docutils literal notranslate"><span class="pre">make</span></code> can be run from any
subdirectory to build targets in that subdirectory.  Because of this and other
advantages of these makefiles, the majority of the instructions below will be
for running with these makefiles, not the raw <code class="docutils literal notranslate"><span class="pre">ninja</span></code> command.  These
makefiles define many of the standard targets that are provided by the default
CMake-generated makefiles like <code class="docutils literal notranslate"><span class="pre">all</span></code>, <code class="docutils literal notranslate"><span class="pre">clean</span></code>, <code class="docutils literal notranslate"><span class="pre">install</span></code>, and
<code class="docutils literal notranslate"><span class="pre">package_source</span></code> (run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">help</span></code> to see all of the targets).</p>
<div class="section" id="building-in-parallel-with-ninja">
<h2><a class="toc-backref" href="#id84"><span class="sectnum">6.1</span> Building in parallel with Ninja</a><a class="headerlink" href="#building-in-parallel-with-ninja" title="Permalink to this headline">¶</a></h2>
<p>By default, running the raw <code class="docutils literal notranslate"><span class="pre">ninja</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ninja</span>
</pre></div>
</div>
<p>will use <strong>all</strong> of the free cores on the node to build targets in parallel on
the machine!  This will not overload the machine but it will not leave any
unused cores either (see Ninja documentation).</p>
<p>To run the raw <code class="docutils literal notranslate"><span class="pre">ninja</span></code> command to build with a specific number of build
processes (regardless of machine load), e.g. <code class="docutils literal notranslate"><span class="pre">16</span></code> build processes, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ninja</span> <span class="o">-</span><span class="n">j16</span>
</pre></div>
</div>
<p>When using the TriBITS-generated Ninja makefiles, running with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span>
</pre></div>
</div>
<p>will also use all of the free cores, and <strong>not</strong> just one process like with
the default CMake-generated makefiles.</p>
<p>But with the TriBITS-generated Ninja makefiles, to build with a specific
number of build processes (regardless of machine load), e.g. <code class="docutils literal notranslate"><span class="pre">16</span></code> build
processes, one can <strong>not</strong> use <code class="docutils literal notranslate"><span class="pre">-j&lt;N&gt;</span></code> but instead must use the <code class="docutils literal notranslate"><span class="pre">NP=&lt;N&gt;</span></code>
argument with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">NP</span><span class="o">=</span><span class="mi">16</span>
</pre></div>
</div>
<p>which will call <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">-j16</span></code> internally.</p>
<p>That reason that <code class="docutils literal notranslate"><span class="pre">-j16</span></code> cannot be used with these TriBITS-generated Ninja
Makefiles is that the <code class="docutils literal notranslate"><span class="pre">make</span></code> program does not inform the executed
<code class="docutils literal notranslate"><span class="pre">Makefile</span></code> the value of this option and therefore this can’t be passed on to
the underlying <code class="docutils literal notranslate"><span class="pre">ninja</span></code> command.  Therefore the <code class="docutils literal notranslate"><span class="pre">make</span></code> option <code class="docutils literal notranslate"><span class="pre">-j&lt;N&gt;</span></code> is
essentially ignored.  Therefore, running <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">-j16</span></code> will result in calling
raw <code class="docutils literal notranslate"><span class="pre">ninja</span></code> which will use all of the free cores on the machine.  Arguably
that is better than using only one core and will not overload the machine but
still this is behavior the user must be aware.</p>
</div>
<div class="section" id="building-in-a-subdirectory-with-ninja">
<h2><a class="toc-backref" href="#id85"><span class="sectnum">6.2</span> Building in a subdirectory with Ninja</a><a class="headerlink" href="#building-in-a-subdirectory-with-ninja" title="Permalink to this headline">¶</a></h2>
<p>To build from a binary subdirectory in the build tree with the
TriBITS-generated Ninja makefiles, just <code class="docutils literal notranslate"><span class="pre">cd</span></code> into that directory and build
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">&lt;</span><span class="n">some</span><span class="o">-</span><span class="n">subdir</span><span class="o">&gt;/</span>
<span class="n">make</span> <span class="n">NP</span><span class="o">=</span><span class="mi">16</span>
</pre></div>
</div>
<p>and this will only build targets that are defined in that subdirectory.  (See
the raw <code class="docutils literal notranslate"><span class="pre">ninja</span></code> command that gets called in this case which is echoed at the
top.)</p>
</div>
<div class="section" id="building-verbose-without-reconfiguring-with-ninja">
<h2><a class="toc-backref" href="#id86"><span class="sectnum">6.3</span> Building verbose without reconfiguring with Ninja</a><a class="headerlink" href="#building-verbose-without-reconfiguring-with-ninja" title="Permalink to this headline">¶</a></h2>
<p>To build targets and see the full build lines for each with the Ninja
makefiles, build with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">NP</span><span class="o">=</span><span class="mi">10</span> <span class="n">VERBOSE</span><span class="o">=</span><span class="mi">1</span> <span class="o">&lt;</span><span class="n">target_name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>But note that <code class="docutils literal notranslate"><span class="pre">ninja</span></code> will automatically provide the full build command for
a build target when that target fails so the <code class="docutils literal notranslate"><span class="pre">VERBOSE=1</span></code> option is not
needed in the case were a build target is failing but is useful in other cases
none the less.</p>
</div>
<div class="section" id="discovering-what-targets-are-available-to-build-with-ninja">
<h2><a class="toc-backref" href="#id87"><span class="sectnum">6.4</span> Discovering what targets are available to build with Ninja</a><a class="headerlink" href="#discovering-what-targets-are-available-to-build-with-ninja" title="Permalink to this headline">¶</a></h2>
<p>To determine the target names for library, executable (or any other general
target except for object files) that can be built in any binary directory with
the TriBITS-generated Ninja Makefiles, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">help</span>
</pre></div>
</div>
<p>which will return:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">This</span> <span class="n">Makefile</span> <span class="n">supports</span> <span class="n">the</span> <span class="n">following</span> <span class="n">standard</span> <span class="n">targets</span><span class="p">:</span>

  <span class="nb">all</span> <span class="p">(</span><span class="n">default</span><span class="p">)</span>
  <span class="n">clean</span>
  <span class="n">help</span>
  <span class="n">install</span>
  <span class="n">test</span>
  <span class="n">package</span>
  <span class="n">package_source</span>
  <span class="n">edit_cache</span>
  <span class="n">rebuild_cache</span>

<span class="ow">and</span> <span class="n">the</span> <span class="n">following</span> <span class="n">project</span> <span class="n">targets</span><span class="p">:</span>

  <span class="o">&lt;</span><span class="n">target0</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">target1</span><span class="o">&gt;</span>
  <span class="o">...</span>

<span class="n">Run</span> <span class="s1">&#39;make help-objects&#39;</span> <span class="n">to</span> <span class="nb">list</span> <span class="nb">object</span> <span class="n">files</span><span class="o">.</span>
</pre></div>
</div>
<p>To determine the target names for building any object files that can be run in
any directory with the TriBITS-generated Ninja Makefiles, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">help</span><span class="o">-</span><span class="n">objects</span>
</pre></div>
</div>
<p>which will return:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">This</span> <span class="n">Makefile</span> <span class="n">supports</span> <span class="n">the</span> <span class="n">following</span> <span class="nb">object</span> <span class="n">files</span><span class="p">:</span>

  <span class="o">&lt;</span><span class="nb">object</span><span class="o">-</span><span class="n">target</span><span class="o">-</span><span class="mi">0</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nb">object</span><span class="o">-</span><span class="n">target</span><span class="o">-</span><span class="mi">1</span><span class="o">&gt;</span>
  <span class="o">...</span>
</pre></div>
</div>
<p>NOTE: The raw <code class="docutils literal notranslate"><span class="pre">ninja</span></code> command does not provide a compact way to list all of
the targets that can be built in any given directory.</p>
</div>
<div class="section" id="building-specific-targets-with-ninja">
<h2><a class="toc-backref" href="#id88"><span class="sectnum">6.5</span> Building specific targets with Ninja</a><a class="headerlink" href="#building-specific-targets-with-ninja" title="Permalink to this headline">¶</a></h2>
<p>To build with any specific target, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">NP</span><span class="o">=</span><span class="mi">16</span> <span class="o">&lt;</span><span class="n">target</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#discovering-what-targets-are-available-to-build-with-ninja">Discovering what targets are available to build with Ninja</a> for how to get
a list of targets.</p>
</div>
<div class="section" id="building-single-object-files-with-ninja">
<h2><a class="toc-backref" href="#id89"><span class="sectnum">6.6</span> Building single object files with Ninja</a><a class="headerlink" href="#building-single-object-files-with-ninja" title="Permalink to this headline">¶</a></h2>
<p>To build any object file, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">NP</span><span class="o">=</span><span class="mi">16</span> <span class="o">&lt;</span><span class="nb">object</span><span class="o">-</span><span class="n">target</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#discovering-what-targets-are-available-to-build-with-ninja">Discovering what targets are available to build with Ninja</a> for how to get
a list of the object file targets.</p>
<p>Note that unlike the native CMake-generated Makefiles, when an object target
like this gets built, Ninja will build all of the upstream targets as well.
For example, if you change an upstream header file and just want to see the
impact of building a single <code class="docutils literal notranslate"><span class="pre">*.o</span></code> file, this target will build <strong>all</strong> of
the targets for the library where the object fill will gets used.  But this is
not generally what one wants to do to iteratively develop the compilation of a
single object file.</p>
<p>To avoid that behavior and instead just build a single <code class="docutils literal notranslate"><span class="pre">*.o</span></code> file, first one
must instead use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">VERBOSE</span><span class="o">=</span><span class="mi">1</span> <span class="o">&lt;</span><span class="nb">object</span><span class="o">-</span><span class="n">target</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>to print the command-line for building the one object file, and then <code class="docutils literal notranslate"><span class="pre">cd</span></code> to
the base project binary directory and manually run that command to build only
that object file.  (This can be considered a regression w.r.t. the native
CMake-generated Makefiles.)</p>
<p>NOTE: The raw <code class="docutils literal notranslate"><span class="pre">ninja</span></code> command does not provide a compact way to list all of
the object files that can be built and does not make it easy to build a single
object file.</p>
</div>
<div class="section" id="cleaning-build-targets-with-ninja">
<h2><a class="toc-backref" href="#id90"><span class="sectnum">6.7</span> Cleaning build targets with Ninja</a><a class="headerlink" href="#cleaning-build-targets-with-ninja" title="Permalink to this headline">¶</a></h2>
<p>With the TriBITS-generated Ninja Makefiles, when one runs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">clean</span>
</pre></div>
</div>
<p>in a subdirectory to clean out the targets in that subdirectory, the
underlying <code class="docutils literal notranslate"><span class="pre">ninja</span></code> command will actually delete not only the targets in that
subdirectory but instead will clean <strong>all</strong> the targets upstream from the
targets in the current subdirectory as well!  This is <strong>not</strong> the behavior of
the default CMake-generated Makefiles where only the generated files in that
subdirectory will be removed and files for upstream dependencies.</p>
<p>Therefore, if one then wants to clean only the object files, libraries, and
executables in a subdirectory, one should just manually delete them with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">&lt;</span><span class="n">some</span><span class="o">-</span><span class="n">subdir</span><span class="o">&gt;/</span>
<span class="n">find</span> <span class="o">.</span> <span class="o">-</span><span class="n">name</span> <span class="s2">&quot;*.o&quot;</span> <span class="o">-</span><span class="n">exec</span> <span class="n">rm</span> <span class="p">{}</span> \<span class="p">;</span>
<span class="n">find</span> <span class="o">.</span> <span class="o">-</span><span class="n">name</span> <span class="s2">&quot;lib*.a&quot;</span> <span class="o">-</span><span class="n">exec</span> <span class="n">rm</span> <span class="p">{}</span> \<span class="p">;</span>
<span class="n">find</span> <span class="o">.</span> <span class="o">-</span><span class="n">name</span> <span class="s2">&quot;lib*.so*&quot;</span> <span class="o">-</span><span class="n">exec</span> <span class="n">rm</span> <span class="p">{}</span> \<span class="p">;</span>
<span class="n">find</span> <span class="o">.</span> <span class="o">-</span><span class="n">name</span> <span class="s2">&quot;*.exe&quot;</span> <span class="o">-</span><span class="n">exec</span> <span class="n">rm</span> <span class="p">{}</span> \<span class="p">;</span>
</pre></div>
</div>
<p>then one can rebuild just the targets in that subdirectory with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">NP</span><span class="o">=</span><span class="mi">10</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="testing-with-ctest">
<h1><a class="toc-backref" href="#id91"><span class="sectnum">7</span> Testing with CTest</a><a class="headerlink" href="#testing-with-ctest" title="Permalink to this headline">¶</a></h1>
<p>This section assumes one is using the CMake Makefile generator described
above.  Also, the <code class="docutils literal notranslate"><span class="pre">ctest</span></code> does not consider make dependencies when running
so the software must be completely built before running <code class="docutils literal notranslate"><span class="pre">ctest</span></code> as described
here.</p>
<div class="section" id="running-all-tests">
<h2><a class="toc-backref" href="#id92"><span class="sectnum">7.1</span> Running all tests</a><a class="headerlink" href="#running-all-tests" title="Permalink to this headline">¶</a></h2>
<p>To run all of the defined tests (i.e. created using <code class="docutils literal notranslate"><span class="pre">tribits_add_test()</span></code> or
<code class="docutils literal notranslate"><span class="pre">tribits_add_advanced_test()</span></code>) use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ctest -j&lt;N&gt;
</pre></div>
</div>
<p>(where <code class="docutils literal notranslate"><span class="pre">&lt;N&gt;</span></code> is an integer for the number of processes to try to run tests
in parallel).  A summary of what tests are run and their pass/fail status will
be printed to the screen.  Detailed output about each of the tests is archived
in the generate file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Testing</span><span class="o">/</span><span class="n">Temporary</span><span class="o">/</span><span class="n">LastTest</span><span class="o">.</span><span class="n">log</span>
</pre></div>
</div>
<p>where CTest creates the <code class="docutils literal notranslate"><span class="pre">Testing</span></code> directory in the local directory where you
run it from.</p>
<p>NOTE: The <code class="docutils literal notranslate"><span class="pre">-j&lt;N&gt;</span></code> argument allows CTest to use more processes to run tests.
This will intelligently load balance the defined tests with multiple processes
(i.e. MPI tests) and will try not exceed the number of processes <code class="docutils literal notranslate"><span class="pre">&lt;N&gt;</span></code>.
However, if tests are defined that use more that <code class="docutils literal notranslate"><span class="pre">&lt;N&gt;</span></code> processes, then CTest
will still run the test but will not run any other tests while the limit of
<code class="docutils literal notranslate"><span class="pre">&lt;N&gt;</span></code> processes is exceeded.  To exclude tests that require more than
<code class="docutils literal notranslate"><span class="pre">&lt;N&gt;</span></code> processes, set the cache variable <code class="docutils literal notranslate"><span class="pre">MPI_EXEC_MAX_NUMPROCS</span></code> (see
<a class="reference internal" href="#configuring-with-mpi-support">Configuring with MPI support</a>).</p>
</div>
<div class="section" id="only-running-tests-for-a-single-package">
<h2><a class="toc-backref" href="#id93"><span class="sectnum">7.2</span> Only running tests for a single package</a><a class="headerlink" href="#only-running-tests-for-a-single-package" title="Permalink to this headline">¶</a></h2>
<p>Tests for just a single TriBITS package can be run with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ctest -j4 -L &lt;TRIBITS_PACKAGE&gt;
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd packages/&lt;TRIBITS_PACKAGE&gt;
$ ctest -j4
</pre></div>
</div>
<p>This will run tests for packages and subpackages inside of the parent package
<code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code>.</p>
<p>NOTE: CTest has a number of ways to filter what tests get run.  You can use
the test name using <code class="docutils literal notranslate"><span class="pre">-E</span></code>, you can exclude tests using <code class="docutils literal notranslate"><span class="pre">-I</span></code>, and there are
other approaches as well.  See <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">--help</span></code> and on-line documentation, and
experiment for more details.</p>
</div>
<div class="section" id="running-a-single-test-with-full-output-to-the-console">
<h2><a class="toc-backref" href="#id94"><span class="sectnum">7.3</span> Running a single test with full output to the console</a><a class="headerlink" href="#running-a-single-test-with-full-output-to-the-console" title="Permalink to this headline">¶</a></h2>
<p>To run just a single test and send detailed output directly to the console,
one can run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ctest -R ^&lt;FULL_TEST_NAME&gt;$ -VV
</pre></div>
</div>
<p>However, when running just a single test, it is usually better to just run the
test command manually to allow passing in more options.  To see what the
actual test command is, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ctest -R ^&lt;FULL_TEST_NAME&gt;$ -VV -N
</pre></div>
</div>
<p>This will only print out the test command that <code class="docutils literal notranslate"><span class="pre">ctest</span></code> runs and show the
working directory.  To run the test exactly as <code class="docutils literal notranslate"><span class="pre">ctest</span></code> would, cd into the
shown working directory and run the shown command.</p>
</div>
<div class="section" id="overriding-test-timeouts">
<h2><a class="toc-backref" href="#id95"><span class="sectnum">7.4</span> Overriding test timeouts</a><a class="headerlink" href="#overriding-test-timeouts" title="Permalink to this headline">¶</a></h2>
<p>The configured global test timeout described in <code class="docutils literal notranslate"><span class="pre">Setting</span> <span class="pre">test</span> <span class="pre">timeouts</span> <span class="pre">at</span>
<span class="pre">configure</span> <span class="pre">time</span></code> can be overridden on the CTest command-line as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ctest --timeout &lt;maxSeconds&gt;
</pre></div>
</div>
<p>This will override the configured cache variable <a class="reference internal" href="#dart-testing-timeout">DART_TESTING_TIMEOUT</a>
(actually, the scaled value set as <code class="docutils literal notranslate"><span class="pre">TimeOut</span></code> in the file
<code class="docutils literal notranslate"><span class="pre">DartConfiguration.tcl</span></code>).  However, this will <strong>not</strong> override the test
time-outs set on individual tests on a test-by-test basis!</p>
<p><strong>WARNING:</strong> Do not try to use <code class="docutils literal notranslate"><span class="pre">--timeout=&lt;maxSeconds&gt;</span></code> or CTest will just
ignore the argument!</p>
</div>
<div class="section" id="running-memory-checking">
<h2><a class="toc-backref" href="#id96"><span class="sectnum">7.5</span> Running memory checking</a><a class="headerlink" href="#running-memory-checking" title="Permalink to this headline">¶</a></h2>
<p>To configure for running memory testing with <code class="docutils literal notranslate"><span class="pre">valgrind</span></code>, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">MEMORYCHECK_COMMAND</span><span class="o">=&lt;</span><span class="nb">abs</span><span class="o">-</span><span class="n">path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">valgrind</span><span class="o">&gt;/</span><span class="n">valgrind</span> \
<span class="o">-</span><span class="n">D</span> <span class="n">MEMORYCHECK_SUPPRESSIONS_FILE</span><span class="o">=&lt;</span><span class="nb">abs</span><span class="o">-</span><span class="n">path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">supp</span><span class="o">-</span><span class="n">file0</span><span class="o">&gt;</span> \
<span class="o">-</span><span class="n">D</span> <span class="n">MEMORYCHECK_COMMAND_OPTIONS</span><span class="o">=</span><span class="s2">&quot;-q --trace-children=yes --tool=memcheck </span><span class="se">\</span>
<span class="s2">  --leak-check=yes --workaround-gcc296-bugs=yes </span><span class="se">\</span>
<span class="s2">  --num-callers=50 --suppressions=&lt;abs-path-to-supp-file1&gt; </span><span class="se">\</span>
<span class="s2">  ... --suppressions=&lt;abs-path-to-supp-fileN&gt;&quot;</span>
</pre></div>
</div>
<p>Above, you have to set the absolute path to the valgrind executable to run
using <code class="docutils literal notranslate"><span class="pre">MEMORYCHECK_COMMAND</span></code> as CMake will not find this for you by default.
To use a single valgrind suppression file, just set
<code class="docutils literal notranslate"><span class="pre">MEMORYCHECK_SUPPRESSIONS_FILE</span></code> to the path of that suppression file as
shown above.  To add other suppression files, they have to be added as other
general valgrind arguments in <code class="docutils literal notranslate"><span class="pre">MEMORYCHECK_COMMAND_OPTIONS</span></code> as shown.</p>
<p>After configuring with the above options, to run the memory tests for all
enabled tests, from the <strong>base</strong> project build directory, do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ctest -T memcheck
</pre></div>
</div>
<p>This will run valgrind on <strong>every</strong> test command that is run by ctest.</p>
<p>To run valgrind on the tests for a single package, from the <strong>base</strong> project
directory, do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ctest -T memcheck -L &lt;TRIBITS_PACKAGE&gt;
</pre></div>
</div>
<p>To run valgrind on a specific test, from the <strong>base</strong> project directory, do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ctest -T memcheck -R ^&lt;FULL_TEST_NAME&gt;$
</pre></div>
</div>
<p>Detailed output from valgrind is printed in the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Testing</span><span class="o">/</span><span class="n">Temporary</span><span class="o">/</span><span class="n">LastDynamicAnalysis_</span><span class="o">&lt;</span><span class="n">DATE_TIME</span><span class="o">&gt;.</span><span class="n">log</span>
</pre></div>
</div>
<p>NOTE: If you try to run memory tests from any subdirectories, it will not
work.  You have to run them from the <strong>*base</strong> project build directory as
shown above.  A nice way to view valgrind results is to submit to CDash using
the <code class="docutils literal notranslate"><span class="pre">dashboard</span></code> target (see <a class="reference internal" href="#dashboard-submissions">Dashboard submissions</a>).</p>
<p>NOTE: You have to use the valgrind option <code class="docutils literal notranslate"><span class="pre">--trace-children=yes</span></code> to trace
through child processes.  This is needed if you have tests that are given as
CMake -P scripts (such as advanced tests) or tests driven in bash, Perl,
Python, or other languages.</p>
</div>
</div>
<div class="section" id="installing">
<h1><a class="toc-backref" href="#id97"><span class="sectnum">8</span> Installing</a><a class="headerlink" href="#installing" title="Permalink to this headline">¶</a></h1>
<p>After a build and test of the software is complete, the software can be
installed.  Actually, to get ready for the install, the install directory must
be specified at configure time by setting the variable
<code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code> in addition to other variables that affect the
installation (see the following sections).  The other commands described below
can all be run after the build and testing is complete.</p>
<p>For the most typical case where the software is build and installed on the
same machine in the same location where it will be used, one just needs to
configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cmake -DCMAKE_INSTALL_PREFIX=&lt;install-base-dir&gt; [other options] \
  ${SOURCE_DIR}
$ make -j&lt;N&gt; install
</pre></div>
</div>
<p>For more details, see the following subsections:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#setting-the-install-prefix">Setting the install prefix</a></p></li>
<li><p><a class="reference internal" href="#setting-install-rpath">Setting install RPATH</a></p></li>
<li><p><a class="reference internal" href="#avoiding-installing-libraries-and-headers">Avoiding installing libraries and headers</a></p></li>
<li><p><a class="reference internal" href="#installing-the-software">Installing the software</a></p></li>
</ul>
<div class="section" id="setting-the-install-prefix">
<h2><a class="toc-backref" href="#id98"><span class="sectnum">8.1</span> Setting the install prefix</a><a class="headerlink" href="#setting-the-install-prefix" title="Permalink to this headline">¶</a></h2>
<p>In order to set up for the install, the install prefix should be set up at
configure time by setting, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>-D CMAKE_INSTALL_PREFIX=$HOME/install/&lt;Project&gt;/mpi/opt
</pre></div>
</div>
<p>The default location for the installation of libraries, headers, and
executables is given by the variables (with defaults):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_INSTALL_INCLUDE_DIR</span><span class="o">=</span><span class="s2">&quot;include&quot;</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_INSTALL_LIB_DIR</span><span class="o">=</span><span class="s2">&quot;lib&quot;</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_INSTALL_RUNTIME_DIR</span><span class="o">=</span><span class="s2">&quot;bin&quot;</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_INSTALL_EXAMPLE_DIR</span><span class="o">=</span><span class="s2">&quot;example&quot;</span>
</pre></div>
</div>
<p>If these paths are relative (i.e. don’t start with “/” and use type
<code class="docutils literal notranslate"><span class="pre">STRING</span></code>) then they are relative to <code class="docutils literal notranslate"><span class="pre">${CMAKE_INSTALL_PREFIX}</span></code>.  Otherwise
the paths can be absolute (use type <code class="docutils literal notranslate"><span class="pre">PATH</span></code>) and don’t have to be under
<code class="docutils literal notranslate"><span class="pre">${CMAKE_INSTALL_PREFIX}</span></code>.  For example, to install each part in any
arbitrary location use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_INSTALL_INCLUDE_DIR</span><span class="o">=</span><span class="s2">&quot;/usr/&lt;Project&gt;_include&quot;</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_INSTALL_LIB_DIR</span><span class="o">=</span><span class="s2">&quot;/usr/&lt;Project&gt;_lib&quot;</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_INSTALL_RUNTIME_DIR</span><span class="o">=</span><span class="s2">&quot;/usr/&lt;Project&gt;_bin&quot;</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_INSTALL_EXAMPLE_DIR</span><span class="o">=</span><span class="s2">&quot;/usr/share/&lt;Project&gt;/examples&quot;</span>
</pre></div>
</div>
<p>NOTE: The defaults for the above include paths will be set by the standard
CMake module <code class="docutils literal notranslate"><span class="pre">GNUInstallDirs</span></code> if <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_USE_GNUINSTALLDIRS=TRUE</span></code> is
set.  Some projects have this set by default (see the <code class="docutils literal notranslate"><span class="pre">CMakeCache.txt</span></code> after
configuring to see default being used by this project).</p>
<p>WARNING: To overwrite default relative paths, you must use the data type
<code class="docutils literal notranslate"><span class="pre">STRING</span></code> for the cache variables.  If you don’t, then CMake will use the
current binary directory for the base path.  Otherwise, if you want to specify
absolute paths, use the data type <code class="docutils literal notranslate"><span class="pre">PATH</span></code> as shown above.</p>
</div>
<div class="section" id="setting-install-ownership-and-permissions">
<h2><a class="toc-backref" href="#id99"><span class="sectnum">8.2</span> Setting install ownership and permissions</a><a class="headerlink" href="#setting-install-ownership-and-permissions" title="Permalink to this headline">¶</a></h2>
<p>By default, when installing with the <code class="docutils literal notranslate"><span class="pre">install</span></code> (or
<code class="docutils literal notranslate"><span class="pre">install_package_by_package</span></code>) target, any files and directories created are
given the default permissions for the user that runs the install command (just
as if they typed <code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">&lt;some-dir&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">touch</span> <span class="pre">&lt;some-file&gt;</span></code>).  On most
Unix/Linux systems, one can use <code class="docutils literal notranslate"><span class="pre">umask</span></code> to set default permissions and one
can set the default group and the group sticky bit to control what groups owns
the newly created files and directories.  However, some computer systems do
not support the group sticky bit and there are cases where one wants or needs
to provide different group ownership and write permissions.</p>
<p>To control what group owns the install-created files and directories related
to <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code> and define the permissions on those, one can set
one or more of the following options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_SET_GROUP_AND_PERMISSIONS_ON_INSTALL_BASE_DIR</span><span class="o">=&lt;</span><span class="n">install</span><span class="o">-</span><span class="n">base</span><span class="o">-</span><span class="nb">dir</span><span class="o">&gt;</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_MAKE_INSTALL_GROUP</span><span class="o">=</span><span class="p">[</span><span class="o">&lt;</span><span class="n">owning</span><span class="o">-</span><span class="n">group</span><span class="o">&gt;</span><span class="p">]</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_MAKE_INSTALL_GROUP_READABLE</span><span class="o">=</span><span class="p">[</span><span class="n">TRUE</span><span class="o">|</span><span class="n">FALSE</span><span class="p">]</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_MAKE_INSTALL_GROUP_WRITABLE</span><span class="o">=</span><span class="p">[</span><span class="n">TRUE</span><span class="o">|</span><span class="n">FALSE</span><span class="p">]</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_MAKE_INSTALL_WORLD_READABLE</span><span class="o">=</span><span class="p">[</span><span class="n">TRUE</span><span class="o">|</span><span class="n">FALSE</span><span class="p">]</span> \
</pre></div>
</div>
<p>(where <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_SET_GROUP_AND_PERMISSIONS_ON_INSTALL_BASE_DIR</span></code> must be a
base directory of <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code>).  This has the impact of both
setting the built-in CMake variable
<code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_DEFAULT_DIRECTORY_PERMISSIONS</span></code> with the correct permissions
according to these and also triggers the automatic running of the recursive
<code class="docutils literal notranslate"><span class="pre">chgrp</span></code> and <code class="docutils literal notranslate"><span class="pre">chmod</span></code> commands starting from the directory
<code class="docutils literal notranslate"><span class="pre">&lt;install-base-dir&gt;</span></code> on down, after all of the other project files have been
installed.  The directory set by
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_SET_GROUP_AND_PERMISSIONS_ON_INSTALL_BASE_DIR</span></code> and those below it
may be created by the <code class="docutils literal notranslate"><span class="pre">install</span></code> command by CMake (as it may not exist before
the install).  If <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_SET_GROUP_AND_PERMISSIONS_ON_INSTALL_BASE_DIR</span></code>
is not given, then it is set internally to the same directory as
<code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code>.</p>
<p>For an example, to configure for an install based on a dated base directory
where a non-default group should own the installation and have group
read/write permissions, and “others” only have read access, one would
configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>-D CMAKE_INSTALL_PREFIX=$HOME/2020-04-25/my-proj \
-D &lt;Project&gt;_SET_GROUP_AND_PERMISSIONS_ON_INSTALL_BASE_DIR=$HOME/2020-04-25 \
-D &lt;Project&gt;_MAKE_INSTALL_GROUP=some-other-group \
-D &lt;Project&gt;_MAKE_INSTALL_GROUP_WRITABLE=TRUE \
-D &lt;Project&gt;_MAKE_INSTALL_WORLD_READABLE=TRUE \
</pre></div>
</div>
<p>Using these settings, after all of the files and directories have been
installed using the <code class="docutils literal notranslate"><span class="pre">install</span></code> or <code class="docutils literal notranslate"><span class="pre">install_package_by_package</span></code> build
targets, the following commands are automatically run at the very end:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>chgrp some-other-group $HOME/2020-04-25
chmod g+rwX,o+rX $HOME/2020-04-25
chgrp some-other-group -R $HOME/2020-04-25/my-proj
chmod g+rwX,o+rX -R $HOME/2020-04-25/my-proj
</pre></div>
</div>
<p>That allows the owning group <code class="docutils literal notranslate"><span class="pre">some-other-group</span></code> to later modify or delete
the installation and allows all users to use the installation.</p>
<p>NOTES:</p>
<ul class="simple">
<li><p>Setting <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_MAKE_INSTALL_GROUP_WRITABLE=TRUE</span></code> implies
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_MAKE_INSTALL_GROUP_READABLE=TRUE</span></code>.</p></li>
<li><p>Non-recursive <code class="docutils literal notranslate"><span class="pre">chgrp</span></code> and <code class="docutils literal notranslate"><span class="pre">chmod</span></code> commands are run on the directories
above <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code>.  Recursive <code class="docutils literal notranslate"><span class="pre">chgrp</span></code> and <code class="docutils literal notranslate"><span class="pre">chmod</span></code> commands
are only run on the base <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code> directory itself.  (This
avoids touching any files or directories not directly involved in this
install.)</p></li>
</ul>
</div>
<div class="section" id="setting-install-rpath">
<h2><a class="toc-backref" href="#id100"><span class="sectnum">8.3</span> Setting install RPATH</a><a class="headerlink" href="#setting-install-rpath" title="Permalink to this headline">¶</a></h2>
<p>Setting RPATH for installed shared libraries and executables
(i.e. <code class="docutils literal notranslate"><span class="pre">BUILD_SHARED_LIBS=ON</span></code>) can be a little tricky.  Some discussion of
how raw CMake handles RPATH and installations can be found at:</p>
<blockquote id="cmake-rpath-handling-reference">
<div><p><a class="reference external" href="https://cmake.org/Wiki/CMake_RPATH_handling">https://cmake.org/Wiki/CMake_RPATH_handling</a></p>
</div></blockquote>
<p>The TriBITS/CMake build system being used for this &lt;Project&gt; CMake project
defines the following default behavior for installed RPATH (which is not the
same as the raw CMake default behavior):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_RPATH</span></code> for all libraries and executables built and installed
by this CMake project is set to <code class="docutils literal notranslate"><span class="pre">${&lt;Project&gt;_INSTALL_LIB_DIR}</span></code>.  (This
default is controlled by the variable <a class="reference internal" href="#project-set-install-rpath">&lt;Project&gt;_SET_INSTALL_RPATH</a>.)</p></li>
<li><p>The path for all shared external libraries (i.e. TPLs) is set to the
location of the external libraries passed in (or automatically discovered)
at configure time. (This is controlled by the built-in CMake cache variable
<code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_RPATH_USE_LINK_PATH</span></code> which is set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> by default
for most TriBITS projects but is empty “” for raw CMake.)</p></li>
</ul>
<p>The above default behavior allows the installed executables and libraries to
be run without needing to set <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> or any other system
environment variables.  However, this setting does not allow the installed
libraries and executables to be easily moved or relocated.  There are several
built-in CMake variables that control how RPATH is handled related to
installations.  The built-in CMake variables that control RPATH handling
include <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_RPATH</span></code>, <code class="docutils literal notranslate"><span class="pre">CMAKE_SKIP_BUILD_RPATH</span></code>,
<code class="docutils literal notranslate"><span class="pre">CMAKE_SKIP_INSTALL_RPATH</span></code>, <code class="docutils literal notranslate"><span class="pre">CMAKE_SKIP_RPATH</span></code>,
<code class="docutils literal notranslate"><span class="pre">CMAKE_BUILD_WITH_INSTALL_RPATH</span></code>, <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_RPATH_USE_LINK_PATH</span></code>.
The TriBITS/CMake build system for &lt;Project&gt; respects all of these raw CMake
variables and their documented effect on the build and install.</p>
<p>In addition, this TriBITS/CMake project defines the cache variable:</p>
<blockquote id="project-set-install-rpath">
<div><p><strong>&lt;Project&gt;_SET_INSTALL_RPATH</strong>: If <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then the global CMake variable
<code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_RPATH</span></code> is set to <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_INSTALL_LIB_DIR</span></code>.  If
<code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_RPATH</span></code> is set by the user, then that is used instead.  This
avoids having to manually set <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_RPATH</span></code> to the correct default
install directory.</p>
</div></blockquote>
<p>Rather than re-documenting all of the native CMake RPATH variables mentioned
above, instead, we describe how these variables should be set for different
installation and distribution scenarios:</p>
<ol class="arabic simple" start="0">
<li><p><a class="reference internal" href="#use-default-cmake-behavior">Use default CMake behavior</a></p></li>
<li><p><a class="reference internal" href="#libraries-and-executables-are-built-installed-and-used-on-same-machine">Libraries and executables are built, installed and used on same machine</a> (TriBITS default)</p></li>
<li><p><a class="reference internal" href="#targets-will-move-after-installation">Targets will move after installation</a></p></li>
<li><p><a class="reference internal" href="#targets-and-tpls-will-move-after-installation">Targets and TPLs will move after installation</a></p></li>
<li><p><a class="reference internal" href="#explicitly-set-rpath-for-the-final-target-system">Explicitly set RPATH for the final target system</a></p></li>
<li><p><a class="reference internal" href="#define-all-shared-library-paths-at-runtime-using-environment-variables">Define all shared library paths at runtime using environment variables</a></p></li>
</ol>
<p>These scenarios in detail are:</p>
<ol class="arabic" id="use-default-cmake-behavior" start="0">
<li><p><em>Use default CMake behavior:</em> If one just wants the default raw CMake
behavior with respect to RPATH, then configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_SET_INSTALL_RPATH</span><span class="o">=</span><span class="n">FALSE</span> \
<span class="o">-</span><span class="n">DCMAKE_INSTALL_RPATH_USE_LINK_PATH</span><span class="o">=</span><span class="n">FALSE</span> \
</pre></div>
</div>
<p>This will not put any directories into RPATH for the installed libraries or
executables.  This is the same behavior as setting
<code class="docutils literal notranslate"><span class="pre">CMAKE_SKIP_INSTALL_RPATH=TRUE</span></code> (see <a class="reference internal" href="#define-all-shared-library-paths-at-runtime-using-environment-variables">Define all shared library paths at
runtime using environment variables</a>).</p>
</li>
</ol>
<ol class="arabic" id="libraries-and-executables-are-built-installed-and-used-on-same-machine">
<li><p><em>Libraries and executables are built, installed and used on same machine
(TriBITS default):</em> One needs no options for this behavior but to make this
explicit then configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_SET_INSTALL_RPATH</span><span class="o">=</span><span class="n">TRUE</span> \
<span class="o">-</span><span class="n">DCMAKE_INSTALL_RPATH_USE_LINK_PATH</span><span class="o">=</span><span class="n">TRUE</span> \
</pre></div>
</div>
<p>As described above, this allows libraries and executables to be used right
away once installed without needing to set any environment variables.</p>
<p>Note that this also allows the installed libraries and executables to be
moved to the same location on an different but identical machine as well.</p>
</li>
</ol>
<ol class="arabic" id="targets-will-move-after-installation" start="2">
<li><p><em>Targets will move after installation:</em> In this scenario, the final
location of built libraries and executables will be different on the same
machine or an otherwise identical machine.  In this case, we assume that
all of the external library references and directories would be the same.
In this case, one would generally configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_SET_INSTALL_RPATH</span><span class="o">=</span><span class="n">FALSE</span> \
<span class="o">-</span><span class="n">DCMAKE_INSTALL_RPATH_USE_LINK_PATH</span><span class="o">=</span><span class="n">TRUE</span> \
</pre></div>
</div>
<p>Then, to run any executables using these shared libraries, one must update
LD_LIBRARY_PATH as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export LD_LIBRARY_PATH=&lt;final-install-dir&gt;/lib:$LD_LIBRARY_PATH
</pre></div>
</div>
<p>Or, if the final directory location is known, then one can directly
<code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_RPATH</span></code> at configure time to match the final target system
and then one does not need to mess with <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> or any other
env variables (see <a class="reference internal" href="#explicitly-set-rpath-for-the-final-target-system">Explicitly set RPATH for the final target system</a>).</p>
</li>
</ol>
<ol class="arabic simple" id="targets-and-tpls-will-move-after-installation" start="3">
<li><p><em>Targets and TPLs will move after installation</em>: In this scenario, the
final location of the installed libraries and executables will not be the
same as the initial install location and the external library (i.e. TPL)
locations may not be the same on the final target machine.  This can be
handled in one of two ways.  First, if one knows the final target machine
structure, then one can directly set <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_RPATH</span></code> to the
locations on the final target machine (see <a class="reference internal" href="#explicitly-set-rpath-for-the-final-target-system">Explicitly set RPATH for the
final target system</a>).  Second, if one does not know the final machine
directory structure (or the same distribution needs to support several
different systems with different directory structures), then one can set
<code class="docutils literal notranslate"><span class="pre">CMAKE_SKIP_INSTALL_RPATH=TRUE</span></code> and then require setting the paths in the
env (see <a class="reference internal" href="#define-all-shared-library-paths-at-runtime-using-environment-variables">Define all shared library paths at runtime using environment
variables</a>).</p></li>
</ol>
<ol class="arabic" id="explicitly-set-rpath-for-the-final-target-system" start="4">
<li><p><em>Explicitly set RPATH for the final target system:</em> If one knows the
directory structure of the final target machine where the installed
libraries and executables will be used, then one can set those paths at
configure time with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_SET_INSTALL_RPATH</span><span class="o">=</span><span class="n">FALSE</span> \
<span class="o">-</span><span class="n">DCMAKE_INSTALL_RPATH_USE_LINK_PATH</span><span class="o">=</span><span class="n">FALSE</span> \
<span class="o">-</span><span class="n">DCMAKE_INSTALL_RPATH</span><span class="o">=</span><span class="s2">&quot;&lt;path0&gt;;&lt;path1&gt;;...&quot;</span> \
</pre></div>
</div>
<p>In this case <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_RPATH</span></code> is explicitly set.  (The value of
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_SET_INSTALL_RPATH</span></code> has no effect but setting it to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>
may help to avoid confusion.)</p>
<p>Once the install directories are moved to the final location, the
executables can be run without any need to set environment variables.</p>
<p>Note that TriBITS also accepts the directory separator “<code class="docutils literal notranslate"><span class="pre">:</span></code>” for:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">DCMAKE_INSTALL_RPATH</span><span class="o">=</span><span class="s2">&quot;&lt;path0&gt;:&lt;path1&gt;:...&quot;</span> \
</pre></div>
</div>
<p>and replaces it internally with “<code class="docutils literal notranslate"><span class="pre">;</span></code>” which raw CMake requires. (This
makes it more robust to pass around inside of CMake code since “<code class="docutils literal notranslate"><span class="pre">;</span></code>”
means array boundary with CMake.).  However, since “:” is not a valid
character for a path for any Unix system, this is a safe substitution (and
<code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_RPATH</span></code> is not used on Windows systems that allow “<code class="docutils literal notranslate"><span class="pre">:</span></code>”
in a directory path).</p>
<p>Also note that Linux supports RPATHs with the special value <code class="docutils literal notranslate"><span class="pre">$ORIGIN</span></code> to
allow for relative paths and for relocatable installations.  (Mac OSX has
similar variables like <code class="docutils literal notranslate"><span class="pre">&#64;executable_path</span></code>.)  With this, one can define
<code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_RPATH</span></code> using something like <code class="docutils literal notranslate"><span class="pre">$ORIGIN/../lib</span></code>.  See the
above <a class="reference internal" href="#cmake-rpath-handling-reference">CMake RPATH handling reference</a> for more details.</p>
</li>
</ol>
<ol class="arabic" id="define-all-shared-library-paths-at-runtime-using-environment-variables" start="5">
<li><p><em>Define all shared library paths at runtime using environment variables:</em>
If one wants complete freedom to define the paths for the shared libraries
at runtime with <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> on Linux (and similar variables on
other platforms), then one can completely strip RPATH out of the installed
libraries and executables by configuring with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">DCMAKE_SKIP_INSTALL_RPATH</span><span class="o">=</span><span class="n">TRUE</span> \
</pre></div>
</div>
<p>This will result in all paths being stripped out of RPATH regardless of the
values of <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_SET_INSTALL_RPATH</span></code> or
<code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_RPATH_USE_LINK_PATH</span></code>.  (This is the same default behavior
as raw CMake, see <a class="reference internal" href="#use-default-cmake-behavior">Use default CMake behavior</a>).</p>
<p>Then the runtime environment must be set up to find the correct shared
libraries in the correct order at runtime (e.g. by setting
<code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code>) .  But this approach provides the most flexibility
about where executables and libraries are installed and run from.</p>
<p>Also note that, while not necessary, in order to avoid confusion, it is
likely desired to configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_SET_INSTALL_RPATH</span><span class="o">=</span><span class="n">FALSE</span> \
<span class="o">-</span><span class="n">DCMAKE_INSTALL_RPATH_USE_LINK_PATH</span><span class="o">=</span><span class="n">FALSE</span> \
<span class="o">-</span><span class="n">DCMAKE_SKIP_INSTALL_RPATH</span><span class="o">=</span><span class="n">TRUE</span> \
</pre></div>
</div>
<p>This will produce the least confusing CMake configure output.</p>
</li>
</ol>
<p>One additional issue about RPATH handling on Mac OSX systems needs to be
mentioned. That is, in order for this default RPATH approach to work on OSX
systems, all of the upstream shared libraries must have
<code class="docutils literal notranslate"><span class="pre">&#64;rpath/lib&lt;libname&gt;.dylib</span></code> embedded into them (as shown by <code class="docutils literal notranslate"><span class="pre">otool</span> <span class="pre">-L</span>
<span class="pre">&lt;lib_or_exec&gt;</span></code>).  For libraries built and installed with CMake, the parent
CMake project must be configured with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">DBUILD_SHARED_LIBS</span><span class="o">=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">DCMAKE_INSTALL_RPATH_USE_LINK_PATH</span><span class="o">=</span><span class="n">TRUE</span> \
<span class="o">-</span><span class="n">DCMAKE_MACOSX_RPATH</span><span class="o">=</span><span class="n">TRUE</span> \
</pre></div>
</div>
<p>For other build systems, see their documentation for shared library support on
OSX.  To see the proper way to handle RPATH on OSX, just inspect the build and
install commands that CMake generates (e.g. using <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">VERBOSE=1</span> <span class="pre">&lt;target&gt;</span></code>)
for shared libraries and then make sure that these other build systems use
equivalent commands.  If that is done properly for the chain of all upstream
shared libraries then the behaviors of this &lt;Project&gt; CMake project described
above should hold on OSX systems as well.</p>
</div>
<div class="section" id="avoiding-installing-libraries-and-headers">
<h2><a class="toc-backref" href="#id101"><span class="sectnum">8.4</span> Avoiding installing libraries and headers</a><a class="headerlink" href="#avoiding-installing-libraries-and-headers" title="Permalink to this headline">¶</a></h2>
<p>By default, any libraries and header files defined by in the TriBITS project
&lt;Project&gt; will get installed into the installation directories specified by
<code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_INSTALL_INCLUDE_DIR</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_INSTALL_LIB_DIR</span></code>.  However, if the primary desire is to install
executables only, then the user can set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_INSTALL_LIBRARIES_AND_HEADERS</span><span class="o">=</span><span class="n">OFF</span>
</pre></div>
</div>
<p>which, if in addition static libraries are being built
(i.e. <code class="docutils literal notranslate"><span class="pre">BUILD_SHARED_LIBS=OFF</span></code>), this this option will result in no libraries
or headers being installed into the <code class="docutils literal notranslate"><span class="pre">&lt;install&gt;/include/</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;install&gt;/lib/</span></code> directories, respectively.  However, if shared libraries
are being built (i.e. <code class="docutils literal notranslate"><span class="pre">BUILD_SHARED_LIBS=ON</span></code>), they the libraries will be
installed in <code class="docutils literal notranslate"><span class="pre">&lt;install&gt;/lib/</span></code> along with the executables because the
executables can’t run without the shared libraries being installed.</p>
</div>
<div class="section" id="installing-the-software">
<h2><a class="toc-backref" href="#id102"><span class="sectnum">8.5</span> Installing the software</a><a class="headerlink" href="#installing-the-software" title="Permalink to this headline">¶</a></h2>
<p>To install the software, type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make install
</pre></div>
</div>
<p>Note that by default CMake actually puts in the build dependencies for
installed targets so in some cases you can just type <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">-j&lt;N&gt;</span> <span class="pre">install</span></code>
and it will also build the software before installing (but this can be
disabled by setting <code class="docutils literal notranslate"><span class="pre">-DCMAKE_SKIP_INSTALL_ALL_DEPENDENCY=ON</span></code>).  It is
advised to always build and test the software first before installing with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make -j&lt;N&gt; &amp;&amp; ctest -j&lt;N&gt; &amp;&amp; make -j&lt;N&gt; install
</pre></div>
</div>
<p>This will ensure that everything is built correctly and all tests pass before
installing.</p>
<p>If there are build failures in any packages and one wants to still install the
packages that do build correctly, then configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">DCMAKE_SKIP_INSTALL_ALL_DEPENDENCY</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>and run the custom install target:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make install_package_by_package
</pre></div>
</div>
<p>This will ensure that every package that builds correctly will get installed.
(The default ‘install’ target aborts on the first file install failure.)</p>
</div>
</div>
<div class="section" id="installation-testing">
<h1><a class="toc-backref" href="#id103"><span class="sectnum">9</span> Installation Testing</a><a class="headerlink" href="#installation-testing" title="Permalink to this headline">¶</a></h1>
<p>The CMake project &lt;Project&gt; has built-in support for testing an installation
of itself using its own tests and examples.  The way it works is to configure,
build, and install just the libraries and header files using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir BUILD_LIBS
$ cd BUILD_LIBS/

$ cmake \
  -DCMAKE_INSTLAL_PREFIX=&lt;install-dir&gt; \
  -D&lt;Project&gt;_ENABLE_ALL_PACKAGES=ON \
  -D&lt;Project&gt;_ENABLE_TESTS=OFF \
  [other options] \
  &lt;projectDir&gt;

$ make -j16 install   # or ninja -j16
</pre></div>
</div>
<p>and then create a different build directory to configure and build just the
tests and examples (not the libraries) against the pre-installed libraries and
header files using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir BUILD_TESTS
$ cd BUILD_TESTS/

$ cmake \
  -D&lt;Project&gt;_ENABLE_ALL_PACKAGES=ON \
  -D&lt;Project&gt;_ENABLE_TESTS=ON \
  -D&lt;Project&gt;_ENABLE_INSTALLATION_TESTING=ON \
  -D&lt;Project&gt;_INSTALLATION_DIR=&lt;install-dir&gt; \
  [other options] \
  &lt;projectDir&gt;

$ make -j16  # or ninja -j16

$ ctest -j16
</pre></div>
</div>
<p>If that second project builds and all the tests pass, then the project was
installed correctly.  This uses the project’s own tests and examples to test
the installation of the project.  The library source and header files are
unused in the second project build.  In fact, you can delete them and ensure
that they are not used in the build and testing of the tests and examples!</p>
<p>This can also be used for testing backward compatibility of the project (or
perhaps for a subset of packages).  In this case, build and install the
libraries and header files for a newer version of the project and then
configure, build, and run the tests and examples for an older version of the
project sources pointing to the installed header files and libraries from the
newer version.</p>
</div>
<div class="section" id="packaging">
<h1><a class="toc-backref" href="#id104"><span class="sectnum">10</span> Packaging</a><a class="headerlink" href="#packaging" title="Permalink to this headline">¶</a></h1>
<p>Packaged source and binary distributions can also be created using CMake and
CPack.</p>
<div class="section" id="creating-a-tarball-of-the-source-tree">
<h2><a class="toc-backref" href="#id105"><span class="sectnum">10.1</span> Creating a tarball of the source tree</a><a class="headerlink" href="#creating-a-tarball-of-the-source-tree" title="Permalink to this headline">¶</a></h2>
<p>To create a source tarball of the project, first configure with the list of
desired packages (see <a class="reference internal" href="#selecting-the-list-of-packages-to-enable">Selecting the list of packages to enable</a>) and pass in</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_CPACK_PACKAGING</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>To actually generate the distribution files, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make package_source
</pre></div>
</div>
<p>The above command will tar up <em>everything</em> in the source tree except for files
explicitly excluded in the CMakeLists.txt files and packages that are not
enabled so make sure that you start with a totally clean source tree before
you do this.  You can clean the source tree first to remove all ignored files
using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clean -fd -x
</pre></div>
</div>
<p>You can include generated files in the tarball, such as Doxygen output files,
by creating them first, then running <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">package_source</span></code> and they will be
included in the distribution (unless there is an internal exclude set).</p>
<p>Disabled subpackages can be included or excluded from the tarball by setting
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_EXCLUDE_DISABLED_SUBPACKAGES_FROM_DISTRIBUTION</span></code> (the TriBITS
project has its own default, check <code class="docutils literal notranslate"><span class="pre">CMakeCache.txt</span></code> to see what the default
is).  If <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_EXCLUDE_DISABLED_SUBPACKAGES_FROM_DISTRIBUTION=ON</span></code> and
but one wants to include some subpackages that are otherwise excluded, just
enable them or their outer package so they will be included in the source
tarball.  To get a printout of set regular expressions that will be used to
match files to exclude, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_DUMP_CPACK_SOURCE_IGNORE_FILES</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>While a set of default CPack source generator types is defined for this
project (see the <code class="docutils literal notranslate"><span class="pre">CMakeCache.txt</span></code> file), it can be overridden using, for
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_CPACK_SOURCE_GENERATOR</span><span class="o">=</span><span class="s2">&quot;TGZ;TBZ2&quot;</span>
</pre></div>
</div>
<p>(see CMake documentation to find out the types of supported CPack source
generators on your system).</p>
<p>NOTE: When configuring from an untarred source tree that has missing packages,
one must configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ASSERT_MISSING_PACKAGES</span><span class="o">=</span><span class="n">OFF</span>
</pre></div>
</div>
<p>Otherwise, TriBITS will error out complaining about missing packages.  (Note
that <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ASSERT_MISSING_PACKAGES</span></code> will default to <code class="docutils literal notranslate"><span class="pre">`OFF`</span></code> in
release mode, i.e. <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_ENABLE_DEVELOPMENT_MODE==OFF</span></code>.)</p>
</div>
</div>
<div class="section" id="dashboard-submissions">
<h1><a class="toc-backref" href="#id106"><span class="sectnum">11</span> Dashboard submissions</a><a class="headerlink" href="#dashboard-submissions" title="Permalink to this headline">¶</a></h1>
<p>All TriBITS projects have built-in support for submitting configure, build,
and test results to CDash using the custom <code class="docutils literal notranslate"><span class="pre">dashbaord</span></code> target.  This uses
the <a class="reference external" href="TribitsUsersGuide.html#tribits-ctest-driver">tribits_ctest_driver()</a> function internally set up to work correctly
from an existing binary directory with a valid initial configure.  The few of
the advantages of using the custom TriBITS-enabled <code class="docutils literal notranslate"><span class="pre">dashboard</span></code> target over
just using the standard <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-D</span> <span class="pre">Experimental</span></code> command are:</p>
<ul class="simple">
<li><p>The configure, build, and test results are broken down nicely
package-by-package on CDash.</p></li>
<li><p>Additional notes files will be uploaded to the build on CDash.</p></li>
</ul>
<p>For more details, see <a class="reference external" href="TribitsUsersGuide.html#tribits-ctest-driver">tribits_ctest_driver()</a>.</p>
<p>To use the <code class="docutils literal notranslate"><span class="pre">dashboard</span></code> target, first, configure as normal but add cache vars
for the the build and test parallel levels with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">DCTEST_BUILD_FLAGS</span><span class="o">=-</span><span class="n">j4</span> <span class="o">-</span><span class="n">DCTEST_PARALLEL_LEVEL</span><span class="o">=</span><span class="mi">4</span>
</pre></div>
</div>
<p>(or with some other values <code class="docutils literal notranslate"><span class="pre">-j&lt;N&gt;</span></code>).  Then, invoke the (re)configure, build,
test and submit with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make dashboard
</pre></div>
</div>
<p>This invokes a <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-S</span></code> script that calls the <a class="reference external" href="TribitsUsersGuide.html#tribits-ctest-driver">tribits_ctest_driver()</a>
function to do an experimental build for all of the enabled packages for which
you have enabled tests.  (The packages that are implicitly enabled due to
package dependencies are not directly processed and no rows on CDash will be
show up for those packages.)</p>
<p><strong>NOTE:</strong> This target generates a lot of output, so it is typically better to
pipe this to a file with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make dashboard &amp;&gt; make.dashboard.out
</pre></div>
</div>
<p>and then watch that file in another terminal with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tail -f make.dashboard.out
</pre></div>
</div>
<div class="section" id="setting-options-to-change-behavior-of-dashboard-target">
<h2><a class="toc-backref" href="#id107"><span class="sectnum">11.1</span> Setting options to change behavior of ‘dashboard’ target</a><a class="headerlink" href="#setting-options-to-change-behavior-of-dashboard-target" title="Permalink to this headline">¶</a></h2>
<p>There are a number of options that you can set in the cache and/or in the
environment to control what this script does.  Several options must be set in
the cache in the CMake configure of the project such as the CDash sites where
results are submitted to with the vars <code class="docutils literal notranslate"><span class="pre">CTEST_DROP_METHOD</span></code>,
<code class="docutils literal notranslate"><span class="pre">CTEST_DROP_SITE</span></code>, <code class="docutils literal notranslate"><span class="pre">CTEST_DROP_LOCATION</span></code>,
<code class="docutils literal notranslate"><span class="pre">TRIBITS_2ND_CTEST_DROP_LOCATION</span></code>, and <code class="docutils literal notranslate"><span class="pre">TRIBITS_2ND_CTEST_DROP_SITE</span></code>.
Other options that control the behavior of the <code class="docutils literal notranslate"><span class="pre">dashboard</span></code> target must be
set in the env when calling <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">dashboard</span></code>.  For the full set of options
that control the <code class="docutils literal notranslate"><span class="pre">dashboard</span></code> target, see <a class="reference external" href="TribitsUsersGuide.html#tribits-ctest-driver">tribits_ctest_driver()</a>.  To see
the full list of options, and their default values, one can run with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ env CTEST_DEPENDENCY_HANDLING_UNIT_TESTING=TRUE \
  make dashboard
</pre></div>
</div>
<p>This will print the options with their default values and then do a sort of
mock running of the CTest driver script and point out what it will do with the
given setup.</p>
<p>Any of the vars that are forwarded to the <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-S</span></code> invocation will be
shown in the STDOUT of the <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">dashboard</span></code> invocation on the line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Running</span><span class="p">:</span> <span class="n">env</span> <span class="p">[</span><span class="nb">vars</span> <span class="n">passed</span> <span class="n">through</span> <span class="n">env</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;/</span><span class="n">ctest</span> <span class="o">...</span> <span class="o">-</span><span class="n">S</span> <span class="o">...</span>
</pre></div>
</div>
<p>Any variables passed through the <code class="docutils literal notranslate"><span class="pre">env</span></code> command listed there in <code class="docutils literal notranslate"><span class="pre">[vars</span>
<span class="pre">passed</span> <span class="pre">through</span> <span class="pre">env</span> <span class="pre">]</span></code> can only be changed by setting cache variables in the
CMake project and can’t be overridden in the env when invoking the
<code class="docutils literal notranslate"><span class="pre">dashboard</span></code> target.  For example, the variable <code class="docutils literal notranslate"><span class="pre">CTEST_DO_SUBMIT</span></code> is
forwarded to the <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-S</span></code> invocation and can’t be overridden with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ env CTEST_DO_SUBMIT=OFF make dashboard
</pre></div>
</div>
<p>Instead, to change this value, one must reconfigure and then run as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cmake CTEST_DO_SUBMIT=OFF .
$ make dashboard
</pre></div>
</div>
<p>But any variable that is not listed in <code class="docutils literal notranslate"><span class="pre">[vars</span> <span class="pre">passed</span> <span class="pre">through</span> <span class="pre">env</span> <span class="pre">]</span></code> in the
printed out <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-S</span></code> command that are read in by <a class="reference external" href="TribitsUsersGuide.html#tribits-ctest-driver">tribits_ctest_driver()</a>
can be set in the env by calling:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ env [other vars read by tribits_ctest_driver()] make dashboard
</pre></div>
</div>
<p>To know that these vars are picked up, grep the STDOUT from <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">dashboard</span></code>
for lines containing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">ENV_</span><span class="o">&lt;</span><span class="n">var_name</span><span class="o">&gt;=</span>
</pre></div>
</div>
<p>That way, you will know the var was pick up and read correctly.</p>
</div>
<div class="section" id="common-options-and-use-cases-for-the-dashboard-target">
<h2><a class="toc-backref" href="#id108"><span class="sectnum">11.2</span> Common options and use cases for the ‘dashboard’ target</a><a class="headerlink" href="#common-options-and-use-cases-for-the-dashboard-target" title="Permalink to this headline">¶</a></h2>
<p>What follows are suggestions on how to use the <code class="docutils literal notranslate"><span class="pre">dashboard</span></code> target for
different use cases.</p>
<p>One option that is useful to set is the build name on CDash at configure time
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">DCTEST_BUILD_NAME</span><span class="o">=</span><span class="n">MyBuild</span>
</pre></div>
</div>
<p>After <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">dashboard</span></code> finishes running, look for the build ‘MyBuild’ (or
whatever build name you used above) in the &lt;Project&gt; CDash dashboard (the
CDash URL is printed at the end of STDOUT).  It is useful to set
<code class="docutils literal notranslate"><span class="pre">CTEST_BUILD_NAME</span></code> to some unique name to make it easier to find your
results on the CDash dashboard.  If one does not set <code class="docutils literal notranslate"><span class="pre">CTEST_BUILD_NAME</span></code>,
then the name of the binary directory is used instead by default (which may
not be very descriptive if it called something like <code class="docutils literal notranslate"><span class="pre">BUILD</span></code>).</p>
<p>If there is already a valid configure and build and one does not want to
reconfigure and rebuild or submit configure and build results then one can run
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ env CTEST_DO_CONFIGURE=OFF CTEST_DO_BUILD=OFF \
  make dashboard
</pre></div>
</div>
<p>This will only run the enabled pre-built tests and submit test results to
CDash.  (But is usually good to reconfigure and rebuild and submit those
results to CDash as well in order to define more context for the test
results.)</p>
<p>The configure, builds, and submits are either done package-by-package or
all-at-once as controlled by the variable <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_CTEST_DO_ALL_AT_ONCE</span></code>.
This can be set in the CMake cache when configuring the project using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_CTEST_DO_ALL_AT_ONCE</span><span class="o">=</span><span class="n">TRUE</span>
</pre></div>
</div>
<p>Using the <code class="docutils literal notranslate"><span class="pre">dashboard</span></code> target, one can also run coverage and memory testing
and submit to CDash as described below.  But to take full advantage of the
all-at-once mode and to have results displayed on CDash broken down
package-by-package, one must be submitting to a newer CDash version 3.0+.</p>
<p>For submitting line coverage results, configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_COVERAGE_TESTING</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>and the environment variable <code class="docutils literal notranslate"><span class="pre">CTEST_DO_COVERAGE_TESTING=TRUE</span></code> is
automatically set by the target <code class="docutils literal notranslate"><span class="pre">dashboard</span></code> so you don’t have to set this
yourself.  Then, when you run the <code class="docutils literal notranslate"><span class="pre">dashboard</span></code> target, it will automatically
submit coverage results to CDash as well.</p>
<p>Doing memory checking running the enabled tests with Valgrind requires that
you set <code class="docutils literal notranslate"><span class="pre">CTEST_DO_MEMORY_TESTING=TRUE</span></code> with the <code class="docutils literal notranslate"><span class="pre">env</span></code> command when running
the <code class="docutils literal notranslate"><span class="pre">dashboard</span></code> target as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ env CTEST_DO_MEMORY_TESTING=TRUE make dashboard
</pre></div>
</div>
<p>but also note that you may also need to set the valgrind command and options
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ env CTEST_DO_MEMORY_TESTING=TRUE \
  CTEST_MEMORYCHECK_COMMAND=&lt;abs-path-to-valgrind&gt; \
  CTEST_MEMORYCHECK_COMMAND_OPTIONS=&quot;-q --trace-children=yes --tool=memcheck \
   --leak-check=yes --workaround-gcc296-bugs=yes \
   --num-callers=50 --suppressions=&lt;abs-path-to-supp-file1&gt; \
   ... --suppressions=&lt;abs-path-to-supp-fileN&gt;&quot; \
  make dashboard
</pre></div>
</div>
<p>The CMake cache variable <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_DASHBOARD_CTEST_ARGS</span></code> can be set on the
cmake configure line in order to pass additional arguments to <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-S</span></code>
when invoking the package-by-package CTest driver.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_DASHBOARD_CTEST_ARGS</span><span class="o">=</span><span class="s2">&quot;-VV&quot;</span> \
</pre></div>
</div>
<p>will set very verbose output with CTest that includes the STDOUT for every
test run.  (The default args are <code class="docutils literal notranslate"><span class="pre">-V</span></code> which shows which tests are run but
not the test STDOUT.)</p>
</div>
<div class="section" id="changing-the-cdash-sites-for-the-dashboard-target">
<h2><a class="toc-backref" href="#id109"><span class="sectnum">11.3</span> Changing the CDash sites for the ‘dashboard’ target</a><a class="headerlink" href="#changing-the-cdash-sites-for-the-dashboard-target" title="Permalink to this headline">¶</a></h2>
<p>As described above in <a class="reference internal" href="#setting-options-to-change-behavior-of-dashboard-target">Setting options to change behavior of ‘dashboard’
target</a>, one can change the location where configure, build, and test results
are submitted to one more two CDash sites.  For well-structured TriBITS CMake
projects defining a flexible <code class="docutils literal notranslate"><span class="pre">CTestConfig.cmake</span></code> file, the location of the
main CDash site can be changed by configuring with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">DCTEST_DROP_SITE</span><span class="o">=</span><span class="s2">&quot;some-site.com&quot;</span> \
<span class="o">-</span><span class="n">DCTEST_DROP_LOCATION</span><span class="o">=</span><span class="s2">&quot;/cdash/submit.php?project=&lt;Project&gt;&quot;</span> \
</pre></div>
</div>
<p id="tribits-2nd-ctest-drop-location"><span id="tribits-2nd-ctest-drop-site"></span>Also note that one can submit results to a second CDash site by configuring
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">DTRIBITS_2ND_CTEST_DROP_SITE</span><span class="o">=</span><span class="s2">&quot;&lt;second-site&gt;&quot;</span> \
<span class="o">-</span><span class="n">DTRIBITS_2ND_CTEST_DROP_LOCATION</span><span class="o">=</span><span class="s2">&quot;&lt;second-location&gt;&quot;</span> \
</pre></div>
</div>
<p>If left the same as <code class="docutils literal notranslate"><span class="pre">CTEST_DROP_SITE</span></code> or <code class="docutils literal notranslate"><span class="pre">CTEST_DROP_LOCATION</span></code>, then
<code class="docutils literal notranslate"><span class="pre">TRIBITS_2ND_CTEST_DROP_SITE</span></code> and <code class="docutils literal notranslate"><span class="pre">TRIBITS_2ND_CTEST_DROP_LOCATION</span></code>,
respectively, can be left empty “” and the defaults will be used.  For
example, to submit to an experimental CDash site on the same machine, one
would configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">DTRIBITS_2ND_CTEST_DROP_LOCATION</span><span class="o">=</span><span class="s2">&quot;/testing/cdash/submit.php?project=&lt;Project&gt;&quot;</span>
</pre></div>
</div>
<p>and <code class="docutils literal notranslate"><span class="pre">CTEST_DROP_SITE</span></code> would be used for <code class="docutils literal notranslate"><span class="pre">TRIBITS_2ND_CTEST_DROP_SITE</span></code>
since <code class="docutils literal notranslate"><span class="pre">TRIBITS_2ND_CTEST_DROP_SITE</span></code> is empty.  This is a common use case
when upgrading to a new CDash installation or testing new features for CDash
before impacting the existing CDash site.  (However, the user must set at
least one of these variables to non-empty in order to trigger the second
submit.)</p>
<p><strong>NOTE:</strong> If the project is already set up to submit to a second CDash site
and one wants to turn that off, one can configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">DTRIBITS_2ND_CTEST_DROP_SITE</span><span class="o">=</span><span class="n">OFF</span> \
<span class="o">-</span><span class="n">DTRIBITS_2ND_CTEST_DROP_LOCATION</span><span class="o">=</span><span class="n">OFF</span> \
</pre></div>
</div>
</div>
<div class="section" id="configuring-from-scratch-needed-if-dashboard-target-aborts-early">
<h2><a class="toc-backref" href="#id110"><span class="sectnum">11.4</span> Configuring from scratch needed if ‘dashboard’ target aborts early</a><a class="headerlink" href="#configuring-from-scratch-needed-if-dashboard-target-aborts-early" title="Permalink to this headline">¶</a></h2>
<p>Finally, note that in package-by-package mode
(i.e. <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_CTEST_DO_ALL_AT_ONCE=FALSE</span></code>) that if one kills the <code class="docutils literal notranslate"><span class="pre">make</span>
<span class="pre">dashboard</span></code> target before it completes, then one must reconfigure from scratch
in order to get the build directory back into the same state before the
command was run.  This is because the <code class="docutils literal notranslate"><span class="pre">dashboard</span></code> target in
package-by-package mode must first reconfigure the project with no enabled
packages before it does the package-by-package configure/build/test/submit
which enables each package one at a time.  After the package-by-package
configure/build/test/submit cycles are complete, then the project is
reconfigured with the original set of package enables and returned to the
original configure state.  Even with the all-at-once mode, if one kills the
<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">dashboard</span></code> command before the reconfigure completes, one may be left
with an invalid configuration of the project.  In these cases, one may need to
configure from scratch to get back to the original state before calling <code class="docutils literal notranslate"><span class="pre">make</span>
<span class="pre">dashboard</span></code>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Roscoe A. Bartlett.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>