<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TriBITS Maintainers Guide and Reference</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #2980B9" >
            <a href="../index.html" class="icon icon-home"> TriBITS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#"><span class="sectnum">1</span> Introduction</a></li>
<li><a class="reference internal" href="#background"><span class="sectnum">2</span> Background</a><ul>
<li><a class="reference internal" href="#tribits-developer-and-user-roles"><span class="sectnum">2.1</span> TriBITS Developer and User Roles</a></li>
<li><a class="reference internal" href="#cmake-language-overview-and-gotchas"><span class="sectnum">2.2</span> CMake Language Overview and Gotchas</a></li>
<li><a class="reference internal" href="#software-engineering-packaging-principles"><span class="sectnum">2.3</span> Software Engineering Packaging Principles</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tribits-project-structure"><span class="sectnum">3</span> TriBITS Project Structure</a><ul>
<li><a class="reference internal" href="#tribits-structural-units"><span class="sectnum">3.1</span> TriBITS Structural Units</a><ul>
<li><a class="reference internal" href="#tribits-project">TriBITS Project</a><ul>
<li><a class="reference internal" href="#tribits-project-core-files">TriBITS Project Core Files</a></li>
<li><a class="reference internal" href="#tribits-project-core-variables">TriBITS Project Core Variables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tribits-repository">TriBITS Repository</a><ul>
<li><a class="reference internal" href="#tribits-repository-core-files">TriBITS Repository Core Files</a></li>
<li><a class="reference internal" href="#tribits-repository-core-variables">TriBITS Repository Core Variables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tribits-package">TriBITS Package</a><ul>
<li><a class="reference internal" href="#tribits-package-core-files">TriBITS Package Core Files</a></li>
<li><a class="reference internal" href="#tribits-package-core-variables">TriBITS Package Core Variables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tribits-subpackage">TriBITS Subpackage</a><ul>
<li><a class="reference internal" href="#tribits-subpackage-core-files">TriBITS Subpackage Core Files</a></li>
<li><a class="reference internal" href="#tribits-subpackage-core-variables">TriBITS Subpackage Core Variables</a></li>
<li><a class="reference internal" href="#how-is-a-tribits-subpackage-different-from-a-tribits-package">How is a TriBITS Subpackage different from a TriBITS Package?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tribits-external-package-tpl">TriBITS External Package/TPL</a><ul>
<li><a class="reference internal" href="#tribits-external-package-tpl-core-files">TriBITS External Package/TPL Core Files</a></li>
<li><a class="reference internal" href="#tribits-external-package-tpl-core-variables">TriBITS External Package/TPL Core Variables</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#processing-of-tribits-files-ordering-and-details"><span class="sectnum">3.2</span> Processing of TriBITS Files: Ordering and Details</a><ul>
<li><a class="reference internal" href="#full-tribits-project-configuration">Full TriBITS Project Configuration</a></li>
<li><a class="reference internal" href="#reduced-package-dependency-processing">Reduced Package Dependency Processing</a></li>
<li><a class="reference internal" href="#file-processing-tracing">File Processing Tracing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#coexisting-projects-repositories-and-packages"><span class="sectnum">3.3</span> Coexisting Projects, Repositories, and Packages</a></li>
<li><a class="reference internal" href="#standard-and-common-tpls"><span class="sectnum">3.4</span> Standard and Common TPLs</a><ul>
<li><a class="reference internal" href="#standard-tribits-tpls">Standard TriBITS TPLs</a></li>
<li><a class="reference internal" href="#common-tribits-tpls">Common TriBITS TPLs</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#example-tribits-projects"><span class="sectnum">4</span> Example TriBITS Projects</a><ul>
<li><a class="reference internal" href="#tribitshelloworld"><span class="sectnum">4.1</span> TribitsHelloWorld</a></li>
<li><a class="reference internal" href="#tribitsexampleproject"><span class="sectnum">4.2</span> TribitsExampleProject</a></li>
<li><a class="reference internal" href="#mocktrilinos"><span class="sectnum">4.3</span> MockTrilinos</a></li>
<li><a class="reference internal" href="#reducedmocktrilinos"><span class="sectnum">4.4</span> ReducedMockTrilinos</a></li>
<li><a class="reference internal" href="#trilinos"><span class="sectnum">4.5</span> Trilinos</a></li>
<li><a class="reference internal" href="#the-tribits-test-package"><span class="sectnum">4.6</span> The TriBITS Test Package</a></li>
</ul>
</li>
<li><a class="reference internal" href="#package-dependencies-and-enable-disable-logic"><span class="sectnum">5</span> Package Dependencies and Enable/Disable Logic</a><ul>
<li><a class="reference internal" href="#example-reducedmocktrilinos-project-dependency-structure"><span class="sectnum">5.1</span> Example ReducedMockTrilinos Project Dependency Structure</a></li>
<li><a class="reference internal" href="#tribits-dependency-handling-behaviors"><span class="sectnum">5.2</span> TriBITS Dependency Handling Behaviors</a></li>
<li><a class="reference internal" href="#example-enable-disable-use-cases"><span class="sectnum">5.3</span> Example Enable/Disable Use Cases</a></li>
<li><a class="reference internal" href="#tribits-project-dependencies-xml-file-and-tools"><span class="sectnum">5.4</span> TriBITS Project Dependencies XML file and tools</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tribits-automated-testing"><span class="sectnum">6</span> TriBITS Automated Testing</a><ul>
<li><a class="reference internal" href="#test-classifications-for-repositories-packages-and-tests"><span class="sectnum">6.1</span> Test Classifications for Repositories, Packages, and Tests</a></li>
<li><a class="reference internal" href="#nested-layers-of-tribits-project-testing"><span class="sectnum">6.2</span> Nested Layers of TriBITS Project Testing</a></li>
<li><a class="reference internal" href="#pre-push-testing-using-checkin-test-py"><span class="sectnum">6.3</span> Pre-push Testing using checkin-test.py</a></li>
<li><a class="reference internal" href="#tribits-ctest-cdash-driver"><span class="sectnum">6.4</span> TriBITS CTest/CDash Driver</a><ul>
<li><a class="reference internal" href="#ctest-cdash-nightly-testing">CTest/CDash Nightly Testing</a></li>
<li><a class="reference internal" href="#ctest-cdash-ci-server">CTest/CDash CI Server</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tribits-cdash-customizations"><span class="sectnum">6.5</span> TriBITS CDash Customizations</a><ul>
<li><a class="reference internal" href="#cdash-regression-email-addresses">CDash regression email addresses</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#multi-repository-support"><span class="sectnum">7</span> Multi-Repository Support</a></li>
<li><a class="reference internal" href="#development-workflows"><span class="sectnum">8</span> Development Workflows</a><ul>
<li><a class="reference internal" href="#basic-development-workflow"><span class="sectnum">8.1</span> Basic Development Workflow</a></li>
<li><a class="reference internal" href="#multi-repository-development-workflow"><span class="sectnum">8.2</span> Multi-Repository Development Workflow</a></li>
</ul>
</li>
<li><a class="reference internal" href="#howtos"><span class="sectnum">9</span> Howtos</a><ul>
<li><a class="reference internal" href="#how-to-add-a-new-tribits-package"><span class="sectnum">9.1</span> How to add a new TriBITS Package</a></li>
<li><a class="reference internal" href="#how-to-add-a-new-tribits-package-with-subpackages"><span class="sectnum">9.2</span> How to add a new TriBITS Package with Subpackages</a></li>
<li><a class="reference internal" href="#how-to-add-a-new-tribits-subpackage"><span class="sectnum">9.3</span> How to add a new TriBITS Subpackage</a></li>
<li><a class="reference internal" href="#how-to-add-a-new-tribits-external-package-tpl"><span class="sectnum">9.4</span> How to add a new TriBITS external package/TPL</a><ul>
<li><a class="reference internal" href="#creating-findtpl-tplname-cmake-using-find-package">Creating FindTPL&lt;tplName&gt;.cmake using find_package()</a><ul>
<li><a class="reference internal" href="#creating-findtpl-tplname-cmake-using-find-package-with-imported-targets">Creating FindTPL&lt;tplName&gt;.cmake using find_package() with IMPORTED targets</a></li>
<li><a class="reference internal" href="#creating-findtpl-tplname-cmake-using-find-package-without-imported-targets">Creating FindTPL&lt;tplName&gt;.cmake using find_package() without IMPORTED targets</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-a-findtpl-tplname-cmake-module-without-find-package">Creating a FindTPL&lt;tplName&gt;.cmake module without find_package()</a></li>
<li><a class="reference internal" href="#requirements-for-findtpl-tplname-cmake-modules">Requirements for FindTPL&lt;tplName&gt;.cmake modules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-add-a-new-tribits-repository"><span class="sectnum">9.5</span> How to add a new TriBITS Repository</a></li>
<li><a class="reference internal" href="#how-to-add-a-new-tribits-se-package-dependency"><span class="sectnum">9.6</span> How to add a new TriBITS SE Package dependency</a></li>
<li><a class="reference internal" href="#how-to-add-a-new-tribits-tpl-dependency"><span class="sectnum">9.7</span> How to add a new TriBITS TPL dependency</a></li>
<li><a class="reference internal" href="#how-to-tentatively-enable-a-tpl"><span class="sectnum">9.8</span> How to tentatively enable a TPL</a></li>
<li><a class="reference internal" href="#how-to-insert-a-package-into-an-upstream-repo"><span class="sectnum">9.9</span> How to insert a package into an upstream repo</a></li>
<li><a class="reference internal" href="#how-to-put-a-tribits-and-raw-cmake-build-system-side-by-side"><span class="sectnum">9.10</span> How to put a TriBITS and raw CMake build system side-by-side</a></li>
<li><a class="reference internal" href="#how-to-check-for-and-tweak-tribits-enable-cache-variables"><span class="sectnum">9.11</span> How to check for and tweak TriBITS “ENABLE” cache variables</a></li>
<li><a class="reference internal" href="#how-to-tweak-downstream-tribits-enable-variables-during-package-configuration"><span class="sectnum">9.12</span> How to tweak downstream TriBITS “ENABLE” variables during package configuration</a></li>
<li><a class="reference internal" href="#how-to-set-up-multi-repository-support"><span class="sectnum">9.13</span> How to set up multi-repository support</a></li>
<li><a class="reference internal" href="#how-to-submit-testing-results-to-a-cdash-site"><span class="sectnum">9.14</span> How to submit testing results to a CDash site</a></li>
<li><a class="reference internal" href="#how-to-submit-testing-results-to-a-custom-cdash-group"><span class="sectnum">9.15</span> How to submit testing results to a custom CDash Group</a></li>
</ul>
</li>
<li><a class="reference internal" href="#miscellaneous-topics"><span class="sectnum">10</span> Miscellaneous Topics</a><ul>
<li><a class="reference internal" href="#tribits-repository-contents"><span class="sectnum">10.1</span> TriBITS Repository Contents</a><ul>
<li><a class="reference internal" href="#tribits-directory-contents">TriBITS/ Directory Contents</a></li>
<li><a class="reference internal" href="#tribits-tribits-directory-contents">TriBITS/tribits/ Directory Contents</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tribits-system-project-dependencies"><span class="sectnum">10.2</span> TriBITS System Project Dependencies</a></li>
<li><a class="reference internal" href="#python-support"><span class="sectnum">10.3</span> Python Support</a></li>
<li><a class="reference internal" href="#project-specific-build-reference"><span class="sectnum">10.4</span> Project-Specific Build Reference</a></li>
<li><a class="reference internal" href="#project-and-repository-versioning-and-release-mode"><span class="sectnum">10.5</span> Project and Repository Versioning and Release Mode</a></li>
<li><a class="reference internal" href="#tribits-environment-probing-and-setup"><span class="sectnum">10.6</span> TriBITS Environment Probing and Setup</a></li>
<li><a class="reference internal" href="#tricky-considerations-for-tribits-generated-tplname-config-cmake-files"><span class="sectnum">10.7</span> Tricky considerations for TriBITS-generated &lt;tplName&gt;Config.cmake files</a></li>
<li><a class="reference internal" href="#installation-considerations"><span class="sectnum">10.8</span> Installation considerations</a></li>
<li><a class="reference internal" href="#rpath-handling"><span class="sectnum">10.9</span> RPATH Handling</a></li>
<li><a class="reference internal" href="#configure-time-system-tests"><span class="sectnum">10.10</span> Configure-time System Tests</a></li>
<li><a class="reference internal" href="#creating-source-distributions"><span class="sectnum">10.11</span> Creating Source Distributions</a></li>
<li><a class="reference internal" href="#using-git-bisect-with-checkin-test-py-workflows"><span class="sectnum">10.12</span> Using Git Bisect with checkin-test.py workflows</a></li>
<li><a class="reference internal" href="#multi-repository-almost-continuous-integration"><span class="sectnum">10.13</span> Multi-Repository Almost Continuous Integration</a><ul>
<li><a class="reference internal" href="#aci-introduction">ACI Introduction</a></li>
<li><a class="reference internal" href="#aci-multi-git-tribits-repo-integration-example">ACI Multi-Git/TriBITS Repo Integration Example</a></li>
<li><a class="reference internal" href="#aci-local-sync-git-repo-setup">ACI Local Sync Git Repo Setup</a></li>
<li><a class="reference internal" href="#aci-integration-build-directory-setup">ACI Integration Build Directory Setup</a></li>
<li><a class="reference internal" href="#aci-sync-driver-script">ACI Sync Driver Script</a></li>
<li><a class="reference internal" href="#aci-cron-job-setup">ACI Cron Job Setup</a></li>
<li><a class="reference internal" href="#addressing-aci-failures-and-summary">Addressing ACI Failures and Summary</a></li>
</ul>
</li>
<li><a class="reference internal" href="#post-push-ci-and-nightly-testing-using-checkin-test-py"><span class="sectnum">10.14</span> Post-Push CI and Nightly Testing using checkin-test.py</a></li>
<li><a class="reference internal" href="#tribits-dashboard-driver"><span class="sectnum">10.15</span> TriBITS Dashboard Driver</a></li>
<li><a class="reference internal" href="#regulated-backward-compatibility-and-deprecated-code"><span class="sectnum">10.16</span> Regulated Backward Compatibility and Deprecated Code</a><ul>
<li><a class="reference internal" href="#setting-up-support-for-deprecated-code-handling">Setting up support for deprecated code handling</a></li>
<li><a class="reference internal" href="#deprecating-code-but-maintaining-backward-compatibility">Deprecating code but maintaining backward compatibility</a><ul>
<li><a class="reference internal" href="#deprecating-c-c-classes-structs-functions-typdefs-etc">Deprecating C/C++ classes, structs, functions, typdefs, etc.</a></li>
<li><a class="reference internal" href="#deprecating-preprocessor-macros">Deprecating preprocessor macros</a></li>
<li><a class="reference internal" href="#deprecating-an-entire-header-and-or-source-file">Deprecating an entire header and/or source file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hiding-deprecated-code-to-certify-and-facilitate-later-removal">Hiding deprecated code to certify and facilitate later removal</a><ul>
<li><a class="reference internal" href="#hiding-c-c-entities">Hiding C/C++ entities</a></li>
<li><a class="reference internal" href="#hiding-entire-deprecated-header-and-source-files">Hiding entire deprecated header and source files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#physically-removing-deprecated-code">Physically removing deprecated code</a><ul>
<li><a class="reference internal" href="#removing-entire-deprecated-header-and-source-files">Removing entire deprecated header and source files</a></li>
<li><a class="reference internal" href="#removing-deprecated-code-from-remaining-files">Removing deprecated code from remaining files</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#installation-and-backward-compatibility-testing"><span class="sectnum">10.17</span> Installation and Backward Compatibility Testing</a></li>
<li><a class="reference internal" href="#wrapping-externally-configured-built-software"><span class="sectnum">10.18</span> Wrapping Externally Configured/Built Software</a></li>
<li><a class="reference internal" href="#tribits-directory-snapshotting"><span class="sectnum">10.19</span> TriBITS directory snapshotting</a></li>
<li><a class="reference internal" href="#tribits-development-toolset"><span class="sectnum">10.20</span> TriBITS Development Toolset</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tribits-detailed-reference-documentation"><span class="sectnum">11</span> TriBITS Detailed Reference Documentation</a><ul>
<li><a class="reference internal" href="#tribits-global-project-settings"><span class="sectnum">11.1</span> TriBITS Global Project Settings</a></li>
<li><a class="reference internal" href="#tribits-macros-and-functions"><span class="sectnum">11.2</span> TriBITS Macros and Functions</a><ul>
<li><a class="reference internal" href="#tribits-add-advanced-test">tribits_add_advanced_test()</a></li>
<li><a class="reference internal" href="#tribits-add-debug-option">tribits_add_debug_option()</a></li>
<li><a class="reference internal" href="#tribits-add-example-directories">tribits_add_example_directories()</a></li>
<li><a class="reference internal" href="#tribits-add-executable">tribits_add_executable()</a></li>
<li><a class="reference internal" href="#tribits-add-executable-and-test">tribits_add_executable_and_test()</a></li>
<li><a class="reference internal" href="#tribits-add-library">tribits_add_library()</a></li>
<li><a class="reference internal" href="#tribits-add-option-and-define">tribits_add_option_and_define()</a></li>
<li><a class="reference internal" href="#tribits-add-show-deprecated-warnings-option">tribits_add_show_deprecated_warnings_option()</a></li>
<li><a class="reference internal" href="#tribits-add-test">tribits_add_test()</a></li>
<li><a class="reference internal" href="#tribits-add-test-directories">tribits_add_test_directories()</a></li>
<li><a class="reference internal" href="#tribits-allow-missing-external-packages">tribits_allow_missing_external_packages()</a></li>
<li><a class="reference internal" href="#tribits-configure-file">tribits_configure_file()</a></li>
<li><a class="reference internal" href="#tribits-copy-files-to-binary-dir">tribits_copy_files_to_binary_dir()</a></li>
<li><a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a></li>
<li><a class="reference internal" href="#tribits-determine-if-current-package-needs-rebuilt">tribits_determine_if_current_package_needs_rebuilt()</a></li>
<li><a class="reference internal" href="#tribits-disable-package-on-platforms">tribits_disable_package_on_platforms()</a></li>
<li><a class="reference internal" href="#tribits-exclude-files">tribits_exclude_files()</a></li>
<li><a class="reference internal" href="#tribits-extpkg-define-dependencies">tribits_extpkg_define_dependencies()</a></li>
<li><a class="reference internal" href="#tribits-extpkg-get-dep-name-and-vis">tribits_extpkg_get_dep_name_and_vis()</a></li>
<li><a class="reference internal" href="#tribits-extpkg-create-imported-all-libs-target-and-config-file">tribits_extpkg_create_imported_all_libs_target_and_config_file()</a></li>
<li><a class="reference internal" href="#tribits-extpkg-write-config-file">tribits_extpkg_write_config_file()</a></li>
<li><a class="reference internal" href="#tribits-extpkg-write-config-file-str">tribits_extpkg_write_config_file_str()</a></li>
<li><a class="reference internal" href="#tribits-find-most-recent-binary-file-timestamp">tribits_find_most_recent_binary_file_timestamp()</a></li>
<li><a class="reference internal" href="#tribits-find-most-recent-file-timestamp">tribits_find_most_recent_file_timestamp()</a></li>
<li><a class="reference internal" href="#tribits-find-most-recent-source-file-timestamp">tribits_find_most_recent_source_file_timestamp()</a></li>
<li><a class="reference internal" href="#tribits-install-headers">tribits_install_headers()</a></li>
<li><a class="reference internal" href="#tribits-include-directories">tribits_include_directories()</a></li>
<li><a class="reference internal" href="#id1">tribits_package()</a></li>
<li><a class="reference internal" href="#tribits-package-decl">tribits_package_decl()</a></li>
<li><a class="reference internal" href="#tribits-package-def">tribits_package_def()</a></li>
<li><a class="reference internal" href="#tribits-package-define-dependencies">tribits_package_define_dependencies()</a></li>
<li><a class="reference internal" href="#tribits-package-postprocess">tribits_package_postprocess()</a></li>
<li><a class="reference internal" href="#tribits-process-subpackages">tribits_process_subpackages()</a></li>
<li><a class="reference internal" href="#tribits-process-enabled-tpl">tribits_process_enabled_tpl()</a></li>
<li><a class="reference internal" href="#id2">tribits_project()</a></li>
<li><a class="reference internal" href="#tribits-project-define-extra-repositories">tribits_project_define_extra_repositories()</a></li>
<li><a class="reference internal" href="#tribits-project-enable-all">tribits_project_enable_all()</a></li>
<li><a class="reference internal" href="#tribits-repository-define-packages">tribits_repository_define_packages()</a></li>
<li><a class="reference internal" href="#tribits-repository-define-tpls">tribits_repository_define_tpls()</a></li>
<li><a class="reference internal" href="#tribits-set-st-for-dev-mode">tribits_set_st_for_dev_mode()</a></li>
<li><a class="reference internal" href="#id3">tribits_subpackage()</a></li>
<li><a class="reference internal" href="#tribits-subpackage-postprocess">tribits_subpackage_postprocess()</a></li>
<li><a class="reference internal" href="#tribits-tpl-allow-pre-find-package">tribits_tpl_allow_pre_find_package()</a></li>
<li><a class="reference internal" href="#tribits-tpl-find-include-dirs-and-libraries">tribits_tpl_find_include_dirs_and_libraries()</a></li>
<li><a class="reference internal" href="#tribits-tpl-libraries-entry-type">tribits_tpl_libraries_entry_type()</a></li>
<li><a class="reference internal" href="#tribits-tpl-tentatively-enable">tribits_tpl_tentatively_enable()</a></li>
<li><a class="reference internal" href="#tribits-write-flexible-package-client-export-files">tribits_write_flexible_package_client_export_files()</a></li>
<li><a class="reference internal" href="#tribits-verbose-print-var">tribits_verbose_print_var()</a></li>
</ul>
</li>
<li><a class="reference internal" href="#general-utility-macros-and-functions"><span class="sectnum">11.3</span> General Utility Macros and Functions</a><ul>
<li><a class="reference internal" href="#add-subdirectories">add_subdirectories()</a></li>
<li><a class="reference internal" href="#advanced-option">advanced_option()</a></li>
<li><a class="reference internal" href="#advanced-set">advanced_set()</a></li>
<li><a class="reference internal" href="#append-cmndline-args">append_cmndline_args()</a></li>
<li><a class="reference internal" href="#append-glob">append_glob()</a></li>
<li><a class="reference internal" href="#append-global-set">append_global_set()</a></li>
<li><a class="reference internal" href="#append-set">append_set()</a></li>
<li><a class="reference internal" href="#append-string-var">append_string_var()</a></li>
<li><a class="reference internal" href="#append-string-var-ext">append_string_var_ext()</a></li>
<li><a class="reference internal" href="#append-string-var-with-sep">append_string_var_with_sep()</a></li>
<li><a class="reference internal" href="#assert-defined">assert_defined()</a></li>
<li><a class="reference internal" href="#combined-option">combined_option()</a></li>
<li><a class="reference internal" href="#concat-strings">concat_strings()</a></li>
<li><a class="reference internal" href="#dual-scope-append-cmndline-args">dual_scope_append_cmndline_args()</a></li>
<li><a class="reference internal" href="#dual-scope-prepend-cmndline-args">dual_scope_prepend_cmndline_args()</a></li>
<li><a class="reference internal" href="#dual-scope-set">dual_scope_set()</a></li>
<li><a class="reference internal" href="#global-null-set">global_null_set()</a></li>
<li><a class="reference internal" href="#global-set">global_set()</a></li>
<li><a class="reference internal" href="#join">join()</a></li>
<li><a class="reference internal" href="#message-wrapper">message_wrapper()</a></li>
<li><a class="reference internal" href="#multiline-set">multiline_set()</a></li>
<li><a class="reference internal" href="#prepend-cmndline-args">prepend_cmndline_args()</a></li>
<li><a class="reference internal" href="#prepend-global-set">prepend_global_set()</a></li>
<li><a class="reference internal" href="#print-nonempty-var">print_nonempty_var()</a></li>
<li><a class="reference internal" href="#print-nonempty-var-with-spaces">print_nonempty_var_with_spaces()</a></li>
<li><a class="reference internal" href="#print-var">print_var()</a></li>
<li><a class="reference internal" href="#print-var-with-spaces">print_var_with_spaces()</a></li>
<li><a class="reference internal" href="#remove-global-duplicates">remove_global_duplicates()</a></li>
<li><a class="reference internal" href="#set-and-inc-dirs">set_and_inc_dirs()</a></li>
<li><a class="reference internal" href="#set-cache-on-off-empty">set_cache_on_off_empty()</a></li>
<li><a class="reference internal" href="#set-default">set_default()</a></li>
<li><a class="reference internal" href="#set-default-and-from-env">set_default_and_from_env()</a></li>
<li><a class="reference internal" href="#split">split()</a></li>
<li><a class="reference internal" href="#timer-get-raw-seconds">timer_get_raw_seconds()</a></li>
<li><a class="reference internal" href="#timer-get-rel-seconds">timer_get_rel_seconds()</a></li>
<li><a class="reference internal" href="#timer-print-rel-time">timer_print_rel_time()</a></li>
<li><a class="reference internal" href="#tribits-strip-quotes-from-str">tribits_strip_quotes_from_str()</a></li>
<li><a class="reference internal" href="#unittest-compare-const">unittest_compare_const()</a></li>
<li><a class="reference internal" href="#unittest-has-substr-const">unittest_has_substr_const()</a></li>
<li><a class="reference internal" href="#unittest-not-has-substr-const">unittest_not_has_substr_const()</a></li>
<li><a class="reference internal" href="#unittest-string-regex">unittest_string_regex()</a></li>
<li><a class="reference internal" href="#unittest-string-var-regex">unittest_string_var_regex()</a></li>
<li><a class="reference internal" href="#unittest-file-regex">unittest_file_regex()</a></li>
<li><a class="reference internal" href="#unittest-final-result">unittest_final_result()</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#tribits-system-maintainers-documentation"><span class="sectnum">12</span> TriBITS System Maintainers Documentation</a><ul>
<li><a class="reference internal" href="#tribits-system-data-structures"><span class="sectnum">12.1</span> TriBITS System Data Structures</a><ul>
<li><a class="reference internal" href="#basic-tribits-project-repository-package-and-subpackage-core-variables">Basic TriBITS Project, Repository, Package, and Subpackage Core Variables</a></li>
<li><a class="reference internal" href="#lists-of-external-and-internal-packages">Lists of external and internal packages</a></li>
<li><a class="reference internal" href="#list-variables-defining-the-package-dependencies-graph">List variables defining the package dependencies graph</a></li>
<li><a class="reference internal" href="#determining-if-a-package-is-internal-or-external">Determining if a package is internal or external</a></li>
<li><a class="reference internal" href="#external-package-dependencies">External package dependencies</a></li>
<li><a class="reference internal" href="#flat-lists-of-direct-package-dependencies">Flat lists of direct package dependencies</a></li>
<li><a class="reference internal" href="#list-variables-defining-include-directories-and-libraries">List variables defining include directories and libraries</a></li>
<li><a class="reference internal" href="#user-enable-disable-cache-variables">User enable/disable cache variables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph"><span class="sectnum">12.2</span> Function call tree for constructing package dependency graph</a></li>
<li><a class="reference internal" href="#notes-on-dependency-logic"><span class="sectnum">12.3</span> Notes on dependency logic</a></li>
<li><a class="reference internal" href="#tribits-system-macros-and-functions"><span class="sectnum">12.4</span> TriBITS System Macros and Functions</a><ul>
<li><a class="reference internal" href="#tribits-abort-on-missing-package">tribits_abort_on_missing_package()</a></li>
<li><a class="reference internal" href="#tribits-abort-on-self-dep">tribits_abort_on_self_dep()</a></li>
<li><a class="reference internal" href="#tribits-adjust-package-enables">tribits_adjust_package_enables()</a></li>
<li><a class="reference internal" href="#tribits-append-forward-dep-packages">tribits_append_forward_dep_packages()</a></li>
<li><a class="reference internal" href="#tribits-assert-read-dependency-vars">tribits_assert_read_dependency_vars()</a></li>
<li><a class="reference internal" href="#tribits-extpkg-add-find-upstream-dependencies-str">tribits_extpkg_add_find_upstream_dependencies_str()</a></li>
<li><a class="reference internal" href="#tribits-extpkg-create-all-libs-target">tribits_extpkg_create_all_libs_target()</a></li>
<li><a class="reference internal" href="#tribits-extpkg-install-config-file">tribits_extpkg_install_config_file()</a></li>
<li><a class="reference internal" href="#tribits-extpkg-install-config-version-file">tribits_extpkg_install_config_version_file()</a></li>
<li><a class="reference internal" href="#tribits-extpkg-process-libraries-list">tribits_extpkg_process_libraries_list()</a></li>
<li><a class="reference internal" href="#tribits-extpkg-setup-enabled-dependencies">tribits_extpkg_setup_enabled_dependencies()</a></li>
<li><a class="reference internal" href="#tribits-extpkg-write-config-version-file">tribits_extpkg_write_config_version_file()</a></li>
<li><a class="reference internal" href="#tribits-dump-package-dependencies-info">tribits_dump_package_dependencies_info()</a></li>
<li><a class="reference internal" href="#tribits-print-initial-dependency-info">tribits_print_initial_dependency_info()</a></li>
<li><a class="reference internal" href="#tribits-print-tentatively-enabled-tpls">tribits_print_tentatively_enabled_tpls()</a></li>
<li><a class="reference internal" href="#tribits-parse-subpackages-append-se-packages-add-options">tribits_parse_subpackages_append_se_packages_add_options()</a></li>
<li><a class="reference internal" href="#tribits-prep-to-read-dependencies">tribits_prep_to_read_dependencies()</a></li>
<li><a class="reference internal" href="#tribits-process-all-repository-deps-setup-files">tribits_process_all_repository_deps_setup_files()</a></li>
<li><a class="reference internal" href="#tribits-process-package-dependencies-lists">tribits_process_package_dependencies_lists()</a></li>
<li><a class="reference internal" href="#tribits-process-packages-and-dirs-lists">tribits_process_packages_and_dirs_lists()</a></li>
<li><a class="reference internal" href="#tribits-process-project-dependency-setup-file">tribits_process_project_dependency_setup_file()</a></li>
<li><a class="reference internal" href="#tribits-process-tpls-lists">tribits_process_tpls_lists()</a></li>
<li><a class="reference internal" href="#tribits-read-all-package-deps-files-create-deps-graph">tribits_read_all_package_deps_files_create_deps_graph()</a></li>
<li><a class="reference internal" href="#tribits-read-all-project-deps-files-create-deps-graph">tribits_read_all_project_deps_files_create_deps_graph()</a></li>
<li><a class="reference internal" href="#tribits-read-back-dependencies-vars">tribits_read_back_dependencies_vars()</a></li>
<li><a class="reference internal" href="#tribits-read-defined-external-and-internal-toplevel-packages-lists">tribits_read_defined_external_and_internal_toplevel_packages_lists()</a></li>
<li><a class="reference internal" href="#tribits-read-deps-files-create-deps-graph">tribits_read_deps_files_create_deps_graph()</a></li>
<li><a class="reference internal" href="#tribits-read-external-package-deps-files-add-to-graph">tribits_read_external_package_deps_files_add_to_graph()</a></li>
<li><a class="reference internal" href="#tribits-read-package-subpackage-deps-files-add-to-graph">tribits_read_package_subpackage_deps_files_add_to_graph()</a></li>
<li><a class="reference internal" href="#tribits-read-subpackage-deps-file-add-to-graph">tribits_read_subpackage_deps_file_add_to_graph()</a></li>
<li><a class="reference internal" href="#tribits-read-toplevel-package-deps-files-add-to-graph">tribits_read_toplevel_package_deps_files_add_to_graph()</a></li>
<li><a class="reference internal" href="#tribits-save-off-dependency-vars">tribits_save_off_dependency_vars()</a></li>
<li><a class="reference internal" href="#tribits-set-dep-packages">tribits_set_dep_packages()</a></li>
<li><a class="reference internal" href="#tribits-trace-file-processing">tribits_trace_file_processing()</a></li>
<li><a class="reference internal" href="#tribits-write-package-client-export-files-install-targets">tribits_write_package_client_export_files_install_targets()</a></li>
<li><a class="reference internal" href="#tribits-write-xml-dependency-files">tribits_write_xml_dependency_files()</a></li>
<li><a class="reference internal" href="#tribits-write-xml-dependency-files-if-supported">tribits_write_xml_dependency_files_if_supported()</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#references"><span class="sectnum">13</span> References</a></li>
<li><a class="reference internal" href="#faq"><span class="sectnum">14</span> FAQ</a></li>
<li><a class="reference internal" href="#appendix"><span class="sectnum">15</span> Appendix</a><ul>
<li><a class="reference internal" href="#history-of-tribits"><span class="sectnum">15.1</span> History of TriBITS</a></li>
<li><a class="reference internal" href="#why-a-tribits-package-is-not-a-cmake-package"><span class="sectnum">15.2</span> Why a TriBITS Package is not a CMake Package</a></li>
<li><a class="reference internal" href="#design-considerations-for-tribits"><span class="sectnum">15.3</span> Design Considerations for TriBITS</a></li>
<li><a class="reference internal" href="#clone-extra-repos-py-help"><span class="sectnum">15.4</span> clone_extra_repos.py –help</a></li>
<li><a class="reference internal" href="#gitdist-documentation"><span class="sectnum">15.5</span> gitdist documentation</a><ul>
<li><a class="reference internal" href="#gitdist-help">gitdist –help</a></li>
<li><a class="reference internal" href="#gitdist-dist-help-overview">gitdist –dist-help=overview</a></li>
<li><a class="reference internal" href="#gitdist-dist-help-repo-selection-and-setup">gitdist –dist-help=repo-selection-and-setup</a></li>
<li><a class="reference internal" href="#gitdist-dist-help-dist-repo-status">gitdist –dist-help=dist-repo-status</a></li>
<li><a class="reference internal" href="#gitdist-dist-help-repo-versions">gitdist –dist-help=repo-versions</a></li>
<li><a class="reference internal" href="#gitdist-dist-help-aliases">gitdist –dist-help=aliases</a></li>
<li><a class="reference internal" href="#gitdist-dist-help-default-branch">gitdist –dist-help=default-branch</a></li>
<li><a class="reference internal" href="#gitdist-dist-help-move-to-base-dir">gitdist –dist-help=move-to-base-dir</a></li>
<li><a class="reference internal" href="#gitdist-dist-help-usage-tips">gitdist –dist-help=usage-tips</a></li>
<li><a class="reference internal" href="#gitdist-dist-help-script-dependencies">gitdist –dist-help=script-dependencies</a></li>
<li><a class="reference internal" href="#gitdist-dist-help-all">gitdist –dist-help=all</a></li>
</ul>
</li>
<li><a class="reference internal" href="#snapshot-dir-py-help"><span class="sectnum">15.6</span> snapshot-dir.py –help</a></li>
<li><a class="reference internal" href="#checkin-test-py-help"><span class="sectnum">15.7</span> checkin-test.py –help</a></li>
<li><a class="reference internal" href="#is-checkin-tested-commit-py-help"><span class="sectnum">15.8</span> is_checkin_tested_commit.py –help</a></li>
<li><a class="reference internal" href="#get-tribits-packages-from-files-list-py-help"><span class="sectnum">15.9</span> get-tribits-packages-from-files-list.py –help</a></li>
<li><a class="reference internal" href="#get-tribits-packages-from-last-tests-failed-py-help"><span class="sectnum">15.10</span> get-tribits-packages-from-last-tests-failed.py –help</a></li>
<li><a class="reference internal" href="#filter-packages-list-py-help"><span class="sectnum">15.11</span> filter-packages-list.py –help</a></li>
<li><a class="reference internal" href="#install-devtools-py-help"><span class="sectnum">15.12</span> install_devtools.py –help</a></li>
</ul>
</li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #2980B9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">TriBITS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
      <li><span class="sectnum">1</span> Introduction</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p class="rubric">TriBITS Maintainers Guide and Reference</p>
<dl class="field-list simple">
<dt class="field-odd">Author</dt>
<dd class="field-odd"><p>Roscoe A. Bartlett (<a class="reference external" href="mailto:rabartl&#37;&#52;&#48;sandia&#46;gov">rabartl<span>&#64;</span>sandia<span>&#46;</span>gov</a>)</p>
</dd>
<dt class="field-even">Date</dt>
<dd class="field-even"><p>2022-07-22</p>
</dd>
<dt class="field-odd">Version</dt>
<dd class="field-odd"><p>tribits_start-2983-g0d1da434</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Abstract</dt>
<dd class="field-odd"><p>This document describes the internal implementation and the maintenance of the TriBITS project itself.  The primary audience are those individuals who will make changes and contributions to the TriBITS project or just want to understand its implementation details.  Included is all of the same information as the TriBITS Users Guide but also include file names and line numbers for all of the documented TriBITS macros and functions.</p>
</dd>
</dl>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="auto-toc simple">
<li><p><a class="reference internal" href="#introduction" id="id4"><span class="sectnum">1</span> Introduction</a></p></li>
<li><p><a class="reference internal" href="#background" id="id5"><span class="sectnum">2</span> Background</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#tribits-developer-and-user-roles" id="id6"><span class="sectnum">2.1</span> TriBITS Developer and User Roles</a></p></li>
<li><p><a class="reference internal" href="#cmake-language-overview-and-gotchas" id="id7"><span class="sectnum">2.2</span> CMake Language Overview and Gotchas</a></p></li>
<li><p><a class="reference internal" href="#software-engineering-packaging-principles" id="id8"><span class="sectnum">2.3</span> Software Engineering Packaging Principles</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#tribits-project-structure" id="id9"><span class="sectnum">3</span> TriBITS Project Structure</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#tribits-structural-units" id="id10"><span class="sectnum">3.1</span> TriBITS Structural Units</a></p>
<ul>
<li><p><a class="reference internal" href="#tribits-project" id="id11">TriBITS Project</a></p>
<ul>
<li><p><a class="reference internal" href="#tribits-project-core-files" id="id12">TriBITS Project Core Files</a></p></li>
<li><p><a class="reference internal" href="#tribits-project-core-variables" id="id13">TriBITS Project Core Variables</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#tribits-repository" id="id14">TriBITS Repository</a></p>
<ul>
<li><p><a class="reference internal" href="#tribits-repository-core-files" id="id15">TriBITS Repository Core Files</a></p></li>
<li><p><a class="reference internal" href="#tribits-repository-core-variables" id="id16">TriBITS Repository Core Variables</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#tribits-package" id="id17">TriBITS Package</a></p>
<ul>
<li><p><a class="reference internal" href="#tribits-package-core-files" id="id18">TriBITS Package Core Files</a></p></li>
<li><p><a class="reference internal" href="#tribits-package-core-variables" id="id19">TriBITS Package Core Variables</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#tribits-subpackage" id="id20">TriBITS Subpackage</a></p>
<ul>
<li><p><a class="reference internal" href="#tribits-subpackage-core-files" id="id21">TriBITS Subpackage Core Files</a></p></li>
<li><p><a class="reference internal" href="#tribits-subpackage-core-variables" id="id22">TriBITS Subpackage Core Variables</a></p></li>
<li><p><a class="reference internal" href="#how-is-a-tribits-subpackage-different-from-a-tribits-package" id="id23">How is a TriBITS Subpackage different from a TriBITS Package?</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#tribits-external-package-tpl" id="id24">TriBITS External Package/TPL</a></p>
<ul>
<li><p><a class="reference internal" href="#tribits-external-package-tpl-core-files" id="id25">TriBITS External Package/TPL Core Files</a></p></li>
<li><p><a class="reference internal" href="#tribits-external-package-tpl-core-variables" id="id26">TriBITS External Package/TPL Core Variables</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#processing-of-tribits-files-ordering-and-details" id="id27"><span class="sectnum">3.2</span> Processing of TriBITS Files: Ordering and Details</a></p>
<ul>
<li><p><a class="reference internal" href="#full-tribits-project-configuration" id="id28">Full TriBITS Project Configuration</a></p></li>
<li><p><a class="reference internal" href="#reduced-package-dependency-processing" id="id29">Reduced Package Dependency Processing</a></p></li>
<li><p><a class="reference internal" href="#file-processing-tracing" id="id30">File Processing Tracing</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#coexisting-projects-repositories-and-packages" id="id31"><span class="sectnum">3.3</span> Coexisting Projects, Repositories, and Packages</a></p></li>
<li><p><a class="reference internal" href="#standard-and-common-tpls" id="id32"><span class="sectnum">3.4</span> Standard and Common TPLs</a></p>
<ul>
<li><p><a class="reference internal" href="#standard-tribits-tpls" id="id33">Standard TriBITS TPLs</a></p></li>
<li><p><a class="reference internal" href="#common-tribits-tpls" id="id34">Common TriBITS TPLs</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#example-tribits-projects" id="id35"><span class="sectnum">4</span> Example TriBITS Projects</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#tribitshelloworld" id="id36"><span class="sectnum">4.1</span> TribitsHelloWorld</a></p></li>
<li><p><a class="reference internal" href="#tribitsexampleproject" id="id37"><span class="sectnum">4.2</span> TribitsExampleProject</a></p></li>
<li><p><a class="reference internal" href="#mocktrilinos" id="id38"><span class="sectnum">4.3</span> MockTrilinos</a></p></li>
<li><p><a class="reference internal" href="#reducedmocktrilinos" id="id39"><span class="sectnum">4.4</span> ReducedMockTrilinos</a></p></li>
<li><p><a class="reference internal" href="#trilinos" id="id40"><span class="sectnum">4.5</span> Trilinos</a></p></li>
<li><p><a class="reference internal" href="#the-tribits-test-package" id="id41"><span class="sectnum">4.6</span> The TriBITS Test Package</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#package-dependencies-and-enable-disable-logic" id="id42"><span class="sectnum">5</span> Package Dependencies and Enable/Disable Logic</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#example-reducedmocktrilinos-project-dependency-structure" id="id43"><span class="sectnum">5.1</span> Example ReducedMockTrilinos Project Dependency Structure</a></p></li>
<li><p><a class="reference internal" href="#tribits-dependency-handling-behaviors" id="id44"><span class="sectnum">5.2</span> TriBITS Dependency Handling Behaviors</a></p></li>
<li><p><a class="reference internal" href="#example-enable-disable-use-cases" id="id45"><span class="sectnum">5.3</span> Example Enable/Disable Use Cases</a></p></li>
<li><p><a class="reference internal" href="#tribits-project-dependencies-xml-file-and-tools" id="id46"><span class="sectnum">5.4</span> TriBITS Project Dependencies XML file and tools</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#tribits-automated-testing" id="id47"><span class="sectnum">6</span> TriBITS Automated Testing</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#test-classifications-for-repositories-packages-and-tests" id="id48"><span class="sectnum">6.1</span> Test Classifications for Repositories, Packages, and Tests</a></p></li>
<li><p><a class="reference internal" href="#nested-layers-of-tribits-project-testing" id="id49"><span class="sectnum">6.2</span> Nested Layers of TriBITS Project Testing</a></p></li>
<li><p><a class="reference internal" href="#pre-push-testing-using-checkin-test-py" id="id50"><span class="sectnum">6.3</span> Pre-push Testing using checkin-test.py</a></p></li>
<li><p><a class="reference internal" href="#tribits-ctest-cdash-driver" id="id51"><span class="sectnum">6.4</span> TriBITS CTest/CDash Driver</a></p>
<ul>
<li><p><a class="reference internal" href="#ctest-cdash-nightly-testing" id="id52">CTest/CDash Nightly Testing</a></p></li>
<li><p><a class="reference internal" href="#ctest-cdash-ci-server" id="id53">CTest/CDash CI Server</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#tribits-cdash-customizations" id="id54"><span class="sectnum">6.5</span> TriBITS CDash Customizations</a></p>
<ul>
<li><p><a class="reference internal" href="#cdash-regression-email-addresses" id="id55">CDash regression email addresses</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#multi-repository-support" id="id56"><span class="sectnum">7</span> Multi-Repository Support</a></p></li>
<li><p><a class="reference internal" href="#development-workflows" id="id57"><span class="sectnum">8</span> Development Workflows</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#basic-development-workflow" id="id58"><span class="sectnum">8.1</span> Basic Development Workflow</a></p></li>
<li><p><a class="reference internal" href="#multi-repository-development-workflow" id="id59"><span class="sectnum">8.2</span> Multi-Repository Development Workflow</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#howtos" id="id60"><span class="sectnum">9</span> Howtos</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#how-to-add-a-new-tribits-package" id="id61"><span class="sectnum">9.1</span> How to add a new TriBITS Package</a></p></li>
<li><p><a class="reference internal" href="#how-to-add-a-new-tribits-package-with-subpackages" id="id62"><span class="sectnum">9.2</span> How to add a new TriBITS Package with Subpackages</a></p></li>
<li><p><a class="reference internal" href="#how-to-add-a-new-tribits-subpackage" id="id63"><span class="sectnum">9.3</span> How to add a new TriBITS Subpackage</a></p></li>
<li><p><a class="reference internal" href="#how-to-add-a-new-tribits-external-package-tpl" id="id64"><span class="sectnum">9.4</span> How to add a new TriBITS external package/TPL</a></p>
<ul>
<li><p><a class="reference internal" href="#creating-findtpl-tplname-cmake-using-find-package" id="id65">Creating FindTPL&lt;tplName&gt;.cmake using find_package()</a></p>
<ul>
<li><p><a class="reference internal" href="#creating-findtpl-tplname-cmake-using-find-package-with-imported-targets" id="id66">Creating FindTPL&lt;tplName&gt;.cmake using find_package() with IMPORTED targets</a></p></li>
<li><p><a class="reference internal" href="#creating-findtpl-tplname-cmake-using-find-package-without-imported-targets" id="id67">Creating FindTPL&lt;tplName&gt;.cmake using find_package() without IMPORTED targets</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#creating-a-findtpl-tplname-cmake-module-without-find-package" id="id68">Creating a FindTPL&lt;tplName&gt;.cmake module without find_package()</a></p></li>
<li><p><a class="reference internal" href="#requirements-for-findtpl-tplname-cmake-modules" id="id69">Requirements for FindTPL&lt;tplName&gt;.cmake modules</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#how-to-add-a-new-tribits-repository" id="id70"><span class="sectnum">9.5</span> How to add a new TriBITS Repository</a></p></li>
<li><p><a class="reference internal" href="#how-to-add-a-new-tribits-se-package-dependency" id="id71"><span class="sectnum">9.6</span> How to add a new TriBITS SE Package dependency</a></p></li>
<li><p><a class="reference internal" href="#how-to-add-a-new-tribits-tpl-dependency" id="id72"><span class="sectnum">9.7</span> How to add a new TriBITS TPL dependency</a></p></li>
<li><p><a class="reference internal" href="#how-to-tentatively-enable-a-tpl" id="id73"><span class="sectnum">9.8</span> How to tentatively enable a TPL</a></p></li>
<li><p><a class="reference internal" href="#how-to-insert-a-package-into-an-upstream-repo" id="id74"><span class="sectnum">9.9</span> How to insert a package into an upstream repo</a></p></li>
<li><p><a class="reference internal" href="#how-to-put-a-tribits-and-raw-cmake-build-system-side-by-side" id="id75"><span class="sectnum">9.10</span> How to put a TriBITS and raw CMake build system side-by-side</a></p></li>
<li><p><a class="reference internal" href="#how-to-check-for-and-tweak-tribits-enable-cache-variables" id="id76"><span class="sectnum">9.11</span> How to check for and tweak TriBITS “ENABLE” cache variables</a></p></li>
<li><p><a class="reference internal" href="#how-to-tweak-downstream-tribits-enable-variables-during-package-configuration" id="id77"><span class="sectnum">9.12</span> How to tweak downstream TriBITS “ENABLE” variables during package configuration</a></p></li>
<li><p><a class="reference internal" href="#how-to-set-up-multi-repository-support" id="id78"><span class="sectnum">9.13</span> How to set up multi-repository support</a></p></li>
<li><p><a class="reference internal" href="#how-to-submit-testing-results-to-a-cdash-site" id="id79"><span class="sectnum">9.14</span> How to submit testing results to a CDash site</a></p></li>
<li><p><a class="reference internal" href="#how-to-submit-testing-results-to-a-custom-cdash-group" id="id80"><span class="sectnum">9.15</span> How to submit testing results to a custom CDash Group</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#miscellaneous-topics" id="id81"><span class="sectnum">10</span> Miscellaneous Topics</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#tribits-repository-contents" id="id82"><span class="sectnum">10.1</span> TriBITS Repository Contents</a></p>
<ul>
<li><p><a class="reference internal" href="#tribits-directory-contents" id="id83">TriBITS/ Directory Contents</a></p></li>
<li><p><a class="reference internal" href="#tribits-tribits-directory-contents" id="id84">TriBITS/tribits/ Directory Contents</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#tribits-system-project-dependencies" id="id85"><span class="sectnum">10.2</span> TriBITS System Project Dependencies</a></p></li>
<li><p><a class="reference internal" href="#python-support" id="id86"><span class="sectnum">10.3</span> Python Support</a></p></li>
<li><p><a class="reference internal" href="#project-specific-build-reference" id="id87"><span class="sectnum">10.4</span> Project-Specific Build Reference</a></p></li>
<li><p><a class="reference internal" href="#project-and-repository-versioning-and-release-mode" id="id88"><span class="sectnum">10.5</span> Project and Repository Versioning and Release Mode</a></p></li>
<li><p><a class="reference internal" href="#tribits-environment-probing-and-setup" id="id89"><span class="sectnum">10.6</span> TriBITS Environment Probing and Setup</a></p></li>
<li><p><a class="reference internal" href="#tricky-considerations-for-tribits-generated-tplname-config-cmake-files" id="id90"><span class="sectnum">10.7</span> Tricky considerations for TriBITS-generated &lt;tplName&gt;Config.cmake files</a></p></li>
<li><p><a class="reference internal" href="#installation-considerations" id="id91"><span class="sectnum">10.8</span> Installation considerations</a></p></li>
<li><p><a class="reference internal" href="#rpath-handling" id="id92"><span class="sectnum">10.9</span> RPATH Handling</a></p></li>
<li><p><a class="reference internal" href="#configure-time-system-tests" id="id93"><span class="sectnum">10.10</span> Configure-time System Tests</a></p></li>
<li><p><a class="reference internal" href="#creating-source-distributions" id="id94"><span class="sectnum">10.11</span> Creating Source Distributions</a></p></li>
<li><p><a class="reference internal" href="#using-git-bisect-with-checkin-test-py-workflows" id="id95"><span class="sectnum">10.12</span> Using Git Bisect with checkin-test.py workflows</a></p></li>
<li><p><a class="reference internal" href="#multi-repository-almost-continuous-integration" id="id96"><span class="sectnum">10.13</span> Multi-Repository Almost Continuous Integration</a></p>
<ul>
<li><p><a class="reference internal" href="#aci-introduction" id="id97">ACI Introduction</a></p></li>
<li><p><a class="reference internal" href="#aci-multi-git-tribits-repo-integration-example" id="id98">ACI Multi-Git/TriBITS Repo Integration Example</a></p></li>
<li><p><a class="reference internal" href="#aci-local-sync-git-repo-setup" id="id99">ACI Local Sync Git Repo Setup</a></p></li>
<li><p><a class="reference internal" href="#aci-integration-build-directory-setup" id="id100">ACI Integration Build Directory Setup</a></p></li>
<li><p><a class="reference internal" href="#aci-sync-driver-script" id="id101">ACI Sync Driver Script</a></p></li>
<li><p><a class="reference internal" href="#aci-cron-job-setup" id="id102">ACI Cron Job Setup</a></p></li>
<li><p><a class="reference internal" href="#addressing-aci-failures-and-summary" id="id103">Addressing ACI Failures and Summary</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#post-push-ci-and-nightly-testing-using-checkin-test-py" id="id104"><span class="sectnum">10.14</span> Post-Push CI and Nightly Testing using checkin-test.py</a></p></li>
<li><p><a class="reference internal" href="#tribits-dashboard-driver" id="id105"><span class="sectnum">10.15</span> TriBITS Dashboard Driver</a></p></li>
<li><p><a class="reference internal" href="#regulated-backward-compatibility-and-deprecated-code" id="id106"><span class="sectnum">10.16</span> Regulated Backward Compatibility and Deprecated Code</a></p>
<ul>
<li><p><a class="reference internal" href="#setting-up-support-for-deprecated-code-handling" id="id107">Setting up support for deprecated code handling</a></p></li>
<li><p><a class="reference internal" href="#deprecating-code-but-maintaining-backward-compatibility" id="id108">Deprecating code but maintaining backward compatibility</a></p>
<ul>
<li><p><a class="reference internal" href="#deprecating-c-c-classes-structs-functions-typdefs-etc" id="id109">Deprecating C/C++ classes, structs, functions, typdefs, etc.</a></p></li>
<li><p><a class="reference internal" href="#deprecating-preprocessor-macros" id="id110">Deprecating preprocessor macros</a></p></li>
<li><p><a class="reference internal" href="#deprecating-an-entire-header-and-or-source-file" id="id111">Deprecating an entire header and/or source file</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#hiding-deprecated-code-to-certify-and-facilitate-later-removal" id="id112">Hiding deprecated code to certify and facilitate later removal</a></p>
<ul>
<li><p><a class="reference internal" href="#hiding-c-c-entities" id="id113">Hiding C/C++ entities</a></p></li>
<li><p><a class="reference internal" href="#hiding-entire-deprecated-header-and-source-files" id="id114">Hiding entire deprecated header and source files</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#physically-removing-deprecated-code" id="id115">Physically removing deprecated code</a></p>
<ul>
<li><p><a class="reference internal" href="#removing-entire-deprecated-header-and-source-files" id="id116">Removing entire deprecated header and source files</a></p></li>
<li><p><a class="reference internal" href="#removing-deprecated-code-from-remaining-files" id="id117">Removing deprecated code from remaining files</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#installation-and-backward-compatibility-testing" id="id118"><span class="sectnum">10.17</span> Installation and Backward Compatibility Testing</a></p></li>
<li><p><a class="reference internal" href="#wrapping-externally-configured-built-software" id="id119"><span class="sectnum">10.18</span> Wrapping Externally Configured/Built Software</a></p></li>
<li><p><a class="reference internal" href="#tribits-directory-snapshotting" id="id120"><span class="sectnum">10.19</span> TriBITS directory snapshotting</a></p></li>
<li><p><a class="reference internal" href="#tribits-development-toolset" id="id121"><span class="sectnum">10.20</span> TriBITS Development Toolset</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#tribits-detailed-reference-documentation" id="id122"><span class="sectnum">11</span> TriBITS Detailed Reference Documentation</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#tribits-global-project-settings" id="id123"><span class="sectnum">11.1</span> TriBITS Global Project Settings</a></p></li>
<li><p><a class="reference internal" href="#tribits-macros-and-functions" id="id124"><span class="sectnum">11.2</span> TriBITS Macros and Functions</a></p>
<ul>
<li><p><a class="reference internal" href="#tribits-add-advanced-test" id="id125">tribits_add_advanced_test()</a></p></li>
<li><p><a class="reference internal" href="#tribits-add-debug-option" id="id126">tribits_add_debug_option()</a></p></li>
<li><p><a class="reference internal" href="#tribits-add-example-directories" id="id127">tribits_add_example_directories()</a></p></li>
<li><p><a class="reference internal" href="#tribits-add-executable" id="id128">tribits_add_executable()</a></p></li>
<li><p><a class="reference internal" href="#tribits-add-executable-and-test" id="id129">tribits_add_executable_and_test()</a></p></li>
<li><p><a class="reference internal" href="#tribits-add-library" id="id130">tribits_add_library()</a></p></li>
<li><p><a class="reference internal" href="#tribits-add-option-and-define" id="id131">tribits_add_option_and_define()</a></p></li>
<li><p><a class="reference internal" href="#tribits-add-show-deprecated-warnings-option" id="id132">tribits_add_show_deprecated_warnings_option()</a></p></li>
<li><p><a class="reference internal" href="#tribits-add-test" id="id133">tribits_add_test()</a></p></li>
<li><p><a class="reference internal" href="#tribits-add-test-directories" id="id134">tribits_add_test_directories()</a></p></li>
<li><p><a class="reference internal" href="#tribits-allow-missing-external-packages" id="id135">tribits_allow_missing_external_packages()</a></p></li>
<li><p><a class="reference internal" href="#tribits-configure-file" id="id136">tribits_configure_file()</a></p></li>
<li><p><a class="reference internal" href="#tribits-copy-files-to-binary-dir" id="id137">tribits_copy_files_to_binary_dir()</a></p></li>
<li><p><a class="reference internal" href="#tribits-ctest-driver" id="id138">tribits_ctest_driver()</a></p></li>
<li><p><a class="reference internal" href="#tribits-determine-if-current-package-needs-rebuilt" id="id139">tribits_determine_if_current_package_needs_rebuilt()</a></p></li>
<li><p><a class="reference internal" href="#tribits-disable-package-on-platforms" id="id140">tribits_disable_package_on_platforms()</a></p></li>
<li><p><a class="reference internal" href="#tribits-exclude-files" id="id141">tribits_exclude_files()</a></p></li>
<li><p><a class="reference internal" href="#tribits-extpkg-define-dependencies" id="id142">tribits_extpkg_define_dependencies()</a></p></li>
<li><p><a class="reference internal" href="#tribits-extpkg-get-dep-name-and-vis" id="id143">tribits_extpkg_get_dep_name_and_vis()</a></p></li>
<li><p><a class="reference internal" href="#tribits-extpkg-create-imported-all-libs-target-and-config-file" id="id144">tribits_extpkg_create_imported_all_libs_target_and_config_file()</a></p></li>
<li><p><a class="reference internal" href="#tribits-extpkg-write-config-file" id="id145">tribits_extpkg_write_config_file()</a></p></li>
<li><p><a class="reference internal" href="#tribits-extpkg-write-config-file-str" id="id146">tribits_extpkg_write_config_file_str()</a></p></li>
<li><p><a class="reference internal" href="#tribits-find-most-recent-binary-file-timestamp" id="id147">tribits_find_most_recent_binary_file_timestamp()</a></p></li>
<li><p><a class="reference internal" href="#tribits-find-most-recent-file-timestamp" id="id148">tribits_find_most_recent_file_timestamp()</a></p></li>
<li><p><a class="reference internal" href="#tribits-find-most-recent-source-file-timestamp" id="id149">tribits_find_most_recent_source_file_timestamp()</a></p></li>
<li><p><a class="reference internal" href="#tribits-install-headers" id="id150">tribits_install_headers()</a></p></li>
<li><p><a class="reference internal" href="#tribits-include-directories" id="id151">tribits_include_directories()</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id152">tribits_package()</a></p></li>
<li><p><a class="reference internal" href="#tribits-package-decl" id="id153">tribits_package_decl()</a></p></li>
<li><p><a class="reference internal" href="#tribits-package-def" id="id154">tribits_package_def()</a></p></li>
<li><p><a class="reference internal" href="#tribits-package-define-dependencies" id="id155">tribits_package_define_dependencies()</a></p></li>
<li><p><a class="reference internal" href="#tribits-package-postprocess" id="id156">tribits_package_postprocess()</a></p></li>
<li><p><a class="reference internal" href="#tribits-process-subpackages" id="id157">tribits_process_subpackages()</a></p></li>
<li><p><a class="reference internal" href="#tribits-process-enabled-tpl" id="id158">tribits_process_enabled_tpl()</a></p></li>
<li><p><a class="reference internal" href="#id2" id="id159">tribits_project()</a></p></li>
<li><p><a class="reference internal" href="#tribits-project-define-extra-repositories" id="id160">tribits_project_define_extra_repositories()</a></p></li>
<li><p><a class="reference internal" href="#tribits-project-enable-all" id="id161">tribits_project_enable_all()</a></p></li>
<li><p><a class="reference internal" href="#tribits-repository-define-packages" id="id162">tribits_repository_define_packages()</a></p></li>
<li><p><a class="reference internal" href="#tribits-repository-define-tpls" id="id163">tribits_repository_define_tpls()</a></p></li>
<li><p><a class="reference internal" href="#tribits-set-st-for-dev-mode" id="id164">tribits_set_st_for_dev_mode()</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id165">tribits_subpackage()</a></p></li>
<li><p><a class="reference internal" href="#tribits-subpackage-postprocess" id="id166">tribits_subpackage_postprocess()</a></p></li>
<li><p><a class="reference internal" href="#tribits-tpl-allow-pre-find-package" id="id167">tribits_tpl_allow_pre_find_package()</a></p></li>
<li><p><a class="reference internal" href="#tribits-tpl-find-include-dirs-and-libraries" id="id168">tribits_tpl_find_include_dirs_and_libraries()</a></p></li>
<li><p><a class="reference internal" href="#tribits-tpl-libraries-entry-type" id="id169">tribits_tpl_libraries_entry_type()</a></p></li>
<li><p><a class="reference internal" href="#tribits-tpl-tentatively-enable" id="id170">tribits_tpl_tentatively_enable()</a></p></li>
<li><p><a class="reference internal" href="#tribits-write-flexible-package-client-export-files" id="id171">tribits_write_flexible_package_client_export_files()</a></p></li>
<li><p><a class="reference internal" href="#tribits-verbose-print-var" id="id172">tribits_verbose_print_var()</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#general-utility-macros-and-functions" id="id173"><span class="sectnum">11.3</span> General Utility Macros and Functions</a></p>
<ul>
<li><p><a class="reference internal" href="#add-subdirectories" id="id174">add_subdirectories()</a></p></li>
<li><p><a class="reference internal" href="#advanced-option" id="id175">advanced_option()</a></p></li>
<li><p><a class="reference internal" href="#advanced-set" id="id176">advanced_set()</a></p></li>
<li><p><a class="reference internal" href="#append-cmndline-args" id="id177">append_cmndline_args()</a></p></li>
<li><p><a class="reference internal" href="#append-glob" id="id178">append_glob()</a></p></li>
<li><p><a class="reference internal" href="#append-global-set" id="id179">append_global_set()</a></p></li>
<li><p><a class="reference internal" href="#append-set" id="id180">append_set()</a></p></li>
<li><p><a class="reference internal" href="#append-string-var" id="id181">append_string_var()</a></p></li>
<li><p><a class="reference internal" href="#append-string-var-ext" id="id182">append_string_var_ext()</a></p></li>
<li><p><a class="reference internal" href="#append-string-var-with-sep" id="id183">append_string_var_with_sep()</a></p></li>
<li><p><a class="reference internal" href="#assert-defined" id="id184">assert_defined()</a></p></li>
<li><p><a class="reference internal" href="#combined-option" id="id185">combined_option()</a></p></li>
<li><p><a class="reference internal" href="#concat-strings" id="id186">concat_strings()</a></p></li>
<li><p><a class="reference internal" href="#dual-scope-append-cmndline-args" id="id187">dual_scope_append_cmndline_args()</a></p></li>
<li><p><a class="reference internal" href="#dual-scope-prepend-cmndline-args" id="id188">dual_scope_prepend_cmndline_args()</a></p></li>
<li><p><a class="reference internal" href="#dual-scope-set" id="id189">dual_scope_set()</a></p></li>
<li><p><a class="reference internal" href="#global-null-set" id="id190">global_null_set()</a></p></li>
<li><p><a class="reference internal" href="#global-set" id="id191">global_set()</a></p></li>
<li><p><a class="reference internal" href="#join" id="id192">join()</a></p></li>
<li><p><a class="reference internal" href="#message-wrapper" id="id193">message_wrapper()</a></p></li>
<li><p><a class="reference internal" href="#multiline-set" id="id194">multiline_set()</a></p></li>
<li><p><a class="reference internal" href="#prepend-cmndline-args" id="id195">prepend_cmndline_args()</a></p></li>
<li><p><a class="reference internal" href="#prepend-global-set" id="id196">prepend_global_set()</a></p></li>
<li><p><a class="reference internal" href="#print-nonempty-var" id="id197">print_nonempty_var()</a></p></li>
<li><p><a class="reference internal" href="#print-nonempty-var-with-spaces" id="id198">print_nonempty_var_with_spaces()</a></p></li>
<li><p><a class="reference internal" href="#print-var" id="id199">print_var()</a></p></li>
<li><p><a class="reference internal" href="#print-var-with-spaces" id="id200">print_var_with_spaces()</a></p></li>
<li><p><a class="reference internal" href="#remove-global-duplicates" id="id201">remove_global_duplicates()</a></p></li>
<li><p><a class="reference internal" href="#set-and-inc-dirs" id="id202">set_and_inc_dirs()</a></p></li>
<li><p><a class="reference internal" href="#set-cache-on-off-empty" id="id203">set_cache_on_off_empty()</a></p></li>
<li><p><a class="reference internal" href="#set-default" id="id204">set_default()</a></p></li>
<li><p><a class="reference internal" href="#set-default-and-from-env" id="id205">set_default_and_from_env()</a></p></li>
<li><p><a class="reference internal" href="#split" id="id206">split()</a></p></li>
<li><p><a class="reference internal" href="#timer-get-raw-seconds" id="id207">timer_get_raw_seconds()</a></p></li>
<li><p><a class="reference internal" href="#timer-get-rel-seconds" id="id208">timer_get_rel_seconds()</a></p></li>
<li><p><a class="reference internal" href="#timer-print-rel-time" id="id209">timer_print_rel_time()</a></p></li>
<li><p><a class="reference internal" href="#tribits-strip-quotes-from-str" id="id210">tribits_strip_quotes_from_str()</a></p></li>
<li><p><a class="reference internal" href="#unittest-compare-const" id="id211">unittest_compare_const()</a></p></li>
<li><p><a class="reference internal" href="#unittest-has-substr-const" id="id212">unittest_has_substr_const()</a></p></li>
<li><p><a class="reference internal" href="#unittest-not-has-substr-const" id="id213">unittest_not_has_substr_const()</a></p></li>
<li><p><a class="reference internal" href="#unittest-string-regex" id="id214">unittest_string_regex()</a></p></li>
<li><p><a class="reference internal" href="#unittest-string-var-regex" id="id215">unittest_string_var_regex()</a></p></li>
<li><p><a class="reference internal" href="#unittest-file-regex" id="id216">unittest_file_regex()</a></p></li>
<li><p><a class="reference internal" href="#unittest-final-result" id="id217">unittest_final_result()</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#tribits-system-maintainers-documentation" id="id218"><span class="sectnum">12</span> TriBITS System Maintainers Documentation</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#tribits-system-data-structures" id="id219"><span class="sectnum">12.1</span> TriBITS System Data Structures</a></p>
<ul>
<li><p><a class="reference internal" href="#basic-tribits-project-repository-package-and-subpackage-core-variables" id="id220">Basic TriBITS Project, Repository, Package, and Subpackage Core Variables</a></p></li>
<li><p><a class="reference internal" href="#lists-of-external-and-internal-packages" id="id221">Lists of external and internal packages</a></p></li>
<li><p><a class="reference internal" href="#list-variables-defining-the-package-dependencies-graph" id="id222">List variables defining the package dependencies graph</a></p></li>
<li><p><a class="reference internal" href="#determining-if-a-package-is-internal-or-external" id="id223">Determining if a package is internal or external</a></p></li>
<li><p><a class="reference internal" href="#external-package-dependencies" id="id224">External package dependencies</a></p></li>
<li><p><a class="reference internal" href="#flat-lists-of-direct-package-dependencies" id="id225">Flat lists of direct package dependencies</a></p></li>
<li><p><a class="reference internal" href="#list-variables-defining-include-directories-and-libraries" id="id226">List variables defining include directories and libraries</a></p></li>
<li><p><a class="reference internal" href="#user-enable-disable-cache-variables" id="id227">User enable/disable cache variables</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph" id="id228"><span class="sectnum">12.2</span> Function call tree for constructing package dependency graph</a></p></li>
<li><p><a class="reference internal" href="#notes-on-dependency-logic" id="id229"><span class="sectnum">12.3</span> Notes on dependency logic</a></p></li>
<li><p><a class="reference internal" href="#tribits-system-macros-and-functions" id="id230"><span class="sectnum">12.4</span> TriBITS System Macros and Functions</a></p>
<ul>
<li><p><a class="reference internal" href="#tribits-abort-on-missing-package" id="id231">tribits_abort_on_missing_package()</a></p></li>
<li><p><a class="reference internal" href="#tribits-abort-on-self-dep" id="id232">tribits_abort_on_self_dep()</a></p></li>
<li><p><a class="reference internal" href="#tribits-adjust-package-enables" id="id233">tribits_adjust_package_enables()</a></p></li>
<li><p><a class="reference internal" href="#tribits-append-forward-dep-packages" id="id234">tribits_append_forward_dep_packages()</a></p></li>
<li><p><a class="reference internal" href="#tribits-assert-read-dependency-vars" id="id235">tribits_assert_read_dependency_vars()</a></p></li>
<li><p><a class="reference internal" href="#tribits-extpkg-add-find-upstream-dependencies-str" id="id236">tribits_extpkg_add_find_upstream_dependencies_str()</a></p></li>
<li><p><a class="reference internal" href="#tribits-extpkg-create-all-libs-target" id="id237">tribits_extpkg_create_all_libs_target()</a></p></li>
<li><p><a class="reference internal" href="#tribits-extpkg-install-config-file" id="id238">tribits_extpkg_install_config_file()</a></p></li>
<li><p><a class="reference internal" href="#tribits-extpkg-install-config-version-file" id="id239">tribits_extpkg_install_config_version_file()</a></p></li>
<li><p><a class="reference internal" href="#tribits-extpkg-process-libraries-list" id="id240">tribits_extpkg_process_libraries_list()</a></p></li>
<li><p><a class="reference internal" href="#tribits-extpkg-setup-enabled-dependencies" id="id241">tribits_extpkg_setup_enabled_dependencies()</a></p></li>
<li><p><a class="reference internal" href="#tribits-extpkg-write-config-version-file" id="id242">tribits_extpkg_write_config_version_file()</a></p></li>
<li><p><a class="reference internal" href="#tribits-dump-package-dependencies-info" id="id243">tribits_dump_package_dependencies_info()</a></p></li>
<li><p><a class="reference internal" href="#tribits-print-initial-dependency-info" id="id244">tribits_print_initial_dependency_info()</a></p></li>
<li><p><a class="reference internal" href="#tribits-print-tentatively-enabled-tpls" id="id245">tribits_print_tentatively_enabled_tpls()</a></p></li>
<li><p><a class="reference internal" href="#tribits-parse-subpackages-append-se-packages-add-options" id="id246">tribits_parse_subpackages_append_se_packages_add_options()</a></p></li>
<li><p><a class="reference internal" href="#tribits-prep-to-read-dependencies" id="id247">tribits_prep_to_read_dependencies()</a></p></li>
<li><p><a class="reference internal" href="#tribits-process-all-repository-deps-setup-files" id="id248">tribits_process_all_repository_deps_setup_files()</a></p></li>
<li><p><a class="reference internal" href="#tribits-process-package-dependencies-lists" id="id249">tribits_process_package_dependencies_lists()</a></p></li>
<li><p><a class="reference internal" href="#tribits-process-packages-and-dirs-lists" id="id250">tribits_process_packages_and_dirs_lists()</a></p></li>
<li><p><a class="reference internal" href="#tribits-process-project-dependency-setup-file" id="id251">tribits_process_project_dependency_setup_file()</a></p></li>
<li><p><a class="reference internal" href="#tribits-process-tpls-lists" id="id252">tribits_process_tpls_lists()</a></p></li>
<li><p><a class="reference internal" href="#tribits-read-all-package-deps-files-create-deps-graph" id="id253">tribits_read_all_package_deps_files_create_deps_graph()</a></p></li>
<li><p><a class="reference internal" href="#tribits-read-all-project-deps-files-create-deps-graph" id="id254">tribits_read_all_project_deps_files_create_deps_graph()</a></p></li>
<li><p><a class="reference internal" href="#tribits-read-back-dependencies-vars" id="id255">tribits_read_back_dependencies_vars()</a></p></li>
<li><p><a class="reference internal" href="#tribits-read-defined-external-and-internal-toplevel-packages-lists" id="id256">tribits_read_defined_external_and_internal_toplevel_packages_lists()</a></p></li>
<li><p><a class="reference internal" href="#tribits-read-deps-files-create-deps-graph" id="id257">tribits_read_deps_files_create_deps_graph()</a></p></li>
<li><p><a class="reference internal" href="#tribits-read-external-package-deps-files-add-to-graph" id="id258">tribits_read_external_package_deps_files_add_to_graph()</a></p></li>
<li><p><a class="reference internal" href="#tribits-read-package-subpackage-deps-files-add-to-graph" id="id259">tribits_read_package_subpackage_deps_files_add_to_graph()</a></p></li>
<li><p><a class="reference internal" href="#tribits-read-subpackage-deps-file-add-to-graph" id="id260">tribits_read_subpackage_deps_file_add_to_graph()</a></p></li>
<li><p><a class="reference internal" href="#tribits-read-toplevel-package-deps-files-add-to-graph" id="id261">tribits_read_toplevel_package_deps_files_add_to_graph()</a></p></li>
<li><p><a class="reference internal" href="#tribits-save-off-dependency-vars" id="id262">tribits_save_off_dependency_vars()</a></p></li>
<li><p><a class="reference internal" href="#tribits-set-dep-packages" id="id263">tribits_set_dep_packages()</a></p></li>
<li><p><a class="reference internal" href="#tribits-trace-file-processing" id="id264">tribits_trace_file_processing()</a></p></li>
<li><p><a class="reference internal" href="#tribits-write-package-client-export-files-install-targets" id="id265">tribits_write_package_client_export_files_install_targets()</a></p></li>
<li><p><a class="reference internal" href="#tribits-write-xml-dependency-files" id="id266">tribits_write_xml_dependency_files()</a></p></li>
<li><p><a class="reference internal" href="#tribits-write-xml-dependency-files-if-supported" id="id267">tribits_write_xml_dependency_files_if_supported()</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#references" id="id268"><span class="sectnum">13</span> References</a></p></li>
<li><p><a class="reference internal" href="#faq" id="id269"><span class="sectnum">14</span> FAQ</a></p></li>
<li><p><a class="reference internal" href="#appendix" id="id270"><span class="sectnum">15</span> Appendix</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#history-of-tribits" id="id271"><span class="sectnum">15.1</span> History of TriBITS</a></p></li>
<li><p><a class="reference internal" href="#why-a-tribits-package-is-not-a-cmake-package" id="id272"><span class="sectnum">15.2</span> Why a TriBITS Package is not a CMake Package</a></p></li>
<li><p><a class="reference internal" href="#design-considerations-for-tribits" id="id273"><span class="sectnum">15.3</span> Design Considerations for TriBITS</a></p></li>
<li><p><a class="reference internal" href="#clone-extra-repos-py-help" id="id274"><span class="sectnum">15.4</span> clone_extra_repos.py –help</a></p></li>
<li><p><a class="reference internal" href="#gitdist-documentation" id="id275"><span class="sectnum">15.5</span> gitdist documentation</a></p>
<ul>
<li><p><a class="reference internal" href="#gitdist-help" id="id276">gitdist –help</a></p></li>
<li><p><a class="reference internal" href="#gitdist-dist-help-overview" id="id277">gitdist –dist-help=overview</a></p></li>
<li><p><a class="reference internal" href="#gitdist-dist-help-repo-selection-and-setup" id="id278">gitdist –dist-help=repo-selection-and-setup</a></p></li>
<li><p><a class="reference internal" href="#gitdist-dist-help-dist-repo-status" id="id279">gitdist –dist-help=dist-repo-status</a></p></li>
<li><p><a class="reference internal" href="#gitdist-dist-help-repo-versions" id="id280">gitdist –dist-help=repo-versions</a></p></li>
<li><p><a class="reference internal" href="#gitdist-dist-help-aliases" id="id281">gitdist –dist-help=aliases</a></p></li>
<li><p><a class="reference internal" href="#gitdist-dist-help-default-branch" id="id282">gitdist –dist-help=default-branch</a></p></li>
<li><p><a class="reference internal" href="#gitdist-dist-help-move-to-base-dir" id="id283">gitdist –dist-help=move-to-base-dir</a></p></li>
<li><p><a class="reference internal" href="#gitdist-dist-help-usage-tips" id="id284">gitdist –dist-help=usage-tips</a></p></li>
<li><p><a class="reference internal" href="#gitdist-dist-help-script-dependencies" id="id285">gitdist –dist-help=script-dependencies</a></p></li>
<li><p><a class="reference internal" href="#gitdist-dist-help-all" id="id286">gitdist –dist-help=all</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#snapshot-dir-py-help" id="id287"><span class="sectnum">15.6</span> snapshot-dir.py –help</a></p></li>
<li><p><a class="reference internal" href="#checkin-test-py-help" id="id288"><span class="sectnum">15.7</span> checkin-test.py –help</a></p></li>
<li><p><a class="reference internal" href="#is-checkin-tested-commit-py-help" id="id289"><span class="sectnum">15.8</span> is_checkin_tested_commit.py –help</a></p></li>
<li><p><a class="reference internal" href="#get-tribits-packages-from-files-list-py-help" id="id290"><span class="sectnum">15.9</span> get-tribits-packages-from-files-list.py –help</a></p></li>
<li><p><a class="reference internal" href="#get-tribits-packages-from-last-tests-failed-py-help" id="id291"><span class="sectnum">15.10</span> get-tribits-packages-from-last-tests-failed.py –help</a></p></li>
<li><p><a class="reference internal" href="#filter-packages-list-py-help" id="id292"><span class="sectnum">15.11</span> filter-packages-list.py –help</a></p></li>
<li><p><a class="reference internal" href="#install-devtools-py-help" id="id293"><span class="sectnum">15.12</span> install_devtools.py –help</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="introduction">
<h1><a class="toc-backref" href="#id4"><span class="sectnum">1</span> Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h1>
<p>This document describes the usage and maintenance of the TriBITS (Tribal
Build, Integration, Test System) package itself.  This document includes a
super-set the material from the <a class="reference external" href="TribitsUsersGuide.html">TriBITS Users Guide and Reference</a> document.
In addition, all of the detailed function and macro documentation blocks
include the file names and line numbers where they are implemented in the
TriBITS source repository. This makes it easier to navigate around the TriBITS
source code when developing on TriBITS itself or just trying to understand its
implementation.</p>
</section>
<section id="background">
<h1><a class="toc-backref" href="#id5"><span class="sectnum">2</span> Background</a><a class="headerlink" href="#background" title="Permalink to this heading"></a></h1>
<p>In order to easily find the most appropriate documentation, see the <a class="reference internal" href="#tribits-developer-and-user-roles">TriBITS
Developer and User Roles</a> guide.  This guide describes the different roles
that users of TriBITS may play and offers links to relevant sections of the
documentation.  Additionally, the reader may wish to review the <a class="reference internal" href="#cmake-language-overview-and-gotchas">CMake Language
Overview and Gotchas</a> section which is meant for users that are new to both
CMake and TriBITS. This section gives a brief overview of getting started with
CMake and provides some warnings about non-obvious CMake behavior that often
trips up new users of TriBITS.</p>
<section id="tribits-developer-and-user-roles">
<h2><a class="toc-backref" href="#id6"><span class="sectnum">2.1</span> TriBITS Developer and User Roles</a><a class="headerlink" href="#tribits-developer-and-user-roles" title="Permalink to this heading"></a></h2>
<p>There are approximately five different types roles related to TriBITS.  These
different roles require different levels of expertise and knowledge of CMake
and knowledge of the TriBITS system.  The primary roles are 1) <a class="reference internal" href="#tribits-project-user">TriBITS
Project User</a>, 2) <a class="reference internal" href="#tribits-project-developer">TriBITS Project Developer</a>, 3) <a class="reference internal" href="#tribits-project-architect">TriBITS Project
Architect</a>, 4) <a class="reference internal" href="#tribits-system-developer">TriBITS System Developer</a>, and 5) <a class="reference internal" href="#tribits-system-architect">TriBITS System
Architect</a>.  Each of these roles builds on the necessary knowledge of the
lower-level roles.</p>
<p id="tribits-project-users"><span id="tribits-project-user"></span>The first role is that of a <strong>TriBITS Project User</strong> who only needs to be able
to configure, build, and test a project that uses TriBITS as its build system.
A person acting in this role needs to know little about CMake other than
basics about how to run the <code class="docutils literal notranslate"><span class="pre">cmake</span></code> and <code class="docutils literal notranslate"><span class="pre">ctest</span></code> executables, how to set
CMake cache variables, and the basics of building software by typing <code class="docutils literal notranslate"><span class="pre">make</span></code>
and running tests with <code class="docutils literal notranslate"><span class="pre">ctest</span></code>.  The proper reference for a TriBITS Project
User is the <a class="reference internal" href="#project-specific-build-reference">Project-Specific Build Reference</a>.  The <a class="reference external" href="../overview/TribitsOverview.pdf">TriBITS
Overview</a> document may also be of some help.  A TriBITS project user may also
need to consult <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package Dependencies and Enable/Disable Logic</a>.</p>
<p id="tribits-project-developers"><span id="tribits-project-developer"></span>A <strong>TriBITS Project Developer</strong> is someone who contributes to a software
project that uses TriBITS.  They will add source files, libraries and
executables , test executables and define tests run with <code class="docutils literal notranslate"><span class="pre">ctest</span></code>.  They have
to configure and build the project code in order to be able to develop and run
tests and therefore this role includes all of the necessary knowledge and
functions of a TriBITS Project User.  A casual TriBITS Project Developer
typically does not need to know a lot about CMake and really only needs to
know a subset of the <a class="reference internal" href="#tribits-macros-and-functions">TriBITS Macros and Functions</a> defined in the document
<a class="reference external" href="TribitsUsersGuide.html">TriBITS Users Guide and Reference</a> in addition to the genetic <a class="reference external" href="TribitsBuildReference.html">TriBITS Build
Reference</a> document.  A slightly more
sophisticated TriBITS Project Developer will also add new packages, add new
package dependencies, and define new TPLs.  The <a class="reference external" href="TribitsUsersGuide.html">TriBITS Users Guide and
Reference</a> should supply everything such a developer needs to know and more.
However, only a smaller part of that document needs to be understood and
accessed by people assuming this role.</p>
<p id="tribits-project-architects"><span id="tribits-project-architect"></span>The next level of roles is a <strong>TriBITS Project Architect</strong>.  This is someone
(perhaps only one person on a project development team) that knows the usage
and functioning of TriBITS in great detail.  They understand how to set up a
TriBITS project from scratch, how to set up automated testing using the
TriBITS system, and know how to use TriBITS to implement the overall software
development process.  A person in this role is also likely to be the one who
makes the initial technical decision for their project to adopt TriBITS for
its native build and test system.  The document <a class="reference external" href="TribitsUsersGuide.html">TriBITS Users Guide and
Reference</a>, detailed CMake/CTest/CDash documentation provided by Kitware, and
great books like <a class="reference internal" href="#professional-cmake">Professional CMake</a> should provide most of what a person in
this role needs to know.  A person assuming this role is the primary audience
for a lot of the more advanced material in that document.</p>
<p id="tribits-system-architects"><span id="tribits-system-architect"></span><span id="tribits-system-developers"></span><span id="tribits-system-developer"></span>The last two roles <strong>TriBITS System Developer</strong> and <strong>TriBITS System
Architect</strong> are for those individuals that actually extend and modify the
TriBITS system itself.  A TriBITS System Developer needs to know how to add
new TriBITS functionality while maintaining backward compatibility, know how
to add new unit tests for the TriBITS system (see <a class="reference internal" href="#the-tribits-test-package">The TriBITS Test
Package</a>), and perform other related tasks.  Such a developer needs to be
very knowledgeable of the basic functioning of CMake and know how TriBITS is
implemented in the CMake language.  A TriBITS System Architect is someone who
must be consulted on almost all non-trivial changes or additions to the
TriBITS system.  A <em>TriBITS System Architect</em> in addition needs to know the
entire TriBITS system, the design philosophy that provides the foundation for
TriBITS and be an expert in CMake, CTest, and CDash.  Much of what needs to be
known by a TriBITS System Developer and a TriBITS System Architect is
contained in the document <a class="reference external" href="TribitsMaintainersGuide.html">TriBITS Maintainers Guide and Reference</a>.  The
rest of the primary documentation for these roles will be in the TriBITS
CMake source code and various unit tests itself defined in <a class="reference internal" href="#the-tribits-test-package">The TriBITS Test
Package</a>.  At the time of this writing, there is currently there is only one
TriBITS System Architect (who also happens to be the primary author of this
document).</p>
<p>An explicit goal of the document <a class="reference external" href="TribitsUsersGuide.html">TriBITS Users Guide and Reference</a> is to
foster the creation of new <a class="reference internal" href="#tribits-project-architects">TriBITS Project Architects</a> (i.e. those who would
make the decision to adopt TriBITS for their projects).  An explicit goal of
the document <a class="reference external" href="TribitsMaintainersGuide.html">TriBITS Maintainers Guide and Reference</a> is to foster the
creation of new <a class="reference internal" href="#tribits-system-developers">TriBITS System Developers</a> to help extend and maintain the
TriBITS package itself.</p>
<p>Depending on the particular role that a reader falls into, this document
may not be necessary and the <a class="reference external" href="../overview/TribitsOverview.pdf">TriBITS Overview</a> or the
<a class="reference external" href="TribitsBuildReference.html">&lt;Project&gt;BuildReference</a> documents may be more appropriate.  Hopefully the
above roles and discussion help the reader select the right document to
start with.</p>
</section>
<section id="cmake-language-overview-and-gotchas">
<h2><a class="toc-backref" href="#id7"><span class="sectnum">2.2</span> CMake Language Overview and Gotchas</a><a class="headerlink" href="#cmake-language-overview-and-gotchas" title="Permalink to this heading"></a></h2>
<p>TriBITS removes a lot of the boiler plate code needed to write a CMake
project.  As a result, many people can come into a project that uses TriBITS
and quickly start to contribute by adding new source files, adding new
libraries, adding new tests, and even adding new TriBITS packages and TPLs;
all without really having learned anything about CMake.  Often one can use existing
example CMake code as a guide and be successful using basic functionality. As long
as nothing out of the ordinary happens, many people can get along just fine in this
mode for a time.</p>
<p>However, we have observed that most mistakes and problems that people run into when
using TriBITS are due to lack of basic knowledge of the CMake language.  One can find
basic tutorials and references on the CMake language in various locations online for free.
One can also purchase the <a class="reference external" href="http://www.cmake.org/cmake/help/book.html">official CMake reference book</a>.  Also, documentation
for any built-in CMake command is available locally by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cmake --help-command &lt;CMAKE_COMMAND&gt;
</pre></div>
</div>
<p>Because tutorials and detailed documentation for the CMake language already
exists, this document does not attempt to provide a first reference to CMake
(which is a large topic in itself).  However, what we try to provide below is
a short overview of the more quirky or surprising aspects of the CMake
language that a programmer experienced in another language might get tripped
up or surprised by.  Some of the more unique features of the language are
described in order to help avoid some of these common mistakes and provide
greater understanding of how TriBITS works.</p>
<p>The CMake language is used to write CMake projects with TriBITS. In fact the
core TriBITS functionality itself is implemented in the CMake language (see
<a class="reference internal" href="#tribits-system-project-dependencies">TriBITS System Project Dependencies</a>). CMake is a fairly simple programming
language with relatively simple rules (for the most part).  However, compared
to other programming languages, there are a few peculiar aspects to the CMake
language that can make working with it difficult if you don’t understand these
rules.  For example there are unexpected variable scoping rules and how arguments
are passed to macros and functions can be tricky. Also, CMake has some interesting
gotchas.  In order to effectively use TriBITS (or just raw CMake) to construct
and maintain a project’s CMake files, one must know the basic rules of CMake
and be aware of these gotchas.</p>
<p>The first thing to understand about the CMake language is that nearly every
line of CMake code is just a command taking a string (or an array of strings)
and functions that operate on strings.  An array argument is just a single
string literal with elements separated by semi-colons <code class="docutils literal notranslate"><span class="pre">&quot;&lt;str0&gt;;&lt;str1&gt;;...&quot;</span></code>.
CMake is a bit odd in how it deals with these arrays, which are just
represented as a string with elements separated with semi-colons <code class="docutils literal notranslate"><span class="pre">';'</span></code>.  For
example, all of the following are equivalent and pass in a CMake array with 3
elements [<code class="docutils literal notranslate"><span class="pre">A</span></code>], [<code class="docutils literal notranslate"><span class="pre">B</span></code>], and [<code class="docutils literal notranslate"><span class="pre">C</span></code>]:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_func</span><span class="p">(</span><span class="n">A</span> <span class="n">B</span> <span class="n">C</span><span class="p">)</span>
<span class="n">some_func</span><span class="p">(</span><span class="s2">&quot;A&quot;</span> <span class="s2">&quot;B&quot;</span> <span class="s2">&quot;C&quot;</span><span class="p">)</span>
<span class="n">some_func</span><span class="p">(</span><span class="s2">&quot;A;B;C&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>However, the above is <em>not</em> the same as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_func</span><span class="p">(</span><span class="s2">&quot;A B C&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>which just passes in a single element with value [<code class="docutils literal notranslate"><span class="pre">A</span> <span class="pre">B</span> <span class="pre">C</span></code>].  Raw quotes in
CMake basically escape the interpretation of space characters as array element
boundaries.  Quotes around arguments with no spaces does nothing (as seen
above, except for the interpretation as variable names in an <code class="docutils literal notranslate"><span class="pre">if()</span></code>
statement).  In order to get a quote char [<code class="docutils literal notranslate"><span class="pre">&quot;</span></code>] into string, you must escape
it as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_func</span><span class="p">(</span>\<span class="s2">&quot;A</span><span class="se">\&quot;</span><span class="s2">)</span>
</pre></div>
</div>
<p>which passes an array with the single argument [<code class="docutils literal notranslate"><span class="pre">\&quot;A\&quot;</span></code>].</p>
<p>Variables are set using the built-in CMake <code class="docutils literal notranslate"><span class="pre">set()</span></code> command that just takes
string arguments like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">SOME_VARIABLE</span> <span class="s2">&quot;some_value&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In CMake, the above is identical, in every way, to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">SOME_VARIABLE</span> <span class="n">some_value</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s2">&quot;SOME_VARIABLE&quot;</span><span class="p">;</span><span class="s2">&quot;some_value&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="s2">&quot;SOME_VARIABLE;some_value&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">set()</span></code> simply interprets the first argument to as the name of
a variable to set in the local scope.  Many other built-in and user-defined
CMake functions work the same way.  That is, some of the string arguments are
interpreted as the names of variables.  There is no special language feature
that interprets them as variables (except in an <code class="docutils literal notranslate"><span class="pre">if()</span></code> statement).</p>
<p>However, CMake appears to parse arguments differently for built-in CMake
control structure functions like <code class="docutils literal notranslate"><span class="pre">foreach()</span></code> and <code class="docutils literal notranslate"><span class="pre">if()</span></code> and does not just
interpret them as a string array.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">foreach</span> <span class="p">(</span><span class="n">SOME_VAR</span> <span class="s2">&quot;a;b;c&quot;</span><span class="p">)</span>
  <span class="n">message</span><span class="p">(</span><span class="s2">&quot;SOME_VAR=&#39;$</span><span class="si">{SOME_VAR}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
<span class="n">endforeach</span><span class="p">()</span>
</pre></div>
</div>
<p>prints <code class="docutils literal notranslate"><span class="pre">`SOME_VAR='a;b;c'</span></code> instead of printing <code class="docutils literal notranslate"><span class="pre">SOME_VAR='a'</span></code> followed by
<code class="docutils literal notranslate"><span class="pre">SOME_VAR='b'</span></code>, etc., as you would otherwise expect.  Therefore, this simple
rule for the handling of function arguments as string arrays does not hold for
CMake logic control commands.  Just follow the CMake documentation for these
control structures (i.e. see <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">--help-command</span> <span class="pre">if</span></code> and <code class="docutils literal notranslate"><span class="pre">cmake</span>
<span class="pre">--help-command</span> <span class="pre">foreach</span></code>).</p>
<p>CMake offers a rich assortment of built-in commands for doing all sorts of
things.  Two of these are the built-in <code class="docutils literal notranslate"><span class="pre">macro()</span></code> and the <code class="docutils literal notranslate"><span class="pre">function()</span></code>
commands which allow you to create user-defined macros and functions. TriBITS
is actually built on CMake functions and macros.  All of the built-in and
user-defined macros, and some functions take an  array of string arguments.
Some functions take in positional arguments. In fact,  most functions take a
combination of positional and keyword arguments.</p>
<p>Variable names are translated into their stored values using
<code class="docutils literal notranslate"><span class="pre">${SOME_VARIABLE}</span></code>.  The value that is extracted depends on if the variable
is set in the local or global (cache) scope.  The local scopes for CMake start
in the base project directory in its base <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file.  Any
variables that are created by macros in that base local scope are seen across
an entire project but are <em>not</em> persistent across multiple successive
<code class="docutils literal notranslate"><span class="pre">cmake</span></code> configure invocations where the cache file <code class="docutils literal notranslate"><span class="pre">CMakeCache.txt</span></code> is not
deleted in between.</p>
<p>The handling of variables is one area where CMake is radically different from
most other languages.  First, a variable that is not defined simply returns
nothing.  What is surprising to most people about this is that it does not
even return an empty string that would register as an array element!  For
example, the following set statement:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(SOME_VAR a ${SOME_UNDEFINED_VAR} c)
</pre></div>
</div>
<p>(where <code class="docutils literal notranslate"><span class="pre">SOME_UNDEFINED_VAR</span></code> is an undefined variable) produces
<code class="docutils literal notranslate"><span class="pre">SOME_VAR='a;c'</span></code> and <em>not</em> <code class="docutils literal notranslate"><span class="pre">'a;;c'</span></code>!  The same thing occurs when an empty
variable is de-references such as with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(EMPTY_VAR &quot;&quot;)
set(SOME_VAR a ${EMPTY_VAR} c)
</pre></div>
</div>
<p>which produces <code class="docutils literal notranslate"><span class="pre">SOME_VAR='a;c'</span></code> and <em>not</em> <code class="docutils literal notranslate"><span class="pre">'a;;c'</span></code>.  In order to always
produce an element in the array even if the variable is empty, one must quote
the argument as with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">EMPTY_VAR</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="n">SOME_VAR</span> <span class="n">a</span> <span class="s2">&quot;$</span><span class="si">{EMPTY_VAR}</span><span class="s2">&quot;</span> <span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p>which produces <code class="docutils literal notranslate"><span class="pre">SOME_VAR='a;;c'</span></code>, or three elements as one might assume.</p>
<p>This is a common error that people make when they call CMake functions
(built-in or TriBITS-defined) involving variables that might be undefined or
empty.  For example, for the macro:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">macro</span><span class="p">(</span><span class="n">some_macro</span>  <span class="n">A_ARG</span>  <span class="n">B_ARG</span>  <span class="n">C_ARG</span><span class="p">)</span>
   <span class="o">...</span>
<span class="n">endmacro</span><span class="p">()</span>
</pre></div>
</div>
<p>if someone tries to call it with (misspelled variable?):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>some_macro(a ${SOME_OHTER_VAR} c)
</pre></div>
</div>
<p>and if <code class="docutils literal notranslate"><span class="pre">SOME_OHTER_VAR=&quot;&quot;</span></code> or if it is undefined, then CMake will error out
with the error message saying that the macro <code class="docutils literal notranslate"><span class="pre">some_macro()</span></code> takes 3
arguments but only 2 were provided.  If a variable might be empty but that is
still a valid argument to the command, then it must be quoted as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">some_macro</span><span class="p">(</span><span class="n">a</span> <span class="s2">&quot;$</span><span class="si">{SOME_OHTER_VAR}</span><span class="s2">&quot;</span> <span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p>Related to this problem is that if you misspell the name of a variable in a
CMake <code class="docutils literal notranslate"><span class="pre">if()</span></code> statement like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">SOME_VARBLE</span><span class="p">)</span>
  <span class="o">...</span>
<span class="n">endif</span><span class="p">()</span>
</pre></div>
</div>
<p>then it will always be false and the code inside the if statement will never
be executed!  To avoid this problem, use the utility function
<a class="reference internal" href="#assert-defined">assert_defined()</a> as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">assert_defined</span><span class="p">(</span><span class="n">SOME_VARBLE</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">SOME_VARBLE</span><span class="p">)</span>
  <span class="o">...</span>
<span class="n">endif</span><span class="p">()</span>
</pre></div>
</div>
<p>In this case, the misspelled variable would be caught.</p>
<p>While on the subject of <code class="docutils literal notranslate"><span class="pre">if()</span></code> statements, CMake has a strange convention.
When you say:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">SOME_VAR</span><span class="p">)</span>
  <span class="n">do_something</span><span class="p">()</span>
<span class="n">endif</span><span class="p">()</span>
</pre></div>
</div>
<p>then <code class="docutils literal notranslate"><span class="pre">SOME_VAR</span></code> is interpreted as a variable and will be considered true and
<code class="docutils literal notranslate"><span class="pre">do_something()</span></code> will be called if <code class="docutils literal notranslate"><span class="pre">${SOME_VAR}</span></code> does <em>not</em> evaluate to
<code class="docutils literal notranslate"><span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">OFF</span></code>, <code class="docutils literal notranslate"><span class="pre">NO</span></code>, <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>, <code class="docutils literal notranslate"><span class="pre">N</span></code>, <code class="docutils literal notranslate"><span class="pre">IGNORE</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>, or ends in the
suffix <code class="docutils literal notranslate"><span class="pre">-NOTFOUND</span></code>.  How about that for a true/false rule!  To be safe, use
<code class="docutils literal notranslate"><span class="pre">ON/OFF</span></code> and <code class="docutils literal notranslate"><span class="pre">TRUE/FALSE</span></code> pairs for setting variables.  Look up native
CMake documentation on <code class="docutils literal notranslate"><span class="pre">if()</span></code> for all the interesting details and all the
magical things it can do.</p>
<p><strong>WARNING:</strong> If you mistype <code class="docutils literal notranslate"><span class="pre">&quot;ON&quot;</span></code> as <code class="docutils literal notranslate"><span class="pre">&quot;NO&quot;</span></code>, it evaluates to
<code class="docutils literal notranslate"><span class="pre">FALSE</span></code>/<code class="docutils literal notranslate"><span class="pre">OFF</span></code>!  (That is a fun defect to track down!)</p>
<p>CMake language behavior with respect to case sensitivity is also strange:</p>
<ul class="simple">
<li><p>Calls of built-in and user-defined macros and functions is <em>case
insensitive</em>!  That is <code class="docutils literal notranslate"><span class="pre">set(...)</span></code>, <code class="docutils literal notranslate"><span class="pre">set(...)</span></code>, <code class="docutils literal notranslate"><span class="pre">set()</span></code>, and all other
combinations of upper and lower case characters for ‘S’, ‘E’, ‘T’ all call
the built-in <code class="docutils literal notranslate"><span class="pre">set()</span></code> function.  The convention in TriBITS is to use
<code class="docutils literal notranslate"><span class="pre">lower_case_with_underscores()</span></code> for functions and macros.</p></li>
<li><p>However, the names of CMake (local or cache/global) variables are <em>case
sensitive</em>!  That is, <code class="docutils literal notranslate"><span class="pre">SOME_VAR</span></code> and <code class="docutils literal notranslate"><span class="pre">some_var</span></code> are <em>different</em>
variables.  Built-in CMake variables tend use all caps with underscores
(e.g. <code class="docutils literal notranslate"><span class="pre">CMAKE_CURRENT_SOURCE_DIR</span></code>) but other built-in CMake variables tend
to use mixed case with underscores (e.g. <code class="docutils literal notranslate"><span class="pre">CMAKE_Fortran_FLAGS</span></code>).  TriBITS
tends to use a similar naming convention where project-level and cache
variables have mostly upper-case letters except for parts that are proper
nouns like the project, package or TPL name
(e.g. <code class="docutils literal notranslate"><span class="pre">TribitsExProj_TRIBITS_DIR</span></code>, <code class="docutils literal notranslate"><span class="pre">TriBITS_SOURCE_DIR</span></code>,
<code class="docutils literal notranslate"><span class="pre">Boost_INCLUDE_DIRS</span></code>).  Local variables and function/macro parameters can
use camelCase or lower_case_with_underscores.</p></li>
</ul>
<p>I don’t know of any other programming language that uses different case
sensitivity rules for variables and functions.  However, because we must parse
macro and function arguments when writing user-defined macros and functions,
it is a good thing that CMake variables are case sensitive.  Case insensitivity
would make it much harder and more expensive to parse argument lists that take
keyword-based arguments.</p>
<p>Other mistakes that people make result from not understanding how CMake scopes
variables and other entities.  CMake defines a global scope (i.e. “cache”
variables) and several nested local scopes that are created by
<code class="docutils literal notranslate"><span class="pre">add_subdirectory()</span></code> and entering functions.  See <a class="reference internal" href="#dual-scope-set">dual_scope_set()</a> for a
short discussion of these scoping rules.  And it is not just variables that
can have local and global scoping rules.  Other entities, like defines set
with the built-in command <code class="docutils literal notranslate"><span class="pre">add_definitions()</span></code> only apply to the local scope
and child scopes.  That means that if you call <code class="docutils literal notranslate"><span class="pre">add_definitions()</span></code> to set a
define that affects the meaning of a header-file in C or C++, for example,
that definition will <em>not</em> carry over to a peer subdirectory and those
definitions will not be set (see warning in <a class="reference internal" href="#miscellaneous-notes-tribits-add-library">Miscellaneous Notes
(tribits_add_library())</a>).</p>
<p>Now that some CMake basics and common gotchas have been reviewed, we now get
into the meat of TriBITS starting with the overall structure of a TriBITS
project in the next section.</p>
</section>
<section id="software-engineering-packaging-principles">
<h2><a class="toc-backref" href="#id8"><span class="sectnum">2.3</span> Software Engineering Packaging Principles</a><a class="headerlink" href="#software-engineering-packaging-principles" title="Permalink to this heading"></a></h2>
<p>The term “software engineering” package is adopted in TriBITS nomenclature in
order to highlight and the role of defining and managing “Packages” according
to standard software engineering packaging principles.  In his book [<a class="reference internal" href="#agile-software-development-2003">Agile
Software Development, 2003</a>], Robert Martin defines several object-oriented
(OO) software engineering principles related to packaging software which are
listed below:</p>
<ul class="simple">
<li><p><em>Package Cohesion OO Principles</em>:</p>
<ol class="arabic simple">
<li><p><em>REP (Release-Reuse Equivalency Principle)</em>: The granule of reuse is the
granule of release.</p></li>
<li><p><em>CCP (Common Closure Principle)</em>: The classes in a package should be
closed together against the same kinds of changes.  A change that affects
a closed package affects all the classes in that package and no other
packages.</p></li>
<li><p><em>CRP (Common Reuse Principle)</em>: The classes in a package are used
together.  If you reuse one of the classes in a package, you reuse them
all.</p></li>
</ol>
</li>
<li><p><em>Package Coupling OO Principles</em>:</p>
<ol class="arabic simple" start="4">
<li><p><em>ADP (Acyclic Dependencies Principle)</em>: Allow no cycles in the package
dependency graph.</p></li>
<li><p><em>SDP (Stable Dependencies Principle)</em>: Depend in the direction of
stability.</p></li>
<li><p>SAP (Stable Abstractions Principle): A package should be as abstract as
it is stable.</p></li>
</ol>
</li>
</ul>
<p>Any of these six OO packaging principles (and other issues) may be considered
when deciding how to partition software into different <a class="reference internal" href="#tribits-se-packages">TriBITS SE Packages</a>.</p>
<p>NOTE: The purpose of this TriBITS Developers Guide document is not teach
basic software engineering so these various principles will not be expanded on
further.  However, interested readers are strongly encouraged to read
[<a class="reference internal" href="#agile-software-development-2003">Agile Software Development, 2003</a>] as one of the better software
engineering books out there (see <a class="reference external" href="https://bartlettroscoe.github.io/reading-list/#most_recommended_se_books">https://bartlettroscoe.github.io/reading-list/#most_recommended_se_books</a>).</p>
</section>
</section>
<section id="tribits-project-structure">
<h1><a class="toc-backref" href="#id9"><span class="sectnum">3</span> TriBITS Project Structure</a><a class="headerlink" href="#tribits-project-structure" title="Permalink to this heading"></a></h1>
<p>TriBITS is a Framework, implemented in CMake, to create CMake projects.  As a
<a class="reference external" href="https://en.wikipedia.org/wiki/Software_framework">Software Framework</a>, TriBITS defines the overall structure of a CMake build
system for a project and it processes the various project-, repository-, and
package-specific files in a specified order.  Almost all of this processing
takes place in the <a class="reference internal" href="#id2">tribits_project()</a> macro (or macros and functions it
calls).  The following subsections define the essence of the TriBITS framework
in some detail.  Later sections cover specific topics and the various sections
link to each other.  Within this section, the subsection <a class="reference internal" href="#tribits-structural-units">TriBITS Structural
Units</a> defines the basic units <a class="reference internal" href="#tribits-project">TriBITS Project</a>, <a class="reference internal" href="#tribits-repository">TriBITS Repository</a>,
<a class="reference internal" href="#tribits-package">TriBITS Package</a>, <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a> and other related structural units.  The
subsection <a class="reference internal" href="#processing-of-tribits-files-ordering-and-details">Processing of TriBITS Files: Ordering and Details</a> defines
exactly what files TriBITS processes and in what order.  It also shows how to
get TriBITS to show exactly what files it is processing to help in debugging
issues.  The subsection <a class="reference internal" href="#coexisting-projects-repositories-and-packages">Coexisting Projects, Repositories, and Packages</a>
gives some of the rules and constrains for how the different structure units
can co-exist in the same directories.  The last two subsections in this
section cover <a class="reference internal" href="#standard-tribits-tpls">Standard TriBITS TPLs</a> and <a class="reference internal" href="#common-tribits-tpls">Common TriBITS TPLs</a>.</p>
<section id="tribits-structural-units">
<h2><a class="toc-backref" href="#id10"><span class="sectnum">3.1</span> TriBITS Structural Units</a><a class="headerlink" href="#tribits-structural-units" title="Permalink to this heading"></a></h2>
<p>A CMake project that uses TriBITS as its build and test system is composed of
a single <a class="reference internal" href="#tribits-project">TriBITS Project</a>, one or more <a class="reference internal" href="#tribits-repositories">TriBITS Repositories</a> and one or
more <a class="reference internal" href="#tribits-packages">TriBITS Packages</a>.  In addition, a TriBITS Package can be broken up
into <a class="reference internal" href="#tribits-subpackages">TriBITS Subpackages</a>.  Together, the collection of TriBITS Packages and
TriBITS Subpackages are called <em>TriBITS Software Engineering Packages</em>, or
<a class="reference internal" href="#tribits-se-packages">TriBITS SE Packages</a> for short.</p>
<p>First, to better establish the basic nomenclature, the key structural TriBITS
units are:</p>
<ul class="simple" id="tribits-packages">
<li><p><a class="reference internal" href="#tribits-package">TriBITS Package</a>: A collection of related software that typically includes
one or more source files built into one or more libraries and has associated
tests to help define and protect the functionality provided by the software.
A package also typically defines a single integrated unit of documentation
and testing (see <a class="reference internal" href="#tribits-automated-testing">TriBITS Automated Testing</a>).  A TriBITS package may or
may not be broken down into multiple subpackages. Examples of TriBITS
packages in <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a> include <code class="docutils literal notranslate"><span class="pre">SimpleCXX</span></code>,
<code class="docutils literal notranslate"><span class="pre">MixedLang</span></code> and <code class="docutils literal notranslate"><span class="pre">WithSubpackages</span></code>.  (Don’t confuse a TriBITS
“Package” with a raw CMake “Package”. A raw CMake “Package” actually maps to
a <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>; see <a class="reference internal" href="#why-a-tribits-package-is-not-a-cmake-package">Why a TriBITS Package is not a CMake Package</a>.)</p></li>
</ul>
<ul class="simple" id="tribits-subpackages">
<li><p><a class="reference internal" href="#tribits-subpackage">TriBITS Subpackage</a>: A part of a parent <a class="reference internal" href="#tribits-package">TriBITS Package</a> that also
typically has source files built into libraries and tests but is documented
and tested along with the other subpackages in the parent package.  The primary
purpose for supporting subpackages is to provide finer-grained control of
software dependencies.  In <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>, <code class="docutils literal notranslate"><span class="pre">WithSubpackages</span></code> is
an example of a package with subpackages <code class="docutils literal notranslate"><span class="pre">'A'</span></code>, <code class="docutils literal notranslate"><span class="pre">'B'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'C'</span></code>.  The
full subpackage name is prefixed by the parent package name (e.g. the full
name for subpackage <code class="docutils literal notranslate"><span class="pre">'A'</span></code> is <code class="docutils literal notranslate"><span class="pre">WithSubpackagesA</span></code>).  The parent package is
always implicitly dependent on its subpackages (e.g. parent package
<code class="docutils literal notranslate"><span class="pre">WithSubpackages</span></code> depends on its subpackages <code class="docutils literal notranslate"><span class="pre">WithSubpackagesA</span></code>,
<code class="docutils literal notranslate"><span class="pre">WithSubpackagesB</span></code>, and <code class="docutils literal notranslate"><span class="pre">WithSubpackagesC</span></code>).</p></li>
</ul>
<span id="tribits-se-package"></span><ul class="simple" id="tribits-se-packages">
<li><p><strong>TriBITS SE Package</strong>: The combined set of <a class="reference internal" href="#tribits-packages">TriBITS Packages</a> and <a class="reference internal" href="#tribits-subpackages">TriBITS
Subpackages</a> that constitute the basic <em>Software Engineering</em> packages of a
TriBITS project (see <a class="reference internal" href="#software-engineering-packaging-principles">Software Engineering Packaging Principles</a>): SE
packages are the basis for setting dependencies in the TriBITS system.  For
example, the SE Packages provided by the top-level example package
<code class="docutils literal notranslate"><span class="pre">WithSubpackages</span></code> (in order of increasing dependencies) are
<code class="docutils literal notranslate"><span class="pre">WithSubpackagesA</span></code>, <code class="docutils literal notranslate"><span class="pre">WithSubpackagesB</span></code>, <code class="docutils literal notranslate"><span class="pre">WithSubpackagesC</span></code>, and
<code class="docutils literal notranslate"><span class="pre">WithSubpackages</span></code> (see <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>).</p></li>
</ul>
<ul class="simple" id="tribits-tpls">
<li><p><a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>: The specification for a particular external dependency that
is required or can be used in one or more <a class="reference internal" href="#tribits-se-packages">TriBITS SE Packages</a>.  A TPL (a
Third Party Library) typically provides a list of libraries or a list
include directories for header files but can also be manifested in order
ways as well.  Examples of basic TPLs include <code class="docutils literal notranslate"><span class="pre">BLAS</span></code>, <code class="docutils literal notranslate"><span class="pre">LAPACK</span></code>, and
<code class="docutils literal notranslate"><span class="pre">Boost</span></code>.</p></li>
</ul>
<ul class="simple" id="tribits-repositories">
<li><p><a class="reference internal" href="#tribits-repository">TriBITS Repository</a>: A collection of one or more <a class="reference internal" href="#tribits-packages">TriBITS Packages</a>
specified in a <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> file and zero or more TPL
declarations specified in a <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file.
As discussed below, Repositories can include Native Repositories and Version
Control (VC) Repositories.</p></li>
</ul>
<ul class="simple" id="tribits-projects">
<li><p><a class="reference internal" href="#tribits-project">TriBITS Project</a>: A collection of <a class="reference internal" href="#tribits-repositories">TriBITS Repositories</a> and <a class="reference internal" href="#tribits-packages">TriBITS
Packages</a> that defines a complete CMake <code class="docutils literal notranslate"><span class="pre">PROJECT</span></code> defining software which can be
directly configured with <code class="docutils literal notranslate"><span class="pre">cmake</span></code> and then be built, tested, installed,
etc.</p></li>
</ul>
<span id="tribits-meta-project"></span><ul class="simple" id="tribits-meta-projects">
<li><p><strong>TriBITS Meta-Project</strong>: A <a class="reference internal" href="#tribits-project">TriBITS Project</a> that contains no native
<a class="reference internal" href="#tribits-packages">TriBITS packages</a> or <a class="reference internal" href="#tribits-tpls">TriBITS TPLs</a> but is composed out packages from
other <a class="reference internal" href="#tribits-repositories">TriBITS Repositories</a>.</p></li>
</ul>
<p>In this document, dependencies are described as either being <em>upstream</em> or
<em>downstream/forward</em> defined as:</p>
<span id="upstream-dependency"></span><span id="upstream"></span><ul class="simple" id="upstream-dependencies">
<li><p>If unit “B” requires (or can use, or comes before) unit “A”, then “A” is an
<strong>upstream dependency</strong> of “B”.</p></li>
</ul>
<span id="downstream-dependency"></span><span id="downstream"></span><ul class="simple" id="downstream-dependencies">
<li><p>If unit “B” requires (or can use, or comes before) unit “A”, then “B” is a
<strong>downstream dependency</strong> or a <strong>forward dependency</strong> of “A”.</p></li>
</ul>
<p>The following subsections define the major structural units of a TriBITS
project in more detail.  Each structural unit is described along with the
files and directories associated with each.  In addition, a key set of TriBITS
CMake variables for each are defined as well.</p>
<p>In the next major section following this one, some <a class="reference internal" href="#example-tribits-projects">Example TriBITS Projects</a>
are described.  For those who just want to jump in and learn best by example,
these example projects are a good way to start.  These example projects will
be referenced in the more detailed descriptions given in this document.</p>
<p>The last issue to touch on before getting into the detailed descriptions of
the different TriBITS structural units is the issue of how CMake variables are
defined and used by TriBITS. The CMake variables described in the TriBITS
structural units below fall into one of two major types:</p>
<ul class="simple">
<li><p><em>Local Fixed-Name Variables</em> are used temporarily in the processing of a
TriBITS unit.  These include variables such as <code class="docutils literal notranslate"><span class="pre">PROJECT_NAME</span></code>,
<code class="docutils literal notranslate"><span class="pre">REPOSITORY_NAME</span></code>, <code class="docutils literal notranslate"><span class="pre">PACKAGE_NAME</span></code>, and <code class="docutils literal notranslate"><span class="pre">PARENT_PACKAGE_NAME</span></code>.  These
are distinguished by having a non-namespaced fixed/constant name.  They are
typically part of TriBITS reflection system, allowing subordinate units to
determine the encapsulating unit in which they are participating.  For,
example, a TriBITS subpackage can determine its name, its parent package’s
name and directories, its parent repository name and directories, and the
enclosing project’s name and directories without having to refer to any
specific names.</p></li>
<li><p><em>Globally Scoped Namespaced Variables</em> are used to refer to properties of a
named TriBITS unit that are seen globally by the entire TriBITS project.
These include variables such as <code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}_SOURCE_DIR</span></code>
(e.g. <code class="docutils literal notranslate"><span class="pre">TribitsExProj_SOURCE_DIR</span></code>) and <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_BINARY_DIR</span></code>
(e.g. <code class="docutils literal notranslate"><span class="pre">SimpleCXX_BINARY_DIR</span></code>).  They are available after processing the
unit, for use by <a class="reference internal" href="#downstream">downstream</a> or subordinate units.  They are part of the
TriBITS dependency system, allowing downstream units to access properties of
their known <a class="reference internal" href="#upstream-dependencies">upstream dependencies</a>.</p></li>
</ul>
<p>More information about these various files is described in section <a class="reference internal" href="#processing-of-tribits-files-ordering-and-details">Processing
of TriBITS Files: Ordering and Details</a>.</p>
<section id="tribits-project">
<h3><a class="toc-backref" href="#id11">TriBITS Project</a><a class="headerlink" href="#tribits-project" title="Permalink to this heading"></a></h3>
<p>A TriBITS Project:</p>
<ul class="simple">
<li><p>Defines the <code class="docutils literal notranslate"><span class="pre">PROJECT_NAME</span></code> CMake variable (defined in
<a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a>)</p></li>
<li><p>Defines a complete CMake project which calls <code class="docutils literal notranslate"><span class="pre">project(${PROJECT_NAME}</span>
<span class="pre">...)</span></code> and can be directly configured, built, tested, installed, etc.</p></li>
<li><p>Consists of one or more <a class="reference internal" href="#tribits-repositories">TriBITS Repositories</a> (and may itself be a
<a class="reference internal" href="#tribits-repository">TriBITS Repository</a>) which can include native and extra repositories.</p></li>
<li><p>Allows for extra Repositories to be added on before or after the set of
native Repositories (specified in
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> or by CMake cache
variables)</p></li>
<li><p>Defines a default CDash server and default project name on the server (the
project name on the CDash server must be the same as <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}</span></code>).</p></li>
<li><p>Defines pre-push testing standard builds (using <a class="reference internal" href="#checkin-test-py">checkin-test.py</a>)</p></li>
</ul>
<p>For more details on the definition of a TriBITS Project, see:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#tribits-project-core-files">TriBITS Project Core Files</a></p></li>
<li><p><a class="reference internal" href="#tribits-project-core-variables">TriBITS Project Core Variables</a></p></li>
</ul>
<section id="tribits-project-core-files">
<h4><a class="toc-backref" href="#id12">TriBITS Project Core Files</a><a class="headerlink" href="#tribits-project-core-files" title="Permalink to this heading"></a></h4>
<p>The core files making up a TriBITS Project (where <code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;</span> <span class="pre">=</span>
<span class="pre">${PROJECT_SOURCE_DIR}</span></code>) are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">projectDir</span><span class="o">&gt;/</span>
   <span class="n">ProjectName</span><span class="o">.</span><span class="n">cmake</span>    <span class="c1"># Defines PACKAGE_NAME</span>
   <span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>       <span class="c1"># Base project CMakeLists.txt file</span>
   <span class="n">CTestConfig</span><span class="o">.</span><span class="n">cmake</span>    <span class="c1"># [Optional] Needed for CDash submits</span>
   <span class="n">Version</span><span class="o">.</span><span class="n">cmake</span>        <span class="c1"># [Optional] Dev mode, Project version, VC branch</span>
   <span class="n">project</span><span class="o">-</span><span class="n">checkin</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">config</span><span class="o">.</span><span class="n">py</span> <span class="c1"># [Optional] checkin-test.py config</span>
   <span class="n">cmake</span><span class="o">/</span>
     <span class="n">NativeRepositoriesList</span><span class="o">.</span><span class="n">cmake</span>    <span class="c1"># [Optional] Rarely used</span>
     <span class="n">ExtraRepositoriesList</span><span class="o">.</span><span class="n">cmake</span>     <span class="c1"># [Optional] Lists repos and VC URLs</span>
     <span class="n">ProjectCiFileChangeLogic</span><span class="o">.</span><span class="n">py</span>     <span class="c1"># [Optional] CI global change/test logic</span>
     <span class="n">ProjectCompilerPostConfig</span><span class="o">.</span><span class="n">cmake</span> <span class="c1"># [Optional] Override/tweak build flags</span>
     <span class="n">ProjectDependenciesSetup</span><span class="o">.</span><span class="n">cmake</span>  <span class="c1"># [Optional] Project deps overrides</span>
     <span class="n">CallbackDefineProjectPackaging</span><span class="o">.</span><span class="n">cmake</span>  <span class="c1"># [Optional] CPack settings</span>
     <span class="n">tribits</span><span class="o">/</span>    <span class="c1"># [Optional] Or provide ${PROJECT_NAME}_TRIBITS_DIR</span>
     <span class="n">ctest</span><span class="o">/</span>
       <span class="n">CTestCustom</span><span class="o">.</span><span class="n">cmake</span><span class="o">.</span><span class="ow">in</span>  <span class="c1"># [Optional] Custom ctest settings</span>
</pre></div>
</div>
<p>These TriBITS Project files are documented in more detail below:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a></p></li>
<li><p><a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a></p></li>
<li><p><a class="reference internal" href="#projectdir-ctestconfig-cmake">&lt;projectDir&gt;/CTestConfig.cmake</a></p></li>
<li><p><a class="reference internal" href="#projectdir-version-cmake">&lt;projectDir&gt;/Version.cmake</a></p></li>
<li><p><a class="reference internal" href="#projectdir-project-checkin-test-config-py">&lt;projectDir&gt;/project-checkin-test-config.py</a></p></li>
<li><p><a class="reference internal" href="#projectdir-cmake-nativerepositorieslist-cmake">&lt;projectDir&gt;/cmake/NativeRepositoriesList.cmake</a></p></li>
<li><p><a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a></p></li>
<li><p><a class="reference internal" href="#projectdir-cmake-projectcifilechangelogic-py">&lt;projectDir&gt;/cmake/ProjectCiFileChangeLogic.py</a></p></li>
<li><p><a class="reference internal" href="#projectdir-cmake-projectcompilerpostconfig-cmake">&lt;projectDir&gt;/cmake/ProjectCompilerPostConfig.cmake</a></p></li>
<li><p><a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a></p></li>
<li><p><a class="reference internal" href="#projectdir-cmake-callbackdefineprojectpackaging-cmake">&lt;projectDir&gt;/cmake/CallbackDefineProjectPackaging.cmake</a></p></li>
<li><p><a class="reference internal" href="#projectdir-cmake-tribits">&lt;projectDir&gt;/cmake/tribits/</a></p></li>
<li><p><a class="reference internal" href="#projectdir-cmake-ctest-ctestcustom-cmake-in">&lt;projectDir&gt;/cmake/ctest/CTestCustom.cmake.in</a></p></li>
</ul>
<p id="projectdir-projectname-cmake"><strong>&lt;projectDir&gt;/ProjectName.cmake</strong>: [Required] At a minimum provides a
<code class="docutils literal notranslate"><span class="pre">set()</span></code> statement to set the local variable <code class="docutils literal notranslate"><span class="pre">PROJECT_NAME</span></code>.  This file is
the first file that is read by a number of tools in order to get the TriBITS
project’s name.  This file is read first in every context that involves
processing the TriBITS project’s files, including processes and tools that
just need to build the package and TPL dependency tree (see <a class="reference internal" href="#reduced-package-dependency-processing">Reduced Package
Dependency Processing</a>).  Being this is the first file read in for a TriBITS
project and that it is read in first at the top level scope in every context,
this is a good file to put in other universal static project options.  Note
that this is a project, not a repository file so no general
repository-specific settings should go in this file.  A simple example of this
file is <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<code class="docutils literal notranslate"><span class="pre">ProjectName.cmake</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Must set the project name at very beginning before including anything else
set(PROJECT_NAME TribitsExProj)

# Turn on export dependency generation for WrapExteranl package
set(${PROJECT_NAME}_GENERATE_EXPORT_FILE_DEPENDENCIES_DEFAULT ON)

# Turn on by default the generation of the export files
set(${PROJECT_NAME}_ENABLE_INSTALL_CMAKE_CONFIG_FILES_DEFAULT ON)
</pre></div>
</div>
<p>A meta-project’s <code class="docutils literal notranslate"><span class="pre">ProjectName.cmake</span></code> file might have a number of other
variables set that define how the various different TriBITS repos are cobbled
together into a single TriBITS meta-project (usually because the different
TriBITS repos and packages are a bit messy and have other issues).  For
example, the CASL VERA TriBITS meta-project at one point had a very extensive
collection of set statements in this file.</p>
<p id="projectdir-cmakelists-txt"><strong>&lt;projectDir&gt;/CMakeLists.txt</strong>: [Required] The top-level CMake project file.
This is the first file that the <code class="docutils literal notranslate"><span class="pre">cmake</span></code> executable processes that starts
everything off and is the base-level scope for local (non-cache) CMake
variables.  Due to a few CMake limitations and quirks, a project’s top-level
<code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file is not quit as clean as one might otherwise hope would
be but it is not too bad.  A simple, but representative, example is
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>################################################################################
#                                                                              #
#                        TribitsExampleProject                                 #
#                                                                              #
################################################################################

# To be safe, define your minimum CMake version.  This may be newer than the
# min required by TriBITS.
cmake_minimum_required(VERSION 3.17.0 FATAL_ERROR)

# Make CMake set WIN32 with CYGWIN for older CMake versions.  CMake requires
# this to be in the top-level CMakeLists.txt file and not an include file :-(
set(CMAKE_LEGACY_CYGWIN_WIN32 1 CACHE BOOL &quot;&quot; FORCE)

#
# A) Define your project name and set up major project options
#
# NOTE: Don&#39;t set options that would impact what packages get defined or
# enabled/disabled in this file as that would not impact other tools that
# don&#39;t process this file.
#

# Get PROJECT_NAME (must be in a file for other parts of system to read)
include(&quot;${CMAKE_CURRENT_SOURCE_DIR}/ProjectName.cmake&quot;)

# CMake requires that you declare the CMake project in the top-level file and
# not in an include file :-(
project(${PROJECT_NAME} NONE)

#
# B) Pull in the TriBITS system and execute
#

set(${PROJECT_NAME}_TRIBITS_DIR
   &quot;${CMAKE_CURRENT_LIST_DIR}/../..&quot;  CACHE  STRING
  &quot;TriBITS base directory (default assumes in TriBITS source tree)&quot;)
include(&quot;${${PROJECT_NAME}_TRIBITS_DIR}/TriBITS.cmake&quot;)

# Set default location for header-only TPL to make easy to configure out of
# the TriBITS source tree.
set(HeaderOnlyTpl_INCLUDE_DIRS
  &quot;${${PROJECT_NAME}_TRIBITS_DIR}/examples/tpls/HeaderOnlyTpl&quot; 
  CACHE PATH &quot;Default set by TriBITS/CMakeLists.txt&quot; )

# Do all of the processing for this Tribits project
tribits_project()
</pre></div>
</div>
<p>A couple of CMake and TriBITS quirks that the above example
<code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> addresses are worth some discussion.  First, to avoid
duplication, the project’s <code class="docutils literal notranslate"><span class="pre">ProjectName.cmake</span></code> file is read in with an
<code class="docutils literal notranslate"><span class="pre">include()</span></code> that defines the local variable <code class="docutils literal notranslate"><span class="pre">PROJECT_NAME</span></code>.  Right after
this initial include, the built-in CMake command <code class="docutils literal notranslate"><span class="pre">project(${PROJECT_NAME}</span>
<span class="pre">NONE)</span></code> is run.  This command must be explicitly called with <code class="docutils literal notranslate"><span class="pre">NONE</span></code> so as to
avoid default CMake behavior for defining compilers.  The definition of
compilers comes later as part of the TriBITS system inside of the
<a class="reference internal" href="#id2">tribits_project()</a> command (see <a class="reference internal" href="#full-processing-of-tribits-project-files">Full Processing of TriBITS Project
Files</a>).</p>
<p>As noted in the above example file, the only project defaults that should be
set in this top-level <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file are those that do not impact the
list of package enables/disables.  The latter type of defaults should set in
other files (see below).</p>
<p>In this example project, a CMake cache variable <a class="reference internal" href="#project-name-tribits-dir">${PROJECT_NAME}_TRIBITS_DIR</a>
must be set by the user to define where the base <code class="docutils literal notranslate"><span class="pre">tribits</span></code> source directory
is located.  With this variable set (i.e. passed into <code class="docutils literal notranslate"><span class="pre">cmake</span></code> command-line
use <code class="docutils literal notranslate"><span class="pre">-DTribitsExProj_TRIBITS_DIR=&lt;someDir&gt;</span></code>), one just includes a single
file to pull in the TriBITS system:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">include</span><span class="p">(</span><span class="s2">&quot;${$</span><span class="si">{PROJECT_NAME}</span><span class="s2">_TRIBITS_DIR}/TriBITS.cmake&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>With the <code class="docutils literal notranslate"><span class="pre">TriBITS.cmake</span></code> file included, the configuration of the project
using TriBITS occurs with a single call to <a class="reference internal" href="#id2">tribits_project()</a>.</p>
<p>Some projects, like Trilinos, actually snapshot the <a class="reference internal" href="#tribits-tribits">TriBITS/tribits/</a>
directory into their source tree <a class="reference internal" href="#projectdir-cmake-tribits">&lt;projectDir&gt;/cmake/tribits/</a> and therefore
don’t need to have this variable set.  In Trilinos, the include line is just:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>include(${CMAKE_CURRENT_SOURCE_DIR}/cmake/tribits/TriBITS.cmake)
</pre></div>
</div>
<p>The minimum CMake version must also be declared in the top-level
<code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file as shown.  Explicitly setting the minimum CMake
version avoids strange errors that can occur when someone tries to build the
project using a version of CMake that is too old.  The project should set the
minimum CMake version based on the CMake features used in that project’s own
CMake files.  The minimum CMake version required by TriBITS is defined in
the variable <code class="docutils literal notranslate"><span class="pre">TRIBITS_CMAKE_MINIMUM_REQUIRED</span></code> (the current minimum version
of CMake required by TriBITS is given at in <a class="reference external" href="TribitsBuildReference.html#getting-set-up-to-use-cmake">Getting set up to use CMake</a>) .
For example, the <code class="docutils literal notranslate"><span class="pre">VERA/CMakeLists.txt</span></code> file lists as its first line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(VERA_TRIBITS_CMAKE_MINIMUM_REQUIRED 3.17.0)
cmake_minimum_required(VERSION ${VERA_TRIBITS_CMAKE_MINIMUM_REQUIRED}
  FATAL_ERROR)
</pre></div>
</div>
<p id="projectdir-ctestconfig-cmake"><strong>&lt;projectDir&gt;/CTestConfig.cmake</strong>: [Optional] Specifies the CDash site and
project to submit results to when doing an automated build driven by the CTest
driver function <a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a> (see <a class="reference internal" href="#tribits-ctest-cdash-driver">TriBITS CTest/CDash Driver</a>).
This file is also required to use the TriBITS-generated <code class="docutils literal notranslate"><span class="pre">dashboard</span></code> target
(see <a class="reference external" href="TribitsBuildReference.html#dashboard-submissions">Dashboard Submissions</a>).  An example of this file is
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<code class="docutils literal notranslate"><span class="pre">CTestConfig.cmake</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">include</span><span class="p">(</span><span class="n">SetDefaultAndFromEnv</span><span class="p">)</span>

<span class="nb">set</span><span class="p">(</span><span class="n">CTEST_NIGHTLY_START_TIME</span> <span class="s2">&quot;04:00:00 UTC&quot;</span><span class="p">)</span> <span class="c1"># 10 PM MDT or 9 PM MST</span>

<span class="k">if</span> <span class="p">(</span><span class="n">NOT</span> <span class="n">DEFINED</span> <span class="n">CTEST_DROP_METHOD</span><span class="p">)</span>
  <span class="n">set_default_and_from_env</span><span class="p">(</span><span class="n">CTEST_DROP_METHOD</span> <span class="s2">&quot;http&quot;</span><span class="p">)</span>
<span class="n">endif</span><span class="p">()</span>

<span class="k">if</span> <span class="p">(</span><span class="n">CTEST_DROP_METHOD</span> <span class="n">STREQUAL</span> <span class="s2">&quot;http&quot;</span><span class="p">)</span>
  <span class="n">set_default_and_from_env</span><span class="p">(</span><span class="n">CTEST_DROP_SITE</span> <span class="s2">&quot;my.cdash.org&quot;</span><span class="p">)</span>
  <span class="n">set_default_and_from_env</span><span class="p">(</span><span class="n">CTEST_PROJECT_NAME</span> <span class="s2">&quot;TribitsExampleProject&quot;</span><span class="p">)</span>
  <span class="n">set_default_and_from_env</span><span class="p">(</span><span class="n">CTEST_DROP_LOCATION</span> <span class="s2">&quot;/submit.php?project=TribitsExampleProject&quot;</span><span class="p">)</span>
  <span class="n">set_default_and_from_env</span><span class="p">(</span><span class="n">CTEST_TRIGGER_SITE</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
  <span class="n">set_default_and_from_env</span><span class="p">(</span><span class="n">CTEST_DROP_SITE_CDASH</span> <span class="n">TRUE</span><span class="p">)</span>
<span class="n">endif</span><span class="p">()</span>
</pre></div>
</div>
<p>Most of the variables set in this file are directly understood by raw
<code class="docutils literal notranslate"><span class="pre">ctest</span></code> and those variables not be explained here further (see documentation
for the standard CMake module <code class="docutils literal notranslate"><span class="pre">CTest</span></code>).  The usage of the function
<a class="reference internal" href="#set-default-and-from-env">set_default_and_from_env()</a> allows the variables to be overridden both as
CMake cache variables and in the environment.  The latter is needed when
running using <code class="docutils literal notranslate"><span class="pre">ctest</span></code> as the driver (since older versions of <code class="docutils literal notranslate"><span class="pre">ctest</span></code> did
not support <code class="docutils literal notranslate"><span class="pre">-D&lt;var-name&gt;:&lt;type&gt;=&lt;value&gt;</span></code> command-line arguments like for
<code class="docutils literal notranslate"><span class="pre">cmake</span></code>).  Given that all of these variables are nicely namespaced,
overriding them in the shell environment is not as dangerous as might
otherwise be the case but this is what had to be done to get around
limitations for older versions of CMake/CTest.</p>
<p>NOTE: One can also set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">set_default_and_from_env</span><span class="p">(</span><span class="n">TRIBITS_2ND_CTEST_DROP_SITE</span> <span class="o">...</span><span class="p">)</span>
<span class="n">set_default_and_from_env</span><span class="p">(</span><span class="n">TRIBITS_2ND_CTEST_DROP_LOCATION</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>in this file in order to submit to a second CDash site/location.  For details,
see <a class="reference external" href="TribitsBuildReference.html#dashboard-submissions">Dashboard Submissions</a>.  This is useful when considering a CDash upgrade
and/or implementing new CDash features or tweaks.</p>
<p id="projectdir-version-cmake"><strong>&lt;projectDir&gt;/Version.cmake</strong>: If defined, gives the project’s version and
determines development/release mode (see <a class="reference internal" href="#project-and-repository-versioning-and-release-mode">Project and Repository Versioning
and Release Mode</a>).  This file is read in (using <code class="docutils literal notranslate"><span class="pre">include()</span></code>) in the
project’s base-level <code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/CMakeLists.txt</span></code> file scope so local
variables set in this file are seen by the entire CMake project.  For example,
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<code class="docutils literal notranslate"><span class="pre">Version.cmake</span></code>, looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${REPOSITORY_NAME}_VERSION 1.1)
set(${REPOSITORY_NAME}_MAJOR_VERSION 01)
set(${REPOSITORY_NAME}_MAJOR_MINOR_VERSION 010100)
set(${REPOSITORY_NAME}_VERSION_STRING &quot;1.1 (Dev)&quot;)
set(${REPOSITORY_NAME}_ENABLE_DEVELOPMENT_MODE_DEFAULT ON) # Change to &#39;OFF&#39; for a release
</pre></div>
</div>
<p>When this file exists in the base project, these will be used to create
standard SOVERSION symlinks to shared libs.  For example, on Linux, in
addition to the real shared lib <code class="docutils literal notranslate"><span class="pre">lib&lt;libname&gt;.so</span></code>, the standard SOVERSION
symlinks are created like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lib</span><span class="o">&lt;</span><span class="n">libname</span><span class="o">&gt;.</span><span class="n">so</span><span class="mf">.01</span>
<span class="n">lib</span><span class="o">&lt;</span><span class="n">libname</span><span class="o">&gt;.</span><span class="n">so</span><span class="mf">.1.1</span>
</pre></div>
</div>
<p>When this file exists at the repository level, the prefix
<code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}_</span></code> is used instead of hard-coding the project name.  This
is so that the same <code class="docutils literal notranslate"><span class="pre">Version.txt</span></code> file can be used as the
<a class="reference internal" href="#repodir-version-cmake">&lt;repoDir&gt;/Version.cmake</a> file and have the repository name be flexible.
TriBITS sets <code class="docutils literal notranslate"><span class="pre">REPOSITORY_NAME</span> <span class="pre">=</span> <span class="pre">${PROJECT_NAME}</span></code> when it reads in this file
at the project-level scope.</p>
<p>It is strongly recommended that every TriBITS project contain a
<code class="docutils literal notranslate"><span class="pre">Version.cmake</span></code> file, even if a release has never occurred.  Otherwise, the
project needs to define the variable
<a class="reference internal" href="#project-name-enable-development-mode-default">${PROJECT_NAME}_ENABLE_DEVELOPMENT_MODE_DEFAULT</a> at the global project scope
(perhaps in <code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/ProjectName.cmake</span></code>) to get right development mode
behavior.</p>
<p id="projectdir-project-checkin-test-config-py"><strong>&lt;projectDir&gt;/project-checkin-test-config.py</strong>: [Optional] Used to define the
<code class="docutils literal notranslate"><span class="pre">--default-builds</span></code> and other project-level configuration options for the
project’s usage of the <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> tool.  Machine or package-specific
options should <strong>not</strong> be placed in this file.  An example of this file for
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<code class="docutils literal notranslate"><span class="pre">project-checkin-test-config.py</span></code> is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># Define project-specific options for the checkin-test script for</span>
<span class="c1"># TribitsExampleProject.</span>
<span class="c1">#</span>

<span class="n">configuration</span> <span class="o">=</span> <span class="p">{</span>

    <span class="c1"># Default command line arguments</span>
    <span class="s1">&#39;defaults&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;--send-email-to-on-push&#39;</span><span class="p">:</span> <span class="s1">&#39;trilinos-checkin-tests@software.sandia.gov&#39;</span><span class="p">,</span>
        <span class="p">},</span>

    <span class="c1"># CMake options (-DVAR:TYPE=VAL) cache variables.</span>
    <span class="s1">&#39;cmake&#39;</span><span class="p">:</span> <span class="p">{</span>
        
        <span class="c1"># Options that are common to all builds.</span>
        <span class="s1">&#39;common&#39;</span><span class="p">:</span> <span class="p">[],</span>

        <span class="c1"># Defines --default-builds, in order.</span>
        <span class="s1">&#39;default-builds&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="c1"># Options for the MPI_DEBUG build.</span>
            <span class="p">(</span><span class="s1">&#39;MPI_DEBUG&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;-DTPL_ENABLE_MPI:BOOL=ON&#39;</span><span class="p">,</span>
                <span class="s1">&#39;-DCMAKE_BUILD_TYPE:STRING=RELEASE&#39;</span><span class="p">,</span>
                <span class="s1">&#39;-DTribitsExProj_ENABLE_DEBUG:BOOL=ON&#39;</span><span class="p">,</span>
                <span class="s1">&#39;-DTribitsExProj_ENABLE_CHECKED_STL:BOOL=ON&#39;</span><span class="p">,</span>
                <span class="s1">&#39;-DTribitsExProj_ENABLE_DEBUG_SYMBOLS:BOOL=ON&#39;</span><span class="p">,</span>
                <span class="p">]),</span>
            <span class="c1"># Options for the SERIAL_RELEASE build.</span>
            <span class="p">(</span><span class="s1">&#39;SERIAL_RELEASE&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;-DTPL_ENABLE_MPI:BOOL=OFF&#39;</span><span class="p">,</span>
                <span class="s1">&#39;-DCMAKE_BUILD_TYPE:STRING=RELEASE&#39;</span><span class="p">,</span>
                <span class="s1">&#39;-DTribitsExProj_ENABLE_DEBUG:BOOL=OFF&#39;</span><span class="p">,</span>
                <span class="s1">&#39;-DTribitsExProj_ENABLE_CHECKED_STL:BOOL=OFF&#39;</span><span class="p">,</span>
                <span class="p">]),</span>
            <span class="p">],</span> <span class="c1"># default-builds</span>

        <span class="p">},</span> <span class="c1"># cmake</span>

    <span class="p">}</span> <span class="c1"># configuration</span>
</pre></div>
</div>
<p>The contents of the file <code class="docutils literal notranslate"><span class="pre">project-checkin-test-config.py</span></code> show above are
pretty self explanatory.  This file defines a single python dictionary
data-structure called <code class="docutils literal notranslate"><span class="pre">configuration</span></code> which gives some default arguments in
<code class="docutils literal notranslate"><span class="pre">defaults</span></code>, and then cmake options that define the projects
<code class="docutils literal notranslate"><span class="pre">--default-builds</span></code>.  For more details, see the section <a class="reference internal" href="#pre-push-testing-using-checkin-test-py">Pre-push Testing
using checkin-test.py</a>.</p>
<p id="projectdir-cmake-nativerepositorieslist-cmake"><strong>&lt;projectDir&gt;/cmake/NativeRepositoriesList.cmake</strong>: [Deprecated] If present,
this file gives the list of native repositories for the TriBITS project.  The
file must contain a <code class="docutils literal notranslate"><span class="pre">set()</span></code> statement defining the variable
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_NATIVE_REPOSITORIES</span></code> which is just a flat list of repository
names that must also be directory names under <code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/</span></code>.  For example,
if this file contains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_NATIVE_REPOSITORIES Repo0 Repo1)
</pre></div>
</div>
<p>then the directories <code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/Repo0/</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/Repo1/</span></code> must
exist and must be valid TriBITS repositories (see <a class="reference internal" href="#tribits-repository">TriBITS Repository</a>).</p>
<p>There are no examples for the usage of this file in any of the TriBITS
examples or test projects.  However, support for this file is maintained for
backward compatibility since there may be some TriBITS projects that still use
it.  It is recommended instead to define multiple repositories using the
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file as it allows for more
flexibility in how extra repositories are specified and how they are accessed.
The latter file allows the various tools to perform version control (VC)
activities with these repos while “native repositories” do not.</p>
<p>If this file <code class="docutils literal notranslate"><span class="pre">NativeRepositoriesList.cmake</span></code> does not exist, then TriBITS
sets <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_NATIVE_REPOSITORIES</span></code> equal to “.”, or the base project
directory (i.e. <code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/.</span></code>).  In this case, the file
<code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/PackagesList.cmake</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/TPLsList.cmake</span></code> must
exist.  However, if the project has no native packages or TPLs, then these
files can be set up to list no packages or TPLs.  This is the case for
meta-projects like VERA that have only extra repositories specified in the
file <a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a>.</p>
<p id="projectdir-cmake-extrarepositorieslist-cmake"><strong>&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</strong>: [Optional] If present,
this file defines a list of extra repositories that are added on to the
project’s native repositories.  The list of repositories is defined using the
macro <a class="reference internal" href="#tribits-project-define-extra-repositories">tribits_project_define_extra_repositories()</a>.  For example, the extra
repos file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_project_define_extra_repositories</span><span class="p">(</span>
  <span class="n">ExtraRepo1</span>  <span class="s2">&quot;&quot;</span>  <span class="n">GIT</span>  <span class="n">someurl</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="o">/</span><span class="n">ExtraRepo1</span>   <span class="s2">&quot;&quot;</span>          <span class="n">Continuous</span>
  <span class="n">ExtraRepo2</span>  <span class="n">packages</span><span class="o">/</span><span class="n">SomePackage</span><span class="o">/</span><span class="n">Blah</span>  <span class="n">GIT</span>  <span class="n">someurl2</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="o">/</span><span class="n">ExtraRepo2</span>
                                                 <span class="n">NOPACKAGES</span>  <span class="n">Nightly</span>
  <span class="n">ExtraRepo3</span>  <span class="s2">&quot;&quot;</span>  <span class="n">HG</span>  <span class="n">someurl3</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="o">/</span><span class="n">ExtraRepo3</span>   <span class="s2">&quot;&quot;</span>          <span class="n">Continuous</span>
  <span class="n">ExtraRepo4</span>  <span class="s2">&quot;&quot;</span>  <span class="n">SVN</span>  <span class="n">someurl4</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="o">/</span><span class="n">ExtraRepo4</span>  <span class="s2">&quot;&quot;</span>          <span class="n">Nightly</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>shows the specification of both TriBITS Repositories and non-TriBITS VC
Repositories.  In the above file, the repositories <code class="docutils literal notranslate"><span class="pre">ExtraRepo1</span></code>,
<code class="docutils literal notranslate"><span class="pre">ExtraRepo3</span></code>, and <code class="docutils literal notranslate"><span class="pre">ExtraRepo4</span></code> are both TriBITS and VC repositories that
are cloned into directories under <code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;</span></code> of the same names from the
URLs <code class="docutils literal notranslate"><span class="pre">someurl.com:/ExtraRepo1</span></code>, <code class="docutils literal notranslate"><span class="pre">someurl3.com:/ExtraRepo3</span></code>, and
<code class="docutils literal notranslate"><span class="pre">someurl4.com:/ExtraRepo4</span></code>, respectively.  However, the repository
<code class="docutils literal notranslate"><span class="pre">ExtraRepo2</span></code> is <strong>not</strong> a <a class="reference internal" href="#tribits-repository">TriBITS Repository</a> because it is marked as
<code class="docutils literal notranslate"><span class="pre">NOPACKAGES</span></code>.  In this case, it gets cloned as the directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">projectDir</span><span class="o">&gt;/</span><span class="n">packages</span><span class="o">/</span><span class="n">SomePackage</span><span class="o">/</span><span class="n">Blah</span>
</pre></div>
</div>
<p>However, the code in the tools <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> and
<a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a> will consider non-TriBITS VC repos like
<code class="docutils literal notranslate"><span class="pre">ExtraRepo2</span></code> and any changes to this repository will be listed as changes to
<code class="docutils literal notranslate"><span class="pre">somePackage</span></code> (see <a class="reference internal" href="#pre-push-testing-using-checkin-test-py">Pre-push Testing using checkin-test.py</a>).</p>
<p>NOTE: This file can be overridden by setting the cache variable
<a class="reference external" href="TribitsBuildReference.html#project-extrarepos-file">&lt;Project&gt;_EXTRAREPOS_FILE</a>.</p>
<p id="projectdir-cmake-projectcifilechangelogic-py"><strong>&lt;projectDir&gt;/cmake/ProjectCiFileChangeLogic.py</strong>: [Optional] If present,
then this Python module is imported and the Python class defined there
ProjectCiFileChangeLogic there is used to determine which files need to
trigger a global rebuild of the project enabling all packages.</p>
<p>An example of this given in the file
<code class="docutils literal notranslate"><span class="pre">TribitsExampleProject/cmake/ProjectCiFileChangeLogic.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># Specialized logic for what file changes should trigger a global build in CI</span>
<span class="c1"># testing where testing should only occur package impacted by the change.</span>
<span class="c1">#</span>

<span class="k">class</span> <span class="nc">ProjectCiFileChangeLogic</span><span class="p">:</span>

  <span class="k">def</span> <span class="nf">isGlobalBuildFileRequiringGlobalRebuild</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modifiedFileFullPath</span><span class="p">):</span>
    <span class="n">modifiedFileFullPathArray</span> <span class="o">=</span> <span class="n">modifiedFileFullPath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">lenPathArray</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">modifiedFileFullPathArray</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lenPathArray</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
      <span class="c1"># Files sitting directly under &lt;projectDir&gt;/</span>
      <span class="k">if</span> <span class="n">modifiedFileFullPathArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CMakeLists.txt&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
      <span class="k">if</span> <span class="n">modifiedFileFullPathArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;.cmake&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">modifiedFileFullPathArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;cmake&#39;</span><span class="p">:</span>
      <span class="c1"># Files under &lt;projectDir&gt;/cmake/</span>
      <span class="k">if</span> <span class="n">modifiedFileFullPathArray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ExtraRepositoriesList.cmake&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
      <span class="k">elif</span> <span class="n">modifiedFileFullPathArray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ctest&#39;</span> <span class="ow">and</span> <span class="n">lenPathArray</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">lenPathArray</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
          <span class="c1"># This is a file</span>
          <span class="c1"># &lt;projectDir&gt;/cmake/ctest/&lt;something&gt;/[...something...]  so this is</span>
          <span class="c1"># for a specific machine and should not trigger a global build.</span>
          <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="c1"># Any other file directly under cmake/ctest/ should trigger a global</span>
          <span class="c1"># build.</span>
          <span class="k">return</span> <span class="kc">True</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="c1"># All other files under cmake/</span>
        <span class="k">if</span> <span class="n">modifiedFileFullPath</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s2">&quot;.cmake&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
          <span class="c1"># All other *.cmake files under cmake/ trigger a global build.</span>
          <span class="k">return</span> <span class="kc">True</span>
    <span class="c1"># Any other files should not trigger a global build</span>
    <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
<p>This logic is used in all code that is used in CI testing including
<a class="reference internal" href="#checkin-test-py">checkin-test.py</a>, <a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a> and
<a class="reference internal" href="#get-tribits-packages-from-files-list-py">get-tribits-packages-from-files-list.py</a>.  If this file does not exist, then
TriBITS has some default logic which may or may not be sufficient for the
needs of a given project.</p>
<p id="projectdir-cmake-projectcompilerpostconfig-cmake"><strong>&lt;projectDir&gt;/cmake/ProjectCompilerPostConfig.cmake</strong>: [Optional] If present,
then this file is read using <code class="docutils literal notranslate"><span class="pre">include()</span></code> at the top-level CMakeLists.txt
file scope right after the compilers for the languages <code class="docutils literal notranslate"><span class="pre">&lt;LANG&gt;</span></code> = <code class="docutils literal notranslate"><span class="pre">C</span></code>,
<code class="docutils literal notranslate"><span class="pre">CXX</span></code>, and <code class="docutils literal notranslate"><span class="pre">Fortran</span></code> are determined and checked using
<code class="docutils literal notranslate"><span class="pre">enable_language(&lt;LANG&gt;)</span></code> but before any other checks are performed.  This
file can contain logic for the project to adjust the flags set in
<code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAGS</span></code> and changes to other aspects of the build flags
(including link flags, etc.).</p>
<p>One example of the usage of this file is the Trilinos project where this file
is (or was) used to apply specialized logic implemented in the Kokkos build
system to select compiler options and to determine how C++11 and OpenMP flags
are set.  This file in Trilinos looked like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>if (${Trilinos_ENABLE_Kokkos})

  ...

  include(${Kokkos_GEN_DIR}/kokkos_generated_settings.cmake)

  if (NOT KOKKOS_ARCH STREQUAL &quot;None&quot;)

    set(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} ${KOKKOS_CXX_FLAGS}&quot;)

    message(&quot;-- &quot; &quot;Skip adding flags for OpenMP because Kokkos flags does that ...&quot;)
    set(OpenMP_CXX_FLAGS_OVERRIDE &quot; &quot;)

  endif()

endif()
</pre></div>
</div>
<p>The exact context where this file is processed (if it exists) is described in
<a class="reference internal" href="#full-processing-of-tribits-project-files">Full Processing of TriBITS Project Files</a> and <a class="reference internal" href="#tribits-environment-probing-and-setup">TriBITS Environment Probing
and Setup</a>.</p>
<p id="projectdir-cmake-projectdependenciessetup-cmake"><strong>&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</strong>: [Optional] If present,
this file is included a single time as part of the generation of the project’s
dependency data-structure (see <a class="reference internal" href="#reduced-package-dependency-processing">Reduced Package Dependency Processing</a>).  It
gets included at the top project level scope after all of the
<a class="reference internal" href="#repodir-cmake-repositorydependenciessetup-cmake">&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</a> files have been included
but before all of the package <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> files
are included.  Any local variables set in this file have project-wide scope.
The primary purpose for this file is to set variables that will impact the
processing of project’s package <code class="docutils literal notranslate"><span class="pre">Dependencies.cmake</span></code> files.</p>
<p>The typical usage of this file is to set the default CDash email address for
all packages or override the email addresses for all of a repository’s package
CDash regression email addresses (see <a class="reference internal" href="#cdash-regression-email-addresses">CDash regression email addresses</a>).
For example, to set the default email address for all of the packages, one
would set in this file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set_default(${PROJECT_NAME}_PROJECT_MASTER_EMAIL_ADDRESS
    projectx-regressions@somemailserver.org)
</pre></div>
</div>
<p>The repository email address variables
<a class="reference internal" href="#repository-name-repository-email-url-address-base">${REPOSITORY_NAME}_REPOSITORY_EMAIL_URL_ADDRESS_BASE</a> and
<a class="reference internal" href="#repository-name-repository-master-email-address">${REPOSITORY_NAME}_REPOSITORY_MASTER_EMAIL_ADDRESS</a> possibly set in the just
processed <a class="reference internal" href="#repodir-cmake-repositorydependenciessetup-cmake">&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</a> files can also
be overridden in this file.  The CASL VERA meta-project uses this file to
override several of the repository-specific email addresses for its
constituent repositories.</p>
<p>In general, variables that affect how package dependencies are defined or
affect package and TPL enable/disable logic for <em>only this particular project</em>
should be defined in this file.</p>
<p id="projectdir-cmake-callbackdefineprojectpackaging-cmake"><strong>&lt;projectDir&gt;/cmake/CallbackDefineProjectPackaging.cmake</strong>: [Optional] If
exists, defines the CPack settings for the project (see <a class="reference external" href="http://www.cmake.org/cmake/help/documentation.html">Official CPack
Documentation</a> and
<a class="reference external" href="http://www.cmake.org/Wiki/CMake:Packaging_With_CPack">Online CPack Wiki</a>).
This file must define a macro called <code class="docutils literal notranslate"><span class="pre">tribits_project_define_packaging()</span></code>
which is then invoked by TriBITS.  The file:</p>
<blockquote>
<div><p><a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<code class="docutils literal notranslate"><span class="pre">cmake/CallbackDefineProjectPackaging.cmake</span></code></p>
</div></blockquote>
<p>provides a good example which is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>macro(TRIBITS_PROJECT_DEFINE_PACKAGING)

    tribits_copy_installer_resource(TribitsExProj_README
      &quot;${TribitsExProj_SOURCE_DIR}/README.md&quot;
      &quot;${TribitsExProj_BINARY_DIR}/README.md&quot;)
    tribits_copy_installer_resource(TribitsExProj_LICENSE
      &quot;${TribitsExProj_SOURCE_DIR}/LICENSE&quot;
      &quot;${TribitsExProj_BINARY_DIR}/LICENSE.txt&quot;)

    set(CPACK_PACKAGE_DESCRIPTION &quot;TribitsExampleProject just shows you how to use TriBITS.&quot;)
    set(CPACK_PACKAGE_FILE_NAME &quot;tribitsexproj-setup-${TribitsExProj_VERSION}&quot;)
    set(CPACK_PACKAGE_INSTALL_DIRECTORY &quot;TribitsExProj ${TribitsExProj_VERSION}&quot;)
    set(CPACK_PACKAGE_REGISTRY_KEY &quot;TribitsExProj ${TribitsExProj_VERSION}&quot;)
    set(CPACK_PACKAGE_NAME &quot;tribitsexproj&quot;)
    set(CPACK_PACKAGE_VENDOR &quot;Sandia National Laboratories&quot;)
    set(CPACK_PACKAGE_VERSION &quot;${TribitsExProj_VERSION}&quot;)
    set(CPACK_RESOURCE_FILE_README &quot;${TribitsExProj_README}&quot;)
    set(CPACK_RESOURCE_FILE_LICENSE &quot;${TribitsExProj_LICENSE}&quot;)
    set(${PROJECT_NAME}_CPACK_SOURCE_GENERATOR_DEFAULT &quot;TGZ;TBZ2&quot;)
    set(CPACK_SOURCE_FILE_NAME &quot;tribitsexproj-source-${TribitsExProj_VERSION}&quot;)
    set(CPACK_COMPONENTS_ALL ${TribitsExProj_PACKAGES} Unspecified)

endmacro()
</pre></div>
</div>
<p>The CPack variables show above that should be defined at the project-level are
described in the <a class="reference external" href="http://www.cmake.org/cmake/help/documentation.html">Official CPack Documentation</a>.</p>
<p>Settings that are general for all distributions (like non-package repository
files to exclude from the tarball) should be set at the in the file
<a class="reference internal" href="#repodir-cmake-callbackdefinerepositorypackaging-cmake">&lt;repoDir&gt;/cmake/CallbackDefineRepositoryPackaging.cmake</a>.  See <cite>Creating
Source Distributions</cite> for more details.</p>
<p id="projectdir-cmake-tribits"><strong>&lt;projectDir&gt;/cmake/tribits/</strong>: [Optional] This is the typical location of
the <a class="reference internal" href="#tribits-tribits">TriBITS/tribits/</a> source tree for projects that choose to snapshot
TriBITS into their source tree.  In fact, TriBITS assumes this is the default
location for the TriBITS source tree if <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TRIBITS_DIR</span></code> is not
otherwise specified.  Trilinos, for example, currently snapshots the TriBITS
source tree into this directory.  See <a class="reference internal" href="#tribits-directory-snapshotting">TriBITS directory snapshotting</a> for
more details.</p>
<p id="projectdir-cmake-ctest-ctestcustom-cmake-in"><strong>&lt;projectDir&gt;/cmake/ctest/CTestCustom.cmake.in</strong>: [Optional] If this file
exists, it is processed using a <code class="docutils literal notranslate"><span class="pre">configure_file()</span></code> command to write the file
<code class="docutils literal notranslate"><span class="pre">CTestCustom.cmake</span></code> in the project base build directory
<code class="docutils literal notranslate"><span class="pre">`${PROJECT_BINARY_DIR}/</span></code>.  This file is picked up automatically by
<code class="docutils literal notranslate"><span class="pre">ctest</span></code> (see <a class="reference external" href="http://www.cmake.org/Wiki/CMake/Testing_With_CTest">CTest documentation</a>).  This file is typically used to change
the maximum size of test output.  For example, the
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<code class="docutils literal notranslate"><span class="pre">cmake/ctest/CTestCustom.cmake.in</span></code> looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Increase the amount of output being produced</span>
<span class="nb">set</span><span class="p">(</span><span class="n">CTEST_CUSTOM_MAXIMUM_PASSED_TEST_OUTPUT_SIZE</span> <span class="mi">54321</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="n">CTEST_CUSTOM_MAXIMUM_FAILED_TEST_OUTPUT_SIZE</span> <span class="mi">123456</span><span class="p">)</span>
<span class="c1"># NOTE: Above, we use these numbers to make it easy to determine that these</span>
<span class="c1"># values are getting read correctly in various modes of running</span>
<span class="c1"># tribits_ctest_driver().  In a real project, you could set something like:</span>
<span class="c1">#</span>
<span class="c1">#   set(CTEST_CUSTOM_MAXIMUM_PASSED_TEST_OUTPUT_SIZE 50000)</span>
<span class="c1">#   set(CTEST_CUSTOM_MAXIMUM_FAILED_TEST_OUTPUT_SIZE 5000000)</span>
</pre></div>
</div>
<p>which sets the output size for each test submitted to CDash be unlimited
(which is not really recommended).  These variables used by Trilinos at one
time were:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">CTEST_CUSTOM_MAXIMUM_PASSED_TEST_OUTPUT_SIZE</span> <span class="mi">50000</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="n">CTEST_CUSTOM_MAXIMUM_FAILED_TEST_OUTPUT_SIZE</span> <span class="mi">5000000</span><span class="p">)</span>
</pre></div>
</div>
<p>which sets the max output for passed and failed tests to 50000k and 5000000k,
respectively.</p>
<p>For documentation of the options one can change for CTest, see online <a class="reference external" href="http://www.cmake.org/Wiki/CMake/Testing_With_CTest">CTest
documentation</a>.</p>
</section>
<section id="tribits-project-core-variables">
<h4><a class="toc-backref" href="#id13">TriBITS Project Core Variables</a><a class="headerlink" href="#tribits-project-core-variables" title="Permalink to this heading"></a></h4>
<p>The following <cite>local variables</cite> are defined in the top-level Project
<code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file scope and are therefore accessible by all files
processed by TriBITS:</p>
<blockquote>
<div><p id="project-name"><code class="docutils literal notranslate"><span class="pre">PROJECT_NAME</span></code></p>
<blockquote>
<div><p>The name of the TriBITS Project.  This exists to support, among other
things, the ability for subordinate units (Repositories and Packages) to
determine the Project in which is participating.  This is typically read
from a <code class="docutils literal notranslate"><span class="pre">set()</span></code> statement in the project’s
<a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file.</p>
</div></blockquote>
<p id="project-source-dir"><code class="docutils literal notranslate"><span class="pre">PROJECT_SOURCE_DIR</span></code></p>
<blockquote>
<div><p>The absolute path to the base Project source directory.  This is set
automatically by TriBITS given the directory passed into <code class="docutils literal notranslate"><span class="pre">cmake</span></code> at
configure time at the beginning of the <a class="reference internal" href="#id2">tribits_project()</a> macro.</p>
</div></blockquote>
<p id="project-binary-dir"><code class="docutils literal notranslate"><span class="pre">PROJECT_BINARY_DIR</span></code></p>
<blockquote>
<div><p>The absolute path to the base Project binary/build directory.  This is set
automatically by TriBITS and is the directory where <code class="docutils literal notranslate"><span class="pre">cmake</span></code> is run from
and is set at the beginning of the <a class="reference internal" href="#id2">tribits_project()</a> macro.</p>
</div></blockquote>
<p id="project-name-source-dir"><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SOURCE_DIR</span></code></p>
<blockquote>
<div><p>Set to the same directory as <code class="docutils literal notranslate"><span class="pre">${PROJECT_SOURCE_DIR}</span></code> automatically by
the built-in <code class="docutils literal notranslate"><span class="pre">project()</span></code> command called in the top-level
<a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> file..</p>
</div></blockquote>
<p id="project-name-binary-dir"><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_BINARY_DIR</span></code></p>
<blockquote>
<div><p>Set to the same directory as <code class="docutils literal notranslate"><span class="pre">${PROJECT_BINARY_DIR}</span></code> automatically by
the built-in <code class="docutils literal notranslate"><span class="pre">project()</span></code> command called in the top-level
<a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> file..</p>
</div></blockquote>
</div></blockquote>
<p>The following <cite>cache variables</cite> are defined for every TriBITS project:</p>
<blockquote>
<div><p id="project-name-tribits-dir"><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TRIBITS_DIR</span></code></p>
<blockquote>
<div><p>CMake cache variable that gives the path to the TriBITS implementation
directory.  When set to a relative path (set as type <code class="docutils literal notranslate"><span class="pre">STRING</span></code>, see
below), this is taken relative to <code class="docutils literal notranslate"><span class="pre">${CMAKE_CURRENT_SOURCE_DIR}/</span></code> (the
project base source dir).  When an absolute path is given, it is used
without modification.  If this variable is not set in the
<a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> file, then it will be automatically set as
a <code class="docutils literal notranslate"><span class="pre">PATH</span></code> cache variable by the include of <code class="docutils literal notranslate"><span class="pre">TriBITS.cmake</span></code> by the
statement</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set( ${PROJECT_NAME}_TRIBITS_DIR
  &quot;${CMAKE_CURRENT_SOURCE_DIR}/cmake/tribits&quot; CACHE PATH &quot;...&quot;)
</pre></div>
</div>
<p>Therefore, projects that snapshot TriBITS into
<a class="reference internal" href="#projectdir-cmake-tribits">&lt;projectDir&gt;/cmake/tribits/</a> don’t need to explicitly set
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TRIBITS_DIR</span></code>.  In addition, one can also point to a
different TriBITS implementation just by setting the absolute path:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_TRIBITS_DIR</span><span class="o">=&lt;</span><span class="n">some</span><span class="o">-</span><span class="nb">abs</span><span class="o">-</span><span class="nb">dir</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>or to a relative path using, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_TRIBITS_DIR</span><span class="p">:</span><span class="n">STRING</span><span class="o">=</span><span class="n">TriBITS</span><span class="o">/</span><span class="n">tribits</span>
</pre></div>
</div>
<p>Note that when the <code class="docutils literal notranslate"><span class="pre">TriBITS</span></code> git repo itself is cloned by a TriBITS
project, then <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TRIBITS_DIR</span></code> should be set to the
directory <code class="docutils literal notranslate"><span class="pre">TriBITS/tribits</span></code> (see <a class="reference internal" href="#tribits-tribits">TriBITS/tribits/</a>) as shown above.</p>
</div></blockquote>
<p id="project-name-enable-tests"><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_TESTS</span></code></p>
<blockquote>
<div><p>CMake cache variable that if set to <code class="docutils literal notranslate"><span class="pre">ON</span></code>, then tests for all explicitly
enabled packages will be turned on.  This has a default value of <code class="docutils literal notranslate"><span class="pre">OFF</span></code>.
This is used in logic to enable individual SE package tests (see
<a class="reference internal" href="#project-enable-tests-only-enables-explicitly-enabled-se-package-tests">&lt;Project&gt;_ENABLE_TESTS only enables explicitly enabled SE package
tests</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_ENABLE_EXAMPLES</span></code></p>
<blockquote>
<div><p>CMake cache variable that if set to <code class="docutils literal notranslate"><span class="pre">ON</span></code>, then examples for all
explicitly enabled packages will be turned on.  This has a default value
of <code class="docutils literal notranslate"><span class="pre">OFF</span></code>.</p>
</div></blockquote>
</div></blockquote>
<p>The following <cite>internal project-scope local</cite> (non-cache) CMake variables are
defined by TriBITS giving the project’s TriBITS repositories.:</p>
<blockquote>
<div><p id="project-name-native-repositories"><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_NATIVE_REPOSITORIES</span></code></p>
<blockquote>
<div><p>The list of Native Repositories for a given TriBITS project
(i.e. Repositories that are always present when configuring the Project
and are managed in the same VC repo typically).  This variable is set in
the file <a class="reference internal" href="#projectdir-cmake-nativerepositorieslist-cmake">&lt;projectDir&gt;/cmake/NativeRepositoriesList.cmake</a> if it exists.
If the file <code class="docutils literal notranslate"><span class="pre">NativeRepositoriesList.cmake</span></code> does not exist, then the
project is assumed to also be a repository and the list of native
repositories is just the local project directory
<code class="docutils literal notranslate"><span class="pre">${PROJECT_SOURCE_DIR}/.</span></code>.  In this case, the
<code class="docutils literal notranslate"><span class="pre">${PROJECT_SOURCE_DIR}/</span></code> must contain at a minimum a
<code class="docutils literal notranslate"><span class="pre">PackagesList.cmake</span></code> file, and a <code class="docutils literal notranslate"><span class="pre">TPLsList.cmake</span></code> file (see <a class="reference internal" href="#tribits-repository">TriBITS
Repository</a>).</p>
</div></blockquote>
<p id="project-name-extra-repositories"><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_EXTRA_REPOSITORIES</span></code></p>
<blockquote>
<div><p>The list of Extra Repositories that the project is being configured with.
This list of repositories either comes from processing the project’s
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file or comes from the
CMake cache variable <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_EXTRA_REPOSITORIES</span></code>.  See
<a class="reference external" href="TribitsBuildReference.html#enabling-extra-repositories-with-add-on-packages">Enabling extra repositories with add-on packages</a> for details.</p>
</div></blockquote>
<p id="project-name-all-repositories"><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ALL_REPOSITORIES</span></code></p>
<blockquote>
<div><p>Concatenation of all the repos listed in
<a class="reference internal" href="#project-name-native-repositories">${PROJECT_NAME}_NATIVE_REPOSITORIES</a> and
<a class="reference internal" href="#project-name-extra-repositories">${PROJECT_NAME}_EXTRA_REPOSITORIES</a> in the order they are processed.</p>
</div></blockquote>
</div></blockquote>
</section>
</section>
<section id="tribits-repository">
<h3><a class="toc-backref" href="#id14">TriBITS Repository</a><a class="headerlink" href="#tribits-repository" title="Permalink to this heading"></a></h3>
<p>A TriBITS Repository is the basic unit of ready-made composition between
different collections of software that use the TriBITS CMake build and system.</p>
<p>In short, a TriBITS Repository:</p>
<ul class="simple">
<li><p>Is a named collection of related TriBITS Packages and TPLs (defined in
<a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> and <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a>
respectively)</p></li>
<li><p>Defines the base source and binary directories for the Repository
<code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}_SOURCE_DIR</span></code> and <code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}_BINARY_DIR</span></code>.</p></li>
<li><p>Defines a common set of initializations and other hooks for all the
packages in the repository.</p></li>
<li><p>Typically maps to a VC (i.e. git) repository and therefore represents a unit
of integration, versioning and reuse.  (But core TriBITS has no dependency
on any VC tool.)</p></li>
</ul>
<p>For more details on the definition of a TriBITS Repository, see:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#tribits-repository-core-files">TriBITS Repository Core Files</a></p></li>
<li><p><a class="reference internal" href="#tribits-repository-core-variables">TriBITS Repository Core Variables</a></p></li>
</ul>
<section id="tribits-repository-core-files">
<h4><a class="toc-backref" href="#id15">TriBITS Repository Core Files</a><a class="headerlink" href="#tribits-repository-core-files" title="Permalink to this heading"></a></h4>
<p>The core files making up a TriBITS Repository (where <code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;</span> <span class="pre">=</span>
<span class="pre">${${REPOSITORY_NAME}_SOURCE_DIR}</span></code>) are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">repoDir</span><span class="o">&gt;/</span>
  <span class="n">PackagesList</span><span class="o">.</span><span class="n">cmake</span>
  <span class="n">TPLsList</span><span class="o">.</span><span class="n">cmake</span>
  <span class="n">Copyright</span><span class="o">.</span><span class="n">txt</span>  <span class="c1"># [Optional] Only needed if creating version header file</span>
  <span class="n">Version</span><span class="o">.</span><span class="n">cmake</span>  <span class="c1"># [Optional] Info inserted into ${REPO_NAME}_version.h</span>
  <span class="n">cmake</span><span class="o">/</span>
     <span class="n">RepositoryDependenciesSetup</span><span class="o">.</span><span class="n">cmake</span> <span class="c1"># [Optional] CDash email addresses?</span>
     <span class="n">CallbackSetupExtraOptions</span><span class="o">.</span><span class="n">cmake</span> <span class="c1"># [Optional] Called after main options</span>
     <span class="n">CallbackDefineRepositoryPackaging</span><span class="o">.</span><span class="n">cmake</span> <span class="c1"># [Optional] CPack packaging</span>
</pre></div>
</div>
<p>These TriBITS Repository files are documented in more detail below:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a></p></li>
<li><p><a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a></p></li>
<li><p><a class="reference internal" href="#repodir-copyright-txt">&lt;repoDir&gt;/Copyright.txt</a></p></li>
<li><p><a class="reference internal" href="#repodir-version-cmake">&lt;repoDir&gt;/Version.cmake</a></p></li>
<li><p><a class="reference internal" href="#repodir-cmake-repositorydependenciessetup-cmake">&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</a></p></li>
<li><p><a class="reference internal" href="#repodir-cmake-callbacksetupextraoptions-cmake">&lt;repoDir&gt;/cmake/CallbackSetupExtraOptions.cmake</a></p></li>
<li><p><a class="reference internal" href="#repodir-cmake-callbackdefinerepositorypackaging-cmake">&lt;repoDir&gt;/cmake/CallbackDefineRepositoryPackaging.cmake</a></p></li>
</ul>
<p id="repodir-packageslist-cmake"><strong>&lt;repoDir&gt;/PackagesList.cmake</strong>: [Required] Provides the list of top-level
packages defined by the repository.  This file typically just calls the macro
<a class="reference internal" href="#tribits-repository-define-packages">tribits_repository_define_packages()</a> to define the list of packages along
with their directories and other properties.  For example, the file
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<code class="docutils literal notranslate"><span class="pre">PackagesList.cmake</span></code> looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_repository_define_packages</span><span class="p">(</span>
  <span class="n">SimpleCxx</span>          <span class="n">packages</span><span class="o">/</span><span class="n">simple_cxx</span>         <span class="n">PT</span>
  <span class="n">MixedLang</span>          <span class="n">packages</span><span class="o">/</span><span class="n">mixed_lang</span>         <span class="n">PT</span>
  <span class="n">InsertedPkg</span>        <span class="n">InsertedPkg</span>                 <span class="n">ST</span>
  <span class="n">WithSubpackages</span>    <span class="n">packages</span><span class="o">/</span><span class="n">with_subpackages</span>   <span class="n">PT</span>
  <span class="n">WrapExternal</span>       <span class="n">packages</span><span class="o">/</span><span class="n">wrap_external</span>      <span class="n">ST</span>
  <span class="p">)</span>

<span class="n">tribits_disable_package_on_platforms</span><span class="p">(</span><span class="n">WrapExternal</span> <span class="n">Windows</span><span class="p">)</span>
<span class="n">tribits_allow_missing_external_packages</span><span class="p">(</span><span class="n">InsertedPkg</span><span class="p">)</span>
</pre></div>
</div>
<p>Other commands that are appropriate to use in this file include
<a class="reference internal" href="#tribits-disable-package-on-platforms">tribits_disable_package_on_platforms()</a> and
<a class="reference internal" href="#tribits-allow-missing-external-packages">tribits_allow_missing_external_packages()</a>.  Also, if the binary directory
for any package <code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;</span></code> needs to be changed from the default, then
the variable <code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;_SPECIFIED_BINARY_DIR</span></code> can be set.  (see <a class="reference internal" href="#tribits-package-tribits-repository-tribits-project">TriBITS
Package == TriBITS Repository == TriBITS Project</a>).</p>
<p>It is perfectly legal for a TriBITS repository to define no packages at all
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_repository_define_packages</span><span class="p">()</span>
</pre></div>
</div>
<p>and this would be the case for a TriBITS meta-project that has no native
packages, only extra repositories.</p>
<p id="repodir-tplslist-cmake"><strong>&lt;repoDir&gt;/TPLsList.cmake</strong>: [Required] Provides the list of TPLs that are
referenced as TPL dependencies in the repository’s SE package’s
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> files (see <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>).  This
file typically just calls the macro <a class="reference internal" href="#tribits-repository-define-tpls">tribits_repository_define_tpls()</a> to
define the TPLs along with their find modules and other properties.  An
example is <a class="reference internal" href="#reducedmocktrilinos">ReducedMockTrilinos</a>/<code class="docutils literal notranslate"><span class="pre">TPLsList.cmake</span></code> which shows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_repository_define_tpls</span><span class="p">(</span>
  <span class="n">MPI</span>            <span class="s2">&quot;${$</span><span class="si">{PROJECT_NAME}</span><span class="s2">_TRIBITS_DIR}/core/std_tpls/&quot;</span>    <span class="n">PT</span>
  <span class="n">BLAS</span>           <span class="s2">&quot;${$</span><span class="si">{PROJECT_NAME}</span><span class="s2">_TRIBITS_DIR}/core/std_tpls/&quot;</span>    <span class="n">PT</span>
  <span class="n">LAPACK</span>         <span class="s2">&quot;${$</span><span class="si">{PROJECT_NAME}</span><span class="s2">_TRIBITS_DIR}/core/std_tpls/&quot;</span>    <span class="n">PT</span>
  <span class="n">Boost</span>          <span class="s2">&quot;${$</span><span class="si">{PROJECT_NAME}</span><span class="s2">_TRIBITS_DIR}/core/std_tpls/&quot;</span>    <span class="n">ST</span>
  <span class="n">UMFPACK</span>        <span class="n">cmake</span><span class="o">/</span><span class="n">TPLs</span><span class="o">/</span>    <span class="n">ST</span>
  <span class="n">AMD</span>            <span class="n">cmake</span><span class="o">/</span><span class="n">TPLs</span><span class="o">/</span>    <span class="n">EX</span>
  <span class="n">PETSC</span>          <span class="s2">&quot;${$</span><span class="si">{PROJECT_NAME}</span><span class="s2">_TRIBITS_DIR}/common_tpls/&quot;</span>    <span class="n">ST</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a> for details on what gets defined for each TriBITS TPL once
this file is processed.</p>
<p>It is perfectly fine to specify no TPLs at all for a repository with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_repository_define_tpls</span><span class="p">()</span>
</pre></div>
</div>
<p>but the macro <code class="docutils literal notranslate"><span class="pre">tribits_repository_define_tpls()</span></code> has to be called, even if
there are no TPLs.  See <a class="reference internal" href="#tribits-repository-define-tpls">tribits_repository_define_tpls()</a> for further
details and constraints.</p>
<p id="repodir-copyright-txt"><strong>&lt;repoDir&gt;/Copyright.txt</strong>: [Optional] Gives the default copyright and
license declaration for all of the software in the TriBITS repository
directory <code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;/</span></code>.  This file is read into a string and then used to
configure the repository’s version header file (see <a class="reference internal" href="#project-and-repository-versioning-and-release-mode">Project and Repository
Versioning and Release Mode</a>).  Even if a repository version header file is
not produced, it is a good idea for every TriBITS repository to define this
file, just for legal purposes.  For a good open-source license, one should
consider copying the <code class="docutils literal notranslate"><span class="pre">TriBITS/Copyright.txt</span></code> file which is a simple 3-clause
BSD-like license like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># @HEADER</span>
<span class="c1"># ************************************************************************</span>
<span class="c1">#</span>
<span class="c1">#            TriBITS: Tribal Build, Integrate, and Test System</span>
<span class="c1">#                    Copyright 2013 Sandia Corporation</span>
<span class="c1">#</span>
<span class="c1"># Under the terms of Contract DE-AC04-94AL85000 with Sandia Corporation,</span>
<span class="c1"># the U.S. Government retains certain rights in this software.</span>
<span class="c1">#</span>
<span class="c1"># Redistribution and use in source and binary forms, with or without</span>
<span class="c1"># modification, are permitted provided that the following conditions are</span>
<span class="c1"># met:</span>
<span class="c1">#</span>
<span class="c1"># 1. Redistributions of source code must retain the above copyright</span>
<span class="c1"># notice, this list of conditions and the following disclaimer.</span>
<span class="c1">#</span>
<span class="c1"># 2. Redistributions in binary form must reproduce the above copyright</span>
<span class="c1"># notice, this list of conditions and the following disclaimer in the</span>
<span class="c1"># documentation and/or other materials provided with the distribution.</span>
<span class="c1">#</span>
<span class="c1"># 3. Neither the name of the Corporation nor the names of the</span>
<span class="c1"># contributors may be used to endorse or promote products derived from</span>
<span class="c1"># this software without specific prior written permission.</span>
<span class="c1">#</span>
<span class="c1"># THIS SOFTWARE IS PROVIDED BY SANDIA CORPORATION &quot;AS IS&quot; AND ANY</span>
<span class="c1"># EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<span class="c1"># IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR</span>
<span class="c1"># PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL SANDIA CORPORATION OR THE</span>
<span class="c1"># CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span>
<span class="c1"># EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span>
<span class="c1"># PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span>
<span class="c1"># PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span>
<span class="c1"># LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span>
<span class="c1"># NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<span class="c1"># SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="c1">#</span>
<span class="c1"># ************************************************************************</span>
<span class="c1"># @HEADER</span>
</pre></div>
</div>
<p id="repodir-version-cmake"><strong>&lt;repoDir&gt;/Version.cmake</strong>: [Optional] Contains version information for the
repository (and the project also if this is also the base project).  For
example, <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<code class="docutils literal notranslate"><span class="pre">Version.cmake</span></code>, this looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${REPOSITORY_NAME}_VERSION 1.1)
set(${REPOSITORY_NAME}_MAJOR_VERSION 01)
set(${REPOSITORY_NAME}_MAJOR_MINOR_VERSION 010100)
set(${REPOSITORY_NAME}_VERSION_STRING &quot;1.1 (Dev)&quot;)
set(${REPOSITORY_NAME}_ENABLE_DEVELOPMENT_MODE_DEFAULT ON) # Change to &#39;OFF&#39; for a release
</pre></div>
</div>
<p>Note that the prefix <code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}_</span></code> is used instead of hard-coding
the repository’s name to allow flexibility in what a meta-project names a
given TriBITS repository.</p>
<p>The local variables in these set statements are processed in the base project
directory’s local scope and are therefore seen by the entire CMake project.
When this file is read in repository mode, the variable
<code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}_ENABLE_DEVELOPMENT_MODE_DEFAULT</span></code> is ignored.</p>
<p id="repodir-cmake-repositorydependenciessetup-cmake"><strong>&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</strong>: [Optional] If present,
this file is included a single time as part of the generation of the project
dependency data-structure (see <a class="reference internal" href="#reduced-package-dependency-processing">Reduced Package Dependency Processing</a>).  It
gets included in the order listed in <a class="reference internal" href="#project-name-all-repositories">${PROJECT_NAME}_ALL_REPOSITORIES</a>.  Any
local variables set in this file have project-wide scope.  The primary purpose
for this file is to set variables that will impact the processing of project’s
package’s <code class="docutils literal notranslate"><span class="pre">Dependencies.cmake</span></code> files and take care of other enable/disable
issues that are not otherwise cleanly handled by the TriBITS system
automatically.</p>
<p>The typical usage of this file is to set the default CDash email address for
all of the defined packages (see <a class="reference internal" href="#cdash-regression-email-addresses">CDash regression email addresses</a>).  For
example, to set the default email address for all of the packages in this
repository, one would set in this file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set_default(${REPOSITORY_NAME}_REPOSITORY_MASTER_EMAIL_ADDRESS
    repox-regressions@somemailserver.org)
</pre></div>
</div>
<p>Note that the prefix <code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}_</span></code> is used instead of hard-coding
the repo name to allow greater flexibility in how meta-projects refer to this
TriBITS repo.</p>
<p id="repodir-cmake-callbacksetupextraoptions-cmake"><strong>&lt;repoDir&gt;/cmake/CallbackSetupExtraOptions.cmake</strong>: [Optional] If defined,
this file is processed (included) for each repo in order right after the basic
TriBITS options are defined in the macro
<code class="docutils literal notranslate"><span class="pre">tribits_define_global_options_and_define_extra_repos()</span></code>.  This file must
define the macro <code class="docutils literal notranslate"><span class="pre">tribits_repository_setup_extra_options()</span></code> which is then
called by the TriBITS system.  This file is only processed when doing a basic
configuration of the project and <strong>not</strong> when it is just building up the
dependency data-structures (i.e. it is <strong>not</strong> processed in the <a class="reference internal" href="#reduced-package-dependency-processing">Reduced
Package Dependency Processing</a>).  Any local variables set have project-wide
scope.</p>
<p>A few additional variables are defined by the time this file is processed and
can be used in the logic in these files.  Some of the variables that should
already be defined (in addition to all of the basic user TriBITS cache
variables set in <code class="docutils literal notranslate"><span class="pre">tribits_define_global_options_and_define_extra_repos()</span></code>)
include <code class="docutils literal notranslate"><span class="pre">CMAKE_HOST_SYSTEM_NAME</span></code>, <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_HOSTNAME</span></code>, and
<code class="docutils literal notranslate"><span class="pre">PYTHON_EXECUTABLE</span></code> (see <a class="reference internal" href="#python-support">Python Support</a>).  The types of commands and
logic to put in this file include:</p>
<ul class="simple">
<li><p>Setting additional user cache variable options that are used by multiple
packages in the TriBITS Repository.  For example, Trilinos defines a
<code class="docutils literal notranslate"><span class="pre">Trilinos_DATA_DIR</span></code> user cache variable that several Trilinos packages use
to get extra test data to define extra tests.</p></li>
<li><p>Disabling packages in the TriBITS Repository when conditions will not allow
them to be enabled.  For example, Trilinos disables the package
<code class="docutils literal notranslate"><span class="pre">ForTrilinos</span></code> when <code class="docutils literal notranslate"><span class="pre">Fortran</span></code> is disabled and disables the package
<code class="docutils literal notranslate"><span class="pre">PyTrilinos</span></code> when Python support is disabled.</p></li>
</ul>
<p>An example of this file is:</p>
<blockquote>
<div><p><a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<code class="docutils literal notranslate"><span class="pre">/cmake/CallbackSetupExtraOptions.cmake</span></code></p>
</div></blockquote>
<p>which currently looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>macro(TRIBITS_REPOSITORY_SETUP_EXTRA_OPTIONS)

  assert_defined(${PROJECT_NAME}_ENABLE_INSTALL_CMAKE_CONFIG_FILES)

  if (${PROJECT_NAME}_ENABLE_INSTALL_CMAKE_CONFIG_FILES)
    message(
      &quot;\n***&quot;
      &quot;\n*** NOTE: Setting ${PROJECT_NAME}_ENABLE_WrapExternal=OFF&quot;
      &quot; because ${PROJECT_NAME}_ENABLE_INSTALL_CMAKE_CONFIG_FILES=&#39;${${PROJECT_NAME}_ENABLE_INSTALL_CMAKE_CONFIG_FILES}&#39;!&quot;
      &quot;\n***\n&quot;
      )
    set(${PROJECT_NAME}_ENABLE_WrapExternal OFF)
  endif()

  if (&quot;${PYTHON_EXECUTABLE}&quot; STREQUAL &quot;&quot;)
    message(
      &quot;\n***&quot;
      &quot;\n*** NOTE: Setting ${PROJECT_NAME}_ENABLE_WrapExternal=OFF&quot;
      &quot; because PYTHON_EXECUTABLE=&#39;&#39;!&quot;
      &quot;\n***\n&quot;
      )
    set(${PROJECT_NAME}_ENABLE_WrapExternal OFF)
  endif()

  assert_defined(${PROJECT_NAME}_ENABLE_Fortran)

  if (NOT ${PROJECT_NAME}_ENABLE_Fortran)
    message(
      &quot;\n***&quot;
      &quot;\n*** NOTE: Setting ${PROJECT_NAME}_ENABLE_MixedLang=OFF&quot;
      &quot; because ${PROJECT_NAME}_ENABLE_Fortran=&#39;${${PROJECT_NAME}_ENABLE_Fortran}&#39;!&quot;
      &quot;\n***\n&quot;
      )
    set(${PROJECT_NAME}_ENABLE_MixedLang OFF)
  endif()

endmacro()
</pre></div>
</div>
<p id="repodir-cmake-callbackdefinerepositorypackaging-cmake"><strong>&lt;repoDir&gt;/cmake/CallbackDefineRepositoryPackaging.cmake</strong>: [Optional] If
this file exists, then it defines extra CPack-related options that are
specific to this TriBITS Repository.  This file must define the macro
<code class="docutils literal notranslate"><span class="pre">tribits_repository_define_packaging()</span></code> which is called by TriBITS.  This
file is processed as the top project-level scope so any local variables set
have project-wide effect.  This file is processed after the project’s
<a class="reference internal" href="#projectdir-cmake-callbackdefineprojectpackaging-cmake">&lt;projectDir&gt;/cmake/CallbackDefineProjectPackaging.cmake</a> file so any project
CPACK variables are defined for the repository-level options and commands are
created.  This file typically just sets extra excludes to remove files from
the tarball.  The file:</p>
<blockquote>
<div><p><a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<code class="docutils literal notranslate"><span class="pre">cmake/CallbackDefineRepositoryPackaging.cmake</span></code></p>
</div></blockquote>
<p>provides a good example which is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>macro(TRIBITS_REPOSITORY_DEFINE_PACKAGING)

  assert_defined(${REPOSITORY_NAME}_SOURCE_DIR)
  append_set(CPACK_SOURCE_IGNORE_FILES
    &quot;${${REPOSITORY_NAME}_SOURCE_DIR}/cmake/ctest/&quot;
    )

endmacro()
</pre></div>
</div>
<p>As shown in the above example, it is important to prefix the excluded files
and directories with the repository base directory
<code class="docutils literal notranslate"><span class="pre">${${REPOSITORY_NAME}_SOURCE_DIR}/</span></code> since these are interpreted by CPack as
regular-expressions.</p>
</section>
<section id="tribits-repository-core-variables">
<h4><a class="toc-backref" href="#id16">TriBITS Repository Core Variables</a><a class="headerlink" href="#tribits-repository-core-variables" title="Permalink to this heading"></a></h4>
<p>The following temporary local variables are defined automatically by TriBITS
before processing a given TriBITS repository’s files
(e.g. <code class="docutils literal notranslate"><span class="pre">PackagesList.cmake</span></code>, <code class="docutils literal notranslate"><span class="pre">TPLsList.cmake</span></code>, etc.):</p>
<blockquote>
<div><p id="repository-name"><code class="docutils literal notranslate"><span class="pre">REPOSITORY_NAME</span></code></p>
<blockquote>
<div><p>The name of the current TriBITS repository.  This name will be the
repository name listed in
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file or if this
repository directory is the project base directory, <code class="docutils literal notranslate"><span class="pre">REPOSITORY_NAME</span></code>
will be set to <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">REPOSITORY_DIR</span></code></p>
<blockquote>
<div><p>Path of the current Repository <em>relative</em> to the Project’s base source
directory <a class="reference internal" href="#project-name-source-dir">${PROJECT_NAME}_SOURCE_DIR</a>..  This is typically just the
repository name but can be an arbitrary directory if specified through the
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file.</p>
</div></blockquote>
</div></blockquote>
<p>The following project-scope (non-cache) local variables are set once the list
of TriBITS repositories is processed and before any of the repository’s files
are processed:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}_SOURCE_DIR</span></code></p>
<blockquote>
<div><p>The absolute path to the base of a given TriBITS Repository’s source
directory.  CMake code, for example in a packages’ <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>
file, typically refers to this by the raw name like <code class="docutils literal notranslate"><span class="pre">RepoX_SOURCE_DIR</span></code>.
This makes such CMake code independent of where the various TriBITS repos
are in relation to each other or the TriBITS Project (but does hard-code
the repository name which is not ideal).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}_BINARY_DIR</span></code></p>
<blockquote>
<div><p>The absolute path to the base of a given TriBITS Repository’s binary
directory.  CMake code, for example in packages, refer to this by the raw
name like <code class="docutils literal notranslate"><span class="pre">RepoX_SOURCE_DIR</span></code>.  This makes such CMake code independent of
where the various TriBITS repos are in relation to each other or the
Project.</p>
</div></blockquote>
</div></blockquote>
<p>The following project-level local variables can be defined by the project or
the user to help define the what packages from the repository
<code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}</span></code> contribute to the primary meta-project packages (PMPP):</p>
<blockquote>
<div><p id="repository-name-no-primary-meta-project-packages"><code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}_NO_PRIMARY_META_PROJECT_PACKAGES</span></code></p>
<blockquote>
<div><p>If set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then the package’s in the TriBITS repository are not
considered to be part of the primary meta-project packages.  This affects
what packages get enabled by default when enabling all packages with
setting <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_ALL_PACKAGES=ON</span></code> and what tests and
examples get enabled by default when setting
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_TESTS=ON</span></code>.  See <a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency Handling
Behaviors</a> for more details.</p>
</div></blockquote>
<p id="repository-name-no-primary-meta-project-packages-except"><code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}_NO_PRIMARY_META_PROJECT_PACKAGES_EXCEPT</span></code></p>
<blockquote>
<div><p>When the above variable is set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, this variable is read by
TriBITS to find the list of TriBITS packages selected packages in the
repository <code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}</span></code> which are considered to be part of the
set of the project’s primary meta-project package when the above variable
is set to <code class="docutils literal notranslate"><span class="pre">ON</span></code>.  NOTE: It is not necessary to list all of the
subpackages in a given parent package.  Only the parent package need be
listed and it will be equivalent to listing all of the subpackages.  See
<a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency Handling Behaviors</a> for more details.</p>
</div></blockquote>
</div></blockquote>
<p>The above primary meta-project variables should be set in the meta-project’s
<a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file so that they will be set in all
situations.</p>
</section>
</section>
<section id="tribits-package">
<h3><a class="toc-backref" href="#id17">TriBITS Package</a><a class="headerlink" href="#tribits-package" title="Permalink to this heading"></a></h3>
<p>A TriBITS Package:</p>
<ul class="simple">
<li><p>Is the fundamental TriBITS structural unit of software partitioning and
aggregation.</p></li>
<li><p>Must have a unique package name (<code class="docutils literal notranslate"><span class="pre">PACKAGE_NAME</span></code>) that is globally unique
(see <a class="reference internal" href="#globally-unique-tribits-package-names">Globally unique TriBITS package names</a>).</p></li>
<li><p>Typically defines a set of libraries and/or header files and/or executables
and/or tests with CMake build targets for building these for which TriBITS
exports the list of include directories, libraries, and targets that are
created (along with CMake dependencies).</p></li>
<li><p>Is declared in its parent repository’s <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> file.</p></li>
<li><p>Declares dependencies on <a class="reference internal" href="#upstream">upstream</a> TPLs and/or other SE packages by just
naming the dependencies in the file
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a>.</p></li>
<li><p>Can optionally have subpackages listed in the argument
<a class="reference internal" href="#subpackages-dirs-classifications-optreqs">SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS</a> to the macro call
<a class="reference internal" href="#tribits-package-define-dependencies">tribits_package_define_dependencies()</a>.</p></li>
<li><p>Is the unit of testing as driven by <a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a> and displayed
on CDash.</p></li>
</ul>
<p id="globally-unique-tribits-package-names"><strong>WARNING:</strong> As noted above, one must be very careful to pick <strong>globally
unique TriBITS package names</strong>.  This name must be unique not only within its
defined TriBITS repository but also across all SE packages in all TriBITS
repositories that ever might be cobbled together into a single TriBITS (meta)
project!  Choosing a good package name is the single most important decision
when it comes to defining a TriBITS package.  One must be careful <strong>not</strong> to
pick names like “Debug” or “StandardUtils” that have a high chance of clashing
with poorly named TriBITS packages from other TriBITS repositories.</p>
<p>For more details on the definition of a TriBITS Package (or subpackage), see:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#tribits-package-core-files">TriBITS Package Core Files</a></p></li>
<li><p><a class="reference internal" href="#tribits-package-core-variables">TriBITS Package Core Variables</a></p></li>
</ul>
<section id="tribits-package-core-files">
<h4><a class="toc-backref" href="#id18">TriBITS Package Core Files</a><a class="headerlink" href="#tribits-package-core-files" title="Permalink to this heading"></a></h4>
<p>The core files that make up a <em>TriBITS Package</em> (where <code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;</span> <span class="pre">=</span>
<span class="pre">${${PACKAGE_NAME}_SOURCE_DIR}</span></code>) are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">packageDir</span><span class="o">&gt;/</span>
  <span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>  <span class="c1"># Only processed if the package is enabled</span>
  <span class="n">cmake</span><span class="o">/</span>
    <span class="n">Dependencies</span><span class="o">.</span><span class="n">cmake</span>  <span class="c1"># Always processed if its repo is processed</span>
    <span class="o">&lt;</span><span class="n">packageName</span><span class="o">&gt;</span><span class="n">_config</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="ow">in</span>  <span class="c1"># [Optional], name is not fixed</span>
</pre></div>
</div>
<p>There are a few simple rules for the location and the contents of the
<code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;/</span></code> directory:</p>
<ul class="simple">
<li><p>The directory <code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;/</span></code> must not be a subdirectory of the package
directory of any other SE package (e.g. not <code class="docutils literal notranslate"><span class="pre">pkga/pkgb</span></code>).</p></li>
<li><p>All of the source files, test files, etc. for the package should be included
under <code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;/</span></code>.</p></li>
</ul>
<p>The above rules are not needed for basic building and testing but are needed
for extended features like automatically detecting when a package has changed
by looking at what files have changed (see <a class="reference internal" href="#pre-push-testing-using-checkin-test-py">Pre-push Testing using
checkin-test.py</a>) and for creating source tarballs correctly (see <a class="reference internal" href="#creating-source-distributions">Creating
Source Distributions</a>).  Therefore, it would be wise to abide by the above
rules when defining packages.</p>
<p>The following TriBITS Package files are documented in more detail below:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a></p></li>
<li><p><a class="reference internal" href="#packagedir-cmake-packagename-config-h-in">&lt;packageDir&gt;/cmake/&lt;packageName&gt;_config.h.in</a></p></li>
<li><p><a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a></p></li>
</ul>
<p id="packagedir-cmake-dependencies-cmake"><strong>&lt;packageDir&gt;/cmake/Dependencies.cmake</strong>: [Required] Defines the dependencies
for a given TriBITS (SE) package using the macro
<a class="reference internal" href="#tribits-package-define-dependencies">tribits_package_define_dependencies()</a>.  This file is processed at the
top-level project scope (using an <code class="docutils literal notranslate"><span class="pre">include()</span></code>) so any local variables set
will be seen by the entire project.  This file is always processed, including
when just building the project’s dependency data-structure (see <a class="reference internal" href="#reduced-package-dependency-processing">Reduced
Package Dependency Processing</a>).</p>
<p>An example of a <code class="docutils literal notranslate"><span class="pre">Dependencies.cmake</span></code> file for a package with optional and
required dependencies is for the mock <code class="docutils literal notranslate"><span class="pre">Panzer</span></code> package in <a class="reference internal" href="#mocktrilinos">MockTrilinos</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_package_define_dependencies</span><span class="p">(</span>
  <span class="n">LIB_REQUIRED_PACKAGES</span> <span class="n">Teuchos</span> <span class="n">Sacado</span> <span class="n">Phalanx</span> <span class="n">Intrepid</span> <span class="n">Thyra</span>
    <span class="n">Tpetra</span> <span class="n">Epetra</span> <span class="n">EpetraExt</span>
  <span class="n">LIB_OPTIONAL_PACKAGES</span> <span class="n">Stokhos</span>
  <span class="n">TEST_OPTIONAL_PACKAGES</span> <span class="n">Stratimikos</span>
  <span class="n">LIB_REQUIRED_TPLS</span> <span class="n">MPI</span> <span class="n">Boost</span>
  <span class="p">)</span>
</pre></div>
</div>
<p id="with-subpackages-cmake-dependencies-cmake">An example of a package with subpackages is <code class="docutils literal notranslate"><span class="pre">WithSubpackages</span></code> which has the
dependencies file:</p>
<blockquote>
<div><p><a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<code class="docutils literal notranslate"><span class="pre">packages/with_subpackages/cmake/Dependencies.cmake</span></code></p>
</div></blockquote>
<p>which is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_package_define_dependencies</span><span class="p">(</span>
  <span class="n">SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS</span>
    <span class="n">A</span>   <span class="n">a</span>   <span class="n">PT</span>  <span class="n">REQUIRED</span>
    <span class="n">B</span>   <span class="n">b</span>   <span class="n">ST</span>  <span class="n">OPTIONAL</span>
    <span class="n">C</span>   <span class="n">c</span>   <span class="n">ST</span>  <span class="n">OPTIONAL</span>
  <span class="n">REGRESSION_EMAIL_LIST</span> <span class="n">with_packages</span><span class="o">-</span><span class="n">regressions</span><span class="nd">@someurl</span><span class="o">.</span><span class="n">none</span>
  <span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">WithSubpackages</span></code> defines three subpackages which creates three new SE
packages with names <code class="docutils literal notranslate"><span class="pre">WithSubpackagesA</span></code>, <code class="docutils literal notranslate"><span class="pre">WithSubpackagesB</span></code>, and
<code class="docutils literal notranslate"><span class="pre">WithSubpackagesC</span></code>.</p>
<p>if a TriBITS Package or Subpackage has no dependencies, it still has to call
<code class="docutils literal notranslate"><span class="pre">tribits_package_define_dependencies()</span></code> but it is called with no arguments
such as with:</p>
<blockquote>
<div><p><a class="reference internal" href="#tribitshelloworld">TribitsHelloWorld</a>/<code class="docutils literal notranslate"><span class="pre">hello_world/cmake/Dependencies.cmake:</span></code></p>
</div></blockquote>
<p>which contains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_package_define_dependencies</span><span class="p">()</span>
</pre></div>
</div>
<p>Other TriBITS macros/functions that can be called in this file include
<a class="reference internal" href="#tribits-tpl-tentatively-enable">tribits_tpl_tentatively_enable()</a> and
<a class="reference internal" href="#tribits-allow-missing-external-packages">tribits_allow_missing_external_packages()</a>.</p>
<p id="packagedir-cmake-packagename-config-h-in"><span id="packagename-config-h-in"></span><strong>&lt;packageDir&gt;/cmake/&lt;packageName&gt;_config.h.in</strong>: [Optional] The package’s
configured header file.  This file will contain placeholders for variables
that will be substitute at configure time with <a class="reference internal" href="#tribits-configure-file">tribits_configure_file()</a>.
This includes usage of <code class="docutils literal notranslate"><span class="pre">#cmakedefine</span> <span class="pre">&lt;varName&gt;</span></code> and other standard CMake
file configuration features used by CMake’s <code class="docutils literal notranslate"><span class="pre">configure_file()</span></code> command.</p>
<p>An example of this file is shown in:</p>
<blockquote>
<div><p><a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<code class="docutils literal notranslate"><span class="pre">packages/simple_cxx/cmake/SimpleCxx_config.h.in</span></code></p>
</div></blockquote>
<p>which is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#ifndef SIMPLECXX_CONFIG_H</span>
<span class="c1">#define SIMPLECXX_CONFIG_H</span>

<span class="c1">#cmakedefine HAVE_SIMPLECXX___INT64</span>

<span class="c1">#cmakedefine HAVE_SIMPLECXX_DEBUG</span>
<span class="c1">#cmakedefine HAVE_SIMPLECXX_SIMPLETPL</span>

<span class="nd">@SIMPLECXX_DEPRECATED_DECLARATIONS</span><span class="o">@</span>

<span class="c1">#endif /** SIMPLECXX_CONFIG_H **/</span>
</pre></div>
</div>
<p>The variable <code class="docutils literal notranslate"><span class="pre">HAVE_SIMPLECXX___INT64</span></code> is set up in the base file
<code class="docutils literal notranslate"><span class="pre">SimpleCxx/CMakeLists.txt</span></code> (see <a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> below).  For
an explanation of <code class="docutils literal notranslate"><span class="pre">HAVE_SIMPLECXX_DEBUG</span></code>, see <a class="reference internal" href="#tribits-add-debug-option">tribits_add_debug_option()</a>.
For an explanation of <code class="docutils literal notranslate"><span class="pre">HAVE_SIMPLECXX_SIMPLETPL</span></code>, see <a class="reference internal" href="#how-to-add-a-new-tribits-tpl-dependency">How to add a new
TriBITS TPL dependency</a>.  For an explanation of
<code class="docutils literal notranslate"><span class="pre">&#64;SIMPLECXX_DEPRECATED_DECLARATIONS&#64;</span></code>, see <a class="reference internal" href="#setting-up-support-for-deprecated-code-handling">Setting up support for
deprecated code handling</a>.</p>
<p><strong>NOTE:</strong> The file name <code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;_config.h.in</span></code> is not at all fixed and
the package can call this file anything it wants.  Also, a package can
configure multiple header files in different directories for different
purposes using <a class="reference internal" href="#tribits-configure-file">tribits_configure_file()</a> or even calls to the raw CMake
function <a class="reference external" href="https://cmake.org/cmake/help/v3.17/command/configure_file.html">configure_file()</a>.</p>
<p id="packagedir-cmakelists-txt"><strong>&lt;packageDir&gt;/CMakeLists.txt</strong>: [Required] The package’s top-level
<code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file that defines the libraries, include directories, and
contains the tests for the package.</p>
<p>The basic structure of this file for a <strong>package without subpackages</strong> is
shown in:</p>
<blockquote>
<div><p><a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<code class="docutils literal notranslate"><span class="pre">packages/simple_cxx/CMakeLists.txt</span></code></p>
</div></blockquote>
<p>which is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># A) Define the package</span>
<span class="c1">#</span>
<span class="n">tribits_package</span><span class="p">(</span> <span class="n">SimpleCxx</span>  <span class="n">ENABLE_SHADOWING_WARNINGS</span>  <span class="n">CLEANED</span> <span class="p">)</span>

<span class="c1">#</span>
<span class="c1"># B) Platform-specific checks</span>
<span class="c1">#</span>
<span class="n">include</span><span class="p">(</span><span class="n">CheckFor__int64</span><span class="p">)</span>
<span class="n">check_for___int64</span><span class="p">(</span><span class="n">HAVE_SIMPLECXX___INT64</span><span class="p">)</span>

<span class="c1">#</span>
<span class="c1"># C) Set up package-specific options</span>
<span class="c1">#</span>
<span class="n">tribits_add_debug_option</span><span class="p">()</span>
<span class="n">tribits_add_show_deprecated_warnings_option</span><span class="p">()</span>

<span class="c1">#</span>
<span class="c1"># D) Add the libraries, tests, and examples</span>
<span class="c1">#</span>
<span class="n">add_subdirectory</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
<span class="n">tribits_add_test_directories</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>

<span class="c1"># Set a variable that will be used in downstream packages</span>

<span class="k">if</span> <span class="p">(</span><span class="n">SimpleCxx_ENABLE_SimpleTpl</span><span class="p">)</span>
  <span class="nb">set</span><span class="p">(</span><span class="n">simpletplText</span> <span class="s2">&quot;simpletpl &quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">()</span>
  <span class="nb">set</span><span class="p">(</span><span class="n">simpletplText</span><span class="p">)</span>
<span class="n">endif</span><span class="p">()</span>

<span class="n">global_set</span><span class="p">(</span><span class="n">EXPECTED_SIMPLECXX_AND_DEPS</span>
  <span class="s2">&quot;SimpleCxx $</span><span class="si">{simpletplText}</span><span class="s2">headeronlytpl&quot;</span><span class="p">)</span>

<span class="c1">#</span>
<span class="c1"># E) Do standard post processing</span>
<span class="c1">#</span>
<span class="n">tribits_package_postprocess</span><span class="p">()</span>
</pre></div>
</div>
<p>The first command at the top of the file is a call to <a class="reference internal" href="#id1">tribits_package()</a>
which takes the package name (<code class="docutils literal notranslate"><span class="pre">SimpleCxx</span></code> in this case) in addition to a few
other options.  While TriBITS obviously already knows the package name (since
it read it from the <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> file), the purpose for
repeating it in this call is as documentation for the developer’s sake (and
this name is checked against the expected package name).  Then a set of
configure-time tests are typically performed (if the package needs any of
these).  In this example, the existence of the C++ <code class="docutils literal notranslate"><span class="pre">__int64</span></code> data-type is
checked using the module <code class="docutils literal notranslate"><span class="pre">CheckFor__int64.cmake</span></code> (which is in the <code class="docutils literal notranslate"><span class="pre">cmake/</span></code>
directory of this package.  (CMake has great support <a class="reference internal" href="#configure-time-system-tests">Configure-time System
Tests</a>.)  This is followed by package-specific options.  In this case, the
standard TriBITS options for debug checking and deprecated warnings are added
using the standard macros <a class="reference internal" href="#tribits-add-debug-option">tribits_add_debug_option()</a> and
<a class="reference internal" href="#tribits-add-show-deprecated-warnings-option">tribits_add_show_deprecated_warnings_option()</a>.  After all of this up-front
stuff is complete (which will be present in any moderately complex
CMake-configured project) the source and the test sub-directories are added
that actually define the library and the tests.  In this case, the standard
<a class="reference internal" href="#tribits-add-test-directories">tribits_add_test_directories()</a> macro is used which only conditionally adds
the tests for the package.</p>
<p>The final command in the package’s base <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file must always be
<a class="reference internal" href="#tribits-package-postprocess">tribits_package_postprocess()</a>.  This is needed in order to perform some
necessary post-processing by TriBITS.</p>
<p>It is also possible for the package’s top-level <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> to be the
only <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file for a package.  Such an example can be seen in the
example project <a class="reference internal" href="#tribitshelloworld">TribitsHelloWorld</a> in the <code class="docutils literal notranslate"><span class="pre">HelloWorld</span></code> package.</p>
<p>When a TriBITS package is broken up into subpackages (see <a class="reference internal" href="#tribits-subpackage">TriBITS
Subpackage</a>), its <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file looks a little different from a
package with no subpackages as shown above.  The basic structure of this file
for a <strong>package with subpackages</strong> is shown in:</p>
<blockquote>
<div><p><a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<code class="docutils literal notranslate"><span class="pre">packages/with_subpackages/CMakeLists.txt</span></code></p>
</div></blockquote>
<p>which contains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_package_decl</span><span class="p">(</span><span class="n">WithSubpackages</span><span class="p">)</span>

<span class="n">tribits_add_debug_option</span><span class="p">()</span>

<span class="n">tribits_process_subpackages</span><span class="p">()</span>

<span class="n">tribits_exclude_files</span><span class="p">(</span>
  <span class="n">b</span><span class="o">/</span><span class="n">ExcludeFromRelease</span><span class="o">.</span><span class="n">txt</span>
  <span class="n">b</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">AlsoExcludeFromTarball</span><span class="o">.</span><span class="n">txt</span>
  <span class="p">)</span>

<span class="n">tribits_package_def</span><span class="p">()</span>

<span class="n">tribits_package_postprocess</span><span class="p">()</span>
</pre></div>
</div>
<p>What is different about <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> files for packages without
subpackages is that the <a class="reference internal" href="#id1">tribits_package()</a> command is broken up into two
parts <a class="reference internal" href="#tribits-package-decl">tribits_package_decl()</a> and <a class="reference internal" href="#tribits-package-def">tribits_package_def()</a>.  In between
these two commands, the parent package can define the common package options
and then calls the command <a class="reference internal" href="#tribits-process-subpackages">tribits_process_subpackages()</a> which fully
processes the packages.  If the parent package has libraries and/or
tests/example of its own, it can define those after calling
<a class="reference internal" href="#tribits-package-def">tribits_package_def()</a>, just like with a regular package.  However, it is
rare for a package broken up into subpackages to have its own libraries and/or
tests and examples.  As always, the final command called inside of a package’s
base <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file is <a class="reference internal" href="#tribits-package-postprocess">tribits_package_postprocess()</a>.</p>
<p>NOTE: The package’s base <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file only gets processed if the
package is actually enabled
(i.e. <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_${PACKAGE_NAME}=ON</span></code>).  This is an important
design feature of TriBITS in that the contents of non-enabled packages can’t
damage the configure, build, and test of the enabled packages based on errors
in non-enabled packages.  This is critical to allow experimental <a class="reference internal" href="#ex">EX</a>
test-group packages and lower-maturity packages to exist in the same source
repositories safely with higher-maturity and more important packages.</p>
</section>
<section id="tribits-package-core-variables">
<h4><a class="toc-backref" href="#id19">TriBITS Package Core Variables</a><a class="headerlink" href="#tribits-package-core-variables" title="Permalink to this heading"></a></h4>
<p>A packages’ core variables are broken down into the following categories:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#tribits-package-local-variables">TriBITS Package Local Variables</a></p></li>
<li><p><a class="reference internal" href="#tribits-package-top-level-local-variables">TriBITS Package Top-Level Local Variables</a></p></li>
<li><p><a class="reference internal" href="#tribits-package-cache-variables">TriBITS Package Cache Variables</a></p></li>
<li><p><a class="reference internal" href="#tribits-package-optional-dependency-macro-variables">TriBITS Package Optional Dependency Macro Variables</a></p></li>
</ul>
<p id="tribits-package-local-variables">The following locally scoped <strong>TriBITS Package Local Variables</strong> are defined
when the files for a given TriBITS Package (or any SE package for that matter)
are being processed:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">PACKAGE_NAME</span></code></p>
<blockquote>
<div><p>The name of the current TriBITS SE package.  This is set automatically by
TriBITS before the packages’ <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file is processed.
<strong>WARNING:</strong> This name must be globally unique across the entire project
(see <a class="reference internal" href="#globally-unique-tribits-package-names">Globally unique TriBITS package names</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">PACKAGE_SOURCE_DIR</span></code></p>
<blockquote>
<div><p>The absolute path to the package’s base source directory.    This is
set automatically by TriBITS in the macro <a class="reference internal" href="#id1">tribits_package()</a>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">PACKAGE_BINARY_DIR</span></code></p>
<blockquote>
<div><p>The absolute path to the package’s base binary/build directory.  This is
set automatically by TriBITS in the macro <a class="reference internal" href="#id1">tribits_package()</a>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">PACKAGE_NAME_UC</span></code></p>
<blockquote>
<div><p>This is set to the upper-case version of <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code>.  This is set
automatically by TriBITS in the macro <a class="reference internal" href="#id1">tribits_package()</a>.</p>
</div></blockquote>
</div></blockquote>
<p id="tribits-package-top-level-local-variables">Once all of the TriBITS SE package’s <code class="docutils literal notranslate"><span class="pre">Dependencies.cmake</span></code> files have been
processed, the following <strong>TriBITS Package Top-Level Local Variables</strong> are
defined:</p>
<blockquote>
<div><p id="package-name-source-dir"><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_SOURCE_DIR</span></code></p>
<blockquote>
<div><p>The absolute path to the package’s base source directory.  CMake code, for
example in other packages, refer to this by the raw name like
<code class="docutils literal notranslate"><span class="pre">PackageX_SOURCE_DIR</span></code>.  This makes such CMake code independent of where
the package is in relation to other packages.  NOTE: This variable is
defined for all declared packages that exist, independent of whether they
are enabled or not.  This variable is set as soon as it is known if the
given package exists or not.</p>
</div></blockquote>
<p id="package-name-rel-source-dir"><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_REL_SOURCE_DIR</span></code></p>
<blockquote>
<div><p>The <strong>relative path</strong> to the package’s base source directory, relative to
the projects base source directory <a class="reference internal" href="#project-name-source-dir">${PROJECT_NAME}_SOURCE_DIR</a>.  This is
used in various contexts such as processing the packages
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file and generating the projects
<a class="reference internal" href="#project-packagedependencies-xml">&lt;Project&gt;PackageDependencies.xml</a> file where relative paths are needed.</p>
</div></blockquote>
<p id="package-name-binary-dir"><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_BINARY_DIR</span></code></p>
<blockquote>
<div><p>The absolute path to the package’s base binary directory.  CMake code, for
example in other packages, refer to this by the raw name like
<code class="docutils literal notranslate"><span class="pre">PackageX_BINARY_DIR</span></code>.  This makes such CMake code independent of where
the package is in relation to other packages.  NOTE: This variable is
<strong>only</strong> defined if the package is actually enabled!</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_PARENT_REPOSITORY</span></code></p>
<blockquote>
<div><p>The name of the package’s parent repository.  This can be used by a
package to access information about its parent repository.  For example,
the variable <code class="docutils literal notranslate"><span class="pre">${${PACKAGE_NAME}_PARENT_REPOSITORY}_SOURCE_DIR</span></code> can be
dereferenced and read of needed (but it is not recommended that packages
be aware of their parent repository in general)..</p>
</div></blockquote>
<p id="package-name-testgroup"><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_TESTGROUP</span></code></p>
<blockquote>
<div><p>Defines the <a class="reference internal" href="#se-package-test-group">SE Package Test Group</a> for the package.  This determines in
what contexts the package is enabled or not for testing-related purposes
(see <a class="reference internal" href="#nested-layers-of-tribits-project-testing">Nested Layers of TriBITS Project Testing</a>)</p>
</div></blockquote>
</div></blockquote>
<p id="tribits-package-cache-variables">In addition, the following user-settable <strong>TriBITS Package Cache Variables</strong> are
defined before a (SE) Package’s <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file is processed:</p>
<blockquote>
<div><p id="project-name-enable-package-name"><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_${PACKAGE_NAME}</span></code></p>
<blockquote>
<div><p>Set to <code class="docutils literal notranslate"><span class="pre">ON</span></code> if the package is enabled and is to be processed or will be
set to <code class="docutils literal notranslate"><span class="pre">ON</span></code> or <code class="docutils literal notranslate"><span class="pre">OFF</span></code> automatically during enable/disable logic.  For a
parent package that is not directly enabled but were one of its
subpackages is enabled, this will get set to <code class="docutils literal notranslate"><span class="pre">ON</span></code> (but that is not the
same as the parent package being directly enabled and therefore does not
imply that all of the required subpackages will be enabled, only that the
parent package will be processed).</p>
</div></blockquote>
<p id="package-name-enable-optional-dep-package-name"><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_ENABLE_${OPTIONAL_DEP_PACKAGE_NAME}</span></code></p>
<blockquote>
<div><p>Set to <code class="docutils literal notranslate"><span class="pre">ON</span></code> if support for the optional <a class="reference internal" href="#upstream">upstream</a> dependent package
<code class="docutils literal notranslate"><span class="pre">${OPTIONAL_DEP_PACKAGE_NAME}</span></code> is enabled in package
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code>.  Here <code class="docutils literal notranslate"><span class="pre">${OPTIONAL_DEP_PACKAGE_NAME}</span></code> corresponds to
each optional upstream SE package listed in the <code class="docutils literal notranslate"><span class="pre">LIB_OPTIONAL_PACKAGES</span></code>
and <code class="docutils literal notranslate"><span class="pre">TEST_OPTIONAL_PACKAGES</span></code> arguments to the
<a class="reference internal" href="#tribits-package-define-dependencies">tribits_package_define_dependencies()</a> macro.</p>
<p><strong>NOTE:</strong> It is important that the CMake code in the package’s
<code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> files key off of this variable and <strong>not</strong> the
project-level variable
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_${OPTIONAL_DEP_PACKAGE_NAME}</span></code> because the
package-level variable
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_ENABLE_${OPTIONAL_DEP_PACKAGE_NAME}</span></code> can be explicitly
turned off by the user even through the packages <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code> and
<code class="docutils literal notranslate"><span class="pre">${OPTIONAL_DEP_PACKAGE_NAME}</span></code> are both enabled at the project level!
See <a class="reference internal" href="#support-for-optional-se-package-tpl-can-be-explicitly-disabled">Support for optional SE package/TPL can be explicitly disabled</a>.</p>
<p><strong>NOTE:</strong> This variable will also be set for required dependencies as well
to allow for uniform processing such as when looping over the items in
<a class="reference internal" href="#package-name-lib-all-dependencies">${PACKAGE_NAME}_LIB_ALL_DEPENDENCIES</a>.</p>
</div></blockquote>
<p id="package-name-enable-optional-dep-tpl-name"><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_ENABLE_${OPTIONAL_DEP_TPL_NAME}</span></code></p>
<blockquote>
<div><p>Set to <code class="docutils literal notranslate"><span class="pre">ON</span></code> if support for the optional <a class="reference internal" href="#upstream">upstream</a> dependent TPL
<code class="docutils literal notranslate"><span class="pre">${OPTIONAL_DEP_TPL_NAME}</span></code> is enabled in package <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code>.
Here <code class="docutils literal notranslate"><span class="pre">${OPTIONAL_DEP_TPL_NAME}</span></code> corresponds to each optional upstream
TPL listed in the <code class="docutils literal notranslate"><span class="pre">LIB_OPTIONAL_TPLS</span></code> and <code class="docutils literal notranslate"><span class="pre">TEST_OPTIONAL_TPLS</span></code>
arguments to the <a class="reference internal" href="#tribits-package-define-dependencies">tribits_package_define_dependencies()</a> macro.
<strong>NOTE:</strong> It is important that the CMake code in the package
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code> key off of this variable and <strong>not</strong> the global
<code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_${OPTIONAL_DEP_TPL_NAME}</span></code> variable because
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_ENABLE_${OPTIONAL_DEP_TPL_NAME}</span></code> can be explicitly
turned off by the user even through the package <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code> and
the TPL <code class="docutils literal notranslate"><span class="pre">${OPTIONAL_DEP_TPL_NAME}</span></code> are both enabled (see <a class="reference internal" href="#support-for-optional-se-package-tpl-can-be-explicitly-disabled">Support for
optional SE package/TPL can be explicitly disabled</a>).</p>
</div></blockquote>
<p id="package-name-enable-tests"><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_ENABLE_TESTS</span></code></p>
<blockquote>
<div><p>Set to <code class="docutils literal notranslate"><span class="pre">ON</span></code> if the package’s tests are to be enabled.  This will enable
a package’s tests and all of its subpackage’s tests.</p>
</div></blockquote>
<p id="package-name-enable-examples"><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_ENABLE_EXAMPLES</span></code></p>
<blockquote>
<div><p>Set to <code class="docutils literal notranslate"><span class="pre">ON</span></code> if the package’s examples are to be enabled.  This will
enable a package’s examples and all of its subpackage’s examples.</p>
</div></blockquote>
</div></blockquote>
<p>The above global cache variables can be explicitly set by the user or may be
set automatically as part of the <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package Dependencies and Enable/Disable
Logic</a>.</p>
<p id="tribits-package-optional-dependency-macro-variables">The following local <strong>TriBITS Package Optional Dependency Macro Variables</strong> are
defined in the top-level project scope before a (SE) Package’s
<code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file is processed:</p>
<blockquote>
<div><p id="have-package-name-uc-optional-dep-package-name-uc"><code class="docutils literal notranslate"><span class="pre">HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;OPTIONAL_DEP_PACKAGE_NAME_UC&gt;</span></code></p>
<blockquote>
<div><p>Set to <code class="docutils literal notranslate"><span class="pre">ON</span></code> if support for optional upstream package
<code class="docutils literal notranslate"><span class="pre">${OPTIONAL_DEP_PACKAGE}</span></code> is enabled in downstream package
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code>
(i.e. <a class="reference internal" href="#package-name-enable-optional-dep-package-name">${PACKAGE_NAME}_ENABLE_${OPTIONAL_DEP_PACKAGE_NAME}</a> = <code class="docutils literal notranslate"><span class="pre">ON</span></code>) and
is set to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> otherwise.  Here, <code class="docutils literal notranslate"><span class="pre">&lt;PACKAGE_NAME_UC&gt;</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;OPTIONAL_DEP_PACKAGE_NAME_UC&gt;</span></code> are the upper-case names for the packages
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code> and <code class="docutils literal notranslate"><span class="pre">${OPTIONAL_DEP_PACKAGE_NAME}</span></code>, respectively.
For example, if optional support for upstream package <code class="docutils literal notranslate"><span class="pre">Triutils</span></code> is
enabled in downstream package <code class="docutils literal notranslate"><span class="pre">EpetraExt</span></code> in <a class="reference internal" href="#reducedmocktrilinos">ReducedMockTrilinos</a>,
then <code class="docutils literal notranslate"><span class="pre">EpetraExt_ENABLE_TriUtils=ON</span></code> and <code class="docutils literal notranslate"><span class="pre">HAVE_EPETRAEXT_TRIUTILS=ON</span></code>.
This variable is meant to be used in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#cmakedefine HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;OPTIONAL_DEP_PACKAGE_NAME_UC&gt;</span>
</pre></div>
</div>
<p>in configured header files
(e.g. <a class="reference internal" href="#packagedir-cmake-packagename-config-h-in">&lt;packageDir&gt;/cmake/&lt;packageName&gt;_config.h.in</a>).  For example, for
the <code class="docutils literal notranslate"><span class="pre">EpetraExt</span></code> and <code class="docutils literal notranslate"><span class="pre">Triutils</span></code> example, this would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#cmakedefine HAVE_EPETRAEXT_TRIUTILS</span>
</pre></div>
</div>
</div></blockquote>
<p id="have-package-name-uc-optional-dep-tpl-name-uc"><code class="docutils literal notranslate"><span class="pre">HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;OPTIONAL_DEP_TPL_NAME_UC&gt;</span></code></p>
<blockquote>
<div><p>Set to <code class="docutils literal notranslate"><span class="pre">ON</span></code> if support for the optional TPL <code class="docutils literal notranslate"><span class="pre">${OPTIONAL_DEP_TPL_NAME}</span></code>
is enabled in downstream package <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code>
(i.e. <a class="reference internal" href="#package-name-enable-optional-dep-tpl-name">${PACKAGE_NAME}_ENABLE_${OPTIONAL_DEP_TPL_NAME}</a> = <code class="docutils literal notranslate"><span class="pre">ON</span></code>) and is
set to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> otherwise.  Here, <code class="docutils literal notranslate"><span class="pre">&lt;PACKAGE_NAME_UC&gt;</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;OPTIONAL_DEP_TPL_NAME_UC&gt;</span></code> are the upper-case names for the packages
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code> and <code class="docutils literal notranslate"><span class="pre">${OPTIONAL_DEP_TPL_NAME}</span></code>, respectively.  For
example, if optional support for the TPL <code class="docutils literal notranslate"><span class="pre">Boost</span></code> is enabled in the
package <code class="docutils literal notranslate"><span class="pre">Teuchos</span></code> in <a class="reference internal" href="#reducedmocktrilinos">ReducedMockTrilinos</a>, then
<code class="docutils literal notranslate"><span class="pre">Teuchos_ENABLE_Boost=ON</span></code> and <code class="docutils literal notranslate"><span class="pre">HAVE_TUECHOS_BOOST=ON</span></code>.  This variable
is meant to be used in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#cmakedefine HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;OPTIONAL_DEP_TPL_NAME_UC&gt;</span>
</pre></div>
</div>
<p>in configured header files
(e.g. <a class="reference internal" href="#packagedir-cmake-packagename-config-h-in">&lt;packageDir&gt;/cmake/&lt;packageName&gt;_config.h.in</a>).  For example, for
the <code class="docutils literal notranslate"><span class="pre">Teuchos</span></code> and <code class="docutils literal notranslate"><span class="pre">Boost</span></code> example, this would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#cmakedefine HAVE_TEUCHOS_BOOST</span>
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<p>Currently, a Package can refer to its containing Repository and refer to its
source and binary directories.  This is so that it can refer to
repository-level resources (e.g. like the <code class="docutils literal notranslate"><span class="pre">Trilinos_version.h</span></code> file for
Trilinos packages).  However, this may be undesirable because it will make it
hard to pull a package out of one TriBITS repository and place it in another
repository for a different use.  However, a package can indirectly refer to
its own repository without loss of generality by reading the variable
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_PARENT_REPOSITORY</span></code>.  The problem is referring to other
TriBITS repositories explicitly.</p>
</section>
</section>
<section id="tribits-subpackage">
<h3><a class="toc-backref" href="#id20">TriBITS Subpackage</a><a class="headerlink" href="#tribits-subpackage" title="Permalink to this heading"></a></h3>
<p>A TriBITS Subpackage:</p>
<ul class="simple">
<li><p>Is a compartmentalization of a parent <a class="reference internal" href="#tribits-package">TriBITS Package</a> according to
<a class="reference internal" href="#software-engineering-packaging-principles">Software Engineering Packaging Principles</a>.</p></li>
<li><p>Typically defines a set of libraries and/or header files and/or executables
and/or tests with CMake build targets for building these for which TriBITS
exports the list of include directories, libraries, and targets that are
created (along with CMake dependencies).</p></li>
<li><p>Is declared in its parent package’s <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a>
file in a call to <a class="reference internal" href="#tribits-package-define-dependencies">tribits_package_define_dependencies()</a> using the
argument <a class="reference internal" href="#subpackages-dirs-classifications-optreqs">SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS</a>.</p></li>
<li><p>Defines dependencies on <a class="reference internal" href="#upstream">upstream</a> TPLs and/or other SE packages by just
naming the dependencies in the file
<a class="reference internal" href="#packagedir-spkgdir-cmake-dependencies-cmake">&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</a> using the macro
<a class="reference internal" href="#tribits-package-define-dependencies">tribits_package_define_dependencies()</a>.</p></li>
<li><p>Can <strong>NOT</strong> have its own subpackages defined (only top-level packages can
have subpackages).</p></li>
<li><p>Is enabled or disabled along with all other subpackages in the parent
package automatically if it’s parent package is enabled or disabled with
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_${PARENT_PACKAGE_NAME}</span></code> set to <code class="docutils literal notranslate"><span class="pre">ON</span></code> or <code class="docutils literal notranslate"><span class="pre">OFF</span></code>
respectively (see <a class="reference internal" href="#enable-disable-of-parent-package-is-enable-disable-for-subpackages">Enable/disable of parent package is enable/disable for
subpackages</a> and <a class="reference internal" href="#parent-package-name">PARENT_PACKAGE_NAME</a>).</p></li>
<li><p>Has tests turned on automatically if
<code class="docutils literal notranslate"><span class="pre">${PARENT_PACKAGE_NAME}_ENABLE_TESTS=ON</span></code>.</p></li>
</ul>
<p>The contents of a TriBITS Subpackage are almost identical to those of a
TriBITS Package.  The differences are described below and in <a class="reference internal" href="#how-is-a-tribits-subpackage-different-from-a-tribits-package">How is a TriBITS
Subpackage different from a TriBITS Package?</a>.</p>
<p>For more details on the definition of a TriBITS Package (or subpackage), see:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#tribits-subpackage-core-files">TriBITS Subpackage Core Files</a></p></li>
<li><p><a class="reference internal" href="#tribits-subpackage-core-variables">TriBITS Subpackage Core Variables</a></p></li>
</ul>
<section id="tribits-subpackage-core-files">
<h4><a class="toc-backref" href="#id21">TriBITS Subpackage Core Files</a><a class="headerlink" href="#tribits-subpackage-core-files" title="Permalink to this heading"></a></h4>
<p>The set of core files for a subpackage are identical to the <a class="reference internal" href="#tribits-package-core-files">TriBITS Package
Core Files</a> and are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">packageDir</span><span class="o">&gt;/&lt;</span><span class="n">spkgDir</span><span class="o">&gt;/</span>
  <span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>  <span class="c1"># Only processed if this subpackage is enabled</span>
  <span class="n">cmake</span><span class="o">/</span>
    <span class="n">Dependencies</span><span class="o">.</span><span class="n">cmake</span>  <span class="c1"># Always processed if the parent package</span>
                          <span class="c1"># is listed in the enclosing Repository</span>
</pre></div>
</div>
<p>(where <code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;</span> <span class="pre">=</span> <span class="pre">${${PARENT_PACKAGE_NAME}_SOURCE_DIR}</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;spkgDir&gt;</span></code> is the subpackage directory listed in the
<a class="reference internal" href="#subpackages-dirs-classifications-optreqs">SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS</a> to
<a class="reference internal" href="#tribits-package-define-dependencies">tribits_package_define_dependencies()</a>).</p>
<p>There are a few simple rules for the location and the contents of the
<code class="docutils literal notranslate"><span class="pre">&lt;spkgDir&gt;/</span></code> directory:</p>
<ul class="simple">
<li><p>The relative directory <code class="docutils literal notranslate"><span class="pre">&lt;spkgDir&gt;/</span></code> should be a strict subdirectory of
<code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;/</span></code> (e.g. not <code class="docutils literal notranslate"><span class="pre">../../somewhereelse</span></code>).</p></li>
<li><p>The directory <code class="docutils literal notranslate"><span class="pre">&lt;spkgDir&gt;/</span></code> must not be a subdirectory of the package
directory of any other subpackage (e.g. not <code class="docutils literal notranslate"><span class="pre">spkga/spkgb</span></code>).</p></li>
<li><p>All of the source files, test files, etc. for the subpackage should be
included under <code class="docutils literal notranslate"><span class="pre">&lt;spkgDir&gt;/</span></code>.</p></li>
</ul>
<p>The above rules are not needed for basic building and testing but are needed
for extended features like automatically detecting when a package has changed
by looking at what files have changed (see <a class="reference internal" href="#pre-push-testing-using-checkin-test-py">Pre-push Testing using
checkin-test.py</a>) and for creating source tarballs correctly (see <a class="reference internal" href="#creating-source-distributions">Creating
Source Distributions</a>).  Therefore, it would be wise to abide by the above
rules when defining subpackages.</p>
<p>These TriBITS Subpackage files are documented in more detail below:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#packagedir-spkgdir-cmake-dependencies-cmake">&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</a></p></li>
<li><p><a class="reference internal" href="#packagedir-spkgdir-cmakelists-txt">&lt;packageDir&gt;/&lt;spkgDir&gt;/CMakeLists.txt</a></p></li>
</ul>
<p id="packagedir-spkgdir-cmake-dependencies-cmake"><strong>&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</strong>: [Required] The contents
of this file for subpackages are identical as for top-level packages.  It just
contains a call to the macro <a class="reference internal" href="#tribits-package-define-dependencies">tribits_package_define_dependencies()</a> to
define this SE package’s <a class="reference internal" href="#upstream">upstream</a> TPL and SE package dependencies.  A
simple example is for the example subpackage <code class="docutils literal notranslate"><span class="pre">WithSubpackagesB</span></code> (declared in
<a class="reference internal" href="#with-subpackages-cmake-dependencies-cmake">with_subpackages/cmake/Dependencies.cmake</a>) with the file:</p>
<blockquote>
<div><p><a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<code class="docutils literal notranslate"><span class="pre">packages/with_subpackages/b/cmake/Dependencies.cmake</span></code></p>
</div></blockquote>
<p>which is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_package_define_dependencies</span><span class="p">(</span>
  <span class="n">LIB_REQUIRED_PACKAGES</span>  <span class="n">SimpleCxx</span>
  <span class="n">LIB_OPTIONAL_PACKAGES</span>  <span class="n">WithSubpackagesA</span>  <span class="n">InsertedPkg</span> 
  <span class="n">TEST_OPTIONAL_PACKAGES</span>  <span class="n">MixedLang</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>What this shows is that subpackages must list their dependencies on each other
(if such dependencies exist) using the full SE package name
<code class="docutils literal notranslate"><span class="pre">${PARENT_PACKAGE_NAME}${SUBPACKAGE_NAME}</span></code> or in this case:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;WithSubpackagesA&#39;</span> <span class="o">=</span> <span class="s1">&#39;WithSubpackages&#39;</span> <span class="o">+</span> <span class="s1">&#39;A&#39;</span>
</pre></div>
</div>
<p>Note that the parent SE package depends on its subpackages, not the other way
around.  For example, the <code class="docutils literal notranslate"><span class="pre">WithSubpackages</span></code> parent SE package
automatically depends its SE subpackages
<code class="docutils literal notranslate"><span class="pre">WithSubpackagesA</span></code>, <code class="docutils literal notranslate"><span class="pre">WithSubpackagesC</span></code>,
and <code class="docutils literal notranslate"><span class="pre">WithSubpackagesC</span></code>.  As such all (direct) dependencies
for a subpackage must be listed in its own <code class="docutils literal notranslate"><span class="pre">Dependencies.cmake</span></code> file.  For
example, the <code class="docutils literal notranslate"><span class="pre">WithSubpackages</span></code> subpackage <code class="docutils literal notranslate"><span class="pre">A</span></code> depends on
the <code class="docutils literal notranslate"><span class="pre">SimpleCxx</span></code> package and is declared as such as shown in:</p>
<blockquote>
<div><p><a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<code class="docutils literal notranslate"><span class="pre">packages/with_subpackages/a/cmake/Dependencies.cmake</span></code></p>
</div></blockquote>
<p>which is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_package_define_dependencies</span><span class="p">(</span>
  <span class="n">LIB_REQUIRED_PACKAGES</span> <span class="n">SimpleCxx</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>What this means is that any TPL or library dependencies listed in the parent
package’s <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> file are <strong>NOT</strong>
dependencies of its subpackages.  For example, if
<a class="reference internal" href="#with-subpackages-cmake-dependencies-cmake">with_subpackages/cmake/Dependencies.cmake</a> where changed to be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_package_define_dependencies</span><span class="p">(</span>
  <span class="n">LIB_REQUIRED_TPLS</span> <span class="n">Boost</span>
  <span class="n">SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS</span>
    <span class="n">A</span>   <span class="n">A</span>   <span class="n">PT</span>  <span class="n">REQUIRED</span>
    <span class="o">...</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>then the <code class="docutils literal notranslate"><span class="pre">Boost</span></code> TPL would <strong>NOT</strong> be a dependency of the SE package
<code class="docutils literal notranslate"><span class="pre">WithSubpackagesA</span></code> but instead would be listed as a
dependency of the parent SE package <code class="docutils literal notranslate"><span class="pre">WithSubpackages</span></code>.  (And in this
case, this TPL dependency is pretty worthless since the SE package
<code class="docutils literal notranslate"><span class="pre">WithSubpackages</span></code> does not even define any libraries or tests of its
own.)</p>
<p id="packagedir-spkgdir-cmakelists-txt"><strong>&lt;packageDir&gt;/&lt;spkgDir&gt;/CMakeLists.txt</strong>: [Required] The subpackage’s
top-level <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file that defines the libraries, include
directories, and contains the tests for the subpackage.  The contents of a
subpackage’s top-level <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file are almost identical to a
top-level package’s <a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file.  The primary
difference is that the commands <a class="reference internal" href="#id1">tribits_package()</a> and
<a class="reference internal" href="#tribits-package-postprocess">tribits_package_postprocess()</a> and replaced with <a class="reference internal" href="#id3">tribits_subpackage()</a> and
<a class="reference internal" href="#tribits-subpackage-postprocess">tribits_subpackage_postprocess()</a> as shown in the file:</p>
<blockquote>
<div><p><a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<code class="docutils literal notranslate"><span class="pre">packages/with_subpackages/a/CMakeLists.txt</span></code></p>
</div></blockquote>
<p>which contains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#
# A) Define the subpackage
#
tribits_subpackage(A)

#
# B) Set up subpackage-specific options
#
# Typically there are none or are few as most options are picked up from the
# parent package&#39;s CMakeLists.txt file!

#
# C) Add the libraries, tests, and examples
#

include_directories(${CMAKE_CURRENT_SOURCE_DIR})
tribits_add_library(pws_a
  SOURCES A.cpp
  HEADERS A.hpp
  NOINSTALLHEADERS 
)

tribits_add_test_directories(tests)

#
# D) Do standard post processing
#
tribits_subpackage_postprocess()
</pre></div>
</div>
<p>Unlike <a class="reference internal" href="#id1">tribits_package()</a>, <a class="reference internal" href="#id3">tribits_subpackage()</a> does not take any extra
arguments.  Those extra settings are assumed to be defined by the top-level
parent package.  Like top-level packages, subpackages are free to define
user-settable options and configure-time tests but typically don’t.  The idea
is that subpackages should be lighter weight than top-level packages.  Other
than using <a class="reference internal" href="#id3">tribits_subpackage()</a> and <a class="reference internal" href="#tribits-subpackage-postprocess">tribits_subpackage_postprocess()</a>, a
subpackage can be laid out just like any other package and can call on any
other commands to add libraries, add executables, add test, etc.</p>
</section>
<section id="tribits-subpackage-core-variables">
<h4><a class="toc-backref" href="#id22">TriBITS Subpackage Core Variables</a><a class="headerlink" href="#tribits-subpackage-core-variables" title="Permalink to this heading"></a></h4>
<p>The core variables associated with a subpackage are identical to the <a class="reference internal" href="#tribits-package-core-variables">TriBITS
Package Core Variables</a>.  In addition, a subpackage may need to refer to its
top-level parent package where a top-level package does not have a parent
package.  These additional variables that are defined for subpackages are
broken down into the following categories:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#tribits-subpackage-local-variables">TriBITS Subpackage Local Variables</a></p></li>
<li><p><a class="reference internal" href="#tribits-subpackage-top-level-local-variables">TriBITS Subpackage Top-Level Local Variables</a></p></li>
</ul>
<p id="tribits-subpackage-local-variables">In addition to the <a class="reference internal" href="#tribits-package-local-variables">TriBITS Package Local Variables</a>, the following locally
scoped <strong>TriBITS Subpackage Local Variables</strong> are defined when the files for a
given TriBITS Subpackage are being processed:</p>
<blockquote>
<div><p id="parent-package-name"><code class="docutils literal notranslate"><span class="pre">PARENT_PACKAGE_NAME</span></code></p>
<blockquote>
<div><p>The name of the parent package.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">PARENT_PACKAGE_SOURCE_DIR</span></code></p>
<blockquote>
<div><p>The absolute path to the parent package’s base source directory.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">PARENT_PACKAGE_BINARY_DIR</span></code></p>
<blockquote>
<div><p>The absolute path to the parent package’s base binary directory.</p>
</div></blockquote>
</div></blockquote>
<p id="tribits-subpackage-top-level-local-variables">In addition to the <a class="reference internal" href="#tribits-package-top-level-local-variables">TriBITS Package Top-Level Local Variables</a>, once all of a
TriBITS subpackage’s <code class="docutils literal notranslate"><span class="pre">Dependencies.cmake</span></code> files have been processed, the
following <strong>TriBITS Subpackage Top-Level Local Variables</strong> are defined:</p>
<blockquote>
<div><p id="package-name-parent-package"><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_PARENT_PACKAGE</span></code></p>
<blockquote>
<div><p>The name of the parent package.  (NOTE: If this is empty “”, then
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code> is actually a parent package and not a subpackage.)</p>
</div></blockquote>
</div></blockquote>
</section>
<section id="how-is-a-tribits-subpackage-different-from-a-tribits-package">
<h4><a class="toc-backref" href="#id23">How is a TriBITS Subpackage different from a TriBITS Package?</a><a class="headerlink" href="#how-is-a-tribits-subpackage-different-from-a-tribits-package" title="Permalink to this heading"></a></h4>
<p>A common question this is natural to ask is how a TriBITS Subpackage is
different from a TriBITS Package?  They contain the same basic files (i.e. a
<code class="docutils literal notranslate"><span class="pre">cmake/Dependencies.cmake</span></code> file, a top-level <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file, source
files, test files, etc.).  They both are included in the list of <a class="reference internal" href="#tribits-se-packages">TriBITS SE
Packages</a> and therefore can both be enabled/disabled by the user or in
automatic dependency logic (see <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package Dependencies and Enable/Disable
Logic</a>).  The primary difference is that a subpackage is meant to involve
less overhead and is to be used to partition the parent package’s software
into chunks according to <a class="reference internal" href="#software-engineering-packaging-principles">Software Engineering Packaging Principles</a>.  Also,
the dependency logic treats a parent package’s subpackages as part of itself
so when the parent package is explicitly enabled or disabled, it is identical
to explicitly enabling or disabling all of its subpackages (see
<a class="reference internal" href="#enable-disable-of-parent-package-is-enable-disable-for-subpackages">Enable/disable of parent package is enable/disable for subpackages</a>).  Also,
subpackages are tested along with their peer subpackages with the parent
package as part of <a class="reference internal" href="#tribits-ctest-cdash-driver">TriBITS CTest/CDash Driver</a>.  This effectively means that if a
build failure is detected in any subpackage, then that will effectively
disable the parent package and all of its other subpackages in downstream
testing.  This is a type of “all for one and one for all” when it comes to the
relationship between the subpackages within a single parent package.  These
are some of the issues to consider when breaking up software into packages and
subpackages that will be mentioned in other sections as well.</p>
</section>
</section>
<section id="tribits-external-package-tpl">
<span id="tribits-tpl"></span><h3><a class="toc-backref" href="#id24">TriBITS External Package/TPL</a><a class="headerlink" href="#tribits-external-package-tpl" title="Permalink to this heading"></a></h3>
<p>A <em>TriBITS External Package/TPL</em>:</p>
<ul class="simple">
<li><p>Provides access to a set of pre-built/installed libraries and/or header
files and/or executables and/or some other resources through a standard
interface to one or more downstream TriBITS Packages.</p></li>
<li><p>Has a globally unique name <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code> (see <a class="reference internal" href="#globally-unique-tribits-tpl-names">Globally unique TriBITS TPL
names</a>) that is declared in a <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file.</p></li>
<li><p>Has as <a class="reference internal" href="#findtpl-tplname-cmake">FindTPL&lt;tplName&gt;.cmake</a> module that finds the pieces of an external
package/TPL and provides them to downstream packages through a required
INTERFACE target <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> (which gives the libraries, include
directories, and other usage requirements).</p></li>
<li><p>Is listed as an explicit optional or required dependency in one or more
downstream TriBITS packages’ <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> files.</p></li>
<li><p>Can be enabled automatically or can trigger the disable of dependent
downstream packages (see <a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency Handling Behaviors</a>).</p></li>
</ul>
<p>The TriBITS external package/TPL mechanism provides a uniform way to find and
provide access to any type of external resource no matter how it might be
installed or ways to provide access to it.  Using a TriBITS TPL is to be
preferred over using raw CMake <code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> call because
the TriBITS system guarantees that only a single unique version of an external
package/TPL of the same version will be used all of the downstream packages
that uses it.  Also, by defining a TriBITS TPL, automatic enable/disable logic
will be applied as described in <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package Dependencies and Enable/Disable
Logic</a>.  For example, if a TPL is explicitly disabled, all of the downstream
packages that depend on that TPL will be automatically disabled as well (see
<a class="reference internal" href="#tpl-disable-triggers-auto-disables-of-downstream-dependencies">TPL disable triggers auto-disables of downstream dependencies</a>).</p>
<p id="globally-unique-tribits-tpl-names"><strong>WARNING:</strong> One must be very careful to pick <strong>Globally unique TriBITS
External Package/TPL names</strong> <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code> across all TPLs in all TriBITS
repositories that ever might be cobbled together into a single TriBITS (meta)
project!  However, choosing TPL names is usually much easier and less risky
than choosing <a class="reference internal" href="#globally-unique-tribits-package-names">Globally unique TriBITS package names</a> because the native TPLs
themselves tend to be uniquely named.  For example, the TPL names <code class="docutils literal notranslate"><span class="pre">BLAS</span></code> and
<code class="docutils literal notranslate"><span class="pre">LAPACK</span></code> are well defined in the applied math and computational science
community and are not likely to clash.</p>
<section id="tribits-external-package-tpl-core-files">
<h4><a class="toc-backref" href="#id25">TriBITS External Package/TPL Core Files</a><a class="headerlink" href="#tribits-external-package-tpl-core-files" title="Permalink to this heading"></a></h4>
<p>The core files that define a <em>TriBITS External Package/TPL</em> are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">tplDefsDir</span><span class="o">&gt;/</span>
  <span class="n">FindTPL</span><span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;.</span><span class="n">cmake</span>   <span class="c1"># The name is not fixed (see &lt;tplName&gt;_FINDMOD)</span>
  <span class="n">FindTPL</span><span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;</span><span class="n">Dependencies</span><span class="o">.</span><span class="n">cmake</span>   <span class="c1"># [Optional], defines upstream dependencies</span>
</pre></div>
</div>
<p>Above, <code class="docutils literal notranslate"><span class="pre">&lt;tplDefsDir&gt;/</span></code> can be a subdirectory under a TriBITS repository
<code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;/</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;/cmake/tpls/</span></code>) or can be under a TriBITS
package directory <code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;/</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;/cmake/tpls/</span></code>).</p>
<p>The following TriBITS External Package/TPL files are documented in more detail
below:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#tpldefsdir-findtpl-tplname-cmake">&lt;tplDefsDir&gt;/FindTPL&lt;tplName&gt;.cmake</a></p></li>
<li><p><a class="reference internal" href="#tpldefsdir-findtpl-tplname-dependencies-cmake">&lt;tplDefsDir&gt;/FindTPL&lt;tplName&gt;Dependencies.cmake</a></p></li>
</ul>
<p id="tpldefsdir-findtpl-tplname-cmake"><span id="findtpl-tplname-cmake"></span><strong>&lt;tplDefsDir&gt;/FindTPL&lt;tplName&gt;.cmake</strong>: [Required] Defines how an external
package/TPL is found and provided for usage by a downstream TriBITS package by
providing the <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> target and a package config file
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;Config.cmake</span></code> that also defines the target
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code>.  (The requirements for a <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code>
file are given in <a class="reference internal" href="#requirements-for-findtpl-tplname-cmake-modules">Requirements for FindTPL&lt;tplName&gt;.cmake modules</a>).</p>
<p>The form of a simple <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> file that uses an internal
call to <code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> which provides modern IMPORTED CMake
targets looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">find_package</span><span class="p">(</span><span class="o">&lt;</span><span class="n">externalPkg</span><span class="o">&gt;</span> <span class="n">REQUIRED</span><span class="p">)</span>
<span class="n">tribits_extpkg_create_imported_all_libs_target_and_config_file</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;</span>
  <span class="n">INNER_FIND_PACKAGE_NAME</span> <span class="o">&lt;</span><span class="n">externalPkg</span><span class="o">&gt;</span>
  <span class="n">IMPORTED_TARGETS_FOR_ALL_LIBS</span> <span class="o">&lt;</span><span class="n">importedTarget0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">importedTarget1</span><span class="o">&gt;</span> <span class="o">...</span> <span class="p">)</span>
</pre></div>
</div>
<p>In this case, the purpose for the <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> file (as apposed
to a direct call to <code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code>) is to ensure the
definition of the complete target <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> which contains all
usage requirements for the external package/TPL (i.e. all of the libraries,
include directories, etc.).</p>
<p>The form of a simple <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> file that just provides a list
of required header files and libraries that does <strong>not</strong> use an internal call
to <code class="docutils literal notranslate"><span class="pre">find_package()</span></code> looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_tpl_find_include_dirs_and_libraries</span><span class="p">(</span> <span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;</span>
  <span class="n">REQUIRED_HEADERS</span> <span class="o">&lt;</span><span class="n">header0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">header1</span><span class="o">&gt;</span> <span class="o">...</span>
  <span class="n">REQUIRED_LIBS_NAMES</span> <span class="o">&lt;</span><span class="n">libname0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">libname1</span><span class="o">&gt;</span> <span class="o">...</span>
  <span class="n">MUST_FIND_ALL_LIBS</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>An example concrete file is <code class="docutils literal notranslate"><span class="pre">tribits/common_tpls/FindTPLPETSC.cmake</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_tpl_find_include_dirs_and_libraries</span><span class="p">(</span> <span class="n">PETSC</span>
  <span class="n">REQUIRED_HEADERS</span> <span class="n">petsc</span><span class="o">.</span><span class="n">h</span>
  <span class="n">REQUIRED_LIBS_NAMES</span> <span class="n">petsc</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>For complete details, see <a class="reference internal" href="#creating-the-findtpl-tplname-cmake-file">Creating the FindTPL&lt;tplName&gt;.cmake file</a>.</p>
<p id="tpldefsdir-findtpl-tplname-dependencies-cmake"><span id="findtpl-tplname-dependencies-cmake"></span><strong>&lt;tplDefsDir&gt;/FindTPL&lt;tplName&gt;Dependencies.cmake</strong>: [Optional]
Declares dependencies on upstream external packages/TPLs for the external
package/TPL <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code>.  Many external packages/TPLs defined with a
<a class="reference internal" href="#findtpl-tplname-cmake">FindTPL&lt;tplName&gt;.cmake</a> file do not have any upstream dependencies or have
internal mechanisms to get those (such as when using
<code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> where the <code class="docutils literal notranslate"><span class="pre">&lt;externalPkg&gt;Config.cmake</span></code> file
which recursively uses <code class="docutils literal notranslate"><span class="pre">find_dependency()</span></code> to get its upstream
dependencies).  But for <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> files that just use
<a class="reference internal" href="#tribits-tpl-find-include-dirs-and-libraries">tribits_tpl_find_include_dirs_and_libraries()</a> (see <a class="reference internal" href="#creating-a-findtpl-tplname-cmake-module-without-find-package">Creating a
FindTPL&lt;tplName&gt;.cmake module without find_package()</a>), TriBITS needs to be told
about any upstream external packages/TPLs that it may depend on so it can add
the dependencies between the created IMPORTED target libraries.</p>
<p>The file <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;Dependencies.cmake</span></code> is typically just a single
call to <a class="reference internal" href="#tribits-extpkg-define-dependencies">tribits_extpkg_define_dependencies()</a> and takes the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_extpkg_define_dependencies</span><span class="p">(</span> <span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;</span>
  <span class="n">DEPENDENCIES</span> <span class="o">&lt;</span><span class="n">upstreamTpl_0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">upstreamTpl_1</span><span class="o">&gt;</span> <span class="o">...</span> <span class="p">)</span>
</pre></div>
</div>
<p>This defines all of the TPLs that <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code> could directly depends on but
only dependencies for enabled upstream TPLs will be added to the IMPORTED
targets.</p>
</section>
<section id="tribits-external-package-tpl-core-variables">
<h4><a class="toc-backref" href="#id26">TriBITS External Package/TPL Core Variables</a><a class="headerlink" href="#tribits-external-package-tpl-core-variables" title="Permalink to this heading"></a></h4>
<p>Once the <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> files are all processed, then each
defined TPL <code class="docutils literal notranslate"><span class="pre">TPL_NAME</span></code> is assigned the following global non-cache variables:</p>
<blockquote>
<div><p id="tpl-name-findmod"><span id="tplname-findmod"></span><span id="package-name-findmod"></span><code class="docutils literal notranslate"><span class="pre">${TPL_NAME}_FINDMOD</span></code></p>
<blockquote>
<div><p>Relative path (w.r.t. <code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;</span></code>) or absolute path for the external
package/TPL’s find module (typically named <a class="reference internal" href="#findtpl-tplname-cmake">FindTPL&lt;tplName&gt;.cmake</a>):
This is set using the <code class="docutils literal notranslate"><span class="pre">FINDMOD</span></code> field in the call to
<a class="reference internal" href="#tribits-repository-define-tpls">tribits_repository_define_tpls()</a>.  The final value of the variable is
defined by the <em>last</em> <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file that is processed
that declares the TPL <code class="docutils literal notranslate"><span class="pre">TPL_NAME</span></code>.  For example, if
<code class="docutils literal notranslate"><span class="pre">Repo1/TPLsList.cmake</span></code> and <code class="docutils literal notranslate"><span class="pre">Repo2/TPLsList.cmake</span></code> both list the TPL
<code class="docutils literal notranslate"><span class="pre">SomeTpl</span></code>, then if <code class="docutils literal notranslate"><span class="pre">Repo2</span></code> is processed after <code class="docutils literal notranslate"><span class="pre">Repo1</span></code>, then
<code class="docutils literal notranslate"><span class="pre">SomeTpl_FINDMOD</span></code> is determined by <code class="docutils literal notranslate"><span class="pre">Repo2/TPLsList.cmake</span></code> and the find
module listed in <code class="docutils literal notranslate"><span class="pre">Repo1/TPLsList.cmake</span></code> is ignored.</p>
</div></blockquote>
<p id="tpl-name-dependencies-file"><span id="tplname-dependencies-file"></span><code class="docutils literal notranslate"><span class="pre">${TPL_NAME}_DEPENDENCIES_FILE</span></code></p>
<blockquote>
<div><p>Relative path (w.r.t. <code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;</span></code>) or absolute path for the external
package/TPL’s dependencies file (typically named
<a class="reference internal" href="#findtpl-tplname-dependencies-cmake">FindTPL&lt;tplName&gt;Dependencies.cmake</a>).  This is always beside the find
module <a class="reference internal" href="#tpl-name-findmod">${TPL_NAME}_FINDMOD</a> (and in fact
<code class="docutils literal notranslate"><span class="pre">${TPL_NAME}_DEPENDENCIES_FILE</span></code> is constructed from
<code class="docutils literal notranslate"><span class="pre">${TPL_NAME}_FINDMOD</span></code>).</p>
</div></blockquote>
<p id="tpl-name-testgroup"><code class="docutils literal notranslate"><span class="pre">${TPL_NAME}_TESTGROUP</span></code></p>
<blockquote>
<div><p>TPL’s <a class="reference internal" href="#se-package-test-group">SE Package Test Group</a>: This is set using the <code class="docutils literal notranslate"><span class="pre">CLASSIFICATION</span></code>
field in the call to <a class="reference internal" href="#tribits-repository-define-tpls">tribits_repository_define_tpls()</a>.  If multiple
repos define a given TPL, then the <em>first</em> <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a>
file that is processed that declares the TPL <code class="docutils literal notranslate"><span class="pre">TPL_NAME</span></code> specifies the
test group.  For example, if <code class="docutils literal notranslate"><span class="pre">Repo1/TPLsList.cmake</span></code> and
<code class="docutils literal notranslate"><span class="pre">Repo2/TPLsList.cmake</span></code> both list the TPL <code class="docutils literal notranslate"><span class="pre">SomeTpl</span></code>, then if <code class="docutils literal notranslate"><span class="pre">Repo2</span></code>
is processed after <code class="docutils literal notranslate"><span class="pre">Repo1</span></code>, then <code class="docutils literal notranslate"><span class="pre">SomeTpl_TESTGROUP</span></code> is determined by
<code class="docutils literal notranslate"><span class="pre">Repo1/TPLsList.cmake</span></code> and the test group in <code class="docutils literal notranslate"><span class="pre">Repo2/TPLsList.cmake</span></code> is
ignored.  However, if <code class="docutils literal notranslate"><span class="pre">${TPL_NAME}_TESTGROUP</span></code> is already set before the
<a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> files are processed, then that test group will
be used.  Therefore, the project can override the test group for a given
TPL if desired by setting <code class="docutils literal notranslate"><span class="pre">${TPL_NAME}_TESTGROUP</span></code> before the first
<a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file gets processed.</p>
</div></blockquote>
<p id="tpl-name-tpls-list-file"><code class="docutils literal notranslate"><span class="pre">${TPL_NAME}_TPLS_LIST_FILE</span></code></p>
<blockquote>
<div><p>Absolute path of the (last) <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file that declared
this external package/TPL.</p>
</div></blockquote>
</div></blockquote>
<p>Note, the <code class="docutils literal notranslate"><span class="pre">&lt;findmod&gt;</span></code> field path in the call to
<a class="reference internal" href="#tribits-repository-define-tpls">tribits_repository_define_tpls()</a> is relative to the TriBITS repository dir
<code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;</span></code> but a relative path in for the varaible <a class="reference internal" href="#tplname-findmod">&lt;tplName&gt;_FINDMOD</a> is
relative to the project dir <code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;</span></code>.  There is a translation of the
<code class="docutils literal notranslate"><span class="pre">&lt;findmod&gt;</span></code> field to the variable <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_FINDMOD</span></code> that takes place
when the <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file is processed to make this so.</p>
<p>As noted above, it is allowed for the same TPL to be listed in multiple
<a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> files.  In this case, the rules for overrides of
the find module and the test group as described above.</p>
<p>The specification given in <a class="reference external" href="TribitsBuildReference.html#enabling-support-for-an-optional-third-party-library-tpl">Enabling support for an optional Third-Party
Library (TPL)</a> and <a class="reference internal" href="#creating-the-findtpl-tplname-cmake-file">Creating the FindTPL&lt;tplName&gt;.cmake file</a> describe how
to create a <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> module.  However, all that is required
is that some CMake file fragment exist such that, once included, will define
the target <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> and create the <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;Config.cmake</span></code>
file in the correct location (see <a class="reference internal" href="#requirements-for-findtpl-tplname-cmake-modules">Requirements for FindTPL&lt;tplName&gt;.cmake modules</a>).</p>
</section>
</section>
</section>
<section id="processing-of-tribits-files-ordering-and-details">
<h2><a class="toc-backref" href="#id27"><span class="sectnum">3.2</span> Processing of TriBITS Files: Ordering and Details</a><a class="headerlink" href="#processing-of-tribits-files-ordering-and-details" title="Permalink to this heading"></a></h2>
<p>One of the most important things to know about TriBITS is what files it
processes, in what order, and in what context.  This is critical to being able
to understand what impact (if any) setting a variable or otherwise changing
the CMake run-time state will have on configuring a CMake project which uses
TriBITS.  While the different files that make up a <a class="reference internal" href="#tribits-project">TriBITS Project</a>,
<a class="reference internal" href="#tribits-repository">TriBITS Repository</a>, <a class="reference internal" href="#tribits-package">TriBITS Package</a>, <a class="reference internal" href="#tribits-subpackage">TriBITS Subpackage</a>, and <a class="reference internal" href="#tribits-tpl">TriBITS
TPL</a> were defined in the section <a class="reference internal" href="#tribits-structural-units">TriBITS Structural Units</a>, that material
did not fully describe the context and in what order these files are processed
by the TriBITS framework.</p>
<p>The TriBITS system processes the project’s files in one of two general use
cases.  The first use case is in the basic configuration of the project with a
standard <code class="docutils literal notranslate"><span class="pre">cmake</span></code> command invocation in order to set up the build files in
the binary directory (see <a class="reference internal" href="#full-tribits-project-configuration">Full TriBITS Project Configuration</a>).  The second
use case is in reading the project’s dependency-related files in order to
build the package dependency data-structure (e.g. the
<a class="reference internal" href="#project-packagedependencies-xml">&lt;Project&gt;PackageDependencies.xml</a> file, see <a class="reference internal" href="#reduced-package-dependency-processing">Reduced Package Dependency
Processing</a>).  The second use case of reading the project’s dependency files
is largely a subset of the first.</p>
<p>Another factor that is important to understand is the scoping in which the
various files are processed (with <code class="docutils literal notranslate"><span class="pre">include()</span></code> or <code class="docutils literal notranslate"><span class="pre">add_subdirectory()</span></code>).
This scoping has a large impact on the configuration of the project and what
effect the processing of files and setting variables have on the project as a
whole.  Some of the strange scoping rules for CMake are discussed in <a class="reference internal" href="#cmake-language-overview-and-gotchas">CMake
Language Overview and Gotchas</a> and should be understood before trying to
debug issues with processing.  Many of the basic files are processed
(included) in the base project <a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> scope and
therefore any local variables set in these files are accessible to the entire
CMake project (after the file is processed, of course).  Other files get
processed inside of functions which have their own local scope and therefore
only impact the rest of the project in more purposeful ways.  And of course
all of the package <a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> files that are processed
using <code class="docutils literal notranslate"><span class="pre">add_subdirectory()</span></code> create a new local scope for that given package.</p>
<section id="full-tribits-project-configuration">
<h3><a class="toc-backref" href="#id28">Full TriBITS Project Configuration</a><a class="headerlink" href="#full-tribits-project-configuration" title="Permalink to this heading"></a></h3>
<p>The first use case to describe is the full processing of all of the TriBITS
project’s files starting with the base <a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> file.
This begins with the invocation of the following CMake command to generate the
project’s build files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cmake [options] &lt;projectDir&gt;
</pre></div>
</div>
<p>Below, is a short pseudo-code algorithm for the TriBITS framework processing
and callbacks that begins in the <a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> file and
proceeds through the call to <a class="reference internal" href="#id2">tribits_project()</a>.</p>
<p id="full-processing-of-tribits-project-files"><strong>Full Processing of TriBITS Project Files:</strong></p>
<div class="line-block">
<div class="line">1.  Read <a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> (sets <a class="reference internal" href="#project-name">PROJECT_NAME</a>)</div>
<div class="line">2.  Call <code class="docutils literal notranslate"><span class="pre">project(${PROJECT_NAME}</span> <span class="pre">NONE)</span></code> (sets <a class="reference internal" href="#project-name-source-dir">${PROJECT_NAME}_SOURCE_DIR</a></div>
<div class="line-block">
<div class="line">and <a class="reference internal" href="#project-name-binary-dir">${PROJECT_NAME}_BINARY_DIR</a>)</div>
</div>
<div class="line">3.  Call <a class="reference internal" href="#id2">tribits_project()</a>:</div>
<div class="line-block">
<div class="line">1)  Set <a class="reference internal" href="#project-source-dir">PROJECT_SOURCE_DIR</a> and <a class="reference internal" href="#project-binary-dir">PROJECT_BINARY_DIR</a></div>
<div class="line">2)  For each <code class="docutils literal notranslate"><span class="pre">&lt;optFile&gt;</span></code> in ${<a class="reference external" href="TribitsBuildReference.html#project-configure-options-file">${PROJECT_NAME}_CONFIGURE_OPTIONS_FILE</a>}</div>
<div class="line-block">
<div class="line-block">
<div class="line">then in ${<a class="reference internal" href="#project-name-configure-options-file-append">${PROJECT_NAME}_CONFIGURE_OPTIONS_FILE_APPEND</a>}
:</div>
</div>
<div class="line">* <code class="docutils literal notranslate"><span class="pre">include(&lt;optFile&gt;)</span></code></div>
</div>
<div class="line">3)  Set variables <code class="docutils literal notranslate"><span class="pre">CMAKE_HOST_SYSTEM_NAME</span></code> and <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_HOSTNAME</span></code></div>
<div class="line-block">
<div class="line">(both of these can be overridden in the cache by the user)</div>
</div>
<div class="line">4)  Find some optional command-line tools:</div>
<div class="line-block">
<div class="line">a)  Find Python (sets <code class="docutils literal notranslate"><span class="pre">PYTHON_EXECUTABLE</span></code>, see <a class="reference internal" href="#python-support">Python Support</a>)</div>
<div class="line">b)  Find Git (sets <code class="docutils literal notranslate"><span class="pre">GIT_EXECUTABLE</span></code> and <code class="docutils literal notranslate"><span class="pre">GIT_VERSION_STRING</span></code>)</div>
</div>
<div class="line">5)  <code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#projectdir-version-cmake">&lt;projectDir&gt;/Version.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
<div class="line">6)  Define primary TriBITS options and read in the list of extra repositories</div>
<div class="line-block">
<div class="line">(calls <code class="docutils literal notranslate"><span class="pre">tribits_define_global_options_and_define_extra_repos()</span></code>)</div>
<div class="line">* <code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
</div>
<div class="line">7)  For each <code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;</span></code> in all defined TriBITS repositories:</div>
<div class="line-block">
<div class="line">* <code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#repodir-cmake-callbacksetupextraoptions-cmake">&lt;repoDir&gt;/cmake/CallbackSetupExtraOptions.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
<div class="line">* Call macro <code class="docutils literal notranslate"><span class="pre">tribits_repository_setup_extra_options()</span></code></div>
</div>
<div class="line">9)  Call <a class="reference internal" href="#tribits-read-all-project-deps-files-create-deps-graph">tribits_read_all_project_deps_files_create_deps_graph()</a>:</div>
<div class="line-block">
<div class="line">a)  For each <code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;</span></code> in all defined TriBITS repositories:</div>
<div class="line-block">
<div class="line">* <code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code> and process list</div>
<div class="line">* <code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code> and process list</div>
</div>
<div class="line">b)  For each <code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;</span></code> in all defined TriBITS repositories:</div>
<div class="line-block">
<div class="line">* <code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#repodir-cmake-repositorydependenciessetup-cmake">&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
</div>
<div class="line">c)  <code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
<div class="line">d)  For each <code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;</span></code> in all defined top-level packages:</div>
<div class="line-block">
<div class="line">* <code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
<div class="line-block">
<div class="line">- Sets all package-specific options (see <a class="reference internal" href="#tribits-package-cache-variables">TriBITS Package Cache Variables</a>)</div>
</div>
<div class="line">* For each <code class="docutils literal notranslate"><span class="pre">&lt;spkgDir&gt;</span></code> in all subpackages for this package:</div>
<div class="line-block">
<div class="line">* <code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#packagedir-spkgdir-cmake-dependencies-cmake">&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
<div class="line-block">
<div class="line">- Sets all subpackage-specific options</div>
</div>
</div>
</div>
</div>
<div class="line">10) Adjust SE package and TPLs enables and disables</div>
<div class="line-block">
<div class="line">(see <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package Dependencies and Enable/Disable Logic</a>)</div>
</div>
<div class="line">11) <a class="reference internal" href="#probe-and-set-up-the-environment">Probe and set up the environment</a> (finds MPI, compilers, etc.)</div>
<div class="line-block">
<div class="line">(see <a class="reference internal" href="#tribits-environment-probing-and-setup">TriBITS Environment Probing and Setup</a>)</div>
<div class="line">* <code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#projectdir-cmake-projectcompilerpostconfig-cmake">&lt;projectDir&gt;/cmake/ProjectCompilerPostConfig.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
</div>
<div class="line">12) For each <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code> in the set of enabled TPLs:</div>
<div class="line-block">
<div class="line">* <code class="docutils literal notranslate"><span class="pre">include(${&lt;tplName&gt;_FINDMOD})</span></code> (see <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>)</div>
</div>
<div class="line">13) For each <code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;</span></code> in all defined TriBITS repositories:</div>
<div class="line-block">
<div class="line">* Read <a class="reference internal" href="#repodir-copyright-txt">&lt;repoDir&gt;/Copyright.txt</a></div>
<div class="line">* <code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#repodir-version-cmake">&lt;repoDir&gt;/Version.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
<div class="line">(see <a class="reference internal" href="#project-and-repository-versioning-and-release-mode">Project and Repository Versioning and Release Mode</a>)</div>
</div>
<div class="line">14) For each <code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;</span></code> in all enabled top-level packages</div>
<div class="line-block">
<div class="line">* <code class="docutils literal notranslate"><span class="pre">add_subdirectory(</span></code> <a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
<div class="line">* For each <code class="docutils literal notranslate"><span class="pre">&lt;spkgDir&gt;</span></code> in all enabled subpackages for this package:</div>
<div class="line-block">
<div class="line">* <code class="docutils literal notranslate"><span class="pre">add_subdirectory(</span></code> <a class="reference internal" href="#packagedir-spkgdir-cmakelists-txt">&lt;packageDir&gt;/&lt;spkgDir&gt;/CMakeLists.txt</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
</div>
</div>
<div class="line">16) <code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#projectdir-cmake-callbackdefineprojectpackaging-cmake">&lt;projectDir&gt;/cmake/CallbackDefineProjectPackaging.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
<div class="line-block">
<div class="line">* Call <code class="docutils literal notranslate"><span class="pre">tribits_project_define_packaging()</span></code></div>
</div>
<div class="line">16) For each <code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;</span></code> in all defined TriBITS repositories:</div>
<div class="line-block">
<div class="line">* <code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#repodir-cmake-callbackdefinerepositorypackaging-cmake">&lt;repoDir&gt;/cmake/CallbackDefineRepositoryPackaging.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
<div class="line">* Call <code class="docutils literal notranslate"><span class="pre">tribits_repository_define_packaging()</span></code></div>
</div>
</div>
</div>
<p>The TriBITS Framework obviously does a lot more than what is described above
but the basic trace of major operations and ordering and the processing of
project, repository, package, and subpackage files should be clear.  All of
this information should also be clear when enabling <a class="reference internal" href="#file-processing-tracing">File Processing
Tracing</a> and watching the output from the <code class="docutils literal notranslate"><span class="pre">cmake</span></code> configure STDOUT.</p>
</section>
<section id="reduced-package-dependency-processing">
<h3><a class="toc-backref" href="#id29">Reduced Package Dependency Processing</a><a class="headerlink" href="#reduced-package-dependency-processing" title="Permalink to this heading"></a></h3>
<p>In addition to the full processing that occurs as part of the <a class="reference internal" href="#full-tribits-project-configuration">Full TriBITS
Project Configuration</a>, there are also TriBITS tools that only process as
subset of project’s files.  This reduced processing is performed in order to
build up the project’s package dependencies data-structure and to write the
file <a class="reference internal" href="#project-packagedependencies-xml">&lt;Project&gt;PackageDependencies.xml</a>.  For example, the tool
<a class="reference internal" href="#checkin-test-py">checkin-test.py</a> and the function <a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a> both drive this
type of processing.  In particular, the CMake -P script
<a class="reference internal" href="#tribitsdumpdepsxmlscript-cmake">TribitsDumpDepsXmlScript.cmake</a> reads all of the project’s
dependency-related files and dumps out the <a class="reference internal" href="#project-packagedependencies-xml">&lt;Project&gt;PackageDependencies.xml</a>
file (see <a class="reference internal" href="#tribits-project-dependencies-xml-file-and-tools">TriBITS Project Dependencies XML file and tools</a>).  This reduced
processing (e.g. as executed in <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-P</span> <span class="pre">TribitsDumpDepsXmlScript.cmake</span></code>)
is described below.</p>
<p id="reduced-dependency-processing-of-tribits-project-files"><strong>Reduced Dependency Processing of TriBITS Project:</strong></p>
<div class="line-block">
<div class="line">1.  Read <a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> (sets <a class="reference internal" href="#project-name">PROJECT_NAME</a>)</div>
<div class="line">2. <code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
<div class="line">3.  Call <code class="docutils literal notranslate"><span class="pre">tribits_read_all_project_deps_files_create_deps_graph()</span></code>:</div>
<div class="line-block">
<div class="line">a)  For each <code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;</span></code> in all defined TriBITS repositories:</div>
<div class="line-block">
<div class="line">* <code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
<div class="line">* <code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
</div>
<div class="line">b)  For each <code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;</span></code> in all defined TriBITS repositories:</div>
<div class="line-block">
<div class="line">* <code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#repodir-cmake-repositorydependenciessetup-cmake">&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
</div>
<div class="line">c)  <code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
<div class="line">d)  For each <code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;</span></code> in all defined top-level packages:</div>
<div class="line-block">
<div class="line">* <code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
<div class="line-block">
<div class="line">- Sets all package-specific options (see <a class="reference internal" href="#tribits-package-cache-variables">TriBITS Package Cache Variables</a>)</div>
</div>
<div class="line">* For each <code class="docutils literal notranslate"><span class="pre">&lt;spkgDir&gt;</span></code> in all subpackages for this package:</div>
<div class="line-block">
<div class="line">* <code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#packagedir-spkgdir-cmake-dependencies-cmake">&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
<div class="line-block">
<div class="line">- Sets all subpackage-specific options</div>
</div>
</div>
</div>
<div class="line">e) Write the file <a class="reference internal" href="#project-packagedependencies-xml">&lt;Project&gt;PackageDependencies.xml</a></div>
<div class="line-block">
<div class="line">(specified using <a class="reference external" href="TribitsBuildReference.html#outputting-package-dependency-information">${PROJECT_NAME}_DEPS_XML_OUTPUT_FILE</a>)</div>
</div>
</div>
</div>
<p>When comparing the above reduced dependency processing to the <a class="reference internal" href="#full-processing-of-tribits-project-files">Full Processing
of TriBITS Project Files</a> it is important to note that that several files are
<strong>not</strong> processed in the reduced algorithm shown above.  The files that are
<strong>not</strong> processed include <a class="reference internal" href="#projectdir-version-cmake">&lt;projectDir&gt;/Version.cmake</a>,
<a class="reference internal" href="#repodir-version-cmake">&lt;repoDir&gt;/Version.cmake</a> and
<a class="reference internal" href="#repodir-cmake-callbacksetupextraoptions-cmake">&lt;repoDir&gt;/cmake/CallbackSetupExtraOptions.cmake</a> (in addition to not
processing any of the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> files obviously).  Therefore, one
cannot put anything in these non-processed files that would impact the
definition of TriBITS repositories, packages, TPLs, etc.  Anything that would
affect the dependencies data-structure that gets written out as
<a class="reference internal" href="#project-packagedependencies-xml">&lt;Project&gt;PackageDependencies.xml</a> must be contained in the files that are
processed shown in the reduced processing above.</p>
<p>Debugging issues with <a class="reference internal" href="#reduced-dependency-processing-of-tribits-project-files">Reduced Dependency Processing of TriBITS Project
Files</a> is more difficult because one cannot easily turn on <a class="reference internal" href="#file-processing-tracing">File Processing
Tracing</a> like one can when doing the full CMake configure.  However, options
may be added to the various tools to show this file processing and help debug
problems.</p>
</section>
<section id="file-processing-tracing">
<h3><a class="toc-backref" href="#id30">File Processing Tracing</a><a class="headerlink" href="#file-processing-tracing" title="Permalink to this heading"></a></h3>
<p>In order to aid in debugging problems with <a class="reference internal" href="#full-tribits-project-configuration">Full TriBITS Project
Configuration</a> and <a class="reference internal" href="#reduced-package-dependency-processing">Reduced Package Dependency Processing</a>, TriBITS defines
the CMake cache option <a class="reference external" href="TribitsBuildReference.html#project-trace-file-processing">${PROJECT_NAME}_TRACE_FILE_PROCESSING</a>.  When
enabled, TriBITS will print out when any of the project-related,
repository-related, or package-related file is being processed by TriBITS.
When <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TRACE_FILE_PROCESSING=ON</span></code>, lines starting with <code class="docutils literal notranslate"><span class="pre">&quot;--</span>
<span class="pre">File</span> <span class="pre">Trace:&quot;</span></code> are printed to <code class="docutils literal notranslate"><span class="pre">cmake</span></code> stdout for files that TriBITS
automatically processes where there may be any confusion about what files are
processed and when.</p>
<p>For example, for <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>, the configure file trace for the
configure command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cmake \
  -DTribitsExProj_TRIBITS_DIR=&lt;tribitsDir&gt; \
  -DTribitsExProj_ENABLE_MPI=ON \
  -DTribitsExProj_ENABLE_ALL_PACKAGES=ON \
  -DTribitsExProj_ENABLE_TESTS=ON \
  -DTribitsExProj_TRACE_FILE_PROCESSING=ON \
  -DTribitsExProj_ENABLE_CPACK_PACKAGING=ON \
  -DTribitsExProj_DUMP_CPACK_SOURCE_IGNORE_FILES=ON \
  &lt;tribitsDir&gt;/doc/TribitsExampleProject \
  | grep &quot;^-- File Trace:&quot;
</pre></div>
</div>
<p>looks something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">PROJECT</span>    <span class="n">INCLUDE</span>    <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">Version</span><span class="o">.</span><span class="n">cmake</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">REPOSITORY</span> <span class="n">INCLUDE</span>    <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="n">CallbackSetupExtraOptions</span><span class="o">.</span><span class="n">cmake</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">REPOSITORY</span> <span class="n">INCLUDE</span>    <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">PackagesList</span><span class="o">.</span><span class="n">cmake</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">REPOSITORY</span> <span class="n">INCLUDE</span>    <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">TPLsList</span><span class="o">.</span><span class="n">cmake</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">PACKAGE</span>    <span class="n">INCLUDE</span>    <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">simple_cxx</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="n">Dependencies</span><span class="o">.</span><span class="n">cmake</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">PACKAGE</span>    <span class="n">INCLUDE</span>    <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">mixed_lang</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="n">Dependencies</span><span class="o">.</span><span class="n">cmake</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">PACKAGE</span>    <span class="n">INCLUDE</span>    <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">with_subpackages</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="n">Dependencies</span><span class="o">.</span><span class="n">cmake</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">PACKAGE</span>    <span class="n">INCLUDE</span>    <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">with_subpackages</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="n">Dependencies</span><span class="o">.</span><span class="n">cmake</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">PACKAGE</span>    <span class="n">INCLUDE</span>    <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">with_subpackages</span><span class="o">/</span><span class="n">b</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="n">Dependencies</span><span class="o">.</span><span class="n">cmake</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">PACKAGE</span>    <span class="n">INCLUDE</span>    <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">with_subpackages</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="n">Dependencies</span><span class="o">.</span><span class="n">cmake</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">PACKAGE</span>    <span class="n">INCLUDE</span>    <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">wrap_external</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="n">Dependencies</span><span class="o">.</span><span class="n">cmake</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">PROJECT</span>    <span class="n">CONFIGURE</span>  <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="n">ctest</span><span class="o">/</span><span class="n">CTestCustom</span><span class="o">.</span><span class="n">cmake</span><span class="o">.</span><span class="ow">in</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">REPOSITORY</span> <span class="n">READ</span>       <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">Copyright</span><span class="o">.</span><span class="n">txt</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">REPOSITORY</span> <span class="n">INCLUDE</span>    <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">Version</span><span class="o">.</span><span class="n">cmake</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">PACKAGE</span>    <span class="n">ADD_SUBDIR</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">simple_cxx</span><span class="o">/</span><span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">PACKAGE</span>    <span class="n">ADD_SUBDIR</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">simple_cxx</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">PACKAGE</span>    <span class="n">ADD_SUBDIR</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">mixed_lang</span><span class="o">/</span><span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">PACKAGE</span>    <span class="n">ADD_SUBDIR</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">mixed_lang</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">PACKAGE</span>    <span class="n">ADD_SUBDIR</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">with_subpackages</span><span class="o">/</span><span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">PACKAGE</span>    <span class="n">ADD_SUBDIR</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">with_subpackages</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">PACKAGE</span>    <span class="n">ADD_SUBDIR</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">with_subpackages</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">PACKAGE</span>    <span class="n">ADD_SUBDIR</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">with_subpackages</span><span class="o">/</span><span class="n">b</span><span class="o">/</span><span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">PACKAGE</span>    <span class="n">ADD_SUBDIR</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">with_subpackages</span><span class="o">/</span><span class="n">b</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">PACKAGE</span>    <span class="n">ADD_SUBDIR</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">with_subpackages</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">PACKAGE</span>    <span class="n">ADD_SUBDIR</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">with_subpackages</span><span class="o">/</span><span class="n">c</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">PROJECT</span>    <span class="n">INCLUDE</span>    <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="n">CallbackDefineProjectPackaging</span><span class="o">.</span><span class="n">cmake</span>
<span class="o">--</span> <span class="n">File</span> <span class="n">Trace</span><span class="p">:</span> <span class="n">REPOSITORY</span> <span class="n">INCLUDE</span>    <span class="p">[</span><span class="o">...</span><span class="p">]</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="n">CallbackDefineRepositoryPackaging</span><span class="o">.</span><span class="n">cmake</span>
</pre></div>
</div>
<p>However, every file that TriBITS processes is not printed in this file trace
if it should be obvious that the file is being processed.  For example, the
package’s configured header file created using <a class="reference internal" href="#tribits-configure-file">tribits_configure_file()</a>
does not result in a file trace print statement because this is an
unconditional command that is explicitly called in one of the package’s
<code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> files so it should be clear that this file is being
processed and exactly when it is processed.</p>
</section>
</section>
<section id="coexisting-projects-repositories-and-packages">
<h2><a class="toc-backref" href="#id31"><span class="sectnum">3.3</span> Coexisting Projects, Repositories, and Packages</a><a class="headerlink" href="#coexisting-projects-repositories-and-packages" title="Permalink to this heading"></a></h2>
<p>Certain simplifications are allowed when defining TriBITS projects,
repositories and packages.  The known allowed simplifications are described
below.</p>
<p><strong>TriBITS Repository Dir == TriBITS Project Dir</strong>: It is allowed for a TriBITS
Project and a TriBITS Repository to be the same source directory and in fact
this is the default for every TriBITS project (unless the
<a class="reference internal" href="#projectdir-cmake-nativerepositorieslist-cmake">&lt;projectDir&gt;/cmake/NativeRepositoriesList.cmake</a> is defined).  In this case,
the repository name <a class="reference internal" href="#repository-name">REPOSITORY_NAME</a> and the project name <a class="reference internal" href="#project-name">PROJECT_NAME</a>
are the same as well.  This is quite common and is in fact the default that
every TriBITS Project is also a TriBITS repository (and therefore must contain
<a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> and <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> files).  This
is the case, for example, with the <a class="reference internal" href="#trilinos">Trilinos</a> and the
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a> projects and repositories.  In this case, the
Project’s and the Repository’s <code class="docutils literal notranslate"><span class="pre">Version.cmake</span></code> and <code class="docutils literal notranslate"><span class="pre">Copyright.txt</span></code> files
are also one and the same, as they should be (see <a class="reference internal" href="#project-and-repository-versioning-and-release-mode">Project and Repository
Versioning and Release Mode</a>).</p>
<p><strong>TriBITS Package Dir == TriBITS Repository Dir</strong>: It is also allowed for a
TriBITS Repository to have only one package and to have that package be the
base repository directory.  The TriBITS Repository and the single TriBITS
Package would typically have the same name in this case (but that is actually
not required but it is confusing if they are not the same).  For example, in
the TriBITS test project <a class="reference internal" href="#mocktrilinos">MockTrilinos</a>, the repository and package
<code class="docutils literal notranslate"><span class="pre">extraRepoOnePackage</span></code> are the same directory.  In this case, the file
<code class="docutils literal notranslate"><span class="pre">extraRepoOnePackage/PackagesList.cmake</span></code> looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_repository_define_packages</span><span class="p">(</span>
  <span class="n">extraRepoOnePackage</span>   <span class="o">.</span>     <span class="n">ST</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>(Note the dot <code class="docutils literal notranslate"><span class="pre">'.'</span></code> for the package directory.)</p>
<p>This is also how the real TriBITS repository and package <a class="reference external" href="https://github.com/CNERG/DataTransferKit">DataTransferKit</a> is
set up (at least that is the way it was when this document was first written).</p>
<p>However, to maximize flexibility, it is recommended that a TriBITS package and
its TriBITS repository <strong>not</strong> share the same directory or the same name.
This allows a TriBITS repository to define more packages later.</p>
<p id="tribits-package-tribits-repository-tribits-project"><strong>TriBITS Package Dir == TriBITS Repository Dir == TriBITS Project Dir</strong>: In
the extreme, it is possible to collapse a single TriBITS package, repository,
and project into the same base source directory.  They can also share the same
name for the package, repository and package.  One example of this is the
<code class="docutils literal notranslate"><span class="pre">TriBITS</span></code> project and <a class="reference internal" href="#the-tribits-test-package">The TriBITS Test Package</a> themselves, which are both
rooted in the base <code class="docutils literal notranslate"><span class="pre">TriBITS/</span></code> source directory of the stand-alone TriBITS
repository.  There are a few restrictions and modifications needed to get this
to work:</p>
<ul class="simple">
<li><p>The base <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file must be modified to allow it to be
processed both as the base project <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file and as the
package’s base <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file.  In the case of
<code class="docutils literal notranslate"><span class="pre">TriBITS/CMakeLists.txt</span></code>, a big if statement is used.</p></li>
</ul>
<p>Other than that simple modification to the top-level <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file,
a TriBITS project, repository, and package can all be rooted in the same
source directory.</p>
<p>The primary use case for collapsing a project, repository, and package into a
single base source directory would be to support the stand-alone build of a
TriBITS package as its own entity that uses an independent installation of the
TriBITS (or a minimal snapshot of TriBITS).  If a given TriBITS package has no
required <a class="reference internal" href="#upstream">upstream</a> TriBITS package dependencies and minimal TPL dependencies
(or only uses <a class="reference internal" href="#standard-tribits-tpls">Standard TriBITS TPLs</a> or <a class="reference internal" href="#common-tribits-tpls">Common TriBITS TPLs</a> already
defined in the <code class="docutils literal notranslate"><span class="pre">tribits/core/std_tpls/</span></code> or <code class="docutils literal notranslate"><span class="pre">tribits/common_tpls/</span></code>
directories), then creating a stand-alone project build of a single TriBITS
package requires fairly little extra overhead or duplication.</p>
</section>
<section id="standard-and-common-tpls">
<h2><a class="toc-backref" href="#id32"><span class="sectnum">3.4</span> Standard and Common TPLs</a><a class="headerlink" href="#standard-and-common-tpls" title="Permalink to this heading"></a></h2>
<p>While a TriBITS Repository can define their own TPLs and their own TPL find
modules (see <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>), the TriBITS source tree contains the find
modules for a few different standard TPLs and common TPLs.  <a class="reference internal" href="#standard-tribits-tpls">Standard TriBITS
TPLs</a> are integral to the TriBITS system itself while <a class="reference internal" href="#common-tribits-tpls">Common TriBITS TPLs</a>
are TPL that are used in several different TriBITS Repositories and are
contained in TriBITS for convenience and uniformity.</p>
<section id="standard-tribits-tpls">
<h3><a class="toc-backref" href="#id33">Standard TriBITS TPLs</a><a class="headerlink" href="#standard-tribits-tpls" title="Permalink to this heading"></a></h3>
<p>TriBITS contains find modules for a few standard TPLs integral to the TriBITS
system.  The standard TriBITS TPLs are contained under the directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">std_tpls</span><span class="o">/</span>
</pre></div>
</div>
<p>The current list of standard TriBITS TPL find modules is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FindTPLCUDA</span><span class="o">.</span><span class="n">cmake</span>
<span class="n">FindTPLMPI</span><span class="o">.</span><span class="n">cmake</span>
</pre></div>
</div>
<p>The TPLs <code class="docutils literal notranslate"><span class="pre">MPI</span></code> and <code class="docutils literal notranslate"><span class="pre">CUDA</span></code> are standard because they are special in that
they define compilers and other special tools that are used in
<a class="reference internal" href="#tribits-add-library">tribits_add_library()</a>, <a class="reference internal" href="#tribits-add-executable">tribits_add_executable()</a>, <a class="reference internal" href="#tribits-add-test">tribits_add_test()</a>
and other commands.</p>
<p>These standard TPLs are used in a <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_repository_define_tpls</span><span class="p">(</span>
  <span class="n">MPI</span>   <span class="s2">&quot;${$</span><span class="si">{PROJECT_NAME}</span><span class="s2">_TRIBITS_DIR}/core/std_tpls/&quot;</span>  <span class="n">PT</span>
  <span class="n">CUDA</span>  <span class="s2">&quot;${$</span><span class="si">{PROJECT_NAME}</span><span class="s2">_TRIBITS_DIR}/core/std_tpls/&quot;</span>  <span class="n">ST</span>
  <span class="o">...</span>
  <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="common-tribits-tpls">
<h3><a class="toc-backref" href="#id34">Common TriBITS TPLs</a><a class="headerlink" href="#common-tribits-tpls" title="Permalink to this heading"></a></h3>
<p>TriBITS also contains find modules for several TPLs that are used across many
independent TriBITS repositories.  The goal of maintaining these under TriBITS
is to enforce conformity in case these independent repositories are combined
into a single meta-project.</p>
<p>The common TriBITS TPLs are contained under the directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits</span><span class="o">/</span><span class="n">common_tpls</span><span class="o">/</span>
</pre></div>
</div>
<p>The current list of common TriBITS TPL find modules is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FindTPLBLAS</span><span class="o">.</span><span class="n">cmake</span>
<span class="n">FindTPLBinUtils</span><span class="o">.</span><span class="n">cmake</span>
<span class="n">FindTPLBoost</span><span class="o">.</span><span class="n">cmake</span>
<span class="n">FindTPLCGNS</span><span class="o">.</span><span class="n">cmake</span>
<span class="n">FindTPLCGNSDependencies</span><span class="o">.</span><span class="n">cmake</span>
<span class="n">FindTPLHDF5</span><span class="o">.</span><span class="n">cmake</span>
<span class="n">FindTPLLAPACK</span><span class="o">.</span><span class="n">cmake</span>
<span class="n">FindTPLNetcdf</span><span class="o">.</span><span class="n">cmake</span>
<span class="n">FindTPLPETSC</span><span class="o">.</span><span class="n">cmake</span>
<span class="n">FindTPLPnetcdf</span><span class="o">.</span><span class="n">cmake</span>
<span class="n">FindTPLProjectLastLib</span><span class="o">.</span><span class="n">cmake</span>
<span class="n">find_modules</span>
<span class="n">utils</span>
</pre></div>
</div>
<p>Common TPLs are used in a <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_repository_define_tpls</span><span class="p">(</span>
  <span class="n">BLAS</span>   <span class="s2">&quot;${$</span><span class="si">{PROJECT_NAME}</span><span class="s2">_TRIBITS_DIR}/common_tpls/&quot;</span>  <span class="n">PT</span>
  <span class="n">LAPACK</span>  <span class="s2">&quot;${$</span><span class="si">{PROJECT_NAME}</span><span class="s2">_TRIBITS_DIR}/common_tpls/&quot;</span>  <span class="n">PT</span>
  <span class="o">...</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>By using a standard TPL definition, it is guaranteed that the TPL used will be
consistent with all of the TriBITS packages that depend on these TPLs in case
they are combined into a single project.</p>
<p>Note that just because packages in two different TriBITS repositories
reference the same TPL does not necessarily mean that it needs to be moved
into the TriBITS source tree under <code class="docutils literal notranslate"><span class="pre">tribits/common_tpls/</span></code>.  For example, if
the TPL <code class="docutils literal notranslate"><span class="pre">QT</span></code> is defined in an <a class="reference internal" href="#upstream">upstream</a> repository (e.g. Trilinos), then a
package in a <a class="reference internal" href="#downstream">downstream</a> repository can list a dependency on the TPL <code class="docutils literal notranslate"><span class="pre">QT</span></code>
without having to define its own <code class="docutils literal notranslate"><span class="pre">QT</span></code> TPL in its repository’s
<a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file.  For more details, see <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>.</p>
</section>
</section>
</section>
<section id="example-tribits-projects">
<h1><a class="toc-backref" href="#id35"><span class="sectnum">4</span> Example TriBITS Projects</a><a class="headerlink" href="#example-tribits-projects" title="Permalink to this heading"></a></h1>
<p>In this section, a few different example TriBITS projects and packages are
previewed.  Most of these examples exist in the TriBITS source directory
<code class="docutils literal notranslate"><span class="pre">tribits</span></code> itself so they are available to all users of TriBITS.  These
examples also provide a means to test the TriBITS system itself (see <a class="reference internal" href="#the-tribits-test-package">The
TriBITS Test Package</a>).</p>
<p>The first example covered is the bare bones <a class="reference internal" href="#tribitshelloworld">TribitsHelloWorld</a> example
project.  The second example covered in detail is <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>.
This example covers all the basics for setting up a simple multi-package
TriBITS project.  The third example outlined is <a class="reference internal" href="#mocktrilinos">MockTrilinos</a> which mostly
exists to test the TriBITS system itself but also contains some nice examples
of a few different TriBITS features and behaviors.  The forth example is the
<a class="reference internal" href="#reducedmocktrilinos">ReducedMockTrilinos</a> project which is used to demonstrate TriBITS behavior
in this document.  Also mentioned is the <a class="reference internal" href="#trilinos">Trilinos</a> project itself which can
be a useful example of the usage of TriBITS (see disclaimers in the section
<a class="reference internal" href="#trilinos">Trilinos</a>).  The last example mentioned is <a class="reference internal" href="#the-tribits-test-package">The TriBITS Test Package</a>
itself which allows the TriBITS system to be tested and installed from any
TriBITS project that lists it, including the <code class="docutils literal notranslate"><span class="pre">TriBITS</span></code> project itself
(see <a class="reference internal" href="#coexisting-projects-repositories-and-packages">Coexisting Projects, Repositories, and Packages</a>).</p>
<p>The directory <code class="docutils literal notranslate"><span class="pre">tribits/examples/</span></code> contains some other example TriBITS
projects and repositories as well that are referred to in this and other
documents.</p>
<section id="tribitshelloworld">
<h2><a class="toc-backref" href="#id36"><span class="sectnum">4.1</span> TribitsHelloWorld</a><a class="headerlink" href="#tribitshelloworld" title="Permalink to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">TribitsHelloWorld</span></code> is about the simplest possible TriBITS project that you
can imagine and is contained under the directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">TribitsHelloWorld</span><span class="o">/</span>
</pre></div>
</div>
<p>This example project contains only a single TriBITS package and no frills at
all (does not support MPI or Fortran).  However, it does show how minimal a
<a class="reference internal" href="#tribits-project">TriBITS Project</a> (which is also a <a class="reference internal" href="#tribits-repository">TriBITS Repository</a>) and a <a class="reference internal" href="#tribits-package">TriBITS
Package</a> can be and still demonstrates some of the value of TriBITS over raw
CMake.  The simple <code class="docutils literal notranslate"><span class="pre">HelloWorld</span></code> package is used to compare with the raw
CMakeLists.txt file in the <code class="docutils literal notranslate"><span class="pre">RawHeloWorld</span></code> example project in the <a class="reference external" href="../overview/TribitsOverview.pdf">TriBITS
Overview</a> document.</p>
<p>The directory structure for this example his shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">TribitsHelloWorld</span><span class="o">/</span>
    <span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
    <span class="n">PackagesList</span><span class="o">.</span><span class="n">cmake</span>
    <span class="n">ProjectName</span><span class="o">.</span><span class="n">cmake</span>
    <span class="n">README</span>
    <span class="n">TPLsList</span><span class="o">.</span><span class="n">cmake</span>
    <span class="n">hello_world</span><span class="o">/</span>
      <span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
      <span class="n">cmake</span><span class="o">/</span>
        <span class="n">Dependencies</span><span class="o">.</span><span class="n">cmake</span>
      <span class="n">hello_world_lib</span><span class="o">.</span><span class="n">cpp</span>
      <span class="n">hello_world_lib</span><span class="o">.</span><span class="n">hpp</span>
      <span class="n">hello_world_main</span><span class="o">.</span><span class="n">cpp</span>
      <span class="n">hello_world_unit_tests</span><span class="o">.</span><span class="n">cpp</span>
</pre></div>
</div>
<p>This has all of the required <a class="reference internal" href="#tribits-project-core-files">TriBITS Project Core Files</a>, <a class="reference internal" href="#tribits-repository-core-files">TriBITS
Repository Core Files</a>, and <a class="reference internal" href="#tribits-package-core-files">TriBITS Package Core Files</a>.  It just builds a
simple library, a simple executable, a test executable, and the tests them as
shown by the file <code class="docutils literal notranslate"><span class="pre">TribitsHelloWorld/hello_world/CMakeLists.txt</span></code> which is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_package</span><span class="p">(</span><span class="n">HelloWorld</span><span class="p">)</span>
<span class="n">tribits_add_library</span><span class="p">(</span><span class="n">hello_world_lib</span>
  <span class="n">HEADERS</span> <span class="n">hello_world_lib</span><span class="o">.</span><span class="n">hpp</span> <span class="n">SOURCES</span> <span class="n">hello_world_lib</span><span class="o">.</span><span class="n">cpp</span><span class="p">)</span>
<span class="n">tribits_add_executable</span><span class="p">(</span><span class="n">hello_world</span> <span class="n">NOEXEPREFIX</span> <span class="n">SOURCES</span> <span class="n">hello_world_main</span><span class="o">.</span><span class="n">cpp</span>
  <span class="n">INSTALLABLE</span><span class="p">)</span>
<span class="n">tribits_add_test</span><span class="p">(</span><span class="n">hello_world</span> <span class="n">NOEXEPREFIX</span> <span class="n">PASS_REGULAR_EXPRESSION</span> <span class="s2">&quot;Hello World&quot;</span><span class="p">)</span>
<span class="n">tribits_add_executable_and_test</span><span class="p">(</span><span class="n">unit_tests</span> <span class="n">SOURCES</span> <span class="n">hello_world_unit_tests</span><span class="o">.</span><span class="n">cpp</span>
  <span class="n">PASS_REGULAR_EXPRESSION</span> <span class="s2">&quot;All unit tests passed&quot;</span><span class="p">)</span>
<span class="n">tribits_package_postprocess</span><span class="p">()</span>
</pre></div>
</div>
<p>The build and test of this simple project is tested in the <a class="reference internal" href="#the-tribits-test-package">The TriBITS Test
Package</a> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TriBITS</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">ExamplesUnitTests</span><span class="o">/</span><span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>Note that this little example is a fully functional <a class="reference internal" href="#tribits-repository">TriBITS Repository</a> and
can be embedded in to a larger TriBITS meta-project and be seamlessly built
along with any other such TriBITS-based software.</p>
</section>
<section id="tribitsexampleproject">
<h2><a class="toc-backref" href="#id37"><span class="sectnum">4.2</span> TribitsExampleProject</a><a class="headerlink" href="#tribitsexampleproject" title="Permalink to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">TribitsExampleProject</span></code> in an example <a class="reference internal" href="#tribits-project">TriBITS Project</a> and <a class="reference internal" href="#tribits-repository">TriBITS
Repository</a> contained in the TriBITS source tree under:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">TribitsExampleProject</span><span class="o">/</span>
</pre></div>
</div>
<p>When this is used as the base TriBITS project, this is the directory
corresponds to <code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;</span></code> referenced in <a class="reference internal" href="#tribits-project-core-files">TriBITS
Project Core Files</a> and <a class="reference internal" href="#tribits-repository-core-files">TriBITS Repository Core Files</a>, respectively.</p>
<p>Several files from this project are used as examples in the section <a class="reference internal" href="#tribits-project-structure">TriBITS
Project Structure</a>.  Here, a fuller description is given of this project and
a demonstration of how TriBITS works.  From this simple example project, one
can quickly see how the basic structural elements of a TriBITS project,
repository, and package (and subpackage) are pulled together.</p>
<p>This simple project shows how what is listed in files:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a>,</p></li>
<li><p><a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a>, and</p></li>
<li><p><a class="reference internal" href="#packagedir-spkgdir-cmake-dependencies-cmake">&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</a></p></li>
</ul>
<p>are used to specify the packages and SE packages in a TriBITS project and
repository.  More details about the contents of the <code class="docutils literal notranslate"><span class="pre">Dependencies.cmake</span></code>
files is described in the section <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package Dependencies and Enable/Disable
Logic</a>.</p>
<p>The name of this project <code class="docutils literal notranslate"><span class="pre">PROJECT_NAME</span></code> is given in its
<code class="docutils literal notranslate"><span class="pre">TribitsExampleProject/ProjectName.cmake</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Must set the project name at very beginning before including anything else
set(PROJECT_NAME TribitsExProj)

# Turn on export dependency generation for WrapExteranl package
set(${PROJECT_NAME}_GENERATE_EXPORT_FILE_DEPENDENCIES_DEFAULT ON)

# Turn on by default the generation of the export files
set(${PROJECT_NAME}_ENABLE_INSTALL_CMAKE_CONFIG_FILES_DEFAULT ON)
</pre></div>
</div>
<p>The variable <code class="docutils literal notranslate"><span class="pre">PROJECT_NAME=TribitsExProj</span></code> is used to prefix (using
<code class="docutils literal notranslate"><span class="pre">&quot;${PROJECT_NAME}_&quot;</span></code>) all of the project’s global TriBITS variables like
<code class="docutils literal notranslate"><span class="pre">TribitsExProj_ENABLE_TESTS</span></code>, <code class="docutils literal notranslate"><span class="pre">TribitsExProj_ENABLE_ALL_PACKAGES</span></code>, etc.</p>
<p id="tribitsexampleproject-files-and-directories">The directory structure and key files for this example project are shown in
the partial list of <a class="reference internal" href="#tribitsexampleproject-files-and-directories">TribitsExampleProject Files and Directories</a> below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TribitsExampleProject</span><span class="o">/</span>
  <span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
  <span class="n">Copyright</span><span class="o">.</span><span class="n">txt</span>
  <span class="n">PackagesList</span><span class="o">.</span><span class="n">cmake</span>
  <span class="n">ProjectName</span><span class="o">.</span><span class="n">cmake</span>
  <span class="n">project</span><span class="o">-</span><span class="n">checkin</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">config</span><span class="o">.</span><span class="n">py</span>
  <span class="n">TPLsList</span><span class="o">.</span><span class="n">cmake</span>
  <span class="n">Version</span><span class="o">.</span><span class="n">cmake</span>
  <span class="o">...</span>
  <span class="n">cmake</span><span class="o">/</span>
    <span class="n">CallbackDefineProjectPackaging</span><span class="o">.</span><span class="n">cmake</span>
    <span class="n">CallbackDefineRepositoryPackaging</span><span class="o">.</span><span class="n">cmake</span>
    <span class="n">CallbackSetupExtraOptions</span><span class="o">.</span><span class="n">cmake</span>
  <span class="n">packages</span><span class="o">/</span>
    <span class="n">simple_cxx</span><span class="o">/</span>
      <span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
      <span class="n">cmake</span><span class="o">/</span>
        <span class="n">CheckFor__int64</span><span class="o">.</span><span class="n">cmake</span>
        <span class="n">Dependencies</span><span class="o">.</span><span class="n">cmake</span>
        <span class="n">SimpleCxx_config</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="ow">in</span>
      <span class="n">src</span><span class="o">/</span>
        <span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
        <span class="n">SimpleCxx_HelloWorld</span><span class="o">.</span><span class="n">cpp</span>
        <span class="n">SimpleCxx_HelloWorld</span><span class="o">.</span><span class="n">hpp</span>
      <span class="n">test</span><span class="o">/</span>
        <span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
        <span class="n">SimpleCxx_HelloWorld_Tests</span><span class="o">.</span><span class="n">cpp</span>
    <span class="n">mixed_lang</span><span class="o">/</span> <span class="o">...</span>
    <span class="n">with_subpackages</span><span class="o">/</span>
      <span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
      <span class="n">cmake</span><span class="o">/</span>
        <span class="n">Dependencies</span><span class="o">.</span><span class="n">cmake</span>
      <span class="n">A</span><span class="o">/</span>
        <span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
        <span class="n">cmake</span><span class="o">/</span>
          <span class="n">Dependencies</span><span class="o">.</span><span class="n">cmake</span>
        <span class="o">...</span>
      <span class="n">B</span><span class="o">/</span> <span class="o">...</span>
      <span class="n">C</span><span class="o">/</span> <span class="o">...</span>
    <span class="n">wrap_external</span><span class="o">/</span> <span class="o">...</span>
</pre></div>
</div>
<p>Above, the sub-directories under <code class="docutils literal notranslate"><span class="pre">packages/</span></code> are sorted according to the
order listed in the <code class="docutils literal notranslate"><span class="pre">TribitsExampleProject/PackagesList.cmake</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_repository_define_packages</span><span class="p">(</span>
  <span class="n">SimpleCxx</span>          <span class="n">packages</span><span class="o">/</span><span class="n">simple_cxx</span>         <span class="n">PT</span>
  <span class="n">MixedLang</span>          <span class="n">packages</span><span class="o">/</span><span class="n">mixed_lang</span>         <span class="n">PT</span>
  <span class="n">InsertedPkg</span>        <span class="n">InsertedPkg</span>                 <span class="n">ST</span>
  <span class="n">WithSubpackages</span>    <span class="n">packages</span><span class="o">/</span><span class="n">with_subpackages</span>   <span class="n">PT</span>
  <span class="n">WrapExternal</span>       <span class="n">packages</span><span class="o">/</span><span class="n">wrap_external</span>      <span class="n">ST</span>
  <span class="p">)</span>

<span class="n">tribits_disable_package_on_platforms</span><span class="p">(</span><span class="n">WrapExternal</span> <span class="n">Windows</span><span class="p">)</span>
<span class="n">tribits_allow_missing_external_packages</span><span class="p">(</span><span class="n">InsertedPkg</span><span class="p">)</span>
</pre></div>
</div>
<p>From this file, we get the list of top-level packages <code class="docutils literal notranslate"><span class="pre">SimpleCxx</span></code>,
<code class="docutils literal notranslate"><span class="pre">MixedLang</span></code>, <code class="docutils literal notranslate"><span class="pre">WithSubpackages</span></code>, and <code class="docutils literal notranslate"><span class="pre">WrapExternal</span></code> (and their base
package directories and testing group, see <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a>).
(NOTE: By default the package <code class="docutils literal notranslate"><span class="pre">InsertedPkg</span></code> is not defined because its
directory is missing, see <a class="reference internal" href="#how-to-insert-a-package-into-an-upstream-repo">How to insert a package into an upstream repo</a>.)</p>
<p>A full listing of package files in <a class="reference internal" href="#tribitsexampleproject-files-and-directories">TribitsExampleProject Files and
Directories</a> is only shown for the <code class="docutils literal notranslate"><span class="pre">SimpleCxx</span></code> package directory
<code class="docutils literal notranslate"><span class="pre">packages/simple_cxx/</span></code>.  For this package, <code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;</span> <span class="pre">=</span>
<span class="pre">&lt;repoDir&gt;/packages/simple_cxx</span></code> and <code class="docutils literal notranslate"><span class="pre">PACKAGE_NAME</span> <span class="pre">=</span> <span class="pre">SimpleCxx</span></code>.  As
explained in <a class="reference internal" href="#tribits-package-core-files">TriBITS Package Core Files</a>, the files
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> and <a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a>
must exist for every package directory listed in
<a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> and we see these files under in the directory
<code class="docutils literal notranslate"><span class="pre">packages/simple_cxx/</span></code>.  The package <code class="docutils literal notranslate"><span class="pre">SimpleCxx</span></code> does not have any
<a class="reference internal" href="#upstream">upstream</a> SE package dependencies.</p>
<p>Now consider the example top-level package <code class="docutils literal notranslate"><span class="pre">WithSubpackages</span></code> which,
as the name suggests, is broken down into subpackages.  The
<code class="docutils literal notranslate"><span class="pre">WithSubpackages</span></code> dependencies file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TribitsExampleProject</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">with_subpackages</span><span class="o">/</span><span class="n">cmake</span><span class="o">/</span><span class="n">Dependencies</span><span class="o">.</span><span class="n">cmake</span>
</pre></div>
</div>
<p>with contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_package_define_dependencies</span><span class="p">(</span>
  <span class="n">SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS</span>
    <span class="n">A</span>   <span class="n">a</span>   <span class="n">PT</span>  <span class="n">REQUIRED</span>
    <span class="n">B</span>   <span class="n">b</span>   <span class="n">ST</span>  <span class="n">OPTIONAL</span>
    <span class="n">C</span>   <span class="n">c</span>   <span class="n">ST</span>  <span class="n">OPTIONAL</span>
  <span class="n">REGRESSION_EMAIL_LIST</span> <span class="n">with_packages</span><span class="o">-</span><span class="n">regressions</span><span class="nd">@someurl</span><span class="o">.</span><span class="n">none</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>references the three subpackages with sub-directories <code class="docutils literal notranslate"><span class="pre">&lt;spkgDir&gt;</span></code> = <code class="docutils literal notranslate"><span class="pre">A</span></code>,
<code class="docutils literal notranslate"><span class="pre">B</span></code>, and <code class="docutils literal notranslate"><span class="pre">C</span></code> under the parent package directory
<code class="docutils literal notranslate"><span class="pre">packages/package_with_packages/</span></code> which are shown in <a class="reference internal" href="#tribitsexampleproject-files-and-directories">TribitsExampleProject
Files and Directories</a>.  This gives another set of three SE packages
<code class="docutils literal notranslate"><span class="pre">WithSubpackagesA</span></code>, <code class="docutils literal notranslate"><span class="pre">WithSubpackagesB</span></code>,
and <code class="docutils literal notranslate"><span class="pre">WithSubpackagesC</span></code>.  Combining <code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;</span> <span class="pre">=</span>
<span class="pre">packages/package_with_packages</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;spkgDir&gt;</span></code> for each subpackage gives
the subpackage directories:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TribitsExampleProject</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">with_subpackages</span><span class="o">/</span><span class="n">a</span><span class="o">/</span>
<span class="n">TribitsExampleProject</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">with_subpackages</span><span class="o">/</span><span class="n">b</span><span class="o">/</span>
<span class="n">TribitsExampleProject</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">with_subpackages</span><span class="o">/</span><span class="n">c</span><span class="o">/</span>
</pre></div>
</div>
<p>Together with the top-level parent SE package <code class="docutils literal notranslate"><span class="pre">WithSubpackages</span></code>
itself, this top-level package provides four <a class="reference internal" href="#tribits-se-packages">TriBITS SE Packages</a> giving the
final list of SE packages provided by this TriBITS repo as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SimpleCxx</span> <span class="n">MixedLang</span> <span class="n">WithSubpackagesA</span> <span class="n">WithSubpackagesB</span> <span class="n">WithSubpackagesC</span> \
  <span class="n">WithSubpackages</span> <span class="n">WrapExternal</span> <span class="mi">7</span>
</pre></div>
</div>
<p>The above list of SE packages is printed (with the number of packages printed
at the end) by TriBITS to the <code class="docutils literal notranslate"><span class="pre">cmake</span></code> stdout on the line starting with
<code class="docutils literal notranslate"><span class="pre">&quot;Final</span> <span class="pre">set</span> <span class="pre">of</span> <span class="pre">non-enabled</span> <span class="pre">SE</span> <span class="pre">packages:&quot;</span></code> when no packages are enabled (see
<a class="reference external" href="TribitsBuildReference.html#selecting-the-list-of-packages-to-enable">Selecting the list of packages to enable</a>).  (Note that TriBITS does not put
in line-brakes with continuation characters <code class="docutils literal notranslate"><span class="pre">&quot;\&quot;</span></code> as shown above.)  TriBITS
defines enable/disable cache variables for each of these defined SE packages
like <code class="docutils literal notranslate"><span class="pre">TribitsExProj_ENABLE_SimpleCxx</span></code> and
<code class="docutils literal notranslate"><span class="pre">TribitsExProj_ENABLE_WithSubpackagesA</span></code>, and defines all
the variables listed in <a class="reference internal" href="#tribits-package-cache-variables">TriBITS Package Cache Variables</a> that are settable
by the users or by the dependency logic described in section <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package
Dependencies and Enable/Disable Logic</a>.</p>
<p>When starting a new TriBITS project, repository, or package, one should
consider basing these on the examples in <code class="docutils literal notranslate"><span class="pre">TribitsExampleProject</span></code>.  In fact,
the skeletons for any of the</p>
<ul class="simple">
<li><p><a class="reference internal" href="#tribits-project-core-files">TriBITS Project Core Files</a>,</p></li>
<li><p><a class="reference internal" href="#tribits-repository-core-files">TriBITS Repository Core Files</a>,</p></li>
<li><p><a class="reference internal" href="#tribits-package-core-files">TriBITS Package Core Files</a>, or</p></li>
<li><p><a class="reference internal" href="#tribits-subpackage-core-files">TriBITS Subpackage Core Files</a></p></li>
</ul>
<p>should be copied from this example project as they represent best practice
when using TriBITS for the typical use cases.</p>
</section>
<section id="mocktrilinos">
<h2><a class="toc-backref" href="#id38"><span class="sectnum">4.3</span> MockTrilinos</a><a class="headerlink" href="#mocktrilinos" title="Permalink to this heading"></a></h2>
<p>The TriBITS project <code class="docutils literal notranslate"><span class="pre">MockTrilinos</span></code> is contained under the directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">MockTrilinos</span><span class="o">/</span>
</pre></div>
</div>
<p>This TriBITS project is not a full TriBITS project (i.e. it does not build
anything).  Instead, it is primarily used to test the TriBITS system using
tests defined in the <a class="reference internal" href="#the-tribits-test-package">The TriBITS Test Package</a>.  The <code class="docutils literal notranslate"><span class="pre">MockTrilinos</span></code>
project is actually given the name <code class="docutils literal notranslate"><span class="pre">PROJECT_NAME</span> <span class="pre">=</span> <span class="pre">Trilinos</span></code> and contains a
subset of Trilinos packages with slightly modified dependencies from a real
version of the Trilinos project from May 2009.  The list of packages in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">MockTrilinos</span><span class="o">/</span><span class="n">PackagesList</span><span class="o">.</span><span class="n">cmake</span>
</pre></div>
</div>
<p>is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_repository_define_packages</span><span class="p">(</span>
  <span class="n">TrilinosFramework</span>   <span class="n">cmake</span>                           <span class="n">PT</span>
  <span class="n">Teuchos</span>             <span class="n">packages</span><span class="o">/</span><span class="n">teuchos</span>                <span class="n">PT</span>
  <span class="n">RTOp</span>                <span class="n">packages</span><span class="o">/</span><span class="n">rtop</span>                   <span class="n">PT</span>
  <span class="n">Epetra</span>              <span class="n">packages</span><span class="o">/</span><span class="n">epetra</span>                 <span class="n">PT</span>
  <span class="n">Zoltan</span>              <span class="n">packages</span><span class="o">/</span><span class="n">zoltan</span>                 <span class="n">PT</span>
  <span class="n">Shards</span>              <span class="n">packages</span><span class="o">/</span><span class="n">shards</span>                 <span class="n">PT</span>
  <span class="n">Triutils</span>            <span class="n">packages</span><span class="o">/</span><span class="n">triutils</span>               <span class="n">PT</span>
  <span class="n">Tpetra</span>              <span class="n">packages</span><span class="o">/</span><span class="n">tpetra</span>                 <span class="n">PT</span>
  <span class="n">EpetraExt</span>           <span class="n">packages</span><span class="o">/</span><span class="n">epetraext</span>              <span class="n">PT</span>
  <span class="n">Stokhos</span>             <span class="n">packages</span><span class="o">/</span><span class="n">stokhos</span>                <span class="n">EX</span>
  <span class="n">Sacado</span>              <span class="n">packages</span><span class="o">/</span><span class="n">sacado</span>                 <span class="n">ST</span>
  <span class="n">Thyra</span>               <span class="n">packages</span><span class="o">/</span><span class="n">thyra</span>                  <span class="n">PT</span>
  <span class="n">Isorropia</span>           <span class="n">packages</span><span class="o">/</span><span class="n">isorropia</span>              <span class="n">PT</span>
  <span class="n">AztecOO</span>             <span class="n">packages</span><span class="o">/</span><span class="n">aztecoo</span>                <span class="n">PT</span>
  <span class="n">Galeri</span>              <span class="n">packages</span><span class="o">/</span><span class="n">galeri</span>                 <span class="n">PT</span>
  <span class="n">Amesos</span>              <span class="n">packages</span><span class="o">/</span><span class="n">amesos</span>                 <span class="n">PT</span>
  <span class="n">Intrepid</span>            <span class="n">packages</span><span class="o">/</span><span class="n">intrepid</span>               <span class="n">PT</span>
  <span class="n">Ifpack</span>              <span class="n">packages</span><span class="o">/</span><span class="n">ifpack</span>                 <span class="n">PT</span>
  <span class="n">ML</span>                  <span class="n">packages</span><span class="o">/</span><span class="n">ml</span>                     <span class="n">PT</span>
  <span class="n">Belos</span>               <span class="n">packages</span><span class="o">/</span><span class="n">belos</span>                  <span class="n">ST</span>
  <span class="n">Stratimikos</span>         <span class="n">packages</span><span class="o">/</span><span class="n">stratimikos</span>            <span class="n">PT</span>
  <span class="n">RBGen</span>               <span class="n">packages</span><span class="o">/</span><span class="n">rbgen</span>                  <span class="n">PT</span>
  <span class="n">Phalanx</span>             <span class="n">packages</span><span class="o">/</span><span class="n">phalanx</span>                <span class="n">ST</span>
  <span class="n">Panzer</span>              <span class="n">packages</span><span class="o">/</span><span class="n">panzer</span>                 <span class="n">ST</span>
  <span class="n">AlwaysMissing</span>       <span class="n">AlwaysMissing</span>                   <span class="n">PT</span>
  <span class="p">)</span>

<span class="c1"># NOTE: Sacado was really PT but for testing purpose it is made ST</span>
<span class="c1"># NOTE: Belos was really PT but for testing purpose it is made ST</span>

<span class="n">tribits_allow_missing_external_packages</span><span class="p">(</span><span class="n">AlwaysMissing</span><span class="p">)</span>
<span class="n">tribits_disable_package_on_platforms</span><span class="p">(</span><span class="n">ML</span> <span class="n">BadSystem1</span><span class="p">)</span>
<span class="n">tribits_disable_package_on_platforms</span><span class="p">(</span><span class="n">Ifpack</span> <span class="n">BadSystem1</span> <span class="n">BadSystem2</span><span class="p">)</span>
</pre></div>
</div>
<p>All of the package directories listed above have
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> files but generally do not have
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> files since most of usage of <code class="docutils literal notranslate"><span class="pre">MockTrilinos</span></code>
just involves the testing of the algorithms and behaviors described in the
section <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package Dependencies and Enable/Disable Logic</a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">MockTrilinos</span></code> also contains a number of extra TriBITS repositories used in
various tests.  These extra repositories offer examples of different types of
TriBITS repositories like:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">extraRepoOnePackage</span></code>: Contains just the single package
<code class="docutils literal notranslate"><span class="pre">extraRepoOnePackage</span></code> which is defined in the base repository directory.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extraRepoOnePackageThreeSubpackages</span></code>: Contains just the single package
<code class="docutils literal notranslate"><span class="pre">extraRepoOnePackageThreeSubpackages</span></code> which is defined in the base
repository directory but is broken up into subpackages.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extraRepoTwoPackages</span></code>: Contains just two packages but provides an example
of defining multiple repositories with possible missing required and
optional <a class="reference internal" href="#upstream">upstream</a> packages (see <a class="reference internal" href="#multi-repository-support">Multi-Repository Support</a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extraTrilinosRepo</span></code>: Just a typical extra repo with add-on packages and
TPLs that depends on a few upstream <code class="docutils literal notranslate"><span class="pre">MockTrilinos</span></code> packages.</p></li>
</ul>
<p>New test extra repositories are added when new types of tests are needed that
would require new package and TPL dependency structures since existing
dependency tests based on <code class="docutils literal notranslate"><span class="pre">MockTrilinos</span></code> are expensive to change by their
very nature.</p>
<p>The primary reason that the <code class="docutils literal notranslate"><span class="pre">MockTrilinos</span></code> test project is mentioned in this
developers guide is because it contains a variety of packages, subpackages,
and TPLs with a variety of different types of dependencies.  This variety is
is needed to more fully test the TriBITS system but this project and the tests
also serve as examples and extra documentation for the behavior of the TriBITS
system.  Several of the dependency-related examples referenced in this
document come from <code class="docutils literal notranslate"><span class="pre">MockTrilinos</span></code>.</p>
<p>Most of the dependency tests involving <code class="docutils literal notranslate"><span class="pre">MockTrilinos</span></code> are specified in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TriBITS</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">DependencyUnitTests</span><span class="o">/</span><span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>A great deal about the current behavior of TriBITS <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package Dependencies and
Enable/Disable Logic</a> can be learned from inspecting these tests.  There are
also some faster-running unit tests involving <code class="docutils literal notranslate"><span class="pre">MockTrilinos</span></code> defined in the
file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TriBITS</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">TribitsAdjustPackageEnables_UnitTests</span><span class="o">.</span><span class="n">cmake</span>
</pre></div>
</div>
</section>
<section id="reducedmocktrilinos">
<h2><a class="toc-backref" href="#id39"><span class="sectnum">4.4</span> ReducedMockTrilinos</a><a class="headerlink" href="#reducedmocktrilinos" title="Permalink to this heading"></a></h2>
<p>The TriBITS project <code class="docutils literal notranslate"><span class="pre">ReducedMockTrilinos</span></code> is contained under the directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">ReducedMockTrilinos</span><span class="o">/</span>
</pre></div>
</div>
<p>It is a scaled-down version of the <a class="reference internal" href="#mocktrilinos">MockTrilinos</a> test project with just a
handful of packages and some modified dependencies.  Its primary purpose for
this example project is to be used for examples in the section <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package
Dependencies and Enable/Disable Logic</a> and to test a few features of the
TriBITS system not tested in other tests.</p>
<p>The list of packages in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">ReducedMockTrilinos</span><span class="o">/</span><span class="n">PackagesList</span><span class="o">.</span><span class="n">cmake</span>
</pre></div>
</div>
<p>is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_repository_define_packages</span><span class="p">(</span>
  <span class="n">Teuchos</span>             <span class="n">packages</span><span class="o">/</span><span class="n">teuchos</span>                <span class="n">PT</span>
  <span class="n">RTOp</span>                <span class="n">packages</span><span class="o">/</span><span class="n">rtop</span>                   <span class="n">PT</span>
  <span class="n">Epetra</span>              <span class="n">packages</span><span class="o">/</span><span class="n">epetra</span>                 <span class="n">PT</span>
  <span class="n">Triutils</span>            <span class="n">packages</span><span class="o">/</span><span class="n">triutils</span>               <span class="n">ST</span>
  <span class="n">EpetraExt</span>           <span class="n">packages</span><span class="o">/</span><span class="n">epetraext</span>              <span class="n">ST</span>
  <span class="n">Thyra</span>               <span class="n">packages</span><span class="o">/</span><span class="n">thyra</span>                  <span class="n">PT</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>All of the listed packages are standard TriBITS packages except for the mock
<code class="docutils literal notranslate"><span class="pre">Thyra</span></code> package which is broken down into subpackages.  More details of this
example project are described in <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package Dependencies and Enable/Disable
Logic</a>.</p>
</section>
<section id="trilinos">
<h2><a class="toc-backref" href="#id40"><span class="sectnum">4.5</span> Trilinos</a><a class="headerlink" href="#trilinos" title="Permalink to this heading"></a></h2>
<p>The real Trilinos project and repository itself is an advanced example for the
usage of TriBITS.  Almost every single-repository use case for TriBITS is
demonstrated somewhere in Trilinos.  While some of the usage of TriBITS in
Trilinos may not be not exemplary (e.g., because it represents old usage, or
was written by CMake/TriBITS beginners) it does represent real working usage.
Given that Trilinos is a widely available software repository, anyone should be
able to access a newer version of Trilinos and mine it for CMake and TriBITS
examples.</p>
</section>
<section id="the-tribits-test-package">
<h2><a class="toc-backref" href="#id41"><span class="sectnum">4.6</span> The TriBITS Test Package</a><a class="headerlink" href="#the-tribits-test-package" title="Permalink to this heading"></a></h2>
<p>The last TriBITS example mentioned here is the TriBITS test package named
(appropriately) <code class="docutils literal notranslate"><span class="pre">TriBITS</span></code> itself defined in the <code class="docutils literal notranslate"><span class="pre">TriBITS</span></code> repository.  The
directory for the <code class="docutils literal notranslate"><span class="pre">TriBITS</span></code> test package is the base TriBITS source
directory <code class="docutils literal notranslate"><span class="pre">tribits</span></code>.  This allows any TriBITS project to add testing for the
TriBITS system by just listing the TriBITS repository in its
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file.  Trilinos lists the
TriBITS repository in its <code class="docutils literal notranslate"><span class="pre">ExtraRepositoriesList.cmake</span></code> file as:</p>
<blockquote>
<div><dl class="simple">
<dt>tribits_project_define_extra_repositories(</dt><dd><p>TriBITS  “”  GIT  <a class="reference external" href="https://github.com/TriBITSPub/TriBITS">https://github.com/TriBITSPub/TriBITS</a>  “”  Continuous
…
)</p>
</dd>
</dl>
</div></blockquote>
<p>No <a class="reference internal" href="#downstream">downstream</a> TriBITS packages list a dependency on <code class="docutils literal notranslate"><span class="pre">TriBITS</span></code> in their
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> files.  Defining the <code class="docutils literal notranslate"><span class="pre">TriBITS</span></code>
TriBITS package in only done for running the TriBITS tests.</p>
<p>Once the <code class="docutils literal notranslate"><span class="pre">TriBITS</span></code> test package is added to the list of project/repository
packages, it can be enabled just like any other package by adding the
following to the <code class="docutils literal notranslate"><span class="pre">cmake</span></code> command-line options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_TriBITS</span><span class="o">=</span><span class="n">ON</span> \
<span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_ENABLE_TESTS</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>One can then inspect the added tests prefixed by <code class="docutils literal notranslate"><span class="pre">&quot;TriBITS_&quot;</span></code> to see what
tests are defined and how they are run.  There is a wealth of information
about the TriBITS system embedded in these tests and where documentation and
these tests disagreed, believe the tests!</p>
</section>
</section>
<section id="package-dependencies-and-enable-disable-logic">
<h1><a class="toc-backref" href="#id42"><span class="sectnum">5</span> Package Dependencies and Enable/Disable Logic</a><a class="headerlink" href="#package-dependencies-and-enable-disable-logic" title="Permalink to this heading"></a></h1>
<p>Arguably, the more important feature/aspect of the TriBITS system is the
partitioning of a large software project into packages and managing the
dependencies between these packages to support building, testing, and
deploying different pieces as needed (see discussion of <a class="reference internal" href="#software-engineering-packaging-principles">Software Engineering
Packaging Principles</a>).  This is especially useful in incremental CI testing
of large projects.  However, maintaining such dependencies is also a critical
component in creating and maintaining Self-Sustaining Software (see the
<a class="reference external" href="../lifecycle_model/TribitsLifecycleModel.pdf">TriBITS Lifecycle Model</a>).  The fundamental mechanism for breaking up a
large software into manageable pieces is to partition the software into
different <a class="reference internal" href="#tribits-packages">TriBITS Packages</a> and then define the dependencies between these
packages (which are defined inside of the
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> files for each package).</p>
<p>Note that the basic idea of breaking up a large set of software into pieces,
defining dependencies between the pieces, and then applying algorithms to
manipulate the dependency data-structures is nothing new.  If fact, nearly
every binary package deployment system provided in various Linux OS
distributions have the concept of packages and dependencies and will
automatically install all of the necessary <a class="reference internal" href="#upstream-dependencies">upstream dependencies</a> when a
<a class="reference internal" href="#downstream-dependency">downstream dependency</a> install is requested.  The main difference (and the
added complexity) with TriBITS is that it can handle both required and
optional dependencies since it can build from source.  A binary package
installation system, however, typically can’t support optional dependencies
because only pre-built binary libraries and tools are available to install.</p>
<p>This section is organized and broken-down as follows.  First, the subsection
<a class="reference internal" href="#example-reducedmocktrilinos-project-dependency-structure">Example ReducedMockTrilinos Project Dependency Structure</a> presents the
<a class="reference internal" href="#reducedmocktrilinos">ReducedMockTrilinos</a> example project, describes its dependency structure,
and uses it to begin to describe how TriBITS sets up and manages package and
TPL dependencies.  The packages in this <a class="reference internal" href="#reducedmocktrilinos">ReducedMockTrilinos</a> example project
are used in the following subsections so one will be constantly referred back
to this subsection.  The following subsection <a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency Handling
Behaviors</a> defines and describes the nitty-gritty details of the TriBITS
package and TPL dependency structure and the algorithms that manipulate the
various package, TPL, and test enables and disables.  Specific examples for
the TriBITS dependency handling algorithms are given in the subsection
<a class="reference internal" href="#example-enable-disable-use-cases">Example Enable/Disable Use Cases</a>.  Finally, the subsection
<a class="reference internal" href="#project-packagedependencies-xml">&lt;Project&gt;PackageDependencies.xml</a> describes the standard XML output
data-structure that gets created by TriBITS that defines a project’s package
and TPL dependencies.</p>
<section id="example-reducedmocktrilinos-project-dependency-structure">
<h2><a class="toc-backref" href="#id43"><span class="sectnum">5.1</span> Example ReducedMockTrilinos Project Dependency Structure</a><a class="headerlink" href="#example-reducedmocktrilinos-project-dependency-structure" title="Permalink to this heading"></a></h2>
<p>To demonstrate the TriBITS package and TPL dependency handling system, the
small simple <a class="reference internal" href="#reducedmocktrilinos">ReducedMockTrilinos</a> project is used.  The list of packages for
this project is defined in the file <code class="docutils literal notranslate"><span class="pre">ReducedMockTrilinos/PackagesList.cmake</span></code>
(see <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a>) which contents:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_repository_define_packages</span><span class="p">(</span>
  <span class="n">Teuchos</span>             <span class="n">packages</span><span class="o">/</span><span class="n">teuchos</span>                <span class="n">PT</span>
  <span class="n">RTOp</span>                <span class="n">packages</span><span class="o">/</span><span class="n">rtop</span>                   <span class="n">PT</span>
  <span class="n">Epetra</span>              <span class="n">packages</span><span class="o">/</span><span class="n">epetra</span>                 <span class="n">PT</span>
  <span class="n">Triutils</span>            <span class="n">packages</span><span class="o">/</span><span class="n">triutils</span>               <span class="n">ST</span>
  <span class="n">EpetraExt</span>           <span class="n">packages</span><span class="o">/</span><span class="n">epetraext</span>              <span class="n">ST</span>
  <span class="n">Thyra</span>               <span class="n">packages</span><span class="o">/</span><span class="n">thyra</span>                  <span class="n">PT</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>All of the listed packages are standard TriBITS packages except for the mock
<code class="docutils literal notranslate"><span class="pre">Thyra</span></code> package which is broken down into subpackages as shown in
<code class="docutils literal notranslate"><span class="pre">packages/thyra/cmake/Dependnecies.cmake</span></code> (see
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a>) which is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_package_define_dependencies</span><span class="p">(</span>
  <span class="n">SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS</span>
    <span class="n">CoreLibs</span>      <span class="n">src</span>                  <span class="n">PT</span>  <span class="n">REQUIRED</span>
    <span class="n">GoodStuff</span>     <span class="n">good_stuff</span>           <span class="n">ST</span>  <span class="n">OPTIONAL</span>
    <span class="n">CrazyStuff</span>    <span class="n">crazy_stuff</span>          <span class="n">EX</span>  <span class="n">OPTIONAL</span>
    <span class="n">Epetra</span>        <span class="n">adapters</span><span class="o">/</span><span class="n">epetra</span>      <span class="n">PT</span>  <span class="n">OPTIONAL</span>
    <span class="n">EpetraExt</span>     <span class="n">adapters</span><span class="o">/</span><span class="n">epetraext</span>   <span class="n">ST</span>  <span class="n">OPTIONAL</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>This gives the full list of top-level TriBITS packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Teuchos</span> <span class="n">RTOp</span> <span class="n">Epetra</span> <span class="n">Triutils</span> <span class="n">EpetraExt</span> <span class="n">Thyra</span>
</pre></div>
</div>
<p>Adding in the subpackages defined in the top-level <code class="docutils literal notranslate"><span class="pre">Thyra</span></code> package, the full
set of <a class="reference internal" href="#tribits-se-packages">TriBITS SE Packages</a> for this project is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Teuchos</span> <span class="n">RTOp</span> <span class="n">Epetra</span> <span class="n">Triutils</span> <span class="n">EpetraExt</span> <span class="n">ThyraCoreLibs</span> <span class="n">ThyraGoodStuff</span> \
  <span class="n">ThyraCrazyStuff</span> <span class="n">ThyraEpetra</span> <span class="n">ThyraEpetraExt</span> <span class="n">Thyra</span>
</pre></div>
</div>
<p>Note that one can see this full list of top-level packages and SE packages in
the <code class="docutils literal notranslate"><span class="pre">cmake</span></code> configure output lines starting with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">non</span><span class="o">-</span><span class="n">enabled</span> <span class="n">packages</span><span class="p">:</span>
<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">non</span><span class="o">-</span><span class="n">enabled</span> <span class="n">SE</span> <span class="n">packages</span><span class="p">:</span>
</pre></div>
</div>
<p>respectively, when configuring with no package enables as shown in the example
<a class="reference internal" href="#default-configure-with-no-packages-enabled-on-input">Default configure with no packages enabled on input</a>.</p>
<p>The list of <a class="reference internal" href="#tribits-tpls">TriBITS TPLs</a> for this example project given in the file
<code class="docutils literal notranslate"><span class="pre">ReducedMockTrilinos/TPLsList.cmake</span></code> (see <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a>) which
is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_repository_define_tpls</span><span class="p">(</span>
  <span class="n">MPI</span>            <span class="s2">&quot;${$</span><span class="si">{PROJECT_NAME}</span><span class="s2">_TRIBITS_DIR}/core/std_tpls/&quot;</span>    <span class="n">PT</span>
  <span class="n">BLAS</span>           <span class="s2">&quot;${$</span><span class="si">{PROJECT_NAME}</span><span class="s2">_TRIBITS_DIR}/core/std_tpls/&quot;</span>    <span class="n">PT</span>
  <span class="n">LAPACK</span>         <span class="s2">&quot;${$</span><span class="si">{PROJECT_NAME}</span><span class="s2">_TRIBITS_DIR}/core/std_tpls/&quot;</span>    <span class="n">PT</span>
  <span class="n">Boost</span>          <span class="s2">&quot;${$</span><span class="si">{PROJECT_NAME}</span><span class="s2">_TRIBITS_DIR}/core/std_tpls/&quot;</span>    <span class="n">ST</span>
  <span class="n">UMFPACK</span>        <span class="n">cmake</span><span class="o">/</span><span class="n">TPLs</span><span class="o">/</span>    <span class="n">ST</span>
  <span class="n">AMD</span>            <span class="n">cmake</span><span class="o">/</span><span class="n">TPLs</span><span class="o">/</span>    <span class="n">EX</span>
  <span class="n">PETSC</span>          <span class="s2">&quot;${$</span><span class="si">{PROJECT_NAME}</span><span class="s2">_TRIBITS_DIR}/common_tpls/&quot;</span>    <span class="n">ST</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>Take note of the <a class="reference internal" href="#se-package-test-group">SE Package Test Group</a> (i.e. <a class="reference internal" href="#pt">PT</a>, <a class="reference internal" href="#st">ST</a>, or <a class="reference internal" href="#ex">EX</a>)
assigned to each SE package and TPL as it plays a significant role in how the
TriBITS dependency system handles enables and disables.</p>
<p>The dependency structure of this simple TriBITS project is shown below in
<a class="reference internal" href="#reducedmocktrilinos-dependencies">ReducedMockTrilinos Dependencies</a>.</p>
<p id="reducedmocktrilinos-dependencies"><strong>ReducedMockTrilinos Dependencies:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Printing</span> <span class="n">package</span> <span class="n">dependencies</span> <span class="o">...</span>

<span class="o">--</span> <span class="n">Teuchos_LIB_REQUIRED_DEP_TPLS</span><span class="p">:</span> <span class="n">BLAS</span> <span class="n">LAPACK</span>
<span class="o">--</span> <span class="n">Teuchos_LIB_OPTIONAL_DEP_TPLS</span><span class="p">:</span> <span class="n">Boost</span> <span class="n">MPI</span>

<span class="o">--</span> <span class="n">RTOp_LIB_REQUIRED_DEP_PACKAGES</span><span class="p">:</span> <span class="n">Teuchos</span>

<span class="o">--</span> <span class="n">Epetra_LIB_REQUIRED_DEP_TPLS</span><span class="p">:</span> <span class="n">BLAS</span> <span class="n">LAPACK</span>
<span class="o">--</span> <span class="n">Epetra_LIB_OPTIONAL_DEP_TPLS</span><span class="p">:</span> <span class="n">MPI</span>

<span class="o">--</span> <span class="n">Triutils_LIB_REQUIRED_DEP_PACKAGES</span><span class="p">:</span> <span class="n">Epetra</span>

<span class="o">--</span> <span class="n">EpetraExt_LIB_REQUIRED_DEP_PACKAGES</span><span class="p">:</span> <span class="n">Teuchos</span> <span class="n">Epetra</span>
<span class="o">--</span> <span class="n">EpetraExt_LIB_OPTIONAL_DEP_PACKAGES</span><span class="p">:</span> <span class="n">Triutils</span>
<span class="o">--</span> <span class="n">EpetraExt_LIB_OPTIONAL_DEP_TPLS</span><span class="p">:</span> <span class="n">UMFPACK</span> <span class="n">AMD</span> <span class="n">PETSC</span>

<span class="o">--</span> <span class="n">ThyraCoreLibs_LIB_REQUIRED_DEP_PACKAGES</span><span class="p">:</span> <span class="n">Teuchos</span> <span class="n">RTOp</span>

<span class="o">--</span> <span class="n">ThyraGoodStuff_LIB_REQUIRED_DEP_PACKAGES</span><span class="p">:</span> <span class="n">ThyraCoreLibs</span>

<span class="o">--</span> <span class="n">ThyraCrazyStuff_LIB_REQUIRED_DEP_PACKAGES</span><span class="p">:</span> <span class="n">ThyraGoodStuff</span>

<span class="o">--</span> <span class="n">ThyraEpetra_LIB_REQUIRED_DEP_PACKAGES</span><span class="p">:</span> <span class="n">Epetra</span> <span class="n">ThyraCoreLibs</span>

<span class="o">--</span> <span class="n">ThyraEpetraExt_LIB_REQUIRED_DEP_PACKAGES</span><span class="p">:</span> <span class="n">ThyraEpetra</span> <span class="n">EpetraExt</span>

<span class="o">--</span> <span class="n">Thyra_LIB_REQUIRED_DEP_PACKAGES</span><span class="p">:</span> <span class="n">ThyraCoreLibs</span>
<span class="o">--</span> <span class="n">Thyra_LIB_OPTIONAL_DEP_PACKAGES</span><span class="p">:</span> <span class="n">ThyraGoodStuff</span> <span class="n">ThyraCrazyStuff</span> <span class="n">ThyraEpetra</span> <span class="n">ThyraEpetraExt</span>

<span class="n">Dumping</span> <span class="n">direct</span> <span class="n">dependencies</span> <span class="k">for</span> <span class="n">each</span> <span class="n">package</span> <span class="o">...</span>

<span class="o">--</span> <span class="n">MPI_LIB_ALL_DEPENDENCIES</span><span class="p">:</span>

<span class="o">--</span> <span class="n">BLAS_LIB_ALL_DEPENDENCIES</span><span class="p">:</span>

<span class="o">--</span> <span class="n">LAPACK_LIB_ALL_DEPENDENCIES</span><span class="p">:</span>

<span class="o">--</span> <span class="n">Boost_LIB_ALL_DEPENDENCIES</span><span class="p">:</span>

<span class="o">--</span> <span class="n">UMFPACK_LIB_ALL_DEPENDENCIES</span><span class="p">:</span>

<span class="o">--</span> <span class="n">AMD_LIB_ALL_DEPENDENCIES</span><span class="p">:</span>

<span class="o">--</span> <span class="n">PETSC_LIB_ALL_DEPENDENCIES</span><span class="p">:</span>

<span class="o">--</span> <span class="n">Teuchos_LIB_ENABLED_DEPENDENCIES</span><span class="p">:</span> <span class="n">BLAS</span> <span class="n">LAPACK</span>
<span class="o">--</span> <span class="n">Teuchos_LIB_ALL_DEPENDENCIES</span><span class="p">:</span> <span class="n">BLAS</span> <span class="n">LAPACK</span> <span class="n">Boost</span> <span class="n">MPI</span>

<span class="o">--</span> <span class="n">RTOp_LIB_ENABLED_DEPENDENCIES</span><span class="p">:</span> <span class="n">Teuchos</span>
<span class="o">--</span> <span class="n">RTOp_LIB_ALL_DEPENDENCIES</span><span class="p">:</span> <span class="n">Teuchos</span>

<span class="o">--</span> <span class="n">Epetra_LIB_ENABLED_DEPENDENCIES</span><span class="p">:</span> <span class="n">BLAS</span> <span class="n">LAPACK</span>
<span class="o">--</span> <span class="n">Epetra_LIB_ALL_DEPENDENCIES</span><span class="p">:</span> <span class="n">BLAS</span> <span class="n">LAPACK</span> <span class="n">MPI</span>

<span class="o">--</span> <span class="n">Triutils_LIB_ALL_DEPENDENCIES</span><span class="p">:</span> <span class="n">Epetra</span>

<span class="o">--</span> <span class="n">EpetraExt_LIB_ALL_DEPENDENCIES</span><span class="p">:</span> <span class="n">Teuchos</span> <span class="n">Epetra</span> <span class="n">Triutils</span> <span class="n">UMFPACK</span> <span class="n">AMD</span> <span class="n">PETSC</span>

<span class="o">--</span> <span class="n">ThyraCoreLibs_LIB_ENABLED_DEPENDENCIES</span><span class="p">:</span> <span class="n">Teuchos</span> <span class="n">RTOp</span>
<span class="o">--</span> <span class="n">ThyraCoreLibs_LIB_ALL_DEPENDENCIES</span><span class="p">:</span> <span class="n">Teuchos</span> <span class="n">RTOp</span>

<span class="o">--</span> <span class="n">ThyraGoodStuff_LIB_ALL_DEPENDENCIES</span><span class="p">:</span> <span class="n">ThyraCoreLibs</span>

<span class="o">--</span> <span class="n">ThyraCrazyStuff_LIB_ALL_DEPENDENCIES</span><span class="p">:</span> <span class="n">ThyraGoodStuff</span>

<span class="o">--</span> <span class="n">ThyraEpetra_LIB_ENABLED_DEPENDENCIES</span><span class="p">:</span> <span class="n">Epetra</span> <span class="n">ThyraCoreLibs</span>
<span class="o">--</span> <span class="n">ThyraEpetra_LIB_ALL_DEPENDENCIES</span><span class="p">:</span> <span class="n">Epetra</span> <span class="n">ThyraCoreLibs</span>

<span class="o">--</span> <span class="n">ThyraEpetraExt_LIB_ALL_DEPENDENCIES</span><span class="p">:</span> <span class="n">ThyraEpetra</span> <span class="n">EpetraExt</span>

<span class="o">--</span> <span class="n">Thyra_LIB_ENABLED_DEPENDENCIES</span><span class="p">:</span> <span class="n">ThyraCoreLibs</span> <span class="n">ThyraEpetra</span>
<span class="o">--</span> <span class="n">Thyra_LIB_ALL_DEPENDENCIES</span><span class="p">:</span> <span class="n">ThyraCoreLibs</span> <span class="n">ThyraGoodStuff</span> <span class="n">ThyraCrazyStuff</span> <span class="n">ThyraEpetra</span> <span class="n">ThyraEpetraExt</span>
</pre></div>
</div>
<p>The above dependency structure printout is produced by configuring with
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_DUMP_PACKAGE_DEPENDENCIES=ON</span></code> (which also results in more
dependency information than what is shown above, e.g. like computed forward
package dependencies).  Note that the top-level SE package <code class="docutils literal notranslate"><span class="pre">Thyra</span></code> is shown
to depend on its subpackages (not the other way around).  (Many people are
confused about the nature of the dependencies between packages and
subpackages.  See <a class="reference internal" href="#packagedir-spkgdir-cmake-dependencies-cmake">&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</a> for more
discussion.)</p>
<p>A number of user-settable CMake cache variables determine what SE packages
(and TPLs) and what tests and examples get enabled.  These cache variables are
described in <a class="reference external" href="TribitsBuildReference.html#selecting-the-list-of-packages-to-enable">Selecting the list of packages to enable</a> and are described
below.  Also, the assigned <a class="reference internal" href="#se-package-test-group">SE Package Test Group</a> (i.e. <a class="reference internal" href="#pt">PT</a>, <a class="reference internal" href="#st">ST</a>, and
<a class="reference internal" href="#ex">EX</a>) also affects what packages get enabled or disabled.</p>
<p>Any of these SE packages can be enabled or disabled with
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_&lt;TRIBITS_PACKAGE&gt;=(ON|OFF)</span></code> (the default enable is
typically empty <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>, see <a class="reference internal" href="#pt-st-se-packages-given-default-unset-enable-disable-state">PT/ST SE packages given default unset
enable/disable state</a>).  For <code class="docutils literal notranslate"><span class="pre">ReducedMockTrilinos</span></code>, this gives the
enable/disable cache variables (with the initial default values):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Trilinos_ENABLE_Teuchos</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">Trilinos_ENABLE_RTOp</span><span class="s2">&quot;&quot;</span>
<span class="n">Trilinos_ENABLE_Epetra</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">Trilinos_ENABLE_Triutils</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">Trilinos_ENABLE_EpetraExt</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">Trilinos_ENABLE_ThyraCore</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">Trilinos_ENABLE_ThyraGoodStuff</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">Trilinos_ENABLE_ThyraCrazyStuff</span><span class="o">=</span><span class="s2">&quot;OFF&quot;</span>  <span class="c1"># Because it is &#39;EX&#39;</span>
<span class="n">Trilinos_ENABLE_ThyraEpetra</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">Trilinos_ENABLE_ThyraEpetraExt</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</pre></div>
</div>
<p>Every TriBITS SE package is assumed to have tests and/or examples so TriBITS
defines the following cache variables as well (with the initial default
values):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Teuchos_ENABLE_TESTS</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">RTOp_ENABLE_TESTS</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">Epetra_ENABLE_TESTS</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">Triutils_ENABLE_TESTS</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">EpetraExt_ENABLE_TESTS</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">ThyraCoreLibs_ENABLE_TESTS</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">ThyraGoodStuff_ENABLE_TESTS</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">ThyraEpetra_ENABLE_TESTS</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">ThyraEpetraExt_ENABLE_TESTS</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">Thyra_ENABLE_TESTS</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</pre></div>
</div>
<p>NOTE: TriBITS only sets the variables <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;_ENABLE_TESTS</span></code> into
the cache if the SE package <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> becomes enabled at some
point.  This cuts down the clutter in the CMake cache for large projects with
lots of packages where the user only enables a subset of the packages.</p>
<p>NOTE: TriBITS also defines the cache variables
<code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;_ENABLE_EXAMPLES</span></code> for each enabled TriBITS package which
is handled the same way as the <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;_ENABLE_TEST</span></code> variables.</p>
<p>Also, every defined TPL is given its own <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_&lt;TRIBITS_TPL&gt;</span></code>
enable/disable cache variable.  For the TPLs in <code class="docutils literal notranslate"><span class="pre">ReducedMockTrilinos</span></code>, this
gives the enable/disable cache variables (with default values):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TPL_ENABLE_MPI</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">TPL_ENABLE_BLAS</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">TPL_ENABLE_LAPACK</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">TPL_ENABLE_Boost</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">TPL_ENABLE_UMFPACK</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">TPL_ENABLE_AMD</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">TPL_ENABLE_PETSC</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</pre></div>
</div>
<p>In addition, for every optional SE package and TPL dependency, TriBITS defines
a cache variable <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;_ENABLE_&lt;OPTIONAL_DEP&gt;</span></code>.  For the
optional dependencies shown in <a class="reference internal" href="#reducedmocktrilinos-dependencies">ReducedMockTrilinos Dependencies</a>, that gives
the additional cache variables (with default values):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Teuchos_ENABLE_Boost</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">Teuchos_ENABLE_MPI</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">Teuchos_ENABLE_Boost</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">Epetra_ENABLE_MPI</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">EpetraExt_ENABLE_Triutils</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">EpetraExt_ENABLE_UMFPACK</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">EpetraExt_ENABLE_AMD</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">EpetraExt_ENABLE_PETSC</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">Thyra_ENABLE_ThyraGoodStuff</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">Thyra_ENABLE_ThyraCrazyStuff</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">Thyra_ENABLE_ThyraEpetra</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">Thyra_ENABLE_ThyraEpetraExt</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</pre></div>
</div>
<p>The above optional package-specific cache variables allow one to control
whether or not support for <a class="reference internal" href="#upstream">upstream</a> dependency X is turned on in package Y
independent of whether or not X and Y are themselves both enabled.  For
example, if the packages <code class="docutils literal notranslate"><span class="pre">Triutils</span></code> and <code class="docutils literal notranslate"><span class="pre">EpetraExt</span></code> are both enabled, one
can explicitly disable support for the optional dependency <code class="docutils literal notranslate"><span class="pre">Triutils</span></code> in
<code class="docutils literal notranslate"><span class="pre">EpetraExt</span></code> by setting <code class="docutils literal notranslate"><span class="pre">EpetraExt_ENABLE_Triutils=OFF</span></code>.  One may want to
do this for several reasons but the bottom line is that this gives the user
more detailed control over package dependencies.  See the <a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency
Handling Behaviors</a> and <a class="reference internal" href="#explicit-disable-of-an-optional-package-dependency">Explicit disable of an optional package
dependency</a> for more discussion and examples.</p>
<p>Before getting into specific <a class="reference internal" href="#example-enable-disable-use-cases">Example Enable/Disable Use Cases</a>, some of the
<a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency Handling Behaviors</a> are first defined below.</p>
</section>
<section id="tribits-dependency-handling-behaviors">
<h2><a class="toc-backref" href="#id44"><span class="sectnum">5.2</span> TriBITS Dependency Handling Behaviors</a><a class="headerlink" href="#tribits-dependency-handling-behaviors" title="Permalink to this heading"></a></h2>
<p>Below, some of the rules and behaviors of the TriBITS dependency management
system are described.  Examples refer to the <a class="reference internal" href="#example-reducedmocktrilinos-project-dependency-structure">Example ReducedMockTrilinos
Project Dependency Structure</a>.  More detailed examples of these behaviors are
given in the section <a class="reference internal" href="#example-enable-disable-use-cases">Example Enable/Disable Use Cases</a>.</p>
<p>In brief, the rules/behaviors of the TriBITS package and TPL dependency
management system are:</p>
<ol class="arabic simple" start="0">
<li><p><a class="reference internal" href="#no-circular-dependencies-of-any-kind-are-allowed">No circular dependencies of any kind are allowed</a></p></li>
<li><p><a class="reference internal" href="#pt-st-se-packages-given-default-unset-enable-disable-state">PT/ST SE packages given default unset enable/disable state</a></p></li>
<li><p><a class="reference internal" href="#ex-se-packages-disabled-by-default">EX SE packages disabled by default</a></p></li>
<li><p><a class="reference internal" href="#se-package-enable-triggers-auto-enables-of-upstream-dependencies">SE package enable triggers auto-enables of upstream dependencies</a></p></li>
<li><p><a class="reference internal" href="#se-package-disable-triggers-auto-disables-of-downstream-dependencies">SE package disable triggers auto-disables of downstream dependencies</a></p></li>
<li><p><a class="reference internal" href="#pt-st-tpls-given-default-unset-enable-disable-state">PT/ST TPLs given default unset enable/disable state</a></p></li>
<li><p><a class="reference internal" href="#ex-tpls-given-default-unset-enable-disable-state">EX TPLs given default unset enable/disable state</a></p></li>
<li><p><a class="reference internal" href="#required-tpls-are-auto-enabled-for-enabled-se-packages">Required TPLs are auto-enabled for enabled SE packages</a></p></li>
<li><p><a class="reference internal" href="#optional-tpls-only-enabled-explicitly-by-the-user">Optional TPLs only enabled explicitly by the user</a></p></li>
<li><p><a class="reference internal" href="#tpl-disable-triggers-auto-disables-of-downstream-dependencies">TPL disable triggers auto-disables of downstream dependencies</a></p></li>
<li><p><a class="reference internal" href="#disables-trump-enables-where-there-is-a-conflict">Disables trump enables where there is a conflict</a></p></li>
<li><p><a class="reference internal" href="#enable-disable-of-parent-package-is-enable-disable-for-subpackages">Enable/disable of parent package is enable/disable for subpackages</a></p></li>
<li><p><a class="reference internal" href="#subpackage-enable-does-not-auto-enable-the-parent-package">Subpackage enable does not auto-enable the parent package</a></p></li>
<li><p><a class="reference internal" href="#support-for-optional-se-package-tpl-is-enabled-by-default">Support for optional SE package/TPL is enabled by default</a></p></li>
<li><p><a class="reference internal" href="#support-for-optional-se-package-tpl-can-be-explicitly-disabled">Support for optional SE package/TPL can be explicitly disabled</a></p></li>
<li><p><a class="reference internal" href="#explicit-enable-of-optional-se-package-tpl-support-auto-enables-se-package-tpl">Explicit enable of optional SE package/TPL support auto-enables SE package/TPL</a></p></li>
<li><p><a class="reference internal" href="#st-se-packages-only-auto-enabled-if-st-code-is-enabled">ST SE packages only auto-enabled if ST code is enabled</a></p></li>
<li><p><a class="reference internal" href="#project-enable-all-forward-dep-packages-enables-downstream-packages-tests">&lt;Project&gt;_ENABLE_ALL_FORWARD_DEP_PACKAGES enables downstream packages/tests</a></p></li>
<li><p><a class="reference internal" href="#project-enable-all-packages-enables-all-pt-cond-st-se-packages">&lt;Project&gt;_ENABLE_ALL_PACKAGES enables all PT (cond. ST) SE packages</a></p></li>
<li><p><a class="reference internal" href="#project-enable-tests-only-enables-explicitly-enabled-se-package-tests">&lt;Project&gt;_ENABLE_TESTS only enables explicitly enabled SE package tests</a></p></li>
<li><p><a class="reference internal" href="#if-no-se-packages-are-enabled-nothing-will-get-built">If no SE packages are enabled, nothing will get built</a></p></li>
<li><p><a class="reference internal" href="#tribits-prints-all-enables-and-disables-to-stdout">TriBITS prints all enables and disables to stdout</a></p></li>
<li><p><a class="reference internal" href="#tribits-auto-enables-disables-done-using-non-cache-local-variables">TriBITS auto-enables/disables done using non-cache local variables</a></p></li>
</ol>
<p>In more detail, these rules/behaviors are:</p>
<ol class="arabic simple" id="no-circular-dependencies-of-any-kind-are-allowed" start="0">
<li><p><strong>No circular dependencies of any kind are allowed</strong>: The zeroth rule of
the TriBITS dependency management system is that no TriBITS SE package (or
its tests) can declare a dependency on a <a class="reference internal" href="#downstream">downstream</a> SE package, period!
This is one of the most basic <a class="reference internal" href="#software-engineering-packaging-principles">Software Engineering Packaging Principles</a>
stated as the <em>ADP (Acyclic Dependencies Principle)</em>, i.e. “Allow no cycles
in the package dependency graph”.  By default, the TriBITS system will
check for circular dependencies and will fail the configure if any are
found. For a more detailed discussion of circular package dependencies, see
<a class="reference internal" href="#design-considerations-for-tribits">Design Considerations for TriBITS</a>.</p></li>
</ol>
<ol class="arabic simple" id="pt-st-se-packages-given-default-unset-enable-disable-state">
<li><p><strong>PT/ST SE packages given default unset enable/disable state</strong>: An SE
package <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> with testing group <code class="docutils literal notranslate"><span class="pre">PT</span></code> or <code class="docutils literal notranslate"><span class="pre">ST</span></code> is given
an <strong>unset enable/disable state by default</strong>
(i.e. <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_&lt;TRIBITS_PACKAGE&gt;=&quot;&quot;</span></code>).  For example, the
<code class="docutils literal notranslate"><span class="pre">PT</span></code> package <code class="docutils literal notranslate"><span class="pre">Teuchos</span></code> is not enabled or disabled by default and is
given the initial value <code class="docutils literal notranslate"><span class="pre">Trilinos_ENABLE_Teuchos=&quot;&quot;</span></code>.  For an example,
see <a class="reference internal" href="#default-configure-with-no-packages-enabled-on-input">Default configure with no packages enabled on input</a>.  This allows
<code class="docutils literal notranslate"><span class="pre">PT</span></code>, and <code class="docutils literal notranslate"><span class="pre">ST</span></code> packages to be enabled or disabled using other logic
defined by TriBITS which is described below.  TriBITS defines persistent
cache variables for these with the default value of empty “”.  Therefore,
if the user or other CMake code does not hard enable or disable one of
these variables, then on future configures it will be defined but have the
value of empty “”.</p></li>
</ol>
<ol class="arabic simple" id="ex-se-packages-disabled-by-default" start="2">
<li><p><strong>EX SE packages disabled by default</strong>: An SE package <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code>
with testing group <code class="docutils literal notranslate"><span class="pre">EX</span></code> is <strong>disabled by default</strong>
(i.e. <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_&lt;TRIBITS_PACKAGE&gt;=OFF</span></code>).  For an example,
see <a class="reference internal" href="#default-configure-with-no-packages-enabled-on-input">Default configure with no packages enabled on input</a>.  This results
in all required <a class="reference internal" href="#downstream">downstream</a> SE packages to be disabled by default.
However, the user can explicitly set
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_&lt;TRIBITS_PACKAGE&gt;=ON</span></code> for an <code class="docutils literal notranslate"><span class="pre">EX</span></code> package and
it will be enabled (unless one of its required dependencies are not enabled
for some reason).  In this case, the cache variable is given the cache
value of <code class="docutils literal notranslate"><span class="pre">OFF</span></code>.</p></li>
</ol>
<ol class="arabic simple" id="se-package-enable-triggers-auto-enables-of-upstream-dependencies" start="3">
<li><p><strong>SE package enable triggers auto-enables of upstream dependencies</strong>: Any
SE package <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> can be explicitly <strong>enabled</strong> by the user
by setting the cache variable
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_&lt;TRIBITS_PACKAGE&gt;=ON</span></code>
(e.g. <code class="docutils literal notranslate"><span class="pre">Trilinos_ENABLE_EpetraExt=ON</span></code>).  When an SE package is enabled in
this way, the TriBITS system will try to enable all of the required
upstream SE packages and TPLs defined by the package (specified in its
<code class="docutils literal notranslate"><span class="pre">Dependencies.cmake</span></code> file).  If an enabled SE package can’t be enabled
and has to be disabled, either a warning is printed or processing will stop
with an error (depending on the value of
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES</span></code>, see <a class="reference internal" href="#disables-trump-enables-where-there-is-a-conflict">Disables
trump enables where there is a conflict</a>).  In addition, if
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_ALL_OPTIONAL_PACKAGES=ON</span></code>, then TriBITS will try
to enable all of the specified optional <a class="reference internal" href="#pt">PT</a> SE packages as well (and also
optional upstream <a class="reference internal" href="#st">ST</a> SE packages if
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SECONDARY_TESTED_CODE=ON</span></code>).  For an example, see
<a class="reference internal" href="#explicit-enable-of-a-package-its-tests-an-optional-tpl-with-st-enabled">Explicit enable of a package, its tests, an optional TPL, with ST
enabled</a>.</p></li>
</ol>
<ol class="arabic simple" id="se-package-disable-triggers-auto-disables-of-downstream-dependencies" start="4">
<li><p><strong>SE package disable triggers auto-disables of downstream dependencies</strong>:
Any SE package <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> can be explicitly <strong>disabled</strong> by the
user by setting the cache variable
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_&lt;TRIBITS_PACKAGE&gt;=OFF</span></code>
(e.g. <code class="docutils literal notranslate"><span class="pre">Trilinos_ENABLE_Teuchos=OFF</span></code>).  When an SE package is explicitly
disabled, it will result in the disable of all <a class="reference internal" href="#downstream">downstream</a> SE packages
that have required dependency on it.  It will also disable optional support
for the disabled packages in downstream packages that list it as an
optional dependency.  For an example, see <a class="reference internal" href="#explicit-disable-of-a-package">Explicit disable of a package</a>.</p></li>
</ol>
<ol class="arabic simple" id="pt-st-tpls-given-default-unset-enable-disable-state" start="5">
<li><p><strong>PT/ST TPLs given default unset enable/disable state</strong>: A TriBITS TPL
<code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_TPL&gt;</span></code> with testing group <code class="docutils literal notranslate"><span class="pre">PT</span></code> or <code class="docutils literal notranslate"><span class="pre">ST</span></code> is given an <strong>unset
enable/disable state by default</strong> (i.e. <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_&lt;TRIBITS_TPL&gt;=&quot;&quot;</span></code>).
For example, the <code class="docutils literal notranslate"><span class="pre">PT</span></code> TPL <code class="docutils literal notranslate"><span class="pre">BLAS</span></code> is not enabled or disabled by default
(i.e. <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_BLAS=&quot;&quot;</span></code>).  For an example, see <a class="reference internal" href="#default-configure-with-no-packages-enabled-on-input">Default configure with
no packages enabled on input</a>.  This allows <code class="docutils literal notranslate"><span class="pre">PT</span></code>, and <code class="docutils literal notranslate"><span class="pre">ST</span></code> TPLs to be
enabled or disabled using other logic.</p></li>
</ol>
<ol class="arabic simple" id="ex-tpls-given-default-unset-enable-disable-state" start="6">
<li><p><strong>EX TPLs given default unset enable/disable state</strong>: A TriBITS TPL
<code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_TPL&gt;</span></code> with testing group <code class="docutils literal notranslate"><span class="pre">EX</span></code>, is given an <strong>unset
enable/disable state by default</strong> (i.e. <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_&lt;TRIBITS_TPL&gt;=&quot;&quot;</span></code>,
same as for <code class="docutils literal notranslate"><span class="pre">PT</span></code> and <code class="docutils literal notranslate"><span class="pre">EX</span></code> TPLs).  For an example, see <a class="reference internal" href="#default-configure-with-no-packages-enabled-on-input">Default
configure with no packages enabled on input</a>.  This is different behavior
than for <code class="docutils literal notranslate"><span class="pre">EX</span></code> SE packages described above which provides an initial hard
disable.  However, since TriBITS will never automatically enable an
optional TPL (see <a class="reference internal" href="#optional-tpls-only-enabled-explicitly-by-the-user">Optional TPLs only enabled explicitly by the user</a>) and
since only <a class="reference internal" href="#downstream">downstream</a> <code class="docutils literal notranslate"><span class="pre">EX</span></code> SE packages are allowed to have a required
dependencies on an <code class="docutils literal notranslate"><span class="pre">EX</span></code> TPL, there is no need to set the default enable
for an <code class="docutils literal notranslate"><span class="pre">EX</span></code> TPL to <code class="docutils literal notranslate"><span class="pre">OFF</span></code>.  If an <code class="docutils literal notranslate"><span class="pre">EX</span></code> SE package has a required
dependency on an <code class="docutils literal notranslate"><span class="pre">EX</span></code> TPL, just enabling the <code class="docutils literal notranslate"><span class="pre">EX</span></code> SE package should
automatically enable the <code class="docutils literal notranslate"><span class="pre">EX</span></code> TPL as described in <a class="reference internal" href="#required-tpls-are-auto-enabled-for-enabled-se-packages">Required TPLs are
auto-enabled for enabled SE packages</a>.</p></li>
</ol>
<ol class="arabic simple" id="required-tpls-are-auto-enabled-for-enabled-se-packages" start="7">
<li><p><strong>Required TPLs are auto-enabled for enabled SE packages</strong>: All TPLs listed
as required TPL dependencies for the final set of enabled SE packages are
<strong>set to enabled</strong> (i.e. <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_&lt;TRIBITS_TPL&gt;=ON</span></code>), unless the
listed TPLs are already explicit disabled (in which case the SE package
would be disabled or an error would occur, see <a class="reference internal" href="#disables-trump-enables-where-there-is-a-conflict">Disables trump enables
where there is a conflict</a>).  For example, if the <code class="docutils literal notranslate"><span class="pre">Teuchos</span></code> package is
enabled, then that will trigger the enable of its required TPLs <code class="docutils literal notranslate"><span class="pre">BLAS</span></code>
and <code class="docutils literal notranslate"><span class="pre">LAPACK</span></code>.  For an example, see <a class="reference internal" href="#explicit-enable-of-a-package-and-its-tests">Explicit enable of a package and its
tests</a>.</p></li>
</ol>
<ol class="arabic simple" id="optional-tpls-only-enabled-explicitly-by-the-user" start="8">
<li><p><strong>Optional TPLs only enabled explicitly by the user</strong>: Optional TPLs,
regardless of their testing group <code class="docutils literal notranslate"><span class="pre">PT</span></code>, <code class="docutils literal notranslate"><span class="pre">ST</span></code> or <code class="docutils literal notranslate"><span class="pre">EX</span></code>, will only be
enabled if they are explicitly enabled by the user.  For example, just
because the package <code class="docutils literal notranslate"><span class="pre">Teuchos</span></code> is enabled, the optional TPLs <code class="docutils literal notranslate"><span class="pre">Boost</span></code> and
<code class="docutils literal notranslate"><span class="pre">MPI</span></code> will <strong>not</strong> be enabled by default, even if
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_ALL_OPTIONAL_PACKAGES=ON</span></code>.  To enable the
optional TPL <code class="docutils literal notranslate"><span class="pre">Boost</span></code>, for example, and enable support for <code class="docutils literal notranslate"><span class="pre">Boost</span></code> in
the <code class="docutils literal notranslate"><span class="pre">Teuchos</span></code> package, the user must explicitly set
<code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_Boost=ON</span></code>.  For an example, see <a class="reference internal" href="#explicit-enable-of-a-package-its-tests-an-optional-tpl-with-st-enabled">Explicit enable of a
package, its tests, an optional TPL, with ST enabled</a>.</p></li>
</ol>
<ol class="arabic simple" id="tpl-disable-triggers-auto-disables-of-downstream-dependencies" start="9">
<li><p><strong>TPL disable triggers auto-disables of downstream dependencies</strong>: Any TPLs
that are explicitly disabled (i.e. <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_&lt;TRIBITS_TPL&gt;=OFF</span></code>) will
result in the disable of all <a class="reference internal" href="#downstream">downstream</a> dependent SE packages that have
a required dependency on the TPL.  For example, if the user sets
<code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_LAPACK=OFF</span></code>, then this will result in the disable of SE
packages <code class="docutils literal notranslate"><span class="pre">Teuchos</span></code> and <code class="docutils literal notranslate"><span class="pre">Epetra</span></code>, and all of the required SE packages
downstream from them.  Also, the explicitly disabled TPL will result in the
disable of optional support in all downstream SE packages.  For example, if
the user sets <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_MPI=OFF</span></code>, then TriBITS will automatically set
<code class="docutils literal notranslate"><span class="pre">Teuchos_ENABLE_MPI=OFF</span></code> and <code class="docutils literal notranslate"><span class="pre">Epetra_ENABLE_MPI=OFF</span></code>.  For examples,
see <a class="reference internal" href="#explicit-disable-of-an-optional-tpl">Explicit disable of an optional TPL</a> and <a class="reference internal" href="#explicit-disable-of-a-required-tpl">Explicit disable of a
required TPL</a>.</p></li>
</ol>
<ol class="arabic" id="disables-trump-enables-where-there-is-a-conflict" start="10">
<li><p><strong>Disables trump enables where there is a conflict</strong> and TriBITS will
never override a disable in order to satisfy some dependency.  For
example, if the user sets <code class="docutils literal notranslate"><span class="pre">Trilinos_ENABLE_Teuchos=OFF</span></code> and
<code class="docutils literal notranslate"><span class="pre">Trilinos_ENABLE_RTOp=ON</span></code>, then TriBITS will <strong>not</strong> override the
disable of <code class="docutils literal notranslate"><span class="pre">Teuchos</span></code> in order to satisfy the required dependency of
<code class="docutils literal notranslate"><span class="pre">RTOp</span></code>.  In cases such as this, the behavior of the TriBITS dependency
adjustment system will depend on the setting of the top-level user cache
variable <a class="reference internal" href="#project-name-disable-enabled-forward-dep-packages">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES</a>:</p>
<ul class="simple" id="project-name-disable-enabled-forward-dep-packages-on">
<li><p>If <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES=ON</span></code>, then
TriBITS will disable the explicit enable and continue on.  In the above
example, TriBITS will override <code class="docutils literal notranslate"><span class="pre">Trilinos_ENABLE_RTOp=ON</span></code> and set
<code class="docutils literal notranslate"><span class="pre">Trilinos_ENABLE_RTOp=OFF</span></code> and print a verbose warning to the
<code class="docutils literal notranslate"><span class="pre">cmake</span></code> stdout.</p></li>
</ul>
<ul class="simple" id="project-name-disable-enabled-forward-dep-packages-off">
<li><p>If <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES=OFF</span></code>, then
TriBITS will generate a detailed error message printed to <code class="docutils literal notranslate"><span class="pre">cmake</span></code>
stdout and then abort processing.  In the above example, TriBITS will
report that <code class="docutils literal notranslate"><span class="pre">RTOp</span></code> is enabled but the required SE package <code class="docutils literal notranslate"><span class="pre">Teuchos</span></code>
is disabled and therefore <code class="docutils literal notranslate"><span class="pre">RTOp</span></code> can’t be enabled and processing must
stop.</p></li>
</ul>
<p>For an example of both behaviors, see <a class="reference internal" href="#conflicting-explicit-enable-and-disable">Conflicting explicit enable and
disable</a>.</p>
</li>
</ol>
<ol class="arabic" id="enable-disable-of-parent-package-is-enable-disable-for-subpackages" start="11">
<li><p><strong>Enable/disable of parent package is enable/disable for subpackages</strong>: An
explicit enable/disable of a top-level parent package with subpackages
with <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_&lt;TRIBITS_PACKAGE&gt;=(ON|OFF)</span></code> is equivalent
to the explicit enable/disable of all of the parent package’s subpackages.
For example, explicitly setting <code class="docutils literal notranslate"><span class="pre">Trilinos_ENABLE_Thyra=ON</span></code> is equivalent
to explicitly setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Trilinos_ENABLE_ThyraCoreLibs</span><span class="o">=</span><span class="n">ON</span>
<span class="n">Trilinos_ENABLE_ThyraGoodStuff</span><span class="o">=</span><span class="n">ON</span>   <span class="c1"># Only if enabling ST code!</span>
<span class="n">Trilinos_ENABLE_ThyraEpetra</span><span class="o">=</span><span class="n">ON</span>
<span class="n">Trilinos_ENABLE_ThyraEpetraExt</span><span class="o">=</span><span class="n">ON</span>   <span class="c1"># Only if enabling ST code!</span>
</pre></div>
</div>
<p>(Note that <code class="docutils literal notranslate"><span class="pre">Trilinos_ENABLE_ThyraCrazyStuff</span></code> is <strong>not</strong> set to <code class="docutils literal notranslate"><span class="pre">ON</span></code>
because it is already set to <code class="docutils literal notranslate"><span class="pre">OFF</span></code> by default, see <a class="reference internal" href="#ex-se-packages-disabled-by-default">EX SE packages
disabled by default</a>.)  Likewise, explicitly setting
<code class="docutils literal notranslate"><span class="pre">Trilinos_ENABLE_Thyra=OFF</span></code> is equivalent to explicitly setting all of
the <code class="docutils literal notranslate"><span class="pre">Thyra</span></code> subpackages to <code class="docutils literal notranslate"><span class="pre">OFF</span></code> at the outset.  For a <code class="docutils literal notranslate"><span class="pre">PT</span></code> example,
see <a class="reference internal" href="#explicit-enable-of-a-package-and-its-tests">Explicit enable of a package and its tests</a>.  For a <code class="docutils literal notranslate"><span class="pre">ST</span></code> example,
see <a class="reference internal" href="#explicit-enable-of-a-package-its-tests-an-optional-tpl-with-st-enabled">Explicit enable of a package, its tests, an optional TPL, with ST
enabled</a>.</p>
</li>
</ol>
<ol class="arabic simple" id="subpackage-enable-does-not-auto-enable-the-parent-package" start="12">
<li><p><strong>Subpackage enable does not auto-enable the parent package</strong>: Enabling an
SE package that is a subpackage does <strong>not</strong> automatically enable the
parent package (except for at the very end, mostly just for show).  For
example, enabling the SE package <code class="docutils literal notranslate"><span class="pre">ThyraEpetra</span></code> does not result in enable
of the parent <code class="docutils literal notranslate"><span class="pre">Thyra</span></code> package, (except when
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_ALL_FORWARD_DEP_PACKAGES=ON</span></code> for course).  For
an example, see <a class="reference internal" href="#explicit-enable-of-a-subpackage">Explicit enable of a subpackage</a>. This means that if a
<a class="reference internal" href="#downstream">downstream</a> package declares a dependency on the SE package
<code class="docutils literal notranslate"><span class="pre">ThyraEpetra</span></code>, but not the parent package <code class="docutils literal notranslate"><span class="pre">Thyra</span></code>, then the <code class="docutils literal notranslate"><span class="pre">Thyra</span></code>
package (and its other subpackages and their dependencies) will not get
auto-enabled.  Also note that enabling a subset of the required
subpackages for a parent package does not require the enable of the other
required subpackages.  For example, if both <code class="docutils literal notranslate"><span class="pre">ThyraEpetra</span></code> and
<code class="docutils literal notranslate"><span class="pre">ThyraCore</span></code> were both required subpackages of the parent package
<code class="docutils literal notranslate"><span class="pre">Thyra</span></code>, then enabling <code class="docutils literal notranslate"><span class="pre">ThyraCore</span></code> does not require the enabling of
<code class="docutils literal notranslate"><span class="pre">ThyraEpetra</span></code>.  In these cases where one of a parent package’s
subpackages is enabled for some reason, the final value of
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_${PACKAGE_NAME}</span></code> will be set to <code class="docutils literal notranslate"><span class="pre">ON</span></code> (but this
does imply that all of the required subpackages will be enabled, only that
the parent package will be processed.)</p></li>
</ol>
<ol class="arabic simple" id="support-for-optional-se-package-tpl-is-enabled-by-default" start="13">
<li><p><strong>Support for optional SE package/TPL is enabled by default</strong>: For an SE
package <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> with an optional dependency on an
<a class="reference internal" href="#upstream">upstream</a> SE package or TPL <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_DEP_PACKAGE_OR_TPL&gt;</span></code>, TriBITS
will automatically set the intra-enable variable
<code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;_ENABLE_&lt;TRIBITS_DEP_PACKAGE_OR_TPL&gt;=ON</span></code> if
<code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_DEP_PACKAGE_OR_TPL&gt;</span></code> are <strong>both
enabled</strong>.  For example, if the packages <code class="docutils literal notranslate"><span class="pre">Triutils</span></code> and <code class="docutils literal notranslate"><span class="pre">EpetraExt</span></code>
are both enabled, then TriBITS will automatically set
<code class="docutils literal notranslate"><span class="pre">EpetraExt_ENABLE_Triutils=ON</span></code> by default and enables support for
<code class="docutils literal notranslate"><span class="pre">Triutils</span></code> in <code class="docutils literal notranslate"><span class="pre">EpetraExt</span></code>.  Likewise, if <code class="docutils literal notranslate"><span class="pre">Teuchos</span></code> and the optional
TPL <code class="docutils literal notranslate"><span class="pre">Boost</span></code> are both enabled, then TriBITS will automatically set
<code class="docutils literal notranslate"><span class="pre">Teuchos_ENABLE_Boost=ON</span></code> by default.  This is obviously the logical
behavior.  See the full context for these examples in <a class="reference internal" href="#explicit-enable-of-a-package-its-tests-an-optional-tpl-with-st-enabled">Explicit enable of
a package, its tests, an optional TPL, with ST enabled</a>.</p></li>
</ol>
<ol class="arabic simple" id="support-for-optional-se-package-tpl-can-be-explicitly-disabled" start="14">
<li><p><strong>Support for optional SE package/TPL can be explicitly disabled:</strong> Even
though TriBITS will automatically set
<code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;_ENABLE_&lt;TRIBITS_DEP_PACKAGE_OR_TPL&gt;=ON</span></code> by default if
<code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_DEP_PACKAGE_OR_TPL&gt;</span></code> are both
enabled at the project level (as described above), the user can explicitly
set <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;_ENABLE_&lt;TRIBITS_DEP_PACKAGE_OR_TPL&gt;=OFF</span></code> which
will turn off optional package-level support for the upstream SE package
or TPL <code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_DEP_PACKAGE_OR_TPL&gt;</span></code> in the downstream SE package
<code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code>.  For example, the user can enable <code class="docutils literal notranslate"><span class="pre">EpetraExt</span></code> and
<code class="docutils literal notranslate"><span class="pre">Triutils</span></code> at the project level, but set
<code class="docutils literal notranslate"><span class="pre">EpetraExt_ENABLE_Triutils=OFF</span></code> which will turn off package-level
support for <code class="docutils literal notranslate"><span class="pre">Triutils</span></code> in the <code class="docutils literal notranslate"><span class="pre">EpetraExt</span></code> package.  Likewise, the user
can enable <code class="docutils literal notranslate"><span class="pre">Teuchos</span></code>, <code class="docutils literal notranslate"><span class="pre">Epetra</span></code> and the optional TPL <code class="docutils literal notranslate"><span class="pre">Boost</span></code>, but set
<code class="docutils literal notranslate"><span class="pre">Epetra_ENABLE_Boost=ON</span></code>.  This would provide support for <code class="docutils literal notranslate"><span class="pre">Boost</span></code> in
<code class="docutils literal notranslate"><span class="pre">Teuchos</span></code> but not in <code class="docutils literal notranslate"><span class="pre">Epetra</span></code>.  For examples, see <a class="reference internal" href="#explicit-disable-of-an-optional-package-dependency">Explicit disable of
an optional package dependency</a> and <a class="reference internal" href="#explicit-disable-of-an-optional-tpl-dependency">Explicit disable of an optional TPL
dependency</a>.</p></li>
</ol>
<ol class="arabic simple" id="explicit-enable-of-optional-se-package-tpl-support-auto-enables-se-package-tpl" start="15">
<li><p><strong>Explicit enable of optional SE package/TPL support auto-enables SE
package/TPL</strong>: If the user explicitly enables the TriBITS SE package
<code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;</span></code> and explicitly sets
<code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;_ENABLE_&lt;TRIBITS_DEP_PACKAGE_OR_TPL&gt;=ON</span></code> on input,
then that will automatically enable the SE package or TPL
<code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_DEP_PACKAGE_OR_TPL&gt;</span></code> (and all of its upstream dependencies
accordingly).  For example, if the user sets
<code class="docutils literal notranslate"><span class="pre">Trilinos_ENABLE_EpetraExt=ON</span></code> and <code class="docutils literal notranslate"><span class="pre">EpetraExt_ENABLE_Triutils=ON</span></code>,
then that will result in the auto-enable of
<code class="docutils literal notranslate"><span class="pre">Trilinos_ENABLE_Triutils=ON</span></code> regardless of the value of
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_ALL_OPTIONAL_PACKAGES</span></code> or
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SECONDARY_TESTED_CODE</span></code>. This true even if the optional
SE package or TPL is <code class="docutils literal notranslate"><span class="pre">EX</span></code>.  For example, setting
<code class="docutils literal notranslate"><span class="pre">Thyra_ENABLE_ThyraCrazyStuff=ON</span></code> will result in the enabling of the
<code class="docutils literal notranslate"><span class="pre">EX</span></code> package <code class="docutils literal notranslate"><span class="pre">ThyraCrazyStuff</span></code>.  However, always remember that
<a class="reference internal" href="#disables-trump-enables-where-there-is-a-conflict">Disables trump enables where there is a conflict</a>.  For example, see
<a class="reference internal" href="#explicit-enable-of-an-optional-package-dependency">Explicit enable of an optional package dependency</a>.</p></li>
</ol>
<ol class="arabic simple" id="st-se-packages-only-auto-enabled-if-st-code-is-enabled" start="16">
<li><p><strong>ST SE packages only auto-enabled if ST code is enabled</strong>: TriBITS will
only enable an optional <code class="docutils literal notranslate"><span class="pre">ST</span></code> SE package when
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_ALL_OPTIONAL_PACKAGES=ON</span></code> if
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SECONDARY_TESTED_CODE=ON</span></code> is also set.  Otherwise, when
an optional <code class="docutils literal notranslate"><span class="pre">ST</span></code> <a class="reference internal" href="#upstream">upstream</a> dependent SE package is not enabled due to
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SECONDARY_TESTED_CODE=OFF</span></code>, then a one-line warning is
printed to stdout.  For example, if the <code class="docutils literal notranslate"><span class="pre">EpetraExt</span></code> package is enabled
but <code class="docutils literal notranslate"><span class="pre">ST</span></code> code is not enabled, then the optional SE package <code class="docutils literal notranslate"><span class="pre">Triutils</span></code>
will not be enabled (for an example, see <a class="reference internal" href="#explicit-enable-of-a-package-and-its-tests">Explicit enable of a package and
its tests</a>).  However, when <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SECONDARY_TESTED_CODE=ON</span></code>
and <code class="docutils literal notranslate"><span class="pre">EpetraExt</span></code> is enabled, then <code class="docutils literal notranslate"><span class="pre">Triutils</span></code> will be enabled too (for an
example, see <a class="reference internal" href="#explicit-enable-of-a-package-its-tests-an-optional-tpl-with-st-enabled">Explicit enable of a package, its tests, an optional TPL,
with ST enabled</a>).  The TriBITS default is
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_ALL_OPTIONAL_PACKAGES=ON</span></code>.  This helps to avoid
problems when users try to set a permutation of enables/disables which is
not regularly tested.</p></li>
</ol>
<ol class="arabic simple" id="project-enable-all-forward-dep-packages-enables-downstream-packages-tests" start="17">
<li><p><strong>&lt;Project&gt;_ENABLE_ALL_FORWARD_DEP_PACKAGES enables downstream packages/tests</strong>:
Setting the user cache-variable
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_ALL_FORWARD_PACKAGES=ON</span></code> will result in the
<a class="reference internal" href="#downstream">downstream</a> <code class="docutils literal notranslate"><span class="pre">PT</span></code> SE packages and tests to be enabled (and all <code class="docutils literal notranslate"><span class="pre">PT</span></code>
and <code class="docutils literal notranslate"><span class="pre">ST</span></code> SE packages and tests when
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SECONDARY_TESTED_CODE=ON</span></code>) for all explicitly enabled
SE packages.  For example, configuring with <code class="docutils literal notranslate"><span class="pre">Trilinos_ENABLE_Epetra=ON</span></code>,
<code class="docutils literal notranslate"><span class="pre">Trilinos_ENABLE_TESTS=ON</span></code>, and
<code class="docutils literal notranslate"><span class="pre">Trilinos_ENABLE_ALL_FORWARD_PACKAGES=ON</span></code> will result the package
enables (and test and example enables) for the SE packages <code class="docutils literal notranslate"><span class="pre">Triutils</span></code>,
<code class="docutils literal notranslate"><span class="pre">EpetraExt</span></code>, <code class="docutils literal notranslate"><span class="pre">ThyraCoreLibs</span></code>, <code class="docutils literal notranslate"><span class="pre">ThyraEpetra</span></code> and <code class="docutils literal notranslate"><span class="pre">Thyra</span></code>.  For an
example, see <a class="reference internal" href="#explicit-enable-of-a-package-and-downstream-packages-and-tests">Explicit enable of a package and downstream packages and
tests</a>.</p></li>
</ol>
<span id="project-name-enable-all-packages"></span><ol class="arabic" id="project-enable-all-packages-enables-all-pt-cond-st-se-packages" start="18">
<li><p><strong>&lt;Project&gt;_ENABLE_ALL_PACKAGES enables all PT (cond. ST) SE packages</strong>:
Setting the user cache-variable <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_ALL_PACKAGES=ON</span></code>
will result in the enable of all <code class="docutils literal notranslate"><span class="pre">PT</span></code> SE packages when
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SECONDARY_TESTED_CODE=OFF</span></code> and all <code class="docutils literal notranslate"><span class="pre">PT</span></code> and <code class="docutils literal notranslate"><span class="pre">ST</span></code> SE
packages when <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SECONDARY_TESTED_CODE=ON</span></code>.  For an
example, see <a class="reference internal" href="#enable-all-packages">Enable all packages</a>.  When the project is a meta-project,
this will only enable the project’s primary meta-project packages (PMPP).
That is, a package will only be enabled due to
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_ALL_PACKAGES=ON</span></code> when its parent repository does
not have <a class="reference internal" href="#repository-name-no-primary-meta-project-packages">${REPOSITORY_NAME}_NO_PRIMARY_META_PROJECT_PACKAGES</a> set to
<code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.  However, if:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${REPOSITORY_NAME}_NO_PRIMARY_META_PROJECT_PACKAGES=TRUE
</pre></div>
</div>
<p>then the SE package may be enabled if it (or its parent package) is listed
in <a class="reference internal" href="#repository-name-no-primary-meta-project-packages-except">${REPOSITORY_NAME}_NO_PRIMARY_META_PROJECT_PACKAGES_EXCEPT</a>.</p>
</li>
</ol>
<ol class="arabic simple" id="project-enable-tests-only-enables-explicitly-enabled-se-package-tests" start="19">
<li><p><strong>&lt;Project&gt;_ENABLE_TESTS only enables explicitly enabled SE package
tests</strong>: Setting <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_TESTS=ON</span></code> will <strong>only enable
tests for explicitly enabled SE packages</strong> on input.  For example,
configuring with <code class="docutils literal notranslate"><span class="pre">Trilinos_ENABLE_RTOp=ON</span></code> and
<code class="docutils literal notranslate"><span class="pre">Trilinos_ENABLE_TESTS=ON</span></code> will only result in the enable of tests for
<code class="docutils literal notranslate"><span class="pre">RTOp</span></code>, not <code class="docutils literal notranslate"><span class="pre">Teuchos</span></code> (even through TriBITS will enable <code class="docutils literal notranslate"><span class="pre">Teuchos</span></code>
because it is a required dependency of <code class="docutils literal notranslate"><span class="pre">RTOp</span></code>).  See an example, see
<a class="reference internal" href="#explicit-enable-of-a-package-and-its-tests">Explicit enable of a package and its tests</a>.  When the project is a
meta-project, this will only enable tests for the project’s primary
meta-project packages (PMPP).  The uses the same logic as for
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_ALL_PACKAGES</span></code>, see
<a class="reference internal" href="#project-enable-all-packages-enables-all-pt-cond-st-se-packages">&lt;Project&gt;_ENABLE_ALL_PACKAGES enables all PT (cond. ST) SE packages</a>.</p></li>
</ol>
<ol class="arabic simple" id="if-no-se-packages-are-enabled-nothing-will-get-built" start="20">
<li><p><strong>If no SE packages are enabled, nothing will get built</strong>: Most TriBITS
projects are set up such that if the user does not explicitly enable at
least one SE package in some way, then nothing will be enabled or built.
In this case, when <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ALLOW_NO_PACKAGES=TRUE</span></code> a warning
will be printed and configuration will complete.  However, if
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ALLOW_NO_PACKAGES=FALSE</span></code>, then the configure will die
with an error message.  For example, the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool sets
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ALLOW_NO_PACKAGES=OFF</span></code> to make sure that something gets
enabled and tested in order to accept the results of the test and allow a
push.  For an example, see <a class="reference internal" href="#default-configure-with-no-packages-enabled-on-input">Default configure with no packages enabled on
input</a>.</p></li>
</ol>
<ol class="arabic simple" id="tribits-prints-all-enables-and-disables-to-stdout" start="21">
<li><p><strong>TriBITS prints all enables and disables to stdout</strong>: TriBITS prints out
(to <code class="docutils literal notranslate"><span class="pre">cmake</span></code> stdout) the initial set of enables/disables on input, prints
a line whenever it sets (or overrides) an enable or disable, and prints
out the final set of enables/disables.  Therefore, the user just needs to
grep the <code class="docutils literal notranslate"><span class="pre">cmake</span></code> stdout to find out why any particular SE package or TPL
is enabled or disabled in the end.  In addition, will print out when
tests/examples for a given SE package gets enabled and when support for
optional SE packages and TPLs is enabled or not.  Examples of this output
is given in all of the below examples but a detailed description of this
output is given in <a class="reference internal" href="#explicit-enable-of-a-package-and-its-tests">Explicit enable of a package and its tests</a>.</p></li>
</ol>
<ol class="arabic simple" id="tribits-auto-enables-disables-done-using-non-cache-local-variables" start="22">
<li><p><strong>TriBITS auto-enables/disables done using non-cache local variables</strong>:
TriBITS setting (or overrides) of enable/disable cache variables are done
by setting local non-cache variables at the top project-level scope
(i.e. the <code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/CMakeLists.txt</span></code> file scope).  This is done so
they don’t get set in the cache and so that the same dependency
enable/disable logic is redone, from scratch, with each re-configure.
This results in the same enable/disable logic output as for the initial
configure.  This is to avoid confusion by the user about why some SE
packages and TPLs are enabled and some are not on subsequent reconfigures.
However, this implementation choice must be understood when one wants to
go about tweaking these TriBITS enable/disable variables as described in
<a class="reference internal" href="#how-to-check-for-and-tweak-tribits-enable-cache-variables">How to check for and tweak TriBITS “ENABLE” cache variables</a> and <a class="reference internal" href="#how-to-tweak-downstream-tribits-enable-variables-during-package-configuration">How to
tweak downstream TriBITS “ENABLE” variables during package
configuration</a>.</p></li>
</ol>
<p>TriBITS prints out a lot of information about the enable/disable logic as it
applies the above rules/behaviors.  For a large TriBITS project with lots of
packages, this can produce a lot of output to stdout.  One just needs to
understand what TriBITS is printing out and where to look in the output for
different information.  The examples in the section <a class="reference internal" href="#example-enable-disable-use-cases">Example Enable/Disable
Use Cases</a> show what this output looks like for the various enable/disable
scenarios and tries to explain in more detail the reasons for why the given
behavior is implemented the way that it is.  Given this output, the rule
definitions given above, and the detailed <a class="reference internal" href="#example-enable-disable-use-cases">Example Enable/Disable Use Cases</a>,
one should always be able to figure out exactly why the final set of
enables/disables is the way it is, even in the largest and most complex of
TriBITS projects.  (NOTE: The same can <em>not</em> be said for many other large
software configuration and deployment systems where basic decisions about what
to enable and disable are hidden from the user and can be very difficult to
track down and debug.)</p>
<p>The above behaviors address the majority of the functionality of the TriBITS
dependency management system.  However, when dealing with TriBITS projects
with multiple repositories, some other behaviors are supported through the
definition of a few more variables.  The following TriBITS repository-related
variables alter what packages in a given TriBITS repository get enabled
implicitly or not by TriBITS:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}_NO_IMPLICIT_PACKAGE_ENABLE</span></code></p>
<blockquote>
<div><p>If set to <code class="docutils literal notranslate"><span class="pre">ON</span></code>, then the packages in Repository <code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}</span></code>
will not be implicitly enabled in any of the package adjustment logic.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}_NO_IMPLICIT_PACKAGE_ENABLE_EXCEPT</span></code></p>
<blockquote>
<div><p>List of packages in the Repository <code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}</span></code> that will be
allowed to be implicitly enabled.  Only checked if
<code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}_NO_IMPLICIT_PACKAGE_ENABLE</span></code> is true.</p>
</div></blockquote>
</div></blockquote>
<p>The above variables typically are defined in the outer TriBITS Project’s CTest
driver scripts or even in top-level project files in order to adjust how
packages in its listed repositories are handled.  What these variable do is to
allow a large project to turn off the auto-enable of optional SE packages in a
given TriBITS repository to provide more detailed control of what gets used
from a given TriBITS repository.  This, for example, is used in the CASL VERA
project to manage some of its extra repositories and packages to further reduce
the number of packages that get auto-enabled.</p>
</section>
<section id="example-enable-disable-use-cases">
<h2><a class="toc-backref" href="#id45"><span class="sectnum">5.3</span> Example Enable/Disable Use Cases</a><a class="headerlink" href="#example-enable-disable-use-cases" title="Permalink to this heading"></a></h2>
<p>Below, a few of the standard enable/disable use cases for a TriBITS project
are given using the <a class="reference internal" href="#example-reducedmocktrilinos-project-dependency-structure">Example ReducedMockTrilinos Project Dependency
Structure</a> that demonstrate the <a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency Handling Behaviors</a>.</p>
<p>The use cases covered are:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#default-configure-with-no-packages-enabled-on-input">Default configure with no packages enabled on input</a></p></li>
<li><p><a class="reference internal" href="#explicit-enable-of-a-package-and-its-tests">Explicit enable of a package and its tests</a></p></li>
<li><p><a class="reference internal" href="#explicit-enable-of-a-package-its-tests-an-optional-tpl-with-st-enabled">Explicit enable of a package, its tests, an optional TPL, with ST enabled</a></p></li>
<li><p><a class="reference internal" href="#explicit-disable-of-a-package">Explicit disable of a package</a></p></li>
<li><p><a class="reference internal" href="#conflicting-explicit-enable-and-disable">Conflicting explicit enable and disable</a></p></li>
<li><p><a class="reference internal" href="#explicit-enable-of-an-optional-tpl">Explicit enable of an optional TPL</a></p></li>
<li><p><a class="reference internal" href="#explicit-disable-of-an-optional-tpl">Explicit disable of an optional TPL</a></p></li>
<li><p><a class="reference internal" href="#explicit-disable-of-a-required-tpl">Explicit disable of a required TPL</a></p></li>
<li><p><a class="reference internal" href="#explicit-enable-of-a-subpackage">Explicit enable of a subpackage</a></p></li>
<li><p><a class="reference internal" href="#explicit-enable-of-an-optional-package-dependency">Explicit enable of an optional package dependency</a></p></li>
<li><p><a class="reference internal" href="#explicit-disable-of-an-optional-package-dependency">Explicit disable of an optional package dependency</a></p></li>
<li><p><a class="reference internal" href="#explicit-enable-of-an-optional-tpl-dependency">Explicit enable of an optional TPL dependency</a></p></li>
<li><p><a class="reference internal" href="#explicit-disable-of-an-optional-tpl-dependency">Explicit disable of an optional TPL dependency</a></p></li>
<li><p><a class="reference internal" href="#explicit-enable-of-a-package-and-downstream-packages-and-tests">Explicit enable of a package and downstream packages and tests</a></p></li>
<li><p><a class="reference internal" href="#enable-all-packages">Enable all packages</a></p></li>
</ul>
<p>All of these use cases and more can be easily run from the command-line by
first setting:</p>
<blockquote>
<div><p>$ export REDUCED_MOCK_TRILINOS=&lt;base-dir&gt;/tribits/examples/ReducedMockTrilinos</p>
</div></blockquote>
<p>and then copy and pasting the <code class="docutils literal notranslate"><span class="pre">cmake</span></code> commands shown below.  Just make sure
to run these in a temp directory because this actually configures a CMake
project in the local directory.  Just make sure and run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rm -r CMake*
</pre></div>
</div>
<p>before each run to clear the CMake cache.</p>
<p>These use cases are now described in detail below.</p>
<p id="default-configure-with-no-packages-enabled-on-input"><strong>Default configure with no packages enabled on input</strong></p>
<p>The first use-case to consider is the configure of a TriBITS project without
enabling any packages.  For the <code class="docutils literal notranslate"><span class="pre">ReducedMockTrilinos</span></code> project, this is done
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cmake ${REDUCED_MOCK_TRILINOS}
</pre></div>
</div>
<p>which produces the relevant dependency-related output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Explicitly enabled packages on input (by user):  0
Explicitly enabled SE packages on input (by user):  0
Explicitly disabled packages on input (by user or by default):  0
Explicitly disabled SE packages on input (by user or by default):  ThyraCrazyStuff 1
Explicitly enabled TPLs on input (by user):  0
Explicitly disabled TPLs on input (by user or by default):  0

...

Final set of enabled packages:  0
Final set of enabled SE packages:  0
Final set of non-enabled packages:  Teuchos RTOp Epetra Triutils EpetraExt Thyra 6
Final set of non-enabled SE packages:  Teuchos RTOp Epetra Triutils EpetraExt \
 ThyraCoreLibs ThyraGoodStuff ThyraCrazyStuff ThyraEpetra ThyraEpetraExt Thyra 11
Final set of enabled TPLs:  0
Final set of non-enabled TPLs:  MPI BLAS LAPACK Boost UMFPACK AMD PETSC 7

...

***
*** WARNING:  There were no packages configured so no libraries or tests/examples will be built!
***
</pre></div>
</div>
<p>The above example demonstrates the following behaviors of the TriBITS
dependency handling system:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#pt-st-se-packages-given-default-unset-enable-disable-state">PT/ST SE packages given default unset enable/disable state</a></p></li>
<li><p><a class="reference internal" href="#ex-se-packages-disabled-by-default">EX SE packages disabled by default</a> (i.e., the <code class="docutils literal notranslate"><span class="pre">EX</span></code> SE package
<code class="docutils literal notranslate"><span class="pre">ThyraCrazyStuff</span></code> is set to <code class="docutils literal notranslate"><span class="pre">OFF</span></code> by default at the very beginning).</p></li>
<li><p><a class="reference internal" href="#pt-st-tpls-given-default-unset-enable-disable-state">PT/ST TPLs given default unset enable/disable state</a></p></li>
<li><p><a class="reference internal" href="#ex-tpls-given-default-unset-enable-disable-state">EX TPLs given default unset enable/disable state</a></p></li>
<li><p><a class="reference internal" href="#if-no-se-packages-are-enabled-nothing-will-get-built">If no SE packages are enabled, nothing will get built</a></p></li>
</ul>
<p id="explicit-enable-of-a-package-and-its-tests"><strong>Explicit enable of a package and its tests</strong></p>
<p>One of the most typical use cases is for the user to explicitly enable one or
more top-level TriBITS package and enable its tests.  This configuration would
be used to drive local development on a specific set of packages (i.e. tests
do not need to be enabled for packages not being changed).</p>
<p>Consider the configure of the <code class="docutils literal notranslate"><span class="pre">ReducedMockTrilinos</span></code> project enabling the
top-level <code class="docutils literal notranslate"><span class="pre">Thyra</span></code> package and its tests with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cmake -DTrilinos_ENABLE_Thyra:BOOL=ON \
   -DTrilinos_ENABLE_TESTS:BOOL=ON \
   ${REDUCED_MOCK_TRILINOS}
</pre></div>
</div>
<p>which produces the relevant dependency-related output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Explicitly</span> <span class="n">enabled</span> <span class="n">packages</span> <span class="n">on</span> <span class="nb">input</span> <span class="p">(</span><span class="n">by</span> <span class="n">user</span><span class="p">):</span>  <span class="n">Thyra</span> <span class="mi">1</span>
<span class="n">Explicitly</span> <span class="n">enabled</span> <span class="n">SE</span> <span class="n">packages</span> <span class="n">on</span> <span class="nb">input</span> <span class="p">(</span><span class="n">by</span> <span class="n">user</span><span class="p">):</span>  <span class="n">Thyra</span> <span class="mi">1</span>
<span class="n">Explicitly</span> <span class="n">disabled</span> <span class="n">packages</span> <span class="n">on</span> <span class="nb">input</span> <span class="p">(</span><span class="n">by</span> <span class="n">user</span> <span class="ow">or</span> <span class="n">by</span> <span class="n">default</span><span class="p">):</span>  <span class="mi">0</span>
<span class="n">Explicitly</span> <span class="n">disabled</span> <span class="n">SE</span> <span class="n">packages</span> <span class="n">on</span> <span class="nb">input</span> <span class="p">(</span><span class="n">by</span> <span class="n">user</span> <span class="ow">or</span> <span class="n">by</span> <span class="n">default</span><span class="p">):</span>  <span class="n">ThyraCrazyStuff</span> <span class="mi">1</span>
<span class="n">Explicitly</span> <span class="n">enabled</span> <span class="n">TPLs</span> <span class="n">on</span> <span class="nb">input</span> <span class="p">(</span><span class="n">by</span> <span class="n">user</span><span class="p">):</span>  <span class="mi">0</span>
<span class="n">Explicitly</span> <span class="n">disabled</span> <span class="n">TPLs</span> <span class="n">on</span> <span class="nb">input</span> <span class="p">(</span><span class="n">by</span> <span class="n">user</span> <span class="ow">or</span> <span class="n">by</span> <span class="n">default</span><span class="p">):</span>  <span class="mi">0</span>

<span class="n">Enabling</span> <span class="n">subpackages</span> <span class="k">for</span> <span class="n">hard</span> <span class="n">enables</span> <span class="n">of</span> <span class="n">parent</span> <span class="n">packages</span> <span class="n">due</span> <span class="n">to</span> \
 <span class="n">Trilinos_ENABLE_</span><span class="o">&lt;</span><span class="n">PARENT_PACKAGE</span><span class="o">&gt;=</span><span class="n">ON</span> <span class="o">...</span>

<span class="o">--</span> <span class="n">Setting</span> <span class="n">subpackage</span> <span class="n">enable</span> <span class="n">Trilinos_ENABLE_ThyraCoreLibs</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">parent</span> \
 <span class="n">package</span> <span class="n">Trilinos_ENABLE_Thyra</span><span class="o">=</span><span class="n">ON</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">subpackage</span> <span class="n">enable</span> <span class="n">Trilinos_ENABLE_ThyraEpetra</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">parent</span> <span class="n">package</span> \
 <span class="n">Trilinos_ENABLE_Thyra</span><span class="o">=</span><span class="n">ON</span>

<span class="n">Disabling</span> <span class="n">forward</span> <span class="n">required</span> <span class="n">SE</span> <span class="n">packages</span> <span class="ow">and</span> <span class="n">optional</span> <span class="n">intra</span><span class="o">-</span><span class="n">package</span> <span class="n">support</span> <span class="n">that</span> <span class="n">have</span> <span class="n">a</span> \
 <span class="n">dependency</span> <span class="n">on</span> <span class="n">disabled</span> <span class="n">SE</span> <span class="n">packages</span> <span class="n">Trilinos_ENABLE_</span><span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;=</span><span class="n">OFF</span> <span class="o">...</span>

<span class="o">--</span> <span class="n">Setting</span> <span class="n">Thyra_ENABLE_ThyraCrazyStuff</span><span class="o">=</span><span class="n">OFF</span> <span class="n">because</span> <span class="n">Thyra</span> <span class="n">has</span> <span class="n">an</span> <span class="n">optional</span> <span class="n">library</span> \
 <span class="n">dependence</span> <span class="n">on</span> <span class="n">disabled</span> <span class="n">package</span> <span class="n">ThyraCrazyStuff</span>

<span class="n">Enabling</span> <span class="nb">all</span> <span class="n">tests</span> <span class="ow">and</span><span class="o">/</span><span class="ow">or</span> <span class="n">examples</span> <span class="n">that</span> <span class="n">have</span> <span class="ow">not</span> <span class="n">been</span> <span class="n">explicitly</span> <span class="n">disabled</span> <span class="n">because</span> \
 <span class="n">Trilinos_ENABLE_</span><span class="p">[</span><span class="n">TESTS</span><span class="p">,</span><span class="n">EXAMPLES</span><span class="p">]</span><span class="o">=</span><span class="n">ON</span> <span class="o">...</span>

<span class="o">--</span> <span class="n">Setting</span> <span class="n">ThyraCoreLibs_ENABLE_TESTS</span><span class="o">=</span><span class="n">ON</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">ThyraCoreLibs_ENABLE_EXAMPLES</span><span class="o">=</span><span class="n">ON</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">ThyraEpetra_ENABLE_TESTS</span><span class="o">=</span><span class="n">ON</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">ThyraEpetra_ENABLE_EXAMPLES</span><span class="o">=</span><span class="n">ON</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Thyra_ENABLE_TESTS</span><span class="o">=</span><span class="n">ON</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Thyra_ENABLE_EXAMPLES</span><span class="o">=</span><span class="n">ON</span>

<span class="n">Enabling</span> <span class="nb">all</span> <span class="n">required</span> <span class="p">(</span><span class="ow">and</span> <span class="n">optional</span> <span class="n">since</span> <span class="n">Trilinos_ENABLE_ALL_OPTIONAL_PACKAGES</span><span class="o">=</span><span class="n">ON</span><span class="p">)</span> \
 <span class="n">upstream</span> <span class="n">SE</span> <span class="n">packages</span> <span class="k">for</span> <span class="n">current</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">enabled</span> <span class="n">packages</span> \
 <span class="p">(</span><span class="n">Trilinos_ENABLE_SECONDARY_TESTED_CODE</span><span class="o">=</span><span class="n">OFF</span><span class="p">)</span> <span class="o">...</span>

<span class="o">--</span> <span class="n">NOTE</span><span class="p">:</span> <span class="n">Not</span> <span class="n">Setting</span> <span class="n">Trilinos_ENABLE_ThyraGoodStuff</span><span class="o">=</span><span class="n">ON</span> <span class="n">even</span> <span class="n">though</span> <span class="n">Thyra</span> \
 <span class="n">has</span> <span class="n">an</span> <span class="n">optional</span> <span class="n">dependence</span> <span class="n">on</span> <span class="n">ThyraGoodStuff</span> <span class="n">because</span> <span class="n">Trilinos_ENABLE_SECONDARY_TESTED_CODE</span><span class="o">=</span><span class="n">OFF</span>
<span class="o">--</span> <span class="n">NOTE</span><span class="p">:</span> <span class="n">Not</span> <span class="n">Setting</span> <span class="n">Trilinos_ENABLE_ThyraEpetraExt</span><span class="o">=</span><span class="n">ON</span> <span class="n">even</span> <span class="n">though</span> <span class="n">Thyra</span> \
 <span class="n">has</span> <span class="n">an</span> <span class="n">optional</span> <span class="n">dependence</span> <span class="n">on</span> <span class="n">ThyraEpetraExt</span> <span class="n">because</span> <span class="n">Trilinos_ENABLE_SECONDARY_TESTED_CODE</span><span class="o">=</span><span class="n">OFF</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Trilinos_ENABLE_Epetra</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">ThyraEpetra</span> <span class="n">has</span> <span class="n">a</span> <span class="n">required</span> <span class="n">dependence</span> <span class="n">on</span> <span class="n">Epetra</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Trilinos_ENABLE_Teuchos</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">ThyraCoreLibs</span> <span class="n">has</span> <span class="n">a</span> <span class="n">required</span> <span class="n">dependence</span> <span class="n">on</span> <span class="n">Teuchos</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Trilinos_ENABLE_RTOp</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">ThyraCoreLibs</span> <span class="n">has</span> <span class="n">a</span> <span class="n">required</span> <span class="n">dependence</span> <span class="n">on</span> <span class="n">RTOp</span>

<span class="n">Enabling</span> <span class="nb">all</span> <span class="n">optional</span> <span class="n">intra</span><span class="o">-</span><span class="n">package</span> <span class="n">enables</span> <span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;</span><span class="n">_ENABLE_</span><span class="o">&lt;</span><span class="n">DEPPACKAGE</span><span class="o">&gt;</span> <span class="n">that</span> <span class="n">are</span> 
 <span class="ow">not</span> <span class="n">currently</span> <span class="n">disabled</span> <span class="k">if</span> <span class="n">both</span> <span class="n">sets</span> <span class="n">of</span> <span class="n">packages</span> <span class="n">are</span> <span class="n">enabled</span> <span class="o">...</span>

<span class="o">--</span> <span class="n">Setting</span> <span class="n">Thyra_ENABLE_ThyraEpetra</span><span class="o">=</span><span class="n">ON</span> <span class="n">since</span> <span class="n">Trilinos_ENABLE_Thyra</span><span class="o">=</span><span class="n">ON</span> <span class="n">AND</span> <span class="n">Trilinos_ENABLE_ThyraEpetra</span><span class="o">=</span><span class="n">ON</span>

<span class="n">Enabling</span> <span class="nb">all</span> <span class="n">remaining</span> <span class="n">required</span> <span class="n">TPLs</span> <span class="k">for</span> <span class="n">current</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">enabled</span> <span class="n">packages</span> <span class="o">...</span>

<span class="o">--</span> <span class="n">Setting</span> <span class="n">TPL_ENABLE_BLAS</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">required</span> <span class="n">by</span> <span class="n">the</span> <span class="n">enabled</span> <span class="n">package</span> <span class="n">Teuchos</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">TPL_ENABLE_LAPACK</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">required</span> <span class="n">by</span> <span class="n">the</span> <span class="n">enabled</span> <span class="n">package</span> <span class="n">Teuchos</span>

<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">enabled</span> <span class="n">packages</span><span class="p">:</span>  <span class="n">Teuchos</span> <span class="n">RTOp</span> <span class="n">Epetra</span> <span class="n">Thyra</span> <span class="mi">4</span>
<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">enabled</span> <span class="n">SE</span> <span class="n">packages</span><span class="p">:</span>  <span class="n">Teuchos</span> <span class="n">RTOp</span> <span class="n">Epetra</span> <span class="n">ThyraCoreLibs</span> <span class="n">ThyraEpetra</span> <span class="n">Thyra</span> <span class="mi">6</span>
<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">non</span><span class="o">-</span><span class="n">enabled</span> <span class="n">packages</span><span class="p">:</span>  <span class="n">Triutils</span> <span class="n">EpetraExt</span> <span class="mi">2</span>
<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">non</span><span class="o">-</span><span class="n">enabled</span> <span class="n">SE</span> <span class="n">packages</span><span class="p">:</span>  <span class="n">Triutils</span> <span class="n">EpetraExt</span> <span class="n">ThyraGoodStuff</span> <span class="n">ThyraCrazyStuff</span> <span class="n">ThyraEpetraExt</span> <span class="mi">5</span>
<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">enabled</span> <span class="n">TPLs</span><span class="p">:</span>  <span class="n">BLAS</span> <span class="n">LAPACK</span> <span class="mi">2</span>
<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">non</span><span class="o">-</span><span class="n">enabled</span> <span class="n">TPLs</span><span class="p">:</span>  <span class="n">MPI</span> <span class="n">Boost</span> <span class="n">UMFPACK</span> <span class="n">AMD</span> <span class="n">PETSC</span> <span class="mi">5</span>

<span class="n">Getting</span> <span class="n">information</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">enabled</span> <span class="n">TPLs</span> <span class="o">...</span>

<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">TPL</span><span class="p">:</span> <span class="n">BLAS</span>
<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">TPL</span><span class="p">:</span> <span class="n">LAPACK</span>

<span class="n">Configuring</span> <span class="n">individual</span> <span class="n">enabled</span> <span class="n">Trilinos</span> <span class="n">packages</span> <span class="o">...</span>

<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">package</span><span class="p">:</span> <span class="n">Teuchos</span> <span class="p">(</span><span class="n">Libs</span><span class="p">)</span>
<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">package</span><span class="p">:</span> <span class="n">RTOp</span> <span class="p">(</span><span class="n">Libs</span><span class="p">)</span>
<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">package</span><span class="p">:</span> <span class="n">Epetra</span> <span class="p">(</span><span class="n">Libs</span><span class="p">)</span>
<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">package</span><span class="p">:</span> <span class="n">Thyra</span> <span class="p">(</span><span class="n">CoreLibs</span><span class="p">,</span> <span class="n">Epetra</span><span class="p">,</span> <span class="n">Tests</span><span class="p">,</span> <span class="n">Examples</span><span class="p">)</span>
</pre></div>
</div>
<p>This is a configuration that a developer would use to develop on the <code class="docutils literal notranslate"><span class="pre">Thyra</span></code>
package and its subpackages for example.  There is no need to be enabling the
tests and examples for upstream packages unless those packages are going to be
changed as well.</p>
<p>This case demonstrates a number of TriBITS dependency handling behaviors that
are worth some discussion.</p>
<p>First, note that enabling the parent package <code class="docutils literal notranslate"><span class="pre">Thyra</span></code> with
<code class="docutils literal notranslate"><span class="pre">Trilinos_ENABLE_Thyra=ON</span></code> right away results in the auto-enable of its
<code class="docutils literal notranslate"><span class="pre">PT</span></code> subpackages <code class="docutils literal notranslate"><span class="pre">ThyraCoreLibs</span></code> and <code class="docutils literal notranslate"><span class="pre">ThyraEpetra</span></code> which demonstrates
the behavior <a class="reference internal" href="#enable-disable-of-parent-package-is-enable-disable-for-subpackages">Enable/disable of parent package is enable/disable for
subpackages</a>.  Note that the <code class="docutils literal notranslate"><span class="pre">ST</span></code> subpackages <code class="docutils literal notranslate"><span class="pre">ThyraGoodStuff</span></code> and
<code class="docutils literal notranslate"><span class="pre">ThyraEpetraExt</span></code> where <em>not</em> enabled because
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SECONDARY_TESTED_CODE=OFF</span></code> (which is off by default) which
demonstrates the behavior <a class="reference internal" href="#st-se-packages-only-auto-enabled-if-st-code-is-enabled">ST SE packages only auto-enabled if ST code is
enabled</a>.</p>
<p>Second, note the auto-enable of required upstream SE packages <code class="docutils literal notranslate"><span class="pre">Epetra</span></code>,
<code class="docutils literal notranslate"><span class="pre">RTOp</span></code> and <code class="docutils literal notranslate"><span class="pre">Teuchos</span></code> shown in lines like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">Setting</span> <span class="n">Trilinos_ENABLE_Teuchos</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">ThyraCoreLibs</span> <span class="n">has</span> <span class="n">a</span> <span class="n">required</span> <span class="n">dependence</span> <span class="n">on</span> <span class="n">Teuchos</span>
</pre></div>
</div>
<p>Lastly, note that the final set of enabled packages, SE packages,
tests/examples and TPLs can be clearly seen when processing the TPLs and
top-level packages in the lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Getting</span> <span class="n">information</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">enabled</span> <span class="n">TPLs</span> <span class="o">...</span>

<span class="o">--</span> <span class="n">Processing</span> <span class="n">enabled</span> <span class="n">TPL</span><span class="p">:</span> <span class="n">BLAS</span>
<span class="o">--</span> <span class="n">Processing</span> <span class="n">enabled</span> <span class="n">TPL</span><span class="p">:</span> <span class="n">LAPACK</span>

<span class="n">Configuring</span> <span class="n">individual</span> <span class="n">enabled</span> <span class="n">Trilinos</span> <span class="n">packages</span> <span class="o">...</span>

<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">package</span><span class="p">:</span> <span class="n">Teuchos</span> <span class="p">(</span><span class="n">Libs</span><span class="p">)</span>
<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">package</span><span class="p">:</span> <span class="n">RTOp</span> <span class="p">(</span><span class="n">Libs</span><span class="p">)</span>
<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">package</span><span class="p">:</span> <span class="n">Epetra</span> <span class="p">(</span><span class="n">Libs</span><span class="p">)</span>
<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">package</span><span class="p">:</span> <span class="n">Thyra</span> <span class="p">(</span><span class="n">CoreLibs</span><span class="p">,</span> <span class="n">Epetra</span><span class="p">,</span> <span class="n">Tests</span><span class="p">,</span> <span class="n">Examples</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that subpackage enables are listed with their parent packages along with
if the tests and/or examples are enabled.  Top-level level packages that don’t
have subpackages just show if the <code class="docutils literal notranslate"><span class="pre">Libs</span></code> or also the <code class="docutils literal notranslate"><span class="pre">Tests</span></code> and
<code class="docutils literal notranslate"><span class="pre">Examples</span></code> have been enabled as well.</p>
<p id="explicit-enable-of-a-package-its-tests-an-optional-tpl-with-st-enabled"><strong>Explicit enable of a package, its tests, an optional TPL, with ST enabled</strong></p>
<p>An extended use case shown here is for the explicit enable of a package and its
tests along with the enable of an optional TPL and with <code class="docutils literal notranslate"><span class="pre">ST</span></code> code enabled.
This is a configuration that would be used to support the local development of
a TriBITS package that involves modifying <code class="docutils literal notranslate"><span class="pre">ST</span></code> software.</p>
<p>Consider the configure of the <code class="docutils literal notranslate"><span class="pre">ReducedMockTrilinos</span></code> project with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cmake -DTPL_ENABLE_Boost:BOOL=ON \
   -DTrilinos_ENABLE_Thyra:BOOL=ON \
   -DTrilinos_ENABLE_TESTS:BOOL=ON \
   -DTrilinos_ENABLE_SECONDARY_TESTED_CODE:BOOL=ON \
   -DTrilinos_ENABLE_TESTS:BOOL=ON \
   ${REDUCED_MOCK_TRILINOS}
</pre></div>
</div>
<p>which produces the relevant dependency-related output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Explicitly</span> <span class="n">enabled</span> <span class="n">packages</span> <span class="n">on</span> <span class="nb">input</span> <span class="p">(</span><span class="n">by</span> <span class="n">user</span><span class="p">):</span>  <span class="n">Thyra</span> <span class="mi">1</span>
<span class="n">Explicitly</span> <span class="n">enabled</span> <span class="n">SE</span> <span class="n">packages</span> <span class="n">on</span> <span class="nb">input</span> <span class="p">(</span><span class="n">by</span> <span class="n">user</span><span class="p">):</span>  <span class="n">Thyra</span> <span class="mi">1</span>
<span class="n">Explicitly</span> <span class="n">disabled</span> <span class="n">packages</span> <span class="n">on</span> <span class="nb">input</span> <span class="p">(</span><span class="n">by</span> <span class="n">user</span> <span class="ow">or</span> <span class="n">by</span> <span class="n">default</span><span class="p">):</span>  <span class="mi">0</span>
<span class="n">Explicitly</span> <span class="n">disabled</span> <span class="n">SE</span> <span class="n">packages</span> <span class="n">on</span> <span class="nb">input</span> <span class="p">(</span><span class="n">by</span> <span class="n">user</span> <span class="ow">or</span> <span class="n">by</span> <span class="n">default</span><span class="p">):</span>  <span class="n">ThyraCrazyStuff</span> <span class="mi">1</span>
<span class="n">Explicitly</span> <span class="n">enabled</span> <span class="n">TPLs</span> <span class="n">on</span> <span class="nb">input</span> <span class="p">(</span><span class="n">by</span> <span class="n">user</span><span class="p">):</span>  <span class="n">Boost</span> <span class="mi">1</span>
<span class="n">Explicitly</span> <span class="n">disabled</span> <span class="n">TPLs</span> <span class="n">on</span> <span class="nb">input</span> <span class="p">(</span><span class="n">by</span> <span class="n">user</span> <span class="ow">or</span> <span class="n">by</span> <span class="n">default</span><span class="p">):</span>  <span class="mi">0</span>

<span class="n">Enabling</span> <span class="n">subpackages</span> <span class="k">for</span> <span class="n">hard</span> <span class="n">enables</span> <span class="n">of</span> <span class="n">parent</span> <span class="n">packages</span> <span class="n">due</span> <span class="n">to</span> \
 <span class="n">Trilinos_ENABLE_</span><span class="o">&lt;</span><span class="n">PARENT_PACKAGE</span><span class="o">&gt;=</span><span class="n">ON</span> <span class="o">...</span>

<span class="o">--</span> <span class="n">Setting</span> <span class="n">subpackage</span> <span class="n">enable</span> <span class="n">Trilinos_ENABLE_ThyraCoreLibs</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">parent</span> <span class="n">package</span> \
 <span class="n">Trilinos_ENABLE_Thyra</span><span class="o">=</span><span class="n">ON</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">subpackage</span> <span class="n">enable</span> <span class="n">Trilinos_ENABLE_ThyraGoodStuff</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">parent</span> <span class="n">package</span> \
 <span class="n">Trilinos_ENABLE_Thyra</span><span class="o">=</span><span class="n">ON</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">subpackage</span> <span class="n">enable</span> <span class="n">Trilinos_ENABLE_ThyraEpetra</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">parent</span> <span class="n">package</span> \
 <span class="n">Trilinos_ENABLE_Thyra</span><span class="o">=</span><span class="n">ON</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">subpackage</span> <span class="n">enable</span> <span class="n">Trilinos_ENABLE_ThyraEpetraExt</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">parent</span> <span class="n">package</span> \
 <span class="n">Trilinos_ENABLE_Thyra</span><span class="o">=</span><span class="n">ON</span>

<span class="n">Disabling</span> <span class="n">forward</span> <span class="n">required</span> <span class="n">SE</span> <span class="n">packages</span> <span class="ow">and</span> <span class="n">optional</span> <span class="n">intra</span><span class="o">-</span><span class="n">package</span> <span class="n">support</span> <span class="n">that</span> <span class="n">have</span> <span class="n">a</span> \
 <span class="n">dependency</span> <span class="n">on</span> <span class="n">disabled</span> <span class="n">SE</span> <span class="n">packages</span> <span class="n">Trilinos_ENABLE_</span><span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;=</span><span class="n">OFF</span> <span class="o">...</span>

<span class="o">--</span> <span class="n">Setting</span> <span class="n">Thyra_ENABLE_ThyraCrazyStuff</span><span class="o">=</span><span class="n">OFF</span> <span class="n">because</span> <span class="n">Thyra</span> <span class="n">has</span> <span class="n">an</span> <span class="n">optional</span> <span class="n">library</span> \
 <span class="n">dependence</span> <span class="n">on</span> <span class="n">disabled</span> <span class="n">package</span> <span class="n">ThyraCrazyStuff</span>

<span class="n">Enabling</span> <span class="nb">all</span> <span class="n">tests</span> <span class="ow">and</span><span class="o">/</span><span class="ow">or</span> <span class="n">examples</span> <span class="n">that</span> <span class="n">have</span> <span class="ow">not</span> <span class="n">been</span> <span class="n">explicitly</span> <span class="n">disabled</span> <span class="n">because</span> \
 <span class="n">Trilinos_ENABLE_</span><span class="p">[</span><span class="n">TESTS</span><span class="p">,</span><span class="n">EXAMPLES</span><span class="p">]</span><span class="o">=</span><span class="n">ON</span> <span class="o">...</span>

<span class="o">--</span> <span class="n">Setting</span> <span class="n">ThyraCoreLibs_ENABLE_TESTS</span><span class="o">=</span><span class="n">ON</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">ThyraGoodStuff_ENABLE_TESTS</span><span class="o">=</span><span class="n">ON</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">ThyraEpetra_ENABLE_TESTS</span><span class="o">=</span><span class="n">ON</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">ThyraEpetraExt_ENABLE_TESTS</span><span class="o">=</span><span class="n">ON</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Thyra_ENABLE_TESTS</span><span class="o">=</span><span class="n">ON</span>

<span class="n">Enabling</span> <span class="nb">all</span> <span class="n">required</span> <span class="p">(</span><span class="ow">and</span> <span class="n">optional</span> <span class="n">since</span> <span class="n">Trilinos_ENABLE_ALL_OPTIONAL_PACKAGES</span><span class="o">=</span><span class="n">ON</span><span class="p">)</span> \
 <span class="n">upstream</span> <span class="n">SE</span> <span class="n">packages</span> <span class="k">for</span> <span class="n">current</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">enabled</span> <span class="n">packages</span> <span class="o">...</span>

<span class="o">--</span> <span class="n">Setting</span> <span class="n">Trilinos_ENABLE_EpetraExt</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">ThyraEpetraExt</span> <span class="n">has</span> <span class="n">a</span> <span class="n">required</span> <span class="n">dependence</span> <span class="n">on</span> <span class="n">EpetraExt</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Trilinos_ENABLE_Epetra</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">ThyraEpetra</span> <span class="n">has</span> <span class="n">a</span> <span class="n">required</span> <span class="n">dependence</span> <span class="n">on</span> <span class="n">Epetra</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Trilinos_ENABLE_Teuchos</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">ThyraCoreLibs</span> <span class="n">has</span> <span class="n">a</span> <span class="n">required</span> <span class="n">dependence</span> <span class="n">on</span> <span class="n">Teuchos</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Trilinos_ENABLE_RTOp</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">ThyraCoreLibs</span> <span class="n">has</span> <span class="n">a</span> <span class="n">required</span> <span class="n">dependence</span> <span class="n">on</span> <span class="n">RTOp</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Trilinos_ENABLE_Triutils</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">EpetraExt</span> <span class="n">has</span> <span class="n">an</span> <span class="n">optional</span> <span class="n">dependence</span> <span class="n">on</span> <span class="n">Triutils</span>

<span class="n">Enabling</span> <span class="nb">all</span> <span class="n">optional</span> <span class="n">intra</span><span class="o">-</span><span class="n">package</span> <span class="n">enables</span> <span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;</span><span class="n">_ENABLE_</span><span class="o">&lt;</span><span class="n">DEPPACKAGE</span><span class="o">&gt;</span> <span class="n">that</span> <span class="n">are</span> \
 <span class="ow">not</span> <span class="n">currently</span> <span class="n">disabled</span> <span class="k">if</span> <span class="n">both</span> <span class="n">sets</span> <span class="n">of</span> <span class="n">packages</span> <span class="n">are</span> <span class="n">enabled</span> <span class="o">...</span>

<span class="o">--</span> <span class="n">Setting</span> <span class="n">EpetraExt_ENABLE_Triutils</span><span class="o">=</span><span class="n">ON</span> <span class="n">since</span> <span class="n">Trilinos_ENABLE_EpetraExt</span><span class="o">=</span><span class="n">ON</span> \
 <span class="n">AND</span> <span class="n">Trilinos_ENABLE_Triutils</span><span class="o">=</span><span class="n">ON</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Thyra_ENABLE_ThyraGoodStuff</span><span class="o">=</span><span class="n">ON</span> <span class="n">since</span> <span class="n">Trilinos_ENABLE_Thyra</span><span class="o">=</span><span class="n">ON</span> \
 <span class="n">AND</span> <span class="n">Trilinos_ENABLE_ThyraGoodStuff</span><span class="o">=</span><span class="n">ON</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Thyra_ENABLE_ThyraEpetra</span><span class="o">=</span><span class="n">ON</span> <span class="n">since</span> <span class="n">Trilinos_ENABLE_Thyra</span><span class="o">=</span><span class="n">ON</span> \
 <span class="n">AND</span> <span class="n">Trilinos_ENABLE_ThyraEpetra</span><span class="o">=</span><span class="n">ON</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Thyra_ENABLE_ThyraEpetraExt</span><span class="o">=</span><span class="n">ON</span> <span class="n">since</span> <span class="n">Trilinos_ENABLE_Thyra</span><span class="o">=</span><span class="n">ON</span> \
 <span class="n">AND</span> <span class="n">Trilinos_ENABLE_ThyraEpetraExt</span><span class="o">=</span><span class="n">ON</span>

<span class="n">Enabling</span> <span class="nb">all</span> <span class="n">remaining</span> <span class="n">required</span> <span class="n">TPLs</span> <span class="k">for</span> <span class="n">current</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">enabled</span> <span class="n">packages</span> <span class="o">...</span>

<span class="o">--</span> <span class="n">Setting</span> <span class="n">TPL_ENABLE_BLAS</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">required</span> <span class="n">by</span> <span class="n">the</span> <span class="n">enabled</span> <span class="n">package</span> <span class="n">Teuchos</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">TPL_ENABLE_LAPACK</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">required</span> <span class="n">by</span> <span class="n">the</span> <span class="n">enabled</span> <span class="n">package</span> <span class="n">Teuchos</span>

<span class="n">Enabling</span> <span class="nb">all</span> <span class="n">optional</span> <span class="n">package</span> <span class="n">TPL</span> <span class="n">support</span> <span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;</span><span class="n">_ENABLE_</span><span class="o">&lt;</span><span class="n">DEPTPL</span><span class="o">&gt;</span> <span class="ow">not</span> <span class="n">currently</span> <span class="n">disabled</span> <span class="k">for</span> <span class="n">enabled</span> <span class="n">TPLs</span> <span class="o">...</span>

<span class="o">--</span> <span class="n">Setting</span> <span class="n">Teuchos_ENABLE_Boost</span><span class="o">=</span><span class="n">ON</span> <span class="n">since</span> <span class="n">TPL_ENABLE_Boost</span><span class="o">=</span><span class="n">ON</span>

<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">enabled</span> <span class="n">packages</span><span class="p">:</span>  <span class="n">Teuchos</span> <span class="n">RTOp</span> <span class="n">Epetra</span> <span class="n">Triutils</span> <span class="n">EpetraExt</span> <span class="n">Thyra</span> <span class="mi">6</span>
<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">enabled</span> <span class="n">SE</span> <span class="n">packages</span><span class="p">:</span>  <span class="n">Teuchos</span> <span class="n">RTOp</span> <span class="n">Epetra</span> <span class="n">Triutils</span> <span class="n">EpetraExt</span> <span class="n">ThyraCoreLibs</span> \
 <span class="n">ThyraGoodStuff</span> <span class="n">ThyraEpetra</span> <span class="n">ThyraEpetraExt</span> <span class="n">Thyra</span> <span class="mi">10</span>
<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">non</span><span class="o">-</span><span class="n">enabled</span> <span class="n">packages</span><span class="p">:</span>  <span class="mi">0</span>
<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">non</span><span class="o">-</span><span class="n">enabled</span> <span class="n">SE</span> <span class="n">packages</span><span class="p">:</span>  <span class="n">ThyraCrazyStuff</span> <span class="mi">1</span>
<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">enabled</span> <span class="n">TPLs</span><span class="p">:</span>  <span class="n">BLAS</span> <span class="n">LAPACK</span> <span class="n">Boost</span> <span class="mi">3</span>
<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">non</span><span class="o">-</span><span class="n">enabled</span> <span class="n">TPLs</span><span class="p">:</span>  <span class="n">MPI</span> <span class="n">UMFPACK</span> <span class="n">AMD</span> <span class="n">PETSC</span> <span class="mi">4</span>

<span class="n">Getting</span> <span class="n">information</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">enabled</span> <span class="n">TPLs</span> <span class="o">...</span>

<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">TPL</span><span class="p">:</span> <span class="n">BLAS</span>
<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">TPL</span><span class="p">:</span> <span class="n">LAPACK</span>
<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">TPL</span><span class="p">:</span> <span class="n">Boost</span>

<span class="n">Configuring</span> <span class="n">individual</span> <span class="n">enabled</span> <span class="n">Trilinos</span> <span class="n">packages</span> <span class="o">...</span>

<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">package</span><span class="p">:</span> <span class="n">Teuchos</span> <span class="p">(</span><span class="n">Libs</span><span class="p">)</span>
<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">package</span><span class="p">:</span> <span class="n">RTOp</span> <span class="p">(</span><span class="n">Libs</span><span class="p">)</span>
<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">package</span><span class="p">:</span> <span class="n">Epetra</span> <span class="p">(</span><span class="n">Libs</span><span class="p">)</span>
<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">package</span><span class="p">:</span> <span class="n">Triutils</span> <span class="p">(</span><span class="n">Libs</span><span class="p">)</span>
<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">package</span><span class="p">:</span> <span class="n">EpetraExt</span> <span class="p">(</span><span class="n">Libs</span><span class="p">)</span>
<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">package</span><span class="p">:</span> <span class="n">Thyra</span> <span class="p">(</span><span class="n">CoreLibs</span><span class="p">,</span> <span class="n">GoodStuff</span><span class="p">,</span> <span class="n">Epetra</span><span class="p">,</span> <span class="n">EpetraExt</span><span class="p">,</span> <span class="n">Tests</span><span class="p">,</span> <span class="n">Examples</span><span class="p">)</span>
</pre></div>
</div>
<p>A few more behaviors of the TriBITS system that this particular configuration
use-case shows are described below.</p>
<p>First, note the enable of the <code class="docutils literal notranslate"><span class="pre">ST</span></code> <code class="docutils literal notranslate"><span class="pre">Thyra</span></code> subpackages in lines like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">Setting</span> <span class="n">subpackage</span> <span class="n">enable</span> <span class="n">Trilinos_ENABLE_ThyraGoodStuff</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">parent</span> <span class="n">package</span> \
 <span class="n">Trilinos_ENABLE_Thyra</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>Second, note the auto-enable of support for optional SE packages in lines
like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">Setting</span> <span class="n">EpetraExt_ENABLE_Triutils</span><span class="o">=</span><span class="n">ON</span> <span class="n">since</span> <span class="n">Trilinos_ENABLE_EpetraExt</span><span class="o">=</span><span class="n">ON</span> \
 <span class="n">AND</span> <span class="n">Trilinos_ENABLE_Triutils</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>Third, note the auto-enable of support for the optional TPL <code class="docutils literal notranslate"><span class="pre">Boost</span></code> in the
line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">Setting</span> <span class="n">Teuchos_ENABLE_Boost</span><span class="o">=</span><span class="n">ON</span> <span class="n">since</span> <span class="n">TPL_ENABLE_Boost</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p id="explicit-disable-of-a-package"><strong>Explicit disable of a package</strong></p>
<p>Another common use case is to enable a package but to disable an optional
upstream package.  This type of configuration would be used as part of a
“black list” approach to enabling only a subset of packages and optional
support.  The “black list” approach is to enable a package with
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_ALL_OPTIONAL_PACKAGES=ON</span></code> (the TriBITS default) but
then to turn off a specific set of packages that you don’t want.  This is
contrasted with a “white list” approach where you would configure with
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_ALL_OPTIONAL_PACKAGES=OFF</span></code> and then have to manually
enable all of the optional packages you want.  Experience with projects like
Trilinos show that the “black list” approach is generally to be preferred for
a few reasons.</p>
<p>Consider the configure of the <code class="docutils literal notranslate"><span class="pre">ReducedMockTrilinos</span></code> project enabling <code class="docutils literal notranslate"><span class="pre">Thyra</span></code> but disabling <code class="docutils literal notranslate"><span class="pre">Epetra</span></code> with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cmake  -DTrilinos_ENABLE_Thyra:BOOL=ON \
   -DTrilinos_ENABLE_Epetra:BOOL=OFF \
   -DTrilinos_ENABLE_TESTS:BOOL=ON \
   ${REDUCED_MOCK_TRILINOS}
</pre></div>
</div>
<p>which produces the relevant dependency-related output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Disabling</span> <span class="n">forward</span> <span class="n">required</span> <span class="n">SE</span> <span class="n">packages</span> <span class="ow">and</span> <span class="n">optional</span> <span class="n">intra</span><span class="o">-</span><span class="n">package</span> <span class="n">support</span> <span class="n">that</span> <span class="n">have</span> <span class="n">a</span> \
 <span class="n">dependency</span> <span class="n">on</span> <span class="n">disabled</span> <span class="n">SE</span> <span class="n">packages</span> <span class="n">Trilinos_ENABLE_</span><span class="o">&lt;</span><span class="n">TRIBITS_PACKAGE</span><span class="o">&gt;=</span><span class="n">OFF</span> <span class="o">...</span>

<span class="o">--</span> <span class="n">Setting</span> <span class="n">Trilinos_ENABLE_Triutils</span><span class="o">=</span><span class="n">OFF</span> <span class="n">because</span> <span class="n">Triutils</span> <span class="n">has</span> <span class="n">a</span> <span class="n">required</span> <span class="n">library</span> <span class="n">dependence</span> \
 <span class="n">on</span> <span class="n">disabled</span> <span class="n">package</span> <span class="n">Epetra</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Trilinos_ENABLE_EpetraExt</span><span class="o">=</span><span class="n">OFF</span> <span class="n">because</span> <span class="n">EpetraExt</span> <span class="n">has</span> <span class="n">a</span> <span class="n">required</span> <span class="n">library</span> \
 <span class="n">disabled</span> <span class="n">package</span> <span class="n">Epetra</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Trilinos_ENABLE_ThyraEpetra</span><span class="o">=</span><span class="n">OFF</span> <span class="n">because</span> <span class="n">ThyraEpetra</span> <span class="n">has</span> <span class="n">a</span> <span class="n">required</span> <span class="n">library</span> \
 <span class="n">disabled</span> <span class="n">package</span> <span class="n">Epetra</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Trilinos_ENABLE_ThyraEpetraExt</span><span class="o">=</span><span class="n">OFF</span> <span class="n">because</span> <span class="n">ThyraEpetraExt</span> <span class="n">has</span> <span class="n">a</span> <span class="n">required</span> <span class="n">library</span> \
 <span class="n">disabled</span> <span class="n">package</span> <span class="n">EpetraExt</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Thyra_ENABLE_ThyraCrazyStuff</span><span class="o">=</span><span class="n">OFF</span> <span class="n">because</span> <span class="n">Thyra</span> <span class="n">has</span> <span class="n">an</span> <span class="n">optional</span> <span class="n">library</span> \
 <span class="n">disabled</span> <span class="n">package</span> <span class="n">ThyraCrazyStuff</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Thyra_ENABLE_ThyraEpetra</span><span class="o">=</span><span class="n">OFF</span> <span class="n">because</span> <span class="n">Thyra</span> <span class="n">has</span> <span class="n">an</span> <span class="n">optional</span> <span class="n">library</span> \
 <span class="n">disabled</span> <span class="n">package</span> <span class="n">ThyraEpetra</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Thyra_ENABLE_ThyraEpetraExt</span><span class="o">=</span><span class="n">OFF</span> <span class="n">because</span> <span class="n">Thyra</span> <span class="n">has</span> <span class="n">an</span> <span class="n">optional</span> <span class="n">library</span> \
 <span class="n">disabled</span> <span class="n">package</span> <span class="n">ThyraEpetraExt</span>

<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">enabled</span> <span class="n">packages</span><span class="p">:</span>  <span class="n">Teuchos</span> <span class="n">RTOp</span> <span class="n">Thyra</span> <span class="mi">3</span>
<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">enabled</span> <span class="n">SE</span> <span class="n">packages</span><span class="p">:</span>  <span class="n">Teuchos</span> <span class="n">RTOp</span> <span class="n">ThyraCoreLibs</span> <span class="n">Thyra</span> <span class="mi">4</span>
<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">non</span><span class="o">-</span><span class="n">enabled</span> <span class="n">packages</span><span class="p">:</span>  <span class="n">Epetra</span> <span class="n">Triutils</span> <span class="n">EpetraExt</span> <span class="mi">3</span>
<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">non</span><span class="o">-</span><span class="n">enabled</span> <span class="n">SE</span> <span class="n">packages</span><span class="p">:</span>  <span class="n">Epetra</span> <span class="n">Triutils</span> <span class="n">EpetraExt</span> <span class="n">ThyraGoodStuff</span> \
 <span class="n">ThyraCrazyStuff</span> <span class="n">ThyraEpetra</span> <span class="n">ThyraEpetraExt</span> <span class="mi">7</span>
<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">enabled</span> <span class="n">TPLs</span><span class="p">:</span>  <span class="n">BLAS</span> <span class="n">LAPACK</span> <span class="mi">2</span>
<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">non</span><span class="o">-</span><span class="n">enabled</span> <span class="n">TPLs</span><span class="p">:</span>  <span class="n">MPI</span> <span class="n">Boost</span> <span class="n">UMFPACK</span> <span class="n">AMD</span> <span class="n">PETSC</span> <span class="mi">5</span>

<span class="n">Configuring</span> <span class="n">individual</span> <span class="n">enabled</span> <span class="n">Trilinos</span> <span class="n">packages</span> <span class="o">...</span>

<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">package</span><span class="p">:</span> <span class="n">Teuchos</span> <span class="p">(</span><span class="n">Libs</span><span class="p">)</span>
<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">package</span><span class="p">:</span> <span class="n">RTOp</span> <span class="p">(</span><span class="n">Libs</span><span class="p">)</span>
<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">package</span><span class="p">:</span> <span class="n">Thyra</span> <span class="p">(</span><span class="n">CoreLibs</span><span class="p">,</span> <span class="n">Tests</span><span class="p">,</span> <span class="n">Examples</span><span class="p">)</span>

</pre></div>
</div>
<p>Note how the disable of <code class="docutils literal notranslate"><span class="pre">Epetra</span></code> wipes out all of the required and optional
SE packages and intra-package dependencies that depend on <code class="docutils literal notranslate"><span class="pre">Epetra</span></code>.  What is
left is only the <code class="docutils literal notranslate"><span class="pre">ThyraCoreLibs</span></code> and its upstream dependencies that don’t
depend on <code class="docutils literal notranslate"><span class="pre">Epetra</span></code> (which is only <code class="docutils literal notranslate"><span class="pre">RTOp</span></code> and <code class="docutils literal notranslate"><span class="pre">Teuchos</span></code>).</p>
<p id="conflicting-explicit-enable-and-disable"><strong>Conflicting explicit enable and disable</strong></p>
<p>One use case that occasionally comes up is when a set of inconsistent enables
and disables are set.  While this seems illogical that anyone would ever do
this, when it comes to larger more complex projects with lots of packages and
lots of dependencies, this can happen very easily.  In some cases, someone is
enabling a set of packages they want and is trying to weed out as many of the
(what they think) are optional dependencies that they don’t need and
accidentally disables a package that is an indirect required dependency of one
of the packages they want (in which case the configure should likely fail and
provide a good error message).  The other use case where conflicting
enables/disables can occur is in CTest drivers using <a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a>
where an upstream package has failed and is explicitly disabled (in which case
it should gracefully disable downstream dependent packages).  TriBITS can
either be set up to have the disable override the explicit enable or stop the
configure in error depending on the value of the cache variable
<a class="reference internal" href="#project-name-disable-enabled-forward-dep-packages">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES</a> (see <a class="reference internal" href="#disables-trump-enables-where-there-is-a-conflict">Disables trump
enables where there is a conflict</a>).</p>
<p>For example, consider what happens with the <code class="docutils literal notranslate"><span class="pre">ReducedMockTrilinos</span></code> project if
someone tries to enable the <code class="docutils literal notranslate"><span class="pre">RTOp</span></code> package and disable the <code class="docutils literal notranslate"><span class="pre">Teuchos</span></code>
package.  This is not consistent because <code class="docutils literal notranslate"><span class="pre">RTOp</span></code> has a required dependency on
<code class="docutils literal notranslate"><span class="pre">Teuchos</span></code>.  The default behavior of TriBITS is this case is shown in the
below configure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cmake -DTrilinos_ENABLE_Epetra:BOOL=ON \
   -DTrilinos_ENABLE_RTOp:BOOL=ON \
   -DTrilinos_ENABLE_Teuchos:BOOL=OFF \
   ${REDUCED_MOCK_TRILINOS}
</pre></div>
</div>
<p>which produces the relevant dependency-related output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Explicitly enabled packages on input (by user):  RTOp Epetra 2
Explicitly disabled packages on input (by user or by default):  Teuchos 1

Disabling forward required SE packages and optional intra-package support that have \
 a dependency on disabled SE packages Trilinos_ENABLE_&lt;TRIBITS_PACKAGE&gt;=OFF ...

   ***
   *** ERROR: Setting Trilinos_ENABLE_RTOp=OFF which was &#39;ON&#39; because RTOp has a required \
 library dependence on disabled package Teuchos!
   ***
</pre></div>
</div>
<p>As shown above, the TriBITS default (which is
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES=OFF</span></code>) results in a
configure-time error with a good error message.</p>
<p>However, if one sets
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES=ON</span></code> and configures
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cmake -DTrilinos_ENABLE_Epetra:BOOL=ON \
   -DTrilinos_ENABLE_RTOp:BOOL=ON \
   -DTrilinos_ENABLE_Teuchos:BOOL=OFF \
   -DTrilinos_DISABLE_ENABLED_FORWARD_DEP_PACKAGES:BOOL=ON \
   ${REDUCED_MOCK_TRILINOS}
</pre></div>
</div>
<p>then the disable trumps the enable and results in a successful configure as
shown in the following relevant dependency-related output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Explicitly enabled packages on input (by user):  RTOp Epetra 2
Explicitly disabled packages on input (by user or by default):  Teuchos 1

Disabling forward required SE packages and optional intra-package support that \
 have a dependency on disabled SE packages Trilinos_ENABLE_&lt;TRIBITS_PACKAGE&gt;=OFF ...

 ***
 *** NOTE: Setting Trilinos_ENABLE_RTOp=OFF which was &#39;ON&#39; because RTOp has \
 a required library dependence on disabled package Teuchos but \
 Trilinos_DISABLE_ENABLED_FORWARD_DEP_PACKAGES=ON!
 ***

Final set of enabled packages:  Epetra 1
Final set of non-enabled packages:  Teuchos RTOp Triutils EpetraExt Thyra 5
</pre></div>
</div>
<p>As shown above, what you end up with is just the enabled package <code class="docutils literal notranslate"><span class="pre">Epetra</span></code>
which does not have a required dependency on the disabled package <code class="docutils literal notranslate"><span class="pre">Teuchos</span></code>.
Developers of large complex TriBITS projects would be wise to set the default
for <a class="reference internal" href="#project-name-disable-enabled-forward-dep-packages">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES</a> to <code class="docutils literal notranslate"><span class="pre">ON</span></code>,
especially in automated builds and testing.</p>
<p id="explicit-enable-of-an-optional-tpl"><strong>Explicit enable of an optional TPL</strong>:</p>
<p>ToDo: Set Trilinos_ENABLE_Thyra=ON and TPL_ENABLE_MPI=ON</p>
<p id="explicit-disable-of-an-optional-tpl"><strong>Explicit disable of an optional TPL</strong>:</p>
<p>ToDo: Set Trilinos_ENABLE_Thyra=ON and TPL_ENABLE_MPI=OFF</p>
<p id="explicit-disable-of-a-required-tpl"><strong>Explicit disable of a required TPL</strong></p>
<p>ToDo: Set Trilinos_ENABLE_Epetra=ON and Trilinos_ENABLE_BLAS=OFF</p>
<p id="explicit-enable-of-a-subpackage"><strong>Explicit enable of a subpackage</strong></p>
<p>ToDo: Enable ThyraEpetra and show how it enables other SE packages and at the
end, enables the Thyra package (just for show).</p>
<p id="explicit-enable-of-an-optional-package-dependency"><strong>Explicit enable of an optional package dependency</strong></p>
<p>ToDo: Set Trilinos_ENABLE_EpetraExt=ON and EpetraExt_ENABLE_Triutils=ON and
shows how it enables Trilinos_ENABLE_Triutils=ON even through ST code is not
enabled.</p>
<p id="explicit-disable-of-an-optional-package-dependency"><strong>Explicit disable of an optional package dependency</strong></p>
<p>ToDo: Set Trilinos_ENABLE_EpetraExt=ON, Trilinos_ENABLE_Triutils=ON, and
EpetraExt_ENABLE_Triutils=OFF.  Discuss how EpetraExt’s and ThyraEpetraExt’s
CMakeLists.txt files might turn off some features if they detects that
EpetraExt/Triutils support is turned off.</p>
<p id="explicit-enable-of-an-optional-tpl-dependency"><strong>Explicit enable of an optional TPL dependency</strong></p>
<p>ToDo: The current ReducedMockTrilinos is not set up to give a good example of
this.  We should add an optional Boost dependency to say, Epetra.  Then we
could show the enable of Teuchos and Epetra and Epetra_ENABLE_Boost=ON.  That
would enable Boost and enable support for Boost in Epetra but would not
provide support for Boost in Teuchos.</p>
<p id="explicit-disable-of-an-optional-tpl-dependency"><strong>Explicit disable of an optional TPL dependency</strong></p>
<p>ToDo: The current ReducedMockTrilinos is not set up to give a good example of
this.  We should add an optional Boost dependency to say, Epetra.  Then we
could show the enable of Teuchos and Epetra and TPL_ENABLE_Boost=ON but set
Epetra_ENABLE_Boost=OFF.  That would provide support for Boost in Teuchos but
not in Epetra.</p>
<p id="explicit-enable-of-a-package-and-downstream-packages-and-tests"><strong>Explicit enable of a package and downstream packages and tests</strong></p>
<p>ToDo: Set Trilinos_ENABLE_RTOp=ON,
Trilinos_ENABLE_ALL_FORWARD_DEP_PACKAGES=ON, and Trilinos_ENABLE_TESTS=ON and
show what packages and tests/examples get enabled.  This is the use case for
the checkin-test.py tool for PT enabled code.</p>
<p id="enable-all-packages"><strong>Enable all packages</strong></p>
<p>The last use case to consider is enabling all defined packages.  This
configuration would be used for either doing a full test of all of the
packages defined or to create a distribution of the project.</p>
<p>Enabling all <code class="docutils literal notranslate"><span class="pre">PT</span></code> packages the with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cmake -DTrilinos_ENABLE_ALL_PACKAGES:BOOL=ON \
   -DTrilinos_DUMP_PACKAGE_DEPENDENCIES:BOOL=ON \
   ${REDUCED_MOCK_TRILINOS}
</pre></div>
</div>
<p>produces the relevant dependency-related output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Enabling</span> <span class="nb">all</span> <span class="n">SE</span> <span class="n">packages</span> <span class="n">that</span> <span class="n">are</span> <span class="ow">not</span> <span class="n">currently</span> <span class="n">disabled</span> <span class="n">because</span> <span class="n">of</span> \
 <span class="n">Trilinos_ENABLE_ALL_PACKAGES</span><span class="o">=</span><span class="n">ON</span> <span class="p">(</span><span class="n">Trilinos_ENABLE_SECONDARY_TESTED_CODE</span><span class="o">=</span><span class="n">OFF</span><span class="p">)</span> <span class="o">...</span>

<span class="o">--</span> <span class="n">Setting</span> <span class="n">Trilinos_ENABLE_Teuchos</span><span class="o">=</span><span class="n">ON</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Trilinos_ENABLE_RTOp</span><span class="o">=</span><span class="n">ON</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Trilinos_ENABLE_Epetra</span><span class="o">=</span><span class="n">ON</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Trilinos_ENABLE_ThyraCoreLibs</span><span class="o">=</span><span class="n">ON</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Trilinos_ENABLE_ThyraEpetra</span><span class="o">=</span><span class="n">ON</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">Trilinos_ENABLE_Thyra</span><span class="o">=</span><span class="n">ON</span>

<span class="n">Enabling</span> <span class="nb">all</span> <span class="n">remaining</span> <span class="n">required</span> <span class="n">TPLs</span> <span class="k">for</span> <span class="n">current</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">enabled</span> <span class="n">packages</span> <span class="o">...</span>

<span class="o">--</span> <span class="n">Setting</span> <span class="n">TPL_ENABLE_BLAS</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">required</span> <span class="n">by</span> <span class="n">the</span> <span class="n">enabled</span> <span class="n">package</span> <span class="n">Teuchos</span>
<span class="o">--</span> <span class="n">Setting</span> <span class="n">TPL_ENABLE_LAPACK</span><span class="o">=</span><span class="n">ON</span> <span class="n">because</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">required</span> <span class="n">by</span> <span class="n">the</span> <span class="n">enabled</span> <span class="n">package</span> <span class="n">Teuchos</span>

<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">enabled</span> <span class="n">packages</span><span class="p">:</span>  <span class="n">Teuchos</span> <span class="n">RTOp</span> <span class="n">Epetra</span> <span class="n">Thyra</span> <span class="mi">4</span>
<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">enabled</span> <span class="n">SE</span> <span class="n">packages</span><span class="p">:</span>  <span class="n">Teuchos</span> <span class="n">RTOp</span> <span class="n">Epetra</span> <span class="n">ThyraCoreLibs</span> <span class="n">ThyraEpetra</span> <span class="n">Thyra</span> <span class="mi">6</span>
<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">non</span><span class="o">-</span><span class="n">enabled</span> <span class="n">packages</span><span class="p">:</span>  <span class="n">Triutils</span> <span class="n">EpetraExt</span> <span class="mi">2</span>
<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">non</span><span class="o">-</span><span class="n">enabled</span> <span class="n">SE</span> <span class="n">packages</span><span class="p">:</span>  <span class="n">Triutils</span> <span class="n">EpetraExt</span> <span class="n">ThyraGoodStuff</span> <span class="n">ThyraCrazyStuff</span> <span class="n">ThyraEpetraExt</span> <span class="mi">5</span>
<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">enabled</span> <span class="n">TPLs</span><span class="p">:</span>  <span class="n">BLAS</span> <span class="n">LAPACK</span> <span class="mi">2</span>
<span class="n">Final</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">non</span><span class="o">-</span><span class="n">enabled</span> <span class="n">TPLs</span><span class="p">:</span>  <span class="n">MPI</span> <span class="n">Boost</span> <span class="n">UMFPACK</span> <span class="n">AMD</span> <span class="n">PETSC</span> <span class="mi">5</span>

<span class="n">Getting</span> <span class="n">information</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">enabled</span> <span class="n">TPLs</span> <span class="o">...</span>

<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">TPL</span><span class="p">:</span> <span class="n">BLAS</span>
<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">TPL</span><span class="p">:</span> <span class="n">LAPACK</span>

<span class="n">Configuring</span> <span class="n">individual</span> <span class="n">enabled</span> <span class="n">Trilinos</span> <span class="n">packages</span> <span class="o">...</span>

<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">package</span><span class="p">:</span> <span class="n">Teuchos</span> <span class="p">(</span><span class="n">Libs</span><span class="p">)</span>
<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">package</span><span class="p">:</span> <span class="n">RTOp</span> <span class="p">(</span><span class="n">Libs</span><span class="p">)</span>
<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">package</span><span class="p">:</span> <span class="n">Epetra</span> <span class="p">(</span><span class="n">Libs</span><span class="p">)</span>
<span class="n">Processing</span> <span class="n">enabled</span> <span class="n">package</span><span class="p">:</span> <span class="n">Thyra</span> <span class="p">(</span><span class="n">CoreLibs</span><span class="p">,</span> <span class="n">Epetra</span><span class="p">)</span>
</pre></div>
</div>
<p>As shown above, only the <code class="docutils literal notranslate"><span class="pre">PT</span></code> SE packages get enabled.  To also enable the
<code class="docutils literal notranslate"><span class="pre">ST</span></code> packages as well, one additionally set
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SECONDARY_TESTED_CODE=ON</span></code> at configure time.</p>
</section>
<section id="tribits-project-dependencies-xml-file-and-tools">
<span id="project-packagedependencies-xml"></span><h2><a class="toc-backref" href="#id46"><span class="sectnum">5.4</span> TriBITS Project Dependencies XML file and tools</a><a class="headerlink" href="#tribits-project-dependencies-xml-file-and-tools" title="Permalink to this heading"></a></h2>
<p>The TriBITS CMake configure system can write out the project’s package
dependencies into a file <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;Dependencies.xml</span></code> (or any name one wants
to give it).  This file is used by a number of the TriBITS SE-related tools.
The structure of this XML file, showing one of the more interesting mock
packages from the <a class="reference internal" href="#mocktrilinos">MockTrilinos</a> project is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">PackageDependencies</span> <span class="n">project</span><span class="o">=</span><span class="s2">&quot;Trilinos&quot;</span><span class="o">&gt;</span>
  <span class="o">...</span>
  <span class="o">&lt;</span><span class="n">Package</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Amesos&quot;</span> <span class="nb">dir</span><span class="o">=</span><span class="s2">&quot;packages/amesos&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;PT&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">LIB_REQUIRED_DEP_PACKAGES</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Teuchos,Epetra&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">LIB_OPTIONAL_DEP_PACKAGES</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;EpetraExt&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">TEST_REQUIRED_DEP_PACKAGES</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">TEST_OPTIONAL_DEP_PACKAGES</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;Triutils,Galeri&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">LIB_REQUIRED_DEP_TPLS</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">LIB_OPTIONAL_DEP_TPLS</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;SuperLUDist,ParMETIS,UMFPACK,SuperLU,MUMPS&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">TEST_REQUIRED_DEP_TPLS</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">TEST_OPTIONAL_DEP_TPLS</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">EmailAddresses</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">Regression</span> <span class="n">address</span><span class="o">=</span><span class="s2">&quot;amesos-regression@repo.site.gov&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">EmailAddresses</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">ParentPackage</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="o">/&gt;</span>
  <span class="o">&lt;/</span><span class="n">Package</span><span class="o">&gt;</span>
  <span class="o">...</span>
<span class="o">&lt;/</span><span class="n">PackageDependencies</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>This XML file contains the names, directories, <a class="reference internal" href="#test-test-category">Test Test Category</a>
(i.e. <code class="docutils literal notranslate"><span class="pre">type</span></code>), CDash email address, and all of the SE package and TPL
dependencies for every SE package in the TriBITS project (including add-on
repositories if specified).  There are several python tools under
<code class="docutils literal notranslate"><span class="pre">tribits/ci_support/</span></code> that read in this file and use the created
data-structure for various tasks.  This file and these tools are used by
<a class="reference internal" href="#checkin-test-py">checkin-test.py</a> and <a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a>.  But these tools can also be
used to construct other workflows and tools.</p>
<p id="tribitsdumpdepsxmlscript-cmake">A TriBITS project configure can create this file as a byproduct of
configuration by setting the configure option (see <a class="reference external" href="TribitsBuildReference.html#outputting-package-dependency-information">Outputting package
dependency information</a>), or the CMake -P script
<strong>TribitsDumpDepsXmlScript.cmake</strong> can be used to create this file on the fly
without having to configure a TriBITS project.  To create this file outside of
configuration, one can run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> \
  <span class="p">[</span><span class="o">-</span><span class="n">D</span> <span class="n">PROJECT_SOURCE_DIR</span><span class="o">=&lt;</span><span class="n">projectSourceDir</span><span class="o">&gt;</span><span class="p">]</span> \
  <span class="p">[</span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_PRE_REPOSITORIES</span><span class="o">=&lt;</span><span class="n">prepo0</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="n">prepo1</span><span class="o">&gt;</span><span class="p">,</span><span class="o">...</span><span class="p">]</span> \
  <span class="p">[</span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_EXTRA_REPOSITORIES</span><span class="o">=&lt;</span><span class="n">erepo0</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="n">erepo1</span><span class="o">&gt;</span><span class="p">,</span><span class="o">...</span><span class="p">]</span> \
  <span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_DEPS_XML_OUTPUT_FILE</span><span class="o">=&lt;</span><span class="n">projectDepsFileOut</span><span class="o">&gt;</span> \
  <span class="o">-</span><span class="n">P</span> <span class="o">&lt;</span><span class="n">tribitsDir</span><span class="o">&gt;/</span><span class="n">ci_support</span><span class="o">/</span><span class="n">TribitsDumpDepsXmlScript</span><span class="o">.</span><span class="n">cmake</span>
</pre></div>
</div>
<p>If TriBITS is snashotted into the project in the standard location
<code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/cmake/tribits</span></code> or the entire TriBITS repo is cloned under
<code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/TriBITS</span></code> (so that the <code class="docutils literal notranslate"><span class="pre">tribits</span></code> dir is
<code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/TriBITS/tribits</span></code>) then one can leave off
<code class="docutils literal notranslate"><span class="pre">-DPROJECT_SOURCE_DIR=&lt;projectSourceDir&gt;</span></code> and (if not wanting to include
extra repos) just run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> \
  <span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_DEPS_XML_OUTPUT_FILE</span><span class="o">=&lt;</span><span class="n">projectDepsFileOut</span><span class="o">&gt;</span> \
  <span class="o">-</span><span class="n">P</span> <span class="o">&lt;</span><span class="n">projectSourceDir</span><span class="o">&gt;/</span><span class="n">cmake</span><span class="o">/</span><span class="n">tribits</span><span class="o">/</span><span class="n">ci_support</span><span class="o">/</span><span class="n">TribitsDumpDepsXmlScript</span><span class="o">.</span><span class="n">cmake</span>
</pre></div>
</div>
<p>Once the XML file <code class="docutils literal notranslate"><span class="pre">&lt;projectDepsFileOut&gt;</span></code> is created, it can be used in
various types of analysis and used with different tools and commands.</p>
<p>The tool <a class="reference internal" href="#get-tribits-packages-from-files-list-py">get-tribits-packages-from-files-list.py</a> can be used to determine
the list of TriBITS SE packages that need to be tested given a list of changed
files (e.g. as returned from <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">diff</span> <span class="pre">--name-only</span> <span class="pre">&lt;from&gt;..&lt;to&gt;</span> <span class="pre">&gt;</span>
<span class="pre">changed-files.txt</span></code>).  This is used in the <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> tool and the
<a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a> function to determine what TriBITS packages need to
be tested based on what files have been changed.</p>
<p>The tool <a class="reference internal" href="#get-tribits-packages-from-last-tests-failed-py">get-tribits-packages-from-last-tests-failed.py</a> can be used to
extract the list of TriBITS SE packages that correspond to the failings tests
listed in the CTest-generated
<code class="docutils literal notranslate"><span class="pre">&lt;build-dir&gt;/Testing/Temporary/LastTestsFailed*.log</span></code> file.  This tool is
used in the <a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a> function in CI-testing mode to determine
what packages must be re-tested if they failed in the last CI iteration.</p>
<p>The tool <a class="reference internal" href="#filter-packages-list-py">filter-packages-list.py</a> takes in a list of TriBITS SE package
names and then filters the list according the <a class="reference internal" href="#test-test-category">Test Test Category</a> of the
packages.  This is used in testing workflows that only test a subset of
packages according to the Test Test Category at different stages in the
workflow.  For example, the <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> tool and the
<a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a> function use this filtering to only test Primary
Tested (PT) or Secondary Tested (ST) packages for a given set of changed files
in a continuous integration workflow (see <a class="reference internal" href="#nested-layers-of-tribits-project-testing">Nested Layers of TriBITS Project
Testing</a>).</p>
</section>
</section>
<section id="tribits-automated-testing">
<h1><a class="toc-backref" href="#id47"><span class="sectnum">6</span> TriBITS Automated Testing</a><a class="headerlink" href="#tribits-automated-testing" title="Permalink to this heading"></a></h1>
<p>Much of the value provided by the TriBITS system is support for testing of
complex projects.  Many different types of testing are required in a
complex project and development effort.  A large project with lots of
repositories and packages provides a number of testing and development
challenges but also provides a number of opportunities to do testing in an
efficient way; especially pre-push and post-push continuous integration (CI)
testing.  In addition, a number of post-push automated nightly test cases must
be managed.  TriBITS takes full advantage of the features of raw CMake, CTest,
and CDash in support of testing and where gaps exist, TriBITS provides tools
and customizations.</p>
<p>The following subsections describe several aspects to the TriBITS support for
testing.  The subsection <a class="reference internal" href="#test-classifications-for-repositories-packages-and-tests">Test Classifications for Repositories, Packages, and
Tests</a> defines the different types of test-related classifications that are
defined by TriBITS.  These different test classifications are then used to
define a number of different standard <a class="reference internal" href="#nested-layers-of-tribits-project-testing">Nested Layers of TriBITS Project
Testing</a> which include different types of CI testing as well as nightly and
other tests.  One of the most important types of CI testing, pre-push testing,
is then described in more detail in the subsection <a class="reference internal" href="#pre-push-testing-using-checkin-test-py">Pre-push Testing using
checkin-test.py</a>.  The subsection <a class="reference internal" href="#tribits-ctest-cdash-driver">TriBITS CTest/CDash Driver</a> describes the usage
of the advanced <a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a> function to do incremental project
testing of a projects using advanced <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-S</span></code> scripts.  The final
subsection <a class="reference internal" href="#tribits-cdash-customizations">TriBITS CDash Customizations</a> describes how projects can use a
CDash server to more effectively display test results and provide
notifications for failures that are compartmentalized for a large project.</p>
<section id="test-classifications-for-repositories-packages-and-tests">
<h2><a class="toc-backref" href="#id48"><span class="sectnum">6.1</span> Test Classifications for Repositories, Packages, and Tests</a><a class="headerlink" href="#test-classifications-for-repositories-packages-and-tests" title="Permalink to this heading"></a></h2>
<p>TriBITS defines a few different testing-related classifications for a TriBITS
project.  These different classifications are used to select subsets of the
project’s repositories, packages (and code within these packages), and tests
to be included in a given project build and test definition.  These different
classification are:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#repository-test-classification">Repository Test Classification</a></p></li>
<li><p><a class="reference internal" href="#se-package-test-group">SE Package Test Group</a></p></li>
<li><p><a class="reference internal" href="#test-test-category">Test Test Category</a></p></li>
</ul>
<p>These different test-related classifications are used to defined several
different <a class="reference internal" href="#nested-layers-of-tribits-project-testing">Nested Layers of TriBITS Project Testing</a>.  First, the <a class="reference internal" href="#repository-test-classification">Repository
Test Classification</a> determines what repositories are even processed in order
for their SE packages to even consider being enabled.  Second, if a repository
is selected, then the <a class="reference internal" href="#se-package-test-group">SE Package Test Group</a> determines what SE packages
(and optional code in those packages) are even enabled such that their
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> files are even processed (i.e. according to
<a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency Handling Behaviors</a>).  Lastly, if an SE package gets
enabled, then the <a class="reference internal" href="#test-test-category">Test Test Category</a> determines what test executables and
test cases get defined using the functions <a class="reference internal" href="#tribits-add-executable">tribits_add_executable()</a>,
<a class="reference internal" href="#tribits-add-test">tribits_add_test()</a> and <a class="reference internal" href="#tribits-add-advanced-test">tribits_add_advanced_test()</a>.</p>
<p>More detailed descriptions of <a class="reference internal" href="#repository-test-classifications">Repository Test Classifications</a>, <a class="reference internal" href="#se-package-test-groups">SE Package
Test Groups</a>, and <a class="reference internal" href="#test-test-categories">Test Test Categories</a> are given in the following
subsections.</p>
<p id="repository-test-classifications"><span id="repository-test-classification"></span><strong>Repository Test Classification</strong></p>
<p>The first type of test-related classification is for extra repositories
defined in the file <a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> (pulled
in through the <a class="reference external" href="TribitsBuildReference.html#project-extrarepos-file">${PROJECT_NAME}_EXTRAREPOS_FILE</a> cache variable) using the
<code class="docutils literal notranslate"><span class="pre">REPO_CLASSIFICATION</span></code> field in the macro call
<a class="reference internal" href="#tribits-project-define-extra-repositories">tribits_project_define_extra_repositories()</a>.  These classifications map to
the standard CTest dashboard types <code class="docutils literal notranslate"><span class="pre">Continuous</span></code>, <code class="docutils literal notranslate"><span class="pre">Nightly</span></code>, and
<code class="docutils literal notranslate"><span class="pre">Experimental</span></code> (see <a class="reference external" href="http://www.cmake.org/Wiki/CMake/Testing_With_CTest">CTest documentation</a> and <a class="reference internal" href="#tribits-ctest-cdash-driver">TriBITS CTest/CDash Driver</a>
for details).</p>
<ul class="simple" id="repository-test-continuous">
<li><p>Repositories marked <strong>Continuous</strong> match the standard CTest dashboard type
<code class="docutils literal notranslate"><span class="pre">Continuous</span></code>.  These repositories are pulled in when
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_KNOWN_EXTERNAL_REPOS_TYPE=Continuous</span></code>, or
<code class="docutils literal notranslate"><span class="pre">Nightly</span></code>.  Repositories marked as <code class="docutils literal notranslate"><span class="pre">Continuous</span></code> are cloned, updated, and
processed by default in all project automated testing described in <a class="reference internal" href="#nested-layers-of-tribits-project-testing">Nested
Layers of TriBITS Project Testing</a>.  NOTE: One should <strong>not</strong> confuse this
with the <a class="reference internal" href="#test-test-category-continuous">Test Test Category CONTINUOUS</a>.</p></li>
</ul>
<ul class="simple" id="repository-test-nightly">
<li><p>Repositories marked <strong>Nightly</strong> match the standard CTest dashboard type
<code class="docutils literal notranslate"><span class="pre">Nightly</span></code>.  These repositories are pulled in by default when
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_KNOWN_EXTERNAL_REPOS_TYPE=Nightly</span></code>.  Repositories
marked as <code class="docutils literal notranslate"><span class="pre">Nightly</span></code> are not processed by default as part of either
<a class="reference internal" href="#pre-push-ci-testing">Pre-Push CI Testing</a> or <a class="reference internal" href="#post-push-ci-testing">Post-Push CI Testing</a>.  One would mark a
repository as <code class="docutils literal notranslate"><span class="pre">Nightly</span></code> for few reasons.  First, an extra repo may be
marked as <code class="docutils literal notranslate"><span class="pre">Nightly</span></code> if it may not be available to all developers to clone
and only the nightly testing processes and machines may have access.  Also,
an extra repo may also be marked as <code class="docutils literal notranslate"><span class="pre">Nightly</span></code> if it does not contain any
packages that the project wants to pay the cost to include in even
<a class="reference internal" href="#post-push-ci-testing">Post-Push CI Testing</a>.  NOTE: One should <strong>not</strong> confuse this with the
<a class="reference internal" href="#test-test-category-nightly">Test Test Category NIGHTLY</a>.</p></li>
</ul>
<ul class="simple" id="repository-test-experimental">
<li><p>Repositories marked <strong>Experimental</strong> match the standard CTest dashboard type
<code class="docutils literal notranslate"><span class="pre">Experimental</span></code>.  Repositories marked as <code class="docutils literal notranslate"><span class="pre">Experimental</span></code> are not processed
by default as part of any automated testing described in the subsection
<a class="reference internal" href="#nested-layers-of-tribits-project-testing">Nested Layers of TriBITS Project Testing</a> (except for perhaps some
experimental builds).  The main reason that an extra repo may be marked as
<code class="docutils literal notranslate"><span class="pre">Experimental</span></code> is that it may only contain <code class="docutils literal notranslate"><span class="pre">EX</span></code> SE packages and
therefore none of these packages would be enabled by default anyway.  Also,
a repo may be marked as <code class="docutils literal notranslate"><span class="pre">Experimental</span></code> if it is developed in a very sloppy
way such that one cannot even assume that the repository’s
<a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a>, <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPlsList.cmake</a>, and
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> files are not without errors.
Since these files are always processed if the repository is included, then
any errors in these files will cause the entire configure to fail!</p></li>
</ul>
<p id="se-package-test-groups"><span id="se-package-test-group"></span><strong>SE Package Test Group</strong></p>
<p>Once a set of TriBITS repositories are selected in accordance with their
<a class="reference internal" href="#repository-test-classification">Repository Test Classification</a>, that determines the set of SE packages and
TPLs defined for the TriBITS project.  Given the set of defined SE packages
and TPLs, the set of SE packages that get enabled is determined by the <strong>SE
Package Test Group</strong> which is defined and described here.</p>
<p>Every <a class="reference internal" href="#tribits-se-package">TriBITS SE Package</a> and <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a> is assigned a test group. These
test groups are for <em>Primary Tested</em> (<a class="reference internal" href="#pt">PT</a>) code, <em>Secondary Tested</em> (<a class="reference internal" href="#st">ST</a>)
code, and <em>Experimental</em> (<a class="reference internal" href="#ex">EX</a>) code.  The test group defines <em>what</em> SE
packages and TPL get selected (or are excluded from being selected) to include
in a given build for testing-related purposes.  SE packages may also
conditionally build in additional code based on the testing group.  The
detailed rules for when an SE package or TPL are selected or excluded from the
build based on the test group is given in <a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency Handling
Behaviors</a>.  We only summarize those rules here.</p>
<p>More detailed descriptions of the test groups are given below.</p>
<ul class="simple" id="pt">
<li><p><strong>Primary Tested (PT)</strong> Code is of the highest priority to keep working for
the current development effort.  SE packages and TPLs may be selected to be
<code class="docutils literal notranslate"><span class="pre">PT</span></code> for a number of reasons.  First, if the capability provided by the
code is mature and if a regression would cause major harm to a customer, the
code should likely be marked as <code class="docutils literal notranslate"><span class="pre">PT</span></code>.  Also, if the build and correct
functioning of the code is needed by other development team members to
support their day-to-day development activities, then the code should be
marked as <code class="docutils literal notranslate"><span class="pre">PT</span></code> as well.  A TPL, on the other hand, is marked as <code class="docutils literal notranslate"><span class="pre">PT</span></code> if
it is required by a <code class="docutils literal notranslate"><span class="pre">PT</span></code> SE package.  Every project developer is expected
to have every <code class="docutils literal notranslate"><span class="pre">PT</span></code> TPL installed on every machine where they do
development on and from which they push to the global repo (see
<a class="reference internal" href="#checkin-test-py">checkin-test.py</a> tool).  <code class="docutils literal notranslate"><span class="pre">PT</span></code> SE packages and TPLs are the foundation
for <a class="reference internal" href="#pre-push-ci-testing">Pre-Push CI Testing</a>.</p></li>
</ul>
<ul class="simple" id="st">
<li><p><strong>Secondary Tested (ST)</strong> Code is still very important code for the project
and represents important capability to maintain but is excluded from the
<code class="docutils literal notranslate"><span class="pre">PT</span></code> set of code for one of a few different reasons.  First, code may be
marked as <code class="docutils literal notranslate"><span class="pre">ST</span></code> if is not critical to drive most day-to-day development
activities.  If <code class="docutils literal notranslate"><span class="pre">ST</span></code> code breaks, it usually will not cause immediate and
major harm to most developers.  Also, code may be marked as <code class="docutils literal notranslate"><span class="pre">ST</span></code> if it has
required dependencies on <code class="docutils literal notranslate"><span class="pre">ST</span></code> TPLs which are either hard to install or may
not be available on all platforms where developers do their development and
from where they push changes to the global repo.  In addition, code may be
marked as <code class="docutils literal notranslate"><span class="pre">ST</span></code> if the project is just too big and developers can’t be
expected to build and test all of this code with every push (so a decision
is made to only make some code as <code class="docutils literal notranslate"><span class="pre">PT</span></code> so that pushes don’t take too
long).  <code class="docutils literal notranslate"><span class="pre">ST</span></code> code can be included in the TriBITS auto-enable algorithms by
setting the variable <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SECONDARY_TESTED_CODE=ON</span></code> (see
<a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency Handling Behaviors</a>).  Otherwise, <code class="docutils literal notranslate"><span class="pre">ST</span></code> code <strong>is
not</strong> enabled by auto-enable algorithms.  Typically, <code class="docutils literal notranslate"><span class="pre">ST</span></code> code is excluded
from the default builds in <a class="reference internal" href="#pre-push-ci-testing">Pre-Push CI Testing</a> but <code class="docutils literal notranslate"><span class="pre">ST</span></code> code <strong>is</strong>
typically tested in <a class="reference internal" href="#post-push-ci-testing">Post-Push CI Testing</a>, <a class="reference internal" href="#nightly-testing">Nightly Testing</a> as well as
in other testing cases.</p></li>
</ul>
<ul class="simple" id="ex">
<li><p><strong>Experimental (EX)</strong> Code is usually too unstable, buggy, or non-portable
to be maintained as part of the project’s automated testing processes.  Or
the code may not be important enough to the project to bother paying the
cost to test it in the project’s automated testing processes.  The ability
to mark some code as <code class="docutils literal notranslate"><span class="pre">EX</span></code> allows the developers of that code to include
their code in the project’s VC repos along with the rest of the project’s
code and be able to take advantage of all of the development tools provided
by the project (using TriBITS) but at the same time not having to “sign up”
for all of the responsibilities of maintaining working software that every
developer has to take a part in helping to keep working.</p></li>
</ul>
<p>The test group for each type of entity is assigned in the following places:</p>
<ul class="simple">
<li><p>The top-level <a class="reference internal" href="#tribits-package">TriBITS Package</a>’s test group is assigned using the
<code class="docutils literal notranslate"><span class="pre">CLASSIFICATION</span></code> field in the macro call
<a class="reference internal" href="#tribits-repository-define-packages">tribits_repository_define_packages()</a> in its parent repository’s
<a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> file.</p></li>
<li><p>A <a class="reference internal" href="#tribits-subpackage">TriBITS Subpackage</a>’s test group is assigned using the
<code class="docutils literal notranslate"><span class="pre">CLASSIFICATIONS</span></code> field of the <a class="reference internal" href="#subpackages-dirs-classifications-optreqs">SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS</a>
argument in the macro call <a class="reference internal" href="#tribits-package-define-dependencies">tribits_package_define_dependencies()</a> in its
parent package’s <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> file.</p></li>
<li><p>A <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>’s test group is assigned using the <code class="docutils literal notranslate"><span class="pre">CLASSIFICATION</span></code> field
in the macro call <a class="reference internal" href="#tribits-repository-define-tpls">tribits_repository_define_tpls()</a> in its parent
repository’s <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file.</p></li>
</ul>
<p>After these files are processed, the variable <a class="reference internal" href="#package-name-testgroup">${PACKAGE_NAME}_TESTGROUP</a>
gives the test group for each defined SE Package while the variable
<code class="docutils literal notranslate"><span class="pre">${TPL_NAME}_TESTGROUP</span></code> gives the test group for each defined TPL.</p>
<p>Note that the test group classification <code class="docutils literal notranslate"><span class="pre">PT</span></code>/<code class="docutils literal notranslate"><span class="pre">ST</span></code>/<code class="docutils literal notranslate"><span class="pre">EX</span></code> is <em>not</em> to be
confused with the <em>maturity level</em> of the SE package as discussed in the
<a class="reference external" href="../lifecycle_model/TribitsLifecycleModel.pdf">TriBITS Lifecycle Model</a>.  The test group classification in no way implies
the maturity of the given TriBITS SE Package or piece of code.  Instead, the
test group is just used to sub-select packages (and pieces of code within
those packages) that are the most important to sustain for the various current
development group’s activities.  While more-mature code would typically never
be classified as <code class="docutils literal notranslate"><span class="pre">EX</span></code> (Experimental), there are cases were immature packages
may be classified as <code class="docutils literal notranslate"><span class="pre">ST</span></code> or even <code class="docutils literal notranslate"><span class="pre">PT</span></code>.  For example, a very important
research project may be driving the development of a very new algorithm with
the low <em>maturity level</em> of <em>Research Stable</em> (<code class="docutils literal notranslate"><span class="pre">RS</span></code>) or even <em>Exploratory</em>
(<code class="docutils literal notranslate"><span class="pre">EP</span></code>) because keeping that code working may be critical to keeping the
research project on track.</p>
<p>In addition to just selecting <code class="docutils literal notranslate"><span class="pre">PT</span></code> and <code class="docutils literal notranslate"><span class="pre">ST</span></code> SE packages as a whole, a
TriBITS <code class="docutils literal notranslate"><span class="pre">PT</span></code> SE package can also contain conditional code and test
directories that get enabled when <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SECONDARY_TESTED_CODE=ON</span></code>
and therefore represents more <code class="docutils literal notranslate"><span class="pre">ST</span></code> code.  The package’s
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> files can contain simple if statements and can
use the <a class="reference internal" href="#tribits-set-st-for-dev-mode">tribits_set_st_for_dev_mode()</a> function to automatically select
extra code to enable when <code class="docutils literal notranslate"><span class="pre">ST</span></code> is enabled or when the project is in release
mode.</p>
<p id="test-test-categories"><span id="test-test-category"></span><strong>Test Test Category</strong></p>
<p>Once a package is even defined (due to its parent repository’s selection
consistent with its <a class="reference internal" href="#repository-test-classification">Repository Test Classification</a>) and is the package is
enabled (consistent with its <a class="reference internal" href="#se-package-test-group">SE Package Test Group</a>) then the set of
individual test executables and test cases that are included or not in that
package depends on the <code class="docutils literal notranslate"><span class="pre">CATEGORIES</span></code> argument in the functions
<a class="reference internal" href="#tribits-add-executable">tribits_add_executable()</a>, <a class="reference internal" href="#tribits-add-test">tribits_add_test()</a> and
<a class="reference internal" href="#tribits-add-advanced-test">tribits_add_advanced_test()</a>, and the <a class="reference internal" href="#project-name-test-categories">${PROJECT_NAME}_TEST_CATEGORIES</a>
variable.  This <strong>Test Test Category</strong> defines the last “knob” that the
development team has in controlling what tests get run in a particular test
scenario as described in the section <a class="reference internal" href="#nested-layers-of-tribits-project-testing">Nested Layers of TriBITS Project
Testing</a>.</p>
<p>The currently allowed values for the <em>Test Test Category</em> are <code class="docutils literal notranslate"><span class="pre">BASIC</span></code>,
<code class="docutils literal notranslate"><span class="pre">CONTINUOUS</span></code>, <code class="docutils literal notranslate"><span class="pre">NIGHTLY</span></code>, <code class="docutils literal notranslate"><span class="pre">HEAVY</span></code>, and <code class="docutils literal notranslate"><span class="pre">PERFORMANCE</span></code>.  Tests are
enabled based on their assigned test test category matching the categories set
in the CMake cache variable <a class="reference internal" href="#project-name-test-categories">${PROJECT_NAME}_TEST_CATEGORIES</a>.  The test test
categories <code class="docutils literal notranslate"><span class="pre">BASIC</span></code>, <code class="docutils literal notranslate"><span class="pre">CONTINUOUS</span></code>, <code class="docutils literal notranslate"><span class="pre">NIGHTLY</span></code>, and <code class="docutils literal notranslate"><span class="pre">HEAVY</span></code> are subsets
of each other.  That is, a <code class="docutils literal notranslate"><span class="pre">BASIC</span></code> test is automatically included in the set
of <code class="docutils literal notranslate"><span class="pre">CONTINUOUS</span></code>, <code class="docutils literal notranslate"><span class="pre">NIGHTLY</span></code>, and <code class="docutils literal notranslate"><span class="pre">HEAVY</span></code> tests (as set using
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TEST_CATEGORIES</span></code>).</p>
<p>The different test test categories are described below in more detail:</p>
<ul class="simple" id="test-test-category-basic">
<li><p>Tests marked <strong>BASIC</strong> represent key functionality that is needed by nearly
every developer that works on the project and so must be protected at all
times and are therefore included in <a class="reference internal" href="#pre-push-ci-testing">Pre-Push CI Testing</a>.  Tests marked as
<code class="docutils literal notranslate"><span class="pre">BASIC</span></code> are enabled for the values of <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TEST_CATEGORIES</span></code>
of <code class="docutils literal notranslate"><span class="pre">BASIC</span></code>, <code class="docutils literal notranslate"><span class="pre">CONTINUOUS</span></code>, <code class="docutils literal notranslate"><span class="pre">NIGHT</span></code>, and <code class="docutils literal notranslate"><span class="pre">HEAVY</span></code>.  The category
<code class="docutils literal notranslate"><span class="pre">BASIC</span></code> is the default test test category given to all test executables
and tests that don’t specify the <code class="docutils literal notranslate"><span class="pre">CATEGORIES</span></code> argument.</p></li>
</ul>
<ul class="simple" id="test-test-category-continuous">
<li><p>Tests marked <strong>CONTINUOUS</strong> also represent importantly functionality but are
typically not run in <a class="reference internal" href="#pre-push-ci-testing">Pre-Push CI Testing</a> testing but instead are run in
<a class="reference internal" href="#post-push-ci-testing">Post-Push CI Testing</a>, <a class="reference internal" href="#nightly-testing">Nightly Testing</a>, and other types of testing.
Tests marked as <code class="docutils literal notranslate"><span class="pre">CONTINUOUS</span></code> are enabled for the values of
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TEST_CATEGORIES</span></code> equal to <code class="docutils literal notranslate"><span class="pre">CONTINUOUS</span></code>, <code class="docutils literal notranslate"><span class="pre">NIGHT</span></code>, and
<code class="docutils literal notranslate"><span class="pre">HEAVY</span></code>.  A test may be marked <code class="docutils literal notranslate"><span class="pre">CONTINUOUS</span></code> and not <code class="docutils literal notranslate"><span class="pre">BASIC</span></code> for a few
different reasons.  For example, the code needed to run the test may take
too long to build or the test itself may take too long to run in order to
afford including it in <a class="reference internal" href="#pre-push-ci-testing">Pre-Push CI Testing</a>.</p></li>
</ul>
<ul class="simple" id="test-test-category-nightly">
<li><p>Tests marked <strong>NIGHTLY</strong> usually take even longer to build and/or run than
<code class="docutils literal notranslate"><span class="pre">CONTINUOUS</span></code> tests and therefore are too expensive to include in
<a class="reference internal" href="#post-push-ci-testing">Post-Push CI Testing</a>.  Tests may also be marked as <code class="docutils literal notranslate"><span class="pre">NIGHTLY</span></code> even if
they might run relatively fast if there is a desire to not cause the CI
server to fail if these tests fail.  In this case, the decision is to take
the testing and maintenance of these tests and the capabilities they
represent “offline” so that they don’t influence the daily development cycle
for the project but instead are addressed in a “secondary feedback loop”.
Tests marked as <code class="docutils literal notranslate"><span class="pre">NIGHTLY</span></code> are enabled for the values of
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TEST_CATEGORIES</span></code> equal to <code class="docutils literal notranslate"><span class="pre">NIGHT</span></code>, and <code class="docutils literal notranslate"><span class="pre">HEAVY</span></code>.</p></li>
</ul>
<ul class="simple" id="test-test-category-heavy">
<li><p>Tests marked <strong>HEAVY</strong> are usually reserved for very expensive tests that
are too expensive to run nightly.  <code class="docutils literal notranslate"><span class="pre">HEAVY</span></code> tests require more testing
resources and therefore may only be run on a fully optimized build and/or
run less frequently.  Tests marked as <code class="docutils literal notranslate"><span class="pre">HEAVY</span></code> are enabled only for the
value of <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TEST_CATEGORIES</span></code> equal to <code class="docutils literal notranslate"><span class="pre">HEAVY</span></code>.</p></li>
</ul>
<ul class="simple" id="test-test-category-performance">
<li><p>Tests marked <strong>PERFORMANCE</strong> are a special category of tests that are
specially designed to measure the serial (non-parallel) run-time performance
of parts of the software (see <a class="reference internal" href="#performance-testing">Performance Testing</a>).  Tests marked as
<code class="docutils literal notranslate"><span class="pre">PERFORMANCE</span></code> are enabled only for the value of
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TEST_CATEGORIES</span></code> equal to <code class="docutils literal notranslate"><span class="pre">PERFORMANCE</span></code>.</p></li>
</ul>
<p>Every TriBITS project has a default setting for
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TEST_CATEGORIES</span></code> that is set for a basic <code class="docutils literal notranslate"><span class="pre">cmake</span></code>
configure of the project (see <a class="reference internal" href="#project-name-test-categories-default">${PROJECT_NAME}_TEST_CATEGORIES_DEFAULT</a> for
more details).  In addition, the different testing processes described in the
section <a class="reference internal" href="#nested-layers-of-tribits-project-testing">Nested Layers of TriBITS Project Testing</a> set this to different
values.</p>
</section>
<section id="nested-layers-of-tribits-project-testing">
<h2><a class="toc-backref" href="#id49"><span class="sectnum">6.2</span> Nested Layers of TriBITS Project Testing</a><a class="headerlink" href="#nested-layers-of-tribits-project-testing" title="Permalink to this heading"></a></h2>
<p>Now that the different types of <a class="reference internal" href="#test-classifications-for-repositories-packages-and-tests">Test Classifications for Repositories,
Packages, and Tests</a> have been defined, this section describes how these
different test-related classifications are used to select repositories,
packages (and code) and tests to run in the standard project testing
processes.  More than any other section in this document, this section will
describe and assume a certain class of software development processes (namely
agile processes) where testing and <em>continuous integration</em> (CI) are critical
components.  However, detailed descriptions of these processes are deferred to
the later sections <a class="reference internal" href="#pre-push-testing-using-checkin-test-py">Pre-push Testing using checkin-test.py</a> and <a class="reference internal" href="#tribits-ctest-cdash-driver">TriBITS
CTest/CDash Driver</a>.</p>
<p>The standard TriBITS-supported project testing processes are:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#pre-push-ci-testing">Pre-Push CI Testing</a></p></li>
<li><p><a class="reference internal" href="#post-push-ci-testing">Post-Push CI Testing</a></p></li>
<li><p><a class="reference internal" href="#nightly-testing">Nightly Testing</a></p></li>
<li><p><a class="reference internal" href="#heavy-testing">Heavy Testing</a></p></li>
<li><p><a class="reference internal" href="#performance-testing">Performance Testing</a></p></li>
</ul>
<p>These standard testing processes are outlined in more detail below and show
how the different test-related categories are used to define each of these.</p>
<p id="pre-push-ci-testing"><strong>Pre-Push CI Testing</strong></p>
<p>The first level of testing is <em>Pre-Push CI Testing</em> that is performed before
changes to the project are pushed to the master branch(es) in the global
repository(s).  With TriBITS, this type of testing and the following push is
typically done using the <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> tool.  This category of testing is
described in much more detail in <a class="reference internal" href="#pre-push-testing-using-checkin-test-py">Pre-push Testing using checkin-test.py</a>.
All of the “default builds” used with the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool select
repositories, SE packages and code, and individual tests using the following
test-related classifications:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 23%" />
<col style="width: 46%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Classification Type</p></th>
<th class="head"><p>Classification</p></th>
<th class="head"><p>(See Reference)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Repository Test Classif.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Continuous</span></code></p></td>
<td><p>(<a class="reference internal" href="#repository-test-continuous">Repository Test Continuous</a>)</p></td>
</tr>
<tr class="row-odd"><td><p>SE Package Test Group</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">PT</span></code></p></td>
<td><p>(<a class="reference internal" href="#pt">PT</a>)</p></td>
</tr>
<tr class="row-even"><td><p>Test Test Category</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">BASIC</span></code></p></td>
<td><p>(<a class="reference internal" href="#test-test-category-basic">Test Test Category BASIC</a>)</p></td>
</tr>
</tbody>
</table>
<p>Typically a TriBITS project will define a “standard development environment”
which is comprised of a standard compiler (e.g. GCC 8.3.0), TPL versions
(e.g. OpenMPI 4.0.5, Boost 4.9, etc.), and other tools (e.g. cmake 3.17.0, git
2.10.1, etc.).  This standard development environment is expected to be used
to test changes to the project’s code before any push.  By using a standard
development environment, if the code builds and all the tests pass for the
“default” pre-push builds for one developer, then that maximizes the
probability that the code will also build and all tests will pass for every
other developer using the same development environment.  This is critical to
keep the development team maximally productive.  Portability is also important
for most projects but portability testing is best done in a secondary feedback
look using <a class="reference internal" href="#nightly-testing">Nightly Testing</a> builds.  TriBITS has some support for helping to
set up a standard software development environment as described in section
<a class="reference internal" href="#tribits-development-toolset">TriBITS Development Toolset</a>.</p>
<p>The basic assumption of all CI processes (including the one described here) is
that if anyone pulls the project’s development sources at any time, then all
of the code will build and all of the tests will pass for the “default” build
cases.  For a TriBITS project, this means that the project’s
<code class="docutils literal notranslate"><span class="pre">--default-builds</span></code> (see above) will all pass for every <code class="docutils literal notranslate"><span class="pre">PT</span></code> package.  All
of these software development processes make this basic assumption and agile
software development methods fall apart if this is not true.</p>
<p id="post-push-ci-testing"><strong>Post-Push CI Testing</strong></p>
<p>After changes are pushed to the master branch(es) in the global repository(s),
<em>Post-Push CI Testing</em> is performed where a CI server detects the changes and
immediately fires off a CI build using CTest to test the changes and the
results are posted to a CDash server (in the “Continuous” section on the
project’s dashboard page).  This process is driven by CTest driver code that
calls <a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a> as described in the section <a class="reference internal" href="#tribits-ctest-cdash-driver">TriBITS
CTest/CDash Driver</a>.  Various types of specific CI builds can be constructed
and run (see <a class="reference internal" href="#ctest-cdash-ci-server">CTest/CDash CI Server</a>) but these post-push CI builds typically
select repositories, SE packages and code, and individual tests using the
following test-related classifications:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 23%" />
<col style="width: 46%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Classification Type</p></th>
<th class="head"><p>Classification</p></th>
<th class="head"><p>(See Reference)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Repository Test Classif.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Continuous</span></code></p></td>
<td><p>(<a class="reference internal" href="#repository-test-continuous">Repository Test Continuous</a>)</p></td>
</tr>
<tr class="row-odd"><td><p>SE Package Test Group</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">PT</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">ST</span></code></p></td>
<td><p>(<a class="reference internal" href="#pt">PT</a> and <a class="reference internal" href="#st">ST</a>)</p></td>
</tr>
<tr class="row-even"><td><p>Test Test Category</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">CONTINUOUS</span></code></p></td>
<td><p>(<a class="reference internal" href="#test-test-category-continuous">Test Test Category CONTINUOUS</a>)</p></td>
</tr>
</tbody>
</table>
<p>Post-push CI testing would assume to use the same standard development
environment as used for <a class="reference internal" href="#pre-push-ci-testing">Pre-Push CI Testing</a>.  Also, the project may also
choose to run additional automated post-push CI builds that exactly match the
pre-push CI default builds to help check on the health of these builds
continuously and not just rely on the development team to always perform the
pre-push CI builds correctly before pushing.</p>
<p id="nightly-testing"><strong>Nightly Testing</strong></p>
<p>In addition to pre-push and post-push CI testing, a typical TriBITS project
will set up multiple <em>Nightly Testing</em> builds (or once-a-day builds, they
don’t need to only run at night).  These builds are also driven by CTest
driver scripts described in the section <a class="reference internal" href="#tribits-ctest-cdash-driver">TriBITS CTest/CDash Driver</a> and post
results to the project’s CDash server (in the “Nightly” section on the
project’s dashboard page).  Nightly builds don’t run in a continuous loop but
instead are run once a day (e.g. driven by a cron job) and there tends to be
many different nightly build cases that test the project using different
compilers (e.g.  GCC, Intel, Microsoft, etc., and different versions of each),
different TPL versions (e.g. different OpenMPI versions, different MPICH
versions, etc.), different platforms (e.g. Linux, Windows, etc.), and varying
many other options and settings on these different platforms.  What all
nightly builds have in common is that they tend to select repositories, SE
packages and code, and individual tests using the following test-related
classifications:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 23%" />
<col style="width: 46%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Classification Type</p></th>
<th class="head"><p>Classification</p></th>
<th class="head"><p>(See Reference)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Repository Test Classif.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Nightly</span></code></p></td>
<td><p>(<a class="reference internal" href="#repository-test-nightly">Repository Test Nightly</a>)</p></td>
</tr>
<tr class="row-odd"><td><p>SE Package Test Group</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">PT</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">ST</span></code></p></td>
<td><p>(<a class="reference internal" href="#pt">PT</a> and <a class="reference internal" href="#st">ST</a>)</p></td>
</tr>
<tr class="row-even"><td><p>Test Test Category</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">NIGHTLY</span></code></p></td>
<td><p>(<a class="reference internal" href="#test-test-category-nightly">Test Test Category NIGHTLY</a>)</p></td>
</tr>
</tbody>
</table>
<p>The nightly builds comprise the basic “heart beat” for the project.</p>
<p id="heavy-testing"><strong>Heavy Testing</strong></p>
<p><em>Heavy Testing</em> builds are just an extension to the <a class="reference internal" href="#nightly-testing">Nightly Testing</a> builds
that add on more expensive tests marked using the <a class="reference internal" href="#test-test-category-heavy">Test Test Category HEAVY</a>.
For projects that define heavy tests and heavy builds, individual test cases
may be allowed to take 24 hours or longer to run so they can’t even be run
every day in nightly testing.  What standard heavy builds have in common is
that they tend to select repositories, SE packages and code, and individual
tests using the following test-related classifications:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 23%" />
<col style="width: 46%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Classification Type</p></th>
<th class="head"><p>Classification</p></th>
<th class="head"><p>(See Reference)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Repository Test Classif.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Nightly</span></code></p></td>
<td><p>(<a class="reference internal" href="#repository-test-nightly">Repository Test Nightly</a>)</p></td>
</tr>
<tr class="row-odd"><td><p>SE Package Test Group</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">PT</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">ST</span></code></p></td>
<td><p>(<a class="reference internal" href="#pt">PT</a> and <a class="reference internal" href="#st">ST</a>)</p></td>
</tr>
<tr class="row-even"><td><p>Test Test Category</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">HEAVY</span></code></p></td>
<td><p>(<a class="reference internal" href="#test-test-category-heavy">Test Test Category HEAVY</a>)</p></td>
</tr>
</tbody>
</table>
<p>Project developer teams should strive to limit the number of test cases that
are marked as <code class="docutils literal notranslate"><span class="pre">HEAVY</span></code> since these tests will typically <em>not</em> get run in very
may builds or may not be run every day and developers will tend to never
enable them when doing more extensive testing using <code class="docutils literal notranslate"><span class="pre">--st-extra-builds</span></code> with
the <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> tool in extended pre-push testing.</p>
<p id="performance-testing"><strong>Performance Testing</strong></p>
<p><em>Performance Testing</em> builds are a special class of builds that have tests
that are specifically designed to test the run-time performance of a particular
piece of code or algorithm.  These tests tend to be sensitive to loads on the
machine and therefore typically need to be run on an unloaded machine for
reliable results.  Details on how to write good performance tests with hard
pass/fail time limits is beyond the scope of this document.  All TriBITS does
is to define the special <a class="reference internal" href="#test-test-category-performance">Test Test Category PERFORMANCE</a> to allow TriBITS
packages to declare these tests in a consistent way so that they can be run
along with performance tests defined in other TriBITS packages.  From a
TriBITS standpoint, all performance testing builds would tend to select
repositories, SE packages and code, and individual tests using the following
test-related classifications:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 23%" />
<col style="width: 46%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Classification Type</p></th>
<th class="head"><p>Classification</p></th>
<th class="head"><p>(See Reference)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Repository Test Classif.</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">Nightly</span></code></p></td>
<td><p>(<a class="reference internal" href="#repository-test-nightly">Repository Test Nightly</a>)</p></td>
</tr>
<tr class="row-odd"><td><p>SE Package Test Group</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">PT</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">ST</span></code></p></td>
<td><p>(<a class="reference internal" href="#pt">PT</a> and <a class="reference internal" href="#st">ST</a>)</p></td>
</tr>
<tr class="row-even"><td><p>Test Test Category</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">PERFORMANCE</span></code></p></td>
<td><p>(<a class="reference internal" href="#test-test-category-performance">Test Test Category PERFORMANCE</a>)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="pre-push-testing-using-checkin-test-py">
<span id="checkin-test-py"></span><h2><a class="toc-backref" href="#id50"><span class="sectnum">6.3</span> Pre-push Testing using checkin-test.py</a><a class="headerlink" href="#pre-push-testing-using-checkin-test-py" title="Permalink to this heading"></a></h2>
<p>CMake provides the integrated tool CTest (executable <code class="docutils literal notranslate"><span class="pre">ctest</span></code>) which is used
to define and run different tests.  However, a lot more needs to be done to
effectively test changes for a large project before pushing to the master
branch(es) in the main repository(s).  Things get especially complicated and
tricky when multiple version-control (VC) repositories are involved.  The
TriBITS system provides the tool <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> for automating the
process of:</p>
<ol class="arabic simple">
<li><p>Determining if the local VC repo(s) are ready to integrate with the remote
master branch(es),</p></li>
<li><p>Pulling and integrating the most current changes from the remote VC repo(s),</p></li>
<li><p>Figuring out what TriBITS packages need to be enabled and testing (by
examining VC file diffs),</p></li>
<li><p>Configuring only the necessary TriBITS packages and tests (and their
downstream dependencies by default) and building, running tests, and
reporting results (via email), and</p></li>
<li><p>Only if all specified builds and tests pass, amending the last commit
message with the test results, then pushing local commits to the remove VC
repo(s) and sending out summary emails.</p></li>
</ol>
<p>There are several advantages to using a project’s <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool for
pushing changes to the main development branch which include:</p>
<ol class="loweralpha simple">
<li><p>provides a consistent definition for “okay to push” for all developers</p></li>
<li><p>protects other developers from pulling badly broken code</p></li>
<li><p>reduces the number of packages that need to be tested by automatically
determining the set based on changed files and package dependencies</p></li>
<li><p>avoids developer mistakes in performing repetitive tasks and forgetting
important steps in the process</p></li>
<li><p>marks a set of working commits that are safe to search with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code>
to find problems (see <a class="reference internal" href="#using-git-bisect-with-checkin-test-py-workflows">Using Git Bisect with checkin-test.py workflows</a>)</p></li>
</ol>
<p>When using the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool, every TriBITS project defines one or
more “default builds” (specified through the <code class="docutils literal notranslate"><span class="pre">--default-builds</span></code> argument)
for pre-push CI testing that form the criteria for if it is okay to push code
changes or not.  The “default builds” select repositories, SE packages and
code, and individual tests as described in <a class="reference internal" href="#pre-push-ci-testing">Pre-Push CI Testing</a>.  A TriBITS
project defines its default pre-push builds using the file
<a class="reference internal" href="#projectdir-project-checkin-test-config-py">&lt;projectDir&gt;/project-checkin-test-config.py</a>.  For an example, the file
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<code class="docutils literal notranslate"><span class="pre">project-checkin-test-config.py</span></code> is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># Define project-specific options for the checkin-test script for</span>
<span class="c1"># TribitsExampleProject.</span>
<span class="c1">#</span>

<span class="n">configuration</span> <span class="o">=</span> <span class="p">{</span>

    <span class="c1"># Default command line arguments</span>
    <span class="s1">&#39;defaults&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;--send-email-to-on-push&#39;</span><span class="p">:</span> <span class="s1">&#39;trilinos-checkin-tests@software.sandia.gov&#39;</span><span class="p">,</span>
        <span class="p">},</span>

    <span class="c1"># CMake options (-DVAR:TYPE=VAL) cache variables.</span>
    <span class="s1">&#39;cmake&#39;</span><span class="p">:</span> <span class="p">{</span>
        
        <span class="c1"># Options that are common to all builds.</span>
        <span class="s1">&#39;common&#39;</span><span class="p">:</span> <span class="p">[],</span>

        <span class="c1"># Defines --default-builds, in order.</span>
        <span class="s1">&#39;default-builds&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="c1"># Options for the MPI_DEBUG build.</span>
            <span class="p">(</span><span class="s1">&#39;MPI_DEBUG&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;-DTPL_ENABLE_MPI:BOOL=ON&#39;</span><span class="p">,</span>
                <span class="s1">&#39;-DCMAKE_BUILD_TYPE:STRING=RELEASE&#39;</span><span class="p">,</span>
                <span class="s1">&#39;-DTribitsExProj_ENABLE_DEBUG:BOOL=ON&#39;</span><span class="p">,</span>
                <span class="s1">&#39;-DTribitsExProj_ENABLE_CHECKED_STL:BOOL=ON&#39;</span><span class="p">,</span>
                <span class="s1">&#39;-DTribitsExProj_ENABLE_DEBUG_SYMBOLS:BOOL=ON&#39;</span><span class="p">,</span>
                <span class="p">]),</span>
            <span class="c1"># Options for the SERIAL_RELEASE build.</span>
            <span class="p">(</span><span class="s1">&#39;SERIAL_RELEASE&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;-DTPL_ENABLE_MPI:BOOL=OFF&#39;</span><span class="p">,</span>
                <span class="s1">&#39;-DCMAKE_BUILD_TYPE:STRING=RELEASE&#39;</span><span class="p">,</span>
                <span class="s1">&#39;-DTribitsExProj_ENABLE_DEBUG:BOOL=OFF&#39;</span><span class="p">,</span>
                <span class="s1">&#39;-DTribitsExProj_ENABLE_CHECKED_STL:BOOL=OFF&#39;</span><span class="p">,</span>
                <span class="p">]),</span>
            <span class="p">],</span> <span class="c1"># default-builds</span>

        <span class="p">},</span> <span class="c1"># cmake</span>

    <span class="p">}</span> <span class="c1"># configuration</span>
</pre></div>
</div>
<p>This gives <code class="docutils literal notranslate"><span class="pre">--default-builds=MPI_DEBUG,SERIAL_RELEASE</span></code>.  As shown, typically
two default builds are defined so that various options can be toggled between
the two builds.  Typical options to toggle include enabling/disabling MPI and
enabling/disabling run-time debug mode checking (i.e. toggle
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_DEBUG</span></code>).  Typically, other important options will
also be toggled between these two builds.</p>
<p>Note that both of the default builds shown above, including the <code class="docutils literal notranslate"><span class="pre">MPI_DEBUG</span></code>
build, actually set optimized compiler flags with
<code class="docutils literal notranslate"><span class="pre">-DCMAKE_BUILD_TYPE:STRING=RELEASE</span></code>.  What makes the <code class="docutils literal notranslate"><span class="pre">MPI_DEBUG</span></code> build a
“debug” build is turning on optional run-time debug-mode checking, not
disabling optimized code.  This is important so that the defined tests run
fast.  For most projects, the default pre-push builds should <strong>not</strong> be used
to debug-enabled code which is suitable to run through a debugger
(e.g. <code class="docutils literal notranslate"><span class="pre">gdb</span></code>).  Instead, these “debug” builds are designed to test changes to
the project’s code efficiently before pushing changes.  Typically, a
development team should not have to test the chosen compiler’s ability to
generate non-optimized debug code and suffer slower test times before pushing.</p>
<p>Note that turning on <code class="docutils literal notranslate"><span class="pre">-DTribitsExProj_ENABLE_CHECKED_STL=ON</span></code> as shown above
can only be used when the TPLs have no C++ code using the C++ STL or if that
particular build points to C++ TPLs also compiled with checked STL enabled.
The <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a> default builds do not depend on any C++ TPLs that
might use the C++ STL so enabling this option adds additional positive
debug-mode checking for C++ code.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool is a fairly sophisticated piece of software that
is well tested and very robust.  The level of testing of this tool is likely
greater than any of the software that it will be used to test (unless the
project is a real-time flight control system or nuclear reactor control system
or something).  This is needed so as to provide confidence in the developers
that the tool will only push their changes if everything checks out as it
should.  There are a lot of details and boundary cases that one has to
consider and a number of use cases that need to be supported by such a tool.
For more detailed documentation, see <a class="reference internal" href="#checkin-test-py-help">checkin-test.py –help</a>.</p>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool can also be used to implement
“poor-man’s” post-push testing processes as described in <a class="reference internal" href="#post-push-ci-and-nightly-testing-using-checkin-test-py">Post-Push CI and
Nightly Testing using checkin-test.py</a>.  However, most software projects will
want to go with the more elaborate and more feature-full CTest/CDash system
described in <a class="reference internal" href="#tribits-ctest-cdash-driver">TriBITS CTest/CDash Driver</a>.</p>
</section>
<section id="tribits-ctest-cdash-driver">
<h2><a class="toc-backref" href="#id51"><span class="sectnum">6.4</span> TriBITS CTest/CDash Driver</a><a class="headerlink" href="#tribits-ctest-cdash-driver" title="Permalink to this heading"></a></h2>
<p>The TriBITS system uses a sophisticated and highly customized CTest -S driver
script to test TriBITS projects and submit results to a CDash server.  The
primary code for driving this is contained in the CTest function
<a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a> contained in the file
<code class="docutils literal notranslate"><span class="pre">TribitsCTestDriverCore.cmake</span></code>.  This script loops through all of the
specified TriBITS packages for a given TriBITS project and does a configure,
built, and test and then submits results to the specified CDash server
incrementally.  If the configure or library build of any upstream TriBITS
package fails, then that TriBITS package is disabled in all downstream TriBITS
package builds so as not to propagate already known failures.  Each TriBITS
top-level package is assigned its own CDash regression email address (see
<a class="reference internal" href="#cdash-regression-email-addresses">CDash regression email addresses</a>) and each package configure/build/test is
given its own row for the package build in the CDash server.  A CTest script
using <a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a> is run in one of three different modes.
First, it can run standard once-a-day, from-scratch builds as described in
<a class="reference internal" href="#ctest-cdash-nightly-testing">CTest/CDash Nightly Testing</a>.  Second, it can run as a CI server as
described in <a class="reference internal" href="#ctest-cdash-ci-server">CTest/CDash CI Server</a>.  Third, it can run in experimental mode
testing a local repository using the TriBITS-defined <a class="reference external" href="TribitsBuildReference.html#dashboard-submissions">make dashboard</a> target.</p>
<section id="ctest-cdash-nightly-testing">
<h3><a class="toc-backref" href="#id52">CTest/CDash Nightly Testing</a><a class="headerlink" href="#ctest-cdash-nightly-testing" title="Permalink to this heading"></a></h3>
<p>When a TriBITS CTest script using <a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a> is run in
“Nightly” testing mode, it builds the project from scratch package-by-package
and submits results to the TriBITS project’s CDash project on the designated
CDash server.</p>
</section>
<section id="ctest-cdash-ci-server">
<h3><a class="toc-backref" href="#id53">CTest/CDash CI Server</a><a class="headerlink" href="#ctest-cdash-ci-server" title="Permalink to this heading"></a></h3>
<p>When a TriBITS ctest driver script is used in continuous integration (CI)
mode, it starts every day with a clean from-scratch build and then performs
incremental rebuilds as new commits are pulled from the master branch in the
main repository(s).  In this mode, a continuous loop is performed after the
initial baseline build constantly pulling commits from the master git
repository(s).  If any package changes are detected (looking at git file
diffs), then the tests and examples for those packages and all downstream
packages are enabled and run using a reconfigure/rebuild.  Since all of the
upstream package libraries are already built, this rebuild and retest can take
place in a fraction of the time of a complete from-scratch build and test of
the project.</p>
</section>
</section>
<section id="tribits-cdash-customizations">
<h2><a class="toc-backref" href="#id54"><span class="sectnum">6.5</span> TriBITS CDash Customizations</a><a class="headerlink" href="#tribits-cdash-customizations" title="Permalink to this heading"></a></h2>
<p>CDash is not currently designed to accommodate multi-package, multi-repository
VC projects in the way they are supported by TriBITS.  However, CDash provides
some ability to customize a CDash project and submits to address missing
features.  Each TriBITS package is given a CTest/CDash “Label” with the name
of the TriBITS package.  CDash will then aggregate the different package
configure/build/test runs for each package into aggregated “builds”.  The
commits pulled for each of the extra VC repos listed in the
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file are shown in an
uploaded CDash “Notes” file for each TriBITS package configure/build/test
submit.  This uploaded “Notes” file also contains a cleaned up version of the
CMakeCache.txt file as well as a copy of the <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-s</span></code> script that ran the
case.</p>
<p>CDash offers numerous features such as the ability to construct a number of
different types of queries and is extremely helpful in using past test data.</p>
<section id="cdash-regression-email-addresses">
<h3><a class="toc-backref" href="#id55">CDash regression email addresses</a><a class="headerlink" href="#cdash-regression-email-addresses" title="Permalink to this heading"></a></h3>
<p>Every TriBITS Package has a regression email address associated with it that
gets uploaded to a CDash project on a CDash server that is used to determine
what email address to use when a package has configure, build, or test
failures.  Because of the complex organizational nature of different projects
and different integration models, a single static email address for a given
package in every project build is not practical.</p>
<p>The TriBITS system allows for a package’s regression email address to be
specified in the following order of precedence:</p>
<p id="repository-name-repository-override-package-email-list">1) <strong>${REPOSITORY_NAME}_REPOSITORY_OVERRIDE_PACKAGE_EMAIL_LIST</strong> (typically
defined in <a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a>): Defines a
single email address for all packages for the repository
<code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}</span></code> and overrides all other package email regression
specification variables.  This is typically used by a meta-project to redefine
the regression email addresses for all of the packages in an externally
developed repository.</p>
<p>2) <strong>REGRESSION_EMAIL_LIST</strong> (defined in
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a>): Package-specific email address
specified in the package’s <code class="docutils literal notranslate"><span class="pre">Dependencies.cmake</span></code> file using
<a class="reference internal" href="#tribits-package-define-dependencies">tribits_package_define_dependencies()</a>.</p>
<p id="repository-name-repository-email-url-address-base">3) <strong>${REPOSITORY_NAME}_REPOSITORY_EMAIL_URL_ADDRESS_BASE</strong> (set in
<a class="reference internal" href="#repodir-cmake-repositorydependenciessetup-cmake">&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</a>): A base email address
specified at the Repository level creating package-specific email addresses
(e.g. <code class="docutils literal notranslate"><span class="pre">&lt;lower-case-package-name&gt;-regression&#64;some.repo.gov</span></code>, where
<code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}_REPOSITORY_EMAIL_URL_ADDRESS_BASE=some.repo.gov</span></code>).
This variable is used, for example, by the Trilinos project to provide
automatic regression email addresses for packages.</p>
<p id="repository-name-repository-master-email-address">4) <strong>${REPOSITORY_NAME}_REPOSITORY_MASTER_EMAIL_ADDRESS</strong> (set in
<a class="reference internal" href="#repodir-cmake-repositorydependenciessetup-cmake">&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</a>): A single email address
for all packages specified at the Repository level
(e.g. <code class="docutils literal notranslate"><span class="pre">my-repo-regression&#64;some.repo.gov</span></code>).  This variable is used for
smaller repositories with smaller development groups who just want all
regression emails for the repository’s packages going to a single email
address.  This reduces the overhead of managing a bunch of individual package
email addresses but at the expense of spamming too many people with CDash
failure emails.</p>
<p id="project-name-project-email-url-address-base">5) <strong>${PROJECT_NAME}_PROJECT_EMAIL_URL_ADDRESS_BASE</strong> (set in
<a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a>): A base email address
specified at the Project level creating package-specific email addresses
(e.g. <code class="docutils literal notranslate"><span class="pre">&lt;lower-case-package-name&gt;-regression&#64;some.project.gov</span></code>, where
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_PROJECT_EMAIL_URL_ADDRESS_BASE=some.project.gov</span></code>).  If not
already set, this variable will be set to
<code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}_REPOSITORY_EMAIL_URL_ADDRESS_BASE</span></code> for the first
repository processed that has this set. This behavior is used, for example by
the Trilinos project to automatically assign email addresses for add-on
packages and was added to maintain backward compatibility.</p>
<p id="project-name-project-master-email-address">6) <strong>${PROJECT_NAME}_PROJECT_MASTER_EMAIL_ADDRESS</strong> (set in
<a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a>): A single default email
address for all packages specified at the Project level
(e.g. <code class="docutils literal notranslate"><span class="pre">my-project-regression&#64;some.project.gov</span></code>).  If not already set, this
variable will be set to
<code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}_REPOSITORY_MASTER_EMAIL_ADDRESS</span></code> for the first
repository processed that has this set.  Every meta-project should set this
variable so that it will be the default email address for any new package
added.</p>
<p>WARNING: If any of the email lists or URL string variables listed above are
set to <code class="docutils literal notranslate"><span class="pre">&quot;OFF&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;FALSE&quot;</span></code> (or some other value that CMake interprets as
false, see <a class="reference internal" href="#cmake-language-overview-and-gotchas">CMake Language Overview and Gotchas</a>) then the variables are
treated as empty and not set.</p>
<p>If a TriBITS project does not use CDash, then no email address needs to be
assigned to packages at all (and therefore none of the above variables need be
set).</p>
<p>As a general rule, repository-level settings override project-level settings
and package-level settings override both.  Also, a project can redefine a
repository’s regression email list settings by resetting the variables in the
project’s <a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a> file.</p>
<p>All of the email dependency management logic must be accessible by just running
the macro:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_read_all_project_deps_files_create_deps_graph</span><span class="p">()</span>
</pre></div>
</div>
<p>The above email address configuration variables are read from the Repository
and Project files <a class="reference internal" href="#repodir-cmake-repositorydependenciessetup-cmake">&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</a> and
<a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a>, respectively.  The
<code class="docutils literal notranslate"><span class="pre">RepositoryDependenciesSetup.cmake</span></code> files are read first in the specified
repository order followed up by reading the <code class="docutils literal notranslate"><span class="pre">ProjectDependenciesSetup.cmake</span></code>
file.  In this way, the project can override any of the repository settings.</p>
<p>In review, the precedence order for how regression email addresses are
selected for a given package is:</p>
<ol class="arabic simple">
<li><p>Package-specific email list is selected if defined (unless an override is
in place).</p></li>
<li><p>Repository-level option is selected over a project-level option.</p></li>
<li><p>Default email form with repository or project address base is selected over
single repository or project email address.</p></li>
<li><p>If none of the above are selected, then no email address is assigned for a
given package.</p></li>
</ol>
<p>What the above setup does is it results in the TriBITS system (in the
<a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a> function called in a <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-S</span></code> script) creating a
file called <code class="docutils literal notranslate"><span class="pre">CDashSubprojectDependencies.xml</span></code> (which contains the list of
TriBITS packages, which CDash calls “subprojects”, and email address for each
package to send regression emails to) and that file gets sent to the CDash
server. CDash then takes this file and creates, or updates, a set of CDash
users (same name and password as the email list address) and sets up a mapping
of Labels (which are used for TriBITS package names) to CDash user emails
addresses. CDash is automatically set up to process this XML file and create
and update CDash users.  There are several consequences of this implementation
of which project maintainers need to be aware.</p>
<p>First, <strong>one should not list the email address for a CDash user account
already on CDash</strong>.  This is because labels will be added for the TriBITS
packages that this email address is associated with and CDash emails will not
be sent out for any other TriBITS packages, no matter what setting that CDash
user account has.  Therefore, one should only list email addresses as CDash
regression email lists that are not already CDash user accounts and wish to be
maintained separately.  For example, if there is an email list that one wants
to have CDash emails sent to but is already a CDash user account, then one can
create another email list (e.g. using Mailman) which can then be registered
with the TriBITS packages in the <code class="docutils literal notranslate"><span class="pre">CDashSubprojectDependencies.xml</span></code> file and
then that new email list forward email to the target email list.</p>
<p>Second, the CDash implementation currently is not set up to remove labels from
existing users when an email address is disassociated with a TriBITS package
in the <code class="docutils literal notranslate"><span class="pre">CDashSubprojectDependencies.xml</span></code> file.  Therefore, <strong>if one changes
a TriBITS package’s CDash regression email address then one needs to manually
remove the associated labels from the old email address</strong>.  CDash will not
remove them automatically.  Otherwise, email will continue to be sent to that
email address for that package.</p>
<p>Therefore, <strong>to change the mapping of CDash regression email addresses to
TriBITS packages, one must perform the following actions</strong>:</p>
<ol class="arabic simple">
<li><p>Change the TriBITS CMake files as described above that will result in the
desired email addresses in the <code class="docutils literal notranslate"><span class="pre">CDashSubprojectDependencies.xml</span></code>
file. One can debug this by generating the file
<a class="reference internal" href="#project-packagedependencies-xml">&lt;Project&gt;PackageDependencies.xml</a> by using the cmake -P script
<a class="reference internal" href="#tribitsdumpdepsxmlscript-cmake">TribitsDumpDepsXmlScript.cmake</a>.</p></li>
<li><p>Log onto the CDash server using an administrator account and then remove
the auto-generated account for the CDash user email address for which
labels are being removed (i.e. no longer associated with a TriBITS
package).  This is needed since CDash seems to be unable to remove labels
from an existing CDash user (however this might be fixed in a current
version of CDash).</p></li>
<li><p>The next time a CDash submit is performed by a CTest driver script calling
<a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a>, the CDash user associated with the mail list
with labels being removed will get automatically recreated with the right
list of labels (according to the current
<code class="docutils literal notranslate"><span class="pre">CDashSubprojectDependencies.xml</span></code> file).  Also, any new CDash users for
new email addresses will be created.</p></li>
</ol>
<p>Hopefully that should be enough information to manage the mapping of CDash
regression email lists to TriBITS packages for single and multi-repository
TriBITS projects.</p>
</section>
</section>
</section>
<section id="multi-repository-support">
<h1><a class="toc-backref" href="#id56"><span class="sectnum">7</span> Multi-Repository Support</a><a class="headerlink" href="#multi-repository-support" title="Permalink to this heading"></a></h1>
<p>TriBITS has built-in support for projects involving multiple <a class="reference internal" href="#tribits-repositories">TriBITS
Repositories</a> which contain multiple <a class="reference internal" href="#tribits-packages">TriBITS Packages</a> (see <a class="reference internal" href="#how-to-set-up-multi-repository-support">How to set up
multi-repository support</a>).  The basic configuration, build, and test of such
projects requires only raw CMake/CTest, just like any other CMake project (see
<a class="reference internal" href="#tribits-system-project-dependencies">TriBITS System Project Dependencies</a>).  Every TriBITS project automatically
supports tacking on add-on TriBITS packages and TPLs through the
<a class="reference internal" href="#project-name-extra-repositories">${PROJECT_NAME}_EXTRA_REPOSITORIES</a> cmake cache variable as described in
<a class="reference external" href="TribitsBuildReference.html#enabling-extra-repositories-with-add-on-packages">Enabling extra repositories with add-on packages</a>.  In addition, a TriBITS
project can be set up to pull in other TriBITS Repositories using the
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file.  A special form of
this type of project is a <a class="reference internal" href="#tribits-meta-project">TriBITS Meta-Project</a> that contains no native
packages or TPLs of its own.  The ability to create meta-projects out of
individual TriBITS repositories allows TriBITS to be used to provide
coordinated builds (or meta-builds) of large aggregations of software.</p>
<p>To help set up a full-featured development environment (i.e. not just the
basic configure, build, test, and install) for TriBITS projects with multiple
repositories, TriBITS provides some extra development tools implemented using
Python which are provided in the “extended” parts of TriBITS (see
<a class="reference internal" href="#tribits-tribits-directory-contents">TriBITS/tribits/ Directory Contents</a>).  The primary tools supporting
multi-repository projects are the Python tools <a class="reference internal" href="#clone-extra-repos-py">clone_extra_repos.py</a>,
<a class="reference internal" href="#gitdist">gitdist</a>, and <a class="reference internal" href="#checkin-test-py">checkin-test.py</a>.</p>
<p>To demonstrate, consider the TriBITS meta-project with the following
<code class="docutils literal notranslate"><span class="pre">ExtraRepositoriesList.cmake</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_project_define_extra_repositories</span><span class="p">(</span>
  <span class="n">ExtraRepo1</span>  <span class="s2">&quot;&quot;</span>  <span class="n">GIT</span>  <span class="n">git</span><span class="nd">@someurl</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">ExtraRepo1</span>  <span class="s2">&quot;&quot;</span>  <span class="n">Continuous</span>
  <span class="n">ExtraRepo2</span>  <span class="s2">&quot;ExtraRepo1/ExtraRepos2&quot;</span>  <span class="n">GIT</span>  <span class="n">git</span><span class="nd">@someurl</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">ExtraRepo2</span>
                                                 <span class="n">NOPACKAGES</span>  <span class="n">Continuous</span>
  <span class="n">ExtraRepo3</span>  <span class="s2">&quot;&quot;</span>  <span class="n">GIT</span>  <span class="n">git</span><span class="nd">@someurl</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">ExtraRepo3</span>  <span class="s2">&quot;&quot;</span>  <span class="n">Nightly</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>Once cloned, the directories would be laid out as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MetaProject</span><span class="o">/</span>
  <span class="o">.</span><span class="n">git</span><span class="o">/</span>
  <span class="o">.</span><span class="n">gitignore</span>
  <span class="n">ExtraRepo1</span><span class="o">/</span>
    <span class="o">.</span><span class="n">git</span><span class="o">/</span>
    <span class="n">ExrraRepo2</span><span class="o">/</span>
      <span class="o">.</span><span class="n">git</span><span class="o">/</span>
  <span class="n">ExtraRepo3</span><span class="o">/</span>
    <span class="o">.</span><span class="n">git</span><span class="o">/</span>
</pre></div>
</div>
<p id="clone-extra-repos-py">The tool <strong>clone_extra_repos.py</strong> is used to clone the extra repositories for
a multi-repositories TriBITS project.  It reads the repository URLs and
destination directories from the file
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> and does the clones.  For
example, to clone all the repos for the <code class="docutils literal notranslate"><span class="pre">MetaProject</span></code> project, one would use
the commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone git@someurl.com:MetaProject
$ cd MetaProject/
$ ./cmake/tribits/ci_support/clone_extra_repos.py
</pre></div>
</div>
<p>which produces the output like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>

<span class="o">***</span>
<span class="o">***</span> <span class="n">Clone</span> <span class="n">the</span> <span class="n">selected</span> <span class="n">extra</span> <span class="n">repos</span><span class="p">:</span>
<span class="o">***</span>

<span class="n">Cloning</span> <span class="n">repo</span> <span class="n">ExtraRepo1</span> <span class="o">...</span>

<span class="n">Running</span><span class="p">:</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="nd">@someurl</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">ExtraRepo1</span> <span class="n">ExtraRepo1</span>

<span class="n">Cloning</span> <span class="n">repo</span> <span class="n">ExtraRepo2</span> <span class="o">...</span>

<span class="n">Running</span><span class="p">:</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="nd">@someurl</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">ExtraRepo2</span> <span class="n">ExtraRepo1</span><span class="o">/</span><span class="n">ExtraRepo2</span>

<span class="n">Cloning</span> <span class="n">repo</span> <span class="n">ExtraRepo3</span> <span class="o">...</span>

<span class="n">Running</span><span class="p">:</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="nd">@someurl</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">ExtraRepo3</span> <span class="n">ExtraRepo3</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#clone-extra-repos-py-help">clone_extra_repos.py –help</a> for more details.</p>
<p id="gitdist">Once cloned, one needs to work with the multiple repositories to perform basic
VC operations.  For this, TriBITS provides the tool <strong>gitdist</strong> which is a
simple stand-alone Python script that distributes a git command across a set
of git repos.  This tool is not specific to TriBITS but it is very useful for
dealing with TriBITS projects with multiple repositories.  It only requires a
local base git repo and a set of zero or more git repos cloned under it.</p>
<p>To use <code class="docutils literal notranslate"><span class="pre">gitdist</span></code> with this aggregate meta-project, one would first set up
the file <code class="docutils literal notranslate"><span class="pre">MetaProject/.gitdist</span></code> (or a version-controlled
<code class="docutils literal notranslate"><span class="pre">MetaProject.gitdist.default</span></code> file) which would contain the lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ExtraRepo1</span>
<span class="n">ExtraRepo1</span><span class="o">/</span><span class="n">ExtraRepo2</span>
<span class="n">ExtraRepo3</span>
</pre></div>
</div>
<p>and one would set up the tracked ignore file <code class="docutils literal notranslate"><span class="pre">MetaProject/.gitignore</span></code> which
contains the lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">ExtraRepo1</span><span class="o">/</span>
<span class="o">/</span><span class="n">ExtraRepo1</span><span class="o">/</span><span class="n">ExtraRepo2</span><span class="o">/</span>
<span class="o">/</span><span class="n">ExtraRepo3</span><span class="o">/</span>
</pre></div>
</div>
<p>To use <code class="docutils literal notranslate"><span class="pre">gitdist</span></code>, one would put <code class="docutils literal notranslate"><span class="pre">gitdist</span></code> into their path and also set up
the command-line shell aliases <code class="docutils literal notranslate"><span class="pre">gitdist-status</span></code> and <code class="docutils literal notranslate"><span class="pre">gitdist-mod</span></code> (see
<a class="reference internal" href="#gitdist-dist-help-aliases">gitdist –dist-help=aliases</a>).</p>
<p>Some of the aggregate commands that one would typically run under the base
<code class="docutils literal notranslate"><span class="pre">MetaProject/</span></code> directory are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># See status of all repos at once</span>
<span class="n">gitdist</span><span class="o">-</span><span class="n">status</span>

<span class="c1"># Pull updates to all</span>
<span class="n">gitdist</span> <span class="n">pull</span>

<span class="c1"># Push local commits to tracking branches</span>
<span class="n">gitdist</span> <span class="n">push</span>
</pre></div>
</div>
<p>The tool <code class="docutils literal notranslate"><span class="pre">gitdist</span></code> is provided under TriBITS directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span><span class="o">/</span><span class="n">tribits</span><span class="o">/</span><span class="n">python_utils</span><span class="o">/</span><span class="n">gitidst</span>
</pre></div>
</div>
<p>and can be installed by the <a class="reference internal" href="#install-devtools-py">install_devtools.py</a> tool (see <a class="reference internal" href="#tribits-development-toolset">TriBITS
Development Toolset</a>).  See <a class="reference internal" href="#gitdist-documentation">gitdist documentation</a> for more details.</p>
<p>For projects with a standard set of extra repositories defined in the
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file, the
<code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool only requires passing in the option
<code class="docutils literal notranslate"><span class="pre">--extra-repos-file=project</span></code> and <code class="docutils literal notranslate"><span class="pre">--extra-repos-type=Continuous</span></code> (or
<code class="docutils literal notranslate"><span class="pre">Nightly</span></code>, see <a class="reference internal" href="#repository-test-classification">Repository Test Classification</a>) and it will automatically
perform all of the various actions for all of the selected repositories.  See
<a class="reference internal" href="#checkin-test-py">checkin-test.py</a> and <a class="reference internal" href="#checkin-test-py-help">checkin-test.py –help</a> for more details.</p>
<p>To keep track of compatible versions of the git repos, TriBITS provides
support for a <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;RepoVersion.txt</span></code> file.  Any TriBITS project can
generate this file automatically by setting the option
<a class="reference internal" href="#project-name-generate-repo-version-file">${PROJECT_NAME}_GENERATE_REPO_VERSION_FILE</a>.  For the above example
<code class="docutils literal notranslate"><span class="pre">MetaProject</span></code>, this file looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">***</span> <span class="n">Base</span> <span class="n">Git</span> <span class="n">Repo</span><span class="p">:</span> <span class="n">MetaProject</span>
<span class="n">e102e27</span> <span class="p">[</span><span class="n">Mon</span> <span class="n">Sep</span> <span class="mi">23</span> <span class="mi">11</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">59</span> <span class="mi">2013</span> <span class="o">-</span><span class="mi">0400</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">author0</span><span class="nd">@someurl</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="n">First</span> <span class="n">summary</span> <span class="n">message</span>
<span class="o">***</span> <span class="n">Git</span> <span class="n">Repo</span><span class="p">:</span> <span class="n">ExtraRepo1</span>
<span class="n">b894b9c</span> <span class="p">[</span><span class="n">Fri</span> <span class="n">Aug</span> <span class="mi">30</span> <span class="mi">09</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">07</span> <span class="mi">2013</span> <span class="o">-</span><span class="mi">0400</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">author1</span><span class="nd">@someurl</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="n">Second</span> <span class="n">summary</span> <span class="n">message</span>
<span class="o">***</span> <span class="n">Git</span> <span class="n">Repo</span><span class="p">:</span> <span class="n">ExtraRepo1</span><span class="o">/</span><span class="n">ExtraRepo2</span>
<span class="mi">97</span><span class="n">cf1ac</span> <span class="p">[</span><span class="n">Thu</span> <span class="n">Dec</span> <span class="mi">1</span> <span class="mi">23</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">06</span> <span class="mi">2012</span> <span class="o">-</span><span class="mi">0500</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">author2someurl</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="n">Third</span> <span class="n">summary</span> <span class="n">message</span>
<span class="o">***</span> <span class="n">Git</span> <span class="n">Repo</span><span class="p">:</span> <span class="n">ExtraRepo3</span>
<span class="n">cd4a3af</span> <span class="p">[</span><span class="n">Mon</span> <span class="n">Mar</span> <span class="mi">9</span> <span class="mi">19</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">06</span> <span class="mi">2013</span> <span class="o">-</span><span class="mi">0400</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">author3someurl</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="n">Fourth</span> <span class="n">summary</span> <span class="n">message</span>
</pre></div>
</div>
<p>This file gets created in the build directory, gets echoed in the configure
output, gets installed into the install directory, and get added to the source
distributions tarball.  It also gets pushed up to CDash for all automated
builds.  The tool <a class="reference internal" href="#gitdist">gitdist</a> can then use this file to checkout and tag
compatible versions, difference two versions of the meta-project, etc. (see
<a class="reference internal" href="#gitdist-documentation">gitdist documentation</a> for more details on git operations).</p>
<p>The TriBITS approach to managing multiple VC repos described above works well
for around 20 or 30 VC repos but is likely not a good solution for many more
git repos.  For larger numbers of VC repos, one should consider nested
integration creating snapshot git repos (e.g. using the tool
<a class="reference internal" href="#snapshot-dir-py">snapshot-dir.py</a>) that aggregate several related repositories into a single
git repo.  Another approach might be to use git submodules.  (However, note
that the TriBITS tools and processes described here are <strong>not</strong> currently set
up to support aggregate VC repos that use git submodules.)  The design
decision with TriBITS was to explicitly handle the different git VC repos by
listing them in the <a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file and
then using the simple, easy to understand, tools <a class="reference internal" href="#clone-extra-repos-py">clone_extra_repos.py</a> and
<a class="reference internal" href="#gitdist">gitdist</a>.  There are advantages and disadvantages to explicitly handling the
different git repos as is currently employed by the TriBITS software
development tools verses using git submodules.  It is possible that TriBITS
will add support for aggregate git repos using git submodules in the future
but only if there are important projects that choose to use them.  The
discussion of these various approaches and strategies to dealing with
aggregate repos is beyond the scope of this document.</p>
</section>
<section id="development-workflows">
<h1><a class="toc-backref" href="#id57"><span class="sectnum">8</span> Development Workflows</a><a class="headerlink" href="#development-workflows" title="Permalink to this heading"></a></h1>
<p>In this section, the typical development workflows for a TriBITS project are
described.  First, the <a class="reference internal" href="#basic-development-workflow">Basic Development Workflow</a> for a single-repository
TriBITS project is described.  This is followed up with a slightly more
complex <a class="reference internal" href="#multi-repository-development-workflow">Multi-Repository Development Workflow</a>.</p>
<section id="basic-development-workflow">
<h2><a class="toc-backref" href="#id58"><span class="sectnum">8.1</span> Basic Development Workflow</a><a class="headerlink" href="#basic-development-workflow" title="Permalink to this heading"></a></h2>
<p>The basic development workflow of a TriBITS project is not much different than
with any other CMake project that uses CTest to define and run tests.  One
pulls updates from the master VC repo then configures with <code class="docutils literal notranslate"><span class="pre">cmake</span></code>, and
iteratively builds, runs tests, adds files, changes files, does a final test,
then pushes updates.  The major difference is that a well constructed
development process will use the <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> tool to test and push all
changes that affect the build or the tests.  The basic steps in configuring,
building, running tests, etc., are given in the project’s
<a class="reference external" href="TribitsBuildReference.html">&lt;Project&gt;BuildReference</a>. file (see <a class="reference internal" href="#project-specific-build-reference">Project-Specific Build Reference</a>).</p>
</section>
<section id="multi-repository-development-workflow">
<h2><a class="toc-backref" href="#id59"><span class="sectnum">8.2</span> Multi-Repository Development Workflow</a><a class="headerlink" href="#multi-repository-development-workflow" title="Permalink to this heading"></a></h2>
<p>The development workflow for a project with multiple VC repos is very similar
to a project with just a single VC repo if the project provides a standard
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file.  The major difference
is in making changes, creating commits, etc.  The <a class="reference internal" href="#gitdist">gitdist</a> tool makes these
steps easier and has been shown to work fairly well for up to 20 extra VC
repos (as used in the CASL VERA project).  The <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> tool
automatically handles all of the details of pulling, diffing, pushing etc. to
all the VC repos.</p>
</section>
</section>
<section id="howtos">
<h1><a class="toc-backref" href="#id60"><span class="sectnum">9</span> Howtos</a><a class="headerlink" href="#howtos" title="Permalink to this heading"></a></h1>
<p>This section provides short, succinct lists of the steps to accomplish a few
common tasks.  Extra details are referenced.</p>
<section id="how-to-add-a-new-tribits-package">
<h2><a class="toc-backref" href="#id61"><span class="sectnum">9.1</span> How to add a new TriBITS Package</a><a class="headerlink" href="#how-to-add-a-new-tribits-package" title="Permalink to this heading"></a></h2>
<p>To add a new TriBITS package, it is recommended to take the template from one
of the <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a> packages that most closely fits the needs of
the new package and modify it for the new package.  For example, the files for
the <code class="docutils literal notranslate"><span class="pre">SimpleCxx</span></code> package can be copied one at a time and modified for the new
package.</p>
<p>To add a new TriBITS package (with no subpackages), do the following:</p>
<ol class="arabic simple">
<li><p>Chose a name <code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;</span></code> for the new package and which TriBITS
repository (<code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;</span></code>) to put the package into.  <strong>WARNING!</strong> The
chosen name <code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;</span></code> must be unique across all TriBITS
repositories (see <a class="reference internal" href="#globally-unique-tribits-package-names">Globally unique TriBITS package names</a>).</p></li>
<li><p>Create the directory <code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;/&lt;packageDir&gt;/</span></code> for the new package and
put in skeleton files for <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> and
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a>.  Set the desired upstream TPL and SE
package dependencies in the new <code class="docutils literal notranslate"><span class="pre">Dependencies.cmake</span></code> file but initially
comment out everything in the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file except for the
<a class="reference internal" href="#id1">tribits_package()</a> and <a class="reference internal" href="#tribits-package-postprocess">tribits_package_postprocess()</a> commands.</p></li>
<li><p>Add a row for the new package to the <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> file
after all of its upstream dependent packages.  If a mistake is made and it
is listed before one of its upstream dependent packages, the TriBITS CMake
code will catch this and issue an error.</p></li>
<li><p>Configure the TriBITS project enabling the new empty package
<code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;</span></code>.  This will enable the listed dependencies.</p></li>
<li><p>Incrementally fill in the package’s <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> files defining
libraries, executables, tests and examples.  The project should be built
and tests run as new pieces are added.</p></li>
</ol>
<p>Once the new package is defined, downstream SE packages can define
dependencies on this new package.</p>
</section>
<section id="how-to-add-a-new-tribits-package-with-subpackages">
<h2><a class="toc-backref" href="#id62"><span class="sectnum">9.2</span> How to add a new TriBITS Package with Subpackages</a><a class="headerlink" href="#how-to-add-a-new-tribits-package-with-subpackages" title="Permalink to this heading"></a></h2>
<p>Adding a new package with subpackages is similar to adding a new regular
package described in <a class="reference internal" href="#how-to-add-a-new-tribits-package">How to add a new TriBITS Package</a>.  Again, it is
recommended that one copies an example package from <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>.
For example, one could copy files and directories from the example package
<code class="docutils literal notranslate"><span class="pre">WithSubpackages</span></code>.</p>
<p>To add a new TriBITS package with packages, do the following:</p>
<ol class="arabic simple">
<li><p>Chose a name <code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;</span></code> for the new package and which TriBITS
repository (<code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;</span></code>) to put the package into.  <strong>WARNING!</strong> The
chosen name <code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;</span></code> must be unique across all TriBITS
repositories (see <a class="reference internal" href="#globally-unique-tribits-package-names">Globally unique TriBITS package names</a>).</p></li>
<li><p>Create the directory <code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;/&lt;packageDir&gt;/</span></code> for the new package and
put in skeleton files for <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> and
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a>.  Initially don’t define any subpackages and
comment out everything in the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file except for the
<a class="reference internal" href="#id1">tribits_package()</a> and <a class="reference internal" href="#tribits-package-postprocess">tribits_package_postprocess()</a> commands.</p></li>
<li><p>Add a new row for the new package to the <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a>
file after all of the upstream dependencies of its to-be-defined
subpackages.</p></li>
<li><p>Configure the TriBITS project enabling the new empty package
<code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;</span></code>.</p></li>
<li><p>Incrementally add the subpackages as described in <a class="reference internal" href="#how-to-add-a-new-tribits-subpackage">How to add a new TriBITS
Subpackage</a>, filling out the various <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> files defining
libraries, executables, tests and examples.</p></li>
</ol>
<p>Once the new SE packages are defined, downstream SE packages can define
dependencies on these.</p>
</section>
<section id="how-to-add-a-new-tribits-subpackage">
<h2><a class="toc-backref" href="#id63"><span class="sectnum">9.3</span> How to add a new TriBITS Subpackage</a><a class="headerlink" href="#how-to-add-a-new-tribits-subpackage" title="Permalink to this heading"></a></h2>
<p>Given an existing top-level TriBITS package that is already broken down into
subpackages (see <a class="reference internal" href="#how-to-add-a-new-tribits-package-with-subpackages">How to add a new TriBITS Package with Subpackages</a>), adding
a new subpackage does not require changing any project-level or
repository-level files.  One only needs to add the declaration for the new
subpackages in its parent’s <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> file then
fill out the pieces of the new subpackage defined in the section <a class="reference internal" href="#tribits-subpackage-core-files">TriBITS
Subpackage Core Files</a>.  It is recommended to copy files from one of the
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a> subpackages in the <code class="docutils literal notranslate"><span class="pre">WithSubpackages</span></code>
package.</p>
<p>To add a new TriBITS subpackage to a top-level package that already has
subpackages, do the following:</p>
<ol class="arabic simple">
<li><p>Chose a name <code class="docutils literal notranslate"><span class="pre">&lt;spkgName&gt;</span></code> for the new subpackage which only has to be
different than the other subpackages in the parent package.  This name gets
appended to the parent package’s name <code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;</span></code> to form the SE
package name <code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;&lt;spkgName&gt;</span></code>.</p></li>
<li><p>Create the directory <code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;&lt;spkgDir&gt;/</span></code> for the new package and put
in skeleton files for <a class="reference internal" href="#packagedir-spkgdir-cmake-dependencies-cmake">&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</a>
and <a class="reference internal" href="#packagedir-spkgdir-cmakelists-txt">&lt;packageDir&gt;/&lt;spkgDir&gt;/CMakeLists.txt</a>.  Set the desired upstream TPL
and SE package dependencies in the new <code class="docutils literal notranslate"><span class="pre">Dependencies.cmake</span></code> file but
initially comment out everything in the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file except for
the <a class="reference internal" href="#id3">tribits_subpackage()</a> and <a class="reference internal" href="#tribits-subpackage-postprocess">tribits_subpackage_postprocess()</a>
commands.</p></li>
<li><p>Add a row for the new subpackage to the argument
<a class="reference internal" href="#subpackages-dirs-classifications-optreqs">SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS</a> in the macro call
<a class="reference internal" href="#tribits-package-define-dependencies">tribits_package_define_dependencies()</a> in the parent package’s
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> file after all of its upstream
dependent subpackages.  If a mistake is made and it is listed before one of
its upstream dependent subpackages, the TriBITS CMake code will catch this
and issue an error.</p></li>
<li><p>Configure the TriBITS project enabling the new empty SE package
<code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;&lt;spkgName&gt;</span></code>.  This will enable the listed dependencies.</p></li>
<li><p>Incrementally fill in the subpackage’s <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> files defining
libraries, executables, tests and examples.  The project should be built
and tests run as new pieces are added.</p></li>
</ol>
</section>
<section id="how-to-add-a-new-tribits-external-package-tpl">
<span id="how-to-add-a-new-tribits-tpl"></span><h2><a class="toc-backref" href="#id64"><span class="sectnum">9.4</span> How to add a new TriBITS external package/TPL</a><a class="headerlink" href="#how-to-add-a-new-tribits-external-package-tpl" title="Permalink to this heading"></a></h2>
<p>In order for a TriBITS package to define a dependency on a new <a class="reference internal" href="#tribits-external-package-tpl">TriBITS
External Package/TPL</a> (i.e. a TPL that has not already been declared in the
current repo’s or an upstream repo’s <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file), one
must add and modify a few repository-level files in addition to modifying
files within the TriBITS packages that use the new external package/TPL.</p>
<p>To add a new TriBITS TPL, do the following:</p>
<ol class="arabic">
<li><p><strong>Chose a name &lt;tplName&gt;</strong> for the new TPL (must be globally unique across
all TriBITS repos.  (See <a class="reference internal" href="#globally-unique-tribits-tpl-names">Globally unique TriBITS TPL names</a>.)</p></li>
<li><p><strong>Choose the subdirectory &lt;tplDefsDir&gt; for the new TPL files</strong>.  These
files are usually placed under the TriBITS repository directory
<code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;/</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;/cmake/tpls/</span></code>) where the first downstream
dependent package is defined or can be under a TriBITS package directory
<code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;/</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;/cmake/tpls/</span></code>) if only one package
is using that TPL.</p></li>
<li><p><strong>Create the FindTPL&lt;tplName&gt;.cmake file</strong> (or some other name, see
<a class="reference internal" href="#tplname-findmod">&lt;tplName&gt;_FINDMOD</a>) under <code class="docutils literal notranslate"><span class="pre">&lt;tplDefsDir&gt;/</span></code>.  (See <a class="reference internal" href="#creating-the-findtpl-tplname-cmake-file">Creating the
FindTPL&lt;tplName&gt;.cmake file</a>.)</p></li>
<li><p><strong>[Optional] Create the FindTPL&lt;tplName&gt;Dependencies.cmake file</strong> in the
same directory as the <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> file, <code class="docutils literal notranslate"><span class="pre">&lt;tplDefsDir&gt;/</span></code>.
(See <a class="reference internal" href="#findtpl-tplname-dependencies-cmake">FindTPL&lt;tplName&gt;Dependencies.cmake</a>.)</p></li>
<li><p><strong>Add a row to the &lt;repoDir&gt;/TPLsList.cmake file</strong> for the new TPL after
any TPLs that this new TPL may depend on.  (See
<a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a>.)</p></li>
<li><p><strong>Configure the TriBITS project enabling the new TPL with
TPL_ENABLE_&lt;tplName&gt;=ON</strong> and see that the TPL is found correctly at
configure time.</p></li>
<li><p><strong>Add &lt;tplName&gt; to the package Dependencies.cmake files</strong> of downstream
dependent packages that will use this TPL (see
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> or
<a class="reference internal" href="#packagedir-spkgdir-cmake-dependencies-cmake">&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</a> for a subpackage).</p></li>
<li><p><strong>[Optional] Add #cmakedefine for an optional package library TPL
dependency in the package’s &lt;packageName&gt;_config.h.in file</strong> using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#cmakedefine HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;TPL_NAME_UC&gt;</span>
</pre></div>
</div>
<p>so that the package’s code build knows if the TPL is defined or not (see
<a class="reference internal" href="#packagename-config-h-in">&lt;packageName&gt;_config.h.in</a> and <a class="reference internal" href="#tribits-configure-file">tribits_configure_file()</a>).  (NOTE: Do
<strong>not</strong> add this for a optional test-only TPL dependency.  We don’t want
all of the libraries in a package to have to be rebuild when we enable or
disable tests for the package.)</p>
</li>
<li><p><strong>Use the TPL functionality in the packages</strong> that define the dependency on
the new TPL, configure, test, etc.</p></li>
</ol>
<p id="creating-the-findtpl-tplname-cmake-file"><strong>Creating the FindTPL&lt;tplName&gt;.cmake file</strong></p>
<p>The main axes of variation in defining <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> modules are:</p>
<ol class="loweralpha simple">
<li><p>Use an inner <code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> call or just use a simple list
of header file names and library names?</p></li>
<li><p>The call <code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> defines modern IMPORTED targets or
only provides variables for the list of include directories and libraries?</p></li>
<li><p>Maintain backward compatibility with the legacy TriBITS TPL system that
allows the user to set cache variables for the include directories and link
libraries or force users to always call <code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code>?</p></li>
</ol>
<p>See the different variations in the below sections:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#creating-findtpl-tplname-cmake-using-find-package">Creating FindTPL&lt;tplName&gt;.cmake using find_package()</a></p>
<ul>
<li><p><a class="reference internal" href="#creating-findtpl-tplname-cmake-using-find-package-with-imported-targets">Creating FindTPL&lt;tplName&gt;.cmake using find_package() with IMPORTED targets</a></p></li>
<li><p><a class="reference internal" href="#creating-findtpl-tplname-cmake-using-find-package-without-imported-targets">Creating FindTPL&lt;tplName&gt;.cmake using find_package() without IMPORTED targets</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#creating-a-findtpl-tplname-cmake-module-without-find-package">Creating a FindTPL&lt;tplName&gt;.cmake module without find_package()</a></p></li>
<li><p><a class="reference internal" href="#requirements-for-findtpl-tplname-cmake-modules">Requirements for FindTPL&lt;tplName&gt;.cmake modules</a></p></li>
</ul>
<section id="creating-findtpl-tplname-cmake-using-find-package">
<h3><a class="toc-backref" href="#id65">Creating FindTPL&lt;tplName&gt;.cmake using find_package()</a><a class="headerlink" href="#creating-findtpl-tplname-cmake-using-find-package" title="Permalink to this heading"></a></h3>
<p>When defining a <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> file, it encouraged to utilize
<code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;</span> <span class="pre">...)</span></code> to provide the default find operation (and
also the definition of the IMPORTED targets needed to use the external package
when supported).  (Here, typically <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;externalPkg&gt;</span></code> are the
same names, but there are cases where the names may be different or use
different capitalization.)  However, the state of the current ecosystem of
<code class="docutils literal notranslate"><span class="pre">Find&lt;externalPkg&gt;.cmake</span></code> modules and <code class="docutils literal notranslate"><span class="pre">&lt;externalPkg&gt;Config.cmake</span></code> package
config files is a bit uneven.  While all find modules and package config files
should be defining modern CMake IMPORTED targets which contains all the needed
usage requirements (such as the target properties
<code class="docutils literal notranslate"><span class="pre">INTERFACE_INCLUDE_DIRECTORIES</span></code> and <code class="docutils literal notranslate"><span class="pre">INTERFACE_LINK_LIBRARIES</span></code>) and use
<code class="docutils literal notranslate"><span class="pre">find_dependency()</span></code> to get all of their required external upstream package
dependencies, many do not.  Also, many of these don’t provide a complete
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> target which is required for a TriBITS-compatible
external package/TPL.</p>
<p>In this case, the <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> file provides a thin “glue” layer
to adapt the information and objects provided by the
<code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;</span> <span class="pre">...)</span></code> call into a complete
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> target and a wrapper <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;Config.cmake</span></code> file
for consumption by downstream TriBITS-compatible packages.</p>
<p>The following subsections will describe how to create these TriBITS-compatible
<code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> modules for all of the various cases using an
internal call to <code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;</span> <span class="pre">...)</span></code>:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#creating-findtpl-tplname-cmake-using-find-package-with-imported-targets">Creating FindTPL&lt;tplName&gt;.cmake using find_package() with IMPORTED targets</a></p></li>
<li><p><a class="reference internal" href="#creating-findtpl-tplname-cmake-using-find-package-without-imported-targets">Creating FindTPL&lt;tplName&gt;.cmake using find_package() without IMPORTED targets</a></p></li>
</ul>
<section id="creating-findtpl-tplname-cmake-using-find-package-with-imported-targets">
<h4><a class="toc-backref" href="#id66">Creating FindTPL&lt;tplName&gt;.cmake using find_package() with IMPORTED targets</a><a class="headerlink" href="#creating-findtpl-tplname-cmake-using-find-package-with-imported-targets" title="Permalink to this heading"></a></h4>
<p>For cases where <code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> provides complete and proper
modern (namespaced) IMPORTED targets (but is missing the
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> target or the name <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;externalPkg&gt;</span></code>
name are different), these <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> modules can call the
function
<a class="reference internal" href="#tribits-extpkg-create-imported-all-libs-target-and-config-file">tribits_extpkg_create_imported_all_libs_target_and_config_file()</a>
after calling <code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> to create a very thin wrapper
<code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> module.  In these cases, such a
<code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> module file is nothing more than:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">find_package</span><span class="p">(</span><span class="o">&lt;</span><span class="n">externalPkg</span><span class="o">&gt;</span> <span class="n">REQUIRED</span><span class="p">)</span>
<span class="n">tribits_extpkg_create_imported_all_libs_target_and_config_file</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;</span>
  <span class="n">INNER_FIND_PACKAGE_NAME</span> <span class="o">&lt;</span><span class="n">externalPkg</span><span class="o">&gt;</span>
  <span class="n">IMPORTED_TARGETS_FOR_ALL_LIBS</span> <span class="o">&lt;</span><span class="n">importedTarget0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">importedTarget1</span><span class="o">&gt;</span> <span class="o">...</span> <span class="p">)</span>
</pre></div>
</div>
<p>The function
<a class="reference internal" href="#tribits-extpkg-create-imported-all-libs-target-and-config-file">tribits_extpkg_create_imported_all_libs_target_and_config_file()</a>
creates the target <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> and the wrapper file
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;Config.cmake</span></code> which is installed by TriBITS.  The only unique
information required to create this glue module is the name of the external
package <code class="docutils literal notranslate"><span class="pre">&lt;externalPkg&gt;</span></code> and the exact full names of the IMPORTED targets
<code class="docutils literal notranslate"><span class="pre">&lt;importedTarget0&gt;</span> <span class="pre">&lt;importedTarget1&gt;</span> <span class="pre">...</span></code> provided by the
<code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;</span> <span class="pre">...)</span></code> call.</p>
<p>Such simple <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> modules do not follow the legacy
TriBITS TPL convention of allowing users to specify a TPL by setting the cache
variables <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_INCLUDE_DIRS</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIBRARY_DIRS</span></code>, and
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIBRARY_NAMES</span></code> or by setting <code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_INCLUDE_DIRS</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIBRARIES</span></code>.  But as the ecosystem of CMake software transitions
to modern CMake and uniform usage of complete <code class="docutils literal notranslate"><span class="pre">&lt;Package&gt;Config.cmake</span></code> files,
that is the reasonable thing to do.</p>
<p>However, to maintain backwards compatibility with the legacy TriBITS TPL
system (such as when upgrading a existing <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> file), a
<code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> file can be extended to use the
<a class="reference internal" href="#tribits-tpl-allow-pre-find-package">tribits_tpl_allow_pre_find_package()</a> in combination with the function
<a class="reference internal" href="#tribits-tpl-find-include-dirs-and-libraries">tribits_tpl_find_include_dirs_and_libraries()</a> function as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(REQUIRED_HEADERS &lt;header0&gt; &lt;header1&gt; ...)
set(REQUIRED_LIBS_NAMES &lt;libname0&gt; &lt;libname1&gt; ...)
set(IMPORTED_TARGETS_FOR_ALL_LIBS &lt;importedTarget0&gt; &lt;importedTarget1&gt; ...)

tribits_tpl_allow_pre_find_package(&lt;tplName&gt;  &lt;tplName&gt;_ALLOW_PREFIND)

if (&lt;tplName&gt;_ALLOW_PREFIND)
  message(&quot;-- Using find_package(&lt;externalPkg&gt; ...) ...&quot;)
  find_package(&lt;externalPkg&gt;)
  if (&lt;externalPkg&gt;_FOUND)
    message(&quot;-- Found &lt;externalPkg&gt;_DIR=&#39;${&lt;externalPkg&gt;_DIR}&#39;&quot;)
    message(&quot;-- Generating &lt;tplName&gt;::all_libs and &lt;tplName&gt;Config.cmake&quot;)
    tribits_extpkg_create_imported_all_libs_target_and_config_file(&lt;tplName&gt;
      INNER_FIND_PACKAGE_NAME  &lt;externalPkg&gt;
      IMPORTED_TARGETS_FOR_ALL_LIBS  ${IMPORTED_TARGETS_FOR_ALL_LIBS} )
  endif()
endif()

if (NOT TARGET &lt;tplName&gt;::all_libs)
  tribits_tpl_find_include_dirs_and_libraries( &lt;tplName&gt;
    REQUIRED_HEADERS ${REQUIRED_HEADERS}
    REQUIRED_LIBS_NAMES ${REQUIRED_LIBS_NAMES} )
endif()
</pre></div>
</div>
<p>Above, if <code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> is called and returns
<code class="docutils literal notranslate"><span class="pre">&lt;externalPkg&gt;_FOUND=FALSE</span></code>, then as fallback it will call
<code class="docutils literal notranslate"><span class="pre">tribits_tpl_find_include_dirs_and_libraries()</span></code> to find the components of
the TPL.  See the documentation for <a class="reference internal" href="#tribits-tpl-allow-pre-find-package">tribits_tpl_allow_pre_find_package()</a>
for conditions where <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_ALLOW_PREFIND</span></code> is set to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> (and
therefore <code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> is not called).</p>
<p>Note that in the above <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> file that
<code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> will be called even on reconfigures.  That is
critical since <code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> defines IMPORTED targets that
must be available each time configure is called.  Also, if
<code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> is called and <code class="docutils literal notranslate"><span class="pre">&lt;externalPkg&gt;_FOUND=TRUE</span></code>,
then the function
<a class="reference internal" href="#tribits-extpkg-create-imported-all-libs-target-and-config-file">tribits_extpkg_create_imported_all_libs_target_and_config_file()</a>
is called which defines the targets <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> which means that
the function <code class="docutils literal notranslate"><span class="pre">tribits_tpl_find_include_dirs_and_libraries()</span></code> will <strong>not</strong> be
called.</p>
<p>A concrete (and tested) example of the latter case can be found in the file
<code class="docutils literal notranslate"><span class="pre">TribitsExampleProject2/cmake/tpls/FindTPLTpl2.cmake</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(REQUIRED_HEADERS  Tpl2a.hpp) # Only look for one header file to find include dir
set(REQUIRED_LIBS_NAMES  tpl2b tpl2a)
set(IMPORTED_TARGETS_FOR_ALL_LIBS  tpl2::tpl2a tpl2::tpl2b)

tribits_tpl_allow_pre_find_package(Tpl2  Tpl2_ALLOW_PREFIND)

if (Tpl2_ALLOW_PREFIND)
  message(&quot;-- Using find_package(Tpl2 ...) ...&quot;)
  find_package(Tpl2)
  if (Tpl2_FOUND)
    message(&quot;-- Found Tpl2_DIR=&#39;${Tpl2_DIR}&#39;&quot;)
    message(&quot;-- Generating Tpl2::all_libs and Tpl2Config.cmake&quot;)
    tribits_extpkg_create_imported_all_libs_target_and_config_file(Tpl2
      INNER_FIND_PACKAGE_NAME  Tpl2
      IMPORTED_TARGETS_FOR_ALL_LIBS  ${IMPORTED_TARGETS_FOR_ALL_LIBS} )
  endif()
endif()

if (NOT TARGET Tpl2::all_libs)
  tribits_tpl_find_include_dirs_and_libraries( Tpl2
    REQUIRED_HEADERS ${REQUIRED_HEADERS}
    REQUIRED_LIBS_NAMES ${REQUIRED_LIBS_NAMES} )
endif()
</pre></div>
</div>
</section>
<section id="creating-findtpl-tplname-cmake-using-find-package-without-imported-targets">
<h4><a class="toc-backref" href="#id67">Creating FindTPL&lt;tplName&gt;.cmake using find_package() without IMPORTED targets</a><a class="headerlink" href="#creating-findtpl-tplname-cmake-using-find-package-without-imported-targets" title="Permalink to this heading"></a></h4>
<p>There are cases where calling <code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> to find the
parts of an external package does not create proper IMPORTED targets that can
be directly used.  For example, legacy <code class="docutils literal notranslate"><span class="pre">Find&lt;externalPkg&gt;.cmake</span></code> modules
(even many standard <code class="docutils literal notranslate"><span class="pre">Find*.cmake</span></code> modules shipped with CMake as of CMake
3.23) do not provide IMPORTED targets and instead only provide variables for
the list of include directories <code class="docutils literal notranslate"><span class="pre">&lt;externalPkg&gt;_INCLUDE_DIRS</span></code>, a list of
library files <code class="docutils literal notranslate"><span class="pre">&lt;externalPkg&gt;_LIBRARIES</span></code>, and other information.  In cases
such as this, one can implement the <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> module by
calling <code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code>, setting
<code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_INCLUDE_DIRS</span></code> and <code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_LIBRARIES</span></code>, and then
calling <a class="reference internal" href="#tribits-tpl-find-include-dirs-and-libraries">tribits_tpl_find_include_dirs_and_libraries()</a> to create the
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> target and the <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;Config.cmake</span></code> wrapper
config file.</p>
<p>The simplest way to implement <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> is to always call
<code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>message(&quot;-- Using find_package(&lt;externalPkg&gt; ...) ...&quot;)
find_package(&lt;externalPkg&gt; REQUIRED)

# Tell TriBITS that we found &lt;tplName&gt; and there no need to look any further
set(TPL_&lt;tplName&gt;_INCLUDE_DIRS ${&lt;externalPkg&gt;_INCLUDE_DIRS} CACHE PATH &quot;...&quot;)
set(TPL_&lt;tplName&gt;_LIBRARIES ${&lt;externalPkg&gt;_LIBRARIES} CACHE FILEPATH &quot;...&quot;)
set(TPL_&lt;tplName&gt;_LIBRARY_DIRS ${&lt;externalPkg&gt;_LIBRARY_DIRS} CACHE PATH &quot;...&quot;)

tribits_tpl_find_include_dirs_and_libraries( &lt;tplName&gt;
  REQUIRED_HEADERS  neverFindThisHeader
  REQUIRED_LIBS_NAMES   neverFindThisLib
  )
</pre></div>
</div>
<p>The above will always call <code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;</span> <span class="pre">REQUIRED)</span></code>, and if it
can’t find the package, it will error out and stop the configure process.</p>
<p>While the above <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> file is pretty simple, it does not
allow for a fall-back using the legacy TriBITS TPL find system using
<a class="reference internal" href="#tribits-tpl-find-include-dirs-and-libraries">tribits_tpl_find_include_dirs_and_libraries()</a>.  One can allow for a
fall-back find by passing a set of header files and library names for
<code class="docutils literal notranslate"><span class="pre">tribits_tpl_find_include_dirs_and_libraries()</span></code> to find.  This can be done
using the <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(REQUIRED_HEADERS &lt;header0&gt; &lt;header1&gt; ...)
set(REQUIRED_LIBS_NAMES &lt;libname0&gt; &lt;libname1&gt; ...)

message(&quot;-- Using find_package(&lt;externalPkg&gt; ...) ...&quot;)
find_package(&lt;externalPkg&gt;)
if (&lt;externalPkg&gt;_FOUND)
  # Tell TriBITS that we found &lt;tplName&gt; and there no need to look any further
  set(TPL_&lt;tplName&gt;_INCLUDE_DIRS ${&lt;externalPkg&gt;_INCLUDE_DIRS} CACHE PATH &quot;...&quot;)
  set(TPL_&lt;tplName&gt;_LIBRARIES ${&lt;externalPkg&gt;_LIBRARIES} CACHE FILEPATH &quot;...&quot;)
  set(TPL_&lt;tplName&gt;_LIBRARY_DIRS ${&lt;externalPkg&gt;_LIBRARY_DIRS} CACHE PATH &quot;...&quot;)
endif()

tribits_tpl_find_include_dirs_and_libraries( &lt;tplName&gt;
  REQUIRED_HEADERS ${REQUIRED_HEADERS}
  REQUIRED_LIBS_NAMES ${REQUIRED_LIBS_NAMES}
  MUST_FIND_ALL_LIBS )
</pre></div>
</div>
<p>Above, if <code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> can’t find <code class="docutils literal notranslate"><span class="pre">&lt;externalPkg&gt;</span></code>, then
the function <code class="docutils literal notranslate"><span class="pre">tribits_tpl_find_include_dirs_and_libraries()</span></code> will try to
find the listed required header files and libraries, using the legacy TriBITS
TPL find system.  And if <code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> can find
<code class="docutils literal notranslate"><span class="pre">&lt;externalPkg&gt;</span></code>, then all the call to
<a class="reference internal" href="#tribits-tpl-find-include-dirs-and-libraries">tribits_tpl_find_include_dirs_and_libraries()</a> will not look for anything
and will just take the information in the variables
<code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_INCLUDE_DIRS</span></code> and <code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_LIBRARIES</span></code> and build
IMPORTED targets and the <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> target.</p>
<p>Finally, if one is upgrading an existing <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> file to
use <code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> but needs to maintain backward
compatibility for existing configure scripts for the project that might be
using the legacy TriBITS TPL system, one can use the function
<a class="reference internal" href="#tribits-tpl-allow-pre-find-package">tribits_tpl_allow_pre_find_package()</a> to determine if
<code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> can be called or if the legacy TriBITS TPL
find must be used (to maintain backward compatibility).  This
<code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(REQUIRED_HEADERS &lt;header0&gt; &lt;header1&gt; ...)
set(REQUIRED_LIBS_NAMES &lt;libname0&gt; &lt;libname1&gt; ...)

tribits_tpl_allow_pre_find_package(&lt;tplName&gt;  &lt;tplName&gt;_ALLOW_PREFIND)

if (&lt;tplName&gt;_ALLOW_PREFIND)
  message(&quot;-- Using find_package&lt;externalPkg&gt; ...) ...&quot;)
  find_package(&lt;externalPkg&gt;)
  if (&lt;externalPkg&gt;_FOUND)
    # Tell TriBITS that we found &lt;tplName&gt; and there no need to look any further
    set(TPL_&lt;tplName&gt;_INCLUDE_DIRS ${&lt;externalPkg&gt;_INCLUDE_DIRS} CACHE PATH &quot;...&quot;)
    set(TPL_&lt;tplName&gt;_LIBRARIES ${&lt;externalPkg&gt;_LIBRARIES} CACHE FILEPATH &quot;...&quot;)
    set(TPL_&lt;tplName&gt;_LIBRARY_DIRS ${&lt;externalPkg&gt;_LIBRARY_DIRS} CACHE PATH &quot;...&quot;)
  endif()
endif()

tribits_tpl_find_include_dirs_and_libraries( &lt;tplName&gt;
  REQUIRED_HEADERS ${REQUIRED_HEADERS}
  REQUIRED_LIBS_NAMES ${REQUIRED_LIBS_NAMES}
  MUST_FIND_ALL_LIBS )
</pre></div>
</div>
<p>The above will result in skipping the call of <code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code>
if any of the legacy TPL find variables are set.  But if the legacy TPL find
variables are not set, then the default find will use
<code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> and will only fall back on the legacy TriBITS
TPL find operation if <code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> sets
<code class="docutils literal notranslate"><span class="pre">&lt;externalPkg&gt;_FOUND=FALSE</span></code>.</p>
<p>With this last approach, the <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> module preserves all
of the user behavior described in <a class="reference external" href="TribitsBuildReference.html#enabling-support-for-an-optional-third-party-library-tpl">Enabling support for an optional
Third-Party Library (TPL)</a> for overriding what TPL components to look for,
where to look, and finally to override what is actually used.  That is, if the
user sets the cache variables <code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_INCLUDE_DIRS</span></code>,
<code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_LIBRARIES</span></code>, or <code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_LIBRARY_DIRS</span></code>, then they
should be used without question (which is why the <code class="docutils literal notranslate"><span class="pre">set(</span> <span class="pre">...</span> <span class="pre">CACHE</span> <span class="pre">...)</span></code>
calls in the above example do not use <code class="docutils literal notranslate"><span class="pre">FORCE</span></code>).</p>
<p>If one wants to skip and ignore the standard TriBITS TPL override variables
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_INCLUDE_DIRS</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIBRARY_NAMES</span></code>, or
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIBRARY_DIRS</span></code>, then one can set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;</span><span class="n">_FORCE_PRE_FIND_PACKAGE</span>  <span class="n">TRUE</span>  <span class="n">CACHE</span>  <span class="n">BOOL</span>
  <span class="s2">&quot;Always first call find_package(&lt;tplName&gt; ...) unless explicit override&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>at the top of the file <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> and
<code class="docutils literal notranslate"><span class="pre">tribits_tpl_allow_pre_find_package()</span></code> will ignore these variables and
return <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.  This avoids name classes with the variables
<code class="docutils literal notranslate"><span class="pre">&lt;externalPkg&gt;_INCLUDE_DIRS</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;externalPkg&gt;_LIBRARY_DIRS</span></code> with
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_INCLUDE_DIRS</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIBRARY_DIRS</span></code> (when <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span> <span class="pre">==</span>
<span class="pre">&lt;externalPkg&gt;</span></code>) which are often used in the concrete legacy CMake
<code class="docutils literal notranslate"><span class="pre">Find&lt;tplName&gt;.cmake</span></code> module files themselves.</p>
<p>For a slightly more complex (but real-life) example, see <code class="docutils literal notranslate"><span class="pre">FindTPLHDF5.cmake</span></code>
which is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>########################################################################
# See associated tribits/Copyright.txt file for copyright and license! #
########################################################################

#
# First, set up the variables for the (backward-compatible) TriBITS way of
# finding HDF5.  These are used in case find_package(HDF5 ...) is not called
# or does not find HDF5.  Also, these variables need to be non-null in order
# to trigger the right behavior in the function
# tribits_tpl_find_include_dirs_and_libraries().
#

set(REQUIRED_HEADERS hdf5.h)
set(REQUIRED_LIBS_NAMES hdf5)

if (HDF5_REQUIRE_FORTRAN)
  set(REQUIRED_LIBS_NAMES ${REQUIRED_LIBS_NAMES} hdf5_fortran)
endif()

if (TPL_ENABLE_MPI)
  set(REQUIRED_LIBS_NAMES ${REQUIRED_LIBS_NAMES} z)
endif()

if (TPL_ENABLE_Netcdf)
  set(REQUIRED_LIBS_NAMES ${REQUIRED_LIBS_NAMES} hdf5_hl)
endif()

#
# Second, search for HDF5 components (if allowed) using the standard
# find_package(HDF5 ...).
#
tribits_tpl_allow_pre_find_package(HDF5  HDF5_ALLOW_PREFIND)
if (HDF5_ALLOW_PREFIND)

  message(&quot;-- Using find_package(HDF5 ...) ...&quot;)

  set(HDF5_COMPONENTS C)
  if (HDF5_REQUIRE_FORTRAN)
    list(APPEND HDF5_COMPONENTS Fortran)
  endif()

  if (TPL_ENABLE_MPI)
    set(HDF5_PREFER_PARALLEL TRUE)
  endif()

  find_package(HDF5 COMPONENTS ${HDF5_COMPONENTS})

  # Make sure that HDF5 is parallel.
  if (TPL_ENABLE_MPI AND NOT HDF5_IS_PARALLEL)
    message(FATAL_ERROR &quot;Trilinos is configured for MPI, HDF5 is not.
    Did CMake find the correct libraries?
    Try setting HDF5_INCLUDE_DIRS and/or HDF5_LIBRARY_DIRS explicitly.
    &quot;)
  endif()

  if (HDF5_FOUND)
    # Tell TriBITS that we found HDF5 and there no need to look any further!
    set(TPL_HDF5_INCLUDE_DIRS ${HDF5_INCLUDE_DIRS} CACHE PATH
      &quot;HDF5 include dirs&quot;)
    set(TPL_HDF5_LIBRARIES ${HDF5_LIBRARIES} CACHE FILEPATH
      &quot;HDF5 libraries&quot;)
    set(TPL_HDF5_LIBRARY_DIRS ${HDF5_LIBRARY_DIRS} CACHE PATH
      &quot;HDF5 library dirs&quot;)
  endif()

endif()

#
# Third, call tribits_tpl_find_include_dirs_and_libraries()
#
tribits_tpl_find_include_dirs_and_libraries( HDF5
  REQUIRED_HEADERS ${REQUIRED_HEADERS}
  REQUIRED_LIBS_NAMES ${REQUIRED_LIBS_NAMES}
  )
# NOTE: If find_package(HDF5 ...) was called and successfully found HDF5, then
# tribits_tpl_find_include_dirs_and_libraries() will use the already-set
# variables TPL_HDF5_INCLUDE_DIRS and TPL_HDF5_LIBRARIES and then print them
# out (and set some other standard variables as well).  This is the final
# &quot;hook&quot; into the TriBITS TPL system.
</pre></div>
</div>
<p>Note that some specialized <code class="docutils literal notranslate"><span class="pre">Find&lt;externalPkg&gt;.cmake</span></code> modules do more than
just return a list of include directories and libraries.  Some, like
<code class="docutils literal notranslate"><span class="pre">FindQt4.cmake</span></code> also return other variables that are used in downstream
packages. therefore, in these cases, <code class="docutils literal notranslate"><span class="pre">find_package(Qt4</span> <span class="pre">...)</span></code> must be called
on every configure.  Such find modules cannot completely adhere to the
standard legacy TriBITS behavior described in <a class="reference external" href="TribitsBuildReference.html#enabling-support-for-an-optional-third-party-library-tpl">Enabling support for an
optional Third-Party Library (TPL)</a>.</p>
</section>
</section>
<section id="creating-a-findtpl-tplname-cmake-module-without-find-package">
<h3><a class="toc-backref" href="#id68">Creating a FindTPL&lt;tplName&gt;.cmake module without find_package()</a><a class="headerlink" href="#creating-a-findtpl-tplname-cmake-module-without-find-package" title="Permalink to this heading"></a></h3>
<p>For external packages that don’t have a <code class="docutils literal notranslate"><span class="pre">Find&lt;externalPkg&gt;.cmake</span></code> module or
<code class="docutils literal notranslate"><span class="pre">&lt;externalPkg&gt;Config.cmake</span></code> package config file, it may make sense to create
a simple <code class="docutils literal notranslate"><span class="pre">FindTpl&lt;tplName&gt;.cmake</span></code> module that just calls
<a class="reference internal" href="#tribits-tpl-find-include-dirs-and-libraries">tribits_tpl_find_include_dirs_and_libraries()</a> with the set of required
header files and libraries that must be found.  A simple
<code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> module of this form is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_tpl_find_include_dirs_and_libraries</span><span class="p">(</span> <span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;</span>
  <span class="n">REQUIRED_HEADERS</span> <span class="o">&lt;</span><span class="n">header0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">header1</span><span class="o">&gt;</span> <span class="o">...</span>
  <span class="n">REQUIRED_LIBS_NAMES</span> <span class="o">&lt;</span><span class="n">libname0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">libname1</span><span class="o">&gt;</span> <span class="o">...</span>
  <span class="n">MUST_FIND_ALL_LIBS</span>
  <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="requirements-for-findtpl-tplname-cmake-modules">
<h3><a class="toc-backref" href="#id69">Requirements for FindTPL&lt;tplName&gt;.cmake modules</a><a class="headerlink" href="#requirements-for-findtpl-tplname-cmake-modules" title="Permalink to this heading"></a></h3>
<p>It is possible to create a <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> module without using any
TriBITS functions.  The only firm requirements for a
<code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> file after it is included are:</p>
<ul class="simple">
<li><p>The target <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> must be created and it must contain all
of the needed libraries, include directories, and other usage requirements
(including for all upstream external packages/TPLs).</p></li>
<li><p>The file <code class="docutils literal notranslate"><span class="pre">&lt;buildDir&gt;/external_packages/&lt;tplName&gt;/&lt;tplName&gt;Config.cmake</span></code>
must be created in the build directory and when including the file
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;Config.cmake</span></code> it must define the equivalent target
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> (and must call <code class="docutils literal notranslate"><span class="pre">find_dependency()</span></code> correctly on
all upstream external packages/TPLs).</p></li>
</ul>
<p>Some of issues to consider in this case are described in the section <a class="reference internal" href="#tricky-considerations-for-tribits-generated-tplname-config-cmake-files">Tricky
considerations for TriBITS-generated &lt;tplName&gt;Config.cmake files</a>.</p>
</section>
</section>
<section id="how-to-add-a-new-tribits-repository">
<h2><a class="toc-backref" href="#id70"><span class="sectnum">9.5</span> How to add a new TriBITS Repository</a><a class="headerlink" href="#how-to-add-a-new-tribits-repository" title="Permalink to this heading"></a></h2>
<p>To add a new TriBITS and/ git VC repository to a TriBITS project that already
contains other extra repositories, do the following:</p>
<ol class="arabic simple">
<li><p>Add a row for the new TriBITS and/or git repo to the file
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a>.  Commit this file.</p></li>
<li><p>Add an ignore for the extra repo name to the base project’s git repo’s
<code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> file (see <a class="reference internal" href="#multi-repository-support">Multi-Repository Support</a>).  Commit this file.</p></li>
<li><p>Set up the new package dependencies for the new package in the new TriBITS
repo or make other adjustments.</p></li>
<li><p>Consider the potential for missing upstream repos and packages by using
<a class="reference internal" href="#tribits-allow-missing-external-packages">tribits_allow_missing_external_packages()</a>.</p></li>
</ol>
<p>See <a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> for more details and
links.</p>
</section>
<section id="how-to-add-a-new-tribits-se-package-dependency">
<h2><a class="toc-backref" href="#id71"><span class="sectnum">9.6</span> How to add a new TriBITS SE Package dependency</a><a class="headerlink" href="#how-to-add-a-new-tribits-se-package-dependency" title="Permalink to this heading"></a></h2>
<p>It is often the case where one will want to add a new dependency for an
existing <a class="reference internal" href="#downstream">downstream</a> package to an existing <a class="reference internal" href="#upstream">upstream</a> <a class="reference internal" href="#tribits-se-package">TriBITS SE
Package</a>.  This can either be a required dependency or an optional
dependency.  Here, we will refer to the downstream SE package as
<code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;</span></code> with base directory <code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;</span></code> and will refer to the
upstream package as <code class="docutils literal notranslate"><span class="pre">&lt;upstreamPackageName&gt;</span></code>.</p>
<p>The process for adding a new dependency to an existing upstream SE package is
as follows:</p>
<ol class="arabic">
<li><p><strong>Add the name of the upstream package to the downstream package’s
Dependencies.cmake file:</strong> Add <code class="docutils literal notranslate"><span class="pre">&lt;upstreamPackagename&gt;</span></code> to the call of
<a class="reference internal" href="#tribits-package-define-dependencies">tribits_package_define_dependencies()</a> in the downstream package’s
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> file.  If this is to be a required
library dependency, then <code class="docutils literal notranslate"><span class="pre">&lt;upstreamPackagename&gt;</span></code> is added to the
<code class="docutils literal notranslate"><span class="pre">LIB_REQUIRED_PACKAGES</span></code> argument.  Alternatively, if this is to be an
optional library dependency, then <code class="docutils literal notranslate"><span class="pre">&lt;upstreamPackagename&gt;</span></code> is added to the
<code class="docutils literal notranslate"><span class="pre">LIB_OPTIONAL_PACKAGES</span></code> argument.  (For example, see the file
<code class="docutils literal notranslate"><span class="pre">packages/EpetaExt/cmake/Dependencies.cmake</span></code> file in the
<a class="reference internal" href="#reducedmocktrilinos">ReducedMockTrilinos</a> project.)  If only the test and/or example sources,
and not the package’s core library sources, will have the required or
optional dependency, then <code class="docutils literal notranslate"><span class="pre">&lt;upstreamPackagename&gt;</span></code> is added to the
arguments <code class="docutils literal notranslate"><span class="pre">TEST_REQUIRED_PACKAGES</span></code> or <code class="docutils literal notranslate"><span class="pre">TEST_OPTIONAL_PACKAGES</span></code>,
respectively.</p></li>
<li><p><strong>For an optional dependency, add `HAVE_` preprocessor macro to the
package’s configured header file:</strong> If this is an optional dependency,
typically a C/C++ processor macro will be added to the package’s configured
<a class="reference internal" href="#packagedir-cmake-packagename-config-h-in">&lt;packageDir&gt;/cmake/&lt;packageName&gt;_config.h.in</a> file using the line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#cmakedefine HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;OPTIONAL_DEP_PACKAGE_NAME_UC&gt;</span>
</pre></div>
</div>
<p>(see <a class="reference internal" href="#have-package-name-uc-optional-dep-package-name-uc">HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;OPTIONAL_DEP_PACKAGE_NAME_UC&gt;</a>.)</p>
<p id="warning-do-not-add-optional-defines-for-tests-examples-to-configured-header-files"><strong>Warning, do not add optional defines for tests/examples to configured
header files:</strong> If this is a test-only and/or example-only dependency then
please do <strong>not</strong> add a <code class="docutils literal notranslate"><span class="pre">#cmakedefine</span></code> to the package’s core
<a class="reference internal" href="#packagedir-cmake-packagename-config-h-in">&lt;packageDir&gt;/cmake/&lt;packageName&gt;_config.h.in</a> file.  Instead, add the
<code class="docutils literal notranslate"><span class="pre">#cmakedefine</span></code> line to a configured header that is only included by
sources for the tests/examples or just add a define on the compiler command
line (see the <code class="docutils literal notranslate"><span class="pre">DEFINES</span></code> argument to <a class="reference internal" href="#tribits-add-library">tribits_add_library()</a> and
<a class="reference internal" href="#tribits-add-executable">tribits_add_executable()</a>, but see the warning about problems with
<code class="docutils literal notranslate"><span class="pre">add_definitions()</span></code> in <a class="reference internal" href="#miscellaneous-notes-tribits-add-library">Miscellaneous Notes (tribits_add_library())</a>).
We don’t want the package’s header files to change or libraries to have to
be rebuilt if tests/examples get enabled or disabled.  Otherwise, the
<a class="reference internal" href="#tribits-ctest-cdash-driver">TriBITS CTest/CDash Driver</a> process will result in unnecessary rebuilds
of software over and over again.</p>
</li>
<li><p><strong>Use the features of the upstream package in the source files of the
downstream package sources and/or tests/examples:</strong> Usage of the features
of the upstream package <code class="docutils literal notranslate"><span class="pre">&lt;upstreamPackageName&gt;</span></code> in the downstream package
<code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;</span></code> will typically involve adding <code class="docutils literal notranslate"><span class="pre">#include</span>
<span class="pre">&lt;upstreamPackageName&gt;_&lt;fileName&gt;</span></code> in the package’s C/C++ source (or
test/example) files (or the equivalent in Fortran).  If it is an optional
dependency, then these includes will typically be protected using
preprocessor ifdefs, for example, as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &quot;&lt;packageName&gt;_config.h&quot;</span>

<span class="c1">#if HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;OPTIONAL_DEP_PACKAGE_NAME_UC&gt;</span>
<span class="c1">#  include &quot;&lt;upstreamPackageName&gt;_&lt;fileName&gt;&quot;</span>
<span class="c1">#endif</span>
</pre></div>
</div>
</li>
<li><p><strong>For an optional dependency, use CMake if() statements based on
${PACKAGE_NAME}_ENABLE_${OPTIONAL_DEP_PACKAGE_NAME}:</strong> When a package
<code class="docutils literal notranslate"><span class="pre">PACKAGE_NAME</span></code> has an optional dependency on an upstream package
<code class="docutils literal notranslate"><span class="pre">OPTIONAL_DEP_PACKAGE_NAME</span></code> and needs to put in optional logic in a
CMakeLists.txt file, then the if() statements should use the variable
<a class="reference internal" href="#package-name-enable-optional-dep-package-name">${PACKAGE_NAME}_ENABLE_${OPTIONAL_DEP_PACKAGE_NAME}</a> and <strong>not</strong> the
variable <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_${OPTIONAL_DEP_PACKAGE_NAME}</span></code>.  For
example, to optionally enable a test that depends on the enable of the
optional upstream dep package, one would use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>if (${PACKAGE_NAME}_ENABLE_${OPTIONAL_DEP_PACKAGE_NAME})
  tribits_add_test( ... )
endif()
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div></div></blockquote>
<p>NOTE: TriBITS will automatically add the include directories for the upstream
package to the compile lines for the downstream package source builds and will
add the libraries for the upstream package to the link lines to the downstream
package library and executable links.  See documentation in the functions
<a class="reference internal" href="#tribits-add-library">tribits_add_library()</a> and <a class="reference internal" href="#tribits-add-executable">tribits_add_executable()</a>, and the <code class="docutils literal notranslate"><span class="pre">DEPLIBS</span></code>
argument to these functions, for more details.</p>
</section>
<section id="how-to-add-a-new-tribits-tpl-dependency">
<h2><a class="toc-backref" href="#id72"><span class="sectnum">9.7</span> How to add a new TriBITS TPL dependency</a><a class="headerlink" href="#how-to-add-a-new-tribits-tpl-dependency" title="Permalink to this heading"></a></h2>
<p>It is often the case where one will want to add a new dependency for an
existing <a class="reference internal" href="#downstream">downstream</a> package to an existing <a class="reference internal" href="#upstream">upstream</a> <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>.
This can either be a required dependency or an optional dependency.  Here, we
will refer to the downstream SE package as <code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;</span></code> with base
directory <code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;</span></code> and will refer to the upstream TPL as
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code>.</p>
<p>The process for adding a new dependency to an existing upstream TPL is as
follows:</p>
<ol class="arabic">
<li><p><strong>Add the name of the upstream TPL to the downstream package’s
Dependencies.cmake file:</strong> Add <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code> to the call of
<a class="reference internal" href="#tribits-package-define-dependencies">tribits_package_define_dependencies()</a> in the downstream package’s
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> file.  If this is to be a required
library dependency, then <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code> is added to the
<code class="docutils literal notranslate"><span class="pre">LIB_REQUIRED_TPLs</span></code> argument.  Alternatively, if this is to be an
optional library dependency, then <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code> is added to the
<code class="docutils literal notranslate"><span class="pre">LIB_OPTIONAL_TPL</span></code> argument.  (For example, see the file
<code class="docutils literal notranslate"><span class="pre">packages/Teuchos/cmake/Dependencies.cmake</span></code> file in the
<a class="reference internal" href="#reducedmocktrilinos">ReducedMockTrilinos</a> project.)  If only the test and/or example sources,
and not the package’s core library sources, will have the required or
optional dependency, then <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code> is added to the arguments
<code class="docutils literal notranslate"><span class="pre">TEST_REQUIRED_TPLs</span></code> or <code class="docutils literal notranslate"><span class="pre">TEST_OPTIONAL_TPLS</span></code>, respectively.</p></li>
<li><p><strong>For an optional dependency, add `HAVE_` preprocessor macro to the
package’s configured header file:</strong> If this is an optional dependency,
typically a C/C++ processor macro will be added to the package’s configured
<a class="reference internal" href="#packagedir-cmake-packagename-config-h-in">&lt;packageDir&gt;/cmake/&lt;packageName&gt;_config.h.in</a> file using the line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#cmakedefine HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;OPTIONAL_DEP_TPL_NAME_UC&gt;</span>
</pre></div>
</div>
<p>(see <a class="reference internal" href="#have-package-name-uc-optional-dep-tpl-name-uc">HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;OPTIONAL_DEP_TPL_NAME_UC&gt;</a>.)</p>
<p><strong>WARNING:</strong> If this is a test-only and/or example-only dependency then
please do <strong>not</strong> add a <code class="docutils literal notranslate"><span class="pre">#cmakedefine</span></code> to the package’s core
<a class="reference internal" href="#packagedir-cmake-packagename-config-h-in">&lt;packageDir&gt;/cmake/&lt;packageName&gt;_config.h.in</a> file.  See <a class="reference internal" href="#warning-do-not-add-optional-defines-for-tests-examples-to-configured-header-files">Warning, do not
add optional defines for tests/examples to configured header files</a>.</p>
</li>
<li><p><strong>Use the features of the upstream TPL in the source files of the
downstream package sources and/or tests/examples:</strong> Usage of the features
of the upstream package <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code> in the downstream package
<code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;</span></code> will typically involve adding <code class="docutils literal notranslate"><span class="pre">#include</span>
<span class="pre">&lt;tplName&gt;_&lt;fileName&gt;</span></code> in the package’s C/C++ source (or test/example)
files (or the equivalent in Fortran).  If it is an optional dependency,
then these includes will typically be protected using preprocessor ifdefs,
for example, as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &quot;&lt;packageName&gt;_config.h&quot;</span>

<span class="c1">#if HAVE_&lt;PACKAGE_NAME_UC&gt;_&lt;OPTIONAL_DEP_TPL_NAME_UC&gt;</span>
<span class="c1">#  include &quot;&lt;upstreamPackageName&gt;_&lt;fileName&gt;&quot;</span>
<span class="c1">#endif</span>
</pre></div>
</div>
</li>
<li><p><strong>For an optional dependency, use CMake if() statements based on
${PACKAGE_NAME}_ENABLE_${OPTIONAL_DEP_TPL_NAME}:</strong> When a package
<code class="docutils literal notranslate"><span class="pre">PACKAGE_NAME</span></code> has an optional dependency on TPL
<code class="docutils literal notranslate"><span class="pre">OPTIONAL_DEP_TPL_NAME</span></code> and needs to put in optional logic in a
CMakeLists.txt file, then the if() statements should use the variable
<a class="reference internal" href="#package-name-enable-optional-dep-tpl-name">${PACKAGE_NAME}_ENABLE_${OPTIONAL_DEP_TPL_NAME}</a> and <strong>not</strong> the variable
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_${OPTIONAL_DEP_TPL_NAME}</span></code>.  For example, to
optionally enable a test that depends on the enable of the optional TPL,
one would use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>if (${PACKAGE_NAME}_ENABLE_${OPTIONAL_DEP_TPL_NAME})
  tribits_add_test( ... )
endif()
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div></div></blockquote>
<p>NOTE: TriBITS will automatically add the include directories for the upstream
TPL to the compile lines for the downstream package source builds and will add
the libraries for the upstream TPL to the link lines to the downstream package
library and executable links.  See documentation in the functions
<a class="reference internal" href="#tribits-add-library">tribits_add_library()</a> and <a class="reference internal" href="#tribits-add-executable">tribits_add_executable()</a>, and the <code class="docutils literal notranslate"><span class="pre">DEPLIBS</span></code>
argument to these functions, for more details.</p>
</section>
<section id="how-to-tentatively-enable-a-tpl">
<h2><a class="toc-backref" href="#id73"><span class="sectnum">9.8</span> How to tentatively enable a TPL</a><a class="headerlink" href="#how-to-tentatively-enable-a-tpl" title="Permalink to this heading"></a></h2>
<p>A TriBITS package can request the tentative enable of any of its optional TPLs
(see <a class="reference internal" href="#how-to-add-a-new-tribits-tpl-dependency">How to add a new TriBITS TPL dependency</a>).  This is done by calling
<a class="reference internal" href="#tribits-tpl-tentatively-enable">tribits_tpl_tentatively_enable()</a> in the SE package’s
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> file.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_package_define_dependencies</span><span class="p">(</span>
  <span class="o">...</span>
  <span class="n">LIB_OPTIONAL_TPLS</span>  <span class="n">SomeTpl</span>
  <span class="o">...</span>
  <span class="p">)</span>

<span class="n">tribits_tpl_tentatively_enable</span><span class="p">(</span><span class="n">SomeTpl</span><span class="p">)</span>
</pre></div>
</div>
<p>This will result is an attempt to find the components for the TPL <code class="docutils literal notranslate"><span class="pre">SomeTpl</span></code>.
But if that attempt fails, then the TPL will be disabled and
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_ENABLE_SomeTpl</span></code> will be set to <code class="docutils literal notranslate"><span class="pre">OFF</span></code>.</p>
</section>
<section id="how-to-insert-a-package-into-an-upstream-repo">
<h2><a class="toc-backref" href="#id74"><span class="sectnum">9.9</span> How to insert a package into an upstream repo</a><a class="headerlink" href="#how-to-insert-a-package-into-an-upstream-repo" title="Permalink to this heading"></a></h2>
<p>Sometimes it is desired to insert a package from a downstream VC repo into an
upstream <a class="reference internal" href="#tribits-repository">TriBITS Repository</a> in order for one or more packages in the
upstream repo to define a dependency on that package.  The way this is
supported in TriBITS is to just list the inserted package into the
<code class="docutils literal notranslate"><span class="pre">PackagesList.cmake</span></code> file of the upstream TriBITS repo after the packages it
depends on and before the packages that will use it then call the
<a class="reference internal" href="#tribits-allow-missing-external-packages">tribits_allow_missing_external_packages()</a> function to allow the package to
be missing.  This is demonstrated in <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a> with the package
<code class="docutils literal notranslate"><span class="pre">InsertedPkg</span></code> which is <strong>not</strong> included in the default
<code class="docutils literal notranslate"><span class="pre">TribitsExampleProject</span></code> source tree.  The
<a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>/<code class="docutils literal notranslate"><span class="pre">PackagesList.cmake</span></code> file looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_repository_define_packages</span><span class="p">(</span>
  <span class="n">SimpleCxx</span>          <span class="n">packages</span><span class="o">/</span><span class="n">simple_cxx</span>         <span class="n">PT</span>
  <span class="n">MixedLang</span>          <span class="n">packages</span><span class="o">/</span><span class="n">mixed_lang</span>         <span class="n">PT</span>
  <span class="n">InsertedPkg</span>        <span class="n">InsertedPkg</span>                 <span class="n">ST</span>
  <span class="n">WithSubpackages</span>    <span class="n">packages</span><span class="o">/</span><span class="n">with_subpackages</span>   <span class="n">PT</span>
  <span class="n">WrapExternal</span>       <span class="n">packages</span><span class="o">/</span><span class="n">wrap_external</span>      <span class="n">ST</span>
  <span class="p">)</span>

<span class="n">tribits_disable_package_on_platforms</span><span class="p">(</span><span class="n">WrapExternal</span> <span class="n">Windows</span><span class="p">)</span>
<span class="n">tribits_allow_missing_external_packages</span><span class="p">(</span><span class="n">InsertedPkg</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">InsertedPkg</span></code> has a required dependency on <code class="docutils literal notranslate"><span class="pre">SimpleCxx</span></code>
and the SE package <code class="docutils literal notranslate"><span class="pre">WithSubpackagesB</span></code> has an optional dependency on
<code class="docutils literal notranslate"><span class="pre">InsertedPkg</span></code>.  Therefore, the inserted package <code class="docutils literal notranslate"><span class="pre">InsertedPkg</span></code> has upstream
and downstream dependencies on packages in the <code class="docutils literal notranslate"><span class="pre">TribitsExampleProject</span></code> repo.</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">tribits_allow_missing_external_packages()</span></code> tells TriBITS to
treat <code class="docutils literal notranslate"><span class="pre">InsertedPkg</span></code> the same as any other package if the directory
<code class="docutils literal notranslate"><span class="pre">TribitsExampleProject/InsertedPkg</span></code> exists or to completely ignore the
package <code class="docutils literal notranslate"><span class="pre">InsertedPkg</span></code> otherwise.  In addition, TriBITS will automatically
disable of all downstream package dependencies for the missing package (and
print a note about the disables).  NOTE: By default TriBITS will silently
ignore missing inserted packages and disable optional support for the missing
package.  To see what packages are missing and being ignored, configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_WARN_ABOUT_MISSING_EXTERNAL_PACKAGES</span><span class="o">=</span><span class="n">TRUE</span>
</pre></div>
</div>
<p>The way one would set up <code class="docutils literal notranslate"><span class="pre">TribitsExampleProject</span></code> to enable <code class="docutils literal notranslate"><span class="pre">InsertedPkg</span></code>,
if these were in separate VC (e.g. git) repos for example, would be to do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone &lt;some-url-base&gt;/TribitsExampleProject
$ cd TribitsExampleProject
$ git clone &lt;some-other-url-base&gt;/ExteranlPkg
$ echo /InsertedPkg/ &gt;&gt; .git/info/excludes
</pre></div>
</div>
<p>Then, when you configure <code class="docutils literal notranslate"><span class="pre">TribitsExampleProject</span></code>, the package
<code class="docutils literal notranslate"><span class="pre">InsertedPkg</span></code> would automatically appear and could then be enabled or
disabled like any other TriBITS package.  The TriBITS test
<code class="docutils literal notranslate"><span class="pre">Tribits_TribitsExampleProject_InsertedPkg</span></code> demonstrates this.</p>
<p>Assuming that one would put the (new) external package in a separate VC repo,
one would perform the following steps:</p>
<ol class="arabic simple">
<li><p>Pick a name for the new inserted external package <code class="docutils literal notranslate"><span class="pre">&lt;insertedPackageName&gt;</span></code>
(see <a class="reference internal" href="#globally-unique-tribits-package-names">Globally unique TriBITS package names</a>).  (NOTE: The external
package may already exist in which case the name would already be
selected).</p></li>
<li><p>Create a new VC repo containing the new package <code class="docutils literal notranslate"><span class="pre">&lt;insertedPackageName&gt;</span></code>
or add it to an existing extra VC repo. (Or, add the new package to an
existing downstream repo but don’t add it to the <code class="docutils literal notranslate"><span class="pre">PackagesList.cmake</span></code>
file to downstream repo.  That would define the package twice!)</p></li>
<li><p>Clone the downstream VC repo under the upstream TriBITS repository.  (This
is currently needed since TriBITS only allows package dirs to be contained
under the repository directory.)</p></li>
<li><p>Insert the package into the <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> file as
described in <a class="reference internal" href="#how-to-add-a-new-tribits-package">How to add a new TriBITS Package</a> except one must also call
<code class="docutils literal notranslate"><span class="pre">tribits_allow_missing_external_packages(&lt;insertedPackageName&gt;)</span></code> as
described above.</p></li>
<li><p>Flesh out the new package and use it in downstream SE packages just like it
was any other package.  But note that any downstream SE package that has a
required dependency on <code class="docutils literal notranslate"><span class="pre">&lt;insertedPackageName&gt;</span></code> will always be hard
disabled when the source for <code class="docutils literal notranslate"><span class="pre">&lt;insertedPackageName&gt;</span></code> is missing.</p></li>
<li><p>When configuring and building to get the package working, add
<code class="docutils literal notranslate"><span class="pre">-D&lt;insertedPackageName&gt;_ALLOW_MISSING_EXTERNAL_PACKAGE=FALSE</span></code> so that
TriBITS will catch mistakes in specifying the package directory.
Otherwise, to see notes about ignoring missing inserted/external packages,
set the variable <code class="docutils literal notranslate"><span class="pre">-D&lt;Project&gt;_WARN_ABOUT_MISSING_EXTERNAL_PACKAGES=TRUE</span></code>
and TriBITS will print warnings about missing external packages.</p></li>
</ol>
</section>
<section id="how-to-put-a-tribits-and-raw-cmake-build-system-side-by-side">
<h2><a class="toc-backref" href="#id75"><span class="sectnum">9.10</span> How to put a TriBITS and raw CMake build system side-by-side</a><a class="headerlink" href="#how-to-put-a-tribits-and-raw-cmake-build-system-side-by-side" title="Permalink to this heading"></a></h2>
<p>There are cases where it is advantageous to have a raw CMake build system and
a TriBITS CMake build system sit side-by-side in a CMake project.  There are
various ways to accomplish this but a very simple way that has minimal impact
on the raw CMake build system is described here.  An example of how to
accomplish this is shown in the example project <code class="docutils literal notranslate"><span class="pre">RawAndTribitsHelloWorld</span></code>.
This CMake project is a copy of the <a class="reference internal" href="#tribitshelloworld">TribitsHelloWorld</a> project that puts a
primary default raw CMake build system side-by-side with a secondary TriBITS
CMake build system.  The key aspects of this basic approach shown in this
example are:</p>
<ol class="arabic simple">
<li><p>An <code class="docutils literal notranslate"><span class="pre">if()</span></code> statement must be added to the base project <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>
file to switch between the two build systems.  (This is required since the
raw CMake commands <code class="docutils literal notranslate"><span class="pre">cmake_minimum_required()</span></code> and <code class="docutils literal notranslate"><span class="pre">project()</span></code> must
exist in the base <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file and not in and included
<code class="docutils literal notranslate"><span class="pre">*.cmake</span></code> file.)  The switch trigger in the <code class="docutils literal notranslate"><span class="pre">if()</span></code> statement can be any
logic desired, but a simple way is to look for the
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TRIBITS_DIR</span></code> cache variable being set.</p></li>
<li><p>The TriBITS build system in every subdirectory is contained in files of the
name <code class="docutils literal notranslate"><span class="pre">CMakeLists.tribits.cmake</span></code> beside the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> files for
the raw CMake build system.  (The file <code class="docutils literal notranslate"><span class="pre">CMakeLists.tribits.cmake</span></code> ends
with a <code class="docutils literal notranslate"><span class="pre">*.cmake</span></code> extension so that source editors pick it up as a CMake
file.)</p></li>
<li><p>At the top of every raw CMake build system <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file is a
call to a simple macro <code class="docutils literal notranslate"><span class="pre">include_tribits_build()</span></code> which includes the
<code class="docutils literal notranslate"><span class="pre">CMakeLists.tribits.cmake</span></code> file and then returns if doing a TriBITS build
and otherwise does nothing for a raw CMake build.</p></li>
</ol>
<p>The top file <code class="docutils literal notranslate"><span class="pre">RawAndTribitsHelloWorld/CMakeLists.txt</span></code> file demonstrates the
basic approach:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cmake_minimum_required(VERSION 3.17.0 FATAL_ERROR)
include(${CMAKE_CURRENT_SOURCE_DIR}/ProjectName.cmake)

# Called at the top of every CMakeLists.txt file
macro(include_tribits_build)
  if (${PROJECT_NAME}_TRIBITS_DIR)
    include(&quot;${CMAKE_CURRENT_SOURCE_DIR}/CMakeLists.tribits.cmake&quot;)
    return()
  endif()
endmacro()

if (${PROJECT_NAME}_TRIBITS_DIR)

  # TriBITS CMake project
  project(${PROJECT_NAME} NONE)
  include(&quot;${${PROJECT_NAME}_TRIBITS_DIR}/TriBITS.cmake&quot;)
  # Only one package in this simple project so just enable it :-)
  set(${PROJECT_NAME}_ENABLE_HelloWorld ON CACHE BOOL &quot;&quot; FORCE)
  tribits_project()

else()

  # Raw CMake project
  project(RawHelloWorld)
  enable_testing()
  add_subdirectory(hello_world)

endif()

# NOTE: The cmake_minimum_required() and project() commands must be executed
# in the base CMakeLists.txt file and *NOT* in an included 
</pre></div>
</div>
<p>Then every raw <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file starts with the command
<code class="docutils literal notranslate"><span class="pre">include_tribits_build()</span></code> at the very top as shown in the example file
<code class="docutils literal notranslate"><span class="pre">RawAndTribitsHelloWorld/hello_world/CMakeLists.txt</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>include_tribits_build()

# Build and install library
set(HEADERS hello_world_lib.hpp)
set(SOURCES hello_world_lib.cpp)
add_library(hello_world_lib ${SOURCES})
install(TARGETS hello_world_lib DESTINATION lib)
install(FILES ${HEADERS} DESTINATION include)

# Build and install user executable
add_executable(hello_world hello_world_main.cpp)
target_link_libraries(hello_world hello_world_lib)
install(TARGETS hello_world DESTINATION bin)

# Test the executable
add_test(test ${CMAKE_CURRENT_BINARY_DIR}/hello_world)
set_tests_properties(test PROPERTIES PASS_REGULAR_EXPRESSION &quot;Hello World&quot;)

# Build and run some unit tests  
add_executable(unit_tests hello_world_unit_tests.cpp)
target_link_libraries(unit_tests hello_world_lib)
add_test(unit_test ${CMAKE_CURRENT_BINARY_DIR}/unit_tests)
set_tests_properties(unit_test
  PROPERTIES PASS_REGULAR_EXPRESSION &quot;All unit tests passed&quot;)
</pre></div>
</div>
<p>To configure the project as a raw CMake project, just configure it as with any
raw CMake project as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">some_base_dir</span><span class="o">&gt;/</span><span class="n">RawAndTribitsHelloWorld</span>
</pre></div>
</div>
<p>To configure it as a TriBITS project, just set the cache var
<code class="docutils literal notranslate"><span class="pre">RawAndTribitsHelloWorld_TRIBITS_DIR</span></code> to point to valid TriBITS source tree
as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span> \
  <span class="o">-</span><span class="n">DRawAndTribitsHelloWorld_TRIBITS_DIR</span><span class="o">=&lt;</span><span class="n">tribits_dir</span><span class="o">&gt;</span> \
   <span class="o">&lt;</span><span class="n">some_base_dir</span><span class="o">&gt;/</span><span class="n">RawAndTribitsHelloWorld</span>
</pre></div>
</div>
<p>A twist on this use case is for a package that only builds as a TriBITS
package inside of some larger TriBITS project and not as its own TriBITS CMake
project.  In this case, some slight changes are needed to this example but the
basic approach is nearly identical.  One still needs an <code class="docutils literal notranslate"><span class="pre">if()</span></code> statement at
the top of the first <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file (this time for the package) and
the macro <code class="docutils literal notranslate"><span class="pre">include_tribits_build()</span></code> needs to be defined at the top of that
file as well.  Then every <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file in subdirectories just calls
<code class="docutils literal notranslate"><span class="pre">include_tribits_build()</span></code>.  That is it.</p>
</section>
<section id="how-to-check-for-and-tweak-tribits-enable-cache-variables">
<h2><a class="toc-backref" href="#id76"><span class="sectnum">9.11</span> How to check for and tweak TriBITS “ENABLE” cache variables</a><a class="headerlink" href="#how-to-check-for-and-tweak-tribits-enable-cache-variables" title="Permalink to this heading"></a></h2>
<p>TriBITS defines a number of special <code class="docutils literal notranslate"><span class="pre">&lt;XXX&gt;_ENABLE_&lt;YYY&gt;</span></code> variables for
enabling/disabling various entities that allow for a default “undefined” empty
<code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> enable status.  Examples of these special variables include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_&lt;TRIBITS_PACKAGE&gt;</span></code> ((SE) packages)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_&lt;tplName&gt;</span></code> (TPLs)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;_ENABLE_&lt;TRIBITS_DEP_PACKAGE_OR_TPL&gt;</span></code> (Optional support
for a (SE) package or TPL in a downstream package)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;_ENABLE_TESTS</span></code> (Package tests)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;TRIBITS_PACKAGE&gt;_ENABLE_EXAMPLES</span></code> (Package examples)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_TESTS</span></code> (Tests for explicitly enabled packages)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_EXAMPLES</span></code> (Examples for explicitly enabled
packages)</p></li>
</ul>
<p>(see <a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency Handling Behaviors</a>).</p>
<p>To check for and tweak these special “ENABLE” variables, perform the
following:</p>
<ol class="arabic">
<li><p>To check to see if an <code class="docutils literal notranslate"><span class="pre">ENABLE</span></code> variable has been enabled or disabled
(either explicitly or through auto enable/disable logic), use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="s2">&quot;${&lt;XXX&gt;_ENABLE_&lt;YYY&gt;}&quot;</span> <span class="n">STREQUAL</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
  <span class="c1"># Variable has not been set to &#39;ON&#39; or &#39;OFF&#39; yet</span>
  <span class="o">...</span>
<span class="n">endif</span><span class="p">()</span>
</pre></div>
</div>
<p>This will work correctly independent of if the cache variable has been
default defined or not.</p>
</li>
<li><p>To tweak the enable/disable of one or more of these variables after user
input but before auto-enable/disable logic:</p></li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li><p>To tweak the enables/disables for a TriBITS Repository (i.e. affecting
all TriBITS projects) add enable/disable code to the file
<a class="reference internal" href="#repodir-cmake-repositorydependenciessetup-cmake">&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</a>.</p></li>
<li><p>To tweak the enables/disables for a specific TriBITS Project
(i.e. affecting only that TriBITS project) add enable/disable code to the
file <a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a>.</p></li>
</ol>
<p>For example, one might default disable a package if it has not been
explicitly enabled (or disabled) in one of these files using logic like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>if (NOT ${PROJECT_NAME}_ENABLE_Fortran)
  if (&quot;${${PROJECT_NAME}_ENABLE_&lt;SomeFortranPackage&gt;}&quot; STREQUAL &quot;&quot;)
    message(&quot;-- &quot; &quot;NOTE: Setting ${PROJECT_NAME}_ENABLE_&lt;SomeFortranPackage&gt;=OFF because&quot;
      &quot;${PROJECT_NAME}_ENABLE_Fortran = &#39;${${PROJECT_NAME}_ENABLE_Fortran}&#39;&quot;)
    set(${PROJECT_NAME}_ENABLE_&lt;SomeFortranPackage&gt; OFF)
  endif()
endif()
</pre></div>
</div>
</div></blockquote>
<p>In order to understand the above steps for properly querying and tweaking
these <code class="docutils literal notranslate"><span class="pre">ENABLE</span></code> variables, one must understand how TriBITS CMake code defines
and interprets variables of this type.</p>
<p>First, note that most of these particular <code class="docutils literal notranslate"><span class="pre">ENABLE</span></code> variables are not
<code class="docutils literal notranslate"><span class="pre">BOOL</span></code> cache variables but are actually <code class="docutils literal notranslate"><span class="pre">STRING</span></code> variables with the
possible values of <code class="docutils literal notranslate"><span class="pre">ON</span></code>, <code class="docutils literal notranslate"><span class="pre">OFF</span></code> and empty <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> (see the macro
<a class="reference internal" href="#set-cache-on-off-empty">set_cache_on_off_empty()</a>).  Therefore, just because the value of a
<code class="docutils literal notranslate"><span class="pre">&lt;XXX&gt;_ENABLE_&lt;YYY&gt;</span></code> variable is defined (e.g. <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(DEFINED</span>
<span class="pre">&lt;XXX&gt;_ENABLE_&lt;YYY&gt;)</span> <span class="pre">...</span> <span class="pre">endif()</span></code>) does not mean that it has been set to
<code class="docutils literal notranslate"><span class="pre">ON</span></code> or <code class="docutils literal notranslate"><span class="pre">OFF</span></code> yet (or any non-empty values that evaluates to true or false
in CMake).  To see if an <code class="docutils literal notranslate"><span class="pre">ENABLE</span></code> variable is one of these variables, look
in the CMakeCache.txt file for the type.  If the type is <code class="docutils literal notranslate"><span class="pre">STRING</span></code>, then it
is most likely this type of variable with a default value of empty <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.
However, if the cache type is <code class="docutils literal notranslate"><span class="pre">BOOL</span></code> then it is likely a standard bool
variable that is not allowed to have a value of empty <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.</p>
<p>Second, note that the value of empty <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> evaluates to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> in CMake
<code class="docutils literal notranslate"><span class="pre">if()</span></code> statements.  Therefore, if one just wants to know if one of these
variables evaluates to true, then just use <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">(&lt;XXX&gt;_ENABLE_&lt;YYY&gt;)</span>
<span class="pre">...</span> <span class="pre">endif()</span></code>.</p>
<p>Third, note that TriBITS will not define these cache variables until TriBITS
processes the <code class="docutils literal notranslate"><span class="pre">Dependencies.cmake</span></code> files on the first configure (see <a class="reference internal" href="#full-tribits-project-configuration">Full
TriBITS Project Configuration</a>).  On future reconfigures, these variables are
all defined (but most will have a default value of empty <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> stored in the
cache).</p>
<p>The reason the files <code class="docutils literal notranslate"><span class="pre">RepositoryDependenciesSetup.cmake</span></code> and
<code class="docutils literal notranslate"><span class="pre">ProjectDependenciesSetup.cmake</span></code> are the best places to put in these tweaks
is because, as shown in <a class="reference internal" href="#full-processing-of-tribits-project-files">Full Processing of TriBITS Project Files</a>, they get
processed after all of the user input has been read (in CMake cache variables
set with <code class="docutils literal notranslate"><span class="pre">-D&lt;variable&gt;=&lt;value&gt;</span></code> and read in from
<a class="reference external" href="TribitsBuildReference.html#project-configure-options-file">${PROJECT_NAME}_CONFIGURE_OPTIONS_FILE</a> files) but before TriBITS adjusts
the SE package and TPLs enables and disables (see <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package Dependencies and
Enable/Disable Logic</a>).  Also, these files get processed in <a class="reference internal" href="#reduced-package-dependency-processing">Reduced Package
Dependency Processing</a> as well so they get processed in all contexts where
enable/disable logic is applied.</p>
</section>
<section id="how-to-tweak-downstream-tribits-enable-variables-during-package-configuration">
<h2><a class="toc-backref" href="#id77"><span class="sectnum">9.12</span> How to tweak downstream TriBITS “ENABLE” variables during package configuration</a><a class="headerlink" href="#how-to-tweak-downstream-tribits-enable-variables-during-package-configuration" title="Permalink to this heading"></a></h2>
<p>There are cases where one may need to enable or disable some feature that
TriBITS may have enabled by default (such as in “Adjust SE package and TPLs
enables and disables” in <a class="reference internal" href="#full-processing-of-tribits-project-files">Full Processing of TriBITS Project Files</a>) and that
decision can only be made while processing a package’s
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file. (And therefore the logic for this disable
cannot be performed in the <code class="docutils literal notranslate"><span class="pre">ProjectDependenciesSetup.cmake</span></code> or
<code class="docutils literal notranslate"><span class="pre">RepositoryDependenciesSetup.cmake</span></code> files as described in <a class="reference internal" href="#how-to-check-for-and-tweak-tribits-enable-cache-variables">How to check for
and tweak TriBITS “ENABLE” cache variables</a> which are processed before the
enabled packages are configured.)  Also, there are cases where it is necessary
to make this change visible to downstream packages such as when
<code class="docutils literal notranslate"><span class="pre">&lt;DownstreamPackageB&gt;</span></code> support of some feature depends on
<code class="docutils literal notranslate"><span class="pre">&lt;DownstreamPackageA&gt;</span></code> support for that same feature.  Examples include
optional support of an upstream package in a downstream package
<code class="docutils literal notranslate"><span class="pre">&lt;DownstreamPackage&gt;_ENABLE_&lt;UpstreamPackage&gt;</span></code> or for support for an
optional TPL in a downstream package <code class="docutils literal notranslate"><span class="pre">&lt;DownstreamPackage&gt;_ENABLE_&lt;TPL&gt;</span></code>.
But other examples may include variables that are not optional TriBITS package
and TPL enables (such as support for a given data-type that may impact
multiple packages).</p>
<p>When the internal configuration of a package (i.e. while processing its
<code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;/CMakeLists.txt</span></code> file) determines that an optional feature
<code class="docutils literal notranslate"><span class="pre">&lt;XXX&gt;_ENABLE_&lt;YYY&gt;</span></code> must be enabled or disabled with and will change the
value previously set (e.g. during the “Adjust SE package and TPLs enables and
disables” stage), one cannot use a simple <code class="docutils literal notranslate"><span class="pre">set()</span></code> statement.  Changing the
value of an <code class="docutils literal notranslate"><span class="pre">&lt;XXX&gt;_ENABLE_&lt;YYY&gt;</span></code> variable inside a package’s
<code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;/CMakeLists.txt</span></code> file using a raw <code class="docutils literal notranslate"><span class="pre">set(&lt;XXX&gt;_ENABLE_&lt;YYY&gt;</span>
<span class="pre">&lt;newValue&gt;)</span></code> statement only changes the variable’s value inside the package’s
scope, but all other packages will see the old value of
<code class="docutils literal notranslate"><span class="pre">&lt;XXX&gt;_ENABLE_&lt;YYY&gt;</span></code>.  To correctly change the value of one of these
variables, instead use <a class="reference internal" href="#dual-scope-set">dual_scope_set()</a> from the top-level
<code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;/CMakeLists.txt</span></code> file.  This sets the value in both the
base-level (global) project scope and in the local scope of
<code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;/CMakeLists.txt</span></code>.  (But this does <strong>not</strong> change the value of a
cache variable <code class="docutils literal notranslate"><span class="pre">&lt;XXX&gt;_ENABLE_&lt;YYY&gt;</span></code> that may have been set by the user or
some other means; see <a class="reference internal" href="#tribits-auto-enables-disables-done-using-non-cache-local-variables">TriBITS auto-enables/disables done using non-cache
local variables</a>.)  Any downstream package (configured after processing
<code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;/CMakeLists.txt</span></code>) will see the new value <code class="docutils literal notranslate"><span class="pre">&lt;XXX&gt;_ENABLE_&lt;YYY&gt;</span>
<span class="pre">STREQUAL</span> <span class="pre">&lt;val&gt;</span></code>.  It is also strongly recommended that a message or warning
be printed to CMake STDOUT using <code class="docutils literal notranslate"><span class="pre">message([&quot;NOTE:</span> <span class="pre">&quot;|WARNING]</span> <span class="pre">&quot;&lt;message&gt;&quot;)</span></code>
when globally changing an ENABLE variable. The user may have set it
explicitly, and they should know exactly why and where their choice is being
overridden.</p>
</section>
<section id="how-to-set-up-multi-repository-support">
<h2><a class="toc-backref" href="#id78"><span class="sectnum">9.13</span> How to set up multi-repository support</a><a class="headerlink" href="#how-to-set-up-multi-repository-support" title="Permalink to this heading"></a></h2>
<p>The following steps describe how to set up support for TriBITS project
managing multiple version control and TriBITS repositories by default (see
<a class="reference internal" href="#multi-repository-support">Multi-Repository Support</a>).</p>
<p>1) Add file <a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> and list out
extra repos</p>
<blockquote>
<div><p>For example, this file would contain something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_project_define_extra_repositories</span><span class="p">(</span>
  <span class="n">ExtraRepo1</span>  <span class="s2">&quot;&quot;</span>  <span class="n">GIT</span>  <span class="n">git</span><span class="nd">@someurl</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">ExtraRepo1</span>  <span class="s2">&quot;&quot;</span>  <span class="n">Continuous</span>
  <span class="n">ExtraRepo2</span>  <span class="s2">&quot;ExtraRepo1/ExtraRepos2&quot;</span>  <span class="n">GIT</span>  <span class="n">git</span><span class="nd">@someurl</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">ExtraRepo2</span>
                                                 <span class="n">NOPACKAGES</span>  <span class="n">Continuous</span>
  <span class="n">ExtraRepo3</span>  <span class="s2">&quot;&quot;</span>  <span class="n">GIT</span>  <span class="n">git</span><span class="nd">@someurl</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">ExtraRepo3</span>  <span class="s2">&quot;&quot;</span>  <span class="n">Nightly</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>NOTE: If one will not be using the <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> tool, or
<a class="reference internal" href="#clone-extra-repos-py">clone_extra_repos.py</a> tool, or the <a class="reference internal" href="#tribits-ctest-cdash-driver">TriBITS CTest/CDash Driver</a> system,
then one can leave the <strong>REPO_VCTYPE</strong> and <strong>REPO_URL</strong> fields empty (see
<a class="reference internal" href="#tribits-project-define-extra-repositories">tribits_project_define_extra_repositories()</a> for details).  (TriBITS Core
does not have any dependencies on any specific VC tool.  These fields are
listed here to avoid duplicating the list of repos in another file when
using these additional TriBITS tools.)</p>
</div></blockquote>
<p>2) Set default values for <a class="reference external" href="TribitsBuildReference.html#project-extrarepos-file">${PROJECT_NAME}_EXTRAREPOS_FILE</a> and
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_KNOWN_EXTERNAL_REPOS_TYPE</span></code> (and possibly
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_IGNORE_MISSING_EXTRA_REPOSITORIES</span></code>) in the file
<a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a></p>
<blockquote>
<div><p>For example, add:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_EXTRAREPOS_FILE  cmake/ExtraRepositoriesList.cmake
  CACHE  FILEPATH  &quot;Set in ProjectName.cmake&quot;)
set(${PROJECT_NAME}_ENABLE_KNOWN_EXTERNAL_REPOS_TYPE  Continuous
  CACHE  STRING  &quot;Set in ProjectName.cmake&quot;)
</pre></div>
</div>
<p>to the <a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file.  Otherwise, no extra repos
will be defined or processed by default when configuring the project.</p>
<p>And if the project can operate without all of its extra repos, the project
can set the following default in this file as well with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_IGNORE_MISSING_EXTRA_REPOSITORIES  TRUE
  CACHE  STRING  &quot;Set in ProjectName.cmake&quot;)
</pre></div>
</div>
<p>Otherwise, all of the extra repos need to be present or the project
configure will fail.</p>
</div></blockquote>
<p>3) If using git as the VC tool, then set the variable
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_GENERATE_REPO_VERSION_FILE_DEFAULT</span></code> in the
<a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file</p>
<blockquote>
<div><p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_GENERATE_REPO_VERSION_FILE_DEFAULT  TRUE)
</pre></div>
</div>
</div></blockquote>
<p>4) If wanting a clone tool with git repos, set up a link to the
<a class="reference internal" href="#clone-extra-repos-py">clone_extra_repos.py</a> tool in the base <code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/</span></code> directory</p>
<blockquote>
<div><p>Create a symlink to the script <a class="reference internal" href="#clone-extra-repos-py">clone_extra_repos.py</a> in the base project
repo, for example with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">&lt;</span><span class="n">projecDir</span><span class="o">&gt;/</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="n">cmake</span><span class="o">/</span><span class="n">tribits</span><span class="o">/</span><span class="n">ci_support</span><span class="o">/</span><span class="n">clone_extra_repos</span><span class="o">.</span><span class="n">py</span> <span class="o">.</span>
<span class="n">git</span> <span class="n">add</span> <span class="n">clone_extra_repos</span><span class="o">.</span><span class="n">py</span>
<span class="n">git</span> <span class="n">commit</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="how-to-submit-testing-results-to-a-cdash-site">
<h2><a class="toc-backref" href="#id79"><span class="sectnum">9.14</span> How to submit testing results to a CDash site</a><a class="headerlink" href="#how-to-submit-testing-results-to-a-cdash-site" title="Permalink to this heading"></a></h2>
<p>The following steps describe how to submit results to a CDash site using the
<a class="reference internal" href="#tribits-ctest-cdash-driver">TriBITS CTest/CDash Driver</a> support.</p>
<ol class="arabic simple">
<li><p>Create a CDash project <code class="docutils literal notranslate"><span class="pre">&lt;ProjectName&gt;</span></code> on the targeted CDash site.</p></li>
</ol>
<blockquote>
<div><p>To do this, one must have an account on the CDash site and the permissions
to create a new CDash project.  The name of the project on CDash should
generally match the name of the TriBITS project <code class="docutils literal notranslate"><span class="pre">PROJECT_NAME</span></code> but it does
not have to.  In fact, one can generally submit to any CDash project with
any name so creating a new CDash project is actually optional.</p>
<p>NOTE: For open-source projects, Kitware provides the free CDash site
my.cdash.org that allows a limited number of submits and data per day.  But
it should be enough to test out submitting to CDash.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Create <code class="docutils literal notranslate"><span class="pre">CTestConfig.cmake</span></code> and <code class="docutils literal notranslate"><span class="pre">CTestCustom.cmake.in</span></code> files for the
project.</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>The file <a class="reference internal" href="#projectdir-ctestconfig-cmake">&lt;projectDir&gt;/CTestConfig.cmake</a> can be copied and pasted from
TribitsExampleProject/CTestConfig.cmake.  To customize for your project,
you generally just need to update the variables <code class="docutils literal notranslate"><span class="pre">CTEST_DROP_SITE</span></code>,
<code class="docutils literal notranslate"><span class="pre">CTEST_PROJECT_NAME</span></code>, and <code class="docutils literal notranslate"><span class="pre">CTEST_DROP_LOCATION</span></code>.</p></li>
<li><p>The file <a class="reference internal" href="#projectdir-cmake-ctest-ctestcustom-cmake-in">&lt;projectDir&gt;/cmake/ctest/CTestCustom.cmake.in</a> can be copied
and pasted from <code class="docutils literal notranslate"><span class="pre">TribitsExampleProject/cmake/ctest/CTestCustom.cmake.in</span></code>
and them modified as desired.</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Test experimental submits with <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">dashboard</span></code>.</p></li>
</ol>
<blockquote>
<div><p>Once the CDash project and the <a class="reference internal" href="#projectdir-ctestconfig-cmake">&lt;projectDir&gt;/CTestConfig.cmake</a> and
<a class="reference internal" href="#projectdir-cmake-ctest-ctestcustom-cmake-in">&lt;projectDir&gt;/cmake/ctest/CTestCustom.cmake.in</a> files are created, one
perform an experimental submission by just configuring the project as normal
(except configuring additionally with <code class="docutils literal notranslate"><span class="pre">-DCTEST_BUILD_FLAGS=-j8</span></code> and
<code class="docutils literal notranslate"><span class="pre">-DCTEST_PARALLEL_LEVEL=8</span></code> to use parallelism in the build and testing in
the <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-S</span></code> script) and then running the build target:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">dashboard</span>
</pre></div>
</div>
<p>That will configure, build, test, and submit results to the CDash site to
the <code class="docutils literal notranslate"><span class="pre">Experimental</span></code> track of the target CDash project (see <a class="reference external" href="TribitsBuildReference.html#dashboard-submissions">Dashboard
Submissions</a>).</p>
<p>To work out problems locally without spamming the CDash site, one can run
with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="n">CTEST_DO_SUBMIT</span><span class="o">=</span><span class="n">OFF</span> <span class="n">make</span> <span class="n">dashboard</span>
</pre></div>
</div>
<p>To submit to a different CDash site and project, change the cache vars
<code class="docutils literal notranslate"><span class="pre">CTEST_DROP_SITE</span></code>, <code class="docutils literal notranslate"><span class="pre">CTEST_PROJECT_NAME</span></code>, and <code class="docutils literal notranslate"><span class="pre">CTEST_DROP_LOCATION</span></code> at
configure time. For example, to submit TribitsExampleProject results to a
different CDash site, configure with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> \
<span class="o">-</span><span class="n">DCTEST_DROP_SITE</span><span class="o">=</span><span class="n">testing</span><span class="o">.</span><span class="n">sandia</span><span class="o">.</span><span class="n">gov</span><span class="o">/</span><span class="n">cdash</span> \
<span class="o">-</span><span class="n">DCTEST_PROJECT_NAME</span><span class="o">=</span><span class="n">TribitsExProj</span> \
<span class="o">-</span><span class="n">DCTEST_DROP_LOCATION</span><span class="o">=</span><span class="s2">&quot;/submit.php?project=TribitsExProj&quot;</span> \
<span class="p">[</span><span class="n">other</span> <span class="n">cmake</span> <span class="n">options</span><span class="p">]</span> \
<span class="o">&lt;</span><span class="n">baseDir</span><span class="o">&gt;/</span><span class="n">TribitsExamplProject</span>
</pre></div>
</div>
<p>and then run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">dashboard</span></code>.</p>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>Add custom CTest -S driver scripts.</p></li>
</ol>
<blockquote>
<div><p>For driving different builds and tests, one needs to set up one or more
CTest -S driver scripts.  There are various ways to do this but a simple
approach that avoids duplication is to first create a file like
<code class="docutils literal notranslate"><span class="pre">TribitsExampleProject/cmake/ctest/TribitsExProjCTestDriver.cmake</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#
# Set the locations of things for this project
#


set(TRIBITS_PROJECT_ROOT &quot;${CMAKE_CURRENT_LIST_DIR}/../..&quot;)
set(CTEST_SOURCE_NAME &quot;TribitsExampleProject&quot;)
include(&quot;${TRIBITS_PROJECT_ROOT}/ProjectName.cmake&quot;)
if (NOT &quot;$ENV{${PROJECT_NAME}_TRIBITS_DIR}&quot; STREQUAL &quot;&quot;)
  set(${PROJECT_NAME}_TRIBITS_DIR &quot;$ENV{${PROJECT_NAME}_TRIBITS_DIR}&quot;)
endif()
if(&quot;${${PROJECT_NAME}_TRIBITS_DIR}&quot; STREQUAL &quot;&quot;)
  # If not set externally, then assume this is inside of tribits example
  # directory.
  set(${PROJECT_NAME}_TRIBITS_DIR &quot;${CMAKE_CURRENT_LIST_DIR}/../../../..&quot;)
endif()

#
# Include the TriBITS file to get other modules included
#

include(&quot;${${PROJECT_NAME}_TRIBITS_DIR}/ctest_driver/TribitsCTestDriverCore.cmake&quot;)

function(tribitsexproj_ctest_driver)
  set_default_and_from_env( CTEST_BUILD_FLAGS &quot;-j1 -i&quot; )
  set_default_and_from_env( CTEST_PARALLEL_LEVEL &quot;1&quot; )
  tribits_ctest_driver()
endfunction()
</pre></div>
</div>
<p>and then create a set of CTest -S driver scripts that uses that file.  One
example is the file
<code class="docutils literal notranslate"><span class="pre">TribitsExampleProject/cmake/ctest/general_gcc/ctest_serial_debug.cmake</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>include(&quot;${CMAKE_CURRENT_LIST_DIR}/../TribitsExProjCTestDriver.cmake&quot;)

set(COMM_TYPE SERIAL)
set(BUILD_TYPE DEBUG)
set(COMPILER_VERSION GCC)
set(BUILD_DIR_NAME ${COMM_TYPE}_${BUILD_TYPE})

set( EXTRA_CONFIGURE_OPTIONS
  &quot;-DBUILD_SHARED_LIBS:BOOL=ON&quot;
  &quot;-DCMAKE_BUILD_TYPE=DEBUG&quot;
  &quot;-DCMAKE_C_COMPILER=gcc&quot;
  &quot;-DCMAKE_CXX_COMPILER=g++&quot;
  &quot;-DCMAKE_Fortran_COMPILER=gfortran&quot;
  &quot;-DTribitsExProj_ENABLE_Fortran=ON&quot;
  &quot;-DTribitsExProj_TRACE_ADD_TEST=ON&quot;
  )

set_default_and_from_env(TribitsExProj_CMAKE_INSTALL_PREFIX &quot;&quot;)
if (TribitsExProj_CMAKE_INSTALL_PREFIX)
  set(EXTRA_CONFIGURE_OPTIONS
    &quot;${EXTRA_CONFIGURE_OPTIONS}&quot;
    &quot;-DCMAKE_INSTALL_PREFIX=${TribitsExProj_CMAKE_INSTALL_PREFIX}&quot;
    )
endif()

set(CTEST_TEST_TYPE Continuous)

tribitsexproj_ctest_driver()
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="5">
<li><p>Test CTest -S driver scripts</p></li>
</ol>
<blockquote>
<div><p>Once a CTest -S driver script (like the <code class="docutils literal notranslate"><span class="pre">ctest_serial_debug.cmake</span></code> example
shown above) is created, one can test it locally and then test a submit to
CDash.  To test the exact state of the repository locally, one can create a
temporary base directory, symbolically link in the local project source
directory, and then run the CTest -S script by setting
<code class="docutils literal notranslate"><span class="pre">CTEST_DO_SUBMIT=OFF</span></code>.  For example, the TribitsExampleProject CTest -S
script can be run and tested locally by doing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir MOCK_TRIBITSEXPROJ_SERIAL_DEBUG
$ cd MOCK_TRIBITSEXPROJ_SERIAL_DEBUG/
$ ln -s $TRIBITS_DIR/examples/TribitsExampleProject .
$ env  CTEST_DASHBOARD_ROOT=$PWD \
     CTEST_DROP_SITE=testing.sandia.gov/cdash \
     CTEST_PROJECT_NAME=TribitsExProj \
     CTEST_DROP_LOCATION=&quot;/submit.php?project=TribitsExProj&quot; \
     CTEST_TEST_TYPE=Experimental \
     CTEST_DO_SUBMIT=OFF \
     CTEST_DO_UPDATES=OFF \
     CTEST_START_WITH_EMPTY_BINARY_DIRECTORY=TRUE \
     ctest -V -S \
      $TRIBITS_DIR/examples/TribitsExampleProject/cmake/ctest/general_gcc/ctest_serial_debug.cmake \
     &amp;&gt; console.out
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">TRIBITS_DIR</span></code> is an env var that points to the location of the
<code class="docutils literal notranslate"><span class="pre">TriBITS/tribits</span></code> directory on the local machine (and the location of the
CDash site and project is changed, since the free my.cdash.org site can only
accept as small number of builds each day).</p>
<p>Once that CTest -S driver script is working correctly without submitting to
CDash, the above <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-S</span></code> command can be run with <code class="docutils literal notranslate"><span class="pre">CTEST_DO_SUBMIT=ON</span></code>
which submit the CDash and then print the location on CDash for the
submitted configure, build, and test results.</p>
</div></blockquote>
<ol class="arabic simple" start="6">
<li><p>Set up automated runs of CTest -S driver scripts</p></li>
</ol>
<blockquote>
<div><p>The custom CTest -S driver scripts created above can be run and used to
submit to CDash in a variety of ways:</p>
<ul class="simple">
<li><p>Cron jobs can be set up to run them at the same time every day.</p></li>
<li><p>Jenkins jobs can be set up to run them based on various criteria.</p></li>
<li><p>Travis CI can run them to respond to GitHub pushes.</p></li>
<li><p>Use the legacy <a class="reference internal" href="#tribits-dashboard-driver">TriBITS Dashboard Driver</a> system (not recommended).</p></li>
</ul>
<p>The setup of Jenkins, Travis CI and other more sophisticated automated
testing systems will not be described here.  What will be briefly outlined
below is the setup using cron jobs on a Linux machine.  That is sufficient
for most smaller projects and provides tremendous value.</p>
<p>To set up an automated build using a cron job, one will typically create a
shell driver script that sets the env and then calls the <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-S</span>
<span class="pre">&lt;script&gt;</span></code> command.  Then one just adds a call to that shell driver script
using <code class="docutils literal notranslate"><span class="pre">crontab</span> <span class="pre">-e</span></code>.  That is about all there is to it.</p>
</div></blockquote>
</section>
<section id="how-to-submit-testing-results-to-a-custom-cdash-group">
<h2><a class="toc-backref" href="#id80"><span class="sectnum">9.15</span> How to submit testing results to a custom CDash Group</a><a class="headerlink" href="#how-to-submit-testing-results-to-a-custom-cdash-group" title="Permalink to this heading"></a></h2>
<p>Following up on <a class="reference internal" href="#how-to-submit-testing-results-to-a-cdash-site">How to submit testing results to a CDash site</a>, to submit
build and test results to a custom “Group” on CDash (instead of just
“Nightly”, “Continuous” or “Experimental”), one just has to create the new
group on CDash using the CDash GUI interface and then tell the ctest -S local
driver to submit results to that CDash group.  The steps for doing this are
given below.</p>
<ol class="arabic">
<li><p>Create the new CDash group <code class="docutils literal notranslate"><span class="pre">&lt;special_group&gt;</span></code> for CDash project
<code class="docutils literal notranslate"><span class="pre">&lt;ProjectName&gt;</span></code> on the targeted CDash site.</p>
<p>If the CDash group <code class="docutils literal notranslate"><span class="pre">&lt;special_group&gt;</span></code> is not already created, then one can
create it by first logging into CDash with an account that can modify the
CDash project <code class="docutils literal notranslate"><span class="pre">&lt;ProjectName&gt;</span></code>.  Once logged in, go to the project edit
page and select “Settings” and “Groups”.  From there, create the new group
<code class="docutils literal notranslate"><span class="pre">&lt;special_group&gt;</span></code>.  Set the “Build Type” to either “Daily” or “Latest”.</p>
</li>
<li><p>Set <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TRACK=&lt;special_group&gt;</span></code> with the CTest -S driver
script.</p>
<p>One can either do that by setting <code class="docutils literal notranslate"><span class="pre">set(${PROJECT_NAME}_TRACK</span>
<span class="pre">&lt;special_group&gt;)</span></code> in the CTest -S <code class="docutils literal notranslate"><span class="pre">*.cmake</span></code> driver script itself or can
set it in the environment when running the ctest -S driver script.  For
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ env &lt;Project&gt;_TRACK=&lt;special_group&gt; ... \
  ctest -V -S &lt;ctest_driver&gt;.cmake
</pre></div>
</div>
<p>If the “build type” for the CDash group <code class="docutils literal notranslate"><span class="pre">&lt;special_group&gt;</span></code> was set to
“Daily”, then set <a class="reference internal" href="#ctest-test-type">CTEST_TEST_TYPE</a> to <code class="docutils literal notranslate"><span class="pre">Nightly</span></code>.  Otherwise,
<code class="docutils literal notranslate"><span class="pre">CTEST_TEST_TYPE</span></code> can be set to <code class="docutils literal notranslate"><span class="pre">Continuous</span></code> or <code class="docutils literal notranslate"><span class="pre">Experimental</span></code>.</p>
</li>
</ol>
</section>
</section>
<section id="miscellaneous-topics">
<h1><a class="toc-backref" href="#id81"><span class="sectnum">10</span> Miscellaneous Topics</a><a class="headerlink" href="#miscellaneous-topics" title="Permalink to this heading"></a></h1>
<p>In this section, a number of miscellaneous topics and TriBITS features are
discussed.  These features and topics are either not considered primary
features of TriBITS or don’t neatly fit into one of the other sections.</p>
<section id="tribits-repository-contents">
<h2><a class="toc-backref" href="#id82"><span class="sectnum">10.1</span> TriBITS Repository Contents</a><a class="headerlink" href="#tribits-repository-contents" title="Permalink to this heading"></a></h2>
<p>The TriBITS git repository is organized as a <a class="reference internal" href="#tribits-project">TriBITS Project</a>, <a class="reference internal" href="#tribits-repository">TriBITS
Repository</a>, and <a class="reference internal" href="#tribits-package">TriBITS Package</a> all in the same base directory.  The base
contents are described in the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TriBITS</span><span class="o">/</span><span class="n">README</span><span class="o">.</span><span class="n">DIRECTORY_CONTENTS</span><span class="o">.</span><span class="n">rst</span>
</pre></div>
</div>
<p>The part of TriBITS that is installed or snapshotted in contained in the
subdirectory <a class="reference internal" href="#tribits-tribits">TriBITS/tribits/</a> and is described in the following section.</p>
<section id="tribits-directory-contents">
<h3><a class="toc-backref" href="#id83">TriBITS/ Directory Contents</a><a class="headerlink" href="#tribits-directory-contents" title="Permalink to this heading"></a></h3>
<p>This base directory for TriBITS acts as a TriBITS Project, a TriBITS
Repository, and a TriBITS Package.  As such, it contains the standard files
that are found in a TriBITS Project, Repository, and Package:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ProjectName</span><span class="o">.</span><span class="n">cmake</span>   <span class="c1"># PROJECT_NAME=TriBITS</span>
<span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>      <span class="c1"># PROJECT_NAME = PACKAGE_NAME = TriBITS</span>
<span class="n">PackagesList</span><span class="o">.</span><span class="n">cmake</span>  <span class="c1"># Lists just &quot;TriBITS . PT&quot;</span>
<span class="n">TPLsList</span><span class="o">.</span><span class="n">cmake</span>      <span class="c1"># Lists only MPI</span>
<span class="n">cmake</span><span class="o">/</span>              <span class="c1"># Dependencies.cmake, etc.</span>
</pre></div>
</div>
<p>The core functionality of TriBITS is provided in the following directory, ‘tribits’/:</p>
<p><strong>tribits/</strong>: The part of TriBITS that CMake projects use to access TriBITS
functionality and assimilate into the TriBITS framework.  It also contains
basic documentation and examples.  Files and directories from here are what
get installed on the system or are snapshotted into
<code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/cmake/tribits/</span></code>.  Each TriBITS Project decides what parts of
it wants to install or shapshot using the script
<code class="docutils literal notranslate"><span class="pre">tribits/snapshot_tribits.py</span></code> (which takes arguments for what dirs to
snapshot, see below). This directory contains no tests at all. All of the
tests for TriBITS are in the <code class="docutils literal notranslate"><span class="pre">test/</span></code> directory (see below). The breakdown of
the contents of <code class="docutils literal notranslate"><span class="pre">tribits/</span></code> are described in the file
<code class="docutils literal notranslate"><span class="pre">tribits/README.DIRECTORY_CONTENTS.rst</span></code>.</p>
<p>The following directories are not snapshotted into
<code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/cmake/tribits/</span></code> by the script <code class="docutils literal notranslate"><span class="pre">tribits/snapshot_tribits.py</span></code>:</p>
<p><strong>test/</strong>: Contains all of the automated tests for TriBITS as part of the
TriBITS “TriBITS” package. When doing development, these tests are critical.</p>
<p><strong>dev_testing/:</strong> Contains scripts that support the development of the TriBITS
system itself in various contexts.</p>
<p><strong>common_tools/:</strong> Contains misc utilities that are not central to the TriBITS
system but are very helpful to keep around and do not take up too much space.</p>
<p><strong>refactoring/:</strong> Some scripts and other files that have aided in various
refactorings of TriBITS and are used to upgrade client TriBITS projects.</p>
</section>
<section id="tribits-tribits-directory-contents">
<span id="tribits-tribits"></span><h3><a class="toc-backref" href="#id84">TriBITS/tribits/ Directory Contents</a><a class="headerlink" href="#tribits-tribits-directory-contents" title="Permalink to this heading"></a></h3>
<p>This directory contains the implementation for the various parts of TriBITS
that are used by TriBITS projects to implement TriBITS functionality.  It also
contains basic documentation in the subdirectory doc/ that is very close to
the TriBITS implementation.  Files and directories from here are what get
installed on the system or will be snapshotted into
<code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/cmake/tribits/</span></code>.  Each TriBITS Project decides what parts of
TriBITS it wants to install or snapshot using the script
<code class="docutils literal notranslate"><span class="pre">tribits/snapshot_tribits.py</span></code> (which takes arguments for what dirs to
snapshot). This directory contains no tests at all. All of the tests for
TriBITS are in the <code class="docutils literal notranslate"><span class="pre">test/</span></code> directory in the parent TriBITS repository.</p>
<p>The breakdown of the contents of this directory are described below:</p>
<p><strong>TriBITS.cmake</strong>: The one file that needs to be included in order to use
TriBITS in a CMake project. This one file insulates clients from future
TriBITS refactorings of TriBITS.</p>
<p><strong>Version.cmake</strong>: Version of TriBITS.  This gets included by TriBITS.cmake</p>
<p id="tribits-core"><strong>core/</strong>: Core TriBITS package-based architecture for CMake projects. This
only depends on raw CMake and contains just the minimal support for building,
testing, installing, and deployment.  Only depends on CMake and nothing else.</p>
<p><strong>python_utils/</strong>: Some basic Python utilities that are not specific to
TriBITS but are used in TriBITS CI and testing support software.  There are
some very useful python scripts here like <code class="docutils literal notranslate"><span class="pre">gitdist</span></code> and <code class="docutils literal notranslate"><span class="pre">snapshot-dir.py</span></code>.</p>
<p><strong>ci_support/</strong>: Support code for pre-push continuous integration testing.
This contains the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> script and its supporting Python
modules.</p>
<p><strong>ctest_driver/</strong>: Support for package-by-package testing driven by CTest
submitting to CDash (to CDash project <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;</span></code>).  This contains the file
<code class="docutils literal notranslate"><span class="pre">TribitsCTestDriveCore.cmake</span></code> and some supporting modules.</p>
<p><strong>dashboard_driver/</strong>: TriBITS Dashboard Driver system which uses CTest to
drive individual project builds in parallel and submits results to a separate
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;Driver</span></code> CDash project.  WARNING: This was written by a contractor
and is least well tested, more confusing, and least desirable part of TriBITS.
If you have a better way to manage multiple builds (e.g. Jenkins) then use
that instead.</p>
<p><strong>common_tpls/</strong>: TPLs that are very common and are used by several different
TriBITS projects but are not built into the TriBITS system itself. Having some
of these common TPLs in a central location enhances uniformity, reuse, and
makes it easier to pull TriBITS packages out of a repo and build them
independently.</p>
<p><strong>doc/</strong>: Basic TriBITS documentation built using docutils. The generated
documents are stored in the git repo but instead are built on command using
the <code class="docutils literal notranslate"><span class="pre">doc/build_docs.sh</span></code> script.</p>
<p><strong>examples/</strong>: Example TriBITS projects and TPLs. These can be copied out and
used as examples</p>
<p><strong>devtools_install/</strong>: Basic install scripts for tools like CMake, GCC,
OpenMPI, MPICH, Git, etc. By default, these all download tarballs from the
<code class="docutils literal notranslate"><span class="pre">github.com/TriBITSPub/</span></code> site and the repos are named
<code class="docutils literal notranslate"><span class="pre">devtools-&lt;toolname&gt;-&lt;version&gt;-base</span></code>. This makes it easy to set up a new dev
environment for projects that uses TriBITS (or don’t use TriBITS for that
matter).</p>
<p><strong>win_interface/</strong>: Some non-Windows C header files ported to Windows to make
porting to Windows easier.</p>
<p>The script <code class="docutils literal notranslate"><span class="pre">snapshot_tribits.py</span></code> install the different pieces for of this
<code class="docutils literal notranslate"><span class="pre">tribits/</span></code> directory into a project’s <code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/cmake/tribits/</span></code>
subdirectory. It supports the argument <code class="docutils literal notranslate"><span class="pre">--components</span></code> with values <code class="docutils literal notranslate"><span class="pre">core</span></code>,
<code class="docutils literal notranslate"><span class="pre">python_utils</span></code>, <code class="docutils literal notranslate"><span class="pre">ci_support</span></code>, <code class="docutils literal notranslate"><span class="pre">ctest_driver</span></code>, <code class="docutils literal notranslate"><span class="pre">dashboard_driver</span></code>,
<code class="docutils literal notranslate"><span class="pre">common_tpls</span></code>, <code class="docutils literal notranslate"><span class="pre">doc</span></code>, <code class="docutils literal notranslate"><span class="pre">examples</span></code>, <code class="docutils literal notranslate"><span class="pre">win_interface</span></code>, and
<code class="docutils literal notranslate"><span class="pre">devtools_install</span></code>. These snapshot components have the dependencies:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">core</span></code> =&gt; (external CMake)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">python_utils</span></code> =&gt; (external Python 2.6)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">win_interface</span></code> =&gt; (external C compiler)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TriBITS.cmake</span></code> =&gt; <code class="docutils literal notranslate"><span class="pre">core</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ci_support</span></code> =&gt; <code class="docutils literal notranslate"><span class="pre">core</span></code>, <code class="docutils literal notranslate"><span class="pre">python_utils</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ctest_driver</span></code> =&gt; <code class="docutils literal notranslate"><span class="pre">core</span></code>, <code class="docutils literal notranslate"><span class="pre">ci_support</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dashboard_driver</span></code> =&gt; <code class="docutils literal notranslate"><span class="pre">ctest_driver</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">common_tpls</span></code> =&gt; <code class="docutils literal notranslate"><span class="pre">core</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">examples</span></code> =&gt; (external tribits installation)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">doc</span></code> =&gt; <code class="docutils literal notranslate"><span class="pre">core</span></code>, <code class="docutils literal notranslate"><span class="pre">ci_support</span></code>, <code class="docutils literal notranslate"><span class="pre">examples</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">devtools_install</span></code> =&gt; <code class="docutils literal notranslate"><span class="pre">python_utils</span></code></p></li>
</ul>
</section>
</section>
<section id="tribits-system-project-dependencies">
<h2><a class="toc-backref" href="#id85"><span class="sectnum">10.2</span> TriBITS System Project Dependencies</a><a class="headerlink" href="#tribits-system-project-dependencies" title="Permalink to this heading"></a></h2>
<p>The core TriBITS system itself (see <code class="docutils literal notranslate"><span class="pre">tribts/core/</span></code> in <a class="reference internal" href="#tribits-tribits">TriBITS/tribits/</a>)
which is used to configure, built, test, create tarballs, and install software
has no dependencies other than a basic installation of CMake (which typically
includes the executables <code class="docutils literal notranslate"><span class="pre">cmake</span></code>, <code class="docutils literal notranslate"><span class="pre">ctest</span></code>, and <code class="docutils literal notranslate"><span class="pre">cpack</span></code>).  Great effort
has been expended to implement all of this core functionality of TriBITS just
using raw CMake.  That means that anyone who needs to configure, build, and
install software that uses TriBITS just needs a compatible CMake
implementation.  CMake is becoming iniquitous enough that many machines will
already have a current-enough version of CMake installed by default on their
systems and therefore no one will need to download or install any extra
software when building and installing a project that uses TriBITS (assuming
the necessary compilers etc. required by the project are also installed).  If
a current-enough version of CMake is not installed on a given system, it is
easy to download the source code and all it needs is a basic C++ compiler to
build and install.</p>
<p>However, note that a specific TriBITS project is free to use any newer CMake
features it wants and therefore these projects will require newer versions of
CMake than what is required by TriBITS (see discussion of
<code class="docutils literal notranslate"><span class="pre">cmake_minimum_required()</span></code> in <a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a>).  But also
note that specific TriBITS projects and packages will also require additional
tools like compilers, Python (see <a class="reference internal" href="#python-support">Python Support</a>), Perl, or many other such
dependencies.  It is just that TriBITS itself does not require any of these in
order to perform the basic configure, build, test, and install of software.
The goal of TriBITS is not to make the portability of software that uses it
any worse than it already is but instead to make it easier in most cases (that
after all is the whole goal of CMake).</p>
<p>While the TriBITS Core functionality to configure, build, test, and install
software is written using only raw CMake, the more sophisticated development
tools needed to implement the full TriBITS development environment require
Python 2.7 (or higher including Python 3.x) (see <a class="reference internal" href="#python-support">Python Support</a>).  Python
is needed for tools like <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> and <a class="reference internal" href="#gitdist">gitdist</a>.  In addition,
these python tools are used in <a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a> to drive automated
testing and submits to CDash.  Also note that <code class="docutils literal notranslate"><span class="pre">git</span></code> is the chosen version
control tool for the TriBITS software development tools and all the VC-related
functionality in TriBITS.  But none of this is required for doing the most
basic building, testing, or installation of a project using TriBITS Core.</p>
</section>
<section id="python-support">
<h2><a class="toc-backref" href="#id86"><span class="sectnum">10.3</span> Python Support</a><a class="headerlink" href="#python-support" title="Permalink to this heading"></a></h2>
<p>TriBITS Core does not require anything other than raw CMake.  However, Python
Utils, TriBITS CI Support, and other extended TriBITS components require
Python.  These extra TriBITS tools only require Python 2.7+ (and 3.x).  By
default, when a TriBITS project starts to configure using CMake, it will try
to find Python 2.7+ on the system (see <a class="reference internal" href="#full-processing-of-tribits-project-files">Full Processing of TriBITS Project
Files</a>).  If Python is found, it will set the global cache variable
<code class="docutils literal notranslate"><span class="pre">PYTHON_EXECUTABLE</span></code>.  If it is not found, then it will print a warning and
<code class="docutils literal notranslate"><span class="pre">PYTHON_EXECUTABLE</span></code> will be empty.  With this default behavior, if Python is
found, then the TriBITS project can use it.  Otherwise, it can do without it.</p>
<p>While the default behavior for finding Python described above is useful for
many TriBITS project (such as Trilinos), some TriBITS projects need different
behavior such as:</p>
<ol class="arabic simple">
<li><p>The TriBITS project may not ever use Python so there is no need to look for
it at all.  In this case, the TriBITS project would set
<a class="reference internal" href="#project-name-uses-python">${PROJECT_NAME}_USES_PYTHON</a> to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>.</p></li>
<li><p>Some TriBITS projects require Python and should not even configure if it
can’t be found.  In this case, the TriBITS project would set
<a class="reference internal" href="#project-name-requires-python">${PROJECT_NAME}_REQUIRES_PYTHON</a> to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.</p></li>
<li><p>Some TriBITS projects may require a version of Python more recent than 2.7.
In this case, the TriBITS project would set <a class="reference internal" href="#pythoninterp-find-version">PythonInterp_FIND_VERSION</a> to
some value higher than <code class="docutils literal notranslate"><span class="pre">2.7</span></code>.  For example, may newer systems have only
Python 3.5.2 or higher versions installed by default and projects developed
on such a system typically requires this version or higher.</p></li>
</ol>
</section>
<section id="project-specific-build-reference">
<h2><a class="toc-backref" href="#id87"><span class="sectnum">10.4</span> Project-Specific Build Reference</a><a class="headerlink" href="#project-specific-build-reference" title="Permalink to this heading"></a></h2>
<p>If a project that uses TriBITS is going to have a significant user base that
will configure, build, and test the project, then having some documentation
that explains how to do this would be useful.  For this purpose, TriBITS
provides a mechanism to quickly create a project-specific build reference
document in restructured text (RST) format and with HTML and LaTeX/PDF
outputs.  This document are generally created in the base project source tree
and given then name <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;BuildReference.[rst,html,pdf]</span></code>.  This document
consists of two parts.  One part is a generic template document:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span><span class="n">TribitsBuildReferenceBody</span><span class="o">.</span><span class="n">rst</span>
</pre></div>
</div>
<p>provided in the TriBITS source tree that uses the place-holder <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;</span></code>
for the for the real project name.  The second part is a project-specific
template file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">projectDir</span><span class="o">&gt;/</span><span class="n">cmake</span><span class="o">/&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">BuildReferenceTemplate</span><span class="o">.</span><span class="n">rst</span>
</pre></div>
</div>
<p>which provides the outer RST document (with title, authors, abstract,
introduction, other introductory sections).  From these two files, the
script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span><span class="n">build_ref</span><span class="o">/</span><span class="n">create</span><span class="o">-</span><span class="n">project</span><span class="o">-</span><span class="n">build</span><span class="o">-</span><span class="n">quickref</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>is used to replace <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;</span></code> in the <code class="docutils literal notranslate"><span class="pre">TribitsBuildReferenceBody.rst</span></code> file
with the real project name (read from the project’s <code class="docutils literal notranslate"><span class="pre">ProjectName.cmake</span></code> file
by default) and then generates the read-only files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">projectDir</span><span class="o">&gt;/</span>
  <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">BuildReference</span><span class="o">.</span><span class="n">rst</span>
  <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">BuildReference</span><span class="o">.</span><span class="n">html</span>
  <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">BuildReference</span><span class="o">.</span><span class="n">pdf</span>
</pre></div>
</div>
<p>For a simple example of this, see:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span><span class="n">build_ref</span><span class="o">/</span><span class="n">create</span><span class="o">-</span><span class="n">build</span><span class="o">-</span><span class="n">ref</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>A project-independent version of this file is provided in the
<a class="reference external" href="TribitsBuildReference.html">TribitsBuildReference</a>.[rst,html,pdf] which is referred to many times in this
developers guide.</p>
</section>
<section id="project-and-repository-versioning-and-release-mode">
<h2><a class="toc-backref" href="#id88"><span class="sectnum">10.5</span> Project and Repository Versioning and Release Mode</a><a class="headerlink" href="#project-and-repository-versioning-and-release-mode" title="Permalink to this heading"></a></h2>
<p>TriBITS has built-in support for project and repository versioning and
release-mode control.  When the project contains the file
<a class="reference internal" href="#projectdir-version-cmake">&lt;projectDir&gt;/Version.cmake</a>, it is used to define the project’s official
version.  The idea is that when it is time to branch for a release, the only
file that needs to be changed is the file <a class="reference internal" href="#projectdir-version-cmake">&lt;projectDir&gt;/Version.cmake</a>.</p>
<p>Each TriBITS repository can also contain a <a class="reference internal" href="#repodir-version-cmake">&lt;repoDir&gt;/Version.cmake</a> file
that sets version-related variables which TriBITS packages in that repository
can use to derive development and release version information.  If the TriBITS
repository also contains a <a class="reference internal" href="#repodir-copyright-txt">&lt;repoDir&gt;/Copyright.txt</a> file, then the
information in <code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;/Version.cmake</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;/Copyright.txt</span></code> are
used to configure a repository version header file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${${REPOSITORY_NAME}_BINARY_DIR}/${REPOSITORY_NAME}_version.h
</pre></div>
</div>
<p>The configured header file <code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}_version.h</span></code> defines C
pre-processor macros that give the repository version number in several
formats, which allows C/C++ code (or any software that uses the C
preprocessor) to write conditional code like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#if Trilinos_MAJOR_MINOR_VERSION &gt; 100200</span>
  <span class="o">/*</span> <span class="n">Contains</span> <span class="n">feature</span> <span class="n">X</span> <span class="o">*/</span>
  <span class="o">...</span>
<span class="c1">#else</span>
  <span class="o">/*</span> <span class="n">Does</span> <span class="ow">not</span> <span class="n">contain</span> <span class="n">feature</span> <span class="n">X</span> <span class="o">*/</span>
  <span class="o">...</span>
<span class="c1">#endif</span>
</pre></div>
</div>
<p>Of course when the TriBITS project and the TriBITS repository are the same
directory, the <code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/Version.cmake</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;/Version.cmake</span></code>
files are the same file, which works just fine.</p>
</section>
<section id="tribits-environment-probing-and-setup">
<h2><a class="toc-backref" href="#id89"><span class="sectnum">10.6</span> TriBITS Environment Probing and Setup</a><a class="headerlink" href="#tribits-environment-probing-and-setup" title="Permalink to this heading"></a></h2>
<p>Part of the TriBITS Framework is to probe the environment, set up the
compilers, and get ready to compile code.  This was mentioned in <a class="reference internal" href="#full-processing-of-tribits-project-files">Full
Processing of TriBITS Project Files</a>.  This is executed by the TriBITS macro
<code class="docutils literal notranslate"><span class="pre">tribits_setup_env()</span></code>.  Some of the things this macro does are:</p>
<p id="probe-and-set-up-the-environment"><strong>Probe and set up the environment:</strong></p>
<ul class="simple">
<li><p>Set <code class="docutils literal notranslate"><span class="pre">CMAKE_BUILD_TYPE</span></code> default (if not already set)</p></li>
<li><p>Set up for MPI (MPI compilers, etc.)</p></li>
<li><p>Set up C, C++, and Fortran compilers using <code class="docutils literal notranslate"><span class="pre">enable_language(&lt;LANG&gt;)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#projectdir-cmake-projectcompilerpostconfig-cmake">&lt;projectDir&gt;/cmake/ProjectCompilerPostConfig.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></p></li>
<li><p>Find Perl (sets <code class="docutils literal notranslate"><span class="pre">PERL_EXECUTABLE</span></code>)</p></li>
<li><p>Determine mixed language C/Fortran linking</p></li>
<li><p>Set up OpenMP (with <code class="docutils literal notranslate"><span class="pre">find_package(OpenMP)</span></code>)</p></li>
<li><p>Set up optional Windows support</p></li>
<li><p>Find Doxygen (sets <code class="docutils literal notranslate"><span class="pre">DOXYGEN_EXECUTABLE</span></code>)</p></li>
<li><p>Perform some other configure-time tests (see <code class="docutils literal notranslate"><span class="pre">cmake</span></code> configure output)</p></li>
</ul>
<p>At the completion of this part of the processing, the TriBITS CMake project is
ready to compile code.  All of the major variables set as part of this process
are printed to the <code class="docutils literal notranslate"><span class="pre">cmake</span></code> stdout when the project is configured.</p>
</section>
<section id="tricky-considerations-for-tribits-generated-tplname-config-cmake-files">
<h2><a class="toc-backref" href="#id90"><span class="sectnum">10.7</span> Tricky considerations for TriBITS-generated &lt;tplName&gt;Config.cmake files</a><a class="headerlink" href="#tricky-considerations-for-tribits-generated-tplname-config-cmake-files" title="Permalink to this heading"></a></h2>
<p>An issue that comes up with external packages/TPLs like HDF5 that needs to be
discussed here is the fact that <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> files create (See
<a class="reference internal" href="#how-to-add-a-new-tribits-tpl">How to add a new TriBITS TPL</a>) and TriBITS installs files of the name
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;Config.cmake</span></code> and that could potentially be found by calls to
<code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> (when <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span> <span class="pre">==</span> <span class="pre">&lt;externalPkg&gt;</span></code> like with
HDF5).  These TriBITS-generated <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;Config.cmake</span></code> files are primarily
meant to be included by and provide the <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> targets for
downstream TriBITS-compatible <code class="docutils literal notranslate"><span class="pre">&lt;Package&gt;Config.cmake</span></code> files.  These
TriBITS-generated <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;Config.cmake</span></code> files will usually not behave the
same way that a more general <code class="docutils literal notranslate"><span class="pre">Find&lt;tplName&gt;.config</span></code> modules or native
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;Config.cmake</span></code> configure files would behave as expected when found
by <code class="docutils literal notranslate"><span class="pre">find_package(&lt;tplName&gt;)</span></code> commands called in some arbitrary downstream
raw CMake project.  Therefore, to avoid having an installed TriBITS-generated
<code class="docutils literal notranslate"><span class="pre">HDF5Config.cmake</span></code> file, for example, being found by the inner call to
<code class="docutils literal notranslate"><span class="pre">find_package(HDF5</span> <span class="pre">...)</span></code> in the file <code class="docutils literal notranslate"><span class="pre">FindTPLHDF5.cmake</span></code> (which would be
disastrous), TriBITS employs two safeguards.  First, TriBITS-generated
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;Config.cmake</span></code> files are placed into the build directory under:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">buildDir</span><span class="o">&gt;/</span><span class="n">external_packages</span><span class="o">/&lt;</span><span class="n">tplName</span><span class="o">&gt;/&lt;</span><span class="n">tplName</span><span class="o">&gt;</span><span class="n">Config</span><span class="o">.</span><span class="n">cmake</span>
</pre></div>
</div>
<p>and installed into the directory under:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">installDir</span><span class="o">&gt;/</span><span class="n">lib</span><span class="o">/</span><span class="n">external_packages</span><span class="o">/&lt;</span><span class="n">tplName</span><span class="o">&gt;/&lt;</span><span class="n">tplName</span><span class="o">&gt;</span><span class="n">Config</span><span class="o">.</span><span class="n">cmake</span>
</pre></div>
</div>
<p>so they will not be found by <code class="docutils literal notranslate"><span class="pre">find_package(&lt;tplName&gt;)</span></code> by default when
<code class="docutils literal notranslate"><span class="pre">&lt;buildDir&gt;/cmake_packages</span></code> and/or <code class="docutils literal notranslate"><span class="pre">&lt;installDir&gt;</span></code>, respectively, are added
to <code class="docutils literal notranslate"><span class="pre">CMake_PREFIX_PATH</span></code>.  Also, even if
<code class="docutils literal notranslate"><span class="pre">&lt;installDir&gt;/lib/external_packages</span></code> or <code class="docutils literal notranslate"><span class="pre">&lt;buildDir&gt;/external_packages</span></code> do
get added to the search path somehow (e.g. by appending those to
<code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code>), the TriBITS framework will set the variable
<code class="docutils literal notranslate"><span class="pre">TRIBITS_FINDING_RAW_&lt;tplName&gt;_PACKAGE_FIRST=TRUE</span></code> before including
<code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> and there is special logic in the TriBITS-generated
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;ConfigVersion.cmake</span></code> file that will set
<code class="docutils literal notranslate"><span class="pre">PACKAGE_VERSION_COMPATIBLE=OFF</span></code> and result in <code class="docutils literal notranslate"><span class="pre">find_package(&lt;tplName&gt;)</span></code>
not selecting the TriBITS-generated <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;Config.cmake</span></code> file.  (It turns
out that CMake’s <code class="docutils literal notranslate"><span class="pre">find_package(&lt;Package&gt;)</span></code> command always includes the file
<code class="docutils literal notranslate"><span class="pre">&lt;Package&gt;ConfigVersion.cmake</span></code>, even if no version information is passed to
the command <code class="docutils literal notranslate"><span class="pre">find_package(&lt;Package&gt;)</span></code>.  This allows special logic to be
placed in the file <code class="docutils literal notranslate"><span class="pre">&lt;Package&gt;ConfigVersion.cmake</span></code> to determine if
<code class="docutils literal notranslate"><span class="pre">find_package(&lt;Package&gt;)</span></code> will select a given <code class="docutils literal notranslate"><span class="pre">&lt;Package&gt;Config.cmake</span></code> file
that is in the search path based on a number of different criteria such as in
this case.)</p>
</section>
<section id="installation-considerations">
<h2><a class="toc-backref" href="#id91"><span class="sectnum">10.8</span> Installation considerations</a><a class="headerlink" href="#installation-considerations" title="Permalink to this heading"></a></h2>
<p>For the most part, installation is pretty straightforward with a TriBITS-based
CMake project.  TriBITS automatically puts in appropriate default
<code class="docutils literal notranslate"><span class="pre">install()</span></code> commands to install header files, libraries, executables, and
other commonly installed artifacts (such as TriBITS-autogenerated
<code class="docutils literal notranslate"><span class="pre">&lt;Package&gt;Config.cmake</span></code> files).  And packages can add their own custom
<code class="docutils literal notranslate"><span class="pre">install()</span></code> commands to install items under <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code> (or the
subdirs under <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code> mentioned in <a class="reference external" href="TribitsBuildReference.html#setting-the-install-prefix">Setting the install
prefix</a>).  However, there are some special situations that need to be
addressed and some tweaks to built-in CMake support that need to be made.</p>
<p>One issue that can occur is that there are cases where a Unix/Linux system is
set up not to honor the group sticky bit and therefore one cannot control what
group owns the created installed files and directories (i.e. the default group
will be used).  Also, there are cases were one cannot easily control the
default file or directory creation permissions using <code class="docutils literal notranslate"><span class="pre">umask</span></code>.  And there are
cases where one would like to recursively install a set of directories and
files where some of these files may be scripts that need to have the execute
permission set on them for them to work.  The only to flexiable accomplish
that with CMake (if one does not know the exist list of those files or
extensions of those files) is to pass in the <code class="docutils literal notranslate"><span class="pre">SOURCE_PERMISSIONS</span></code> option to
the <code class="docutils literal notranslate"><span class="pre">install(DIRECTORY</span> <span class="pre">...)</span></code> command.  An example of this is shown in:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TribitsExampleProject/packages/with_subpackages/b/CMakeLists.txt</span></code></p></li>
</ul>
<p>that has:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">install</span><span class="p">(</span> <span class="n">DIRECTORY</span> <span class="s2">&quot;$</span><span class="si">{CMAKE_CURRENT_LIST_DIR}</span><span class="s2">/stuff&quot;</span>
  <span class="n">DESTINATION</span> <span class="s2">&quot;$</span><span class="si">{CMAKE_INSTALL_PREFIX}</span><span class="s2">/share/$</span><span class="si">{PACKAGE_NAME}</span><span class="s2">&quot;</span>
  <span class="n">USE_SOURCE_PERMISSIONS</span> <span class="n">PATTERN</span> <span class="s2">&quot;*~&quot;</span> <span class="n">EXCLUDE</span> <span class="p">)</span>
</pre></div>
</div>
<p>In this case, CMake will preserve the execute permission on any of the scripts
contained under the <code class="docutils literal notranslate"><span class="pre">stuff/</span></code> subdirectory but <code class="docutils literal notranslate"><span class="pre">group</span></code> and <code class="docutils literal notranslate"><span class="pre">other</span></code>
permissions will not be set based on <code class="docutils literal notranslate"><span class="pre">umask</span></code> or the default CMake install
permissions.  Instead, these permissions are set based on the source directory
permissions (which is often set to <code class="docutils literal notranslate"><span class="pre">700</span></code> or <code class="docutils literal notranslate"><span class="pre">rwx------</span></code>).</p>
<p>To address cases like this, TriBITS can automatically run <code class="docutils literal notranslate"><span class="pre">chgrp</span></code> and
<code class="docutils literal notranslate"><span class="pre">chmod</span></code> on the created files and directories that are created during the
<code class="docutils literal notranslate"><span class="pre">install</span></code> target as described in <a class="reference external" href="TribitsBuildReference.html#setting-install-ownership-and-permissions">Setting install ownership and
permissions</a>.  This is completely automatic and requires nothing for the
TriBITS Project developers to do to enable support for this (other than to
note the below warning).</p>
<p><strong>WARNING</strong>: Do not add any <code class="docutils literal notranslate"><span class="pre">install()</span></code> commands after the
<a class="reference internal" href="#id2">tribits_project()</a> command completes.  Otherwise, any extra files or
directories will not have their group and permissions fixed by these special
TriBITS-added <code class="docutils literal notranslate"><span class="pre">chgrp</span></code> and <code class="docutils literal notranslate"><span class="pre">chmod</span></code> commands run at install time.  Instead,
try to put all <code class="docutils literal notranslate"><span class="pre">install()</span></code> commands inside of a package’s
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file.  Currently, there really is no good place
to add repo-level or project-level <code class="docutils literal notranslate"><span class="pre">install()</span></code> commands.  But if one had to
sneak them in, they could add various <code class="docutils literal notranslate"><span class="pre">install()</span></code> commands to files like
<a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> (before the <code class="docutils literal notranslate"><span class="pre">tribits_project_()</span></code> command),
<a class="reference internal" href="#repodir-cmake-callbacksetupextraoptions-cmake">&lt;repoDir&gt;/cmake/CallbackSetupExtraOptions.cmake</a>,
<a class="reference internal" href="#projectdir-cmake-callbackdefineprojectpackaging-cmake">&lt;projectDir&gt;/cmake/CallbackDefineProjectPackaging.cmake</a> and/or
<a class="reference internal" href="#repodir-cmake-callbackdefinerepositorypackaging-cmake">&lt;repoDir&gt;/cmake/CallbackDefineRepositoryPackaging.cmake</a>.  (Note that
install commands from the former two files are run before install commands for
the enabled packages while install commands from the latter two files are run
after.)</p>
<p>One can also change what compilers are written into the generated
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;Config.cmake</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;Package&gt;Config.cmake</span></code> files for the build
and the install trees.  By default, the compilers pointed to in these
<code class="docutils literal notranslate"><span class="pre">Config.cmake</span></code> files will be <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_COMPILER</span></code> where <code class="docutils literal notranslate"><span class="pre">&lt;LANG&gt;</span></code> =
<code class="docutils literal notranslate"><span class="pre">CXX</span></code>, <code class="docutils literal notranslate"><span class="pre">C</span></code>, and <code class="docutils literal notranslate"><span class="pre">Fortran</span></code>.  But one can change this by setting any of
the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">CMAKE_CXX_COMPILER_FOR_CONFIG_FILE_BUILD_DIR</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="n">CMAKE_C_COMPILER_FOR_CONFIG_FILE_BUILD_DIR</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="n">CMAKE_Fortran_COMPILER_FOR_CONFIG_FILE_BUILD_DIR</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="n">CMAKE_CXX_COMPILER_FOR_CONFIG_FILE_INSTALL_DIR</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="n">CMAKE_C_COMPILER_FOR_CONFIG_FILE_INSTALL_DIR</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;</span><span class="p">)</span>
<span class="nb">set</span><span class="p">(</span><span class="n">CMAKE_Fortran_COMPILER_FOR_CONFIG_FILE_INSTALL_DIR</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>before the <code class="docutils literal notranslate"><span class="pre">Config.cmake</span></code> files are generated.  These can also be set in the
CMake cache using, for example,
<code class="docutils literal notranslate"><span class="pre">-DCMAKE_CXX_COMPILER_FOR_CONFIG_FILE_INSTALL_DIR:FILEPATH=&lt;path&gt;</span></code>.</p>
<p>This is used, for example, when compiler wrappers are used for the build tree
and are set to <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_COMPILER</span></code> but when one wants to point to the
original underlying compilers for the installed <code class="docutils literal notranslate"><span class="pre">Config.cmake</span></code> files.</p>
</section>
<section id="rpath-handling">
<h2><a class="toc-backref" href="#id92"><span class="sectnum">10.9</span> RPATH Handling</a><a class="headerlink" href="#rpath-handling" title="Permalink to this heading"></a></h2>
<p>As explained in <a class="reference external" href="TribitsBuildReference.html#setting-install-rpath">Setting install RPATH</a>, TriBITS changes the CMake defaults
to write in the RPATH for shared libraries and executables so that they run
right out of the install directory without needing to set paths in the
environment (e.g. <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code>).  However, these defaults can be
changed by changing setting different project defaults for the variables
<a class="reference internal" href="#project-name-set-install-rpath">${PROJECT_NAME}_SET_INSTALL_RPATH</a> and <a class="reference internal" href="#cmake-install-rpath-use-link-path">CMAKE_INSTALL_RPATH_USE_LINK_PATH</a>.
But most projects should likely keep these defaults in place since they make
it so that doing builds and installations on a single machine work correctly
by default out of the box.  For other installation/distribution use cases, the
user is told how to manipulate CMake variables for those cases in <a class="reference external" href="TribitsBuildReference.html#setting-install-rpath">Setting
install RPATH</a>.</p>
</section>
<section id="configure-time-system-tests">
<h2><a class="toc-backref" href="#id93"><span class="sectnum">10.10</span> Configure-time System Tests</a><a class="headerlink" href="#configure-time-system-tests" title="Permalink to this heading"></a></h2>
<p>CMake has good support for defining configure-time checks of the system to
help in configuring the project.  One can check for whether a header file
exists, if the compiler supports a given data-type or language feature, or
perform almost any other type of check that one can imagine that can be done
using the configured compilers, libraries, system tools, etc.  An example was
given in <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>.  Just follow that example, look at some of
the built-in CMake configure-time test modules, and consult provided on-line
CMake documentation in order to learn how to create a configure-time test for
almost anything.</p>
</section>
<section id="creating-source-distributions">
<h2><a class="toc-backref" href="#id94"><span class="sectnum">10.11</span> Creating Source Distributions</a><a class="headerlink" href="#creating-source-distributions" title="Permalink to this heading"></a></h2>
<p>The TriBITS system uses CMake’s built-in CPack support to create source
distributions in a variety of zipped and tarred formats.  (Note that the term
“source tarball” or just “tarball” may be used below but should be interpreted
as “source distribution”.)  TriBITS will automatically add support for CPack
when the variable <a class="reference internal" href="#project-name-enable-cpack-packaging">${PROJECT_NAME}_ENABLE_CPACK_PACKAGING</a> is set to <code class="docutils literal notranslate"><span class="pre">ON</span></code>.
The commands for creating a source distribution are described in <a class="reference external" href="TribitsBuildReference.html#creating-a-tarball-of-the-source-tree">Creating a
tarball of the source tree</a> using the built-in <code class="docutils literal notranslate"><span class="pre">package_source</span></code> build
target. The value added by TriBITS is that TriBITS will automatically exclude
the source for any defined packages that are not enabled and TriBITS provides
a framework for systematically excluding files and directories from individual
repositories and packages.  In addition, the source for non-enabled
subpackages can also be excluded depending on the value of
<a class="reference internal" href="#project-name-exclude-disabled-subpackages-from-distribution">${PROJECT_NAME}_EXCLUDE_DISABLED_SUBPACKAGES_FROM_DISTRIBUTION</a>.  All of
this allows one to create distributions which only includes subsets of a
larger project (even a single package in some cases).</p>
<p>Unlike other build systems (like autotools), CMake will put <strong>EVERYTHING</strong>
into the source distribution (e.g. tarball) that is sitting in the source tree
by default.  Therefore, setting up for a source distribution usually means
deciding what extra files and directories should be excluded.  Beyond the
directories for non-enabled packages, further files can be selected to be
excluded on a package-by-package based and at the repository level (see
below).</p>
<p>Individual packages can list additional files/directories under the package’s
source tree to be excluded from the project’s source distribution using a call
to <a class="reference internal" href="#tribits-exclude-files">tribits_exclude_files()</a> in their <a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file.
Note that if the package is not enabled, these excludes will never get added!
That is no problem if these excludes only apply to the given package since
TriBITS will add an exclude for the entire package but is a problem if a
package lists excludes for files outside of the package’s source tree.</p>
<p>Additional files and entire directories can also be excluded at the repository
level by listing them in the
<a class="reference internal" href="#repodir-cmake-callbackdefinerepositorypackaging-cmake">&lt;repoDir&gt;/cmake/CallbackDefineRepositoryPackaging.cmake</a> file which
typically just appends the built-in CMake variable
<code class="docutils literal notranslate"><span class="pre">CPACK_SOURCE_IGNORE_FILES</span></code>.  However, if a repository is not processed,
this file is never processed and therefore no files will be excluded from a
repository sitting in the source tree that is not processed (see below).</p>
<p>There are a number of project-level settings that need to be defined and these
are specified in the file
<a class="reference internal" href="#projectdir-cmake-callbackdefineprojectpackaging-cmake">&lt;projectDir&gt;/cmake/CallbackDefineProjectPackaging.cmake</a>.</p>
<p>The <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a> is set up for creating source distributions and
this is demonstrated in one of the tests defined in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TriBITS</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">ExamplesUnitTests</span><span class="o">/</span><span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>There are a few points of caution to note about creating source distributions.</p>
<p><strong>NOTE:</strong> It is worth stressing again that <strong>EVERY</strong> file that is in the
source tree will be included in the source distribution (tarball) unless there
is an exclude regex matching it appended to the variable
<code class="docutils literal notranslate"><span class="pre">CPACK_SOURCE_IGNORE_FILES</span></code>.  TriBITS can only add excludes for defined
non-enabled packaged.  Every other file listed in the source tree will be
included in the tarball.</p>
<p><strong>NOTE:</strong> The entries in <code class="docutils literal notranslate"><span class="pre">CPACK_SOURCE_IGNORE_FILES</span></code> are interpreted as
<strong>REGULAR EXPRESSIONS</strong> not globs so if you add <code class="docutils literal notranslate"><span class="pre">&quot;someFile.*&quot;</span></code> as an
exclude, it will exclude every file in the entire source tree that has
<code class="docutils literal notranslate"><span class="pre">&quot;someFile&quot;</span></code> in the name!  This is because, in regex terminology, the
trailing <code class="docutils literal notranslate"><span class="pre">&quot;.*&quot;</span></code> means “match any character zero or more times” and
<code class="docutils literal notranslate"><span class="pre">&quot;someFile&quot;</span></code> can match anywhere in the file name path.  Also, note that if
you add in an exclude like <code class="docutils literal notranslate"><span class="pre">&quot;*.pyc&quot;</span></code> (i.e. trying to exclude all of the
generated Python byte code files) that it will exclude every file that has
<code class="docutils literal notranslate"><span class="pre">&quot;pyc&quot;</span></code> in the name and <strong>not</strong> just those with the file extension
<code class="docutils literal notranslate"><span class="pre">&quot;pyc&quot;</span></code>.  For example, the exclude <code class="docutils literal notranslate"><span class="pre">&quot;.pyc&quot;</span></code> would exclude the files
<code class="docutils literal notranslate"><span class="pre">&quot;puppyc&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;lpycso&quot;</span></code>, etc.  If you want to exclude all files with
extension <code class="docutils literal notranslate"><span class="pre">&quot;pyc&quot;</span></code>, you have to add the exclude regex <code class="docutils literal notranslate"><span class="pre">&quot;.*[.]pyc$&quot;</span></code>!
One’s lack of understanding of this fact will cost someone hours of lost time
debugging what happens when random files are missing when one tries to
configure what is left.  Sometimes, what is left will actually configure and
might almost build!</p>
<p><strong>NOTE:</strong> As warned in <a class="reference internal" href="#tribits-package-core-files">TriBITS Package Core Files</a> and <a class="reference internal" href="#tribits-subpackage-core-files">TriBITS Subpackage
Core Files</a>, SE Packages must have directories that are strictly independent
of the directories of other SE packages.  If they don’t, then the source
directory for an enabled package will get excluded from the source
distribution if its directory is under the directory of a package that is not
enabled.  For example, if <code class="docutils literal notranslate"><span class="pre">PackageA</span></code> is enabled but its package directory
<code class="docutils literal notranslate"><span class="pre">packageb/packagea/</span></code> is under the package directory <code class="docutils literal notranslate"><span class="pre">packageb/</span></code> for the
disabled package <code class="docutils literal notranslate"><span class="pre">PackageB</span></code>, then every file and directory under
<code class="docutils literal notranslate"><span class="pre">packageb/</span></code> will be excluded from the source distribution (tarball),
including everything under <code class="docutils literal notranslate"><span class="pre">packageb/packagea/</span></code>!  It would be too expensive
to put in an automated check for cases like this so package developers should
just take care not to nest the directories of packages inside of each other to
avoid problems like this.</p>
<p><strong>NOTE:</strong> Extra repositories that are sitting in the source tree but not
processed by TriBITS for some reason (e.g. due to explicitly listing in the
variable <a class="reference internal" href="#project-name-extra-repositories">${PROJECT_NAME}_EXTRA_REPOSITORIES</a> only a subset of the repositories
listed in <a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> ) will get added
to the source distribution in full by default even though there are no enabled
packages from these repos.  These non-processed repo dirs are like any other
random directory sitting in the source tree, they will get copied over into
the source distribution!.</p>
<p><strong>NOTE:</strong> When debugging tarball creation problems, always configure with the
variable <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_DUMP_CPACK_SOURCE_IGNORE_FILES=ON</span></code>.  If you don’t see a
regex listed for the file or directory you expect to be excluded, then that
file/directory it will be included in the source distribution!</p>
</section>
<section id="using-git-bisect-with-checkin-test-py-workflows">
<h2><a class="toc-backref" href="#id95"><span class="sectnum">10.12</span> Using Git Bisect with checkin-test.py workflows</a><a class="headerlink" href="#using-git-bisect-with-checkin-test-py-workflows" title="Permalink to this heading"></a></h2>
<p>There are cases where a customer will do an update of an upstream project from
a git repo and then find out that some feature or behavior is broken with
respect to their usage.  This can happen even if the upstream project’s own
test suite passes all of its tests.  Depending on the situation, there may be
hundreds to thousands of commits between the last known “good” working version
of the code and pulled “bad” version.  To help customers find the first commit
that contains the changes which are causing the breakage, git supplies <code class="docutils literal notranslate"><span class="pre">git</span>
<span class="pre">bisect</span></code>.  This set of commands does a binary search of the commits in the
range <code class="docutils literal notranslate"><span class="pre">&lt;good-sha&gt;..&lt;bad_sha&gt;</span></code> and finds the first commit that is “bad” (or a
range of commits which contains the first “bad” commit if commits are skipped,
as described below).</p>
<p>But the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code> commands require that all of the commits in the range
<code class="docutils literal notranslate"><span class="pre">&lt;good-sha&gt;..&lt;bad_sha&gt;</span></code> be complete commits that provide full working
versions of the upstream project.  However, many beginning git developers and
even many experienced developers don’t always create individual git commits
that build and pass all of the upstream project’s tests and therefore can
create false “bad” commits during the binary search.  This can happen when
developers create intermediate “check-point” commits during the development
process but did not squash the intermediate commits together to create
cohesive working commits.  This can also happen when experienced developers
have a set of what they believe are all working commits but do not actually
test all of the commits to know that they pass <em>all</em> of the upstream project’s
tests before pushing these commits to the main development branch.  This lack
of detailed testing of each and every individual commit can give rise to false
“bad” commits which will result in <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code> reporting the wrong first
“bad” commit.</p>
<p>Projects that use the <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> tool to push sets of commits to the
main development branch have an advantage in the usage of <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code>.
This is because the default mode of the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> script is to amend
the top commit message with a summary of what was tested and therefore marks a
set of commits that are known to have more complete testing.  For example, the
<code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool amends the top commit (after the final pull and
rebase by default) as shown in the following Trilinos commit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">commit</span> <span class="mi">71</span><span class="n">ce56bd2d268922fda7b8eca74fad0ffbd7d807</span>
<span class="n">Author</span><span class="p">:</span> <span class="n">Roscoe</span> <span class="n">A</span><span class="o">.</span> <span class="n">Bartlett</span> <span class="o">&lt;</span><span class="n">bartlettra</span><span class="nd">@ornl</span><span class="o">.</span><span class="n">gov</span><span class="o">&gt;</span>
<span class="n">Date</span><span class="p">:</span>   <span class="n">Thu</span> <span class="n">Feb</span> <span class="mi">19</span> <span class="mi">12</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">11</span> <span class="mi">2015</span> <span class="o">-</span><span class="mi">0500</span>

    <span class="n">Define</span> <span class="n">HAVE_TEUCHOSCORE_CXX11</span> <span class="ow">in</span> <span class="n">TeuchosCore_config</span><span class="o">.</span><span class="n">h</span>

    <span class="n">This</span> <span class="n">makes</span> <span class="n">TeuchosCore</span> <span class="n">a</span> <span class="n">good</span> <span class="n">example</span> <span class="k">for</span> <span class="n">how</span> <span class="n">Trilinos</span> <span class="p">(</span><span class="ow">or</span> <span class="nb">any</span> <span class="n">TriBITS</span><span class="p">)</span>
    <span class="n">subpackages</span> <span class="n">should</span> <span class="n">put</span> <span class="ow">in</span> <span class="n">an</span> <span class="n">optional</span> <span class="n">dependency</span> <span class="n">on</span> <span class="n">C</span><span class="o">++</span><span class="mf">11.</span>

    <span class="n">Build</span><span class="o">/</span><span class="n">Test</span> <span class="n">Cases</span> <span class="n">Summary</span>
    <span class="n">Enabled</span> <span class="n">Packages</span><span class="p">:</span> <span class="n">TeuchosCore</span>
    <span class="n">Disabled</span> <span class="n">Packages</span><span class="p">:</span> <span class="p">[</span><span class="o">...</span><span class="p">]</span>
    <span class="mi">0</span><span class="p">)</span> <span class="n">MPI_DEBUG</span> <span class="o">=&gt;</span> <span class="n">passed</span><span class="p">:</span> <span class="n">passed</span><span class="o">=</span><span class="mi">44</span><span class="p">,</span><span class="n">notpassed</span><span class="o">=</span><span class="mi">0</span> <span class="p">(</span><span class="mf">2.61</span> <span class="nb">min</span><span class="p">)</span>
    <span class="mi">1</span><span class="p">)</span> <span class="n">SERIAL_RELEASE</span> <span class="o">=&gt;</span> <span class="n">passed</span><span class="p">:</span> <span class="n">passed</span><span class="o">=</span><span class="mi">43</span><span class="p">,</span><span class="n">notpassed</span><span class="o">=</span><span class="mi">0</span> <span class="p">(</span><span class="mf">1.08</span> <span class="nb">min</span><span class="p">)</span>
</pre></div>
</div>
<p>Therefore, these special known-tested commits can be flagged by grepping the
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">log</span> <span class="pre">-1</span> <span class="pre">HEAD</span></code> output for the string <code class="docutils literal notranslate"><span class="pre">&quot;Build/Test</span> <span class="pre">Cases</span> <span class="pre">Summary&quot;</span></code>.  By
bisecting on these commits, one has a lower chance of encountering false “bad”
commits and has a higher chance of finding a smaller range of commits where
the first true “bad” commit might be found.  To aid in performing <code class="docutils literal notranslate"><span class="pre">git</span>
<span class="pre">bisect</span></code> and only checking <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code>-tested commits, the tool
<a class="reference internal" href="#is-checkin-tested-commit-py">is_checkin_tested_commit.py</a> is provided.</p>
<p>To demonstrate how the <code class="docutils literal notranslate"><span class="pre">is_checkin_tested_commit.py</span></code> tool can be used with
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code>, suppose that someone writes a customized script
<code class="docutils literal notranslate"><span class="pre">build_and_test_customer_code.sh</span></code> that will build the upstream project and
the downstream customer’s code and then run a set of tests to see if the “bad”
behavior seen by the customer code is the current <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> version of the
upstream project.  Assume this script is copied into the upstream project’s
local git repo using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd &lt;upstream-repo&gt;/
$ cp ~/build_and_test_customer_code.sh .
$ cat /build_and_test_customer_code.sh &gt;&gt; .git/info/exclude
</pre></div>
</div>
<p>Now, one could use <code class="docutils literal notranslate"><span class="pre">build_and_test_customer_code.sh</span></code> directly with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git bisect run ./build_and_test_customer_code.sh
</pre></div>
</div>
<p>but that would result in testing <em>all</em> the commits which may have a high
chance of producing false “bad” commits as described above and fail to
correctly bracket the location of the true first “bad” commit.</p>
<p>So instead, one can write a filtered testing script
<code class="docutils literal notranslate"><span class="pre">safe_build_and_test_customer_code.sh</span></code> which calls
<code class="docutils literal notranslate"><span class="pre">is_checkin_tested_commit.py</span></code> and <code class="docutils literal notranslate"><span class="pre">build_and_test_customer_code.sh</span></code> as
follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash
#
# Script: safe_build_and_test_customer_code.sh

$TRIBITS_DIR/ci_support/is_checkin_tested_commit.py
IS_CHECKIN_TESTED_COMMIT_RTN=$?
if [ &quot;$IS_CHECKIN_TESTED_COMMIT_RTN&quot; != &quot;0&quot; ] ; then
  exit 125 # Skip the commit because HEAD is not known to be tested!
fi

./build_and_test_customer_code.sh  # Rtn 0 &quot;good&quot;, or [1, 124] if &quot;bad&quot;
</pre></div>
</div>
<p>The above test script <code class="docutils literal notranslate"><span class="pre">safe_build_and_test_customer_code.sh</span></code> will skip the
testing of commits that are not marked by the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool.</p>
<p>To demonstrate how to use the <code class="docutils literal notranslate"><span class="pre">is_checkin_tested_commit.py</span></code> script with
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code>, an example from Trilinos is used below.  (Note that the
current Trilinos public repository may have been filtered so the commit SHA1s
shown below may not match what is in the current Trilinos repository.  But one
can use the commit summary message, author, and author date to find the
updated SHA1s and then to update this example for the current repository.)</p>
<p>Consider a scenario where a customer application updates Trilinos from the
commit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d44c17d</span> <span class="s2">&quot;Merge branch &#39;master&#39; of software.sandia.gov:/space/git/Trilinos&quot;</span>
<span class="n">Author</span><span class="p">:</span> <span class="n">Roscoe</span> <span class="n">A</span><span class="o">.</span> <span class="n">Bartlett</span> <span class="o">&lt;</span><span class="n">xxx</span><span class="nd">@ornl</span><span class="o">.</span><span class="n">gov</span><span class="o">&gt;</span>
<span class="n">Date</span><span class="p">:</span>   <span class="n">Tue</span> <span class="n">May</span> <span class="mi">26</span> <span class="mi">12</span><span class="p">:</span><span class="mi">43</span><span class="p">:</span><span class="mi">25</span> <span class="mi">2015</span> <span class="o">-</span><span class="mi">0400</span>
</pre></div>
</div>
<p>to the commit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">605</span><span class="n">b91b</span> <span class="s2">&quot;Merge branch &#39;master&#39; of software.sandia.gov:/git/Trilinos&quot;</span>
<span class="n">Author</span><span class="p">:</span> <span class="n">Vitus</span> <span class="n">Leung</span> <span class="o">&lt;</span><span class="n">xxx</span><span class="nd">@sandia</span><span class="o">.</span><span class="n">gov</span><span class="o">&gt;</span>
<span class="n">Date</span><span class="p">:</span>   <span class="n">Tue</span> <span class="n">Sep</span> <span class="mi">29</span> <span class="mi">20</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">54</span> <span class="mi">2015</span> <span class="o">-</span><span class="mi">0600</span>
</pre></div>
</div>
<p>and it is found that some critical feature broke or is not behaving acceptably
for the customer code (but all of the tests for Trilinos pass just fine).
This range of commits <code class="docutils literal notranslate"><span class="pre">d44c17d..605b91b</span></code> gives 2257 commits to search as
shown by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd Trilinos/
$ git log-oneline d44c17d..605b91b | wc -l
2257
</pre></div>
</div>
<p>However, as described above, it is likely that doing <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code> on that
full set of 2257 commits may result in hitting false “bad” commits and
therefore result in a false bracketing of the first “bad” commit.  This is
where the usage of the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool helps which is used by many
(but not currently all) Trilinos developers to push changes to the Trilinos
‘master’ branch in the current single-branch workflow.  The commits marked
with the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool are known (with some caveats mentioned
below) to be working commits and for this the range of commits
<code class="docutils literal notranslate"><span class="pre">d44c17d..605b91b</span></code> yields 166 commits as shown by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git log-oneline --grep=&quot;Build/Test Cases Summary&quot; d44c17d..605b91b | wc -l
166
</pre></div>
</div>
<p>That is an average of 2257/166 = 13.6 commits between commits pushed with the
<code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool.  So bisecting on just the commits marked by
<code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> should bound the “bad” commit in a set of 13.6 commits on
average.  Bisecting on this set of 166 commits should likely give no false
“bad” commits, and therefore result in the correct bracketing of the first
“bad” commit.</p>
<p>Using the <code class="docutils literal notranslate"><span class="pre">safe_build_and_test_customer_code.sh</span></code> shown above, one would
search for the first bad commit over this range using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git bisect start 605b91b d44c17d
$ env DUMMY_TEST_COMMIT_BAD_SHA=83f05e8 \
    time git bisect run ./safe_build_and_test_customer_code.sh
</pre></div>
</div>
<p>and this would return the range of commits that contains the first “bad”
commit (listed at the end of <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span> <span class="pre">log</span></code> output, see example below).</p>
<p>To provide a concrete example, suppose the commit that first introduced the
problem in the range of commits <code class="docutils literal notranslate"><span class="pre">d44c17d..605b91b</span></code> was:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">83</span><span class="n">f05e8</span> <span class="s2">&quot;MueLu: stop semi-coarsening if no z-layers are left.&quot;</span>
<span class="n">Author</span><span class="p">:</span> <span class="n">Tobias</span> <span class="n">Wiesner</span> <span class="o">&lt;</span><span class="n">tawiesn</span><span class="nd">@sandia</span><span class="o">.</span><span class="n">gov</span><span class="o">&gt;</span>
<span class="n">Date</span><span class="p">:</span>   <span class="n">Wed</span> <span class="n">Jul</span> <span class="mi">1</span> <span class="mi">14</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="mi">20</span> <span class="mi">2015</span> <span class="o">-</span><span class="mi">0600</span>
</pre></div>
</div>
<p>And instead of using the script <code class="docutils literal notranslate"><span class="pre">safe_build_and_test_customer_code.sh</span></code>, we
use a dummy driver script <code class="docutils literal notranslate"><span class="pre">dummy_test_commit.sh</span></code> to simulate this which is
provided in the set of TriBITS documentation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$TRIBITS_DIR/doc/developers_guide/scripts/dummy_test_commit.sh
</pre></div>
</div>
<p>as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash
#
# Script: dummy_test_commit.sh
#
# This script simulates a test script used with &#39;git bisect run &lt;script&gt;&#39; to
# show how to use the is_checkin_tested_commit.py script to skip commits that
# are not known to be tested with the checkin-test.py script.  To use this
# script, set the env variable DUMMY_TEST_COMMIT_BAD_SHA to the SHA1 of a
# commit that you are pretending is the bad commit in the range of commits
# &lt;good-commit&gt;..&lt;bad-commit&gt; and then run:
#
#   git bisect &lt;bad-commit&gt; &lt;good-commit&gt;
#   git bisect run ./dummy_test_commit.sh
#
# This should result in git-bisect bounding the commits around
# $DUMMY_TEST_COMMIT_BAD_SHA.  To see the sorted set of commits containing the
# first bad commit, run:
#
#   git bisect log | grep &quot;possible first bad commit&quot;
#

LOG_DUMMY_COMMIT=`git log --oneline HEAD ^$DUMMY_TEST_COMMIT_BAD_SHA^`
if [ &quot;$LOG_DUMMY_COMMIT&quot; == &quot;&quot; ] ; then
  echo &quot;Commit is *before* bad commit $DUMMY_TEST_COMMIT_BAD_SHA!&quot;
else
  echo &quot;Commit is or after *after* bad commit $DUMMY_TEST_COMMIT_BAD_SHA!&quot;
fi    

# Skip the commit if not tested with checkin-test.py script
$TRIBITS_DIR/ci_support/is_checkin_tested_commit.py
IS_CHECKIN_TESTED_COMMIT_RTN=$?
if [ &quot;$IS_CHECKIN_TESTED_COMMIT_RTN&quot; != &quot;0&quot; ] ; then
  exit 125 # Skip the commit because it was not known to be tested!
fi

echo &quot;Building the current version ...&quot;
if [ &quot;$LOG_DUMMY_COMMIT&quot; == &quot;&quot; ] ; then
echo &quot;Commit is *before* bad commit $DUMMY_TEST_COMMIT_BAD_SHA! so marking good!&quot;
  exit 0
else
  echo &quot;Commit is or *after* bad commit $DUMMY_TEST_COMMIT_BAD_SHA so marking bad!&quot;
  exit 1
fi    
</pre></div>
</div>
<p>This driver script allows one to simulate the usage of <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code> to
understand how it works without having to actually build and test code.  It is
a useful training and experimentation tool.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code> (with git version 2.1.0) over the range of commits
<code class="docutils literal notranslate"><span class="pre">d44c17d..605b91b</span></code> searching for the first “bad” commit is done by running
the commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git bisect start 605b91b d44c17d
$ env DUMMY_TEST_COMMIT_BAD_SHA=83f05e8 \
    time git bisect run \
    $TRIBITS_DIR/doc/developers_guide/scripts/dummy_test_commit.sh \
    &amp;&gt; ../git_bisect_run.log
$ git2 bisect log &amp;&gt; ../git_bisect_log.log
$ cat ../git_bisect_log.log | grep &quot;possible first bad commit&quot; | \
    sed &quot;s/possible first bad commit://g&quot;  | sed &quot;s/[a-z0-9]\{30\}\]/]/g&quot;
$ git bisect reset
</pre></div>
</div>
<p>This set of commands yield the output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Bisecting</span><span class="p">:</span> <span class="mi">1128</span> <span class="n">revisions</span> <span class="n">left</span> <span class="n">to</span> <span class="n">test</span> <span class="n">after</span> <span class="n">this</span> <span class="p">(</span><span class="n">roughly</span> <span class="mi">10</span> <span class="n">steps</span><span class="p">)</span>
<span class="p">[</span><span class="mi">9634</span><span class="n">d462dba77704b598e89ba69ba3ffa5a71471</span><span class="p">]</span> <span class="n">Revert</span> <span class="s2">&quot;Trilinos: remove _def.hpp [...]&quot;</span>

<span class="n">real</span>  <span class="mi">1</span><span class="n">m22</span><span class="mf">.961</span><span class="n">s</span>
<span class="n">user</span>  <span class="mi">0</span><span class="n">m57</span><span class="mf">.157</span><span class="n">s</span>
<span class="n">sys</span>   <span class="mi">3</span><span class="n">m40</span><span class="mf">.376</span><span class="n">s</span>

<span class="c1">#  [165067ce53] MueLu: SemiCoarsenPFactory. Use strided maps to properly transfer [...]</span>
<span class="c1">#  [ada21a95a9] MueLu: refurbish LineDetectionFactory</span>
<span class="c1">#  [83f05e8970] MueLu: stop semi-coarsening if no z-layers are left.</span>

<span class="n">Previous</span> <span class="n">HEAD</span> <span class="n">position</span> <span class="n">was</span> <span class="mi">83</span><span class="n">f05e8</span><span class="o">...</span> <span class="n">MueLu</span><span class="p">:</span> <span class="n">stop</span> <span class="n">semi</span><span class="o">-</span><span class="n">coarsening</span> <span class="k">if</span> <span class="n">no</span> <span class="n">z</span><span class="o">-</span><span class="n">layers</span> <span class="n">are</span> <span class="n">left</span><span class="o">.</span>
<span class="n">Switched</span> <span class="n">to</span> <span class="n">branch</span> <span class="s1">&#39;master&#39;</span>
</pre></div>
</div>
<p>This output shows the dummy bad commit 83f05e8 in a set of just 3 commits,
bounded in the set of commits <code class="docutils literal notranslate"><span class="pre">8b79832..165067c</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">165067</span><span class="n">c</span> <span class="s2">&quot;MueLu: SemiCoarsenPFactory. Use strided maps to properly [...].&quot;</span>
<span class="n">Author</span><span class="p">:</span> <span class="n">Tobias</span> <span class="n">Wiesner</span> <span class="o">&lt;</span><span class="n">tawiesn</span><span class="nd">@sandia</span><span class="o">.</span><span class="n">gov</span><span class="o">&gt;</span>
<span class="n">Date</span><span class="p">:</span>   <span class="n">Thu</span> <span class="n">Jul</span> <span class="mi">2</span> <span class="mi">12</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">24</span> <span class="mi">2015</span> <span class="o">-</span><span class="mi">0600</span>

<span class="mi">8</span><span class="n">b79832</span> <span class="s2">&quot;Ifpack2: RBILUK: adding additional ETI types&quot;</span>
<span class="n">Author</span><span class="p">:</span> <span class="n">Jonathan</span> <span class="n">Hu</span> <span class="o">&lt;</span><span class="n">jhu</span><span class="nd">@sandia</span><span class="o">.</span><span class="n">gov</span><span class="o">&gt;</span>
<span class="n">Date</span><span class="p">:</span>   <span class="n">Thu</span> <span class="n">Jul</span> <span class="mi">2</span> <span class="mi">14</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">40</span> <span class="mi">2015</span> <span class="o">-</span><span class="mi">0700</span>
</pre></div>
</div>
<p>The set of commits that were actually tested by <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span> <span class="pre">run</span> <span class="pre">&lt;script&gt;</span></code> is
shown by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat ../git_bisect_log.log | grep &quot;\(good:\|bad:\)&quot; | sed &quot;s/[a-z0-9]\{30\}\]/]/g&quot;
# bad: [605b91b012] Merge branch &#39;master&#39; of software.sandia.gov:/git/Trilinos
# good: [d44c17d5d2] Merge branch &#39;master&#39; of software.sandia.gov:/space/git/Trilinos
# good: [7e13a95774] Ifpack2: If the user does not provide the bandwidth of the banded [...]
# bad: [7335d8bc92] MueLu: fix documentation
# bad: [9997ecf0ba] Belos::LSQRSolMgr: Fixed bug in setParameters.
# bad: [b6e0453224] MueLu: add a nightly test for the combination of semicoarsening [...]
# bad: [165067ce53] MueLu: SemiCoarsenPFactory. Use strided maps to properly [...]
# good: [3b5453962e] Ifpack2: Nuking the old ETI system
# good: [8b79832f1d] Ifpack2: RBILUK: adding additional ETI types
</pre></div>
</div>
<p>This is only 9 commits out of the possible set of 166 <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code>
marked commits which is out of the total set of 2257 possible commits.  With
just 9 build/test cycles, it bounded the first “bad” commit in a set of 3
commits in this case.  And it does not matter how sloppy or broken the
intermediate commits are in Trilinos.  All that matters is the usage of the
<code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool (another motivation for the usage of the
<code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool, see <a class="reference internal" href="#pre-push-testing-using-checkin-test-py">Pre-push Testing using checkin-test.py</a> for
others as well).</p>
<p>Note that above, we grep the output from <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span> <span class="pre">log</span></code> for the set of
possible “bad” commits instead of just looking at the output from the <code class="docutils literal notranslate"><span class="pre">git</span>
<span class="pre">bisect</span> <span class="pre">run</span> <span class="pre">&lt;script&gt;</span></code> command (which also lists the set of possible “bad”
commits).  This is because the direct output from the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span> <span class="pre">run</span>
<span class="pre">&lt;script&gt;</span></code> command (shown in the log file <code class="docutils literal notranslate"><span class="pre">git_bisect_run.log</span></code>) shows the
set of possible bad commits at the end of the output but they are unsorted and
give no other git commit information:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>There are only &#39;skip&#39;ped commits left to test.
The first bad commit could be any of:
83f05e89706590c4b384dd191f51ef4ab00ce9bb
ada21a95a991cd238581e5a6a96800d209a57924
165067ce538af2cd0bd403e2664171726ec86f3f
We cannot bisect more!
bisect run cannot continue any more
</pre></div>
</div>
<p>The problem with unsorted commits is that it is difficult to use an unsorted
set to do further bisection.  However, the output of the set of commits from
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span> <span class="pre">log</span></code> is sorted and also shows the commit summary message and
therefore is much more useful.  (But note that older versions of git don’t
show this set of commits at the end of <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span> <span class="pre">log</span></code> so make sure and use
an updated version of git, preferably &gt;= 2.1.0.)</p>
<p>Now that one has the range of possible “bad” commits (just 3 in this example)
doing a further manual bisection or even manual inspection of these commits
may be enough to find the change that is causing the problem for the
downstream customer application.</p>
<p>Without the usage of the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool, one would not have an
automated way to ensure that <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code> avoids false “bad” commits.  This
allows for less experienced developers to create commits and push to the main
development branch but still ensure effective usage of <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code>.  (This
is another example where automated tools in TriBITS help to overcome lacking
developer experience and discipline.)</p>
</section>
<section id="multi-repository-almost-continuous-integration">
<h2><a class="toc-backref" href="#id96"><span class="sectnum">10.13</span> Multi-Repository Almost Continuous Integration</a><a class="headerlink" href="#multi-repository-almost-continuous-integration" title="Permalink to this heading"></a></h2>
<p>The <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> tool can be used to the implement staged integration of
the various repositories in a multi-repo TriBITS project (see
<a class="reference internal" href="#multi-repository-support">Multi-Repository Support</a>) .  This is referred to here as Almost Continuous
Integration (ACI).  The basic concept of Almost Continuous Integration (ACI)
is defined and described in the paper [<a class="reference internal" href="#integration-strategies-for-cse-2009">Integration Strategies for CSE,
2009</a>].</p>
<p>This topic is broken down into the following subsections:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#aci-multi-git-tribits-repo-integration-example">ACI Multi-Git/TriBITS Repo Integration Example</a></p></li>
<li><p><a class="reference internal" href="#aci-local-sync-git-repo-setup">ACI Local Sync Git Repo Setup</a></p></li>
<li><p><a class="reference internal" href="#aci-integration-build-directory-setup">ACI Integration Build Directory Setup</a></p></li>
<li><p><a class="reference internal" href="#aci-sync-driver-script">ACI Sync Driver Script</a></p></li>
<li><p><a class="reference internal" href="#aci-cron-job-setup">ACI Cron Job Setup</a></p></li>
<li><p><a class="reference internal" href="#addressing-aci-failures-and-summary">Addressing ACI Failures and Summary</a></p></li>
</ul>
<section id="aci-introduction">
<h3><a class="toc-backref" href="#id97">ACI Introduction</a><a class="headerlink" href="#aci-introduction" title="Permalink to this heading"></a></h3>
<p>The TriBITS system allows for setting up composite meta-builds of large
collections of software pulled in from many different git/TriBITS code
repositories as described in the section <a class="reference internal" href="#multi-repository-support">Multi-Repository Support</a>.  The
<a class="reference internal" href="#checkin-test-py">checkin-test.py</a> tool is a key tool to enable the testing of a set of
packages in different git/TriBITS repos before pushing to remote tracking
branches for the set of git repos; all in one robust command invocation.</p>
<p>While the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool was originally designed and its default
behavior is to test a set of local commits created by a developer before
pushing changes to one or more (public) git repos, it can also be used to set
up an Almost Continuous Integration (ACI) process to keep these various
git/TriBITS repos in sync thereby integrating the work of various disconnected
development teams and projects.  To use the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool for ACI
requires some setup and changing what the tool does a little by passing in
additional options that a regular developer typically never uses.</p>
<p>The following subsections describe how to use the <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> tool to
implement an ACI process for a given set of git/TriBITS repositories and also
provides a little background and context behind ACI.</p>
</section>
<section id="aci-multi-git-tribits-repo-integration-example">
<h3><a class="toc-backref" href="#id98">ACI Multi-Git/TriBITS Repo Integration Example</a><a class="headerlink" href="#aci-multi-git-tribits-repo-integration-example" title="Permalink to this heading"></a></h3>
<p>In order to set up the context for the ACI process, consider the following
simple TriBITS project with two extra repositories:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BaseProj</span><span class="o">/</span>
    <span class="n">ExtraRepo1</span>
    <span class="n">ExtraRepo2</span>
</pre></div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">BaseProj</span></code> is the base TriBITS project/repository and <code class="docutils literal notranslate"><span class="pre">ExtraRepo1</span></code>
and <code class="docutils literal notranslate"><span class="pre">ExtraRepo2</span></code> are extra repositories that supply additional TriBITS
packages that are appended to the TriBITS packages defined in <code class="docutils literal notranslate"><span class="pre">BaseProj</span></code>
(see <a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a>).  Also, assume that
<code class="docutils literal notranslate"><span class="pre">BaseProj</span></code>, <code class="docutils literal notranslate"><span class="pre">ExtraRepo1</span></code>, and <code class="docutils literal notranslate"><span class="pre">ExtraRepo2</span></code> are developed by three
different development teams that all have different funding sources and
different priorities so they tend not to work closely together or consider the
other efforts too much when developing their software.  However, in this
example, there is great value in combining all of this software into a single
integrated TriBITS meta-project.  This combined meta-build is driven by a 4th
integration/development team.  In this case, the core developers for each of
these three different git/TriBITS repos do not test compatibility with the
other git/TriBITS repos when pushing commits to their own git/TriBITS repos.
This gives three different git repos on three different machines:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">BaseProj</span></code> main repo:  Pushed to by the core BaseProj team:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">url1</span><span class="o">.</span><span class="n">gov</span><span class="p">:</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">BaseProj</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ExtraRepo1</span></code> main repo:  Pushed to by the core ExtraRepo1 team:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">url2</span><span class="o">.</span><span class="n">gov</span><span class="p">:</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">ExtraRepo1</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">ExtraRepo2</span></code> main repo:  Pushed to by the core ExtraRepo2 team:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">url3</span><span class="o">.</span><span class="n">gov</span><span class="p">:</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">ExtraRepo2</span>
</pre></div>
</div>
</li>
</ul>
<p>Because of the independent development processes of these three teams, unless
these development teams maintain 100% backward compatibility w.r.t. the
interfaces and behavior of the combined software, one cannot at any time pull
the code from these three different git repos and expect to be able to
successfully build all of the code and have all of the tests pass.  Therefore,
how does the 4th integration team expect to be able to build, test, and
possibly extend the combined software?  In this case, the integration team
would set up their own clones of all three git/TriBITS repos on their own
machine such as:</p>
<p><strong>Integration project mirrored git repos</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">url4</span><span class="o">.</span><span class="n">gov</span><span class="p">:</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">BaseProj</span>
<span class="n">url4</span><span class="o">.</span><span class="n">gov</span><span class="p">:</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">ExtraRepo1</span>
<span class="n">url4</span><span class="o">.</span><span class="n">gov</span><span class="p">:</span><span class="o">/</span><span class="n">git</span><span class="o">/</span><span class="n">ExtraRepo2</span>
</pre></div>
</div>
<p>Once an initial collaboration effort between the integration team and the
three other development teams is able to get a version of all three
git/TriBITS repos to work correctly in the combined meta-project, these
versions (assume the <code class="docutils literal notranslate"><span class="pre">master</span></code> branches) would be pushed to the git repos on
the git integration server <code class="docutils literal notranslate"><span class="pre">url4.gov</span></code>.  The state where the TriBITS packages
in the three different git/TriBITS repos in the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch on
<code class="docutils literal notranslate"><span class="pre">url4.gov</span></code> all work together correctly constitutes the initial condition for
the ACI process described below.  From that initial condition, the ACI
processes ensures that updates the <code class="docutils literal notranslate"><span class="pre">master</span></code> branches for the git/TriBITS
repos on <code class="docutils literal notranslate"><span class="pre">url4.gov</span></code> do not break any builds or tests of the integrated
software.</p>
<p>In order to describe how to set up an ACI process using the
<code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool, the following subsections will focus on the update
of the git/TriBITS <code class="docutils literal notranslate"><span class="pre">ExtraRepo1</span></code> repo keeping the other two git/TriBITS repos
<code class="docutils literal notranslate"><span class="pre">BaseProj</span></code> and <code class="docutils literal notranslate"><span class="pre">ExtraRepo2</span></code> constant as the ACI use case.</p>
</section>
<section id="aci-local-sync-git-repo-setup">
<h3><a class="toc-backref" href="#id99">ACI Local Sync Git Repo Setup</a><a class="headerlink" href="#aci-local-sync-git-repo-setup" title="Permalink to this heading"></a></h3>
<p>In order to set up an ACI process for the multi-git/TriBITS repo example
outlined above, first local repos are created by cloning the repos on the
integration server url4.gov as follows (all of which become ‘origin’):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd $SYNC_BASE_DIR
$ git clone url4.gov:/git/BaseProj
$ cd BaseProj
$ git clone url4.gov:/git/ExtraRepo1
$ git clone url4.gov:/git/ExtraRepo2
</pre></div>
</div>
<p>where, <code class="docutils literal notranslate"><span class="pre">SYNC_BASE_DIR=~/sync_base_dir</span></code> for example, which must already be
created.</p>
<p>Next, one defines a remote to pull changes for the <code class="docutils literal notranslate"><span class="pre">ExtraRepo1</span></code> from the
main development repo:</p>
<blockquote>
<div><p>$ cd $SYNC_BASE_DIR/BaseProj/ExtraRepo1
$ git remote add public url2.gov:/git/ExtraRepo1</p>
</div></blockquote>
<p>Here, one should pick a name for the remote repo for <code class="docutils literal notranslate"><span class="pre">ExtraRepo1</span></code> that is
most descriptive for that particular situation.  In this case, the name
<code class="docutils literal notranslate"><span class="pre">public</span></code> is chosen to signify the main public development repo.</p>
<p>This gives the remotes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd $SYNC_BASE_DIR/BaseProj
$ gitdist remote -v | grep -v push | grep -v &quot;^$&quot;
*** Base Git Repo: BaseProj
origin                url4.gov:/git/BaseProj (fetch)
*** Git Repo: ExtraRepo1
origin                url4.gov:/git/ExtraRepo1 (fetch)
public                url2.gov:/git/ExtraRepo1 (fetch)
*** Git Repo: ExtraRepo2
origin                url4.gov:/git/ExtraRepo2 (fetch)
</pre></div>
</div>
<p>The remote <code class="docutils literal notranslate"><span class="pre">public</span></code> is used by the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> wrapper script (see
<a class="reference internal" href="#aci-sync-driver-script">ACI Sync Driver Script</a> below) to pull and merge in additional changes that
will be tested and pushed to the ‘origin’ repos on <code class="docutils literal notranslate"><span class="pre">url4.gov</span></code>.  In this
case, the <code class="docutils literal notranslate"><span class="pre">ExtraRepo1</span></code> remote <code class="docutils literal notranslate"><span class="pre">public</span></code> will result in updates being pulled
from the main development repo on <code class="docutils literal notranslate"><span class="pre">url2.gov</span></code>, thereby facilitating the
update of <code class="docutils literal notranslate"><span class="pre">ExtraRepo1</span></code> in the integrated meta-project.</p>
</section>
<section id="aci-integration-build-directory-setup">
<h3><a class="toc-backref" href="#id100">ACI Integration Build Directory Setup</a><a class="headerlink" href="#aci-integration-build-directory-setup" title="Permalink to this heading"></a></h3>
<p>After the git repos are cloned and the remotes are set up as described above,
a build base directory is set up as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd $SYNC_BASE_DIR
$ mkdir BUILDS
$ mkdir BUILDS/CHECKIN
</pre></div>
</div>
<p>An ACI wrapper script for <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> is created to drive the syncing
process.  It is assumed that this script would be called only once a day and
not continuously in a loop (but that is possible as well but is not documented
here).</p>
<p>NOTE: Other build directory structures are possible, it all depends how one
writes the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> wrapper scripts but the above directory
structure is fairly standard in the usage of the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> script.</p>
</section>
<section id="aci-sync-driver-script">
<h3><a class="toc-backref" href="#id101">ACI Sync Driver Script</a><a class="headerlink" href="#aci-sync-driver-script" title="Permalink to this heading"></a></h3>
<p>The sync driver script for this example should be called something like
<code class="docutils literal notranslate"><span class="pre">sync_ExtraRepo1.sh</span></code>, placed under version control, and would look something
like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash -e

# Set up the environment (i.e. PATH; needed for cron jobs)
...

SYNC_BASE_DIR=~/sync_base_dir
CHECKIN_TEST_WRAPPER=$SYNC_BASE_DIR/BaseProj/sampleScripts/checkin-test-foo.sh

cd $SYNC_BASE_DIR/BUILDS/CHECKIN

$CHECKIN_TEST_WRAPPER \
  --extra-pull-from=ExtraRepo1:public:master \
  --abort-gracefully-if-no-changes-to-push \
  --enable-extra-packages=Package1A \
  --send-build-case-email=only-on-failure \
  --send-email-to=base-proj-integrators@url4.gov \
  --send-email-to-on-push=base-proj-integrators@url4.gov \
  --no-append-test-results --no-rebase \
  --do-all --push \
  -j16 \
  --wipe-clean \
  &quot;$@&quot;
</pre></div>
</div>
<p>NOTE, in the above example <code class="docutils literal notranslate"><span class="pre">sync_ExtraRepo1.sh</span></code> script, the variable
<code class="docutils literal notranslate"><span class="pre">CHECKIN_TEST_WRAPPER</span></code> is set to a wrapper script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BaseProj</span><span class="o">/</span><span class="n">sampleScripts</span><span class="o">/</span><span class="n">checkin</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">foo</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>which would be set up to call the project’s <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> tool with
configure options for the specific machine.  The location and the nature of
the wrapper script will vary from project to project and machine to machine.
In some simple cases, <code class="docutils literal notranslate"><span class="pre">CHECKIN_TEST_WRAPPER</span></code> might just be set to be the raw
machine-independent <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool for the project.</p>
<p>A description of each option passed into this invocation of the
<a class="reference internal" href="#checkin-test-py">checkin-test.py</a> tool is given below (see <a class="reference internal" href="#checkin-test-py-help">checkin-test.py –help</a> for more
details):</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">--extra-pull-from=ExtraRepo1:public:master</span></code></p>
<blockquote>
<div><p>This option instructs the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool to pull and merge in
commits that define the integration.  One could do the pull(s) manually of
doing so has the disadvantage that if they fail for some reason, they will
not be seen by the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool and no notification email
would go out.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--abort-gracefully-if-no-changes-to-push</span></code></p>
<blockquote>
<div><p>The option <code class="docutils literal notranslate"><span class="pre">--abort-gracefully-if-no-changes-to-push</span></code> makes the
<code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool gracefully terminate without sending out any
emails if after all the pulls, there are no local changes to push to the
‘origin’ repos.  This can happen, for example, if no commits were pushed
to the main development git repo for <code class="docutils literal notranslate"><span class="pre">ExtraRepo1</span></code> at
<code class="docutils literal notranslate"><span class="pre">url2.gov:/git/ExtraRepo1</span></code> since the last time this sync process was
run.  This avoids getting confusing and annoying emails like <code class="docutils literal notranslate"><span class="pre">&quot;PUSH</span>
<span class="pre">FAILED&quot;</span></code>.  The reason this option is not generally needed for local
developer usage of the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool is that in general a
developer will not run the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool with <code class="docutils literal notranslate"><span class="pre">--push</span></code> unless
they have made local changes; it just does not make any sense at all to do
that and if they do by accident, they should get an error email.  However,
for an automated ACI sync process, there is no easy way to know a-priori
if changes need to be synced so the script supports this option to deal
with that case gracefully.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--enable-extra-packages=Package1A</span></code></p>
<blockquote>
<div><p>This option should be set if one wants to ensure that all commits get
synced, even when these changes don’t impact the build or the tests of the
project.  If not setting <code class="docutils literal notranslate"><span class="pre">--enable-extra-packages=&lt;some-package&gt;</span></code> , then
the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool will only decide on its own what packages to
test just based on what packages have changed files in the <code class="docutils literal notranslate"><span class="pre">ExtraRepo1</span></code>
repo and if no modified files map to a package, then no packages will be
auto-enabled and therefore no packages will be enabled at all.  For
example, if a top-level README file in the base <code class="docutils literal notranslate"><span class="pre">ExtraRepo1</span></code> repo gets
modified that does not sit under a package directory, then the automatic
logic in the checkin-test.py tool will not trigger a package enable. In
that case, no configure, build, testing, or push will take place (must run
at least some tests in order to assume it is safe to push) and therefore
the sync will not occur.  Therefore, if one wants to ensure that every
commit gets safely synced over on every invocation, then the safest way to
that is to always enable at least one or more packages by specify
<code class="docutils literal notranslate"><span class="pre">--enable-extra-packages=&lt;pkg0&gt;,&lt;pkg1&gt;</span></code>.  <strong>WARNING:</strong> it is not
advisable to manually set <code class="docutils literal notranslate"><span class="pre">--enable-packages=&lt;package-list&gt;</span></code> since it
turns off the auto-enable logic for changed files.  This is because if
there are changes to other packages, then these packages will not get
enabled and not get tested, which could break the global build and tests.
Also, this is fragile if new packages are added to <code class="docutils literal notranslate"><span class="pre">ExtraRepo1</span></code> later
that are not listed in <code class="docutils literal notranslate"><span class="pre">--enable-packages=&lt;pkg0&gt;,&lt;pkg1&gt;,...</span></code> as they
will not be included in the testing.  Also, if someone makes local commits
in other local git repos before running the sync script again, then these
packages will not get enabled and tested.  Therefore, in general, don’t
set <code class="docutils literal notranslate"><span class="pre">--enable-packages=&lt;pkg0&gt;,&lt;pkg1&gt;,...</span></code> in a sync script, only set
<code class="docutils literal notranslate"><span class="pre">--enable-extra-packages=&lt;pkg0&gt;,&lt;pkg1&gt;,...</span></code> to be robust and safe.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--send-build-case-email=only-on-failure</span></code></p>
<blockquote>
<div><p>This makes the checkin-test.py tool skip sending email about a build case
(e.g. <code class="docutils literal notranslate"><span class="pre">MPI_DEBUG</span></code>) unless it fails.  That way, if everything passes,
then only a final <code class="docutils literal notranslate"><span class="pre">DID</span> <span class="pre">PUSH</span></code> email will go out.  But if a build case
does fail (i.e. configure, build, or tests fail), then an “early warning”
email will still go out.  However, if one wants to never get the early
build-case emails, one can turn this off by setting
<code class="docutils literal notranslate"><span class="pre">--send-build-case-email=never</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--send-email-to=base-proj-integrators&#64;url4.gov</span></code></p>
<blockquote>
<div><p>The results of the builds will be sent this email address.  If you only
want an email sent when a push actually happens, you can set
<code class="docutils literal notranslate"><span class="pre">--send-email-to=''</span></code> and rely on <code class="docutils literal notranslate"><span class="pre">--send-email-to-on-push</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--send-email-to-on-push=base-proj-integrators&#64;url4.gov</span></code></p>
<blockquote>
<div><p>A confirmation and summary email will be sent to this address if the push
happens.  This can be a different email address than set by the
<code class="docutils literal notranslate"><span class="pre">--send-email-to</span></code> option.  It is highly recommended that a mail list be
used for this email address since this will be the only more permanent
logging of the ACI process.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--no-append-test-results</span> <span class="pre">--no-rebase</span></code></p>
<blockquote>
<div><p>These options are needed to stop the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool from
modifying the commits being tested and pushed from one public git repo to
another.  The option <code class="docutils literal notranslate"><span class="pre">--no-append-test-results</span></code> is needed to instruct
the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool to <strong>NOT</strong> amend the last commit with the
test results.  The option <code class="docutils literal notranslate"><span class="pre">--no-rebase</span></code> is needed to avoid rebasing the
new commits pulled.  While the default behavior of the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code>
tool is to amend the last commit message and rebase the local commits
(which is considered best practice when testing local commits), this is a
very bad thing to do when a ACI sync server is only testing and moving
commits between public repos.  Amending the last commit would change the
SHA1 of the commit (just as a rebase would) and would fork the history and
mess up a number of workflows that otherwise should work smoothly.  Since
an email logging what was tested will go out if a push happens due to the
<code class="docutils literal notranslate"><span class="pre">--send-email-to-on-push</span></code> argument, there is no value in appending the
test results to the last commit pulled and merged (which will generally
not be a merge commit but just a fast-forward).  There are cases, however,
where appending the test results in an ACI process might be acceptable but
they are not discussed here.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--do-all</span> <span class="pre">--push</span> <span class="pre">-j16</span></code></p>
<blockquote>
<div><p>These are standard options that always get used when invoking the
<code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool and need no further explanation.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">--wipe-clean</span></code></p>
<blockquote>
<div><p>This option is added if you want to make the sync server more robust to
changes that might require a clean configure from script.  If you care
more about using less computer resources and testing that rebuilds work
smoothly, remove this option.</p>
</div></blockquote>
</div></blockquote>
<p>The sync script can be created and tested locally to ensure that it works
correctly first, before setting it as a cron job as described next.  Also, the
sync script should be version controlled in one of the project’s git repos.
This ensures that changes to script pushed to the repos will get invoked
automatically when they are pulled (but only on the second invocation of the
script).  If a change to script is critical in order to do the pull, then one
must manually pull the updated commit to the local sync repo.</p>
<p>Note, if using this in a continuous sync server that runs many times in a day
in a loop, you also want to set the option
<code class="docutils literal notranslate"><span class="pre">--abort-gracefully-if-no-changes-pulled</span></code> in addition to the option
<code class="docutils literal notranslate"><span class="pre">--abort-gracefully-if-no-changes-to-push</span></code>.  That is because if the updated
repos are in a broken state such that there are always local changes at every
CI iteration (because they have not been pushed to origin), you don’t want to
do a new CI build unless something has changed that would otherwise perhaps
make the error go away.  That allows the CI server to sit ready to try out any
change that gets pulled that might allow the integrated build to work and then
push the updates.</p>
</section>
<section id="aci-cron-job-setup">
<h3><a class="toc-backref" href="#id102">ACI Cron Job Setup</a><a class="headerlink" href="#aci-cron-job-setup" title="Permalink to this heading"></a></h3>
<p>Once the sync script <code class="docutils literal notranslate"><span class="pre">sync_ExtraRepo1.sh</span></code> has been locally tested, then it
should be committed to a version control git repo and then run automatically
as a cron job.  For example, the cron script shown below would fire off the
daily ACI process at 8pm local time every night:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ----------------- minute (0 - 59)</span>
<span class="c1"># |  -------------- hour (0 - 23)</span>
<span class="c1"># |  |  ----------- day of month (1 - 31)</span>
<span class="c1"># |  |  |  -------- month (1 - 12)</span>
<span class="c1"># |  |  |  |  ----- day of week (0 - 7) (Sunday=0 or 7)</span>
<span class="c1"># |  |  |  |  |</span>
<span class="c1"># *  *  *  *  *  command to be executed</span>
 <span class="mi">00</span> <span class="mi">20</span>  <span class="o">*</span>  <span class="o">*</span>  <span class="o">*</span>  <span class="o">~/</span><span class="n">sync_base_dir</span><span class="o">/</span><span class="n">sync_ExtraRepo1</span><span class="o">.</span><span class="n">sh</span> <span class="o">&amp;&gt;</span> <span class="o">~/</span><span class="n">sync_base_dir</span><span class="o">/</span><span class="n">sync_ExtraRepo1</span><span class="o">.</span><span class="n">out</span>
</pre></div>
</div>
<p>In the above crontab file (set with <code class="docutils literal notranslate"><span class="pre">'crontab</span> <span class="pre">-e'</span></code> or <code class="docutils literal notranslate"><span class="pre">'crontab</span>
<span class="pre">my-crontab-file.txt'</span></code>), the script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">~/</span><span class="n">sync_base_dir</span><span class="o">/</span><span class="n">sync_ExtraRepo1</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>is assumed to be a soft symbolic link to some version controlled copy of the
ACI sync script.  For example, it might make sense for this script to be
version controlled in the <code class="docutils literal notranslate"><span class="pre">BaseProj</span></code> repo and therefore the symbolic link
would be created with something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd ~/sync_base_dir/
$ ln -s BaseProj/sampleScripts/sync_ExtraRepo1.sh .
</pre></div>
</div>
<p>Such a setup would ensure that sync scripts would always be up-to-date due to
the git pulls part of the ACI process.</p>
</section>
<section id="addressing-aci-failures-and-summary">
<h3><a class="toc-backref" href="#id103">Addressing ACI Failures and Summary</a><a class="headerlink" href="#addressing-aci-failures-and-summary" title="Permalink to this heading"></a></h3>
<p>After the above cron job starts running (setup described above), the
<code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool will send out emails to the email addresses passed
into the underlying <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool.  If the emails report an update,
configure, build, or test failure, then someone will need to log onto the
machine where the ACI sync server is running and investigate what went wrong,
just like they would if they were running the <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool for
testing locally modified changes before pushing.</p>
<p>In the above example, only a single git/TriBITS repo is integrated in this ACI
sync scripts.  For a complete system, other ACI sync scripts would be written
to sync the two other git/TriBITS repos in order to maintain some
independence.  Or, a single ACI sync script that tries to update all three
git/TriBITS repos at could would be written and used.  The pattern of
integrations chosen will depend many different factors and these patterns can
change over time according to current needs and circumstances.</p>
<p>In summary, the <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> tool can be used to set up robust and
effective Almost Continuous Integration (ACI) sync servers that can be used to
integrate large collections of software in logical configurations at any
logical frequency.  Such an approach, together with the practice of <a class="reference internal" href="#regulated-backward-compatibility-and-deprecated-code">Regulated
Backward Compatibility and Deprecated Code</a>, can allow very large collections
of software to be kept integrated in short time intervals using ACI.</p>
</section>
</section>
<section id="post-push-ci-and-nightly-testing-using-checkin-test-py">
<h2><a class="toc-backref" href="#id104"><span class="sectnum">10.14</span> Post-Push CI and Nightly Testing using checkin-test.py</a><a class="headerlink" href="#post-push-ci-and-nightly-testing-using-checkin-test-py" title="Permalink to this heading"></a></h2>
<p>While the post-push CI and Nightly testing processes using <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-S</span></code>
scripts using <a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a> (see <a class="reference internal" href="#tribits-ctest-cdash-driver">TriBITS CTest/CDash Driver</a>)
which posts results to a CDash server (see <a class="reference internal" href="#tribits-cdash-customizations">TriBITS CDash Customizations</a>) is
a very attractive testing system with many advantages, setting up a CDash
server can be a bit difficult and a CDash server can require non-trivial
storage and CPU resources (due to the MySQL DB of test results) and requires
some amount of extra maintenance.  As an intermediate approach, one can
consider just using the project’s <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> tool to implement basic
post-push CI and/or Nightly testing servers using simple cron jobs and some
other helper scripts.  The <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool will robustly pull new
commits, configure the project, build, run tests, and send out emails with
results and pass/fail.  A bunch of builds can be run at once using multiple
builds specified in the <code class="docutils literal notranslate"><span class="pre">--default-builds</span></code>, <code class="docutils literal notranslate"><span class="pre">--st-extra-builds</span></code>, and
<code class="docutils literal notranslate"><span class="pre">--extra-build</span></code> arguments, or different invocations of the
<code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> tool can be run in parallel for better machine
utilization.</p>
<p>What one gives up with this approach over the full-blow CTest/CDash
implementation is:</p>
<ol class="arabic simple">
<li><p>Test results over multiple builds/days are not archived in a database for
later retrieval and query.  Only the latest build’s detailed results are
accessible.</p></li>
<li><p>Detailed test results (pass or fail) cannot be easily looked up on a
website.  Only detailed results from the last build can be found and one
has to go to the machine where the build was run from to see the results.</p></li>
</ol>
<p>The process for setting up a basic nightly build using <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> as
a cron job is a subset of the steps needed to set up a driver and cron job for
the more complex ACI process described in <a class="reference internal" href="#aci-sync-driver-script">ACI Sync Driver Script</a> and <a class="reference internal" href="#aci-cron-job-setup">ACI
Cron Job Setup</a>.  Setting up a CI server using <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> is a
little more involved than setting up a nightly build (and less desirable
because it blows away old CI iteration results pretty fast) but can be done
using existing tools.</p>
<p>For smaller, private, less-critical projects with few developers, setting up
CI and Nightly testing using <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> may be quite adequate.  In
fact, post-push testing processes implemented with <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span></code> are
much more solid and feature-full than have been employed in many software
projects that we have seen over the years that were larger, more public, had
many developers, and were quite important to many users and development
teams.</p>
</section>
<section id="tribits-dashboard-driver">
<h2><a class="toc-backref" href="#id105"><span class="sectnum">10.15</span> TriBITS Dashboard Driver</a><a class="headerlink" href="#tribits-dashboard-driver" title="Permalink to this heading"></a></h2>
<p>TriBITS also includes a system based on CMake/CTest/CDash to drive the builds
of a TriBITS project and post results to another CDash project.  This system
is contained under the directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits</span><span class="o">/</span><span class="n">ctest</span><span class="o">/</span><span class="n">tdd</span><span class="o">/</span>
</pre></div>
</div>
<p>If the TriBITS project name is <code class="docutils literal notranslate"><span class="pre">&lt;projectName&gt;</span></code>, the TDD driver CDash project
is typically called <code class="docutils literal notranslate"><span class="pre">&lt;projectName&gt;Driver</span></code>.  Using CTest to drive the Nightly
builds of a TriBITS project makes sense because CTest can run different builds
in parallel, can time-out builds that are taking too long, and will report
results to a dashboard and submit notification emails when things fail.
However, this is the most confusing and immature part of the TriBITS system.
The <a class="reference internal" href="#tribits-ctest-cdash-driver">TriBITS CTest/CDash Driver</a> system using the <a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a>
can be used without this TriBITS Dashboard Driver (TDD) system.</p>
<p>However, this TriBITS subsystem is not well tested with automated tests, is
difficult to extend and test manually, and has other problems.  Therefore, it
is not recommended that projects adopt the usage of this subsystem.  A simple
set of cron jobs or a tool like Jenkins is likely a better option (if done
carefully).</p>
</section>
<section id="regulated-backward-compatibility-and-deprecated-code">
<h2><a class="toc-backref" href="#id106"><span class="sectnum">10.16</span> Regulated Backward Compatibility and Deprecated Code</a><a class="headerlink" href="#regulated-backward-compatibility-and-deprecated-code" title="Permalink to this heading"></a></h2>
<p>The motivation and ideas behind <cite>Regulated Backward Compatibility</cite> and
deprecated code are described in the <a class="reference external" href="../lifecycle_model/TribitsLifecycleModel.pdf">TriBITS Lifecycle Model</a> document.
Here, the details of the implementation in TriBITS are given and how
transitions between non-backward compatible major versions is accomplished.</p>
<p>This section describes the process for deprecating code within a major
backward-compatible version sequence and finally removing deprecated code when
transitioning to a new major version X to X+1 for the semantic versioning
numbering scheme X.Y.Z.  This information is given as a process with different
phases.</p>
<p>The processing for managing deprecated code is as follows and more details are
given below:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#setting-up-support-for-deprecated-code-handling">Setting up support for deprecated code handling</a></p></li>
<li><p><a class="reference internal" href="#deprecating-code-but-maintaining-backward-compatibility">Deprecating code but maintaining backward compatibility</a></p>
<ul>
<li><p><a class="reference internal" href="#deprecating-c-c-classes-structs-functions-typdefs-etc">Deprecating C/C++ classes, structs, functions, typdefs, etc.</a></p></li>
<li><p><a class="reference internal" href="#deprecating-preprocessor-macros">Deprecating preprocessor macros</a></p></li>
<li><p><a class="reference internal" href="#deprecating-an-entire-header-and-or-source-file">Deprecating an entire header and/or source file</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#hiding-deprecated-code-to-certify-and-facilitate-later-removal">Hiding deprecated code to certify and facilitate later removal</a></p>
<ul>
<li><p><a class="reference internal" href="#hiding-c-c-entities">Hiding C/C++ entities</a></p></li>
<li><p><a class="reference internal" href="#hiding-entire-deprecated-header-and-source-files">Hiding entire deprecated header and source files</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#physically-removing-deprecated-code">Physically removing deprecated code</a></p>
<ul>
<li><p><a class="reference internal" href="#removing-entire-deprecated-header-and-source-files">Removing entire deprecated header and source files</a></p></li>
<li><p><a class="reference internal" href="#removing-deprecated-code-from-remaining-files">Removing deprecated code from remaining files</a></p></li>
</ul>
</li>
</ul>
<section id="setting-up-support-for-deprecated-code-handling">
<h3><a class="toc-backref" href="#id107">Setting up support for deprecated code handling</a><a class="headerlink" href="#setting-up-support-for-deprecated-code-handling" title="Permalink to this heading"></a></h3>
<p>Setting up support for managing deprecated code in a TriBITS package requires
just two simple changes to the TriBITS-related files in a package.  First, the
top-level package <a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file needs to have a call
to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_add_show_deprecated_warnings_option</span><span class="p">()</span>
</pre></div>
</div>
<p>Second, the package’s configure header:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">packageDir</span><span class="o">&gt;/</span><span class="n">cmake</span><span class="o">/&lt;</span><span class="n">PACKAGE_UCNAME</span><span class="o">&gt;</span><span class="n">_config</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="ow">in</span>
</pre></div>
</div>
<p>file needs to have:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">@&lt;</span><span class="n">PACKAGE_UCNAME</span><span class="o">&gt;</span><span class="n">_DEPRECATED_DECLARATIONS</span><span class="o">@</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;PACKAGE_UCNAME&gt;</span></code> is the upper-case name of the TriBITS package.</p>
<p>That is all that is needed to provide support for TriBITS deprecated code.</p>
<p>When a TriBITS project is configured with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_SHOW_DEPRECATED_WARNINGS</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>by default, all packages will show deprecated warnings.  These deprecated
warnings can be turned on and off on a package-by-package basis by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">PackageName</span><span class="o">&gt;</span><span class="n">_SHOW_DEPRECATED_WARNINGS</span><span class="o">=</span><span class="p">[</span><span class="n">ON</span><span class="o">|</span><span class="n">OFF</span><span class="p">]</span>
</pre></div>
</div>
<p>This gives developers and users a little extra control over what deprecated
warnings are shown.</p>
<p>In addition, deprecated code can be hidden from the build to help certify that
downstream code is clean by configuring with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_HIDE_DEPRECATED_CODE</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<p>This will remove the deprecated code from the build and install (see details
below) so that other software in the TriBITS project can be shown to build
clean without deprecated code and so that outside client code can be shown to
be clean of deprecated code.</p>
<p>As with deprecated warnings, showing or hiding deprecated code can be
controlled on a package-by-package basis by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">PackageName</span><span class="o">&gt;</span><span class="n">_HIDE_DEPRECATED_CODE</span><span class="o">=</span><span class="p">[</span><span class="n">ON</span><span class="o">|</span><span class="n">OFF</span><span class="p">]</span>
</pre></div>
</div>
<p>In this case, hiding deprecated code on a package-by-package basis may not
work because deprecated code in a downstream package might rely on deprecated
code in an upstream package (which might have its deprecated code hidden).</p>
</section>
<section id="deprecating-code-but-maintaining-backward-compatibility">
<h3><a class="toc-backref" href="#id108">Deprecating code but maintaining backward compatibility</a><a class="headerlink" href="#deprecating-code-but-maintaining-backward-compatibility" title="Permalink to this heading"></a></h3>
<p>One of the most important aspects of the <a class="reference external" href="../lifecycle_model/TribitsLifecycleModel.pdf">TriBITS Lifecycle Model</a> for
later-stage Production Growth and Production Maintenance code is to provide
backward compatibility between a continuous stream of versions of the software
within a major version number X in the version numbering scheme X.Y.Z.  In all
cases, if a piece of client code builds and runs correctly against version
X0.Y0.Z0, it should also build, without modification, against versions
X0.Y1,Z1 for all Y1 &gt;= Y0 and all Z1 and up to (but not including) X0+1.0.0.
There are many types of constructs that one will want to deprecate and
therefore later remove.  When deprecating code, one wants to give users
compile-time warnings of the usage of deprecated features so that they know
what they need to remove.  One also wants to allow them to certify that their
code is free of deprecated warnings by hiding deprecated code.  Below, the
different types of entities that one wants to deprecate and how to support
hiding code (which also facilitates removing it later) are described.</p>
<section id="deprecating-c-c-classes-structs-functions-typdefs-etc">
<h4><a class="toc-backref" href="#id109">Deprecating C/C++ classes, structs, functions, typdefs, etc.</a><a class="headerlink" href="#deprecating-c-c-classes-structs-functions-typdefs-etc" title="Permalink to this heading"></a></h4>
<p>To deprecate standard C/C++ constructs, one can just use the standard TriBITS
compile-time macro <code class="docutils literal notranslate"><span class="pre">&lt;PACKAGE_UCNAME&gt;_DEPRECATED</span></code> which is properly ifdefed
by the TriBITS system to add a GCC/Intel deprecated attribute or not.  For
example, one would deprecate standard C/C++ constructs for the package
<code class="docutils literal notranslate"><span class="pre">SomePackage</span></code> with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// Deprecate a class (or struct)
class SOMEPACKAGE_DEPRECATED SomeClass { ... };

// Deprecate a function
SOMEPACKAGE_DEPRECATED int somefunc(...);

// Deprecate a typedef
SOMEPACKAGE_DEPRECATED typedef someTypeDef int;
</pre></div>
</div>
<p>The GCC (version 3.1 and newer) and Intel C and C++ compilers both support
adding extra attributes including the <code class="docutils literal notranslate"><span class="pre">__deprecated__</span></code> attribute.  When this
attribute is applied to a given C/C++ entity, it produces a compiler warning
that can be searched for in the compiler output and elevated to an error (when
<code class="docutils literal notranslate"><span class="pre">-Werror</span></code> is also passed to the compiler).</p>
<p>In addition to the basic deprecated warning, one can also add an optional
deprecated warning message using the macro
<code class="docutils literal notranslate"><span class="pre">&lt;PACKAGE_UCNAME&gt;_deprecated_msg()</span></code>.  For example, if a new function is
replacing an old function, one might use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Deprecated</span> <span class="n">old</span> <span class="n">unsafe</span> <span class="n">function</span> <span class="n">taking</span> <span class="n">raw</span> <span class="n">pointers</span>
<span class="n">somepackage_deprecated_msg</span><span class="p">(</span>
  <span class="s2">&quot;Please use the safe somefunc(const Ptr&lt;const std::string&gt;&amp;) instead!&quot;</span><span class="p">)</span>
<span class="n">void</span> <span class="n">somefunc</span><span class="p">(</span><span class="n">const</span> <span class="n">std</span><span class="p">::</span><span class="n">string</span> <span class="o">*</span><span class="nb">str</span><span class="p">);</span>

<span class="o">//</span> <span class="n">New</span> <span class="n">version</span> <span class="n">take</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">take</span> <span class="n">raw</span> <span class="n">pointers</span> <span class="p">(</span><span class="ow">and</span> <span class="ow">is</span> <span class="n">therefore</span> <span class="n">safer</span><span class="p">)</span>
<span class="n">void</span> <span class="n">somefunc</span><span class="p">(</span><span class="n">const</span> <span class="n">Teuchos</span><span class="p">::</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">const</span> <span class="n">std</span><span class="p">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">);</span>
</pre></div>
</div>
<p>Then, if user code calls the version <code class="docutils literal notranslate"><span class="pre">somefunc(const</span> <span class="pre">std::string*)</span></code> they
will get the string:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Please use the safe somefunc(const Ptr&lt;const std::string&gt;&amp;) instead!&quot;</span>
</pre></div>
</div>
<p>printed as well by the compiler.  Note that the custom message will only be
printed for GCC versions 4.5 and newer.  If an older version of GCC is used,
then the message string is ignored.</p>
</section>
<section id="deprecating-preprocessor-macros">
<h4><a class="toc-backref" href="#id110">Deprecating preprocessor macros</a><a class="headerlink" href="#deprecating-preprocessor-macros" title="Permalink to this heading"></a></h4>
<p>A C/C++ preprocessor macro is not an entity seen by the C/C++ compiler and
therefore cannot directly take advantage of a feature such as the
<code class="docutils literal notranslate"><span class="pre">__deprecated__</span></code> attribute of the GCC/Intel compilers.  However, in some
cases, for function-like macros can such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">The</span> <span class="n">definition</span> <span class="n">of</span> <span class="n">the</span> <span class="n">macro</span>
<span class="c1">#define some_old_func_macro(ARG1, ARG2, ...) ...</span>
<span class="o">...</span>
<span class="o">//</span> <span class="n">A</span> <span class="n">use</span> <span class="n">of</span> <span class="n">the</span> <span class="n">macro</span>
<span class="n">some_old_func_macro</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>there is a strategy where one can define the macro to call a dummy deprecated
function such as with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SOMEPACKAGE_DEPRECATED</span>
<span class="n">inline</span> <span class="n">void</span> <span class="n">some_old_func_macro_is_deprecated</span><span class="p">()</span>
<span class="p">{}</span>

<span class="o">//</span> <span class="n">The</span> <span class="n">definition</span> <span class="n">of</span> <span class="n">the</span> <span class="n">macro</span>
<span class="c1">#define some_old_func_macro(ARG1, ARG2, ...) \</span>
  <span class="p">{</span> \
    <span class="n">some_old_func_macro_is_deprecated</span><span class="p">();</span> \
    <span class="o">...</span> \
  <span class="p">}</span>

<span class="o">...</span>

<span class="o">//</span> <span class="n">A</span> <span class="n">use</span> <span class="n">of</span> <span class="n">the</span> <span class="n">macro</span>
<span class="n">some_old_func_macro</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above example, client code calling <code class="docutils literal notranslate"><span class="pre">some_old_func_macro()</span></code> will now
result in a deprecated compiler warning which should make it clear what is
being deprecated.</p>
<p>Note that this approach will not work in cases were a macro is only providing
a single value such as a constant (but one should not use macros for providing
constants anyway).</p>
</section>
<section id="deprecating-an-entire-header-and-or-source-file">
<h4><a class="toc-backref" href="#id111">Deprecating an entire header and/or source file</a><a class="headerlink" href="#deprecating-an-entire-header-and-or-source-file" title="Permalink to this heading"></a></h4>
<p>There are times when one wants to deprecate an entire set of files and all of
the contents in those files.  In addition to deprecating the contents of the
files one will want to deprecate the entire file as well.  There are a few
steps to this.  First, one wants to put a warning in the file such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#ifdef __GNUC__</span>
<span class="c1">#  warning &quot;This header &lt;THIS_HEADER&gt; is deprecated!  Use &lt;NEW_HEADER&gt; instead!&quot;</span>
<span class="c1">#endif</span>
</pre></div>
</div>
<p>The above <code class="docutils literal notranslate"><span class="pre">ifdef</span></code> on <code class="docutils literal notranslate"><span class="pre">__GNUC__</span></code> is needed in order avoid the non-standard
<code class="docutils literal notranslate"><span class="pre">#warning</span></code> preprocessor directive on non-compliant compilers (but should
work on all later version GCC and Intel compilers).</p>
</section>
</section>
<section id="hiding-deprecated-code-to-certify-and-facilitate-later-removal">
<h3><a class="toc-backref" href="#id112">Hiding deprecated code to certify and facilitate later removal</a><a class="headerlink" href="#hiding-deprecated-code-to-certify-and-facilitate-later-removal" title="Permalink to this heading"></a></h3>
<p>In addition to adding deprecation warnings at preprocessing or compile-time,
it is also highly desirable to allow the deprecated code to be removed from
the build to help certify that client code indeed no longer needs the
deprecated code.  The following subsections describe how to hide deprecated
code from existing files and how to hide deprecated files entirely.</p>
<section id="hiding-c-c-entities">
<h4><a class="toc-backref" href="#id113">Hiding C/C++ entities</a><a class="headerlink" href="#hiding-c-c-entities" title="Permalink to this heading"></a></h4>
<p>In the case when various C/C++ entities will be removed from an existing file,
but the file will remain, then the deprecated code can be ifdefed out, for the
package <code class="docutils literal notranslate"><span class="pre">SomePackage</span></code> for example, using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#ifndef SOMEPACKAGE_HIDE_DEPRECATED_CODE
  // Deprecate a class (or struct)
  class SOMEPACKAGE_DEPRECATED SomeClass { ... };
  ...
#endif /* SOMEPACKAGE_HIDE_DEPRECATED_CODE */
</pre></div>
</div>
<p>In this way, when the CMake variable <code class="docutils literal notranslate"><span class="pre">SomePackae_HIDE_DEPRECATED_CODE=ON</span></code>,
then the deprecated code will be completely removed resulting in compile
errors for any downstream code still using them.</p>
</section>
<section id="hiding-entire-deprecated-header-and-source-files">
<h4><a class="toc-backref" href="#id114">Hiding entire deprecated header and source files</a><a class="headerlink" href="#hiding-entire-deprecated-header-and-source-files" title="Permalink to this heading"></a></h4>
<p>In order to hide entire deprecated header and source files when the CMake
variable <code class="docutils literal notranslate"><span class="pre">&lt;PackageName&gt;_HIDE_DEPRECATED_CODE=ON</span></code> is set, one needs to move
the headers and sources to another directory and provide for conditional
inclusion in the TriBITS build of the library.  For example, suppose one wants
to remove support for the deprecated files <code class="docutils literal notranslate"><span class="pre">SomeOldStuff.hpp</span></code> and
<code class="docutils literal notranslate"><span class="pre">SomeOldStuff.cpp</span></code>.  In this case, one would move the files onto a new
<code class="docutils literal notranslate"><span class="pre">deprecated/</span></code> sub-directory and then write the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file
like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(HEADERS &quot;&quot;)
set(SOURCES &quot;&quot;)

set_and_inc_dirs(DIR ${CMAKE_CURRENT_SOURCE_DIR})
append_glob(HEADERS ${DIR}/*.hpp)
append_glob(SOURCES ${DIR}/*.cpp)

if (NOT ${PACKAGE_NAME}_HIDE_DEPRECATED_CODE)
  include_directories(${CMAKE_CURRENT_SOURCE_DIR}/deprecated)
  append_set(HEADERS
    SomeOldStuff.hpp
    )
  append_set(SOURCES
    SomeOldStuff.cpp
    )
endif()

...

tribits_add_library(
  &lt;LIBRARY_NAME&gt;
  HEADERS ${HEADERS}
  SOURCES ${SOURCES}
  )
</pre></div>
</div>
<p>In this way, when <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_HIDE_DEPRECATED_CODE=TRUE</span></code>, then the
directory for the deprecated headers will not be in the include path (so
downstream clients will not even be able to see them) and they will not be
installed so external clients will not be able to see them either.  However,
when <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_HIDE_DEPRECATED_CODE=FALSE</span></code>, then these files will be
included in the build and include path and downstream clients can use them.</p>
<p>Once these files need to be permanently removed, one just then needs to remove
them from the version control repository (i.e. <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">rm</span> <span class="pre">&lt;files_to_remove&gt;</span></code>)
and then remove them from the above <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> code.</p>
</section>
</section>
<section id="physically-removing-deprecated-code">
<h3><a class="toc-backref" href="#id115">Physically removing deprecated code</a><a class="headerlink" href="#physically-removing-deprecated-code" title="Permalink to this heading"></a></h3>
<p>The final step in the code deprecation cycle is to actually remove the
deprecated code.  This is necessary to clean house, remove clutter and finally
get the payoff in the reduction of technical debt that occurs when removing
what is no longer needed or wanted.</p>
<p>It is recommended to remove deprecated files first, then remove deprecated
file fragments from remaining files.  Also, it is recommended to create git
commits after each step.</p>
<p>It is also recommended that some time before deprecated code is actually
removed, that a TriBITS repo change the default of
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_HIDE_DEPRECATED_CODE</span></code> from <code class="docutils literal notranslate"><span class="pre">OFF</span></code> to <code class="docutils literal notranslate"><span class="pre">ON</span></code> so that downstream
clients will see the effects of hiding the deprecated code before the code is
actually removed.  In fact, this default should be changed several days to a
week or more before the code is actually removed.  This way, downstream code
developers will get a “shock” about removal of the deprecated code but can
manually configure with <code class="docutils literal notranslate"><span class="pre">-D&lt;Project&gt;_HIDE_DEPRECATED_CODE=OFF</span></code> to keep
building in the short-term until they can remove their usage of deprecated
code.</p>
<section id="removing-entire-deprecated-header-and-source-files">
<h4><a class="toc-backref" href="#id116">Removing entire deprecated header and source files</a><a class="headerlink" href="#removing-entire-deprecated-header-and-source-files" title="Permalink to this heading"></a></h4>
<p>To remove entire deprecated header and source files one just needs to first
remove them from the version control repository and local directories
(e.g. <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">rm</span> <span class="pre">deprecated/*</span></code>) and then remove any traces of them from the
<code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file.  For the example in <a class="reference internal" href="#hiding-entire-deprecated-header-and-source-files">Hiding entire deprecated header
and source files</a>, one would just remove the files <code class="docutils literal notranslate"><span class="pre">SomeOldStuff.hpp</span></code> and
<code class="docutils literal notranslate"><span class="pre">SomeOldStuff.cpp</span></code> from the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file leaving:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>if (NOT ${PACKAGE_NAME}_HIDE_DEPRECATED_CODE)
  include_directories(${CMAKE_CURRENT_SOURCE_DIR}/deprecated)
  append_set(HEADERS
    )
  append_set(SOURCES
    )
endif()
</pre></div>
</div>
<p>Since more files may be deprecated later, it may be a good idea to leave the
machinery for conditionally including deprecated files by leaving the above
empty CMake code or just commenting it out.</p>
<p>To find which <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> files need to be modified, do a search like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ find . -name CMakeLists.txt -exec grep -nH HIDE_DEPRECATED_CODE {} \;
</pre></div>
</div>
<p>After removing the files, create a local commit of the removed files and the
updated <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> files before removing deprecated fragments from the
source files.  In other words, do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ emacs -nw CMakeLists.txt  # Remove the references to the deprecated files
$ git rm SomeOldStuff.hpp SomeOldStuff.cpp
$ git commit -m &quot;Removing deprecated files&quot;
</pre></div>
</div>
</section>
<section id="removing-deprecated-code-from-remaining-files">
<h4><a class="toc-backref" href="#id117">Removing deprecated code from remaining files</a><a class="headerlink" href="#removing-deprecated-code-from-remaining-files" title="Permalink to this heading"></a></h4>
<p>The deprecated ifdefed blocks described in <a class="reference internal" href="#hiding-c-c-entities">Hiding C/C++ entities</a> can be
removed manually but it is generally preferred to use a tool.  One simple tool
that can do this is called <code class="docutils literal notranslate"><span class="pre">unifdef</span></code>, that can be downloaded and it is
documented at:</p>
<blockquote>
<div><p><a class="reference external" href="http://dotat.at/prog/unifdef/">http://dotat.at/prog/unifdef/</a></p>
</div></blockquote>
<p>Just download, build, and install the program <code class="docutils literal notranslate"><span class="pre">unifdef</span></code> (see
<code class="docutils literal notranslate"><span class="pre">unifdef/INSTALL</span></code> in untarred source) and then run it as described below.
In the example below, assume the program is installed in the user’s home
directory under:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">~/</span><span class="n">install</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">unifdef</span>
</pre></div>
</div>
<p>For a given TriBITS package, the program is then run as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ find . -name &quot;*pp&quot; -exec ~/install/bin/unifdef \
  -DSomePackage_HIDE_DEPRECATED_CODE {} -o {} \;
</pre></div>
</div>
<p>After the above command runs, look at the diffs to make sure the ifdef
deprecated code blocks were removed correctly.  For example, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git diff -- .
</pre></div>
</div>
<p>If the diffs look correct, commit the changes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git commit -m &quot;Removing deprecated code blocks&quot; -- .
</pre></div>
</div>
<p>Then test everything and push using the <a class="reference internal" href="#checkin-test-py">checkin-test.py</a> tool.</p>
<p>After that, all deprecated code is removed and the next period of incremental
change and deprecation begins.</p>
</section>
</section>
</section>
<section id="installation-and-backward-compatibility-testing">
<h2><a class="toc-backref" href="#id118"><span class="sectnum">10.17</span> Installation and Backward Compatibility Testing</a><a class="headerlink" href="#installation-and-backward-compatibility-testing" title="Permalink to this heading"></a></h2>
<p>TriBITS has some built-in support for installation testing and backward
compatibility testing.  The way it works is that one can install the headers,
libraries, and executables for a TriBITS project and then configure the tests
and examples in the TriBITS project against the installed
headers/libraries/executables.  In this mode, the TriBITS project’s libraries
and executables are <strong>not</strong> build and the header file locations to local
source are not included.</p>
<p>When the same version of the project sources are used to build the
tests/examples against the installed headers/libraries/executables, then this
constitutes <em>installation testing</em>.  When an older version of the project is
used to build and run tests and examples against the
headers/libraries/executables for a version of the project, then this
constitutes <em>backward compatibility testing</em> which also includes installation
testing of course.</p>
</section>
<section id="wrapping-externally-configured-built-software">
<h2><a class="toc-backref" href="#id119"><span class="sectnum">10.18</span> Wrapping Externally Configured/Built Software</a><a class="headerlink" href="#wrapping-externally-configured-built-software" title="Permalink to this heading"></a></h2>
<p>It is possible to take an external piece of software that uses any arbitrary
build system and wrap it as a TriBITS package and have it integrate in with
the package dependency infrastructure.  The <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a> package
<code class="docutils literal notranslate"><span class="pre">WrapExternal</span></code> shows how this can be done.  Support for this in TriBITS is
slowly evolving but some key TriBITS features that have been added to support
the arbitrary case include:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#tribits-determine-if-current-package-needs-rebuilt">tribits_determine_if_current_package_needs_rebuilt()</a>: Uses brute-force
searches for recently modified files in upstream SE packages to determine if
the external piece of software needs to be rebuilt.</p></li>
<li><p><a class="reference internal" href="#tribits-write-flexible-package-client-export-files">tribits_write_flexible_package_client_export_files()</a>: Write an export
makefile or a <code class="docutils literal notranslate"><span class="pre">XXXConfig.cmake</span></code> file for usage by the wrapped externally
configured and built software.</p></li>
</ul>
<p>While it is possible to wrap nearly any externally configured and built piece
of software as a TriBITS package, in most cases, it is usually better to just
create a TriBITS build system for the software.  For projects that use a raw
CMake build system, a TriBITS build system can be created side-by-side with
the existing raw CMake build using a number of approaches. The common approach
that is not too invasive is to create a <code class="docutils literal notranslate"><span class="pre">CMakeLists.tribits.txt</span></code> file along
side every native <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file in the external software project and
have the native <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file defined like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">DOING_A_TRIBITS_BUILD</span><span class="p">)</span>
  <span class="n">include</span><span class="p">(</span><span class="s2">&quot;$</span><span class="si">{CMAKE_CURRENT_SOURCE_DIR}</span><span class="s2">/CMakeLists.tribits.txt&quot;</span><span class="p">)</span>
  <span class="k">return</span><span class="p">()</span>
<span class="n">endif</span><span class="p">()</span>

<span class="c1"># Rest of native CMakeLists.txt file ...</span>
</pre></div>
</div>
<p>Experience from the CASL VERA project has shown that, overall, there is less
hassle, less work, and better portability when creating a native TriBITS
build, even if it is a secondary build system for a given piece of software.</p>
<p>The decision whether to just wrap the build system for the existing software
or to create a (secondary) TriBITS build system for it depends on a number of
factors.</p>
<p>Note that while it is generally recommended to create a TriBITS build for an
existing piece of software, it is generally not recommended with switch over
all of the tests to use CTest (unless the existing software is going to ditch
their current test driver and reporting system).  Instead, the external
software’s native test system can just be called by the wrapped TriBITS
package in one or more CTest tests.</p>
</section>
<section id="tribits-directory-snapshotting">
<h2><a class="toc-backref" href="#id120"><span class="sectnum">10.19</span> TriBITS directory snapshotting</a><a class="headerlink" href="#tribits-directory-snapshotting" title="Permalink to this heading"></a></h2>
<p>Some TriBITS projects choose to snapshot the <a class="reference internal" href="#tribits-tribits">TriBITS/tribits/</a> directory
source tree into their project’s source tree, typically under
<a class="reference internal" href="#projectdir-cmake-tribits">&lt;projectDir&gt;/cmake/tribits/</a>.  The independent <code class="docutils literal notranslate"><span class="pre">TriBITS/tribts/</span></code> source
tree contains the tool <code class="docutils literal notranslate"><span class="pre">snapshot_tribits.py</span></code> (calls <a class="reference internal" href="#snapshot-dir-py">snapshot-dir.py</a>) that
allows one to update the snapshot of the TriBITS source tree as simply as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd &lt;projectDir&gt;/cmake/tribits/
$ &lt;some-base-dir&gt;/TriBITS/tribits/snapshot_tribits.py
</pre></div>
</div>
<p>This will create a git commit in the local <code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/</span></code> git repo that
looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Automatic</span> <span class="n">snapshot</span> <span class="n">commit</span> <span class="kn">from</span> <span class="nn">tribits</span> <span class="n">at</span> <span class="n">f8c1682</span>

<span class="n">Origin</span> <span class="n">repo</span> <span class="n">remote</span> <span class="n">tracking</span> <span class="n">branch</span><span class="p">:</span> <span class="s1">&#39;casl-dev-collab/tribits_reorg_26&#39;</span>
<span class="n">Origin</span> <span class="n">repo</span> <span class="n">remote</span> <span class="n">repo</span> <span class="n">URL</span><span class="p">:</span> <span class="s1">&#39;casl-dev-collab = git@casl-dev:collaboration/TriBITS&#39;</span>

<span class="n">At</span> <span class="n">commit</span><span class="p">:</span>

<span class="n">f8c1682</span> <span class="n">Assert</span> <span class="n">TriBITS</span> <span class="nb">min</span> <span class="n">CMake</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">TriBITS</span> <span class="n">itself</span>
<span class="n">Author</span><span class="p">:</span> <span class="n">Roscoe</span> <span class="n">A</span><span class="o">.</span> <span class="n">Bartlett</span> <span class="o">&lt;</span><span class="n">bartlettra</span><span class="nd">@ornl</span><span class="o">.</span><span class="n">gov</span><span class="o">&gt;</span>
<span class="n">Date</span><span class="p">:</span> <span class="n">Fri</span> <span class="n">Dec</span> <span class="mi">5</span> <span class="mi">05</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">49</span> <span class="mi">2014</span> <span class="o">-</span><span class="mi">0500</span>
</pre></div>
</div>
<p>This, of course, assumes that <code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/</span></code> is a local git repo (or is in
local git repo).  If that is not the case, then one cannot use the script
<code class="docutils literal notranslate"><span class="pre">snapshot_tribits.py</span></code> or must use it with the <code class="docutils literal notranslate"><span class="pre">--skip-commit</span></code> option.</p>
<p>See <a class="reference internal" href="#snapshot-dir-py-help">snapshot-dir.py –help</a> for more details.  Note the guidance on using a
different branch for the snapshot sync followed by a merge.  This allows for
one to maintain local changes to TriBITS and use git to manage the merges.
However, this will increase the changes of merge conflicts so one should
consider just directly snapshotting into the master branch to avoid merge
conflicts.</p>
</section>
<section id="tribits-development-toolset">
<h2><a class="toc-backref" href="#id121"><span class="sectnum">10.20</span> TriBITS Development Toolset</a><a class="headerlink" href="#tribits-development-toolset" title="Permalink to this heading"></a></h2>
<p>Most TriBITS projects need git, a compiler (e.g. GCC), MPI, and a number of
other standard TPLs and other tools in order to develop on and test the
project code.  To this end, TriBITS contains some helper scripts for
downloading, configuring, building, and installing packages like git, cmake,
GCC, MPICH, and others needed to set up a development environment for a
typical computational science software project.  These tools are used to set
up development environments on new machines for projects like Trilinos and
CASL VERA.  Scripts with names like <code class="docutils literal notranslate"><span class="pre">install-gcc.py</span></code> are defined which pull
sources from public git repos then configure, build, and install into
specified installation directories.</p>
<p id="install-devtools-py">The script <strong>install_devtools.py</strong> is provided in the directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits</span><span class="o">/</span><span class="n">devtools_install</span><span class="o">/</span>
</pre></div>
</div>
<p>To use this script, one just needs to create some scratch directory like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir scratch
$ cd scratch/
</pre></div>
</div>
<p>then install the tools using, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ install_devtools.py --install-dir=~/install/tribits_devtools \
  --parallel=16 --do-all
</pre></div>
</div>
<p>Then to access installed development environment, one just needs to source the
script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">~/</span><span class="n">install</span><span class="o">/</span><span class="n">tribits_devtools</span><span class="o">/</span><span class="n">load_dev_env</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>and then the installed versions of GCC, MPICH, CMake, and <a class="reference internal" href="#gitdist">gitdist</a> are
placed in one’s path.</p>
<p>See <a class="reference internal" href="#install-devtools-py-help">install_devtools.py –help</a> for more details.</p>
</section>
</section>
<section id="tribits-detailed-reference-documentation">
<h1><a class="toc-backref" href="#id122"><span class="sectnum">11</span> TriBITS Detailed Reference Documentation</a><a class="headerlink" href="#tribits-detailed-reference-documentation" title="Permalink to this heading"></a></h1>
<p>The following subsections contain detailed reference documentation for the
various TriBITS variables, functions, and macros that are used by TriBITS
projects that <a class="reference internal" href="#tribits-project-developers">TriBITS Project Developers</a> need to know about.  Variables,
functions and macros that are used only internally in TriBITS are generally
not documented here (see the TriBITS <code class="docutils literal notranslate"><span class="pre">*.cmake</span></code> source files).</p>
<section id="tribits-global-project-settings">
<h2><a class="toc-backref" href="#id123"><span class="sectnum">11.1</span> TriBITS Global Project Settings</a><a class="headerlink" href="#tribits-global-project-settings" title="Permalink to this heading"></a></h2>
<p>TriBITS defines a number of global project-level settings that can be set by
the user and can have their default determined by each individual TriBITS
project.  If a given TriBITS project does not define its own default, a
reasonable default is set by the TriBITS system automatically.  These options
are defined and are set, for the most part, in the internal TriBITS function
<code class="docutils literal notranslate"><span class="pre">tribits_define_global_options_and_define_extra_repos()</span></code> in the TriBITS
CMake code file <code class="docutils literal notranslate"><span class="pre">TribitsGlobalMacros.cmake</span></code> which gets called inside of the
<a class="reference internal" href="#id2">tribits_project()</a> macro.  That function and that file are the definitive
source the options that a TriBITS project takes and what the default values
are but we strive to document them here as well.  Many of these global options
(i.e. cache variables) such as <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_&lt;SOME_OPTION&gt;</span></code> allow the
project to define a default by setting a local variable
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_&lt;SOME_OPTION&gt;_DEFAULT</span></code> as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_&lt;SOME_OPTION&gt;_DEFAULT &lt;someDefault&gt;)
</pre></div>
</div>
<p>either in its top-level <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file or in its
<code class="docutils literal notranslate"><span class="pre">ProjectName.cmake</span></code> file (depends on what variable it is as to where it
should be set).  If <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_&lt;SOME_OPTION&gt;_DEFAULT</span></code> is not set by
the project, then TriBITS provides a reasonable default value.  The TriBITS
code that uses these defaults for this looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>if (&quot;${${PROJECT_NAME}_&lt;SOME_OPTION&gt;_DEFAULT}&quot; STREQUAL &quot;&quot;)
  set(${PROJECT_NAME}_&lt;SOME_OPTION&gt;_DEFAULT &lt;someDefault&gt;)
endif()

advanced_set( ${PROJECT_NAME}_&lt;SOME_OPTION&gt;
  ${PROJECT_NAME}_&lt;SOME_OPTION&gt;_DEFAULT}
  CACHE BOOL &quot;[documentation].&quot;
  )
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;SOME_OPTION&gt;</span></code> is an option name, for example like
<code class="docutils literal notranslate"><span class="pre">TEST_CATEGORIES</span></code>, and <code class="docutils literal notranslate"><span class="pre">&lt;someDefault&gt;</span></code> is the default set by TriBITS if
the project does not define a default.  In this way, if the project sets the
variable <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_&lt;SOME_OPTION&gt;_DEFAULT</span></code> before this code executes,
then <code class="docutils literal notranslate"><span class="pre">${${PROJECT_NAME}_&lt;SOME_OPTION&gt;_DEFAULT}</span></code> will be used as the default
for the cache variable <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_&lt;SOME_OPTION&gt;</span></code> which, of course, can
be overridden by the user when calling <code class="docutils literal notranslate"><span class="pre">cmake</span></code> in a number of ways.</p>
<p>Most of these global options that can be overridden externally by setting the
cache variable <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_&lt;SOME_OPTION&gt;</span></code> should be documented in the
<a class="reference internal" href="#project-specific-build-reference">Project-Specific Build Reference</a> document.  A generic version of this
document is found in <a class="reference external" href="TribitsBuildReference.html">TribitsBuildReference</a>.  Some of the more unusual
options that might only be of interest to developers mentioned below may not
be documented in <a class="reference external" href="TribitsBuildReference.html">TribitsBuildReference</a>.</p>
<p>The global project-level TriBITS options for which defaults can be provided by
a given TriBITS project are:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#project-name-assert-correct-tribits-usage">${PROJECT_NAME}_ASSERT_CORRECT_TRIBITS_USAGE</a></p></li>
<li><p><a class="reference internal" href="#project-name-c-standard">${PROJECT_NAME}_C_Standard</a></p></li>
<li><p><a class="reference internal" href="#project-name-check-for-unparsed-arguments">${PROJECT_NAME}_CHECK_FOR_UNPARSED_ARGUMENTS</a></p></li>
<li><p><a class="reference internal" href="#project-name-configure-options-file-append">${PROJECT_NAME}_CONFIGURE_OPTIONS_FILE_APPEND</a></p></li>
<li><p><a class="reference internal" href="#project-name-cpack-source-generator">${PROJECT_NAME}_CPACK_SOURCE_GENERATOR</a></p></li>
<li><p><a class="reference internal" href="#project-name-ctest-do-all-at-once">${PROJECT_NAME}_CTEST_DO_ALL_AT_ONCE</a></p></li>
<li><p><a class="reference internal" href="#project-name-disable-enabled-forward-dep-packages">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES</a></p></li>
<li><p><a class="reference internal" href="#project-name-elevate-st-to-pt">${PROJECT_NAME}_ELEVATE_ST_TO_PT</a></p></li>
<li><p><a class="reference internal" href="#project-name-enable-cpack-packaging">${PROJECT_NAME}_ENABLE_CPACK_PACKAGING</a></p></li>
<li><p><a class="reference internal" href="#project-name-enable-cxx">${PROJECT_NAME}_ENABLE_CXX</a></p></li>
<li><p><a class="reference internal" href="#project-name-enable-c">${PROJECT_NAME}_ENABLE_C</a></p></li>
<li><p><a class="reference internal" href="#project-name-enable-development-mode">${PROJECT_NAME}_ENABLE_DEVELOPMENT_MODE</a></p></li>
<li><p><a class="reference internal" href="#project-name-enable-fortran">${PROJECT_NAME}_ENABLE_Fortran</a></p></li>
<li><p><a class="reference internal" href="#project-name-enable-install-cmake-config-files">${PROJECT_NAME}_ENABLE_INSTALL_CMAKE_CONFIG_FILES</a></p></li>
<li><p><a class="reference internal" href="#project-name-enable-secondary-tested-code">${PROJECT_NAME}_ENABLE_SECONDARY_TESTED_CODE</a></p></li>
<li><p><a class="reference internal" href="#project-name-exclude-disabled-subpackages-from-distribution">${PROJECT_NAME}_EXCLUDE_DISABLED_SUBPACKAGES_FROM_DISTRIBUTION</a></p></li>
<li><p><a class="reference internal" href="#project-name-generate-export-file-dependencies">${PROJECT_NAME}_GENERATE_EXPORT_FILE_DEPENDENCIES</a></p></li>
<li><p><a class="reference internal" href="#project-name-generate-version-date-files">${PROJECT_NAME}_GENERATE_VERSION_DATE_FILES</a></p></li>
<li><p><a class="reference internal" href="#project-name-generate-repo-version-file">${PROJECT_NAME}_GENERATE_REPO_VERSION_FILE</a></p></li>
<li><p><a class="reference internal" href="#project-name-imported-no-system">${PROJECT_NAME}_IMPORTED_NO_SYSTEM</a></p></li>
<li><p><a class="reference internal" href="#project-name-install-libraries-and-headers">${PROJECT_NAME}_INSTALL_LIBRARIES_AND_HEADERS</a></p></li>
<li><p><a class="reference internal" href="#project-name-make-install-group-readable">${PROJECT_NAME}_MAKE_INSTALL_GROUP_READABLE</a></p></li>
<li><p><a class="reference internal" href="#project-name-make-install-group-writable">${PROJECT_NAME}_MAKE_INSTALL_GROUP_WRITABLE</a></p></li>
<li><p><a class="reference internal" href="#project-name-make-install-world-readable">${PROJECT_NAME}_MAKE_INSTALL_WORLD_READABLE</a></p></li>
<li><p><a class="reference internal" href="#project-name-must-find-all-tpl-libs">${PROJECT_NAME}_MUST_FIND_ALL_TPL_LIBS</a></p></li>
<li><p><a class="reference internal" href="#project-name-requires-python">${PROJECT_NAME}_REQUIRES_PYTHON</a></p></li>
<li><p><a class="reference internal" href="#project-name-set-install-rpath">${PROJECT_NAME}_SET_INSTALL_RPATH</a></p></li>
<li><p><a class="reference internal" href="#project-name-show-test-start-end-date-time">${PROJECT_NAME}_SHOW_TEST_START_END_DATE_TIME</a></p></li>
<li><p><a class="reference internal" href="#project-name-test-categories">${PROJECT_NAME}_TEST_CATEGORIES</a></p></li>
<li><p><a class="reference internal" href="#project-name-tpl-system-include-dirs">${PROJECT_NAME}_TPL_SYSTEM_INCLUDE_DIRS</a></p></li>
<li><p><a class="reference internal" href="#project-name-trace-add-test">${PROJECT_NAME}_TRACE_ADD_TEST</a></p></li>
<li><p><a class="reference internal" href="#project-name-use-gnuinstalldirs">${PROJECT_NAME}_USE_GNUINSTALLDIRS</a></p></li>
<li><p><a class="reference internal" href="#project-name-uses-python">${PROJECT_NAME}_USES_PYTHON</a></p></li>
<li><p><a class="reference internal" href="#dart-testing-timeout">DART_TESTING_TIMEOUT</a></p></li>
<li><p><a class="reference internal" href="#cmake-install-rpath-use-link-path">CMAKE_INSTALL_RPATH_USE_LINK_PATH</a></p></li>
<li><p><a class="reference internal" href="#mpi-exec-max-numprocs">MPI_EXEC_MAX_NUMPROCS</a></p></li>
<li><p><a class="reference internal" href="#pythoninterp-find-version">PythonInterp_FIND_VERSION</a></p></li>
</ul>
<p>These options are described below.</p>
<p id="project-name-assert-correct-tribits-usage"><strong>${PROJECT_NAME}_ASSERT_CORRECT_TRIBITS_USAGE</strong></p>
<blockquote>
<div><p>The CMake cache variable <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ASSERT_CORRECT_TRIBITS_USAGE</span></code> is
used to define how some invalid TriBITS usage checks are handled.  The valid
values include ‘FATAL_ERROR’, ‘SEND_ERROR’, ‘WARNING’, and ‘IGNORE’.  The
default value is ‘FATAL_ERROR’ for a project when
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_DEVELOPMENT_MODE=ON</span></code>, which is best for
development mode for a project that currently has no invalid usage patterns.
The default is ‘IGNORE’ when
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_DEVELOPMENT_MODE=OFF</span></code>.  But a project with some
existing invalid usage patterns might want to set, for example, a default of
‘WARNING’ in order to allow for a smooth upgrade of TriBITS.  To do so,
set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_ASSERT_CORRECT_TRIBITS_USAGE_DEFAULT WARNING)
</pre></div>
</div>
<p>in the project’s base <a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file.</p>
</div></blockquote>
<p id="project-name-c-standard"><strong>${PROJECT_NAME}_C_Standard</strong></p>
<blockquote>
<div><p>The variable <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_C_Standard</span></code> is used define the C standard
pass to the compiler in <code class="docutils literal notranslate"><span class="pre">--std=&lt;cstd&gt;</span></code> for GCC builds of the project.
TriBITS sets the default as <code class="docutils literal notranslate"><span class="pre">c99</span></code> but the project can set a new default in
the project’s base <a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> file with, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_C_Standard_DEFAULT c11)
</pre></div>
</div>
</div></blockquote>
<p id="project-name-check-for-unparsed-arguments"><strong>${PROJECT_NAME}_CHECK_FOR_UNPARSED_ARGUMENTS</strong></p>
<blockquote>
<div><p>The variable <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_CHECK_FOR_UNPARSED_ARGUMENTS</span></code> determines how
unparsed and otherwise ignored arguments are handled in TriBITS functions
that are called by the client TriBITS projects.  These are arguments that
are left over from parsing input options to functions and macros that take
both positional arguments and keyword arguments/options handled with the
<code class="docutils literal notranslate"><span class="pre">cmake_parse_arguments()</span></code> function.  For example, for the a TriBITS
function declared like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_copy_files_to_binary_dir</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">targetName</span><span class="o">&gt;</span>
  <span class="p">[</span><span class="n">SOURCE_FILES</span> <span class="o">&lt;</span><span class="n">file1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">file2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">SOURCE_DIR</span> <span class="o">&lt;</span><span class="n">sourceDir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="o">...</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>the arguments <code class="docutils literal notranslate"><span class="pre">SOURCE_FILES</span> <span class="pre">&lt;file1&gt;</span> <span class="pre">&lt;file2&gt;</span> <span class="pre">...</span></code> and those that follow are
parsed by the <code class="docutils literal notranslate"><span class="pre">cmake_parse_arguments()</span></code> function while the argument
<code class="docutils literal notranslate"><span class="pre">&lt;targetName&gt;</span></code> is a positional argument.  The problem is that any
arguments passed between the first <code class="docutils literal notranslate"><span class="pre">&lt;targetName&gt;</span></code> argument and the
specified keyword arguments like <code class="docutils literal notranslate"><span class="pre">SOURCE_FILES</span></code> and <code class="docutils literal notranslate"><span class="pre">SOURCE_DIR</span></code> are
returned as unparsed arguments and are basically ignored (which is what
happened in earlier versions of TriBITS).  For example, calling the function
as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_copy_files_to_binary_dir</span><span class="p">(</span> <span class="n">FooTestCopyFiles</span>
  <span class="n">ThisArgumentIsNotParsedAndIsIgnored</span>
  <span class="n">SOURCE_FILES</span> <span class="n">file1</span><span class="o">.</span><span class="n">cpp</span> <span class="n">file2</span><span class="o">.</span><span class="n">cpp</span> <span class="o">...</span>
  <span class="o">...</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>would result in the unparsed argument
<code class="docutils literal notranslate"><span class="pre">ThisArgumentIsNotParsedAndIsIgnored</span></code>.</p>
<p>The value of <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_CHECK_FOR_UNPARSED_ARGUMENTS</span></code> determines how
that ignored argument is handled.  If the value is <code class="docutils literal notranslate"><span class="pre">WARNING</span></code>, then it will
just result in a <code class="docutils literal notranslate"><span class="pre">message(WARNING</span> <span class="pre">...)</span></code> command that states the warning
but configure is allowed to be completed. This would be the right value to
allow an old TriBITS project to keep configuring until the warnings can be
cleaned up.  If the value is <code class="docutils literal notranslate"><span class="pre">SEND_ERROR</span></code>, then <code class="docutils literal notranslate"><span class="pre">message(SEND_ERROR</span>
<span class="pre">...)</span></code> is called.  This will result in the configure failing but will allow
configure to continue until the end (or a <code class="docutils literal notranslate"><span class="pre">FATAL_ERROR</span></code> is raised).  This
would be the right value when trying to upgrade a TriBITS project where you
wanted to see all of the warnings when upgrading TriBITS (so you could fix
them all in one shot).  Finally, the value of <code class="docutils literal notranslate"><span class="pre">FATAL_ERROR</span></code> will result in
<code class="docutils literal notranslate"><span class="pre">message(FATAL_ERROR</span> <span class="pre">...)</span></code> being called which will halt configure right
away.  This is the best value when developing on a TriBITS project that is
already clean but you want to catch new developer-inserted errors right
away.</p>
<p>The default value for <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_CHECK_FOR_UNPARSED_ARGUMENTS</span></code> is
<code class="docutils literal notranslate"><span class="pre">WARNING</span></code>, so that it will be backward compatible for TriBITS projects
that might have previously undetected unparased and therefore ignored
argument .  However, a project can change the default by setting, for
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_CHECK_FOR_UNPARSED_ARGUMENTS_DEFAULT FATAL_ERROR)
</pre></div>
</div>
<p>in the <a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file.</p>
<p>The user of a TriBITS project should not be able to trigger this unparsed
arguments condition so this variable is not documented in the <a class="reference external" href="TribitsBuildReference.html">TriBITS Build
Reference</a>.  But it is still a CMake cache var that is documented in the
CMakeCache.txt file and can be set by the user or developer if desired.</p>
</div></blockquote>
<p id="project-name-configure-options-file-append"><strong>${PROJECT_NAME}_CONFIGURE_OPTIONS_FILE_APPEND</strong></p>
<blockquote>
<div><p>The variable <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_CONFIGURE_OPTIONS_FILE_APPEND</span></code> is used to
define the absolute path to a file (or a list of files) that should be
included after the files listed in
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_CONFIGURE_OPTIONS_FILE</span></code>.  This variable can be used by
the TriBITS project to define, for example, a standard set of development
environments in the base <a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> file with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_CONFIGURE_OPTIONS_FILE_APPEND_DEFAULT
  &quot;${CMAKE_CURRENT_LIST_DIR}/cmake/StdDevEnvs.cmake&quot;)
</pre></div>
</div>
<p><strong>before</strong> the <a class="reference internal" href="#id2">tribits_project()</a> command.  By including this file(s)
after the file(s) listed in <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_CONFIGURE_OPTIONS_FILE</span></code>, the
user can override the variables set in this appended file(s).  But it is
important that these variables best set after the users options have been
set but before the Package and TPL dependency analysis is done (because this
might enable or disable some TPLs).</p>
</div></blockquote>
<p id="project-name-cpack-source-generator"><strong>${PROJECT_NAME}_CPACK_SOURCE_GENERATOR</strong></p>
<blockquote>
<div><p>The variable <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_CPACK_SOURCE_GENERATOR</span></code> determines the CPack
source generation types that are created when the <code class="docutils literal notranslate"><span class="pre">package_source</span></code> target
is run.  The TriBITS default is set to <code class="docutils literal notranslate"><span class="pre">TGZ</span></code>.  However, this default can
be overridden by setting, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_CPACK_SOURCE_GENERATOR_DEFAULT &quot;TGZ;TBZ2&quot;)
</pre></div>
</div>
<p>This variable should generally be set in the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">projectDir</span><span class="o">&gt;/</span><span class="n">cmake</span><span class="o">/</span><span class="n">CallbackDefineProjectPackaging</span><span class="o">.</span><span class="n">cmake</span>
</pre></div>
</div>
<p>instead of in the base-level <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file so that it goes along
with rest of the project-specific CPack packaging options.</p>
</div></blockquote>
<p id="project-name-ctest-do-all-at-once"><strong>${PROJECT_NAME}_CTEST_DO_ALL_AT_ONCE</strong></p>
<blockquote>
<div><p>The variable <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_CTEST_DO_ALL_AT_ONCE</span></code> determines if the
CTest driver scripts using <a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a> configure, build, test
and submit results to CDash all-at-once for all of the packages being tested
or if instead is done package-by-package.  Currently, the default is set to
<code class="docutils literal notranslate"><span class="pre">FALSE</span></code> for the package-by-package mode (for historical reasons) but the
default can be set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> by setting:</p>
<blockquote>
<div><p>set(${PROJECT_NAME}_CTEST_DO_ALL_AT_ONCE_DEFAULT “TRUE”)</p>
</div></blockquote>
<p>in the project’s <a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file.  (This default must
be changed in the <code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;/ProjectName.cmake</span></code> file and <strong>NOT</strong> the
<a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> file because the latter is not directly
processed in CTest -S driver scripts using <code class="docutils literal notranslate"><span class="pre">tribits_ctest_driver()</span></code>.)</p>
<p>In general, a project should change the default to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> when using a
newer CDash installation with CDash versions 3.0+ that can accomidate the
results coming from ctest -S and display them package-by-package very
nicely.  Otherwise, most projects are better off with package-by-package
mode since it results in nicer display on CDash for older CDash versions.</p>
</div></blockquote>
<p id="project-name-disable-enabled-forward-dep-packages"><strong>${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES</strong></p>
<blockquote>
<div><p>If <a class="reference internal" href="#project-name-disable-enabled-forward-dep-packages-on">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES=ON</a> (the TriBITS
default value), then any explicitly enabled packages that have disabled
<a class="reference internal" href="#upstream">upstream</a> required packages or TPLs will be disabled.  If
<a class="reference internal" href="#project-name-disable-enabled-forward-dep-packages-off">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES=OFF</a>, then an
configure error will occur.  For more details also see
<a class="reference external" href="TribitsBuildReference.html">TribitsBuildReference</a> and <a class="reference internal" href="#disables-trump-enables-where-there-is-a-conflict">Disables trump enables where there is a
conflict</a>.  A project can define a different default value by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES_DEFAULT FALSE)
</pre></div>
</div>
</div></blockquote>
<p id="project-name-elevate-st-to-pt"><strong>${PROJECT_NAME}_ELEVATE_ST_TO_PT</strong></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ELEVATE_ST_TO_PT</span></code> is set to <code class="docutils literal notranslate"><span class="pre">ON</span></code>, then all <code class="docutils literal notranslate"><span class="pre">ST</span></code> SE
packages will be elevated to <code class="docutils literal notranslate"><span class="pre">PT</span></code> packages.  The TriBITS default is
obviously <code class="docutils literal notranslate"><span class="pre">OFF</span></code>.  The default can be changed by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_ELEVATE_ST_TO_PT_DEFAULT ON)
</pre></div>
</div>
<p>There are projects, especially meta-projects, where the distinction between
<code class="docutils literal notranslate"><span class="pre">PT</span></code> and <code class="docutils literal notranslate"><span class="pre">ST</span></code> code is not helpful or the assignment of <code class="docutils literal notranslate"><span class="pre">PT</span></code> and <code class="docutils literal notranslate"><span class="pre">ST</span></code>
packages in a repository is not appropriate with respect to the outer
meta-project.  An example project like this CASL VERA.  Changing the default
to <code class="docutils literal notranslate"><span class="pre">ON</span></code> allows any and packages to be considered in pre-push testing.</p>
</div></blockquote>
<p id="project-name-enable-cpack-packaging"><strong>${PROJECT_NAME}_ENABLE_CPACK_PACKAGING</strong></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_CPACK_PACKAGING</span></code> is <code class="docutils literal notranslate"><span class="pre">ON</span></code>, then CPack support
is enabled and some TriBITS code is run that is needed to set up
data-structures that are used by the built-in CMake target
<code class="docutils literal notranslate"><span class="pre">package_source</span></code>.  The TriBITS default is <code class="docutils literal notranslate"><span class="pre">OFF</span></code> with the idea that the
average developer or user will not be wanting to create source distributions
with CPack.  However, this default can be changed by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_ENABLE_CPACK_PACKAGING_DEFAULT ON)
</pre></div>
</div>
</div></blockquote>
<p id="project-name-enable-cxx"><strong>${PROJECT_NAME}_ENABLE_CXX</strong></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_CXX</span></code> is <code class="docutils literal notranslate"><span class="pre">ON</span></code>, then C++ language support for
the project will be enabled and the C++ compiler must be found.  By default,
TriBITS sets this to <code class="docutils literal notranslate"><span class="pre">ON</span></code> for all systems.  A project never requires C++
can set this to off by default by setting:</p>
<blockquote>
<div><p>set(${PROJECT_NAME}_ENABLE_CXX_DEFAULT FALSE)</p>
</div></blockquote>
</div></blockquote>
<p id="project-name-enable-c"><strong>${PROJECT_NAME}_ENABLE_C</strong></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_C</span></code> is <code class="docutils literal notranslate"><span class="pre">ON</span></code>, then C language support for the
project will be enabled and the C compiler must be found.  By default,
TriBITS sets this to <code class="docutils literal notranslate"><span class="pre">ON</span></code> for all systems.  A project never requires C can
set this to off by default by setting:</p>
<blockquote>
<div><p>set(${PROJECT_NAME}_ENABLE_C_DEFAULT FALSE)</p>
</div></blockquote>
<p>If a project does not have any native C code a good default would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_ENABLE_C_DEFAULT FALSE)
</pre></div>
</div>
<p>NOTE: It is usually not a good idea to always force off C, or any compiler,
because extra repositories and packages might be added by someone that might
require the compiler and we don’t want to unnecessarily limit the generality
of a given TriBITS build.  Setting the default for all platforms should be
sufficient.</p>
</div></blockquote>
<p id="project-name-enable-development-mode-default"><span id="project-name-enable-development-mode"></span><strong>${PROJECT_NAME}_ENABLE_DEVELOPMENT_MODE</strong></p>
<blockquote>
<div><p>The variable <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_DEVELOPMENT_MODE</span></code> switches the
TriBITS project from development mode to release mode.  The default for this
variable <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_DEVELOPMENT_MODE_DEFAULT</span></code> should be set
in the project’s <a class="reference internal" href="#projectdir-version-cmake">&lt;projectDir&gt;/Version.cmake</a> file and switched from <code class="docutils literal notranslate"><span class="pre">ON</span></code>
to <code class="docutils literal notranslate"><span class="pre">OFF</span></code> when creating a release (see <a class="reference internal" href="#project-and-repository-versioning-and-release-mode">Project and Repository Versioning
and Release Mode</a>).  When <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_DEVELOPMENT_MODE</span></code> is
<code class="docutils literal notranslate"><span class="pre">ON</span></code>, several other variables are given defaults appropriate for
development mode.  For example, <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ASSERT_MISSING_PACKAGES</span></code>
is set to <code class="docutils literal notranslate"><span class="pre">ON</span></code> by default in development mode but is set to <code class="docutils literal notranslate"><span class="pre">OFF</span></code> by
default in release mode.  In addition, strong compiler warnings are enabled
by default in development mode but are disabled by default in release mode.
This variable also affects the behavior of <a class="reference internal" href="#tribits-set-st-for-dev-mode">tribits_set_st_for_dev_mode()</a>.</p>
</div></blockquote>
<p id="project-name-enable-fortran"><strong>${PROJECT_NAME}_ENABLE_Fortran</strong></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_Fortran</span></code> is <code class="docutils literal notranslate"><span class="pre">ON</span></code>, then Fortran support for
the project will be enabled and the Fortran compiler(s) must be found.  By
default, TriBITS sets this to <code class="docutils literal notranslate"><span class="pre">ON</span></code> .</p>
<p>If a project does not have any native Fortran code a good default would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_ENABLE_Fortran_DEFAULT OFF)
</pre></div>
</div>
<p>This default can be set in <a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> or <a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a>.</p>
<p>On WIN32 systems, the default for <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_Fortran_DEFAULT</span></code>
is set to <code class="docutils literal notranslate"><span class="pre">OFF</span></code> since it can be difficult to get a Fortran compiler for
native Windows.</p>
<p>Given that a native Fortran compiler is not supported by default on Windows
and on most Mac OSX systems, projects that have optional Fortran code may
decide to set the default depending on the platform by setting, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>if ( (WIN32 AND NOT CYGWIN) OR (CMAKE_HOST_SYSTEM_NAME STREQUAL &quot;Darwin&quot;) )
  message(STATUS &quot;Warning: Setting ${PROJECT_NAME}_ENABLE_Fortran=OFF by default&quot;
   &quot; because this is Windows (not cygwin) and we assume to not have Fortran!&quot;)
  set(${PROJECT_NAME}_ENABLE_Fortran_DEFAULT OFF)
else()
  set(${PROJECT_NAME}_ENABLE_Fortran_DEFAULT ON)
endif()
</pre></div>
</div>
<p>NOTE: It is usually not a good idea to always force off Fortran, or any
compiler, because extra repositories and packages might be added by someone
that might require the compiler and we don’t want to unnecessarily limit the
generality of a given TriBITS build.  Setting the default for all platforms
should be sufficient.</p>
</div></blockquote>
<p id="project-name-enable-install-cmake-config-files"><strong>${PROJECT_NAME}_ENABLE_INSTALL_CMAKE_CONFIG_FILES</strong></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_INSTALL_CMAKE_CONFIG_FILES</span></code> is set to <code class="docutils literal notranslate"><span class="pre">ON</span></code>,
then <code class="docutils literal notranslate"><span class="pre">&lt;PackageName&gt;Config.cmake</span></code> files are created at configure time in
the build tree and installed into the install tree.  These files are used by
external CMake projects to pull in the list of compilers, compiler options,
include directories and libraries.  The TriBITS default is <code class="docutils literal notranslate"><span class="pre">OFF</span></code> but a
project can change the default by setting, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_ENABLE_INSTALL_CMAKE_CONFIG_FILES_DEFAULT ON)
</pre></div>
</div>
<p>A project would want to leave off the creation and installation of
<code class="docutils literal notranslate"><span class="pre">&lt;PackageName&gt;Config.cmake</span></code> files if it was only installing and providing
executables (see <a class="reference internal" href="#project-name-install-libraries-and-headers">${PROJECT_NAME}_INSTALL_LIBRARIES_AND_HEADERS</a>).
However, if it is wanting to provide libraries for other projects to use,
then it should turn on the default generation of these files.</p>
</div></blockquote>
<p id="project-name-enable-secondary-tested-code"><strong>${PROJECT_NAME}_ENABLE_SECONDARY_TESTED_CODE</strong></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_SECONDARY_TESTED_CODE</span></code> is <code class="docutils literal notranslate"><span class="pre">ON</span></code>, then packages
and subpackages marked as <code class="docutils literal notranslate"><span class="pre">ST</span></code> in the <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> file
will be implicitly enabled along with the <code class="docutils literal notranslate"><span class="pre">PT</span></code> packages.  Additional code
and tests may also be enabled using this option.  The TriBITS default is
<code class="docutils literal notranslate"><span class="pre">OFF</span></code> but this can be changed by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_ENABLE_SECONDARY_TESTED_CODE_DEFAULT ON)
</pre></div>
</div>
<p>in the <a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file.</p>
</div></blockquote>
<p id="project-name-exclude-disabled-subpackages-from-distribution"><strong>${PROJECT_NAME}_EXCLUDE_DISABLED_SUBPACKAGES_FROM_DISTRIBUTION</strong></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_EXCLUDE_DISABLED_SUBPACKAGES_FROM_DISTRIBUTION</span></code> is
<code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then the directories for subpackages that are not enabled are left
out of the source tarball.  This reduces the size of the tarball as much as
possible but does require that the TriBITS packages and subpackages be
properly set up to allow disabled subpackages from being excluded.  The
TriBITS default is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> but this can be changed by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_EXCLUDE_DISABLED_SUBPACKAGES_FROM_DISTRIBUTION_DEFAULT FALSE)
</pre></div>
</div>
</div></blockquote>
<p id="project-name-generate-export-file-dependencies"><strong>${PROJECT_NAME}_GENERATE_EXPORT_FILE_DEPENDENCIES</strong></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_GENERATE_EXPORT_FILE_DEPENDENCIES</span></code> is <code class="docutils literal notranslate"><span class="pre">ON</span></code>, then the
data-structures needed to generate <code class="docutils literal notranslate"><span class="pre">&lt;PackageName&gt;Config.cmake</span></code> files are
created.  These data structures are also needed in order to generate export
makefiles on demand using the function
<a class="reference internal" href="#tribits-write-flexible-package-client-export-files">tribits_write_flexible_package_client_export_files()</a>.  The default in
TriBITS is to turn this <code class="docutils literal notranslate"><span class="pre">ON</span></code> automatically by default if
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_INSTALL_CMAKE_CONFIG_FILES</span></code> is <code class="docutils literal notranslate"><span class="pre">ON</span></code>.  Else, by
default, TriBITS sets this to <code class="docutils literal notranslate"><span class="pre">OFF</span></code>.  The only reason for the project to
override the default is to set it to <code class="docutils literal notranslate"><span class="pre">ON</span></code> as with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_GENERATE_EXPORT_FILE_DEPENDENCIES_DEFAULT ON)
</pre></div>
</div>
<p>is so that the necessary data-structures are generated in order to use the
function <a class="reference internal" href="#tribits-write-flexible-package-client-export-files">tribits_write_flexible_package_client_export_files()</a>.</p>
</div></blockquote>
<p id="project-name-generate-version-date-files"><strong>${PROJECT_NAME}_GENERATE_VERSION_DATE_FILES</strong></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_GENERATE_VERSION_DATE_FILES</span></code> is <code class="docutils literal notranslate"><span class="pre">ON</span></code>, then the files
<code class="docutils literal notranslate"><span class="pre">VersionDate.cmake</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;RepoName&gt;_version_date.h</span></code> will get generated
and the generated file <code class="docutils literal notranslate"><span class="pre">&lt;RepoName&gt;_version_date.h</span></code> will get installed for
each TriBITS version-controlled repository when the local directories are
git repositories.  The default is <code class="docutils literal notranslate"><span class="pre">OFF</span></code> but the project can change that by
setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_GENERATE_VERSION_DATE_FILES ON)
</pre></div>
</div>
<p>in the <a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file.</p>
</div></blockquote>
<p id="project-name-generate-repo-version-file"><strong>${PROJECT_NAME}_GENERATE_REPO_VERSION_FILE</strong></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_GENERATE_REPO_VERSION_FILE</span></code> is <code class="docutils literal notranslate"><span class="pre">ON</span></code>, then the file
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;RepoVersion.txt</span></code> will get generated as a byproduct of
configuring with CMake.  See <a class="reference internal" href="#multi-repository-support">Multi-Repository Support</a> and
<a class="reference external" href="TribitsBuildReference.html#generating-a-project-repo-version-file">&lt;Project&gt;_GENERATE_REPO_VERSION_FILE</a>.  The default is <code class="docutils literal notranslate"><span class="pre">OFF</span></code> but the
project can change that by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_GENERATE_REPO_VERSION_FILE_DEFAULT ON)
</pre></div>
</div>
<p>in the <a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file.</p>
<p>Note that if a <code class="docutils literal notranslate"><span class="pre">git</span></code> exectauble cannot be found at configure time, then
the default <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_GENERATE_REPO_VERSION_FILE_DEFAULT</span></code> will be
overridden to <code class="docutils literal notranslate"><span class="pre">OFF</span></code>.  But if the user sets
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_GENERATE_REPO_VERSION_FILE=ON</span></code> in the cache and <code class="docutils literal notranslate"><span class="pre">git</span></code>
can’t be found, then an configure-time error will occur.</p>
</div></blockquote>
<p id="project-name-imported-no-system"><strong>${PROJECT_NAME}_IMPORTED_NO_SYSTEM</strong></p>
<blockquote>
<div><p>By default, include directories from IMPORTED library targets from the
TriBITS project’s installed <code class="docutils literal notranslate"><span class="pre">&lt;Package&gt;Config.cmake</span></code> files will be
considered <code class="docutils literal notranslate"><span class="pre">SYSTEM</span></code> headers and therefore be included on the compile lines
of downstream CMake projects with <code class="docutils literal notranslate"><span class="pre">-isystem</span></code> with most compilers.
However, if <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_IMPORTED_NO_SYSTEM</span></code> is set to <code class="docutils literal notranslate"><span class="pre">ON</span></code> (only
supported for CMake versions 3.23 or greater), then all of the IMPORTED
library targets exported into the set of installed <code class="docutils literal notranslate"><span class="pre">&lt;Package&gt;Config.cmake</span></code>
files will have the <code class="docutils literal notranslate"><span class="pre">IMPORTED_NO_SYSTEM</span></code> property set.  This will cause
downstream customer CMake projects to apply the include directories from
these IMPORTED library targets as non-system include directories.  On most
compilers, that means that the include directories will be listed on the
compile lines with <code class="docutils literal notranslate"><span class="pre">-I</span></code> instead of with <code class="docutils literal notranslate"><span class="pre">-isystem</span></code>.  (See more details
in the TriBITS Build Reference for <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_IMPORTED_NO_SYSTEM</span></code>.)</p>
<p>The default value set by TriBITS itself is <code class="docutils literal notranslate"><span class="pre">OFF</span></code> but a TriBITS project can
change the default value to <code class="docutils literal notranslate"><span class="pre">ON</span></code> by adding:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>if (CMAKE_VERSION VERSION_GREATER_EQUAL 3.23)
  set(${PROJECT_NAME}_IMPORTED_NO_SYSTEM_DEFAULT ON)
endif()
</pre></div>
</div>
<p>in the <a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file.  (NOTE: The above <code class="docutils literal notranslate"><span class="pre">if()</span></code>
statement ensures that a configure error will not occur if a version of
CMake less than 3.23 is used.  But if the TriBITS project minimum CMake
version is 3.23 or greater, then the above <code class="docutils literal notranslate"><span class="pre">if()</span></code> statement guard can be
removed.)</p>
</div></blockquote>
<p id="project-name-install-libraries-and-headers"><strong>${PROJECT_NAME}_INSTALL_LIBRARIES_AND_HEADERS</strong></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_INSTALL_LIBRARIES_AND_HEADERS</span></code> is set to <code class="docutils literal notranslate"><span class="pre">ON</span></code>, then
any defined libraries or header files that are listed in calls to
<a class="reference internal" href="#tribits-add-library">tribits_add_library()</a> or <a class="reference internal" href="#tribits-install-headers">tribits_install_headers()</a> will be installed
(unless options are passed into <a class="reference internal" href="#tribits-add-library">tribits_add_library()</a> that disable
installs).  If set to <code class="docutils literal notranslate"><span class="pre">OFF</span></code>, then headers and libraries will <em>not</em> be
installed by default and only <code class="docutils literal notranslate"><span class="pre">INSTALLABLE</span></code> executables added with
<a class="reference internal" href="#tribits-add-executable">tribits_add_executable()</a> will be installed.  However, as described in
<a class="reference external" href="TribitsBuildReference.html">TribitsBuildReference</a>, shared libraries will always be installed if
enabled since they are needed by the installed executables.</p>
<p>For a TriBITS project that is primarily delivering libraries
(e.g. Trilinos), then it makes sense to leave the TriBITS default which is
<code class="docutils literal notranslate"><span class="pre">ON</span></code> or explicitly set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_INSTALL_LIBRARIES_AND_HEADERS_DEFAULT  ON)
</pre></div>
</div>
<p>For a TriBITS project that is primarily delivering executables (e.g. VERA),
then it makes sense to set the default to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_INSTALL_LIBRARIES_AND_HEADERS_DEFAULT  OFF)
</pre></div>
</div>
</div></blockquote>
<p id="project-name-make-install-world-readable"><span id="project-name-make-install-group-writable"></span><span id="project-name-make-install-group-readable"></span><strong>${PROJECT_NAME}_MAKE_INSTALL_GROUP_READABLE</strong>
<strong>${PROJECT_NAME}_MAKE_INSTALL_GROUP_WRITABLE</strong>
<strong>${PROJECT_NAME}_MAKE_INSTALL_WORLD_READABLE</strong></p>
<blockquote>
<div><p>Determines the permissions for directories and files created during the
execution of the of the <code class="docutils literal notranslate"><span class="pre">install</span></code> and <code class="docutils literal notranslate"><span class="pre">isntall_package_by_package</span></code>
targets.</p>
<p>To make the created directories by only group readable for the project by
default, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_MAKE_INSTALL_WORLD_READABLE_DEFAULT TRUE)
</pre></div>
</div>
<p>To make the created directories by only group writable (and readable) for
the project by default, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_MAKE_INSTALL_WORLD_WRITABLE_DEFAULT TRUE)
</pre></div>
</div>
<p>To make the created directories by world readable for the project by
default, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_MAKE_INSTALL_WORLD_READABLE_DEFAULT TRUE)
</pre></div>
</div>
<p>On non-Windows systems, these set permissions for all files and directories
from the the user-set base directory
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SET_GROUP_AND_PERMISSIONS_ON_INSTALL_BASE_DIR</span></code> on down.
For more details see <a class="reference internal" href="#installation-considerations">Installation considerations</a>.</p>
<p>These defaults can be set in the <a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file.</p>
</div></blockquote>
<p id="project-name-must-find-all-tpl-libs"><strong>${PROJECT_NAME}_MUST_FIND_ALL_TPL_LIBS</strong></p>
<blockquote>
<div><p>Determines if all of the libraries listed in <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIBRARY_NAMES</span></code> for
a given TPL must be found for each enabled TPL.  By default, this is
<code class="docutils literal notranslate"><span class="pre">FALSE</span></code> which means that the determination if all of the listed libs for a
TPL should be found is determined by the <code class="docutils literal notranslate"><span class="pre">MUST_FIND_ALL_LIBS</span></code> option to
the <a class="reference internal" href="#tribits-tpl-find-include-dirs-and-libraries">tribits_tpl_find_include_dirs_and_libraries()</a> function in the TPL
find module.  To change the default for this, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_MUST_FIND_ALL_TPL_LIBS_DEFAULT  TRUE)
</pre></div>
</div>
<p>in the <a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file.</p>
</div></blockquote>
<p id="project-name-requires-python"><strong>${PROJECT_NAME}_REQUIRES_PYTHON</strong></p>
<blockquote>
<div><p>If the TriBITS project requires Python, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_REQUIRES_PYTHON  TRUE)
</pre></div>
</div>
<p>in the <a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file (See <a class="reference internal" href="#python-support">Python Support</a>).  The
default is implicitly <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>.</p>
</div></blockquote>
<p id="project-name-set-install-rpath"><strong>${PROJECT_NAME}_SET_INSTALL_RPATH</strong></p>
<blockquote>
<div><p>The cache variable <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SET_INSTALL_RPATH</span></code> is used to define
the default RPATH mode for the TriBITS project (see <a class="reference external" href="TribitsBuildReference.html#setting-install-rpath">Setting install RPATH</a>
for details).  The TriBITS default is to set this to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> but the
TriBITS project can be set the default to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_SET_INSTALL_RPATH_DEFAULT FALSE)
</pre></div>
</div>
<p>in the project’s <a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file (see <a class="reference internal" href="#rpath-handling">RPATH
Handling</a>).</p>
</div></blockquote>
<p id="project-name-show-test-start-end-date-time"><strong>${PROJECT_NAME}_SHOW_TEST_START_END_DATE_TIME</strong></p>
<blockquote>
<div><p>The cache variable <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SHOW_TEST_START_END_DATE_TIME</span></code>
determines if the start and end date/time for each advanced test (i.e. added
with <a class="reference internal" href="#tribits-add-advanced-test">tribits_add_advanced_test()</a>) is printed or not with each test.  If
set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> this also causes in the timing for each <code class="docutils literal notranslate"><span class="pre">TEST_&lt;IDX&gt;</span></code> block
to be printed as well.  The TriBITS default is <code class="docutils literal notranslate"><span class="pre">OFF</span></code> but a TriBITS project
can change this default by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_SHOW_TEST_START_END_DATE_TIME_DEFAULT ON)
</pre></div>
</div>
<p>The implementation of this feature currently uses <code class="docutils literal notranslate"><span class="pre">execute_process(date)</span></code>
and therefore will work on many (but perhaps not all) Linux/Unix/Mac systems
and not on Windows systems.</p>
<p>NOTE: In a future version of CTest, this option may turn on start and end
date/time for regular tests added with <a class="reference internal" href="#tribits-add-test">tribits_add_test()</a> (which uses a
raw command with <code class="docutils literal notranslate"><span class="pre">add_test()</span></code>).</p>
</div></blockquote>
<p id="project-name-skip-extrarepos-file"><strong>${PROJECT_NAME}_SKIP_EXTRAREPOS_FILE</strong></p>
<blockquote>
<div><p>The cache variable <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SKIP_EXTRAREPOS_FILE</span></code> is set in the
<a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_SKIP_EXTRAREPOS_FILE TRUE)
</pre></div>
</div>
<p>for projects that don’t have a
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file.  This variable needs
to be set when using the CTest driver script and does not need to be set for
the basic configure and build process.</p>
</div></blockquote>
<p id="project-name-test-categories-default"><span id="project-name-test-categories"></span><strong>${PROJECT_NAME}_TEST_CATEGORIES</strong></p>
<blockquote>
<div><p>The cache variable <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TEST_CATEGORIES</span></code> determines what tests
defined using <a class="reference internal" href="#tribits-add-test">tribits_add_test()</a> and <a class="reference internal" href="#tribits-add-advanced-test">tribits_add_advanced_test()</a> will
be added for <code class="docutils literal notranslate"><span class="pre">ctest</span></code> to run (see <a class="reference internal" href="#test-test-category">Test Test Category</a>).  The TriBITS
default is <code class="docutils literal notranslate"><span class="pre">NIGHTLY</span></code> for a standard local build.  The <a class="reference internal" href="#checkin-test-py">checkin-test.py</a>
tool sets this to <code class="docutils literal notranslate"><span class="pre">BASIC</span></code> by default.  A TriBITS project can override the
default for a basic configure using, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_TEST_CATEGORIES_DEFAULT BASIC)
</pre></div>
</div>
<p>The justification for having the default <a class="reference internal" href="#test-test-category">Test Test Category</a> be
<code class="docutils literal notranslate"><span class="pre">NIGHTLY</span></code> instead of <code class="docutils literal notranslate"><span class="pre">BASIC</span></code> is that when someone is enabling a package
to develop on it or install it, we want them by default to be seeing the
full version of the test suite (shy of the <a class="reference internal" href="#test-test-category-heavy">Test Test Category HEAVY</a>
tests which can be very expensive) for the packages they are explicitly
enabling.  Typically they will not be enabling forward/<a class="reference internal" href="#downstream">downstream</a>
dependent packages so the cost of running the test suite should not be too
prohibitive.  This all depends on how good of a job the development teams do
in making their test suites run fast and keeping the cost of running the
tests down.  See the section <a class="reference internal" href="#tribits-automated-testing">TriBITS Automated Testing</a> for a more
detailed discussion.</p>
</div></blockquote>
<p id="project-name-tpl-system-include-dirs-default"><span id="project-name-tpl-system-include-dirs"></span><strong>${PROJECT_NAME}_TPL_SYSTEM_INCLUDE_DIRS</strong></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TPL_SYSTEM_INCLUDE_DIRS</span></code> is set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then the
<code class="docutils literal notranslate"><span class="pre">SYSTEM</span></code> flag will be passed into the <code class="docutils literal notranslate"><span class="pre">include_directories()</span></code> command
for TPL include directories for every TPL for every package, by default.  On
some systems this will result in include directories being passed to the
compiler with <code class="docutils literal notranslate"><span class="pre">-isystem</span></code> instead of <code class="docutils literal notranslate"><span class="pre">-I</span></code>.  This helps to avoid compiler
warning coming from TPL header files for C and C++.  However, with CMake
version 3.2 and less, this also results in <code class="docutils literal notranslate"><span class="pre">-isystem</span></code> being passed to the
Fortran compiler (e.g. gfortran) as well.  This breaks the reading of
Fortran module files (perhaps a bug in gfortran).  Because of this issue
with Fortran, the TriBITS default for this option is set to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> but a
project can override the default using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_TPL_SYSTEM_INCLUDE_DIRS_DEFAULT  TRUE)
</pre></div>
</div>
<p>(This would be a good default if the project has not Fortran files or has
not Fortran files that use modules provided by TPLs).</p>
<p>However, if a package or subpackage sets:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PACKAGE_NAME}_SKIP_TPL_SYSTEM_INCLUDE_DIRS  TRUE)
</pre></div>
</div>
<p>in its <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> files before the <code class="docutils literal notranslate"><span class="pre">tribits_add_library()</span></code> or
<code class="docutils literal notranslate"><span class="pre">tribits_add_executable()</span></code> commands are called in that package, then
<code class="docutils literal notranslate"><span class="pre">SYSTEM</span></code> will <strong>not</strong> be passed into <code class="docutils literal notranslate"><span class="pre">include_directories()</span></code> for TPL
include dirs.  This is how some TriBITS packages with Fortran files that use
Fortran modules avoid passing in <code class="docutils literal notranslate"><span class="pre">-isystem</span></code> to the Fortran compiles and
thereby avoid the defect with gfortran described above.  If CMake version
3.3 or greater is used, this variable is not required.</p>
<p>NOTE: Currently, a TriBITS SE package must have a direct dependency on a TPL
to have <code class="docutils literal notranslate"><span class="pre">-isystem</span></code> added to a TPL’s include directories on the compile
lines for that package.  That is, the TPL must be listed in the
<code class="docutils literal notranslate"><span class="pre">LIB_REQUIRED_TPLS</span></code> or <code class="docutils literal notranslate"><span class="pre">LIB_OPTIONAL_TPLS</span></code> arguments passed into the
<a class="reference internal" href="#tribits-package-define-dependencies">tribits_package_define_dependencies()</a> function in the SE package’s
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> file.  In addition, to have
<code class="docutils literal notranslate"><span class="pre">-isystem</span></code> added to the include directories for a TPL when compiling the
tests for an SE package, it must be listed in the <code class="docutils literal notranslate"><span class="pre">TEST_REQUIRED_TPLS</span></code> or
<code class="docutils literal notranslate"><span class="pre">TEST_OPTIONAL_TPLS</span></code> arguments.  This is a limitation of the TriBITS
implementation that will be removed in a future version of TriBITS.</p>
</div></blockquote>
<p id="project-name-trace-add-test-default"><span id="project-name-trace-add-test"></span><strong>${PROJECT_NAME}_TRACE_ADD_TEST</strong></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TRACE_ADD_TEST</span></code> is set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then a single line
will be printed for each call to <a class="reference internal" href="#tribits-add-test">tribits_add_test()</a> and
<a class="reference internal" href="#tribits-add-advanced-test">tribits_add_advanced_test()</a> for if the test is added or not and if not
then why.  The default is set based on the value of
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_VERBOSE_CONFIGURE</span></code> but a project can override the default
by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_TRACE_ADD_TEST_DEFAULT  TRUE)
</pre></div>
</div>
</div></blockquote>
<p id="project-name-use-gnuinstalldirs"><strong>${PROJECT_NAME}_USE_GNUINSTALLDIRS</strong></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_USE_GNUINSTALLDIRS</span></code> is set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then the
default install paths will be determined by the standard CMake module
<code class="docutils literal notranslate"><span class="pre">GNUInstallDirs</span></code>.  Otherwise, platform independent install paths are used
by default.</p>
<p>A project can use the paths given the cmake module <code class="docutils literal notranslate"><span class="pre">GNUInstallDirs</span></code> by
default by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_USE_GNUINSTALLDIRS_DEFAULT TRUE)
</pre></div>
</div>
<p>in the project’s top-level <a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> file or its
<a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file.  The default is <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>.</p>
</div></blockquote>
<p id="project-name-uses-python"><strong>${PROJECT_NAME}_USES_PYTHON</strong></p>
<blockquote>
<div><p>If the TriBITS project can use Python, but does not require it, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_USES_PYTHON  TRUE)
</pre></div>
</div>
<p>in the <a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file (see <a class="reference internal" href="#python-support">Python Support</a>).  The
default for a TriBITS project is implicitly <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.  To explicitly state
that Python is never needed, set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>set(${PROJECT_NAME}_USES_PYTHON  FALSE)
</pre></div>
</div>
</div></blockquote>
<p id="dart-testing-timeout"><strong>DART_TESTING_TIMEOUT</strong></p>
<blockquote>
<div><p>The cache variable <code class="docutils literal notranslate"><span class="pre">DART_TESTING_TIMEOUT</span></code> is a built-in CMake variable
that provides a default timeout for all tests (see <a class="reference external" href="TribitsBuildReference.html#dart-testing-timeout">Setting test timeouts at
configure time</a>).  By default, TriBITS defines this to be 1500 seconds
(which is also the raw CMake default) but the project can change this
default, from 1500 to 300 for example, by setting the following in the
project’s <a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> or
<a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">DART_TESTING_TIMEOUT_DEFAULT</span> <span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p id="cmake-install-rpath-use-link-path"><strong>CMAKE_INSTALL_RPATH_USE_LINK_PATH</strong></p>
<blockquote>
<div><p>The cache variable <code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_RPATH_USE_LINK_PATH</span></code> is a built-in CMake
variable that determines if the paths for external libraries (i.e. from
TPLs) is put into the installed library RPATHS (see <a class="reference internal" href="#rpath-handling">RPATH Handling</a>).
TriBITS sets the default for this to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> but a project can change the
default back to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> by setting the following in the project’s
<a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">CMAKE_INSTALL_RPATH_USE_LINK_PATH_DEFAULT</span> <span class="n">FALSE</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p id="mpi-exec-max-numprocs"><strong>MPI_EXEC_MAX_NUMPROCS</strong></p>
<blockquote>
<div><p>The variable <code class="docutils literal notranslate"><span class="pre">MPI_EXEC_MAX_NUMPROCS</span></code> gives the maximum number of processes
for an MPI test that will be allowed as defined by <a class="reference internal" href="#tribits-add-test">tribits_add_test()</a> and
<a class="reference internal" href="#tribits-add-advanced-test">tribits_add_advanced_test()</a>.  The TriBITS default is set to be <code class="docutils literal notranslate"><span class="pre">4</span></code> (for
no good reason really but it needs to stay that way for backward
compatibility).  This default can be changed by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">MPI_EXEC_MAX_NUMPROCS_DEFAULT</span> <span class="o">&lt;</span><span class="n">newDefaultMax</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>While this default can be changed for the project as a whole on all
platforms, it is likely better to change this default on a
machine-by-machine basis to correspond to the load that can be accommodated
by a given machine (or class of machines).  For example if a given machine
has 64 cores, a reasonable number for <code class="docutils literal notranslate"><span class="pre">MPI_EXEC_MAX_NUMPROCS_DEFAULT</span></code> is
64.</p>
</div></blockquote>
<p id="pythoninterp-find-version"><strong>PythonInterp_FIND_VERSION</strong></p>
<blockquote>
<div><p>Determines the version of Python that is looked for.  TriBITS requires at
least version “2.7”.  A particular TriBITS project can require a higher
version of TriBITS and this is set using, for example:</p>
<blockquote>
<div><p>set(PythonInterp_FIND_VERSION_DEFAULT “3.5.2”)</p>
</div></blockquote>
<p>in the <a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> file (See <a class="reference internal" href="#python-support">Python Support</a>).  The
default is version “2.7”.  The user can force a more recent version of
Python by configuring with, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">PythonInterp_FIND_VERSION</span><span class="o">=</span><span class="s2">&quot;3.6.2&quot;</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="tribits-macros-and-functions">
<h2><a class="toc-backref" href="#id124"><span class="sectnum">11.2</span> TriBITS Macros and Functions</a><a class="headerlink" href="#tribits-macros-and-functions" title="Permalink to this heading"></a></h2>
<p>The following subsections give detailed documentation for the CMake macros and
functions that make up the core TriBITS system.  These are what are used by
TriBITS project developers in their <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> and other files.  All
of these functions and macros should be automatically available when
processing the project’s and package’s variables files if used properly.
Therefore, no explicit <code class="docutils literal notranslate"><span class="pre">include()</span></code> statements should be needed other than
the initial include of the <code class="docutils literal notranslate"><span class="pre">TriBITS.cmake</span></code> file in the top-level
<a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> file so the command <a class="reference internal" href="#id2">tribits_project()</a> can be
executed.</p>
<section id="tribits-add-advanced-test">
<h3><a class="toc-backref" href="#id125">tribits_add_advanced_test()</a><a class="headerlink" href="#tribits-add-advanced-test" title="Permalink to this heading"></a></h3>
<p>Function that creates an advanced test defined by stringing together one or
more executable and/or command invocations that is run as a <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-P</span></code>
script with very flexible pass/fail criteria.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_add_advanced_test</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">testNameBase</span><span class="o">&gt;</span>
  <span class="n">TEST_0</span> <span class="p">(</span><span class="n">EXEC</span> <span class="o">&lt;</span><span class="n">execTarget0</span><span class="o">&gt;</span> <span class="o">|</span> <span class="n">CMND</span> <span class="o">&lt;</span><span class="n">cmndExec0</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">...</span>
  <span class="p">[</span><span class="n">TEST_1</span> <span class="p">(</span><span class="n">EXEC</span> <span class="o">&lt;</span><span class="n">execTarget1</span><span class="o">&gt;</span> <span class="o">|</span> <span class="n">CMND</span> <span class="o">&lt;</span><span class="n">cmndExec1</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">...</span><span class="p">]</span>
  <span class="o">...</span>
  <span class="p">[</span><span class="n">TEST_N</span> <span class="p">(</span><span class="n">EXEC</span> <span class="o">&lt;</span><span class="n">execTargetN</span><span class="o">&gt;</span> <span class="o">|</span> <span class="n">CMND</span> <span class="o">&lt;</span><span class="n">cmndExecN</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">OVERALL_WORKING_DIRECTORY</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">overallWorkingDir</span><span class="o">&gt;</span> <span class="o">|</span> <span class="n">TEST_NAME</span><span class="p">)]</span>
  <span class="p">[</span><span class="n">SKIP_CLEAN_OVERALL_WORKING_DIRECTORY</span><span class="p">]</span>
  <span class="p">[</span><span class="n">FAIL_FAST</span><span class="p">]</span>
  <span class="p">[</span><span class="n">RUN_SERIAL</span><span class="p">]</span>
  <span class="p">[</span><span class="n">KEYWORDS</span> <span class="o">&lt;</span><span class="n">keyword1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">keyword2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">COMM</span> <span class="p">[</span><span class="n">serial</span><span class="p">]</span> <span class="p">[</span><span class="n">mpi</span><span class="p">]]</span>
  <span class="p">[</span><span class="n">OVERALL_NUM_MPI_PROCS</span> <span class="o">&lt;</span><span class="n">overallNumProcs</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">OVERALL_NUM_TOTAL_CORES_USED</span> <span class="o">&lt;</span><span class="n">overallNumTotalCoresUsed</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">CATEGORIES</span> <span class="o">&lt;</span><span class="n">category0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">category1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">HOST</span> <span class="o">&lt;</span><span class="n">host0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">host1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">XHOST</span> <span class="o">&lt;</span><span class="n">host0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">host1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">HOSTTYPE</span> <span class="o">&lt;</span><span class="n">hosttype0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">hosttype1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">XHOSTTYPE</span> <span class="o">&lt;</span><span class="n">hosttype0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">hosttype1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">EXCLUDE_IF_NOT_TRUE</span> <span class="o">&lt;</span><span class="n">varname0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">varname1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">DISABLED</span> <span class="o">&lt;</span><span class="n">messageWhyDisabled</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">FINAL_PASS_REGULAR_EXPRESSION</span> <span class="s2">&quot;&lt;regex&gt;&quot;</span> <span class="o">|</span>
    <span class="n">FINAL_FAIL_REGULAR_EXPRESSION</span> <span class="s2">&quot;&lt;regex&gt;&quot;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">ENVIRONMENT</span> <span class="o">&lt;</span><span class="n">var1</span><span class="o">&gt;=&lt;</span><span class="n">value1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">var2</span><span class="o">&gt;=&lt;</span><span class="n">value2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">TIMEOUT</span> <span class="o">&lt;</span><span class="n">maxSeconds</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">LIST_SEPARATOR</span> <span class="o">&lt;</span><span class="n">sep</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">ADDED_TEST_NAME_OUT</span> <span class="o">&lt;</span><span class="n">testName</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>This function allows one to add a single CTest test that is actually a
sequence of one or more separate commands strung together in some way to
define the final pass/fail. One will want to use this function to add a test
instead of <a class="reference internal" href="#tribits-add-test">tribits_add_test()</a> when one needs to run more than one
command, or one needs more sophisticated checking of the test result other
than just grepping STDOUT (e.g. by running separate post-processing programs
to examine output files).</p>
<p>For more details on these arguments, see <a class="reference internal" href="#test-idx-exec-cmnd-test-blocks-and-arguments-tribits-add-advanced-test">TEST_&lt;idx&gt; EXEC/CMND Test Blocks
and Arguments (tribits_add_advanced_test())</a>.</p>
<p>The most common type of an atomic test block <code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx&gt;</span></code> runs a command
as either a package-built executable or just any command.  An atomic test
command block <code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx&gt;</span></code> (i.e. <code class="docutils literal notranslate"><span class="pre">TEST_0</span></code>, <code class="docutils literal notranslate"><span class="pre">TEST_1</span></code>, …) takes the
form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TEST_</span><span class="o">&lt;</span><span class="n">idx</span><span class="o">&gt;</span>
   <span class="p">(</span><span class="n">EXEC</span> <span class="o">&lt;</span><span class="n">exeRootName</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">NOEXEPREFIX</span><span class="p">]</span> <span class="p">[</span><span class="n">NOEXESUFFIX</span><span class="p">]</span> <span class="p">[</span><span class="n">ADD_DIR_TO_NAME</span><span class="p">]</span>
          <span class="p">[</span><span class="n">DIRECTORY</span> <span class="o">&lt;</span><span class="nb">dir</span><span class="o">&gt;</span><span class="p">]</span>
      <span class="o">|</span> <span class="n">CMND</span> <span class="o">&lt;</span><span class="n">cmndExec</span><span class="o">&gt;</span><span class="p">)</span>
   <span class="p">[</span><span class="n">ARGS</span> <span class="s2">&quot;&lt;arg0&gt;&quot;</span> <span class="s2">&quot;&lt;arg1&gt;&quot;</span> <span class="o">...</span> <span class="s2">&quot;&lt;argn&gt;&quot;</span><span class="p">]</span>
   <span class="p">[</span><span class="n">MESSAGE</span> <span class="s2">&quot;&lt;message&gt;&quot;</span><span class="p">]</span>
   <span class="p">[</span><span class="n">WORKING_DIRECTORY</span> <span class="o">&lt;</span><span class="n">workingDir</span><span class="o">&gt;</span><span class="p">]</span>
   <span class="p">[</span><span class="n">SKIP_CLEAN_WORKING_DIRECTORY</span><span class="p">]</span>
   <span class="p">[</span><span class="n">NUM_MPI_PROCS</span> <span class="o">&lt;</span><span class="n">numProcs</span><span class="o">&gt;</span><span class="p">]</span>
   <span class="p">[</span><span class="n">NUM_TOTAL_CORES_USED</span> <span class="o">&lt;</span><span class="n">numTotalCoresUsed</span><span class="o">&gt;</span><span class="p">]</span>
   <span class="p">[</span><span class="n">OUTPUT_FILE</span> <span class="o">&lt;</span><span class="n">outputFile</span><span class="o">&gt;</span><span class="p">]</span>
   <span class="p">[</span><span class="n">NO_ECHO_OUTPUT</span><span class="p">]]</span>
   <span class="p">[</span><span class="n">PASS_ANY</span>
     <span class="o">|</span> <span class="n">PASS_REGULAR_EXPRESSION</span> <span class="s2">&quot;&lt;regex0&gt;&quot;</span> <span class="s2">&quot;&lt;regex1&gt;&quot;</span> <span class="o">...</span>
     <span class="o">|</span> <span class="n">PASS_REGULAR_EXPRESSION_ALL</span> <span class="s2">&quot;&lt;regex0&gt;&quot;</span> <span class="s2">&quot;&lt;regex1&gt;&quot;</span> <span class="o">...</span>
     <span class="o">|</span> <span class="n">STANDARD_PASS_OUTPUT</span> <span class="p">]</span>
   <span class="p">[</span><span class="n">FAIL_REGULAR_EXPRESSION</span> <span class="s2">&quot;&lt;regex0&gt;&quot;</span> <span class="s2">&quot;&lt;regex1&gt;&quot;</span> <span class="o">...</span><span class="p">]</span>
   <span class="p">[</span><span class="n">ALWAYS_FAIL_ON_NONZERO_RETURN</span> <span class="o">|</span> <span class="n">ALWAYS_FAIL_ON_ZERO_RETURN</span><span class="p">]</span>
   <span class="p">[</span><span class="n">WILL_FAIL</span><span class="p">]</span>
</pre></div>
</div>
<p>For more information on these arguments, see <a class="reference internal" href="#test-idx-exec-cmnd-test-blocks-and-arguments-tribits-add-advanced-test">TEST_&lt;idx&gt; EXEC/CMND Test
Blocks and Arguments (tribits_add_advanced_test())</a>.</p>
<p>The other type of <code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx&gt;</span></code> block supported is for copying files and
takes the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TEST_</span><span class="o">&lt;</span><span class="n">idx</span><span class="o">&gt;</span>
  <span class="n">COPY_FILES_TO_TEST_DIR</span> <span class="o">&lt;</span><span class="n">file0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">file1</span><span class="o">&gt;</span> <span class="o">...</span> <span class="o">&lt;</span><span class="n">filen</span><span class="o">&gt;</span>
  <span class="p">[</span><span class="n">SOURCE_DIR</span> <span class="o">&lt;</span><span class="n">srcDir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">DEST_DIR</span> <span class="o">&lt;</span><span class="n">destDir</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<p>This makes it easy to copy files from the source tree (or other location) to
inside of the test directory (usually created with <code class="docutils literal notranslate"><span class="pre">OVERALL_WORKING_DIR</span>
<span class="pre">TEST_NAME</span></code>) so that tests can run in their own private working directory
(and so these files get deleted and recopied each time the test runs).  This
approach has several advantages:</p>
<ul class="simple">
<li><p>One can modify the input files and then just run the test with <code class="docutils literal notranslate"><span class="pre">ctest</span></code>
in an iterative manner (and not have to configure again when using
<code class="docutils literal notranslate"><span class="pre">configure_file(</span> <span class="pre">...</span> <span class="pre">COPYONLY)</span></code> or build again when using
<code class="docutils literal notranslate"><span class="pre">tribits_copy_files_to_binary_dir()</span></code> in order to copy files).</p></li>
<li><p>When using <code class="docutils literal notranslate"><span class="pre">OVERALL_WORKING_DIR</span> <span class="pre">TEST_NAME</span></code>, the test directory gets blow
away every time before it runs and therefore any old files are deleted
before the test gets run again (which avoids the problem of having a test
pass looking for the old files that will not be there when someone
configures and builds from scratch).</p></li>
</ul>
<p>For more information on these arguments, see <a class="reference internal" href="#test-idx-copy-files-to-test-dir-test-blocks-and-arguments-tribits-add-advanced-test">TEST_&lt;idx&gt;
COPY_FILES_TO_TEST_DIR Test Blocks and Arguments
(tribits_add_advanced_test())</a>.</p>
<p>By default, each and every atomic <code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx&gt;</span></code> block needs to pass (as
defined in <a class="reference internal" href="#test-case-pass-fail-tribits-add-advanced-test">Test case Pass/Fail (tribits_add_advanced_test())</a>) in order
for the overall test to pass.</p>
<p>Finally, the test is only added if tests are enabled for the SE package
(i.e. <a class="reference internal" href="#package-name-enable-tests">${PACKAGE_NAME}_ENABLE_TESTS</a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">ON</span></code>) or the parent package (if
this is a subpackage) (i.e. <code class="docutils literal notranslate"><span class="pre">${PARENT_PACKAGE_NAME}_ENABLE_TESTS=ON</span></code>) or
if other criteria are met (see some of the arguments in <a class="reference internal" href="#overall-arguments-tribits-add-advanced-test">Overall Arguments
(tribits_add_advanced_test())</a> that can trigger a test to not be added).
(NOTE: A more efficient way to optionally enable tests is to put them in a
<code class="docutils literal notranslate"><span class="pre">test/</span></code> subdir and then include that subdir with
<a class="reference internal" href="#tribits-add-test-directories">tribits_add_test_directories()</a>.)</p>
<p><em>Sections:</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#overall-arguments-tribits-add-advanced-test">Overall Arguments (tribits_add_advanced_test())</a></p></li>
<li><p><a class="reference internal" href="#test-idx-exec-cmnd-test-blocks-and-arguments-tribits-add-advanced-test">TEST_&lt;idx&gt; EXEC/CMND Test Blocks and Arguments (tribits_add_advanced_test())</a></p></li>
<li><p><a class="reference internal" href="#test-idx-copy-files-to-test-dir-test-blocks-and-arguments-tribits-add-advanced-test">TEST_&lt;idx&gt; COPY_FILES_TO_TEST_DIR Test Blocks and Arguments (tribits_add_advanced_test())</a></p></li>
<li><p><a class="reference internal" href="#test-case-pass-fail-tribits-add-advanced-test">Test case Pass/Fail (tribits_add_advanced_test())</a></p></li>
<li><p><a class="reference internal" href="#overall-pass-fail-tribits-add-advanced-test">Overall Pass/Fail (tribits_add_advanced_test())</a></p></li>
<li><p><a class="reference internal" href="#argument-parsing-and-ordering-tribits-add-advanced-test">Argument Parsing and Ordering (tribits_add_advanced_test())</a></p></li>
<li><p><a class="reference internal" href="#implementation-details-tribits-add-advanced-test">Implementation Details (tribits_add_advanced_test())</a></p></li>
<li><p><a class="reference internal" href="#setting-additional-test-properties-tribits-add-advanced-test">Setting Additional Test Properties (tribits_add_advanced_test())</a></p></li>
<li><p><a class="reference internal" href="#running-multiple-tests-at-the-same-time-tribits-add-advanced-test">Running multiple tests at the same time (tribits_add_advanced_test())</a></p></li>
<li><p><a class="reference internal" href="#disabling-tests-externally-tribits-add-advanced-test">Disabling Tests Externally (tribits_add_advanced_test())</a></p></li>
<li><p><a class="reference internal" href="#debugging-and-examining-test-generation-tribits-add-advanced-test">Debugging and Examining Test Generation (tribits_add_advanced_test())</a></p></li>
<li><p><a class="reference internal" href="#using-tribits-add-advanced-test-in-non-tribits-cmake-projects">Using tribits_add_advanced_test() in non-TriBITS CMake projects</a></p></li>
</ul>
<p id="overall-arguments-tribits-add-advanced-test"><strong>Overall Arguments (tribits_add_advanced_test())</strong></p>
<p>Below, some of the overall arguments are described.  The rest of the overall
arguments that control overall pass/fail are described in <a class="reference internal" href="#overall-pass-fail-tribits-add-advanced-test">Overall Pass/Fail
(tribits_add_advanced_test())</a>.  (NOTE: All of these arguments must be
listed outside of the <code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx&gt;</span></code> blocks, see <a class="reference internal" href="#argument-parsing-and-ordering-tribits-add-advanced-test">Argument Parsing and
Ordering (tribits_add_advanced_test())</a>).</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&lt;testNameBase&gt;</span></code></p>
<blockquote>
<div><p>The base name of the test (which will have <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_</span></code>
prepended to the name, see &lt;testName&gt; below) that will be used to name
the output CMake script file as well as the CTest test name passed into
<code class="docutils literal notranslate"><span class="pre">add_test()</span></code>.  This must be the first argument to this function.  The
name is allowed to contain ‘/’ chars but these will be replaced with
‘__’ in the overall working directory name and the ctest -P script
(<a class="reference internal" href="#debugging-and-examining-test-generation-tribits-add-advanced-test">Debugging and Examining Test Generation
(tribits_add_advanced_test())</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">OVERALL_WORKING_DIRECTORY</span> <span class="pre">&lt;overallWorkingDir&gt;</span></code></p>
<blockquote>
<div><p>If specified, then the working directory <code class="docutils literal notranslate"><span class="pre">&lt;overallWorkingDir&gt;</span></code>
(relative or absolute path) will be created and all of the test commands
by default will be run from within this directory.  If the value
<code class="docutils literal notranslate"><span class="pre">&lt;overallWorkingDir&gt;=TEST_NAME</span></code> is given, then the working directory
will be given the name <code class="docutils literal notranslate"><span class="pre">&lt;testName&gt;</span></code> where any ‘/’ chars are replaced
with ‘__’.  By default, if the directory <code class="docutils literal notranslate"><span class="pre">&lt;overallWorkingDir&gt;</span></code> exists
before the test runs, it will be deleted and created again.  If one
wants to preserve the contents of this directory between test runs then
set <code class="docutils literal notranslate"><span class="pre">SKIP_CLEAN_OVERALL_WORKING_DIRECTORY</span></code>.  Using a separate test
directory is a good option to use if the commands create intermediate
files and one wants to make sure they get deleted before the test cases
are run again.  It is also important to create a separate test directory
if multiple tests are defined in the same <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file that
read/write files with the same name.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">SKIP_CLEAN_OVERALL_WORKING_DIRECTORY</span></code></p>
<blockquote>
<div><p>If specified, then <code class="docutils literal notranslate"><span class="pre">&lt;overallWorkingDir&gt;</span></code> will <strong>not</strong> be deleted if it
already exists.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">FAIL_FAST</span></code></p>
<blockquote>
<div><p>If specified, then the remaining test commands will be aborted when any
test command fails.  Otherwise, all of the test cases will be run.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">RUN_SERIAL</span></code></p>
<blockquote>
<div><p>If specified, then no other tests will be allowed to run while this test
is running. See the <code class="docutils literal notranslate"><span class="pre">RUN_SERIAL</span></code> argument in the function
<a class="reference internal" href="#tribits-add-test">tribits_add_test()</a> for more details.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">COMM</span> <span class="pre">[serial]</span> <span class="pre">[mpi]</span></code></p>
<blockquote>
<div><p>If specified, selects if the test will be added in serial and/or MPI
mode.  See the <code class="docutils literal notranslate"><span class="pre">COMM</span></code> argument in the function <a class="reference internal" href="#tribits-add-test">tribits_add_test()</a>
for more details.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">OVERALL_NUM_MPI_PROCS</span> <span class="pre">&lt;overallNumProcs&gt;</span></code></p>
<blockquote>
<div><p>If specified, gives the default number of MPI processes that each
executable command runs on.  If <code class="docutils literal notranslate"><span class="pre">&lt;overallNumProcs&gt;</span></code> is greater than
<code class="docutils literal notranslate"><span class="pre">${MPI_EXEC_MAX_NUMPROCS}</span></code> then the test will be excluded.  If not
specified, then the default number of processes for an MPI build will be
<code class="docutils literal notranslate"><span class="pre">${MPI_EXEC_DEFAULT_NUMPROCS}</span></code>.  For serial builds, this argument is
ignored.  For MPI builds with all <code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx&gt;</span> <span class="pre">CMND</span></code> blocks,
<code class="docutils literal notranslate"><span class="pre">&lt;overallNumProcs&gt;</span></code> is used to set the property <code class="docutils literal notranslate"><span class="pre">PROCESSORS</span></code>. (see
<a class="reference internal" href="#running-multiple-tests-at-the-same-time-tribits-add-advanced-test">Running multiple tests at the same time
(tribits_add_advanced_test())</a>).  <strong>WARNING!</strong> If just running a serial
script or other command, then the property <code class="docutils literal notranslate"><span class="pre">PROCESSORS</span></code> will still get
set to <code class="docutils literal notranslate"><span class="pre">${OVERALL_NUM_MPI_PROCS}</span></code> so in order to avoid CTest
unnecessarily reserving <code class="docutils literal notranslate"><span class="pre">${OVERALL_NUM_MPI_PROCS}</span></code> processes for a
serial non-MPI test, then one must leave off <code class="docutils literal notranslate"><span class="pre">OVERALL_NUM_MPI_PROCS</span></code>
or explicitly pass in <code class="docutils literal notranslate"><span class="pre">MPI_EXEC_DEFAULT_NUMPROCS</span> <span class="pre">1</span></code>!</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">OVERALL_NUM_TOTAL_CORES_USED</span> <span class="pre">&lt;overallNumTotalCoresUsed&gt;</span></code></p>
<blockquote>
<div><p>Used for <code class="docutils literal notranslate"><span class="pre">NUM_TOTAL_CORES_USED</span></code> if missing in a <code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx&gt;</span></code> block.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">CATEGORIES</span> <span class="pre">&lt;category0&gt;</span> <span class="pre">&lt;category1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>Gives the <a class="reference internal" href="#test-test-categories">Test Test Categories</a> for which this test will be added.
See <a class="reference internal" href="#tribits-add-test">tribits_add_test()</a> for more details.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">HOST</span> <span class="pre">&lt;host0&gt;</span> <span class="pre">&lt;host1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>The list of hosts for which to enable the test (see
<a class="reference internal" href="#tribits-add-test">tribits_add_test()</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">XHOST</span> <span class="pre">&lt;host0&gt;</span> <span class="pre">&lt;host1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>The list of hosts for which <strong>not</strong> to enable the test (see
<a class="reference internal" href="#tribits-add-test">tribits_add_test()</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">HOSTTYPE</span> <span class="pre">&lt;hosttype0&gt;</span> <span class="pre">&lt;hosttype1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>The list of host types for which to enable the test (see
<a class="reference internal" href="#tribits-add-test">tribits_add_test()</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">XHOSTTYPE</span> <span class="pre">&lt;hosttype0&gt;</span> <span class="pre">&lt;hosttype1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>The list of host types for which <strong>not</strong> to enable the test (see
<a class="reference internal" href="#tribits-add-test">tribits_add_test()</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">EXCLUDE_IF_NOT_TRUE</span> <span class="pre">&lt;varname0&gt;</span> <span class="pre">&lt;varname1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>If specified, gives the names of CMake variables that must evaluate to
true, or the test will not be added (see <a class="reference internal" href="#tribits-add-test">tribits_add_test()</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">DISABLED</span> <span class="pre">&lt;messageWhyDisabled&gt;</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">&lt;messageWhyDisabled&gt;</span></code> is non-empty and does not evaluate to FALSE
by CMake, then the test will be added by ctest but the <code class="docutils literal notranslate"><span class="pre">DISABLED</span></code> test
property will be set (see <a class="reference internal" href="#tribits-add-test">tribits_add_test()</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">ENVIRONMENT</span> <span class="pre">&quot;&lt;var1&gt;=&lt;value1&gt;&quot;</span> <span class="pre">&quot;&lt;var2&gt;=&lt;value2&gt;&quot;</span> <span class="pre">...</span></code>.</p>
<blockquote>
<div><p>If passed in, the listed environment variables will be set by CTest
before calling the test.  This is set using the built-in CTest test
property <code class="docutils literal notranslate"><span class="pre">ENVIRONMENT</span></code>.  Note, if the env var values contain
semi-colons <code class="docutils literal notranslate"><span class="pre">';'</span></code>, then replace the semi-colons <code class="docutils literal notranslate"><span class="pre">';'</span></code> with another
separator <code class="docutils literal notranslate"><span class="pre">'&lt;sep&gt;'</span></code> and pass in <code class="docutils literal notranslate"><span class="pre">LIST_SEPARATOR</span> <span class="pre">&lt;sep&gt;</span></code> so <code class="docutils literal notranslate"><span class="pre">&lt;sep&gt;</span></code>
will be replaced with <code class="docutils literal notranslate"><span class="pre">';'</span></code> at point of usage.  If the env var values
contain any spaces, also quote the entire variable/value pair as
<code class="docutils literal notranslate"><span class="pre">&quot;&lt;vari&gt;=&lt;valuei&gt;&quot;</span></code>.  For example, the env var and value
<code class="docutils literal notranslate"><span class="pre">my_env_var=&quot;arg1</span> <span class="pre">b;arg2;I</span> <span class="pre">have</span> <span class="pre">spaces&quot;</span></code> would need to be passed as
<code class="docutils literal notranslate"><span class="pre">&quot;my_env_var=arg1</span> <span class="pre">b&lt;sep&gt;arg2&lt;sep&gt;I</span> <span class="pre">have</span> <span class="pre">spaces&quot;</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">TIMEOUT</span> <span class="pre">&lt;maxSeconds&gt;</span></code></p>
<blockquote>
<div><p>If passed in, gives maximum number of seconds the test will be allowed
to run before being timed-out and killed (see <a class="reference internal" href="#setting-timeouts-for-tests-tribits-add-test">Setting timeouts for
tests (tribits_add_test())</a>).  This is for the full CTest test, not
individual <code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx&gt;</span></code> commands!</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">LIST_SEPARATOR</span> <span class="pre">&lt;sep&gt;</span></code></p>
<blockquote>
<div><p>String used as placeholder for the semi-colon char <code class="docutils literal notranslate"><span class="pre">';'</span></code> in order to
allow pass-through.  For example, if arguments to the <code class="docutils literal notranslate"><span class="pre">ARGS</span></code> or
<code class="docutils literal notranslate"><span class="pre">ENVIRONMENT</span></code> need to use semi-colons, then replace <code class="docutils literal notranslate"><span class="pre">';'</span></code> with
<code class="docutils literal notranslate"><span class="pre">'&lt;semicolon&gt;'</span></code> (for example) such as with
<code class="docutils literal notranslate"><span class="pre">&quot;somearg=arg1&lt;semicolon&gt;arg2&quot;</span></code>, then at the point of usage,
<code class="docutils literal notranslate"><span class="pre">'&lt;semicolon&gt;'</span></code> will be replaced with <code class="docutils literal notranslate"><span class="pre">';'</span></code> and it will be passed to
the final command as <code class="docutils literal notranslate"><span class="pre">&quot;somearg=arg1;arg2&quot;</span></code> (with as many preceding
escape backslashes <code class="docutils literal notranslate"><span class="pre">'\'</span></code> in front of <code class="docutils literal notranslate"><span class="pre">';'</span></code> as is needed for the
given usage context).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">ADDED_TEST_NAME_OUT</span> <span class="pre">&lt;testName&gt;</span></code></p>
<blockquote>
<div><p>If specified, then on output the variable <code class="docutils literal notranslate"><span class="pre">&lt;testName&gt;</span></code> will be set
with the name of the test passed to <code class="docutils literal notranslate"><span class="pre">add_test()</span></code>.  Having this name
allows the calling <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file access and set additional
test properties (see <a class="reference internal" href="#setting-additional-test-properties-tribits-add-advanced-test">Setting additional test properties
(tribits_add_advanced_test())</a>).</p>
</div></blockquote>
</div></blockquote>
<p id="test-idx-exec-cmnd-test-blocks-and-arguments-tribits-add-advanced-test"><strong>TEST_&lt;idx&gt; EXEC/CMND Test Blocks and Arguments (tribits_add_advanced_test())</strong></p>
<p>Each test general command block <code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx&gt;</span></code> runs either a package-built
test executable or some general command executable and is defined as either
<code class="docutils literal notranslate"><span class="pre">EXEC</span> <span class="pre">&lt;exeRootName&gt;</span></code> or an arbitrary command <code class="docutils literal notranslate"><span class="pre">CMND</span> <span class="pre">&lt;cmndExec&gt;</span></code> with the
arguments:</p>
<blockquote>
<div><blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">EXEC</span> <span class="pre">&lt;exeRootName&gt;</span> <span class="pre">[NOEXEPREFIX]</span> <span class="pre">[NOEXESUFFIX]</span> <span class="pre">[ADD_DIR_TO_NAME]</span>
<span class="pre">[DIRECTORY</span> <span class="pre">&lt;dir&gt;]</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">EXEC</span></code> is specified, then <code class="docutils literal notranslate"><span class="pre">&lt;exeRootName&gt;</span></code> gives the root name of
an executable target that will be run as the command.  The full
executable name and path is determined in exactly the same way it is in
the <a class="reference internal" href="#tribits-add-test">tribits_add_test()</a> function (see <a class="reference internal" href="#determining-the-executable-or-command-to-run-tribits-add-test">Determining the Executable or
Command to Run (tribits_add_test())</a>).  If this is an MPI build, then
the executable will be run with MPI using <code class="docutils literal notranslate"><span class="pre">NUM_MPI_PROCS</span> <span class="pre">&lt;numProcs&gt;</span></code>
(or <code class="docutils literal notranslate"><span class="pre">OVERALL_NUM_MPI_PROCS</span> <span class="pre">&lt;overallNumProcs&gt;</span></code> if <code class="docutils literal notranslate"><span class="pre">NUM_MPI_PROCS</span></code> is
not set for this test case).  If the maximum number of MPI processes
allowed is less than this number of MPI processes, then the test will
<em>not</em> be run.  Note that <code class="docutils literal notranslate"><span class="pre">EXEC</span> <span class="pre">&lt;exeRootName&gt;</span></code> when <code class="docutils literal notranslate"><span class="pre">NOEXEPREFIX</span></code> and
<code class="docutils literal notranslate"><span class="pre">NOEXESUFFIX</span></code> are specified is basically equivalent to <code class="docutils literal notranslate"><span class="pre">CMND</span>
<span class="pre">&lt;cmndExec&gt;</span></code> except that in an MPI build, <code class="docutils literal notranslate"><span class="pre">&lt;exeRootName&gt;</span></code> is always
run using MPI.  In this case, one can pass in <code class="docutils literal notranslate"><span class="pre">&lt;exeRootName&gt;</span></code> to any
command one would like and it will get run with MPI in MPI mode just
link any other MPI-enabled built executable.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">CMND</span> <span class="pre">&lt;cmndExec&gt;</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">CMND</span></code> is specified, then <code class="docutils literal notranslate"><span class="pre">&lt;cmndExec&gt;</span></code> gives the executable for a
command to be run.  In this case, MPI will never be used to run the
executable even when configured in MPI mode
(i.e. <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_MPI=ON</span></code>).  If one wants to run an arbitrary command
using MPI, use <code class="docutils literal notranslate"><span class="pre">EXEC</span> <span class="pre">&lt;fullPathToCmndExec&gt;</span> <span class="pre">NOEXEPREFIX</span> <span class="pre">NOEXESUFFIX</span></code>
instead.  <strong>WARNING:</strong> If you want to run such tests using valgrind, you
have to use the raw executable as the <code class="docutils literal notranslate"><span class="pre">&lt;cmndExec&gt;</span></code> argument and <em>not</em>
the script.  For example, if you have a python script
<code class="docutils literal notranslate"><span class="pre">my_python_test.py</span></code> with <code class="docutils literal notranslate"><span class="pre">/usr/bin/env</span> <span class="pre">pyhton</span></code> at the top, you can’t
just use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CMND</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;/</span><span class="n">my_python_test</span><span class="o">.</span><span class="n">py</span> <span class="n">ARGS</span> <span class="s2">&quot;&lt;arg0&gt;&quot;</span> <span class="s2">&quot;&lt;arg1&gt;&quot;</span> <span class="o">...</span>
</pre></div>
</div>
<p>The same goes for Perl or any other scripting language.</p>
<p>Instead, you have to use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CMND ${PYTHON_EXECUTABLE} ARGS &lt;path&gt;/my_python_test.py &lt;arg0&gt; &lt;arg1&gt; ...
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">ARGS</span> <span class="pre">&quot;&lt;arg0&gt;&quot;</span> <span class="pre">&quot;&lt;arg1&gt;&quot;</span> <span class="pre">...</span> <span class="pre">&quot;&lt;argN&gt;&quot;</span></code></p>
<blockquote>
<div><p>The list of command-line arguments to pass to the <code class="docutils literal notranslate"><span class="pre">CMND</span></code> command or
<code class="docutils literal notranslate"><span class="pre">EXEC</span></code> executable.  Put each argument <code class="docutils literal notranslate"><span class="pre">&lt;argi&gt;</span></code> in quotes <code class="docutils literal notranslate"><span class="pre">&quot;&lt;argi&gt;&quot;</span></code>
if it contains any spaces.  Also, of any of the individual arguments need
to contain semi-colons <code class="docutils literal notranslate"><span class="pre">';'</span></code> such as <code class="docutils literal notranslate"><span class="pre">--my-arg=a;b</span> <span class="pre">a;c;d</span></code>, then pass
that quoted as <code class="docutils literal notranslate"><span class="pre">&quot;--my-arg=a&lt;sep&gt;b</span> <span class="pre">a&lt;sep&gt;c&lt;sep&gt;d&quot;</span></code> where <code class="docutils literal notranslate"><span class="pre">&lt;sep&gt;</span></code>
matches the <code class="docutils literal notranslate"><span class="pre">&lt;sep&gt;</span></code> argument to the input <code class="docutils literal notranslate"><span class="pre">LIST_SEPARATOR</span> <span class="pre">&lt;sep&gt;</span></code>.</p>
</div></blockquote>
</div></blockquote>
<p>By default, the output (stdout/stderr) for each test command is captured and
is then echoed to stdout for the overall test.  This is done in order to be
able to grep the result to determine pass/fail.</p>
<p>Other miscellaneous arguments for each <code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx&gt;</span></code> block include:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">DIRECTORY</span> <span class="pre">&lt;dir&gt;</span></code></p>
<blockquote>
<div><p>If specified, then the executable is assumed to be in the directory
given by relative <code class="docutils literal notranslate"><span class="pre">&lt;dir&gt;</span></code>.  See <a class="reference internal" href="#tribits-add-test">tribits_add_test()</a>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">MESSAGE</span> <span class="pre">&quot;&lt;message&gt;&quot;</span></code></p>
<blockquote>
<div><p>If specified, then the string in <code class="docutils literal notranslate"><span class="pre">&quot;&lt;message&gt;&quot;</span></code> will be printed before
this test command is run.  This allows adding some documentation about
each individual test invocation to make the test output more
understandable.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">WORKING_DIRECTORY</span> <span class="pre">&lt;workingDir&gt;</span></code></p>
<blockquote>
<div><p>If specified, then the working directory <code class="docutils literal notranslate"><span class="pre">&lt;workingDir&gt;</span></code> (relative or
absolute) will be created and the test will be run from within this
directory.  If the directory <code class="docutils literal notranslate"><span class="pre">&lt;workingDir&gt;</span></code> exists before the test
runs, it will be deleted and created again.  If one wants to preserve
the contents of this directory between test blocks, then one needs to
set <code class="docutils literal notranslate"><span class="pre">SKIP_CLEAN_WORKING_DIRECTORY</span></code>.  Using a different
<code class="docutils literal notranslate"><span class="pre">WORKING_DIRECTORY</span></code> for individual test commands allows creating
independent working directories for each test case.  This would be
useful if a single <code class="docutils literal notranslate"><span class="pre">OVERALL_WORKING_DIRECTORY</span></code> was not sufficient for
some reason.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">SKIP_CLEAN_WORKING_DIRECTORY</span></code></p>
<blockquote>
<div><p>If specified, then <code class="docutils literal notranslate"><span class="pre">&lt;workingDir&gt;</span></code> will <strong>not</strong> be deleted if it
already exists.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">NUM_MPI_PROCS</span> <span class="pre">&lt;numProcs&gt;</span></code></p>
<blockquote>
<div><p>If specified, then <code class="docutils literal notranslate"><span class="pre">&lt;numProcs&gt;</span></code> is the number of processors used for
MPI executables.  If not specified, this will default to
<code class="docutils literal notranslate"><span class="pre">&lt;overallNumProcs&gt;</span></code> from <code class="docutils literal notranslate"><span class="pre">OVERALL_NUM_MPI_PROCS</span> <span class="pre">&lt;overallNumProcs&gt;</span></code>.
If that is not specified, then the value is taken from
<code class="docutils literal notranslate"><span class="pre">${MPI_EXEC_DEFAULT_NUMPROCS}</span></code>.  For serial builds
(i.e. <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_MPI=OFF</span></code>), passing in a value <code class="docutils literal notranslate"><span class="pre">&lt;numMpiProcs&gt;</span></code> &gt;
<code class="docutils literal notranslate"><span class="pre">1</span></code> will cause the entire test to not be added.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">NUM_TOTAL_CORES_USED</span> <span class="pre">&lt;numTotalCoresUsed&gt;</span></code></p>
<blockquote>
<div><p>If specified, gives the total number of processes used by this
command/executable.  If this is missing, but <code class="docutils literal notranslate"><span class="pre">NUM_MPI_PROCS</span>
<span class="pre">&lt;numProcs&gt;</span></code> is specified, then <code class="docutils literal notranslate"><span class="pre">&lt;numProcs&gt;</span></code> is used instead.  If
<code class="docutils literal notranslate"><span class="pre">NUM_TOTAL_CORES_USED</span></code> is missing BUT <code class="docutils literal notranslate"><span class="pre">OVERALL_NUM_TOTAL_CORES_USED</span>
<span class="pre">&lt;overallNumTotalCoresUsed&gt;</span></code> is, then <code class="docutils literal notranslate"><span class="pre">&lt;overallNumTotalCoresUsed&gt;</span></code> is
used for <code class="docutils literal notranslate"><span class="pre">&lt;numTotalCoresUsed&gt;</span></code>.  This argument is used for test
scripts/executables that use more cores than MPI processes
(i.e. <code class="docutils literal notranslate"><span class="pre">&lt;numProcs&gt;</span></code>) and its only purpose is to inform CTest and
TriBITS of the maximum number of cores that are used by the underlying
test executable/script.  When <code class="docutils literal notranslate"><span class="pre">&lt;numTotalCoresUsed&gt;</span></code> is greater than
<code class="docutils literal notranslate"><span class="pre">${MPI_EXEC_MAX_NUMPROCS}</span></code>, then the test will not be added.
Otherwise, the CTest property <code class="docutils literal notranslate"><span class="pre">PROCESSORS</span></code> is set to the max over all
<code class="docutils literal notranslate"><span class="pre">&lt;numTotalCoresUsed&gt;</span></code> so that CTest knows how to best schedule the
test w.r.t. other tests on a given number of available processes.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">OUTPUT_FILE</span> <span class="pre">&lt;outputFile&gt;</span></code></p>
<blockquote>
<div><p>If specified, then stdout and stderr for the test case will be sent to
<code class="docutils literal notranslate"><span class="pre">&lt;outputFile&gt;</span></code>.  By default, the contents of this file will <strong>also</strong>
be printed to STDOUT unless <code class="docutils literal notranslate"><span class="pre">NO_ECHO_OUT</span></code> is passed as well.</p>
<p>NOTE: Contrary to CMake documentation for execute_process(), STDOUT and
STDERR may not get output in the correct order interleaved correctly,
even in serial without MPI.  Therefore, you can’t write any tests that
depend on the order of STDOUT and STDERR output in relation to each
other.  Also note that all of STDOUT and STDERR will be first read into
the CTest executable process main memory before the file
<code class="docutils literal notranslate"><span class="pre">&lt;outputFile&gt;</span></code> is written.  Therefore, don’t run executables or
commands that generate massive amounts of console output or it may
exhaust main memory.  Instead, have the command or executable write
directly to a file instead of going through STDOUT.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">NO_ECHO_OUTPUT</span></code></p>
<blockquote>
<div><p>If specified, then the output for the test command will not be echoed to
the output for the entire test command.</p>
</div></blockquote>
</div></blockquote>
<p>By default, an individual test case <code class="docutils literal notranslate"><span class="pre">TEST_&lt;IDX&gt;</span></code> is assumed to pass if the
executable or commands returns a non-zero value to the shell.  However, a
test case can also be defined to pass or fail based on the arguments/options
(see <a class="reference internal" href="#test-case-pass-fail-tribits-add-advanced-test">Test case Pass/Fail (tribits_add_advanced_test())</a>):</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">PASS_ANY</span></code></p>
<blockquote>
<div><p>If specified, the test command will be assumed to pass regardless of
the return value or any other output.  This would be used when a command
that is to follow will determine pass or fail based on output from this
command in some way.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">PASS_REGULAR_EXPRESSION</span> <span class="pre">&quot;&lt;regex0&gt;&quot;</span>&#160; <span class="pre">&quot;&lt;regex1&gt;&quot;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>If specified, the test command will be assumed to pass if it matches
<strong>any</strong> of the given regular expressions.  Otherwise, it is assumed to
fail.  TIPS: Replace ‘;’ with ‘[;]’ or CMake will interpret this as an
array element boundary.  To match ‘.’, use ‘[.]’.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">PASS_REGULAR_EXPRESSION_ALL</span> <span class="pre">&quot;&lt;regex0&gt;&quot;</span> <span class="pre">&quot;&lt;regex1&gt;&quot;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>If specified, the test command will be assumed to pass if the output
matches <strong>all</strong> of the provided regular expressions.  Note that this is not
a capability of raw ctest and represents an extension provided by
TriBITS.  NOTE: It is critical that you replace ‘;’ with ‘[;]’ or CMake
will interpret this as an array element boundary.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">STANDARD_PASS_OUTPUT</span></code></p>
<blockquote>
<div><p>If specified, the test command will be assumed to pass if the string
expression “Final Result: PASSED” is found in the output for the test.
This as the result of directly passing in <code class="docutils literal notranslate"><span class="pre">PASS_REGULAR_EXPRESSION</span>
<span class="pre">&quot;End</span> <span class="pre">Result:</span> <span class="pre">TEST</span> <span class="pre">PASSED&quot;</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">FAIL_REGULAR_EXPRESSION</span> <span class="pre">&quot;&lt;regex0&gt;&quot;</span> <span class="pre">&quot;&lt;regex1&gt;&quot;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>If specified, the test command will be assumed to fail if it matches
<strong>any</strong> of the given regular expressions.  This will be applied and take
precedence over other above pass criteria.  For example, if even if
<code class="docutils literal notranslate"><span class="pre">PASS_REGULAR_EXPRESSION</span></code> or <code class="docutils literal notranslate"><span class="pre">PASS_REGULAR_EXPRESSION_ALL</span></code> match,
then the test will be marked as failed if any of the fail regexes match
the output.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">ALWAYS_FAIL_ON_NONZERO_RETURN</span></code></p>
<blockquote>
<div><p>If specified, then the test case will be marked as failed if the test
command returns nonzero, independent of the other pass/fail criteria.
This option is used in cases where one wants to grep for strings in the
output but still wants to require a zero return code.  This make for a
stronger test by requiring that both the strings are found and that the
command returns 0.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">ALWAYS_FAIL_ON_ZERO_RETURN</span></code></p>
<blockquote>
<div><p>If specified, then the test case will be marked as failed if the test
command returns zero ‘0’, independent of the other pass/fail criteria.
This option is used in cases where one wants to grep for strings in the
output but still wants to require a nonzero return code.  This make for
a stronger test by requiring that both the strings are found and that
the command returns != 0.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">WILL_FAIL</span></code></p>
<blockquote>
<div><p>If specified, invert the result from the other pass/fail criteria.  For
example, if the regexes in <code class="docutils literal notranslate"><span class="pre">PASS_REGULAR_EXPRESSION</span></code> or
<code class="docutils literal notranslate"><span class="pre">PASS_REGULAR_EXPRESSION_ALL</span></code> indicate that a test should pass, then
setting <code class="docutils literal notranslate"><span class="pre">WILL_FAIL</span></code> will invert that and report the test as failing.
But typically this is used to report a test that returns a nonzero code
as passing.</p>
</div></blockquote>
</div></blockquote>
<p>All of the arguments for a test block <code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx&gt;</span></code> must appear directly
below their <code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx&gt;</span></code> argument and before the next test block (see
<a class="reference internal" href="#argument-parsing-and-ordering-tribits-add-advanced-test">Argument Parsing and Ordering (tribits_add_advanced_test())</a>).</p>
<p><strong>NOTE:</strong> The current implementation limits the number of <code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx&gt;</span></code>
blocks to just 20 (i.e. for <code class="docutils literal notranslate"><span class="pre">&lt;idx&gt;=0...19</span></code>).  If more test blocks are
added (e.g. <code class="docutils literal notranslate"><span class="pre">TEST_20</span></code>), then an fatal error message will be printed and
processing will end.  To increase this max in a local scope, call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="n">TRIBITS_ADD_ADVANCED_TEST_MAX_NUM_TEST_BLOCKS</span> <span class="o">&lt;</span><span class="n">larger</span><span class="o">-</span><span class="n">num</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;larger-num&gt;</span> <span class="pre">&gt;</span> <span class="pre">20</span></code>.  This can be set in any scope in any
<code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file or inside of a function and it will impact all of
the future calls to <code class="docutils literal notranslate"><span class="pre">tribits_add_advanced_test()</span></code> in that scope.</p>
<p id="test-idx-copy-files-to-test-dir-test-blocks-and-arguments-tribits-add-advanced-test"><strong>TEST_&lt;idx&gt; COPY_FILES_TO_TEST_DIR Test Blocks and Arguments (tribits_add_advanced_test())</strong></p>
<p>The arguments for the <code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx&gt;</span></code> <code class="docutils literal notranslate"><span class="pre">COPY_FILES_TO_TEST_DIR</span></code> block are:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">COPY_FILES_TO_TEST_DIR</span> <span class="pre">&lt;file0&gt;</span> <span class="pre">&lt;file1&gt;</span> <span class="pre">...</span> <span class="pre">&lt;filen&gt;</span></code></p>
<blockquote>
<div><p>Required list of 1 or more file names for files that will be copied from
<code class="docutils literal notranslate"><span class="pre">&lt;srcDir&gt;/</span></code> to <code class="docutils literal notranslate"><span class="pre">&lt;destDir&gt;/</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">SOURCE_DIR</span> <span class="pre">&lt;srcDir&gt;</span></code></p>
<blockquote>
<div><p>Optional source directory where the files will be copied from.  If
<code class="docutils literal notranslate"><span class="pre">&lt;srcDir&gt;</span></code> is not given, then it is assumed to be
<code class="docutils literal notranslate"><span class="pre">${CMAKE_CURRENT_SOURCE_DIR}</span></code>.  If <code class="docutils literal notranslate"><span class="pre">&lt;srcDir&gt;</span></code> is given but is a
relative path, then it is interpreted relative to
<code class="docutils literal notranslate"><span class="pre">${CMAKE_CURRENT_SOURCE_DIR}</span></code>.  If <code class="docutils literal notranslate"><span class="pre">&lt;srcDir&gt;</span></code> is an absolute path,
then that path is used without modification.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">DEST_DIR</span> <span class="pre">&lt;destDir&gt;</span></code></p>
<blockquote>
<div><p>Optional destination directory where the files will be copied to.  If
<code class="docutils literal notranslate"><span class="pre">&lt;destDir&gt;</span></code> is not given, then it is assumed to be the working
directory where the test is running (typically a new directory created
under <code class="docutils literal notranslate"><span class="pre">${CMAKE_CURRENT_BINARY_DIR}</span></code> when <code class="docutils literal notranslate"><span class="pre">OVERALL_WORKING_DIR</span>
<span class="pre">TEST_NAME</span></code> is given).  If <code class="docutils literal notranslate"><span class="pre">&lt;destDir&gt;</span></code> is given but is a relative
path, then it is interpreted relative to the current test working
directory.  If <code class="docutils literal notranslate"><span class="pre">&lt;destDir&gt;</span></code> is an absolute path, then that path is used
without modification.  If <code class="docutils literal notranslate"><span class="pre">&lt;destDir&gt;</span></code> does not exist, then it will be
created (including several directory levels deep if needed).</p>
</div></blockquote>
</div></blockquote>
<p id="test-case-pass-fail-tribits-add-advanced-test"><strong>Test case Pass/Fail (tribits_add_advanced_test())</strong></p>
<p>The logic given below can be used to determine pass/fail criteria for a test
case both based on what is printed in the test output <strong>and</strong> the return
code for the test block command.  Raw CTest, as of version 3.23, does not
allow that.  With raw CTest, one can only set pass/fail criteria based the
test output <strong>or</strong> the return code, but not both.  This make
<a class="reference internal" href="#tribits-add-advanced-test">tribits_add_advanced_test()</a> more attractive to use than
<a class="reference internal" href="#tribits-add-test">tribits_add_test()</a> or raw <code class="docutils literal notranslate"><span class="pre">add_test()</span></code> in cases where it is important
to check both.</p>
<p>The logic for how pass/fail for a <code class="docutils literal notranslate"><span class="pre">TEST_&lt;IDX&gt;</span></code> <code class="docutils literal notranslate"><span class="pre">EXEC</span></code> or <code class="docutils literal notranslate"><span class="pre">CMND</span></code> case
is applied is given by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># A) Apply first set of pass/fail logic</span>
<span class="n">TEST_CASE_PASSED</span> <span class="o">=</span> <span class="n">FALSE</span>
<span class="n">If</span> <span class="n">PASS_ANY</span> <span class="n">specified</span><span class="p">:</span>
  <span class="n">TEST_CASE_PASSED</span> <span class="o">=</span> <span class="n">TRUE</span>
<span class="n">Else</span> <span class="n">If</span> <span class="n">PASS_REGULAR_EXPRESSION</span> <span class="ow">is</span> <span class="n">specified</span><span class="p">:</span>
  <span class="n">For</span> <span class="n">each</span> <span class="s2">&quot;&lt;regexi&gt;&quot;</span> <span class="ow">in</span> <span class="n">PASS_REGULAR_EXPRESSION</span><span class="p">:</span>
    <span class="n">If</span> <span class="s2">&quot;&lt;regexi&gt;&quot;</span> <span class="n">matches</span> <span class="n">STDOUT</span><span class="p">:</span>
      <span class="n">TEST_CASE_PASSED</span> <span class="o">=</span> <span class="n">TRUE</span>
    <span class="n">Endif</span>
  <span class="n">Endforeach</span>
<span class="n">Else</span> <span class="k">if</span> <span class="n">PASS_REGULAR_EXPRESSION_ALL</span> <span class="n">specified</span><span class="p">:</span>
  <span class="n">TEST_CASE_PASSED</span> <span class="o">=</span> <span class="n">TRUE</span>
  <span class="n">For</span> <span class="n">each</span> <span class="s2">&quot;&lt;regexi&gt;&quot;</span> <span class="ow">in</span> <span class="n">PASS_REGULAR_EXPRESSION_ALL</span><span class="p">:</span>
    <span class="n">If</span> <span class="s2">&quot;&lt;regexi&gt;&quot;</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">match</span> <span class="n">STDOUT</span><span class="p">:</span>
      <span class="n">TEST_CASE_PASSED</span> <span class="o">=</span> <span class="n">FALSE</span>
    <span class="n">Endif</span>
  <span class="n">Endforeach</span>
<span class="n">Else</span>
  <span class="n">If</span> <span class="n">command</span> <span class="k">return</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">TEST_CASE_PASSED</span> <span class="o">=</span> <span class="n">TRUE</span>
  <span class="n">Endif</span>
<span class="n">Endif</span>

<span class="c1"># B) Check for failing regex matching?</span>
<span class="n">If</span> <span class="n">FAIL_REGULAR_EXPRESSION</span> <span class="n">specified</span><span class="p">:</span>
  <span class="n">For</span> <span class="n">each</span> <span class="s2">&quot;&lt;regexi&gt;&quot;</span> <span class="ow">in</span> <span class="n">FAIL_REGULAR_EXPRESSION</span><span class="p">:</span>
    <span class="n">If</span> <span class="s2">&quot;&lt;regexi&gt;&quot;</span> <span class="n">matches</span> <span class="n">STDOUT</span><span class="p">:</span>
      <span class="n">TEST_CASE_PASSED</span> <span class="o">=</span> <span class="n">FALSE</span>
    <span class="n">Endif</span>
  <span class="n">Endforeach</span>
<span class="n">Endif</span>

<span class="c1"># C) Check for return code always 0 or !=0?</span>
<span class="n">If</span> <span class="n">ALWAYS_FAIL_ON_NONZERO_RETURN</span> <span class="n">specified</span> <span class="ow">and</span> <span class="k">return</span> <span class="n">code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
  <span class="n">TEST_CASE_PASSED</span> <span class="o">=</span> <span class="n">FALSE</span>
<span class="n">Else</span> <span class="n">If</span> <span class="n">ALWAYS_FAIL_ON_ZERO_RETURN</span> <span class="n">specified</span> <span class="ow">and</span> <span class="k">return</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
  <span class="n">TEST_CASE_PASSED</span> <span class="o">=</span> <span class="n">FALSE</span>
<span class="n">Endif</span>

<span class="c1"># D) Invert pass/fail result?</span>
<span class="n">If</span> <span class="n">WILL_FAIL</span> <span class="n">specified</span><span class="p">:</span>
  <span class="n">If</span> <span class="n">TEST_CASE_PASSED</span><span class="p">:</span>
    <span class="n">TEST_CASE_PASSED</span> <span class="o">=</span> <span class="n">FALSE</span>
  <span class="n">Else</span>
    <span class="n">TEST_CASE_PASSED</span> <span class="o">=</span> <span class="n">TRUE</span>
  <span class="n">Endif</span>
<span class="n">Endif</span>
</pre></div>
</div>
<p>Note that the above is the exact same logic that CTest uses to determine
pass/fail w.r.t. to the CTest properties <code class="docutils literal notranslate"><span class="pre">PASS_REGULAR_EXPRESSION</span></code>,
<code class="docutils literal notranslate"><span class="pre">FAIL_REGULAR_EXPRESSION</span></code> and <code class="docutils literal notranslate"><span class="pre">WILL_FAIL</span></code>.  (It is just that raw
CMake/CTest, as of version 3.23, does not support any pass/fail criteria
like <code class="docutils literal notranslate"><span class="pre">PASS_REGULAR_EXPRESSION_ALL</span></code> or
<code class="docutils literal notranslate"><span class="pre">ALWAYS_FAIL_ON_NONZERO_RETURN</span></code>/<code class="docutils literal notranslate"><span class="pre">ALWAYS_FAIL_ON_ZERO_RETURN</span></code>.)</p>
<p id="overall-pass-fail-tribits-add-advanced-test"><strong>Overall Pass/Fail (tribits_add_advanced_test())</strong></p>
<p>By default, the overall test will be assumed to pass if it prints:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;OVERALL FINAL RESULT: TEST PASSED (&lt;testName&gt;)&quot;</span>
</pre></div>
</div>
<p>However, this can be changed by setting one of the following optional arguments:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">FINAL_PASS_REGULAR_EXPRESSION</span> <span class="pre">&quot;&lt;regex0&gt;&quot;</span> <span class="pre">&quot;&lt;regex1&gt;&quot;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>If specified, the test will be assumed to pass if the output matches
<strong>any</strong> of the provided regular expressions <code class="docutils literal notranslate"><span class="pre">&lt;regexi&gt;</span></code>.  (Sets the
CTest property <code class="docutils literal notranslate"><span class="pre">PASS_REGULAR_EXPRESSION</span></code> for the overall test.)</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">FINAL_FAIL_REGULAR_EXPRESSION</span> <span class="pre">&quot;&lt;regex0&gt;&quot;</span> <span class="pre">&quot;&lt;regex1&gt;&quot;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>If specified, the test will be assumed to fail if the output matches
<strong>any</strong> of the provided regular expressions <code class="docutils literal notranslate"><span class="pre">&lt;regexi&gt;</span></code> regardless if
other criteria would have the test passing.  (Sets the CTest property
<code class="docutils literal notranslate"><span class="pre">FAIL_REGULAR_EXPRESSION</span></code> for the overall test.)</p>
</div></blockquote>
</div></blockquote>
<p><strong>NOTE:</strong> It is <strong>not</strong> recommended to set <code class="docutils literal notranslate"><span class="pre">FINAL_PASS_REGULAR_EXPRESSION</span></code>
or <code class="docutils literal notranslate"><span class="pre">FINAL_FAIL_REGULAR_EXPRESSION</span></code> directly, but instead to determine
pass/fail for each test case individually as described in <a class="reference internal" href="#test-idx-exec-cmnd-test-blocks-and-arguments-tribits-add-advanced-test">TEST_&lt;idx&gt;
EXEC/CMND Test Blocks and Arguments (tribits_add_advanced_test())</a> and
<a class="reference internal" href="#test-case-pass-fail-tribits-add-advanced-test">Test case Pass/Fail (tribits_add_advanced_test())</a>.  Otherwise, the test
will confuse most people and the output behavior will seem very strange.</p>
<p id="argument-parsing-and-ordering-tribits-add-advanced-test"><strong>Argument Parsing and Ordering (tribits_add_advanced_test())</strong></p>
<p>The basic tool used for parsing the arguments to this function is the
command <code class="docutils literal notranslate"><span class="pre">cmake_parse_arguments()</span></code> which has a certain set of behaviors.
The parsing using <code class="docutils literal notranslate"><span class="pre">cmake_parse_arguments()</span></code> is actually done in two
phases.  There is a top-level parsing of the “overall” arguments listed in
<a class="reference internal" href="#overall-arguments-tribits-add-advanced-test">Overall Arguments (tribits_add_advanced_test())</a> that also pulls out the
test blocks.  Then there is a second level of parsing using
<code class="docutils literal notranslate"><span class="pre">cmake_parse_arguments()</span></code> for each of the <code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx&gt;</span></code> blocks.  Because
of this usage, there are a few restrictions that one needs to be aware of
when using <code class="docutils literal notranslate"><span class="pre">tribits_add_advanced_test()</span></code>.  This short sections tries to
explain the behaviors and what is allowed and what is not allowed.</p>
<p>For the most part, the “overall” arguments and the arguments inside of any
individual <code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx&gt;</span></code> blocks can be listed in any order but there are
restrictions related to the grouping of overall arguments and <code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx&gt;</span></code>
blocks which are as follows:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">&lt;testNameBase&gt;</span></code> argument must be the first listed (it is the only
positional argument).</p></li>
<li><p>The test cases <code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx&gt;</span></code> must be listed in order (i.e. <code class="docutils literal notranslate"><span class="pre">TEST_0</span>
<span class="pre">...</span> <span class="pre">TEST_1</span> <span class="pre">...</span></code>) and the test cases must be consecutive integers
(e.g. can’t jump from <code class="docutils literal notranslate"><span class="pre">TEST_5</span></code> to <code class="docutils literal notranslate"><span class="pre">TEST_7</span></code>).</p></li>
<li><p>All of the arguments for a test case must appear directly below its
<code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx&gt;</span></code> keyword and before the next <code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx+1&gt;</span></code> keyword or
before any trailing overall keyword arguments.</p></li>
<li><p>None of the overall arguments (e.g. <code class="docutils literal notranslate"><span class="pre">CATEGORIES</span></code>) can be listed inside
of a <code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx&gt;</span></code> block but otherwise can be listed before or after all
of the <code class="docutils literal notranslate"><span class="pre">TEST_&lt;idx&gt;</span></code> blocks.  (NOTE: The current implementation will
actually allow overall arguments to be listed after all of the local
arguments before the next TEST_&lt;idx&gt; block but this is confusing and will
not be allowed in a future implementation).</p></li>
</ul>
<p>Other than that, the keyword arguments and options can appear in any order.</p>
<p id="implementation-details-tribits-add-advanced-test"><strong>Implementation Details (tribits_add_advanced_test())</strong></p>
<p>Since raw CTest does not support the features provided by this function, the
way an advanced test is implemented is that a <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-P</span></code> script with the
name <code class="docutils literal notranslate"><span class="pre">&lt;testName&gt;.cmake</span></code> (with any ‘/’ replaced with ‘__’) gets created in
the current binary directory that then gets added to CTest using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">add_test</span><span class="p">(</span><span class="o">&lt;</span><span class="n">testName</span><span class="o">&gt;</span> <span class="n">cmake</span> <span class="p">[</span><span class="n">other</span> <span class="n">options</span><span class="p">]</span> <span class="o">-</span><span class="n">P</span> <span class="o">&lt;</span><span class="n">testName</span><span class="o">&gt;.</span><span class="n">cmake</span><span class="p">)</span>
</pre></div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">-P</span></code> script then runs the various test cases and checks the
pass/fail for each case to determine overall pass/fail and implement other
functionality described above.</p>
<p id="setting-additional-test-properties-tribits-add-advanced-test"><strong>Setting Additional Test Properties (tribits_add_advanced_test())</strong></p>
<p>After this function returns, if the test gets added using <code class="docutils literal notranslate"><span class="pre">add_test()</span></code>,
then additional properties can be set and changed using
<code class="docutils literal notranslate"><span class="pre">set_tests_properties(&lt;testName&gt;</span> <span class="pre">...)</span></code>, where <code class="docutils literal notranslate"><span class="pre">&lt;testName&gt;</span></code> is returned
using the <code class="docutils literal notranslate"><span class="pre">ADDED_TEST_NAME_OUT</span> <span class="pre">&lt;testName&gt;</span></code> argument.  Therefore, any tests
properties that are not directly supported by this function and passed
through the argument list to this wrapper function can be set in the outer
<code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file after the call to <code class="docutils literal notranslate"><span class="pre">tribits_add_advanced_test()</span></code>.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>tribits_add_advanced_test_test( someTest ...
  ADDED_TEST_NAME_OUT  someTest_TEST_NAME )

if (someTest_TEST_NAME)
  set_tests_properties( ${someTest_TEST_NAME}
    PROPERTIES ATTACHED_FILES someTest.log )
endif()
</pre></div>
</div>
<p>where the test writes a log file <code class="docutils literal notranslate"><span class="pre">someTest.log</span></code> that we want to submit to
CDash also.</p>
<p>This approach will work no matter what TriBITS names the individual test(s)
or whether the test(s) are added or not (depending on other arguments like
<code class="docutils literal notranslate"><span class="pre">COMM</span></code>, <code class="docutils literal notranslate"><span class="pre">XHOST</span></code>, etc.).</p>
<p>The following built-in CTest test properties are set through <a class="reference internal" href="#overall-arguments-tribits-add-advanced-test">Overall
Arguments (tribits_add_advanced_test())</a> or are otherwise automatically set
by this function and should <strong>NOT</strong> be overridden by direct calls to
<code class="docutils literal notranslate"><span class="pre">set_tests_properties()</span></code>: <code class="docutils literal notranslate"><span class="pre">ENVIRONMENT</span></code>, <code class="docutils literal notranslate"><span class="pre">FAIL_REGULAR_EXPRESSION</span></code>,
<code class="docutils literal notranslate"><span class="pre">LABELS</span></code>, <code class="docutils literal notranslate"><span class="pre">PASS_REGULAR_EXPRESSION</span></code>, <code class="docutils literal notranslate"><span class="pre">RUN_SERIAL</span></code>, <code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code>,
<code class="docutils literal notranslate"><span class="pre">WILL_FAIL</span></code>, and <code class="docutils literal notranslate"><span class="pre">WORKING_DIRECTORY</span></code>.</p>
<p>However, generally, other built-in CTest test properties can be set after
the test is added like show above.  Examples of test properties that can be
set using direct calls to <code class="docutils literal notranslate"><span class="pre">set_tests_properties()</span></code> include
<code class="docutils literal notranslate"><span class="pre">ATTACHED_FILES</span></code>, <code class="docutils literal notranslate"><span class="pre">ATTACHED_FILES_ON_FAIL</span></code>, <code class="docutils literal notranslate"><span class="pre">COST</span></code>, <code class="docutils literal notranslate"><span class="pre">DEPENDS</span></code>,
<code class="docutils literal notranslate"><span class="pre">MEASUREMENT</span></code>, and <code class="docutils literal notranslate"><span class="pre">RESOURCE_LOCK</span></code>.</p>
<p>For example, one can set a dependency between two tests using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>tribits_add_advanced_test_test( test_a [...]
   ADDED_TEST_NAME_OUT  test_a_TEST_NAME )

tribits_add_advanced_test_test( test_b [...]
   ADDED_TEST_NAME_OUT  test_z_TEST_NAME )

if (test_a_TEST_NAME AND test_b_TEST_NAME)
  set_tests_properties(${test_b_TEST_NAME}
    PROPERTIES DEPENDS ${test_a_TEST_NAME})
endif()
</pre></div>
</div>
<p>This ensures that test <code class="docutils literal notranslate"><span class="pre">test_b</span></code> will always be run after <code class="docutils literal notranslate"><span class="pre">test_a</span></code> if
both tests are run by CTest.</p>
<p id="running-multiple-tests-at-the-same-time-tribits-add-advanced-test"><strong>Running multiple tests at the same time (tribits_add_advanced_test())</strong></p>
<p>Just as with <a class="reference internal" href="#tribits-add-test">tribits_add_test()</a>, setting <code class="docutils literal notranslate"><span class="pre">NUM_MPI_PROCS</span> <span class="pre">&lt;numProcs&gt;</span></code> or
<code class="docutils literal notranslate"><span class="pre">OVERALL_NUM_MPI_PROCS</span> <span class="pre">&lt;numOverallProcs&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">NUM_TOTAL_CORES_USED</span>
<span class="pre">&lt;numTotalCoresUsed&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">OVERALL_NUM_TOTAL_CORES_USED</span>
<span class="pre">&lt;overallNumTotalCoresUsed&gt;</span></code> will set the <code class="docutils literal notranslate"><span class="pre">PROCESSORS</span></code> CTest property to
allow CTest to schedule and run multiple tests at the same time when <code class="docutils literal notranslate"><span class="pre">'ctest</span>
<span class="pre">-j&lt;N&gt;'</span></code> is used (see <a class="reference internal" href="#running-multiple-tests-at-the-same-time-tribits-add-test">Running multiple tests at the same time
(tribits_add_test())</a>).</p>
<p id="disabling-tests-externally-tribits-add-advanced-test"><strong>Disabling Tests Externally (tribits_add_advanced_test())</strong></p>
<p>The test can be disabled externally by setting the CMake cache variable
<code class="docutils literal notranslate"><span class="pre">&lt;testName&gt;_DISABLE=TRUE</span></code>.  This allows tests to be disabled on a
case-by-case basis.  The name <code class="docutils literal notranslate"><span class="pre">&lt;testName&gt;</span></code> must be the <em>exact</em> name
that shows up in <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-N</span></code> when running the test.</p>
<p id="debugging-and-examining-test-generation-tribits-add-advanced-test"><strong>Debugging and Examining Test Generation (tribits_add_advanced_test())</strong></p>
<p>In order to see what tests get added and if not then why, configure with
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TRACE_ADD_TEST=ON</span></code>.  That will print one line per test
that shows that the test got added or not and if not then why the test was
not added (i.e. due to <code class="docutils literal notranslate"><span class="pre">COMM</span></code>, <code class="docutils literal notranslate"><span class="pre">OVERALL_NUM_MPI_PROCS</span></code>,
<code class="docutils literal notranslate"><span class="pre">NUM_MPI_PROCS</span></code>, <code class="docutils literal notranslate"><span class="pre">CATEGORIES</span></code>, <code class="docutils literal notranslate"><span class="pre">HOST</span></code>, <code class="docutils literal notranslate"><span class="pre">XHOST</span></code>, <code class="docutils literal notranslate"><span class="pre">HOSTTYPE</span></code>, or
<code class="docutils literal notranslate"><span class="pre">XHOSTTYPE</span></code>).</p>
<p>Likely the best way to debug test generation using this function is to
examine the generated file <code class="docutils literal notranslate"><span class="pre">&lt;testName&gt;.cmake</span></code> in the current binary
directory (see <a class="reference internal" href="#implementation-details-tribits-add-advanced-test">Implementation Details (tribits_add_advanced_test())</a>) and
the generated <code class="docutils literal notranslate"><span class="pre">CTestTestfile.cmake</span></code> file that should list this test case.</p>
<p id="using-tribits-add-advanced-test-in-non-tribits-cmake-projects"><strong>Using tribits_add_advanced_test() in non-TriBITS CMake projects</strong></p>
<p>The function <code class="docutils literal notranslate"><span class="pre">tribits_add_advanced_test()</span></code> can be used to add tests in
non-TriBITS projects.  To do so, one just needs to set the variables
<code class="docutils literal notranslate"><span class="pre">PROJECT_NAME</span></code>, <code class="docutils literal notranslate"><span class="pre">PACKAGE_NAME</span></code> (which could be the same as
<code class="docutils literal notranslate"><span class="pre">PROJECT_NAME</span></code>), <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_ENABLE_TESTS=TRUE</span></code>, and
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TRIBITS_DIR</span></code> (pointing to the TriBITS location).  For example,
a valid project can be a simple as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cmake_minimum_required(VERSION 3.17.0)
set(PROJECT_NAME TAATDriver)
project(${PROJECT_NAME} NONE)
set(${PROJECT_NAME}_TRACE_ADD_TEST TRUE)
set(${PROJECT_NAME}_TRIBITS_DIR &quot;&quot;  CACHE FILEPATH
  &quot;Location of TriBITS to use.&quot; )
set(PACKAGE_NAME ${PROJECT_NAME})
set(${PACKAGE_NAME}_ENABLE_TESTS TRUE)
set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH}
  ${TRIBITS_DIR}/core/utils
  ${TRIBITS_DIR}/core/package_arch )
include(TribitsAddAdvancedTest)
include(CTest)
enable_testing()

tribits_add_advanced_test(
  TAAT_COPY_FILES_TO_TEST_DIR_bad_file_name
  OVERALL_WORKING_DIRECTORY TEST_NAME
  TEST_0 CMND echo ARGS &quot;Hello World!&quot;
    PASS_REGULAR_EXPRESIOIN &quot;Hello World&quot;
  )
</pre></div>
</div>
<p>In: core/package_arch/TribitsAddAdvancedTest.cmake:50</p>
</section>
<section id="tribits-add-debug-option">
<h3><a class="toc-backref" href="#id126">tribits_add_debug_option()</a><a class="headerlink" href="#tribits-add-debug-option" title="Permalink to this heading"></a></h3>
<p>Add the standard cache variable option <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_ENABLE_DEBUG</span></code> for
the package.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_add_debug_option</span><span class="p">()</span>
</pre></div>
</div>
<p>This option is given the default value <code class="docutils literal notranslate"><span class="pre">${${PROJECT_NAME}_ENABLE_DEBUG}</span></code>,
and if true, this macro will set the variable
<code class="docutils literal notranslate"><span class="pre">HAVE_${PACKAGE_NAME_UC}_DEBUG</span></code> (to be used in the package’s configured
header file <a class="reference internal" href="#packagedir-cmake-packagename-config-h-in">&lt;packageDir&gt;/cmake/&lt;packageName&gt;_config.h.in</a>).  This macro is
typically called in the package’s <a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file (see
the example <code class="docutils literal notranslate"><span class="pre">SimpleCxx/CMakeLists.txt</span></code>).</p>
<p>In: core/package_arch/TribitsPackageMacros.cmake:462</p>
</section>
<section id="tribits-add-example-directories">
<h3><a class="toc-backref" href="#id127">tribits_add_example_directories()</a><a class="headerlink" href="#tribits-add-example-directories" title="Permalink to this heading"></a></h3>
<p>Macro called to conditionally add a set of example directories for an SE
package.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_add_example_directories</span><span class="p">(</span><span class="o">&lt;</span><span class="n">dir1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">dir2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>This macro typically is called from the top-level
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file for which all subdirectories are all
“examples” according to standard package layout.</p>
<p>This macro can be called several times within a package as desired to break
up example directories any way one would like.</p>
<p>Currently, all it does macro does is to call <code class="docutils literal notranslate"><span class="pre">add_subdirectory(&lt;diri&gt;)</span></code> if
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_ENABLE_EXAMPLES</span></code> or
<code class="docutils literal notranslate"><span class="pre">${PARENT_PACKAGE_NAME}_ENABLE_EXAMPLES</span></code> are true. However, this macro may
be extended in the future in order to modify behavior related to adding
tests and examples in a uniform way.</p>
<p>In: core/package_arch/TribitsPackageMacros.cmake:542</p>
</section>
<section id="tribits-add-executable">
<h3><a class="toc-backref" href="#id128">tribits_add_executable()</a><a class="headerlink" href="#tribits-add-executable" title="Permalink to this heading"></a></h3>
<p>Function used to create an executable (typically for a test or example),
using the built-in CMake command <code class="docutils literal notranslate"><span class="pre">add_executable()</span></code>.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_add_executable</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">exeRootName</span><span class="o">&gt;</span>  <span class="p">[</span><span class="n">NOEXEPREFIX</span><span class="p">]</span>  <span class="p">[</span><span class="n">NOEXESUFFIX</span><span class="p">]</span>  <span class="p">[</span><span class="n">ADD_DIR_TO_NAME</span><span class="p">]</span>
  <span class="n">SOURCES</span> <span class="o">&lt;</span><span class="n">src0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">src1</span><span class="o">&gt;</span> <span class="o">...</span>
  <span class="p">[</span><span class="n">CATEGORIES</span> <span class="o">&lt;</span><span class="n">category0</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">category1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">HOST</span> <span class="o">&lt;</span><span class="n">host0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">host1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">XHOST</span> <span class="o">&lt;</span><span class="n">host0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">host1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">HOSTTYPE</span> <span class="o">&lt;</span><span class="n">hosttype0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">hosttype1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">XHOSTTYPE</span> <span class="o">&lt;</span><span class="n">hosttype0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">hosttype1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">EXCLUDE_IF_NOT_TRUE</span> <span class="o">&lt;</span><span class="n">varname0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">varname1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">DIRECTORY</span> <span class="o">&lt;</span><span class="nb">dir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">TESTONLYLIBS</span> <span class="o">&lt;</span><span class="n">lib0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">lib1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">IMPORTEDLIBS</span> <span class="o">&lt;</span><span class="n">lib0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">lib1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">COMM</span> <span class="p">[</span><span class="n">serial</span><span class="p">]</span> <span class="p">[</span><span class="n">mpi</span><span class="p">]]</span>
  <span class="p">[</span><span class="n">LINKER_LANGUAGE</span> <span class="p">(</span><span class="n">C</span><span class="o">|</span><span class="n">CXX</span><span class="o">|</span><span class="n">Fortran</span><span class="p">)]</span>
  <span class="p">[</span><span class="n">TARGET_DEFINES</span> <span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">define0</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">define1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">INSTALLABLE</span><span class="p">]</span>
  <span class="p">[</span><span class="n">ADDED_EXE_TARGET_NAME_OUT</span> <span class="o">&lt;</span><span class="n">exeTargetName</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">)</span>
</pre></div>
</div>
<p><em>Sections:</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#formal-arguments-tribits-add-executable">Formal Arguments (tribits_add_executable())</a></p></li>
<li><p><a class="reference internal" href="#executable-and-target-name-tribits-add-executable">Executable and Target Name (tribits_add_executable())</a></p></li>
<li><p><a class="reference internal" href="#additional-executable-and-source-file-properties-tribits-add-executable">Additional Executable and Source File Properties (tribits_add_executable())</a></p></li>
<li><p><a class="reference internal" href="#install-target-tribits-add-executable">Install Target (tribits_add_executable())</a></p></li>
</ul>
<p id="formal-arguments-tribits-add-executable"><strong>Formal Arguments (tribits_add_executable())</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&lt;exeRootName&gt;</span></code></p>
<blockquote>
<div><p>The root name of the executable (and CMake target) (see <a class="reference internal" href="#executable-and-target-name-tribits-add-executable">Executable and
Target Name (tribits_add_executable())</a>).  This must be the first
argument.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">NOEXEPREFIX</span></code></p>
<blockquote>
<div><p>If passed in, then <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_</span></code> is not added the beginning of
the executable name (see <a class="reference internal" href="#executable-and-target-name-tribits-add-executable">Executable and Target Name
(tribits_add_executable())</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">NOEXESUFFIX</span></code></p>
<blockquote>
<div><p>If passed in, then <code class="docutils literal notranslate"><span class="pre">${${PROJECT_NAME}_CMAKE_EXECUTABLE_SUFFIX}</span></code> and
not added to the end of the executable name (except for native Windows
builds, see <a class="reference internal" href="#executable-and-target-name-tribits-add-executable">Executable and Target Name (tribits_add_executable())</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">ADD_DIR_TO_NAME</span></code></p>
<blockquote>
<div><p>If passed in, the directory path relative to the package’s base
directory (with “/” replaced by “_”) is added to the executable name
(see <a class="reference internal" href="#executable-and-target-name-tribits-add-executable">Executable and Target Name (tribits_add_executable())</a>).  This
provides a simple way to create unique test executable names inside of a
given TriBITS package.  Only test executables in the same directory
would need to have unique <code class="docutils literal notranslate"><span class="pre">&lt;execRootName&gt;</span></code> passed in.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">SOURCES</span> <span class="pre">&lt;src0&gt;</span> <span class="pre">&lt;src1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>Gives the source files that will be compiled into the built executable.
By default, these sources are assumed to be in the current working
directory (or can contain the relative path or absolute path).  If
<code class="docutils literal notranslate"><span class="pre">&lt;srci&gt;</span></code> is an absolute path, then that full file path is used.  This
list of sources (with adjusted directory path) are passed into
<code class="docutils literal notranslate"><span class="pre">add_executable(&lt;exeTargetName&gt;</span> <span class="pre">...</span> <span class="pre">)</span></code>.  After calling this function,
the properties of the source files can be altered using the built-in
CMake command <code class="docutils literal notranslate"><span class="pre">set_source_file_properties()</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">DIRECTORY</span> <span class="pre">&lt;dir&gt;</span></code></p>
<blockquote>
<div><p>If specified, then the generated executable <code class="docutils literal notranslate"><span class="pre">&lt;exeTargetName&gt;</span></code> is
placed in the relative or absolute directory <code class="docutils literal notranslate"><span class="pre">&lt;dir&gt;</span></code>.  If <code class="docutils literal notranslate"><span class="pre">&lt;dir&gt;</span></code> is
not an absolute path, then the generated executable is placed in the
directory <code class="docutils literal notranslate"><span class="pre">${CMAKE_CURRENT_BINARY_DIR}/&lt;dir&gt;/</span></code>.  Also, the sources for
the executable listed in <code class="docutils literal notranslate"><span class="pre">SOURCES</span> <span class="pre">&lt;src0&gt;</span> <span class="pre">&lt;src1&gt;</span> <span class="pre">...</span></code> are assumed to be
in the relative or absolute directory <code class="docutils literal notranslate"><span class="pre">&lt;dir&gt;</span></code> instead of the current
source directory.  This directory path is prepended to each source file
name <code class="docutils literal notranslate"><span class="pre">&lt;srci&gt;</span></code> unless <code class="docutils literal notranslate"><span class="pre">&lt;srci&gt;</span></code> is an absolute path.  If <code class="docutils literal notranslate"><span class="pre">&lt;dir&gt;</span></code> is
not an absolute path, then source files listed in <code class="docutils literal notranslate"><span class="pre">SOURCES</span></code> are
assumed to be in the directory <code class="docutils literal notranslate"><span class="pre">${CMAKE_CURRENT_SOURCE_DIR}/&lt;dir&gt;/</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">CATEGORIES</span> <span class="pre">&lt;category0&gt;</span> <span class="pre">&lt;category1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>Gives the <a class="reference internal" href="#test-test-categories">Test Test Categories</a> for which this test will be added.
See <a class="reference internal" href="#tribits-add-test">tribits_add_test()</a> for more details.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">HOST</span> <span class="pre">&lt;host0&gt;</span> <span class="pre">&lt;host1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>The list of hosts for which to enable the test (see <a class="reference internal" href="#tribits-add-test">tribits_add_test()</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">XHOST</span> <span class="pre">&lt;host0&gt;</span> <span class="pre">&lt;host1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>The list of hosts for which <strong>not</strong> to enable the test (see
<a class="reference internal" href="#tribits-add-test">tribits_add_test()</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">HOSTTYPE</span> <span class="pre">&lt;hosttype0&gt;</span> <span class="pre">&lt;hosttype1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>The list of host types for which to enable the test (see
<a class="reference internal" href="#tribits-add-test">tribits_add_test()</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">XHOSTTYPE</span> <span class="pre">&lt;hosttype0&gt;</span> <span class="pre">&lt;hosttype1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>The list of host types for which <strong>not</strong> to enable the test (see
<a class="reference internal" href="#tribits-add-test">tribits_add_test()</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">EXCLUDE_IF_NOT_TRUE</span> <span class="pre">&lt;varname0&gt;</span> <span class="pre">&lt;varname1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>If specified, gives the names of CMake variables that must evaluate to
true, or the test will not be added (see <a class="reference internal" href="#tribits-add-test">tribits_add_test()</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">TESTONLYLIBS</span> <span class="pre">&lt;lib0&gt;</span> <span class="pre">&lt;lib1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>Specifies extra test-only libraries defined in this CMake project that
will be linked to the executable using <code class="docutils literal notranslate"><span class="pre">target_link_libraries()</span></code>.  Note
that regular libraries (i.e. not <code class="docutils literal notranslate"><span class="pre">TESTONLY</span></code>) defined in the current SE
package or any upstream SE packages can <em>NOT</em> be listed!  TriBITS
automatically links non <code class="docutils literal notranslate"><span class="pre">TESTONLY</span></code> libraries in this package and
upstream packages to the executable.  The only libraries that should be
listed in this argument are either <code class="docutils literal notranslate"><span class="pre">TESTONLY</span></code> libraries.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">IMPORTEDLIBS</span> <span class="pre">&lt;lib0&gt;</span> <span class="pre">&lt;lib1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>Specifies extra external libraries that will be linked to the executable
using <code class="docutils literal notranslate"><span class="pre">target_link_libraries()</span></code>.  This can only be used for libraries
that are built external from this CMake project and are not provided
through a proper <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>.  The latter usage of passing in
external libraries is not recommended.  External libraries should be
handled as declared <a class="reference internal" href="#tribits-tpls">TriBITS TPLs</a>.  So far, the only case where
<code class="docutils literal notranslate"><span class="pre">IMPORTEDLIBS</span></code> has been shown to be necessary is to pass in the
standard C math library <code class="docutils literal notranslate"><span class="pre">m</span></code>.  In every other case, a TriBITS TPL
should be used instead.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">COMM</span> <span class="pre">[serial]</span> <span class="pre">[mpi]</span></code></p>
<blockquote>
<div><p>If specified, selects if the test will be added in serial and/or MPI
mode.  See the <code class="docutils literal notranslate"><span class="pre">COMM</span></code> argument in the script
<a class="reference internal" href="#tribits-add-test">tribits_add_test()</a> for more details.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">LINKER_LANGUAGE</span> <span class="pre">(C|CXX|Fortran)</span></code></p>
<blockquote>
<div><p>If specified, overrides the linker language used by setting the built-in
CMake target property <code class="docutils literal notranslate"><span class="pre">LINKER_LANGUAGE</span></code>.  TriBITS sets the default
linker language as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>if (${PROJECT_NAME}_ENABLE_CXX)
  set(LINKER_LANGUAGE CXX)
elseif (${PROJECT_NAME}_ENABLE_C)
  set(LINKER_LANGUAGE C)
else()
  # Let CMake set the default linker language it wants based
  # on source file extensions passed into ``add_executable()``.
endif()
</pre></div>
</div>
<p>The reason for this logic is that on some platform if you have a Fortran
or C main that links to C++ libraries, then you need the C++ compiler to
do the final linking.  CMake does not seem to automatically know that it
is pulling in C++ libraries and therefore needs to be told use C++ for
linking.  This is the correct default behavior for mixed-language
projects. However, this argument allows the developer to override this
logic and use any linker language desired based on other considerations.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">TARGET_DEFINES</span> <span class="pre">-D&lt;define0&gt;</span> <span class="pre">-D&lt;define1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>Add the listed defines using
<code class="docutils literal notranslate"><span class="pre">target_compile_definitions(&lt;exeTargetName&gt;</span> <span class="pre">...)</span></code>.  These should only
affect the listed sources for the built executable and not other
targets.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">INSTALLABLE</span></code></p>
<blockquote>
<div><p>If passed in, then an install target will be added to install the built
executable into the <code class="docutils literal notranslate"><span class="pre">${CMAKE_INSTALL_PREFIX}/bin/</span></code> directory (see
<a class="reference internal" href="#install-target-tribits-add-executable">Install Target (tribits_add_executable())</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">ADDED_EXE_TARGET_NAME_OUT</span> <span class="pre">&lt;exeTargetName&gt;</span></code></p>
<blockquote>
<div><p>If specified, then on output the variable <code class="docutils literal notranslate"><span class="pre">&lt;exeTargetName&gt;</span></code> will be
set with the name of the executable target passed to
<code class="docutils literal notranslate"><span class="pre">add_executable(&lt;exeTargetName&gt;</span> <span class="pre">...</span> <span class="pre">)</span></code>.  Having this name allows the
calling <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file access and set additional target
properties (see <a class="reference internal" href="#additional-executable-and-source-file-properties-tribits-add-executable">Additional Executable and Source File Properties
(tribits_add_executable())</a>).</p>
</div></blockquote>
</div></blockquote>
<p id="executable-and-target-name-tribits-add-executable"><strong>Executable and Target Name (tribits_add_executable())</strong></p>
<p>By default, the full name of the executable and target name
is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;exeTargetName&gt; = ${PACKAGE_NAME}_&lt;exeRootName&gt;
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">ADD_DIR_TO_NAME</span></code> is set, then the directory path relative to the
package base directory (with “/” replaced with “_”), or <code class="docutils literal notranslate"><span class="pre">&lt;relDirName&gt;</span></code>, is
added to the executable name to form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;exeTargetName&gt; = ${PACKAGE_NAME}_&lt;relDirName&gt;_&lt;exeRootName&gt;
</pre></div>
</div>
<p>If the option <code class="docutils literal notranslate"><span class="pre">NOEXEPREFIX</span></code> is passed in, then the prefix
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_</span></code> is removed.</p>
<p>The executable suffix <code class="docutils literal notranslate"><span class="pre">${${PROJECT_NAME}_CMAKE_EXECUTABLE_SUFFIX}</span></code> will be
added to the actual executable file name if the option <code class="docutils literal notranslate"><span class="pre">NOEXESUFFIX</span></code> is
<em>not</em> passed in but this suffix is never added to the target name.
(However, note that on Windows platforms, the default <code class="docutils literal notranslate"><span class="pre">*.exe</span></code> extension is
always added because windows will not run an executable in many contexts
unless it has the <code class="docutils literal notranslate"><span class="pre">*.exe</span></code> extension.)</p>
<p>The reason that a default prefix is prepended to the executable and target
name is because the primary reason to create an executable is typically to
create a test or an example that is private to the package.  This prefix
helps to namespace the executable and its target so as to avoid name clashes
with targets in other packages.  It also helps to avoid clashes if the
executable gets installed into the install directory (if <code class="docutils literal notranslate"><span class="pre">INSTALLABLE</span></code> is
specified).  For general utility executables on Linux/Unix systems,
<code class="docutils literal notranslate"><span class="pre">NOEXEPREFIX</span></code> and <code class="docutils literal notranslate"><span class="pre">NOEXESUFFIX</span></code> should be passed in.  In this case, one
must be careful to pick <code class="docutils literal notranslate"><span class="pre">&lt;exeRootName&gt;</span></code> that will be sufficiently globally
unique.  Please use common sense when picking non-namespaced names.</p>
<p id="additional-executable-and-source-file-properties-tribits-add-executable"><strong>Additional Executable and Source File Properties (tribits_add_executable())</strong></p>
<p>Once <code class="docutils literal notranslate"><span class="pre">add_executable(&lt;exeTargetName&gt;</span> <span class="pre">...</span> <span class="pre">)</span></code> is called and this function
exists, one can set and change properties on the <code class="docutils literal notranslate"><span class="pre">&lt;exeTargetName&gt;</span></code>
executable target using the built-in <code class="docutils literal notranslate"><span class="pre">set_target_properties()</span></code> command as
well as properties on any of the source files listed in <code class="docutils literal notranslate"><span class="pre">SOURCES</span></code> using
the built-in <code class="docutils literal notranslate"><span class="pre">set_source_file_properties()</span></code> command just like in any CMake
project.  IF the executable is added, its name will be returned by the
argument <code class="docutils literal notranslate"><span class="pre">ADDED_EXE_TARGET_NAME_OUT</span> <span class="pre">&lt;exeTargetName&gt;</span></code>.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>tribits_add_executable( someExe ...
  ADDED_EXE_TARGET_NAME_OUT  someExe_TARGET_NAME )

if (someExe_TARGET_NAME)
  set_target_properties( ${someExe_TARGET_NAME}
    PROPERTIES  LINKER_LANGUAGE  CXX )
endif()
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">if(someExe_TARGET_NAME)</span></code> is needed in case the executable does not
get added for some reason (see <a class="reference internal" href="#formal-arguments-tribits-add-executable">Formal Arguments
(tribits_add_executable())</a> for logic that can result in the executable
target not getting added).</p>
<p id="install-target-tribits-add-executable"><strong>Install Target (tribits_add_executable())</strong></p>
<p>If <code class="docutils literal notranslate"><span class="pre">INSTALLABLE</span></code> is passed in, then an install target using the built-in
CMake command <code class="docutils literal notranslate"><span class="pre">install(TARGETS</span> <span class="pre">&lt;exeTargetName&gt;</span> <span class="pre">...)</span></code> is added to install
the built executable into the <code class="docutils literal notranslate"><span class="pre">${CMAKE_INSTALL_PREFIX}/bin/</span></code> directory
(actual install directory path is determined by
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_INSTALL_RUNTIME_DIR</span></code>, see <a class="reference external" href="TribitsBuildReference.html#setting-the-install-prefix">Setting the install prefix</a>).</p>
<p>In: core/package_arch/TribitsAddExecutable.cmake:53</p>
</section>
<section id="tribits-add-executable-and-test">
<h3><a class="toc-backref" href="#id129">tribits_add_executable_and_test()</a><a class="headerlink" href="#tribits-add-executable-and-test" title="Permalink to this heading"></a></h3>
<p>Add an executable and a test (or several tests) all in one shot (just calls
<a class="reference internal" href="#tribits-add-executable">tribits_add_executable()</a> followed by <a class="reference internal" href="#tribits-add-test">tribits_add_test()</a>).</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_add_executable_and_test</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">exeRootName</span><span class="o">&gt;</span>  <span class="p">[</span><span class="n">NOEXEPREFIX</span><span class="p">]</span>  <span class="p">[</span><span class="n">NOEXESUFFIX</span><span class="p">]</span>  <span class="p">[</span><span class="n">ADD_DIR_TO_NAME</span><span class="p">]</span>
  <span class="n">SOURCES</span> <span class="o">&lt;</span><span class="n">src0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">src1</span><span class="o">&gt;</span> <span class="o">...</span>
  <span class="p">[</span><span class="n">NAME</span> <span class="o">&lt;</span><span class="n">testName</span><span class="o">&gt;</span> <span class="o">|</span> <span class="n">NAME_POSTFIX</span> <span class="o">&lt;</span><span class="n">testNamePostfix</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">CATEGORIES</span> <span class="o">&lt;</span><span class="n">category0</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">category1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">HOST</span> <span class="o">&lt;</span><span class="n">host0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">host1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">XHOST</span> <span class="o">&lt;</span><span class="n">xhost0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">xhost1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">XHOST_TEST</span> <span class="o">&lt;</span><span class="n">xhost0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">xhost1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">HOSTTYPE</span> <span class="o">&lt;</span><span class="n">hosttype0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">hosttype1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">XHOSTTYPE</span> <span class="o">&lt;</span><span class="n">xhosttype0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">xhosttype1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">XHOSTTYPE_TEST</span> <span class="o">&lt;</span><span class="n">xhosttype0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">xhosttype1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">EXCLUDE_IF_NOT_TRUE</span> <span class="o">&lt;</span><span class="n">varname0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">varname1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">DISABLED</span> <span class="s2">&quot;&lt;messageWhyDisabled&gt;&quot;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">DIRECTORY</span> <span class="o">&lt;</span><span class="nb">dir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">TESTONLYLIBS</span> <span class="o">&lt;</span><span class="n">lib0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">lib1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">IMPORTEDLIBS</span> <span class="o">&lt;</span><span class="n">lib0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">lib1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">COMM</span> <span class="p">[</span><span class="n">serial</span><span class="p">]</span> <span class="p">[</span><span class="n">mpi</span><span class="p">]]</span>
  <span class="p">[</span><span class="n">ARGS</span> <span class="s2">&quot;&lt;arg0&gt; &lt;arg1&gt; ...&quot;</span> <span class="s2">&quot;&lt;arg2&gt; &lt;arg3&gt; ...&quot;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">NUM_MPI_PROCS</span> <span class="o">&lt;</span><span class="n">numProcs</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">LINKER_LANGUAGE</span> <span class="p">(</span><span class="n">C</span><span class="o">|</span><span class="n">CXX</span><span class="o">|</span><span class="n">Fortran</span><span class="p">)]</span>
  <span class="p">[</span><span class="n">STANDARD_PASS_OUTPUT</span>
    <span class="o">|</span> <span class="n">PASS_REGULAR_EXPRESSION</span> <span class="s2">&quot;&lt;regex0&gt;;&lt;regex1&gt;;...&quot;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">FAIL_REGULAR_EXPRESSION</span> <span class="s2">&quot;&lt;regex0&gt;;&lt;regex1&gt;;...&quot;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">WILL_FAIL</span><span class="p">]</span>
  <span class="p">[</span><span class="n">ENVIRONMENT</span> <span class="o">&lt;</span><span class="n">var0</span><span class="o">&gt;=&lt;</span><span class="n">value0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">var1</span><span class="o">&gt;=&lt;</span><span class="n">value1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">INSTALLABLE</span><span class="p">]</span>
  <span class="p">[</span><span class="n">TIMEOUT</span> <span class="o">&lt;</span><span class="n">maxSeconds</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">LIST_SEPARATOR</span> <span class="o">&lt;</span><span class="n">sep</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">ADDED_EXE_TARGET_NAME_OUT</span> <span class="o">&lt;</span><span class="n">exeTargetName</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">ADDED_TESTS_NAMES_OUT</span> <span class="o">&lt;</span><span class="n">testsNames</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>This function takes a fairly common set of arguments to
<a class="reference internal" href="#tribits-add-executable">tribits_add_executable()</a> and <a class="reference internal" href="#tribits-add-test">tribits_add_test()</a> but not the full set
passed to <code class="docutils literal notranslate"><span class="pre">tribits_add_test()</span></code>.  See the documentation for
<a class="reference internal" href="#tribits-add-executable">tribits_add_executable()</a> and <a class="reference internal" href="#tribits-add-test">tribits_add_test()</a> to see which arguments
are accepted by which functions.</p>
<p>Arguments that are specific to this function and not directly passed on to
<code class="docutils literal notranslate"><span class="pre">tribits_add_executable()</span></code> or <code class="docutils literal notranslate"><span class="pre">tribits_add_test()</span></code> include:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">XHOST_TEST</span> <span class="pre">&lt;xhost0&gt;</span> <span class="pre">&lt;xhost1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>When specified, this disables just running the tests for the named hosts
<code class="docutils literal notranslate"><span class="pre">&lt;xhost0&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;xhost0&gt;</span></code> etc. but still builds the executable for the
test.  These are just passed in through the <code class="docutils literal notranslate"><span class="pre">XHOST</span></code> argument to
<code class="docutils literal notranslate"><span class="pre">tribits_add_test()</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">XHOSTTYPE_TEST</span> <span class="pre">&lt;xhosttype0&gt;</span> <span class="pre">&lt;hosttype1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>When specified, this disables just running the tests for the named host
types <code class="docutils literal notranslate"><span class="pre">&lt;hosttype0&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;hosttype0&gt;</span></code>, …, but still builds the
executable for the test.  These are just passed in through the
<code class="docutils literal notranslate"><span class="pre">XHOSTTYPE</span></code> argument to <code class="docutils literal notranslate"><span class="pre">tribits_add_test()</span></code>.</p>
</div></blockquote>
</div></blockquote>
<p>This is the function to use for simple test executables that you want to run
that either takes no arguments or just a simple set of arguments passed in
through <code class="docutils literal notranslate"><span class="pre">ARGS</span></code>.  For more flexibility, just use
<code class="docutils literal notranslate"><span class="pre">tribits_add_executable()</span></code> followed by <code class="docutils literal notranslate"><span class="pre">tribits_add_test()</span></code>.</p>
<p>In: core/package_arch/TribitsAddExecutableAndTest.cmake:82</p>
</section>
<section id="tribits-add-library">
<h3><a class="toc-backref" href="#id130">tribits_add_library()</a><a class="headerlink" href="#tribits-add-library" title="Permalink to this heading"></a></h3>
<p>Function used to add a CMake library and target using <code class="docutils literal notranslate"><span class="pre">add_library()</span></code> and
also the ALIAS target <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}::&lt;libname&gt;</span></code> (where <code class="docutils literal notranslate"><span class="pre">&lt;libname&gt;</span></code> is
the full CMake target name as returned from <code class="docutils literal notranslate"><span class="pre">${&lt;libTargetName&gt;}</span></code>).</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_add_library</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">libBaseName</span><span class="o">&gt;</span>
  <span class="p">[</span><span class="n">HEADERS</span> <span class="o">&lt;</span><span class="n">h0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">HEADERS_INSTALL_SUBDIR</span> <span class="o">&lt;</span><span class="n">headerssubdir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">NOINSTALLHEADERS</span> <span class="o">&lt;</span><span class="n">nih0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">hih1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">SOURCES</span> <span class="o">&lt;</span><span class="n">src0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">src1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">DEPLIBS</span> <span class="o">&lt;</span><span class="n">deplib0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">deplib1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">IMPORTEDLIBS</span> <span class="o">&lt;</span><span class="n">ideplib0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ideplib1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">STATIC</span><span class="o">|</span><span class="n">SHARED</span><span class="p">]</span>
  <span class="p">[</span><span class="n">TESTONLY</span><span class="p">]</span>
  <span class="p">[</span><span class="n">NO_INSTALL_LIB_OR_HEADERS</span><span class="p">]</span>
  <span class="p">[</span><span class="n">CUDALIBRARY</span><span class="p">]</span>
  <span class="p">[</span><span class="n">ADDED_LIB_TARGET_NAME_OUT</span> <span class="o">&lt;</span><span class="n">libTargetName</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">)</span>
</pre></div>
</div>
<p><em>Sections:</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#formal-arguments-tribits-add-library">Formal Arguments (tribits_add_library())</a></p></li>
<li><p><a class="reference internal" href="#include-directories-tribits-add-library">Include Directories (tribits_add_library())</a></p></li>
<li><p><a class="reference internal" href="#install-targets-tribits-add-library">Install Targets (tribits_add_library())</a></p></li>
<li><p><a class="reference internal" href="#additional-library-and-source-file-properties-tribits-add-library">Additional Library and Source File Properties (tribits_add_library())</a></p></li>
<li><p><a class="reference internal" href="#miscellaneous-notes-tribits-add-library">Miscellaneous Notes (tribits_add_library())</a></p></li>
</ul>
<p id="formal-arguments-tribits-add-library"><strong>Formal Arguments (tribits_add_library())</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&lt;libBaseName&gt;</span></code></p>
<blockquote>
<div><p>Required base name of the library.  The name of the actual library name
will be prefixed by <code class="docutils literal notranslate"><span class="pre">${${PROJECT_NAME}_LIBRARY_NAME_PREFIX}</span></code> to
produce:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;libTargetName&gt; = ${${PROJECT_NAME}_LIBRARY_NAME_PREFIX}&lt;libBaseName&gt;
</pre></div>
</div>
<p>This is the name passed to <code class="docutils literal notranslate"><span class="pre">add_library(&lt;libTargetName&gt;</span> <span class="pre">...)</span></code>.  The
name is <em>not</em> prefixed by the package name.  CMake will of course add
any standard prefix or post-fix to the library file name appropriate for
the platform and if this is a static or shared library build (e.g. on
Linux prefix = <code class="docutils literal notranslate"><span class="pre">'lib'</span></code>, postfix = <code class="docutils literal notranslate"><span class="pre">'.so'</span></code> for shared lib and postfix
= <code class="docutils literal notranslate"><span class="pre">'.a'</span></code> static lib) (see documentation for the built-in CMake command
<code class="docutils literal notranslate"><span class="pre">add_library()</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">HEADERS</span> <span class="pre">&lt;h0&gt;</span> <span class="pre">&lt;h1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>List of public header files for using this library.  By default, these
header files are assumed to be in the current source directory.  They
can also contain the relative path or absolute path to the files if they
are not in the current source directory.  This list of headers is passed
into <code class="docutils literal notranslate"><span class="pre">add_library(...)</span></code> as well (which is not strictly needed but is
helpful for some build tools, like MS Visual Studio).  By default, these
headers will be installed (see <a class="reference internal" href="#install-targets-tribits-add-library">Install Targets
(tribits_add_library())</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">HEADERS_INSTALL_SUBDIR</span> <span class="pre">&lt;headerssubdir&gt;</span></code></p>
<blockquote>
<div><p>Optional subdirectory that the headers will be installed under the
standard installation directory.  If <code class="docutils literal notranslate"><span class="pre">&lt;headerssubdir&gt;!=&quot;&quot;</span></code>, then the
headers will be installed under
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_INSTALL_INCLUDE_DIR}/&lt;headerssubdir&gt;</span></code>.  Otherwise,
they will be installed under <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_INSTALL_INCLUDE_DIR}/</span></code>.
<a class="reference internal" href="#install-targets-tribits-add-library">Install Targets (tribits_add_library())</a>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">NOINSTALLHEADERS</span> <span class="pre">&lt;nih0&gt;</span> <span class="pre">&lt;hih1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>List of private header files which are used by this library. These
headers are not installed and do not needed to be passed in for any
purpose other than to pass them into <code class="docutils literal notranslate"><span class="pre">add_library()</span></code> as some build
tools like to have these listed (e.g. MS Visual Studio).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">SOURCES</span> <span class="pre">&lt;src0&gt;</span> <span class="pre">&lt;src1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>List of source files passed into <code class="docutils literal notranslate"><span class="pre">add_library()</span></code> that are compiled
into header files and included in the library.  The compiler used to
compile the files is determined automatically based on the file
extension (see CMake documentation for <code class="docutils literal notranslate"><span class="pre">add_library()</span></code>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">DEPLIBS</span> <span class="pre">&lt;deplib0&gt;</span> <span class="pre">&lt;deplib1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>List of dependent libraries that are built in the current SE package
that this library is dependent on.  These libraries are passed into
<code class="docutils literal notranslate"><span class="pre">target_link_libraries(&lt;libTargetName&gt;</span> <span class="pre">...)</span></code> so that CMake knows about
the dependency structure of the libraries within this SE package.
<strong>NOTE:</strong> One must <strong>not</strong> list libraries in other upstream <a class="reference internal" href="#tribits-se-packages">TriBITS SE
Packages</a> or libraries built externally from this TriBITS CMake project
in <code class="docutils literal notranslate"><span class="pre">DEPLIBS</span></code>.  The TriBITS system automatically handles linking to
libraries in upstream TriBITS SE packages.  External libraries need to
be listed in the <code class="docutils literal notranslate"><span class="pre">IMPORTEDLIBS</span></code> argument instead if they are not
already specified automatically using a <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">IMPORTEDLIBS</span> <span class="pre">&lt;ideplib0&gt;</span> <span class="pre">&lt;ideplib1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>List of dependent libraries built externally from this TriBITS CMake
project.  These libraries are passed into
<code class="docutils literal notranslate"><span class="pre">target_link_libraries(&lt;libTargetName&gt;</span> <span class="pre">...)</span></code> so that CMake knows about
the dependency.  However, note that external libraries are often better
handled as <a class="reference internal" href="#tribits-tpls">TriBITS TPLs</a>.  A well constructed TriBITS package and
library should never have to use this option!  So far, the only case
where <code class="docutils literal notranslate"><span class="pre">IMPORTEDLIBS</span></code> has been shown to be necessary is to pass in the
standard C math library <code class="docutils literal notranslate"><span class="pre">m</span></code>.  In every other case, a TriBITS TPL
should be used instead.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">STATIC</span></code> or <code class="docutils literal notranslate"><span class="pre">SHARED</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">STATIC</span></code> is passed in, then a static library will be created
independent of the value of <code class="docutils literal notranslate"><span class="pre">BUILD_SHARED_LIBS</span></code>.  If <code class="docutils literal notranslate"><span class="pre">SHARED</span></code> is
passed in, then a shared library will be created independent of the
value of <code class="docutils literal notranslate"><span class="pre">BUILD_SHARED_LIBS</span></code>.  If neither <code class="docutils literal notranslate"><span class="pre">STATIC</span></code> or <code class="docutils literal notranslate"><span class="pre">SHARED</span></code> are
passed in, then a shared library will be created if
<code class="docutils literal notranslate"><span class="pre">BUILD_SHARED_LIBS</span></code> evaluates to true, otherwise and a static library
will be created.  If both <code class="docutils literal notranslate"><span class="pre">STATIC</span></code> and <code class="docutils literal notranslate"><span class="pre">SHARED</span></code> are passed in (which
is obviously a mistake), then a shared library will be created.
WARNING: Once you mark a library with <code class="docutils literal notranslate"><span class="pre">STATIC</span></code>, then all of the
downstream libraries in the current SE package and all downstream SE
packages must also be also be marked with <code class="docutils literal notranslate"><span class="pre">STATIC</span></code>.  That is because,
generally, one can not link a link a static lib against a downstream
shared lib since that is not portable (but can be done on some platforms
if, for example, <code class="docutils literal notranslate"><span class="pre">-fPIC</span></code> is specified).  So be careful to use
<code class="docutils literal notranslate"><span class="pre">STATIC</span></code> in all downstream libraries!</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">TESTONLY</span></code></p>
<blockquote>
<div><p>If passed in, then <code class="docutils literal notranslate"><span class="pre">&lt;libTargetName&gt;</span></code> will <strong>not</strong> be added to
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_LIBRARIES</span></code> and an install target for the library will
not be added.  In this case, the current include directories will be set
in the global variable <code class="docutils literal notranslate"><span class="pre">&lt;libTargetName&gt;_INCLUDE_DIR</span></code> which will be
used in <a class="reference internal" href="#tribits-add-executable">tribits_add_executable()</a> when a test-only library is linked
in through its <code class="docutils literal notranslate"><span class="pre">DEPLIBS</span></code> argument.  Also, the custom property
<code class="docutils literal notranslate"><span class="pre">TRIBITS_TESTONLY_LIB</span></code> will be set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> which will ensure that
this library will not be added to the <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}::all_libs</span></code>
target.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">NO_INSTALL_LIB_OR_HEADERS</span></code></p>
<blockquote>
<div><p>If specified, then no install targets will be added for the library
<code class="docutils literal notranslate"><span class="pre">&lt;libTargetName&gt;</span></code> or the header files listed in <code class="docutils literal notranslate"><span class="pre">HEADERS</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">CUDALIBRARY</span></code></p>
<blockquote>
<div><p>If specified then <code class="docutils literal notranslate"><span class="pre">cuda_add_library()</span></code> is used instead of
<code class="docutils literal notranslate"><span class="pre">add_library()</span></code> where <code class="docutils literal notranslate"><span class="pre">cuda_add_library()</span></code> is assumed to be defined
by the standard <code class="docutils literal notranslate"><span class="pre">FindCUDA.cmake</span></code> module as processed using the
standard TriBITS <code class="docutils literal notranslate"><span class="pre">FindTPLCUDA.cmake</span></code> file (see <a class="reference internal" href="#standard-tribits-tpls">Standard TriBITS
TPLs</a>).  For this option to work, this SE package must have an enabled
direct or indirect dependency on the TriBITS CUDA TPL or a
configure-time error may occur about not knowing about
<code class="docutils literal notranslate"><span class="pre">cuda_all_library()</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">ADDED_LIB_TARGET_NAME_OUT</span> <span class="pre">&lt;libTargetName&gt;</span></code></p>
<blockquote>
<div><p>If specified, then on output the variable <code class="docutils literal notranslate"><span class="pre">&lt;libTargetName&gt;</span></code> will be
set with the name of the library passed to <code class="docutils literal notranslate"><span class="pre">add_library()</span></code>.  Having
this name allows the calling <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file access and set
additional target properties (see <a class="reference internal" href="#additional-library-and-source-file-properties-tribits-add-library">Additional Library and Source File
Properties (tribits_add_library())</a>).</p>
</div></blockquote>
</div></blockquote>
<p id="include-directories-tribits-add-library"><strong>Include Directories (tribits_add_library())</strong></p>
<p>Any base directories for the header files listed in the arguments
<code class="docutils literal notranslate"><span class="pre">HEADERS</span></code> or <code class="docutils literal notranslate"><span class="pre">NOINSTALLHEADERS</span></code> should be passed into the standard CMake
command <code class="docutils literal notranslate"><span class="pre">include_directories()</span></code> <strong>before</strong> calling this function.  For
example, a CMakeLists.txt file will look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>...

tribits_configure_file(${PACKAGE_NAME}_config.h)
configure_file(...)

...

include_directories(${CMAKE_CURRENT_SOURCE_DIR})
include_directories(${CMAKE_CURRENT_BINARY_DIR})

...

tribits_add_library( &lt;libName&gt;
  SOURCES
    &lt;src0&gt;.c
    &lt;subdir0&gt;/&lt;src1&gt;.cpp
    &lt;subdir1&gt;/&lt;src2&gt;.F90
    ...
  HEADERS
     &lt;header0&gt;.h
     &lt;subdir0&gt;/&lt;header1&gt;.hpp
      ...
  NONINSTALLHEADERS &lt;header2&gt;.hpp &lt;header3&gt;.hpp ...
  ...
  )
</pre></div>
</div>
<p>The include of <code class="docutils literal notranslate"><span class="pre">${CMAKE_CURRENT_BINARY_DIR}</span></code> is needed for any generated
header files (e.g. using raw <code class="docutils literal notranslate"><span class="pre">configure_file()</span></code> or
<a class="reference internal" href="#tribits-configure-file">tribits_configure_file()</a>) or any generated Fortran <code class="docutils literal notranslate"><span class="pre">*.mod</span></code> module files
generated as a byproduct of compiling F90+ source files (that contain one or
more Fortran module declarations).</p>
<p>The function <code class="docutils literal notranslate"><span class="pre">tribits_add_library()</span></code> will grab the list of all of the
include directories in scope from prior calls to <code class="docutils literal notranslate"><span class="pre">include_directories()</span></code>
and will add this to the generated library target using
<code class="docutils literal notranslate"><span class="pre">target_link_libraries()</span></code> so that they get propagated downstream as well.</p>
<p id="install-targets-tribits-add-library"><strong>Install Targets (tribits_add_library())</strong></p>
<p>By default, an install target for the library is created using
<code class="docutils literal notranslate"><span class="pre">install(TARGETS</span> <span class="pre">&lt;libTargetName&gt;</span> <span class="pre">...)</span></code> to install into the directory
<code class="docutils literal notranslate"><span class="pre">${CMAKE_INSTALL_PREFIX}/lib/</span></code> (actual install directory is given by
<code class="docutils literal notranslate"><span class="pre">${PROJECT}_INSTALL_LIB_DIR</span></code>, see <a class="reference external" href="TribitsBuildReference.html#setting-the-install-prefix">Setting the install prefix</a>).
However, this install target will not get created if
<a class="reference internal" href="#project-name-install-libraries-and-headers">${PROJECT_NAME}_INSTALL_LIBRARIES_AND_HEADERS</a> is <code class="docutils literal notranslate"><span class="pre">FASLE</span></code> and
<code class="docutils literal notranslate"><span class="pre">BUILD_SHARD_LIBS=OFF</span></code>.  But when <code class="docutils literal notranslate"><span class="pre">BUILD_SHARD_LIBS=ON</span></code>, the install
target will get added.  Also, this install target will <em>not</em> get added if
<code class="docutils literal notranslate"><span class="pre">TESTONLY</span></code> or <code class="docutils literal notranslate"><span class="pre">NO_INSTALL_LIB_OR_HEADERS</span></code> are passed in.</p>
<p>By default, an install target for the headers listed in <code class="docutils literal notranslate"><span class="pre">HEADERS</span></code> will get
added using <code class="docutils literal notranslate"><span class="pre">install(FILES</span> <span class="pre">&lt;h0&gt;</span> <span class="pre">&lt;h1&gt;</span> <span class="pre">...)</span></code>, but only if <code class="docutils literal notranslate"><span class="pre">TESTONLY</span></code> and
<code class="docutils literal notranslate"><span class="pre">NO_INSTALL_LIB_OR_HEADERS</span></code> are not passed in as well.  Also, the install
target for the headers will not get added if
<a class="reference internal" href="#project-name-install-libraries-and-headers">${PROJECT_NAME}_INSTALL_LIBRARIES_AND_HEADERS</a> is <code class="docutils literal notranslate"><span class="pre">FASLE</span></code>.  If this
install target is added, then the headers get installed into the flat
directory <code class="docutils literal notranslate"><span class="pre">${${PROJECT_NAME}_INSTALL_INCLUDE_DIR}/</span></code> (default is
<code class="docutils literal notranslate"><span class="pre">${CMAKE_INSTALL_PREFIX}/include/</span></code>, see <a class="reference external" href="TribitsBuildReference.html#setting-the-install-prefix">Setting the install prefix</a>).
If <code class="docutils literal notranslate"><span class="pre">HEADERS_INSTALL_SUBDIR</span></code> is set, then the headers will be installed
under <code class="docutils literal notranslate"><span class="pre">${${PROJECT_NAME}_INSTALL_INCLUDE_DIR}/&lt;headerssubdir&gt;/</span></code>.</p>
<p>Note that an install target will <em>not</em> get created for the headers listed in
<code class="docutils literal notranslate"><span class="pre">NOINSTALLHEADERS</span></code>.</p>
<p id="additional-library-and-source-file-properties-tribits-add-library"><strong>Additional Library and Source File Properties (tribits_add_library())</strong></p>
<p>Once <code class="docutils literal notranslate"><span class="pre">add_library(&lt;libTargetName&gt;</span> <span class="pre">...</span> <span class="pre">&lt;src0&gt;</span> <span class="pre">&lt;src1&gt;</span> <span class="pre">...)</span></code> is called, one
can set and change properties on the <code class="docutils literal notranslate"><span class="pre">&lt;libTargetName&gt;</span></code> library target
using the built-in CMake command <code class="docutils literal notranslate"><span class="pre">set_target_properties()</span></code> as well as set
and change properties on any of the source files listed in <code class="docutils literal notranslate"><span class="pre">SOURCES</span></code> using
the built-in CMake command <code class="docutils literal notranslate"><span class="pre">set_source_file_properties()</span></code> just like in any
CMake project.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>tribits_add_library( somelib ...
  ADDED_LIB_TARGET_NAME_OUT  somelib_TARGET_NAME )

set_target_properties( ${somelib_TARGET_NAME}
  PROPERTIES  LINKER_LANGUAGE  CXX )
</pre></div>
</div>
<p id="miscellaneous-notes-tribits-add-library"><strong>Miscellaneous Notes (tribits_add_library())</strong></p>
<p>When the file <code class="docutils literal notranslate"><span class="pre">Version.cmake</span></code> exists and the CMake variables
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_VERSION</span></code> and <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_MAJOR_VERSION</span></code> are
defined, then produced shared libraries will be given the standard SOVERSION
symlinks (see <a class="reference internal" href="#projectdir-version-cmake">&lt;projectDir&gt;/Version.cmake</a>).</p>
<p><strong>WARNING:</strong> Do <strong>NOT</strong> use the built-in CMake command <code class="docutils literal notranslate"><span class="pre">add_definitions()</span></code>
to add defines <code class="docutils literal notranslate"><span class="pre">-D&lt;someDefine&gt;</span></code> to the compile command line that will
affect any of the header files in the package!  These CMake-added defines
are only set locally in this directory and child directories.  These defines
will <strong>NOT</strong> be set when code in peer directories (e.g. a downstream TriBITS
packages) compiles that may include these header files.  To add defines that
affect header files, please use a configured header file (see
<a class="reference internal" href="#tribits-configure-file">tribits_configure_file()</a>).</p>
<p>In: core/package_arch/TribitsAddLibrary.cmake:54</p>
</section>
<section id="tribits-add-option-and-define">
<h3><a class="toc-backref" href="#id131">tribits_add_option_and_define()</a><a class="headerlink" href="#tribits-add-option-and-define" title="Permalink to this heading"></a></h3>
<p>Add an option and a define variable in one shot.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_add_option_and_define</span><span class="p">(</span> <span class="o">&lt;</span><span class="n">userOptionName</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">macroDefineName</span><span class="o">&gt;</span>
  <span class="s2">&quot;&lt;docStr&gt;&quot;</span>  <span class="o">&lt;</span><span class="n">defaultValue</span><span class="o">&gt;</span> <span class="p">)</span>
</pre></div>
</div>
<p>This macro sets the user cache <code class="docutils literal notranslate"><span class="pre">BOOL</span></code> variable <code class="docutils literal notranslate"><span class="pre">&lt;userOptionName&gt;</span></code> and if
it is true, then sets the global (internal cache) macro define variable
<code class="docutils literal notranslate"><span class="pre">&lt;macroDefineName&gt;</span></code> to <code class="docutils literal notranslate"><span class="pre">ON</span></code>, and otherwise sets it to <code class="docutils literal notranslate"><span class="pre">OFF</span></code>.  This is
designed to make it easy to add a user-enabled option to a configured header
file and have the define set in one shot.  This would require that the
package’s configure file (see <a class="reference internal" href="#tribits-configure-file">tribits_configure_file()</a>) have the line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#cmakedefine &lt;macroDefineName&gt;</span>
</pre></div>
</div>
<p>In: core/package_arch/TribitsAddOptionAndDefine.cmake:43</p>
</section>
<section id="tribits-add-show-deprecated-warnings-option">
<h3><a class="toc-backref" href="#id132">tribits_add_show_deprecated_warnings_option()</a><a class="headerlink" href="#tribits-add-show-deprecated-warnings-option" title="Permalink to this heading"></a></h3>
<p>Add the standard option <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_SHOW_DEPRECATED_WARNINGS</span></code> for the
package.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_add_show_deprecated_warnings_option</span><span class="p">()</span>
</pre></div>
</div>
<p>This macro should be called in the package’s &lt;packageDir&gt;/CMakeLists.txt`_
file.  This option is given the default value
<code class="docutils literal notranslate"><span class="pre">${${PROJECT_NAME}_SHOW_DEPRECATED_WARNINGS}</span></code>.  This option is then looked
for in <a class="reference internal" href="#tribits-configure-file">tribits_configure_file()</a> to add macros to add deprecated warnings
to deprecated parts of a package.</p>
<p>In: core/package_arch/TribitsPackageMacros.cmake:497</p>
</section>
<section id="tribits-add-test">
<h3><a class="toc-backref" href="#id133">tribits_add_test()</a><a class="headerlink" href="#tribits-add-test" title="Permalink to this heading"></a></h3>
<p>Add a test or a set of tests for a single executable or command using CTest
<code class="docutils literal notranslate"><span class="pre">add_test()</span></code>.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_add_test</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">exeRootName</span><span class="o">&gt;</span>  <span class="p">[</span><span class="n">NOEXEPREFIX</span><span class="p">]</span>  <span class="p">[</span><span class="n">NOEXESUFFIX</span><span class="p">]</span>
  <span class="p">[</span><span class="n">NAME</span> <span class="o">&lt;</span><span class="n">testName</span><span class="o">&gt;</span> <span class="o">|</span> <span class="n">NAME_POSTFIX</span> <span class="o">&lt;</span><span class="n">testNamePostfix</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">DIRECTORY</span> <span class="o">&lt;</span><span class="n">directory</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">ADD_DIR_TO_NAME</span><span class="p">]</span>
  <span class="p">[</span><span class="n">RUN_SERIAL</span><span class="p">]</span>
  <span class="p">[</span><span class="n">ARGS</span> <span class="s2">&quot;&lt;arg0&gt; &lt;arg1&gt; ...&quot;</span> <span class="s2">&quot;&lt;arg2&gt; &lt;arg3&gt; ...&quot;</span> <span class="o">...</span>
    <span class="o">|</span> <span class="n">POSTFIX_AND_ARGS_0</span> <span class="o">&lt;</span><span class="n">postfix0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">arg0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">arg1</span><span class="o">&gt;</span> <span class="o">...</span>
      <span class="n">POSTFIX_AND_ARGS_1</span> <span class="o">...</span> <span class="p">]</span>
  <span class="p">[</span><span class="n">COMM</span> <span class="p">[</span><span class="n">serial</span><span class="p">]</span> <span class="p">[</span><span class="n">mpi</span><span class="p">]]</span>
  <span class="p">[</span><span class="n">NUM_MPI_PROCS</span> <span class="o">&lt;</span><span class="n">numMpiProcs</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">NUM_TOTAL_CORES_USED</span> <span class="o">&lt;</span><span class="n">numTotalCoresUsed</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">CATEGORIES</span> <span class="o">&lt;</span><span class="n">category0</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">category1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">HOST</span> <span class="o">&lt;</span><span class="n">host0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">host1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">XHOST</span> <span class="o">&lt;</span><span class="n">host0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">host1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">HOSTTYPE</span> <span class="o">&lt;</span><span class="n">hosttype0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">hosttype1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">XHOSTTYPE</span> <span class="o">&lt;</span><span class="n">hosttype0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">hosttype1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">EXCLUDE_IF_NOT_TRUE</span> <span class="o">&lt;</span><span class="n">varname0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">varname1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">DISABLED</span> <span class="o">&lt;</span><span class="n">messageWhyDisabled</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">STANDARD_PASS_OUTPUT</span>
    <span class="o">|</span> <span class="n">PASS_REGULAR_EXPRESSION</span> <span class="s2">&quot;&lt;regex0&gt;&quot;</span> <span class="s2">&quot;&lt;regex1&gt;&quot;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">FAIL_REGULAR_EXPRESSION</span> <span class="s2">&quot;&lt;regex0&gt;&quot;</span> <span class="s2">&quot;&lt;regex1&gt;&quot;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">WILL_FAIL</span><span class="p">]</span>
  <span class="p">[</span><span class="n">ENVIRONMENT</span> <span class="o">&lt;</span><span class="n">var0</span><span class="o">&gt;=&lt;</span><span class="n">value0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">var1</span><span class="o">&gt;=&lt;</span><span class="n">value1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">TIMEOUT</span> <span class="o">&lt;</span><span class="n">maxSeconds</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">LIST_SEPARATOR</span> <span class="o">&lt;</span><span class="n">sep</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">ADDED_TESTS_NAMES_OUT</span> <span class="o">&lt;</span><span class="n">testsNames</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>The tests are only added if tests are enabled for the SE package
(i.e. <a class="reference internal" href="#package-name-enable-tests">${PACKAGE_NAME}_ENABLE_TESTS</a>) or the parent package (if this is a
subpackage) (i.e. <code class="docutils literal notranslate"><span class="pre">${PARENT_PACKAGE_NAME}_ENABLE_TESTS</span></code>).  (NOTE: A more
efficient way to optionally enable tests is to put them in a <code class="docutils literal notranslate"><span class="pre">test/</span></code>
subdir and then include that subdir with <a class="reference internal" href="#tribits-add-test-directories">tribits_add_test_directories()</a>.)</p>
<p><em>Sections:</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#formal-arguments-tribits-add-test">Formal Arguments (tribits_add_test())</a></p></li>
<li><p><a class="reference internal" href="#determining-the-executable-or-command-to-run-tribits-add-test">Determining the Executable or Command to Run (tribits_add_test())</a></p></li>
<li><p><a class="reference internal" href="#determining-the-full-test-name-tribits-add-test">Determining the Full Test Name (tribits_add_test())</a></p></li>
<li><p><a class="reference internal" href="#adding-multiple-tests-tribits-add-test">Adding Multiple Tests  (tribits_add_test())</a></p></li>
<li><p><a class="reference internal" href="#determining-pass-fail-tribits-add-test">Determining Pass/Fail (tribits_add_test())</a></p></li>
<li><p><a class="reference internal" href="#setting-additional-test-properties-tribits-add-test">Setting additional test properties (tribits_add_test())</a></p></li>
<li><p><a class="reference internal" href="#running-multiple-tests-at-the-same-time-tribits-add-test">Running multiple tests at the same time (tribits_add_test())</a></p></li>
<li><p><a class="reference internal" href="#setting-timeouts-for-tests-tribits-add-test">Setting timeouts for tests (tribits_add_test())</a></p></li>
<li><p><a class="reference internal" href="#debugging-and-examining-test-generation-tribits-add-test">Debugging and Examining Test Generation (tribits_add_test())</a></p></li>
<li><p><a class="reference internal" href="#disabling-tests-externally-tribits-add-test">Disabling Tests Externally (tribits_add_test())</a></p></li>
<li><p><a class="reference internal" href="#adding-extra-commandline-arguments-externally-tribits-add-test">Adding extra commandline arguments externally (tribits_add_test())</a></p></li>
</ul>
<p id="formal-arguments-tribits-add-test"><strong>Formal Arguments (tribits_add_test())</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&lt;exeRootName&gt;</span></code></p>
<blockquote>
<div><p>The name of the executable or path to the executable to run for the test
(see <a class="reference internal" href="#determining-the-executable-or-command-to-run-tribits-add-test">Determining the Executable or Command to Run
(tribits_add_test())</a>).  This name is also the default root name for
the test (see <a class="reference internal" href="#determining-the-full-test-name-tribits-add-test">Determining the Full Test Name (tribits_add_test())</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">NOEXEPREFIX</span></code></p>
<blockquote>
<div><p>If specified, then the prefix <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_</span></code> is assumed <strong>not</strong> to
be prepended to <code class="docutils literal notranslate"><span class="pre">&lt;exeRootName&gt;</span></code> (see <a class="reference internal" href="#determining-the-executable-or-command-to-run-tribits-add-test">Determining the Executable or
Command to Run (tribits_add_test())</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">NOEXESUFFIX</span></code></p>
<blockquote>
<div><p>If specified, then the postfix
<code class="docutils literal notranslate"><span class="pre">${${PROJECT_NAME}_CMAKE_EXECUTABLE_SUFFIX}</span></code> is assumed <strong>not</strong> to be
post-pended to <code class="docutils literal notranslate"><span class="pre">&lt;exeRootName&gt;</span></code> (except on Windows platforms, see
<a class="reference internal" href="#determining-the-executable-or-command-to-run-tribits-add-test">Determining the Executable or Command to Run (tribits_add_test())</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">NAME</span> <span class="pre">&lt;testRootName&gt;</span></code></p>
<blockquote>
<div><p>If specified, gives the root name of the test.  If not specified, then
<code class="docutils literal notranslate"><span class="pre">&lt;testRootName&gt;</span></code> is taken to be <code class="docutils literal notranslate"><span class="pre">&lt;exeRootName&gt;</span></code>.  The actual test
name passed to <code class="docutils literal notranslate"><span class="pre">add_test()</span></code> will always be prefixed as
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_&lt;testRootName&gt;</span></code>.  The main purpose of this argument
is to allow multiple tests to be defined for the same executable.  CTest
requires all test names to be globally unique in a single project.  See
<a class="reference internal" href="#determining-the-full-test-name-tribits-add-test">Determining the Full Test Name (tribits_add_test())</a>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">NAME_POSTFIX</span> <span class="pre">&lt;testNamePostfix&gt;</span></code></p>
<blockquote>
<div><p>If specified, gives a postfix that will be added to the standard test
name based on <code class="docutils literal notranslate"><span class="pre">&lt;exeRootName&gt;</span></code> (appended as <code class="docutils literal notranslate"><span class="pre">_&lt;NAME_POSTFIX&gt;</span></code>).  If
the <code class="docutils literal notranslate"><span class="pre">NAME</span> <span class="pre">&lt;testRootName&gt;</span></code> argument is given, this argument is ignored.
See <a class="reference internal" href="#determining-the-full-test-name-tribits-add-test">Determining the Full Test Name (tribits_add_test())</a>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">DIRECTORY</span> <span class="pre">&lt;dir&gt;</span></code></p>
<blockquote>
<div><p>If specified, then the executable is assumed to be in the directory
given by <code class="docutils literal notranslate"><span class="pre">&lt;dir&gt;</span></code>.  The directory <code class="docutils literal notranslate"><span class="pre">&lt;dir&gt;</span></code> can either be a relative or
absolute path.  If not specified, the executable is assumed to be in the
current binary directory <code class="docutils literal notranslate"><span class="pre">${CMAKE_CURRENT_BINARY_DIR}</span></code>.  See
<a class="reference internal" href="#determining-the-executable-or-command-to-run-tribits-add-test">Determining the Executable or Command to Run (tribits_add_test())</a>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">ADD_DIR_TO_NAME</span></code></p>
<blockquote>
<div><p>If specified, then the directory name that this test resides in will be
added into the name of the test after the package name is added and
before the root test name (see <a class="reference internal" href="#determining-the-full-test-name-tribits-add-test">Determining the Full Test Name
(tribits_add_test())</a>).  The directory name will have the package’s
base directory stripped off so only the unique part of the test
directory will be used.  All directory separators <code class="docutils literal notranslate"><span class="pre">&quot;/&quot;</span></code> will be
changed into underscores <code class="docutils literal notranslate"><span class="pre">&quot;_&quot;</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">RUN_SERIAL</span></code></p>
<blockquote>
<div><p>If specified, then no other tests will be allowed to run while this test
is running. This is useful for devices (like CUDA GPUs) that require
exclusive access for processes/threads.  This just sets the CTest test
property <code class="docutils literal notranslate"><span class="pre">RUN_SERIAL</span></code> using the built-in CMake function
<code class="docutils literal notranslate"><span class="pre">set_tests_properties()</span></code>.  Also, the addition of the <code class="docutils literal notranslate"><span class="pre">RUN_SERIAL</span></code>
test property can be triggered by (the user) setting the global cache
variable <code class="docutils literal notranslate"><span class="pre">&lt;fullTestName&gt;_SET_RUN_SERIAL=ON</span></code>.  NOTE: If <code class="docutils literal notranslate"><span class="pre">RUN_SERIAL</span></code>
is passed in but <code class="docutils literal notranslate"><span class="pre">&lt;fullTestName&gt;_SET_RUN_SERIAL=OFF</span></code> (or any value
evaluating to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>), then the <code class="docutils literal notranslate"><span class="pre">RUN_SERIAL</span></code> test property will
<strong>NOT</strong> be set on the added test(s).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">ARGS</span> <span class="pre">&quot;&lt;arg0&gt;</span> <span class="pre">&lt;arg1&gt;</span> <span class="pre">...&quot;</span> <span class="pre">&quot;&lt;arg2&gt;</span> <span class="pre">&lt;arg3&gt;</span> <span class="pre">...&quot;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>If specified, then a set of arguments can be passed in quotes.  If
multiple groups of arguments are passed in different quoted clusters of
arguments then a different test will be added for each set of arguments.
In this way, many different tests can be added for a single executable
in a single call to this function.  Each of these separate tests will be
named <code class="docutils literal notranslate"><span class="pre">&lt;fullTestName&gt;_xy</span></code> where <code class="docutils literal notranslate"><span class="pre">xy</span></code> = <code class="docutils literal notranslate"><span class="pre">00</span></code>, <code class="docutils literal notranslate"><span class="pre">01</span></code>, <code class="docutils literal notranslate"><span class="pre">02</span></code>, and so
on.  <strong>WARNING:</strong> When defining multiple tests it is preferred to use the
<code class="docutils literal notranslate"><span class="pre">POSTFIX_AND_ARGS_&lt;IDX&gt;</span></code> form instead.  <strong>WARNING:</strong> Multiple
arguments passed to a single test invocation must be quoted or multiple
tests taking single arguments will be created instead!  See <a class="reference internal" href="#adding-multiple-tests-tribits-add-test">Adding
Multiple Tests (tribits_add_test())</a> for more details and examples.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">POSTFIX_AND_ARGS_&lt;IDX&gt;</span> <span class="pre">&lt;postfix&gt;</span> <span class="pre">&lt;arg0&gt;</span> <span class="pre">&lt;arg1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>If specified, gives a sequence of sets of test postfix names and
arguments lists for different tests (up to <code class="docutils literal notranslate"><span class="pre">POSTFIX_AND_ARGS_19</span></code>).
For example, a set of three different tests with argument lists can be
specified as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POSTIFX_AND_ARGS_0</span> <span class="n">postfix0</span> <span class="o">--</span><span class="n">arg1</span> <span class="o">--</span><span class="n">arg2</span><span class="o">=</span><span class="n">dummy</span>
<span class="n">POSTIFX_AND_ARGS_1</span> <span class="n">postfix1</span>  <span class="o">--</span><span class="n">arg2</span><span class="o">=</span><span class="n">fly</span>
<span class="n">POSTIFX_AND_ARGS_2</span> <span class="n">postfix2</span>  <span class="o">--</span><span class="n">arg2</span><span class="o">=</span><span class="n">bags</span>
</pre></div>
</div>
<p>This will create three different test cases with the postfix names
<code class="docutils literal notranslate"><span class="pre">postfix0</span></code>, <code class="docutils literal notranslate"><span class="pre">postfix1</span></code>, and <code class="docutils literal notranslate"><span class="pre">postfix2</span></code>.  The indexes must be
consecutive starting a <code class="docutils literal notranslate"><span class="pre">0</span></code> and going up to (currently) <code class="docutils literal notranslate"><span class="pre">19</span></code>.  The
main advantages of using these arguments instead of just <code class="docutils literal notranslate"><span class="pre">ARGS</span></code> are
that one can give a meaningful name to each test case and one can
specify multiple arguments without having to quote them and one can
allow long argument lists to span multiple lines.  See <a class="reference internal" href="#adding-multiple-tests-tribits-add-test">Adding Multiple
Tests (tribits_add_test())</a> for more details and examples.</p>
<p>Note that one of the <cite>&lt;postfix&gt;</cite> arguments can be empty, in which case
the base test name is not appended so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POSTIFX_AND_ARGS_0</span> <span class="s2">&quot;&quot;</span> <span class="o">--</span><span class="n">arg1</span> <span class="o">--</span><span class="n">arg2</span><span class="o">=</span><span class="n">dummy</span>
</pre></div>
</div>
<p>would create one test without appending the test name.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">COMM</span> <span class="pre">[serial]</span> <span class="pre">[mpi]</span></code></p>
<blockquote>
<div><p>If specified, determines if the test will be added in serial and/or MPI
mode.  If the <code class="docutils literal notranslate"><span class="pre">COMM</span></code> argument is missing, the test will be added in
both serial and MPI builds of the code.  That is if <code class="docutils literal notranslate"><span class="pre">COMM</span> <span class="pre">mpi</span></code> is
passed in, then the test will <strong>not</strong> be added if
<code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_MPI=OFF</span></code>.  Likewise, if <code class="docutils literal notranslate"><span class="pre">COMM</span> <span class="pre">serial</span></code> is passed in, then
the test will <strong>not</strong> be added if <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_MPI=ON</span></code>.  If <code class="docutils literal notranslate"><span class="pre">COMM</span>
<span class="pre">serial</span> <span class="pre">mpi</span></code> or <code class="docutils literal notranslate"><span class="pre">COMM</span> <span class="pre">mpi</span> <span class="pre">serial</span></code> is passed in, then the value of
<code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_MPI</span></code> does not determine if the test is added or not.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">NUM_MPI_PROCS</span> <span class="pre">&lt;numMpiProcs&gt;</span></code></p>
<blockquote>
<div><p>If specified, gives the number of MPI processes used to run the test
with the MPI exec program <code class="docutils literal notranslate"><span class="pre">${MPI_EXEC}</span></code>.  If <code class="docutils literal notranslate"><span class="pre">&lt;numMpiProcs&gt;</span></code> is
greater than <code class="docutils literal notranslate"><span class="pre">${MPI_EXEC_MAX_NUMPROCS}</span></code> then the test will be
excluded.  If not specified, then the default number of processes for an
MPI build (i.e. <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_MPI=ON</span></code>) will be
<code class="docutils literal notranslate"><span class="pre">${MPI_EXEC_DEFAULT_NUMPROCS}</span></code>.  For serial builds
(i.e. <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_MPI=OFF</span></code>), passing in a value <code class="docutils literal notranslate"><span class="pre">&lt;numMpiProcs&gt;</span></code> &gt;
<code class="docutils literal notranslate"><span class="pre">1</span></code> will cause the test to not be added.  The value <code class="docutils literal notranslate"><span class="pre">&lt;numMpiProcs&gt;</span></code>
will also be set as the built-in test property <code class="docutils literal notranslate"><span class="pre">PROCESSORS</span></code> if
<code class="docutils literal notranslate"><span class="pre">NUM_TOTAL_CORES_USED</span></code> is not specified.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">NUM_TOTAL_CORES_USED</span> <span class="pre">&lt;numTotalCoresUsed&gt;</span></code></p>
<blockquote>
<div><p>If specified, gives the total number of processes or cores that is
reported to CTest as the built-in CTest <code class="docutils literal notranslate"><span class="pre">PROCESSORS</span></code> property.  If
this is not specified, then <code class="docutils literal notranslate"><span class="pre">PROCESSORS</span></code> is specified by the argument
<code class="docutils literal notranslate"><span class="pre">NUM_MPI_PROCS</span> <span class="pre">&lt;numMpiProcs&gt;</span></code>.  This argument is used for test
scripts/executables that use more cores than MPI processes
(i.e. <code class="docutils literal notranslate"><span class="pre">&lt;numMpiProcs&gt;</span></code>) and its only purpose is to inform CTest and
TriBITS of the maximum number of processes or cores that are used by the
underlying test executable/script.  When specified, if
<code class="docutils literal notranslate"><span class="pre">&lt;numTotalCoresUsed&gt;</span></code> is greater than <code class="docutils literal notranslate"><span class="pre">${MPI_EXEC_MAX_NUMPROCS}</span></code>,
then the test will not be added.  Otherwise, the CTest property
<code class="docutils literal notranslate"><span class="pre">PROCESSORS</span></code> is set to <code class="docutils literal notranslate"><span class="pre">&lt;numTotalCoresUsed&gt;</span></code> so that CTest knows how
to best schedule the test w.r.t. other tests on a given number of
available processes.  See <a class="reference internal" href="#running-multiple-tests-at-the-same-time-tribits-add-test">Running multiple tests at the same time
(tribits_add_test())</a>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">CATEGORIES</span> <span class="pre">&lt;category0&gt;</span> <span class="pre">&lt;category1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>If specified, gives the specific categories of the test.  Valid test
categories include <code class="docutils literal notranslate"><span class="pre">BASIC</span></code>, <code class="docutils literal notranslate"><span class="pre">CONTINUOUS</span></code>, <code class="docutils literal notranslate"><span class="pre">NIGHTLY</span></code>, <code class="docutils literal notranslate"><span class="pre">HEAVY</span></code>
and <code class="docutils literal notranslate"><span class="pre">PERFORMANCE</span></code>.  If not specified, the default category is
<code class="docutils literal notranslate"><span class="pre">BASIC</span></code>.  When the test category does not match
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TEST_CATEGORIES</span></code>, then the test is <strong>not</strong> added.
When <code class="docutils literal notranslate"><span class="pre">CATEGORIES</span></code> contains <code class="docutils literal notranslate"><span class="pre">BASIC</span></code> it will match
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TEST_CATEGORIES</span></code> equal to <code class="docutils literal notranslate"><span class="pre">CONTINUOUS</span></code>,
<code class="docutils literal notranslate"><span class="pre">NIGHTLY</span></code>, and <code class="docutils literal notranslate"><span class="pre">HEAVY</span></code>.  When <code class="docutils literal notranslate"><span class="pre">CATEGORIES</span></code> contains
<code class="docutils literal notranslate"><span class="pre">CONTINUOUS</span></code> it will match <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TEST_CATEGORIES</span></code> equal
to <code class="docutils literal notranslate"><span class="pre">CONTINUOUS</span></code>, <code class="docutils literal notranslate"><span class="pre">NIGHTLY</span></code>, and <code class="docutils literal notranslate"><span class="pre">HEAVY</span></code>.  When <code class="docutils literal notranslate"><span class="pre">CATEGORIES</span></code>
contains <code class="docutils literal notranslate"><span class="pre">NIGHTLY</span></code> it will match <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TEST_CATEGORIES</span></code>
equal to <code class="docutils literal notranslate"><span class="pre">NIGHTLY</span></code> and <code class="docutils literal notranslate"><span class="pre">HEAVY</span></code>.  When <code class="docutils literal notranslate"><span class="pre">CATEGORIES</span></code> contains
<code class="docutils literal notranslate"><span class="pre">PERFORMANCE</span></code> it will match
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TEST_CATEGORIES=PERFORMANCE</span></code> only.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">HOST</span> <span class="pre">&lt;host0&gt;</span> <span class="pre">&lt;host1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>If specified, gives a list of hostnames where the test will be included.
The current hostname is determined by the built-in CMake command
<code class="docutils literal notranslate"><span class="pre">site_name(${PROJECT_NAME}_HOSTNAME)</span></code>.  On Linux/Unix systems, this is
typically the value returned by <code class="docutils literal notranslate"><span class="pre">uname</span> <span class="pre">-n</span></code>.  If this list is given,
the value of <code class="docutils literal notranslate"><span class="pre">${${PROJECT_NAME}_HOSTNAME}</span></code> must equal one of the
listed host names <code class="docutils literal notranslate"><span class="pre">&lt;hosti&gt;</span></code> or test will <strong>not</strong> be added.  The value
of <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_HOSTNAME</span></code> gets printed out in the TriBITS cmake
output under the section <code class="docutils literal notranslate"><span class="pre">Probing</span> <span class="pre">the</span> <span class="pre">environment</span></code> (see <a class="reference internal" href="#full-processing-of-tribits-project-files">Full
Processing of TriBITS Project Files</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">XHOST</span> <span class="pre">&lt;host0&gt;</span> <span class="pre">&lt;host1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>If specified, gives a list of hostnames (see <code class="docutils literal notranslate"><span class="pre">HOST</span></code> argument) on which
the test will <strong>not</strong> be added.  This check is performed after the check
for the hostnames in the <code class="docutils literal notranslate"><span class="pre">HOST</span></code> list if it should exist.  Therefore,
this exclusion list overrides the <code class="docutils literal notranslate"><span class="pre">HOST</span></code> inclusion list.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">HOSTTYPE</span> <span class="pre">&lt;hosttype0&gt;</span> <span class="pre">&lt;hosttype1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>If specified, gives the names of the host system type (given by the
built-in CMake cache variable <code class="docutils literal notranslate"><span class="pre">CMAKE_HOST_SYSTEM_NAME</span></code> which is
printed in the TriBITS cmake configure output in the section <code class="docutils literal notranslate"><span class="pre">Probing</span>
<span class="pre">the</span> <span class="pre">environment</span></code>) for which the test is allowed to be added.  If
<code class="docutils literal notranslate"><span class="pre">HOSTTYPE</span></code> is specified and <code class="docutils literal notranslate"><span class="pre">CMAKE_HOST_SYSTEM_NAME</span></code> is not equal to
one of the values of <code class="docutils literal notranslate"><span class="pre">&lt;hosttypei&gt;</span></code>, then the test will <strong>not</strong> be
added.  Typical host system type names include <code class="docutils literal notranslate"><span class="pre">Linux</span></code>, <code class="docutils literal notranslate"><span class="pre">Darwin</span></code>,
<code class="docutils literal notranslate"><span class="pre">Windows</span></code>, etc.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">XHOSTTYPE</span> <span class="pre">&lt;hosttype0&gt;</span> <span class="pre">&lt;hosttype1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>If specified, gives the names of the host system type (see the
<code class="docutils literal notranslate"><span class="pre">HOSTTYPE</span></code> argument above) for which <strong>not</strong> to include the test on.
This check is performed after the check for the host system names in the
<code class="docutils literal notranslate"><span class="pre">HOSTTYPE</span></code> list if it should exist.  Therefore, this exclusion list
overrides the <code class="docutils literal notranslate"><span class="pre">HOSTTYPE</span></code> inclusion list.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">EXCLUDE_IF_NOT_TRUE</span> <span class="pre">&lt;varname0&gt;</span> <span class="pre">&lt;varname1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>If specified, gives the names of CMake variables that must evaluate to
true, or the test will not be added.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">DISABLED</span> <span class="pre">&lt;messageWhyDisabled&gt;</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">&lt;messageWhyDisabled&gt;</span></code> is non-empty and does not evaluate to FALSE,
then the test will be added by <code class="docutils literal notranslate"><span class="pre">add_test()</span></code> (so CTest will see it) but
the ctest test property <code class="docutils literal notranslate"><span class="pre">DISABLED</span></code> will be set.  Therefore, CTest will
not run the test and will instead list it as “Not Run” when tests are
run locally and when submitting test results to CDash (with test details
“Not Run (Disabled)”).  Also, the message <code class="docutils literal notranslate"><span class="pre">&lt;messageWhyDisabled&gt;</span></code> will
be printed to STDOUT by cmake after the line stating the test was added
when <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TRACE_ADD_TEST=ON</span></code> is set.  If
<code class="docutils literal notranslate"><span class="pre">&lt;messageWhyDisabled&gt;</span></code> evaluates to FALSE in CMake (e.g. “FALSE”,
“false”, “NO”, “no”, “0”, “”, etc.), then the <code class="docutils literal notranslate"><span class="pre">DISABLED</span></code> property will
not be set.  This property can also be set with the CMake cache var <code class="docutils literal notranslate"><span class="pre">-D</span>
<span class="pre">&lt;fullTestName&gt;_SET_DISABLED_AND_MSG=&quot;&lt;msgSetByVar&gt;&quot;</span></code> and in fact that
var will override the value of <code class="docutils literal notranslate"><span class="pre">&lt;messageWhyDisabled&gt;</span></code> passed in here
(if <code class="docutils literal notranslate"><span class="pre">&lt;msgSetByVar&gt;</span></code> is non-empty).  This allows a user to enable tests
that are disabled in the CMakeList.txt files using this input.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">STANDARD_PASS_OUTPUT</span></code></p>
<blockquote>
<div><p>If specified, then the standard test output string <code class="docutils literal notranslate"><span class="pre">End</span> <span class="pre">Result:</span> <span class="pre">TEST</span>
<span class="pre">PASSED</span></code> is grepped in the test stdout for to determine success.  This
is needed for MPI tests on some platforms since the return value from
MPI executables is unreliable.  This is set using the built-in CTest
property <code class="docutils literal notranslate"><span class="pre">PASS_REGULAR_EXPRESSION</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">PASS_REGULAR_EXPRESSION</span> <span class="pre">&quot;&lt;regex0&gt;&quot;</span> <span class="pre">&quot;&lt;regex1&gt;&quot;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>If specified, then the test will be assumed to pass only if one of the
regular expressions <code class="docutils literal notranslate"><span class="pre">&lt;regex0&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;regex1&gt;</span></code> etc. match the output
send to stdout.  Otherwise, the test will fail.  This is set using the
built-in CTest property <code class="docutils literal notranslate"><span class="pre">PASS_REGULAR_EXPRESSION</span></code>.  Consult standard
CMake documentation for full behavior.  TIPS: Replace ‘;’ with ‘[;]’ or
CMake will interpret this as an array element boundary.  To match ‘.’,
use ‘[.]’.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">FAIL_REGULAR_EXPRESSION</span> <span class="pre">&quot;&lt;regex0&gt;&quot;</span> <span class="pre">&quot;&lt;regex1&gt;&quot;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>If specified, then a test will be assumed to fail if one of the regular
expressions <code class="docutils literal notranslate"><span class="pre">&lt;regex0&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;regex1&gt;</span></code> etc. match the output send to
stdout.  Otherwise, the test will pass.  This is set using the built-in
CTest property <code class="docutils literal notranslate"><span class="pre">FAIL_REGULAR_EXPRESSION</span></code>.  Consult standard CMake
documentation for full behavior (and see above tips for
<code class="docutils literal notranslate"><span class="pre">PASS_REGULAR_EXPRESSION</span></code>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">WILL_FAIL</span></code></p>
<blockquote>
<div><p>If passed in, then the pass/fail criteria will be inverted.  This is set
using the built-in CTest property <code class="docutils literal notranslate"><span class="pre">WILL_FAIL</span></code>.  Consult standard CMake
documentation for full behavior.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">ENVIRONMENT</span> <span class="pre">&quot;&lt;var1&gt;=&lt;value1&gt;&quot;</span> <span class="pre">&quot;&lt;var2&gt;=&lt;value2&gt;&quot;</span> <span class="pre">...</span></code>.</p>
<blockquote>
<div><p>If passed in, the listed environment variables will be set by CTest
before calling the test.  This is set using the built-in CTest test
property <code class="docutils literal notranslate"><span class="pre">ENVIRONMENT</span></code>.  Note, if the env var values contain
semi-colons <code class="docutils literal notranslate"><span class="pre">';'</span></code>, then replace the semi-colons <code class="docutils literal notranslate"><span class="pre">';'</span></code> with another
separator <code class="docutils literal notranslate"><span class="pre">'&lt;sep&gt;'</span></code> and pass in <code class="docutils literal notranslate"><span class="pre">LIST_SEPARATOR</span> <span class="pre">&lt;sep&gt;</span></code> so <code class="docutils literal notranslate"><span class="pre">&lt;sep&gt;</span></code>
will be replaced with <code class="docutils literal notranslate"><span class="pre">';'</span></code> at point of usage.  If the env var values
contain any spaces, also quote the entire variable/value pair as
<code class="docutils literal notranslate"><span class="pre">&quot;&lt;vari&gt;=&lt;valuei&gt;&quot;</span></code>.  For example, the env var and value
<code class="docutils literal notranslate"><span class="pre">my_env_var=&quot;arg1</span> <span class="pre">b;arg2;I</span> <span class="pre">have</span> <span class="pre">spaces&quot;</span></code> would need to be passed as
<code class="docutils literal notranslate"><span class="pre">&quot;my_env_var=arg1</span> <span class="pre">b&lt;sep&gt;arg2&lt;sep&gt;I</span> <span class="pre">have</span> <span class="pre">spaces&quot;</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">TIMEOUT</span> <span class="pre">&lt;maxSeconds&gt;</span></code></p>
<blockquote>
<div><p>If passed in, gives maximum number of seconds the test will be allowed
to run before being timed-out and killed.  This sets the CTest property
<code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code>.  The value <code class="docutils literal notranslate"><span class="pre">&lt;maxSeconds&gt;</span></code> will be scaled by the value of
<a class="reference external" href="TribitsBuildReference.html#project-scale-test-timeout-testing-timeout">${PROJECT_NAME}_SCALE_TEST_TIMEOUT</a>.  See <a class="reference internal" href="#setting-timeouts-for-tests-tribits-add-test">Setting timeouts for tests
(tribits_add_test())</a> for more details.</p>
<p><strong>WARNING:</strong> Rather than just increasing the timeout for an expensive
test, please try to either make the test run faster or relegate the test
to being run less often (i.e. set <code class="docutils literal notranslate"><span class="pre">CATEGORIES</span> <span class="pre">NIGHTLY</span></code> or even
<code class="docutils literal notranslate"><span class="pre">HEAVY</span></code> for extremely expensive tests).  Expensive tests are one of
the worse forms of technical debt that a project can have!</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">LIST_SEPARATOR</span> <span class="pre">&lt;sep&gt;</span></code></p>
<blockquote>
<div><p>String used as placeholder for the semi-colon char <code class="docutils literal notranslate"><span class="pre">';'</span></code> in order to
allow pass-through.  For example, if arguments to the <code class="docutils literal notranslate"><span class="pre">ARGS</span></code> or
<code class="docutils literal notranslate"><span class="pre">ENVIRONMENT</span></code> need to use semi-colons, then replace <code class="docutils literal notranslate"><span class="pre">';'</span></code> with
<code class="docutils literal notranslate"><span class="pre">'&lt;semicolon&gt;'</span></code> (for example) such as with
<code class="docutils literal notranslate"><span class="pre">&quot;somearg=arg1&lt;semicolon&gt;arg2&quot;</span></code>, then at the point of usage,
<code class="docutils literal notranslate"><span class="pre">'&lt;semicolon&gt;'</span></code> will be replaced with <code class="docutils literal notranslate"><span class="pre">';'</span></code> and it will be passed to
the final command as <code class="docutils literal notranslate"><span class="pre">&quot;somearg=arg1;arg2&quot;</span></code> (with as many preceding
escape backslashes <code class="docutils literal notranslate"><span class="pre">'\'</span></code> in front of <code class="docutils literal notranslate"><span class="pre">';'</span></code> as is needed for the
given usage context).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">ADDED_TESTS_NAMES_OUT</span> <span class="pre">&lt;testsNames&gt;</span></code></p>
<blockquote>
<div><p>If specified, then on output the variable <code class="docutils literal notranslate"><span class="pre">&lt;testsNames&gt;</span></code> will be set
with the name(S) of the tests passed to <code class="docutils literal notranslate"><span class="pre">add_test()</span></code>.  If more than
one test is added, then this will be a list of test names.  Having this
name allows the calling <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file access and set
additional test properties (see <a class="reference internal" href="#setting-additional-test-properties-tribits-add-test">Setting additional test properties
(tribits_add_test())</a>).</p>
</div></blockquote>
</div></blockquote>
<p>In the end, this function just calls the built-in CMake commands
<code class="docutils literal notranslate"><span class="pre">add_test(${TEST_NAME}</span> <span class="pre">...)</span></code> and <code class="docutils literal notranslate"><span class="pre">set_tests_properties(${TEST_NAME}</span>
<span class="pre">...)</span></code> to set up a executable process for <code class="docutils literal notranslate"><span class="pre">ctest</span></code> to run, determine
pass/fail criteria, and set some other test properties.  Therefore, this
wrapper function does not provide any fundamentally new features that are
not already available in the basic usage if CMake/CTest.  However, this
wrapper function takes care of many of the details and boiler-plate CMake
code that it takes to add such a test (or tests) and enforces consistency
across a large project for how tests are defined, run, and named (to avoid
test name clashes).</p>
<p>If more flexibility or control is needed when defining tests, then the
function <a class="reference internal" href="#tribits-add-advanced-test">tribits_add_advanced_test()</a> should be used instead.</p>
<p>In the following subsections, more details on how tests are defined and run
is given.</p>
<p id="determining-the-executable-or-command-to-run-tribits-add-test"><strong>Determining the Executable or Command to Run (tribits_add_test())</strong></p>
<p>This function is primarily designed to make it easy to run tests for
executables built using the function <a class="reference internal" href="#tribits-add-executable">tribits_add_executable()</a>.  To set up
tests to run arbitrary executables, see below.</p>
<p>By default, the executable to run is determined by first getting the
executable name which by default is assumed to be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;fullExeName&gt; =
  ${PACKAGE_NAME}_&lt;exeRootName&gt;${${PROJECT_NAME}_CMAKE_EXECUTABLE_SUFFIX}
</pre></div>
</div>
<p>which is (by no coincidence) identical to how it is selected in
<a class="reference internal" href="#tribits-add-executable">tribits_add_executable()</a> (see <a class="reference internal" href="#executable-and-target-name-tribits-add-executable">Executable and Target Name
(tribits_add_executable())</a>).  This name can be altered by passing in
<code class="docutils literal notranslate"><span class="pre">NOEXEPREFIX</span></code>, <code class="docutils literal notranslate"><span class="pre">NOEXESUFFIX</span></code>, and <code class="docutils literal notranslate"><span class="pre">ADD_DIR_TO_NAME</span></code> as described in
<a class="reference internal" href="#executable-and-target-name-tribits-add-executable">Executable and Target Name (tribits_add_executable())</a>.</p>
<p>By default, this executable is assumed to be in the current CMake binary
directory <code class="docutils literal notranslate"><span class="pre">${CMAKE_CURRENT_BINARY_DIR}</span></code> but the directory location can be
changed using the <code class="docutils literal notranslate"><span class="pre">DIRECTORY</span> <span class="pre">&lt;dir&gt;</span></code> argument.</p>
<p>If an arbitrary executable is to be run (i.e. not build inside of the
project), then pass in <code class="docutils literal notranslate"><span class="pre">NOEXEPREFIX</span></code> and <code class="docutils literal notranslate"><span class="pre">NOEXESUFFIX</span></code> and set
<code class="docutils literal notranslate"><span class="pre">&lt;exeRootName&gt;</span></code> to the relative or absolute path of the executable to be
run.  If <code class="docutils literal notranslate"><span class="pre">&lt;exeRootName&gt;</span></code> is not an absolute path, then
<code class="docutils literal notranslate"><span class="pre">${CMAKE_CURRENT_BINARY_DIR}/&lt;exeRootName&gt;</span></code> is set as the executable to
run in this case.</p>
<p>NOTE: On native Windows platforms, the <code class="docutils literal notranslate"><span class="pre">NOEXESUFFIX</span></code> will still allow
CTest to run executables that have the <code class="docutils literal notranslate"><span class="pre">*.exe</span></code> suffix.</p>
<p>Whatever executable path is specified using this logic, if the executable is
not found, then when <code class="docutils literal notranslate"><span class="pre">ctest</span></code> goes to run the test, it will mark it as
<code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">RUN</span></code>.</p>
<p id="determining-the-full-test-name-tribits-add-test"><strong>Determining the Full Test Name (tribits_add_test())</strong></p>
<p>By default, the base test name is selected to be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;fullTestName&gt; = ${PACKAGE_NAME}_&lt;exeRootName&gt;
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">NAME</span> <span class="pre">&lt;testRootName&gt;</span></code> is passed in, then <code class="docutils literal notranslate"><span class="pre">&lt;testRootName&gt;</span></code> is used
instead of <code class="docutils literal notranslate"><span class="pre">&lt;exeRootName&gt;</span></code> above.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">NAME_POSTFIX</span> <span class="pre">&lt;testNamePostfix&gt;</span></code> is passed in, then the base test name
is selected to be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;fullTestName&gt; = ${PACKAGE_NAME}_&lt;exeRootName&gt;_&lt;testNamePostfix&gt;
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">ADD_DIR_TO_NAME</span></code> is passed in, then the directory name relative to the
package base directory is added to the name as well to help disambiguate the
test name (see the above).</p>
<p>Let the test name determined as described above be <code class="docutils literal notranslate"><span class="pre">&lt;fullTestName&gt;</span></code>.  If
no arguments or only a single set of arguments are passed in through
<code class="docutils literal notranslate"><span class="pre">ARGS</span></code>, then this is the test name actually passed in to <code class="docutils literal notranslate"><span class="pre">add_test()</span></code>.
If multiple tests are defined, then this name becomes the base test name for
each of the tests (see <a class="reference internal" href="#adding-multiple-tests-tribits-add-test">Adding Multiple Tests (tribits_add_test())</a>).</p>
<p>Finally, for any test that gets defined, if MPI is enabled
(i.e. <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_MPI=ON</span></code>), then the terminal suffix
<code class="docutils literal notranslate"><span class="pre">_MPI_${NUM_MPI_PROCS}</span></code> will be added to the end of the test name (even
for multiple tests).  No such prefix is added for the serial case
(i.e. <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_MPI=OFF</span></code>).</p>
<p id="adding-multiple-tests-tribits-add-test"><strong>Adding Multiple Tests  (tribits_add_test())</strong></p>
<p>Using this function, one can add executable arguments and can even add
multiple tests in one of two ways.  One can either pass in one or more
<strong>quoted</strong> clusters of arguments using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ARGS</span> <span class="s2">&quot;&lt;arg0&gt; &lt;arg1&gt; ...&quot;</span> <span class="s2">&quot;&lt;arg2&gt; &lt;arg3&gt; ...&quot;</span> <span class="o">...</span>
</pre></div>
</div>
<p>or can pass in an explicit test name postfix and arguments with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POSTFIX_AND_ARGS_0</span> <span class="o">&lt;</span><span class="n">postfix0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">arg0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">arg1</span><span class="o">&gt;</span> <span class="o">...</span>
<span class="n">POSTFIX_AND_ARGS_1</span> <span class="o">&lt;</span><span class="n">postfix1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">arg2</span><span class="o">&gt;</span> <span class="o">...</span>
<span class="o">...</span>
</pre></div>
</div>
<p>If only one short set of arguments needs to be passed in, then passing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ARGS</span> <span class="s2">&quot;&lt;arg0&gt; &lt;arg1&gt;&quot;</span>
</pre></div>
</div>
<p>may be preferable since it will not add any postfix name to the test.  To
add more than one test case using <code class="docutils literal notranslate"><span class="pre">ARGS</span></code>, one will use more than one
quoted set of arguments such as with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ARGS</span> <span class="s2">&quot;&lt;arg0&gt; &lt;arg1&gt;&quot;</span> <span class="s2">&quot;&lt;arg2&gt; &lt;arg2&gt;&quot;</span>
</pre></div>
</div>
<p>which creates 2 tests with the names <code class="docutils literal notranslate"><span class="pre">&lt;fullTestName&gt;_00</span></code> passing
arguments <code class="docutils literal notranslate"><span class="pre">&quot;&lt;arg0&gt;</span> <span class="pre">&lt;arg1&gt;&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;fullTestName&gt;_01</span></code> passing arguments
<code class="docutils literal notranslate"><span class="pre">&quot;&lt;arg2&gt;</span> <span class="pre">&lt;arg3&gt;&quot;</span></code>.  However, when passing multiple sets of arguments it is
preferable to <strong>not</strong> use <code class="docutils literal notranslate"><span class="pre">ARGS</span></code> but instead use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POSTFIX_AND_ARGS_0</span> <span class="n">test_a</span> <span class="o">&lt;</span><span class="n">arg0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">arg1</span><span class="o">&gt;</span>
<span class="n">POSTFIX_AND_ARGS_1</span> <span class="n">test_b</span> <span class="o">&lt;</span><span class="n">arg2</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">arg2</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>which also creates the same 2 tests but now with the improved names
<code class="docutils literal notranslate"><span class="pre">&lt;fullTestName&gt;_test_a</span></code> passing arguments <code class="docutils literal notranslate"><span class="pre">&quot;&lt;arg0&gt;</span> <span class="pre">&lt;arg1&gt;&quot;</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;fullTestName&gt;_test_b</span></code> passing arguments <code class="docutils literal notranslate"><span class="pre">&quot;&lt;arg2&gt;</span> <span class="pre">&lt;arg3&gt;&quot;</span></code>.  In this way,
the individual tests can be given more understandable names.</p>
<p>The other advantage of the <code class="docutils literal notranslate"><span class="pre">POSTFIX_AND_ARGS_&lt;IDX&gt;</span></code> form is that the
arguments <code class="docutils literal notranslate"><span class="pre">&lt;arg0&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;arg1&gt;</span></code>, … do not need to be quoted and can
therefore be extended over multiple lines like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">POSTFIX_AND_ARGS_0</span> <span class="n">long_args</span> <span class="o">--</span><span class="n">this</span><span class="o">-</span><span class="ow">is</span><span class="o">-</span><span class="n">the</span><span class="o">-</span><span class="n">first</span><span class="o">-</span><span class="n">long</span><span class="o">-</span><span class="n">arg</span><span class="o">=</span><span class="n">very</span>
  <span class="o">--</span><span class="n">this</span><span class="o">-</span><span class="ow">is</span><span class="o">-</span><span class="n">the</span><span class="o">-</span><span class="n">second</span><span class="o">-</span><span class="n">long</span><span class="o">-</span><span class="n">arg</span><span class="o">=</span><span class="n">verylong</span>
</pre></div>
</div>
<p>If one does not use quotes when using <code class="docutils literal notranslate"><span class="pre">ARGS</span></code> one will actually get more
than one test.  For example, if one passes in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ARGS</span> <span class="o">--</span><span class="n">this</span><span class="o">-</span><span class="ow">is</span><span class="o">-</span><span class="n">the</span><span class="o">-</span><span class="n">first</span><span class="o">-</span><span class="n">long</span><span class="o">-</span><span class="n">arg</span><span class="o">=</span><span class="n">very</span>
  <span class="o">--</span><span class="n">this</span><span class="o">-</span><span class="ow">is</span><span class="o">-</span><span class="n">the</span><span class="o">-</span><span class="n">second</span><span class="o">-</span><span class="n">long</span><span class="o">-</span><span class="n">arg</span><span class="o">=</span><span class="n">verylong</span>
</pre></div>
</div>
<p>one actually gets two tests, not one test.  This is a common mistake that
people make when using the <code class="docutils literal notranslate"><span class="pre">ARGS</span></code> form of passing arguments.  This can’t
be fixed or it will break backward compatibility.  If this could be designed
fresh, the <code class="docutils literal notranslate"><span class="pre">ARGS</span></code> argument would only create a single test and the
arguments would not be quoted.</p>
<p id="determining-pass-fail-tribits-add-test"><strong>Determining Pass/Fail (tribits_add_test())</strong></p>
<p>The only means to determine pass/fail is to use the built-in CTest
properties <code class="docutils literal notranslate"><span class="pre">PASS_REGULAR_EXPRESSION</span></code> and <code class="docutils literal notranslate"><span class="pre">FAIL_REGULAR_EXPRESSION</span></code> which
can only grep the test’s STDOUT/STDERR or to check for a 0 return value (or
invert these using <code class="docutils literal notranslate"><span class="pre">WILL_FAIL</span></code>).  For simple tests, that is enough.
However, for more complex executables, one may need to examine one or more
output files to determine pass/fail.  Raw CMake/CTest cannot do this.  In
this case, one should use <a class="reference internal" href="#tribits-add-advanced-test">tribits_add_advanced_test()</a> instead to add the
test.</p>
<p id="setting-additional-test-properties-tribits-add-test"><strong>Setting additional test properties (tribits_add_test())</strong></p>
<p>After this function returns, any tests that get added using <code class="docutils literal notranslate"><span class="pre">add_test()</span></code>
can have additional properties set and changed using
<code class="docutils literal notranslate"><span class="pre">set_tests_properties()</span></code>.  Therefore, any tests properties that are not
directly supported and passed through this wrapper function can be set in
the outer <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file after the call to <code class="docutils literal notranslate"><span class="pre">tribits_add_test()</span></code>.</p>
<p>If tests are added, then the names of those tests will be returned in the
variable <code class="docutils literal notranslate"><span class="pre">ADDED_TESTS_NAMES_OUT</span> <span class="pre">&lt;testsNames&gt;</span></code>.  This can be used, for
example, to override the <code class="docutils literal notranslate"><span class="pre">PROCESSORS</span></code> property for the tests with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>tribits_add_test( someTest ...
  ADDED_TESTS_NAMES_OUT  someTest_TEST_NAME )

if (someTest_TEST_NAME)
  set_tests_properties( ${someTest_TEST_NAME}
    PROPERTIES ATTACHED_FILES someTest.log )
endif()
</pre></div>
</div>
<p>where the test writes a log file <code class="docutils literal notranslate"><span class="pre">someTest.log</span></code> that we want to submit to
CDash also.</p>
<p>This approach will work no matter what TriBITS names the individual test(s)
or whether the test(s) are added or not (depending on other arguments like
<code class="docutils literal notranslate"><span class="pre">COMM</span></code>, <code class="docutils literal notranslate"><span class="pre">XHOST</span></code>, etc.).</p>
<p>The following built-in CTest test properties are set through <a class="reference internal" href="#formal-arguments-tribits-add-test">Formal
Arguments (tribits_add_test())</a> or are otherwise automatically set by this
function and should <strong>NOT</strong> be overridden by direct calls to
<code class="docutils literal notranslate"><span class="pre">set_tests_properties()</span></code>: <code class="docutils literal notranslate"><span class="pre">ENVIRONMENT</span></code>, <code class="docutils literal notranslate"><span class="pre">FAIL_REGULAR_EXPRESSION</span></code>,
<code class="docutils literal notranslate"><span class="pre">LABELS</span></code>, <code class="docutils literal notranslate"><span class="pre">PASS_REGULAR_EXPRESSION</span></code>, <code class="docutils literal notranslate"><span class="pre">RUN_SERIAL</span></code>, <code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code>, and
<code class="docutils literal notranslate"><span class="pre">WILL_FAIL</span></code>.</p>
<p>However, generally, other built-in CTest test properties can be set after
the test is added like show above.  Examples of test properties that can be
set using direct calls to <code class="docutils literal notranslate"><span class="pre">set_tests_properties()</span></code> include
<code class="docutils literal notranslate"><span class="pre">ATTACHED_FILES</span></code>, <code class="docutils literal notranslate"><span class="pre">ATTACHED_FILES_ON_FAIL</span></code>, <code class="docutils literal notranslate"><span class="pre">COST</span></code>, <code class="docutils literal notranslate"><span class="pre">DEPENDS</span></code>,
<code class="docutils literal notranslate"><span class="pre">MEASUREMENT</span></code>, <code class="docutils literal notranslate"><span class="pre">RESOURCE_LOCK</span></code> and <code class="docutils literal notranslate"><span class="pre">WORKING_DIRECTORY</span></code>.</p>
<p>For example, one can set a dependency between two tests using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>tribits_add_test( test_a [...]
   ADDED_TESTS_NAMES_OUT  test_a_TEST_NAME )

tribits_add_test( test_b [...]
   ADDED_TESTS_NAMES_OUT  test_z_TEST_NAME )

if (test_a_TEST_NAME AND test_b_TEST_NAME)
  set_tests_properties(${test_b_TEST_NAME}
    PROPERTIES DEPENDS ${test_a_TEST_NAME})
endif()
</pre></div>
</div>
<p>This ensures that test <code class="docutils literal notranslate"><span class="pre">test_b</span></code> will always be run after <code class="docutils literal notranslate"><span class="pre">test_a</span></code> if
both tests are run by CTest.</p>
<p id="running-multiple-tests-at-the-same-time-tribits-add-test"><strong>Running multiple tests at the same time (tribits_add_test())</strong></p>
<p>By default, CTest will run as many tests defined with <code class="docutils literal notranslate"><span class="pre">add_test()</span></code> at same
time as it can according to its parallel level (e.g. <code class="docutils literal notranslate"><span class="pre">'ctest</span> <span class="pre">-j&lt;N&gt;'</span></code> or
the CTest property <code class="docutils literal notranslate"><span class="pre">CTEST_PARALLEL_LEVEL</span></code>).  For example, when raw
<code class="docutils literal notranslate"><span class="pre">'ctest</span> <span class="pre">-j10'</span></code> is run, CTest will run multiple tests at the same time to
try to make usage of 10 processors/cores.  If all of the defined tests only
used one process (which is assumed by default except for MPI tests), then
CTest will run 10 tests at the same time and will launch new tests as
running tests finish.  One can also define tests which use more than one
process or use more cores than the number of MPI processes.  When passing in
<code class="docutils literal notranslate"><span class="pre">NUM_MPI_PROCS</span> <span class="pre">&lt;numMpiProcs&gt;</span></code> (see above), this TriBITS function will set the
built-in CTest property <code class="docutils literal notranslate"><span class="pre">PROCESSORS</span></code> to <code class="docutils literal notranslate"><span class="pre">&lt;numMpiProcs&gt;</span></code> using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">set_tests_properties</span><span class="p">(</span><span class="o">&lt;</span><span class="n">fullTestName</span><span class="o">&gt;</span> <span class="n">PROPERTIES</span> <span class="n">PROCESSORS</span> <span class="o">&lt;</span><span class="n">numMpiProcs</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>This tells CTest that the defined test uses <code class="docutils literal notranslate"><span class="pre">&lt;numMpiProcs&gt;</span></code> processes and
CTest will use that information to not exceed the requested parallel level.
For example, if several <code class="docutils literal notranslate"><span class="pre">NUM_MPI_PROCS</span> <span class="pre">3</span></code> tests are defined and CTest is
run with <code class="docutils literal notranslate"><span class="pre">'ctest</span> <span class="pre">-j12'</span></code>, then CTest would schedule and run 4 of these
tests at a time (to make use of 12 processors/cores on the machine),
starting new tests as running tests finish, until all of the tests have been
run.</p>
<p>There are some situations where a test will use more processes/cores than
specified by <code class="docutils literal notranslate"><span class="pre">NUM_MPI_PROCS</span> <span class="pre">&lt;numMpiProcs&gt;</span></code> such as when the underlying
executable fires off more processes in parallel to do processing.  Also, an
MPI program may use threading and therefore use overall more cores than the
number of MPI processes. For these cases, it is critical to set
<code class="docutils literal notranslate"><span class="pre">NUM_TOTAL_CORES_USED</span> <span class="pre">&lt;numTotalCoresUsed&gt;</span></code> to tell TriBITS and CTest how
many cores will be used by a threaded test.  This is needed to exclude the
test if there are too many processes/cores needed to run the test than are
available.  Also, if the test is added, then this is needed to set the
built-in CTest <code class="docutils literal notranslate"><span class="pre">PROCESSORS</span></code> property so CTest can avoid overloading the
machine.  For example, for test where the MPI executable running on 4
processes uses 10 threads per process, one would set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NUM_MPI_PROCS</span>  <span class="mi">4</span>  <span class="n">NUM_TOTAL_CORES_USED</span>  <span class="mi">40</span>
</pre></div>
</div>
<p>In this case, it sets the CTest <code class="docutils literal notranslate"><span class="pre">PROCESSORS</span></code> property as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">set_tests_properties</span><span class="p">(</span><span class="o">&lt;</span><span class="n">fullTestName</span><span class="o">&gt;</span> <span class="n">PROPERTIES</span> <span class="n">PROCESSORS</span> <span class="o">&lt;</span><span class="n">numTotalCoresUsed</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>When the number of processes a test uses does not cleanly divide into the
requested CTest parallel level, it is not clear how CTest schedules the
tests (hard to find documentation on this but one could always inspect the
CTest source code to find out for sure).  However, one boundary case that is
well observed is that CTest will run all defined tests regardless of the
size of the <code class="docutils literal notranslate"><span class="pre">PROCESSORS</span></code> property or the value of
<code class="docutils literal notranslate"><span class="pre">CTEST_PARALLEL_LEVEL</span></code>.  For example, if there are tests where
<code class="docutils literal notranslate"><span class="pre">PROCESSORS</span></code> is set to 20 but <code class="docutils literal notranslate"><span class="pre">`ctest</span> <span class="pre">-j10'</span></code> is used, then CTest will
still run those tests (using 20 processes) but will not schedule any other
tests while the parallel level is exceeded.  This can overload the machine
obviously.  Therefore, always set <code class="docutils literal notranslate"><span class="pre">MPI_EXEC_MAX_NUMPROCS</span></code> to the maximum
number of cores/processes that can be comfortably run on a given machine.
Also note that MPI tests are very fragile to overloaded machines</p>
<p>NOTE: <strong>Never</strong> manually override the <code class="docutils literal notranslate"><span class="pre">PROCESSORS</span></code> CTest property.
Instead, always using <code class="docutils literal notranslate"><span class="pre">NUM_TOTAL_CORES_USED</span> <span class="pre">&lt;numTotalCoresUsed&gt;</span></code> to set
this.  This is important because TriBITS needs to know how many
processes/cores are required for test so that it can disable the test if the
test requires more cores/processes than a given machine can handle or to
exceed an imposed budget of the number processes to be used.  The latter is
important when running multiple <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-J&lt;N&gt;</span></code> invocations on the same test
machine.</p>
<p id="setting-timeouts-for-tests-tribits-add-test"><strong>Setting timeouts for tests (tribits_add_test())</strong></p>
<p>By default, all tests have a default timeout (1500 seconds for most
projects, see <a class="reference internal" href="#dart-testing-timeout">DART_TESTING_TIMEOUT</a>).  That means that if they hang
(e.g. as is common when deadlocking occurs with multi-process MPI-based
tests and multi-threaded tests) then each test may hang for a long time,
causing the overall test suite to take a long time to complete.  For many
CMake projects, this default timeout is way too long.</p>
<p>Timeouts for tests can be adjusted in a couple of ways.  First, a default
timeout for all tests is enforced by CTest given the configured value of the
variable <a class="reference internal" href="#dart-testing-timeout">DART_TESTING_TIMEOUT</a> (typically set by the user but set by
default to 1500 for most projects).  This is a global timeout that applies
to all tests that don’t otherwise have individual timeouts set using the
<code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code> CTest property (see below).  The value of
<code class="docutils literal notranslate"><span class="pre">DART_TESTING_TIMEOUT</span></code> in the CMake cache on input to CMake will get
scaled by <a class="reference external" href="TribitsBuildReference.html#project-scale-test-timeout-testing-timeout">${PROJECT_NAME}_SCALE_TEST_TIMEOUT</a> and the scaled value gets
written into the file <code class="docutils literal notranslate"><span class="pre">DartConfiguration.tcl</span></code> as the field <code class="docutils literal notranslate"><span class="pre">TimeOut</span></code>.
The``ctest`` executable reads <code class="docutils literal notranslate"><span class="pre">TimeOut</span></code> from this file when it runs to
determine the default global timeout.  The value of this default global
<code class="docutils literal notranslate"><span class="pre">TimeOut</span></code> can be overridden using the <code class="docutils literal notranslate"><span class="pre">ctest</span></code> argument <code class="docutils literal notranslate"><span class="pre">--timeout</span>
<span class="pre">&lt;seconds&gt;</span></code> (see <a class="reference external" href="TribitsBuildReference.html#overriding-test-timeouts">Overriding test timeouts</a>).</p>
<p>Alternatively, timeouts for individual tests can be set using the input
argument <code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code> (see <a class="reference internal" href="#formal-arguments-tribits-add-test">Formal Arguments (tribits_add_test())</a> above).
The timeout value passed in to this function is then scaled by
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SCALE_TEST_TIMEOUT</span></code> and the scaled timeout is then set as
the CTest test property <code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code>.  One can observe the value of this
property in the CMake-generated file <code class="docutils literal notranslate"><span class="pre">CTestTestfile.cmake</span></code> in the current
build directory.  Individual test timeouts set this way are not impacted by
the global default timeout <code class="docutils literal notranslate"><span class="pre">DART_TESTING_TIMEOUT</span></code> or the <code class="docutils literal notranslate"><span class="pre">ctest</span></code>
argument <code class="docutils literal notranslate"><span class="pre">--timeout</span> <span class="pre">&lt;seconds&gt;</span></code>.</p>
<p>In summary, CTest determines the timeout for any individual test as follows:</p>
<ul class="simple">
<li><p>If the <code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code> CTest property in <code class="docutils literal notranslate"><span class="pre">CTestTestfile.cmake</span></code> for that test
is set, then that value is used.</p></li>
<li><p>Else if the <code class="docutils literal notranslate"><span class="pre">ctest</span></code> commandline option <code class="docutils literal notranslate"><span class="pre">--timeout</span> <span class="pre">&lt;seconds&gt;</span></code> is
provided, then that timeout is used.</p></li>
<li><p>Else if the property <code class="docutils literal notranslate"><span class="pre">TimeOut</span></code> in the base file
<code class="docutils literal notranslate"><span class="pre">DartConfiguration.tcl</span></code> is set to non-empty, then that timeout is used.</p></li>
<li><p>Else, no timeout is set and the test can run (and hang) forever until
manually killed by the user.</p></li>
</ul>
<p id="debugging-and-examining-test-generation-tribits-add-test"><strong>Debugging and Examining Test Generation (tribits_add_test())</strong></p>
<p>In order to see what tests get added and if not then why, configure with
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TRACE_ADD_TEST=ON</span></code>.  That will print one line per show
that the test got added and if not then why the test was not added (i.e. due
to <code class="docutils literal notranslate"><span class="pre">COMM</span></code>, <code class="docutils literal notranslate"><span class="pre">NUM_MPI_PROCS</span></code>, <code class="docutils literal notranslate"><span class="pre">CATEGORIES</span></code>, <code class="docutils literal notranslate"><span class="pre">HOST</span></code>, <code class="docutils literal notranslate"><span class="pre">XHOST</span></code>,
<code class="docutils literal notranslate"><span class="pre">HOSTTYPE</span></code>, or <code class="docutils literal notranslate"><span class="pre">XHOSTTYPE</span></code>).</p>
<p>Also, CMake writes a file <code class="docutils literal notranslate"><span class="pre">CTestTestfile.cmake</span></code> in the current binary
directory which contains all of the added tests and test properties that are
set.  This is the file that is read by <code class="docutils literal notranslate"><span class="pre">ctest</span></code> when it runs to determine
what tests to run, determine pass/fail and adjust other behavior using test
properties.  In this file, one can see the exact <code class="docutils literal notranslate"><span class="pre">add_test()</span></code> and
<code class="docutils literal notranslate"><span class="pre">set_tests_properties()</span></code> commands.  The is the ultimate way to debug
exactly what tests are getting added by this function (or if the test is
even being added at all).</p>
<p id="disabling-tests-externally-tribits-add-test"><strong>Disabling Tests Externally (tribits_add_test())</strong></p>
<p>The test can be disabled externally by setting the CMake cache variable
<code class="docutils literal notranslate"><span class="pre">&lt;fullTestName&gt;_DISABLE=TRUE</span></code>.  This allows tests to be disabled on a
case-by-case basis by the user (for whatever reason).  Here,
<code class="docutils literal notranslate"><span class="pre">&lt;fullTestName&gt;</span></code> must be the <em>exact</em> name that shows up in ‘ctest -N’ when
running the test.  If multiple tests are added in this function through
multiple argument sets to <code class="docutils literal notranslate"><span class="pre">ARGS</span></code> or through multiple
<code class="docutils literal notranslate"><span class="pre">POSTFIX_AND_ARGS_&lt;IDX&gt;</span></code> arguments, then <code class="docutils literal notranslate"><span class="pre">&lt;fullTestName&gt;_DISABLE=TRUE</span></code>
must be set for each test individually.  When a test is disabled in this
way, TriBITS will always print a warning to the <code class="docutils literal notranslate"><span class="pre">cmake</span></code> stdout at
configure time warning that the test is being disabled.</p>
<p id="adding-extra-commandline-arguments-externally-tribits-add-test"><strong>Adding extra commandline arguments externally (tribits_add_test())</strong></p>
<p>One can add additional command-line arguments for any ctest test added using
this function.  In order to do so, set the CMake cache variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="o">&lt;</span><span class="n">fullTestName</span><span class="o">&gt;</span><span class="n">_EXTRA_ARGS</span>  <span class="s2">&quot;&lt;earg0&gt;;&lt;earg1&gt;;&lt;earg2&gt;;...&quot;</span>
  <span class="n">CACHE</span>  <span class="n">STRING</span>  <span class="s2">&quot;Extra args&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>in a <code class="docutils literal notranslate"><span class="pre">*.cmake</span></code> configure options fragment file or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">fullTestName</span><span class="o">&gt;</span><span class="n">_EXTRA_ARGS</span><span class="o">=</span><span class="s2">&quot;&lt;earg0&gt;;&lt;earg1&gt;;&lt;earg2&gt;;...&quot;</span>
</pre></div>
</div>
<p>on the CMake command-line.</p>
<p>These extra command-line arguments are added after any arguments passed in
through <code class="docutils literal notranslate"><span class="pre">ARGS</span> <span class="pre">&quot;&lt;oarg0&gt;</span> <span class="pre">&lt;oarg1&gt;</span> <span class="pre">...&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">POSTFIX_AND_ARGS_&lt;IDX&gt;</span> <span class="pre">&lt;oarg0&gt;</span>
<span class="pre">&lt;oarg1&gt;</span> <span class="pre">...</span></code>.  This allows these extra arguments to override the earlier
arguments.</p>
<p>The primary motivating use case for <code class="docutils literal notranslate"><span class="pre">&lt;fullTestName&gt;_EXTRA_ARGS</span></code> is to
allow one to alter how a test runs on a specific platform or build.  For
example, this allows one to disable specific individual unit tests for a
GTest executable such as with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="o">&lt;</span><span class="n">fullTestName</span><span class="o">&gt;</span><span class="n">_EXTRA_ARGS</span> <span class="s2">&quot;--gtest_filter=-&lt;unittest0&gt;:&lt;unittest1&gt;:...&quot;</span>
  <span class="n">CACHE</span>  <span class="n">STRING</span>  <span class="s2">&quot;Disable specific unit tests&quot;</span> <span class="p">)</span>
</pre></div>
</div>
<p>For example, this would be an alternative to disabling an entire unit
testing executable using <code class="docutils literal notranslate"><span class="pre">-D&lt;fullTestName&gt;_DISABLE=ON</span></code> as described above.</p>
<p>In: core/package_arch/TribitsAddTest.cmake:44</p>
</section>
<section id="tribits-add-test-directories">
<h3><a class="toc-backref" href="#id134">tribits_add_test_directories()</a><a class="headerlink" href="#tribits-add-test-directories" title="Permalink to this heading"></a></h3>
<p>Macro called to add a set of test directories for an SE package.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_add_test_directories</span><span class="p">(</span><span class="o">&lt;</span><span class="n">dir1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">dir2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>This macro only needs to be called from the top most <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file
for which all subdirectories are all “tests”.</p>
<p>This macro can be called several times within a package and it will have the
right effect.</p>
<p>Currently, all this macro does macro is to call <code class="docutils literal notranslate"><span class="pre">add_subdirectory(&lt;diri&gt;)</span></code>
if <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_ENABLE_TESTS</span></code> or
<code class="docutils literal notranslate"><span class="pre">${PARENT_PACKAGE_NAME}_ENABLE_TESTS</span></code> are <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>. However, this macro
may be extended in the future in order to modify behavior related to adding
tests and examples in a uniform way.</p>
<p>In: core/package_arch/TribitsPackageMacros.cmake:389</p>
</section>
<section id="tribits-allow-missing-external-packages">
<h3><a class="toc-backref" href="#id135">tribits_allow_missing_external_packages()</a><a class="headerlink" href="#tribits-allow-missing-external-packages" title="Permalink to this heading"></a></h3>
<p>Allow listed packages to be missing and automatically excluded from the
package dependency data-structures.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_allow_missing_external_packages</span><span class="p">(</span><span class="o">&lt;</span><span class="n">pkg0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">plg1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>If the missing upstream SE package <code class="docutils literal notranslate"><span class="pre">&lt;pkgi&gt;</span></code> is optional, then the effect
will be to simply ignore the missing package (i.e. it will never be added to
package’s list and not added to dependency data-structures) and remove it
from the dependency lists for downstream SE packages that have an optional
dependency on the missing upstream SE package <code class="docutils literal notranslate"><span class="pre">&lt;pkgi&gt;</span></code>.  However, all
downstream SE packages that have a required dependency on the missing
upstream SE package <code class="docutils literal notranslate"><span class="pre">&lt;pkgi&gt;</span></code> will be hard disabled,
i.e. <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_{CURRENT_PACKAGE}=OFF</span></code> and a note on the
disable will be printed.</p>
<p><strong>WARNING</strong>: This macro just sets the cache variable
<code class="docutils literal notranslate"><span class="pre">&lt;pkgi&gt;_ALLOW_MISSING_EXTERNAL_PACKAGE=TRUE</span></code> for each SE package
<code class="docutils literal notranslate"><span class="pre">&lt;pkgi&gt;</span></code>.  Therefore, using this function effectively turns off error
checking for misspelled package names so it is important to only use it when
it absolutely is needed (use cases mentioned below).  Also note that missing
packages are silently ignored by default.  Therefore, when doing development
involving these packages, it is usually a good idea to set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">pkgi</span><span class="o">&gt;</span><span class="n">_ALLOW_MISSING_EXTERNAL_PACKAGE</span><span class="o">=</span><span class="n">FALSE</span>
</pre></div>
</div>
<p>so that it will catch errors in the misspelling of package names or source
directories.  However, notes on what missing packages are being ignored can
printed by configuring with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_WARN_ABOUT_MISSING_EXTERNAL_PACKAGES</span><span class="o">=</span><span class="n">TRUE</span>
</pre></div>
</div>
<p>This macro is typically called in one of two different contexts:</p>
<ul class="simple">
<li><p>Called from <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> when the upstream
package <code class="docutils literal notranslate"><span class="pre">&lt;pkgi&gt;</span></code> is defined in an optional upstream <a class="reference internal" href="#tribits-repository">TriBITS
Repository</a>.  This allows the downstream repos and packages to still be
enabled (assuming they don’t have required dependencies on the missing
packages) when one or more upstream repos are missing.</p></li>
<li><p>Called from <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> when the package <code class="docutils literal notranslate"><span class="pre">&lt;pkgi&gt;</span></code>
might be defined in an optional non-TriBITS repo (see <a class="reference internal" href="#how-to-insert-a-package-into-an-upstream-repo">How to insert a
package into an upstream repo</a>).</p></li>
</ul>
<p>For some meta-projects that composes packages from may different TriBITS
repositories, one might need to also call this function from the file
<a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a>.</p>
<p>In: core/package_arch/TribitsProcessPackagesAndDirsLists.cmake:143</p>
</section>
<section id="tribits-configure-file">
<h3><a class="toc-backref" href="#id136">tribits_configure_file()</a><a class="headerlink" href="#tribits-configure-file" title="Permalink to this heading"></a></h3>
<p>Macro that configures the package’s main configured header file (typically
called <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_config.h</span></code> but any name can be used).</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_configure_file</span><span class="p">(</span><span class="o">&lt;</span><span class="n">packageConfigFile</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>This function requires the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PACKAGE_SOURCE_DIR}/cmake/&lt;packageConfigFile&gt;.in
</pre></div>
</div>
<p>exists and it creates the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${CMAKE_CURRENT_BINARY_DIR}/&lt;packageConfigFile&gt;
</pre></div>
</div>
<p>by calling the built-in <code class="docutils literal notranslate"><span class="pre">configure_file()</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>configure_file(
  ${PACKAGE_SOURCE_DIR}/cmake/&lt;packageConfigFile&gt;.in
  ${CMAKE_CURRENT_BINARY_DIR}/&lt;packageConfigFile&gt;
  )
</pre></div>
</div>
<p>which does basic substitution of CMake variables (see documentation for
built-in CMake <a class="reference external" href="https://cmake.org/cmake/help/v3.17/command/configure_file.html">configure_file()</a> command for rules on how it performs
substitutions).  This command is typically used to configure the package’s
main <a class="reference internal" href="#packagedir-cmake-packagename-config-h-in">&lt;packageDir&gt;/cmake/&lt;packageName&gt;_config.h.in</a> file.</p>
<p>In addition to just calling <code class="docutils literal notranslate"><span class="pre">configure_file()</span></code>, this function also aids in
creating configured header files adding macros for deprecating code as
described below.</p>
<p><strong>Deprecated Code Macros</strong></p>
<p>If <code class="docutils literal notranslate"><span class="pre">${PARENT_PACKAGE_NAME}_SHOW_DEPRECATED_WARNINGS</span></code> is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> (see
<a class="reference internal" href="#tribits-add-show-deprecated-warnings-option">tribits_add_show_deprecated_warnings_option()</a>), then the local CMake
variable <code class="docutils literal notranslate"><span class="pre">${PARENT_PACKAGE_NAME_UC}_DEPRECATED_DECLARATIONS</span></code> is set which
adds a define <code class="docutils literal notranslate"><span class="pre">&lt;PARENT_PACKAGE_NAME_UC&gt;_DEPRECATED</span></code> (where
<code class="docutils literal notranslate"><span class="pre">&lt;PARENT_PACKAGE_NAME_UC&gt;</span></code> is the package name in all upper-case letters)
which adds a compiler-specific deprecated warning for an entity.  To take
advantage of this, just add the line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">@&lt;</span><span class="n">PARENT_PACKAGE_NAME_UC</span><span class="o">&gt;</span><span class="n">_DEPRECATED_DECLARATIONS</span><span class="o">@</span>
</pre></div>
</div>
<p>to the <code class="docutils literal notranslate"><span class="pre">&lt;packageConfigFile&gt;.in</span></code> file and it will be expanded at configure
time.</p>
<p>Then C/C++ code can use this macro to deprecate functions, variables,
classes, etc., for example, using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">PARENT_PACKAGE_NAME_UC</span><span class="o">&gt;</span><span class="n">_DEPRECATED</span> <span class="k">class</span> <span class="nc">SomeDepreatedClass</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span><span class="o">.</span>
</pre></div>
</div>
<p>If the particular compiler does not support deprecated warnings, then this
macro is defined to be empty.  See <a class="reference internal" href="#regulated-backward-compatibility-and-deprecated-code">Regulated Backward Compatibility and
Deprecated Code</a> for more details.</p>
<p>In: core/package_arch/TribitsConfigureFile.cmake:57</p>
</section>
<section id="tribits-copy-files-to-binary-dir">
<h3><a class="toc-backref" href="#id137">tribits_copy_files_to_binary_dir()</a><a class="headerlink" href="#tribits-copy-files-to-binary-dir" title="Permalink to this heading"></a></h3>
<p>Function that copies a list of files from a source directory to a
destination directory at configure time, typically so that it can be used in
one or more tests.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_copy_files_to_binary_dir</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">targetName</span><span class="o">&gt;</span>
  <span class="p">[</span><span class="n">SOURCE_FILES</span> <span class="o">&lt;</span><span class="n">file1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">file2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">SOURCE_DIR</span> <span class="o">&lt;</span><span class="n">sourceDir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">DEST_FILES</span> <span class="o">&lt;</span><span class="n">dfile1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">dfile2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">DEST_DIR</span> <span class="o">&lt;</span><span class="n">destDir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">TARGETDEPS</span> <span class="o">&lt;</span><span class="n">targDep1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">targDep2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">EXEDEPS</span> <span class="o">&lt;</span><span class="n">exeDep1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">exeDep2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">NOEXEPREFIX</span><span class="p">]</span>
  <span class="p">[</span><span class="n">CATEGORIES</span> <span class="o">&lt;</span><span class="n">category1</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">category2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>This sets up all of the custom CMake commands and targets to ensure that the
files in the destination directory are always up to date just by building
the <code class="docutils literal notranslate"><span class="pre">ALL</span></code> target.</p>
<p><strong>NOTE:</strong> The target name <code class="docutils literal notranslate"><span class="pre">&lt;targetName&gt;</span></code> must be unique from all other
targets in the same TriBITS SE Package.  Otherwise, one will get a configure
failure complaining that a target name has already been defined.  Therefore,
be sure to pick long and unique target names!</p>
<p>This function has a few valid calling modes:</p>
<p><strong>1) Source files and destination files have the same name</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_copy_files_to_binary_dir</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">targetName</span><span class="o">&gt;</span>
  <span class="n">SOURCE_FILES</span> <span class="o">&lt;</span><span class="n">file1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">file2</span><span class="o">&gt;</span> <span class="o">...</span>
  <span class="p">[</span><span class="n">SOURCE_DIR</span> <span class="o">&lt;</span><span class="n">sourceDir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">DEST_DIR</span> <span class="o">&lt;</span><span class="n">destDir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">TARGETDEPS</span> <span class="o">&lt;</span><span class="n">targDep1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">targDep2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">EXEDEPS</span> <span class="o">&lt;</span><span class="n">exeDep1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">exeDep2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">NOEXEPREFIX</span><span class="p">]</span>
  <span class="p">[</span><span class="n">CATEGORIES</span> <span class="o">&lt;</span><span class="n">category1</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">category2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>In this case, the names of the source files and the destination files
are the same but just live in different directories.</p>
<p><strong>2) Source files have a prefix different from the destination files</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_copy_files_to_binary_dir</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">targetName</span><span class="o">&gt;</span>
  <span class="n">DEST_FILES</span> <span class="o">&lt;</span><span class="n">file1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">file2</span><span class="o">&gt;</span> <span class="o">...</span>
  <span class="n">SOURCE_PREFIX</span> <span class="o">&lt;</span><span class="n">srcPrefix</span><span class="o">&gt;</span>
  <span class="p">[</span><span class="n">SOURCE_DIR</span> <span class="o">&lt;</span><span class="n">sourceDir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">DEST_DIR</span> <span class="o">&lt;</span><span class="n">destDir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">EXEDEPS</span> <span class="o">&lt;</span><span class="n">exeDep1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">exeDep2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">NOEXEPREFIX</span><span class="p">]</span>
  <span class="p">[</span><span class="n">CATEGORIES</span> <span class="o">&lt;</span><span class="n">category1</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">category2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>In this case, the source files have the same basic name as the destination
files except they have the prefix <code class="docutils literal notranslate"><span class="pre">&lt;srcPrefix&gt;</span></code> prepended to the name.</p>
<p><strong>3) Source files and destination files have completely different names</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_copy_files_to_binary_dir</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">targetName</span><span class="o">&gt;</span>
  <span class="n">SOURCE_FILES</span> <span class="o">&lt;</span><span class="n">sfile1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">sfile2</span><span class="o">&gt;</span> <span class="o">...</span>
  <span class="p">[</span><span class="n">SOURCE_DIR</span> <span class="o">&lt;</span><span class="n">sourceDir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="n">DEST_FILES</span> <span class="o">&lt;</span><span class="n">dfile1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">dfile2</span><span class="o">&gt;</span> <span class="o">...</span>
  <span class="p">[</span><span class="n">DEST_DIR</span> <span class="o">&lt;</span><span class="n">destDir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">EXEDEPS</span> <span class="o">&lt;</span><span class="n">exeDep1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">exeDep2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">NOEXEPREFIX</span><span class="p">]</span>
  <span class="p">[</span><span class="n">CATEGORIES</span> <span class="o">&lt;</span><span class="n">category1</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">category2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>In this case, the source files and destination files have completely
different prefixes.</p>
<p>The individual arguments are:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">SOURCE_FILES</span> <span class="pre">&lt;file1&gt;</span> <span class="pre">&lt;file2&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>Listing of the source files relative to the source directory given by
the argument <code class="docutils literal notranslate"><span class="pre">SOURCE_DIR</span> <span class="pre">&lt;sourceDir&gt;</span></code>.  If omitted, this list will be
the same as <code class="docutils literal notranslate"><span class="pre">DEST_FILES</span></code> with the argument <code class="docutils literal notranslate"><span class="pre">SOURCE_PREFIX</span>
<span class="pre">&lt;srcPrefix&gt;</span></code> appended.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">SOURCE_DIR</span> <span class="pre">&lt;sourceDir&gt;</span></code></p>
<blockquote>
<div><p>Optional argument that gives the (absolute) base directory for all of
the source files.  If omitted, this takes the default value of
<code class="docutils literal notranslate"><span class="pre">${CMAKE_CURRENT_SOURCE_DIR}</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">DEST_FILES</span> <span class="pre">&lt;file1&gt;</span> <span class="pre">&lt;file2&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>Listing of the destination files relative to the destination directory
given by the argument <code class="docutils literal notranslate"><span class="pre">DEST_DIR</span> <span class="pre">&lt;destDir&gt;</span></code>. If omitted, this list will
be the same as given by the <code class="docutils literal notranslate"><span class="pre">SOURCE_FILES</span></code> list.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">DEST_DIR</span> <span class="pre">&lt;destDir&gt;</span></code></p>
<blockquote>
<div><p>Optional argument that gives the (absolute) base directory for all of
the destination files.  If omitted, this takes the default value of
<code class="docutils literal notranslate"><span class="pre">${CMAKE_CURRENT_BINARY_DIR}</span></code></p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">TARGETDEPS</span> <span class="pre">&lt;targDep1&gt;</span> <span class="pre">&lt;targDep2&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>Listing of general CMake targets that these files will be added as
dependencies to.  This results in the copies to be performed when any of
the targets <code class="docutils literal notranslate"><span class="pre">&lt;targDepi&gt;</span></code> are built.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">EXEDEPS</span> <span class="pre">&lt;exeDep1&gt;</span> <span class="pre">&lt;exeDep2&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>Listing of executable targets that these files will be added as
dependencies to.  By default, the prefix <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_</span></code> will is
appended to the names of the targets.  This ensures that if the
executable target is built that these files will also be copied as well.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">NOEXEPREFIX</span></code></p>
<blockquote>
<div><p>Option that determines if the prefix <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_</span></code> will be
appended to the arguments in the <code class="docutils literal notranslate"><span class="pre">EXEDEPS</span></code> list.</p>
</div></blockquote>
</div></blockquote>
<p>In: core/package_arch/TribitsCopyFilesToBinaryDir.cmake:45</p>
</section>
<section id="tribits-ctest-driver">
<h3><a class="toc-backref" href="#id138">tribits_ctest_driver()</a><a class="headerlink" href="#tribits-ctest-driver" title="Permalink to this heading"></a></h3>
<p>Universal platform-independent CTest/CDash driver function for CTest -S
scripts for TriBITS projects</p>
<p>Usage (in <code class="docutils literal notranslate"><span class="pre">&lt;script&gt;.cmake</span></code> file run with <code class="docutils literal notranslate"><span class="pre">CTest</span> <span class="pre">-S</span> <span class="pre">&lt;script&gt;.cmake</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Set some basic vars and include tribits_ctest_driver()
set(TRIBITS_PROJECT_ROOT &quot;${CMAKE_CURRENT_LIST_DIR}/../../../..&quot;)
include(
  &quot;${TRIBITS_PROJECT_ROOT}/cmake/tribits/ctest_driver/TribitsCTestDriverCore.cmake&quot;)

# Set variables that define this build
set(CTEST_BUILD_NAME &lt;buildName&gt;)
set(CTEST_TEST_TYPE Nightly)
set(CTEST_DASHBOARD_ROOT PWD)
set(MPI_EXEC_MAX_NUMPROCS 16)
set(CTEST_BUILD_FLAGS &quot;-j16&quot;)
set(CTEST_PARALLEL_LEVEL 16)
set(${PROJECT_NAME}_REPOSITORY_LOCATION &lt;git-url-to-the-base-git-repo&gt;)
[... Set other vars ...]

# Call the driver script to handle the rest
tribits_ctest_driver()
</pre></div>
</div>
<p>This platform independent code is used in CTest -S scripts to drive the
testing process for submitting to CDash for a TriBITS project.</p>
<p>This function drives the following operations:</p>
<ol class="arabic simple">
<li><p><strong>Clone or update all source version control (VC) repos</strong> (Only if
<a class="reference internal" href="#ctest-do-updates">CTEST_DO_UPDATES</a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">TRUE</span></code>, otherwise existing source tree pointed to
by <a class="reference internal" href="#ctest-source-directory">CTEST_SOURCE_DIRECTORY</a> must already be in place).  Submit “Update”
data to CDash.</p></li>
<li><p><strong>Empty the build directory</strong> pointed to by <a class="reference internal" href="#ctest-binary-directory">CTEST_BINARY_DIRECTORY</a>
(only if <a class="reference internal" href="#ctest-do-new-start">CTEST_DO_NEW_START</a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">TRUE</span></code> and
<a class="reference internal" href="#ctest-start-with-empty-binary-directory">CTEST_START_WITH_EMPTY_BINARY_DIRECTORY</a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">TRUE</span></code>).</p></li>
<li><p><strong>Generate the file &lt;Project&gt;PackageDependencies.xml</strong> which is needed to
determine which packages need to be tested based on changes (only if
<a class="reference internal" href="#ctest-generate-outer-deps-xml-output-file">CTEST_GENERATE_OUTER_DEPS_XML_OUTPUT_FILE</a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">TRUE</span></code>).</p></li>
<li><p><strong>Generate the file CDashSubprojectDependencies.xml</strong> (only if
<a class="reference internal" href="#ctest-submit-cdash-subprojects-deps-file">CTEST_SUBMIT_CDASH_SUBPROJECTS_DEPS_FILE</a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">TRUE</span></code>).  Submit file to
CDash to inform of subproject structure and email addresses.</p></li>
<li><p><strong>Determine the set of packages to be tested</strong>.  If
<a class="reference internal" href="#ctest-enable-modified-packages-only">CTEST_ENABLE_MODIFIED_PACKAGES_ONLY</a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">TRUE</span></code>, then this is
determined by the files that have changed since the last build and
therefore what TriBITS packages need to be tested (can only be used if
and the underlying source tree repos must are git repos).  Otherwise, one
can directly set <a class="reference internal" href="#project-name-packages">${PROJECT_NAME}_PACKAGES</a> and other variables (see
<a class="reference internal" href="#determining-what-packages-get-tested-tribits-ctest-driver">Determining What Packages Get Tested (tribits_ctest_driver())</a>).</p></li>
<li><p><strong>Start a new dashboard calling ctest_start()</strong> which defines a new CDash
build (with a unique Build Stamp) (only if <a class="reference internal" href="#ctest-do-new-start">CTEST_DO_NEW_START</a> <code class="docutils literal notranslate"><span class="pre">=</span>
<span class="pre">TRUE</span></code>).</p></li>
<li><p><strong>Configure the selected packages to be tested</strong> in the build directory
pointed to by <a class="reference internal" href="#ctest-binary-directory">CTEST_BINARY_DIRECTORY</a>.  Submit “Configure” and “Notes”
data to CDash (only if <a class="reference internal" href="#ctest-do-configure">CTEST_DO_CONFIGURE</a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">TRUE</span></code>).</p></li>
<li><p><strong>Build configured packages and the enabled package tests</strong>.  Submit
“Build” data to CDash (only if <a class="reference internal" href="#ctest-do-build">CTEST_DO_BUILD</a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">TRUE</span></code>).</p></li>
<li><p><strong>Install the configured and build targets</strong>.  Submit
“Build” install data to CDash (only if <a class="reference internal" href="#ctest-do-install">CTEST_DO_INSTALL</a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">TRUE</span></code>).</p></li>
<li><p><strong>Run enabled tests for the configured packages</strong> (only if
<a class="reference internal" href="#ctest-do-test">CTEST_DO_TEST</a> = <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>).  (Also, this will generate coverage data if
<a class="reference internal" href="#ctest-do-coverage-testing">CTEST_DO_COVERAGE_TESTING</a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">TRUE</span></code>).  Submit “Test” data to CDash.</p></li>
<li><p><strong>Collect coverage results from tests already run</strong> (only if
<a class="reference internal" href="#ctest-do-coverage-testing">CTEST_DO_COVERAGE_TESTING</a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">TRUE</span></code>).  Submit “Coverage” data to
CDash.</p></li>
<li><p><strong>Run dynamic analysis testing on defined test suite</strong> (e.g. run
<code class="docutils literal notranslate"><span class="pre">valgrind</span></code> with each of the test commands (only if
<a class="reference internal" href="#ctest-do-memory-testing">CTEST_DO_MEMORY_TESTING</a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">TRUE</span></code>).  Submit “MemCheck” data to CDash.</p></li>
</ol>
<p>After each of these steps, results are submitted to CDash if
<a class="reference internal" href="#ctest-do-submit">CTEST_DO_SUBMIT</a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">TRUE</span></code> and otherwise no data is submitted to any
CDash site (which is good for local debugging of CTest -S driver scripts).
For the package-by-package mode these steps 7-11 for configure, build, and
running tests shown above are actually done in a loop package-by-package
with submits for each package to be tested.  For the all-at-once mode, these
steps are done all at once for the selected packages to be tested and
results are submitted to CDash all-at-once for all packages together (see
<a class="reference internal" href="#all-at-once-versus-package-by-package-mode-tribits-ctest-driver">All-at-once versus package-by-package mode (tribits_ctest_driver())</a>).</p>
<p>For context for how this function is used, see:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#tribits-ctest-cdash-driver">TriBITS CTest/CDash Driver</a></p></li>
<li><p><a class="reference internal" href="#how-to-submit-testing-results-to-a-cdash-site">How to submit testing results to a CDash site</a></p></li>
</ul>
<p>Also note that this function executes <a class="reference internal" href="#reduced-package-dependency-processing">Reduced Package Dependency
Processing</a> so all of the files described in that process are read in while
this function runs.  This processing is needed to determine the TriBITS
package dependency graph and to determine the set of packages to be enabled
or disabled when determining the set of packages to be tested.</p>
<p><em>Sections:</em></p>
<ul class="simple">
<li><p><a class="reference internal" href="#list-of-all-variables-tribits-ctest-driver">List of all variables (tribits_ctest_driver())</a></p></li>
<li><p><a class="reference internal" href="#setting-variables-tribits-ctest-driver">Setting variables (tribits_ctest_driver())</a></p></li>
<li><p><a class="reference internal" href="#source-and-binary-directory-locations-tribits-ctest-driver">Source and Binary Directory Locations (tribits_ctest_driver())</a></p></li>
<li><p><a class="reference internal" href="#determining-what-packages-get-tested-tribits-ctest-driver">Determining What Packages Get Tested (tribits_ctest_driver())</a></p></li>
<li><p><a class="reference internal" href="#setting-variables-in-the-inner-cmake-configure-tribits-ctest-driver">Setting variables in the inner CMake configure (tribits_ctest_driver())</a></p></li>
<li><p><a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a></p></li>
<li><p><a class="reference internal" href="#determining-how-the-results-are-displayed-on-cdash-tribits-ctest-driver">Determining how the results are displayed on CDash (tribits_ctest_driver())</a></p></li>
<li><p><a class="reference internal" href="#specifying-where-the-results-go-to-cdash-tribits-ctest-driver">Specifying where the results go to CDash (tribits_ctest_driver())</a></p></li>
<li><p><a class="reference internal" href="#links-to-results-on-cdash-tribits-ctest-driver">Links to results on CDash (tribits_ctest_driver())</a></p></li>
<li><p><a class="reference internal" href="#determining-what-tribits-repositories-are-included-tribits-ctest-driver">Determining what TriBITS repositories are included (tribits_ctest_driver())</a></p></li>
<li><p><a class="reference internal" href="#all-at-once-versus-package-by-package-mode-tribits-ctest-driver">All-at-once versus package-by-package mode (tribits_ctest_driver())</a></p></li>
<li><p><a class="reference internal" href="#multiple-ctest-s-invocations-tribits-ctest-driver">Multiple ctest -S invocations (tribits_ctest_driver())</a></p></li>
<li><p><a class="reference internal" href="#repository-updates-tribits-ctest-driver">Repository Updates (tribits_ctest_driver())</a></p></li>
<li><p><a class="reference internal" href="#other-ctest-driver-options-tribits-ctest-driver">Other CTest Driver options (tribits_ctest_driver())</a></p></li>
<li><p><a class="reference internal" href="#return-value-tribits-ctest-driver">Return value (tribits_ctest_driver())</a></p></li>
</ul>
<p id="list-of-all-variables-tribits-ctest-driver">The following is an alphabetical listing of all of the variables that impact
the behavior of the function <code class="docutils literal notranslate"><span class="pre">tribits_ctest_driver()</span></code> with links to their
more detailed documentation:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ADDITIONAL_PACKAGES</span></code> (<a class="reference internal" href="#determining-what-packages-get-tested-tribits-ctest-driver">Determining What Packages Get Tested (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_BRANCH</span></code> (<a class="reference internal" href="#repository-updates-tribits-ctest-driver">Repository Updates (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_CTEST_DO_ALL_AT_ONCE</span></code> (<a class="reference internal" href="#all-at-once-versus-package-by-package-mode-tribits-ctest-driver">All-at-once versus package-by-package mode (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES</span></code> (<a class="reference internal" href="#determining-what-packages-get-tested-tribits-ctest-driver">Determining What Packages Get Tested (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_ALL_FORWARD_DEP_PACKAGES</span></code> (<a class="reference internal" href="#determining-what-packages-get-tested-tribits-ctest-driver">Determining What Packages Get Tested (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_DEVELOPMENT_MODE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_KNOWN_EXTERNAL_REPOS_TYPE</span></code> (<a class="reference internal" href="#determining-what-tribits-repositories-are-included-tribits-ctest-driver">Determining what TriBITS repositories are included (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_SECONDARY_TESTED_CODE</span></code> (<a class="reference internal" href="#determining-what-packages-get-tested-tribits-ctest-driver">Determining What Packages Get Tested (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_EXCLUDE_PACKAGES</span></code> (<a class="reference internal" href="#determining-what-packages-get-tested-tribits-ctest-driver">Determining What Packages Get Tested (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_EXTRAREPOS_BRANCH</span></code> (<a class="reference internal" href="#repository-updates-tribits-ctest-driver">Repository Updates (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_EXTRAREPOS_FILE</span></code> (<a class="reference internal" href="#determining-what-tribits-repositories-are-included-tribits-ctest-driver">Determining what TriBITS repositories are included (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_EXTRA_REPOSITORIES</span></code> (<a class="reference internal" href="#determining-what-tribits-repositories-are-included-tribits-ctest-driver">Determining what TriBITS repositories are included (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_GENERATE_VERSION_DATE_FILES</span></code> (<a class="reference internal" href="#setting-variables-in-the-inner-cmake-configure-tribits-ctest-driver">Setting variables in the inner CMake configure (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_INNER_ENABLE_TESTS</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_PACKAGES</span></code> (<a class="reference internal" href="#determining-what-packages-get-tested-tribits-ctest-driver">Determining What Packages Get Tested (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_PRE_REPOSITORIES</span></code> (<a class="reference internal" href="#determining-what-tribits-repositories-are-included-tribits-ctest-driver">Determining what TriBITS repositories are included (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_REPOSITORY_BRANCH</span></code> (<a class="reference internal" href="#repository-updates-tribits-ctest-driver">Repository Updates (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_REPOSITORY_LOCATION</span></code> (<a class="reference internal" href="#repository-updates-tribits-ctest-driver">Repository Updates (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SKIP_CTEST_ADD_TEST</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TRACK</span></code> (<a class="reference internal" href="#determining-how-the-results-are-displayed-on-cdash-tribits-ctest-driver">Determining how the results are displayed on CDash (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TRIBITS_DIR</span></code> (<a class="reference internal" href="#source-and-binary-directory-locations-tribits-ctest-driver">Source and Binary Directory Locations (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_VERBOSE_CONFIGURE</span></code> (<a class="reference internal" href="#other-ctest-driver-options-tribits-ctest-driver">Other CTest Driver options (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">COMPILER_VERSION</span></code> (<a class="reference internal" href="#determining-how-the-results-are-displayed-on-cdash-tribits-ctest-driver">Determining how the results are displayed on CDash (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_BINARY_DIRECTORY</span></code> (<a class="reference internal" href="#source-and-binary-directory-locations-tribits-ctest-driver">Source and Binary Directory Locations (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_BUILD_FLAGS</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_BUILD_NAME</span></code> (<a class="reference internal" href="#determining-how-the-results-are-displayed-on-cdash-tribits-ctest-driver">Determining how the results are displayed on CDash (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_CHANGE_ID</span></code> (<a class="reference internal" href="#determining-how-the-results-are-displayed-on-cdash-tribits-ctest-driver">Determining how the results are displayed on CDash (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_CMAKE_GENERATOR</span></code> (<a class="reference internal" href="#other-ctest-driver-options-tribits-ctest-driver">Other CTest Driver options (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_CONFIGURATION_UNIT_TESTING</span></code> (<a class="reference internal" href="#other-ctest-driver-options-tribits-ctest-driver">Other CTest Driver options (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_COVERAGE_COMMAND</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_DASHBOARD_ROOT</span></code> (<a class="reference internal" href="#source-and-binary-directory-locations-tribits-ctest-driver">Source and Binary Directory Locations (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_DO_BUILD</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_DO_CONFIGURE</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_DO_COVERAGE_TESTING</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_DO_INSTALL</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_DO_MEMORY_TESTING</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_DO_NEW_START</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_DO_SUBMIT</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_DO_TEST</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_DO_UPDATES</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_ENABLE_MODIFIED_PACKAGES_ONLY</span></code> (<a class="reference internal" href="#determining-what-packages-get-tested-tribits-ctest-driver">Determining What Packages Get Tested (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_EXPLICITLY_ENABLE_IMPLICITLY_ENABLED_PACKAGES</span></code> (<a class="reference internal" href="#determining-what-packages-get-tested-tribits-ctest-driver">Determining What Packages Get Tested (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_GENERATE_OUTER_DEPS_XML_OUTPUT_FILE</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_MEMORYCHECK_COMMAND_OPTIONS</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_MEMORYCHECK_COMMAND</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_NOTES_FILES</span></code> (<a class="reference internal" href="#determining-how-the-results-are-displayed-on-cdash-tribits-ctest-driver">Determining how the results are displayed on CDash (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_PARALLEL_LEVEL</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_SITE</span></code> (<a class="reference internal" href="#determining-how-the-results-are-displayed-on-cdash-tribits-ctest-driver">Determining how the results are displayed on CDash (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_SOURCE_DIRECTORY</span></code> (<a class="reference internal" href="#source-and-binary-directory-locations-tribits-ctest-driver">Source and Binary Directory Locations (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_SOURCE_NAME</span></code> (<a class="reference internal" href="#source-and-binary-directory-locations-tribits-ctest-driver">Source and Binary Directory Locations (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_START_WITH_EMPTY_BINARY_DIRECTORY</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_SUBMIT_CDASH_SUBPROJECTS_DEPS_FILE</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_TEST_TYPE</span></code> (<a class="reference internal" href="#determining-how-the-results-are-displayed-on-cdash-tribits-ctest-driver">Determining how the results are displayed on CDash (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_UPDATE_ARGS</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_UPDATE_VERSION_ONLY</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CTEST_WIPE_CACHE</span></code> (<a class="reference internal" href="#determining-what-testing-related-actions-are-performed-tribits-ctest-driver">Determining what testing-related actions are performed (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EXTRA_CONFIGURE_OPTIONS</span></code> (<a class="reference internal" href="#setting-variables-in-the-inner-cmake-configure-tribits-ctest-driver">Setting variables in the inner CMake configure (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EXTRA_SYSTEM_CONFIGURE_OPTIONS</span></code> (<a class="reference internal" href="#setting-variables-in-the-inner-cmake-configure-tribits-ctest-driver">Setting variables in the inner CMake configure (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TRIBITS_2ND_CTEST_DROP_LOCATION</span></code> (<a class="reference internal" href="#specifying-where-the-results-go-to-cdash-tribits-ctest-driver">Specifying where the results go to CDash (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TRIBITS_2ND_CTEST_DROP_SITE</span></code> (<a class="reference internal" href="#specifying-where-the-results-go-to-cdash-tribits-ctest-driver">Specifying where the results go to CDash (tribits_ctest_driver())</a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TRIBITS_PROJECT_ROOT</span></code> (<a class="reference internal" href="#source-and-binary-directory-locations-tribits-ctest-driver">Source and Binary Directory Locations (tribits_ctest_driver())</a>)</p></li>
</ul>
<p><strong>List of all variables (tribits_ctest_driver()):</strong></p>
<p id="setting-variables-tribits-ctest-driver"><strong>Setting variables (tribits_ctest_driver()):</strong></p>
<p>Variables can be set to control the behavior of this function before the
function is called.  Some variables must be set in the CTest -S driver
script before calling this function <code class="docutils literal notranslate"><span class="pre">tribits_ctest_driver()</span></code>.  Many
variables have a default value that will work in most cases.</p>
<p>In general, these variables fall into one of three different categories:</p>
<ul class="simple">
<li><p><strong>Variables that must be set in the outer CTest -S driver script before
the TribitsCTestDriverCore.cmake module is even included:</strong> Many of these
can also be overridden from an env var of the same name.  There are very
few of these variables and they are specifically called out below.</p></li>
<li><p><strong>Variables with no default value that must set in the outer CTest -S
driver script after the TribitsCTestDriverCore.cmake module is included
but before tribits_ctest_driver() is called:</strong> There are very few of these
variables and in some cases, they may be optional.  These types of
variables will be called out below.</p></li>
<li><p><strong>Variables that can be are set before tribits_ctest_driver() is called
but have default values provided in the tribits_ctest_driver() function
and may look for env var overrides:</strong> This comprises the majority of the
variables used in <code class="docutils literal notranslate"><span class="pre">tribits_ctest_driver()</span></code>.  The variables that have
default values but allow for an override as an env var use the function
<a class="reference internal" href="#set-default-and-from-env">set_default_and_from_env()</a>.  In the case of variables that are given a
default value with <code class="docutils literal notranslate"><span class="pre">set_default_and_from_env()</span></code>, their value is always
overridden with what is in the env var of the same name.  In this case,
the overriding value that is read in from the env is printed out.  In
either case, the value used for these variables is printed out.</p></li>
</ul>
<p>Which variables are which are described below for each variable.</p>
<p id="source-and-binary-directory-locations-tribits-ctest-driver"><strong>Source and Binary Directory Locations (tribits_ctest_driver()):</strong></p>
<p>To understand how to set the source and binary directories, one must
understand that CTest -S scripts using this function get run in one of two
different modes:</p>
<p><strong>Mode 1</strong>: Run where there are <strong>already existing source and binary
directories</strong> (i.e.  is set empty before call).  In this case,
<a class="reference internal" href="#ctest-source-directory">CTEST_SOURCE_DIRECTORY</a> and <a class="reference internal" href="#ctest-binary-directory">CTEST_BINARY_DIRECTORY</a> must be set by the
user before calling this function (and <a class="reference internal" href="#ctest-dashboard-root">CTEST_DASHBOARD_ROOT</a> is empty).
This mode is typically used to test a local build or an existing cloned and
setup set source tree and post to CDash (see the custom <code class="docutils literal notranslate"><span class="pre">dashboard</span></code> target
in <a class="reference external" href="TribitsBuildReference.html#dashboard-submissions">Dashboard Submissions</a>).</p>
<p><strong>Mode 2</strong>: A <strong>new binary directory is created and optionally new sources
are cloned or updated</strong> under a driver directory
(i.e. <code class="docutils literal notranslate"><span class="pre">CTEST_DASHBOARD_ROOT</span></code> is set before call and that directory will be
created if it does not already exist).  In this case, there are typically
two (partial) project source tree’s, a) the “driver” skeleton source tree
(typically with an embedded tribits/ directory) that bootstraps the testing
process that contains the CTest -S driver script, and b) the full “source”
tree that is (optionally) cloned and/or updated and is directly configured,
build, and tested.  This mode can also handle the case where the source tree
is already set up in the location pointed to by <a class="reference internal" href="#ctest-source-directory">CTEST_SOURCE_DIRECTORY</a>
and <a class="reference internal" href="#ctest-do-submit">CTEST_DO_SUBMIT</a> is set to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> so this mode can get away with a
single source tree and can handle a variety of use cases that may
pre-manipulate the source tree before <code class="docutils literal notranslate"><span class="pre">tribits_ctest_driver()</span></code> is run.</p>
<p>There are a few different directory locations that are significant for this
script used in one or both of the modes described above:</p>
<blockquote>
<div><p id="tribits-project-root"><code class="docutils literal notranslate"><span class="pre">TRIBITS_PROJECT_ROOT=&lt;projectDir&gt;</span></code>.</p>
<blockquote>
<div><p>The root directory to an existing source tree where the project’s
<a class="reference internal" href="#projectdir-projectname-cmake">&lt;projectDir&gt;/ProjectName.cmake</a> (defining the <code class="docutils literal notranslate"><span class="pre">PROJECT_NAME</span></code>
variable) and <a class="reference internal" href="#projectdir-version-cmake">&lt;projectDir&gt;/Version.cmake</a> files can be found.  This
can be set() in the CTest -S script or override as an env var.  The
default and env override is set for this during the include() of the
module <code class="docutils literal notranslate"><span class="pre">TribitsCTestDriverCore.cmake</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TRIBITS_DIR=&lt;tribits-dir&gt;</span></code></p>
<blockquote>
<div><p>The base directory for the TriBITS system’s various CMake modules,
python scripts, and other files.  By default this is assumed to be
<code class="docutils literal notranslate"><span class="pre">${TRIBITS_PROJECT_ROOT}/cmake/tribits</span></code>.  This can be set() in the
CTest -S script or overridden as an env var.  The default and env
override is set for this during the include() of
<code class="docutils literal notranslate"><span class="pre">TribitsCTestDriverCore.cmake</span></code>.</p>
</div></blockquote>
<p id="ctest-dashboard-root"><code class="docutils literal notranslate"><span class="pre">CTEST_DASHBOARD_ROOT=&lt;dashboard-root-dir&gt;</span></code></p>
<blockquote>
<div><p>If set, this is the base directory where this script runs that clones
the sources for the project.  If this directory does not exist, it will
be created.  If provided as the special value <code class="docutils literal notranslate"><span class="pre">PWD</span></code>, then the present
working directory is used.  If empty, then this var has no effect.  This
can be set() in CTest -S script before the call to
<code class="docutils literal notranslate"><span class="pre">tribits_ctest_driver()</span></code> or override as an env var.</p>
</div></blockquote>
<p id="ctest-source-name"><code class="docutils literal notranslate"><span class="pre">CTEST_SOURCE_NAME=&lt;src-dir-name&gt;</span></code></p>
<blockquote>
<div><p>The name of the source directory.  This can be set() in the CTest -S
script before the call to <code class="docutils literal notranslate"><span class="pre">tribits_ctest_driver()</span></code> or overridden as an
env var. By default, this is set to <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}</span></code>.</p>
</div></blockquote>
<p id="ctest-source-directory"><code class="docutils literal notranslate"><span class="pre">CTEST_SOURCE_DIRECTORY=&lt;src-dir-full-path&gt;</span></code></p>
<blockquote>
<div><p>Built-in CTest variable that determines the location of the sources that
are used to define packages, dependencies and configure, build, and test
the software.  This is a variable that CTest directly reads and must
therefore be set. This is used to set <a class="reference internal" href="#project-source-dir">PROJECT_SOURCE_DIR</a> which is
used by the TriBITS system.  If <code class="docutils literal notranslate"><span class="pre">CTEST_DASHBOARD_ROOT</span></code> is set, then
this is hard-coded internally to
<code class="docutils literal notranslate"><span class="pre">${CTEST_DASHBOARD_ROOT}/${CTEST_SOURCE_NAME}</span></code> and will therefore
override any value that might be set in the CTest -S driver script.
However, if <code class="docutils literal notranslate"><span class="pre">CTEST_DASHBOARD_ROOT</span></code> is empty when
<code class="docutils literal notranslate"><span class="pre">TribitsCTestDriverCore.cmake</span></code> is included(), then by default it set
to <code class="docutils literal notranslate"><span class="pre">${TRIBITS_PROJECT_ROOT}</span></code>.  This can only be set() in the CTest -S
driver script and is not overridden as an env var.  The only way to
override in the ENV is to indirectly set through
<code class="docutils literal notranslate"><span class="pre">${CTEST_DASHBOARD_ROOT}</span></code>.</p>
</div></blockquote>
<p id="ctest-binary-directory"><code class="docutils literal notranslate"><span class="pre">CTEST_BINARY_DIRECTORY=&lt;binary-dir-full-path&gt;</span></code></p>
<blockquote>
<div><p>Built-in CTest variable that determines the location of the binary tree
where output from CMake/CTest is put.  This is used to set to
<a class="reference internal" href="#project-binary-dir">PROJECT_BINARY_DIR</a> which is used by the TriBITS system and this
variable is directly ready by CTest itself.  If <code class="docutils literal notranslate"><span class="pre">CTEST_DASHBOARD_ROOT</span></code>
is set, then this is hard-coded internally to
<code class="docutils literal notranslate"><span class="pre">${CTEST_DASHBOARD_ROOT}/BUILD</span></code> (overwriting any existing value of
<code class="docutils literal notranslate"><span class="pre">CTEST_BINARY_DIRECTORY</span></code>).  If <code class="docutils literal notranslate"><span class="pre">CTEST_BINARY_DIRECTORY</span></code> is empty
when <code class="docutils literal notranslate"><span class="pre">TribitsCTestDriverCore.cmake</span></code> is included(), then by default it
set to <code class="docutils literal notranslate"><span class="pre">$ENV{PWD}/BUILD</span></code>.  <code class="docutils literal notranslate"><span class="pre">CTEST_BINARY_DIRECTORY</span></code> can not be
overridden in the env.</p>
</div></blockquote>
</div></blockquote>
<p id="determining-what-packages-get-tested-tribits-ctest-driver"><strong>Determining What Packages Get Tested (tribits_ctest_driver()):</strong></p>
<p>Before any testing is done, the set of packages to be tested is determined.
This determination uses the basic <a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency Handling Behaviors</a>
and logic.  By default, the set of packages to be tested and otherwise
explicitly processed is determined by the vars (which can also be set as env
vars):</p>
<blockquote>
<div><blockquote>
<div><p id="project-name-packages"><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_PACKAGES=&lt;pkg0&gt;,&lt;pkg1&gt;,...</span></code></p>
<blockquote>
<div><p>A semi-colon ‘;’ or comma ‘,’ separated list of packages that determines
the specific set of packages to test.  If left at the default value of
empty “”, then <a class="reference internal" href="#project-name-enable-all-packages">${PROJECT_NAME}_ENABLE_ALL_PACKAGES</a> is set to <code class="docutils literal notranslate"><span class="pre">ON</span></code>
and that enables packages as described in <a class="reference internal" href="#project-enable-all-packages-enables-all-pt-cond-st-se-packages">&lt;Project&gt;_ENABLE_ALL_PACKAGES
enables all PT (cond. ST) SE packages</a>.  This variable can use ‘,’ to
separate package names instead of ‘;’.  The default value is empty “”.</p>
</div></blockquote>
<p id="project-name-additional-packages"><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ADDITIONAL_PACKAGES=&lt;pkg0&gt;,&lt;pkg1&gt;,...</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_PACKAGES</span></code> is empty (and therefore
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_ALL_PACKAGES=ON</span></code> is set), then additional
packages not enabled in that logic can be listed
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ADDITIONAL_PACKAGES</span></code> and they will be tested as well.
For example, if this wold be used when there are some additional ST or
EX packages that should be tested in a PT build
(e.g. <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_SECONDARY_TESTED_CODE=FALSE</span></code>.  The
default value is empty “”.</p>
</div></blockquote>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_PACKAGE_ENABLES_FILE=&lt;filepath&gt;</span></code></p>
<blockquote>
<div><blockquote>
<div><p>A file that is expected to define a set to <cite>set()</cite> statements to enable a
set of packages.  The set of packages enabled will determine what
packages are specifically processed and tested (according to other
options as well).  NOTE: To get this set of enables passed to inner
configure, also list this file in the inner configure cache variable
<a class="reference external" href="TribitsBuildReference.html#project-configure-options-file">${PROJECT_NAME}_CONFIGURE_OPTIONS_FILE</a> (see passing such options
through in <a class="reference internal" href="#setting-variables-in-the-inner-cmake-configure-tribits-ctest-driver">Setting variables in the inner CMake configure
(tribits_ctest_driver())</a>).  This is used instead of the variable
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_PACKAGES</span></code> to specify the set of packages to enable and
test.  (If both <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_PACKAGES</span></code> and
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_PACKAGE_ENABLES_FILE</span></code> are both set, then a fatal error
will occur.  The default value is empty “”.</p>
</div></blockquote>
<p id="project-name-enable-all-forward-dep-packages"><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_ALL_FORWARD_DEP_PACKAGES=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>If set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then all of the downstream packages from those
specified in <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_PACKAGES</span></code> will be enabled (see
<a class="reference internal" href="#project-enable-all-forward-dep-packages-enables-downstream-packages-tests">&lt;Project&gt;_ENABLE_ALL_FORWARD_DEP_PACKAGES enables downstream
packages/tests</a>).  The default value is <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> unless
<code class="docutils literal notranslate"><span class="pre">CTEST_ENABLE_MODIFIED_PACKAGES_ONLY=TRUE</span></code> is set in which case the
default value is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_SECONDARY_TESTED_CODE=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>If set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then ST packages will get enabled in automated logic
in the outer determination of what packages to get tested.  This value
also gets passed to the inner CMake configure.  The default value is
<code class="docutils literal notranslate"><span class="pre">OFF</span></code>.</p>
</div></blockquote>
<p id="project-name-exclude-packages"><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_EXCLUDE_PACKAGES=&lt;pkg0&gt;,&lt;pkg1&gt;,...</span></code></p>
<blockquote>
<div><p>A semi-colon ‘;’ or comma ‘,’ separated list of packages <strong>NOT</strong> to
enable when determining the set of packages to be tested.  NOTE: Listing
packages here will <em>not</em> disable the package in the inner CMake
configure when using the package-by-packages approach.  To do that, you
will have to disable them in the variable EXTRA_CONFIGURE_OPTIONS (set
in your driver script).  But for the all-at-once approach this list of
package disables <strong>IS</strong> pass into the inner configure.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>If set to <code class="docutils literal notranslate"><span class="pre">ON</span></code> (or <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>), then if there are conflicts between
explicit enables and disables then explicit disables will override the
explicit enables (see <a class="reference internal" href="#disables-trump-enables-where-there-is-a-conflict">Disables trump enables where there is a
conflict</a>).  The default is <code class="docutils literal notranslate"><span class="pre">ON</span></code> and likely should not be changed.
The default value is <code class="docutils literal notranslate"><span class="pre">ON</span></code>.</p>
</div></blockquote>
<p id="ctest-explicitly-enable-implicitly-enabled-packages"><code class="docutils literal notranslate"><span class="pre">CTEST_EXPLICITLY_ENABLE_IMPLICITLY_ENABLED_PACKAGES=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>If set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then all of the upstream packages for those selected
to be explicitly tested will be processed with results posted to CDash.
The default is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> unless
<code class="docutils literal notranslate"><span class="pre">CTEST_ENABLE_MODIFIED_PACKAGES_ONLY==TRUE</span></code>.  Most builds that specify
a specific set of packages in <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_PACKAGES</span></code> should likely
set this to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>.</p>
</div></blockquote>
</div></blockquote>
</div></blockquote>
<p>NOTE: Any and all of the above vars can be set as env vars and they will
override the value set inside the CTest -S script with <code class="docutils literal notranslate"><span class="pre">set()`</span></code> (or
<a class="reference internal" href="#set-default">set_default()</a>) statements.  Also, for any of the vars that take a list,
the CMake standard semi-colon char ‘;’ can be used to separate list items or
comas ‘,’ can be used so that they can be used when setting env vars.  (The
comas ‘,’ are then replaced with semi-colons ‘;’ internally before
interpreted as an list by CMake.)</p>
<p>The other mode for selecting the set of packages to be tested is to only
test the packages that have changes since the last time this build was run
and testing packages that previously failed.  That mode is turned on by the
var:</p>
<blockquote>
<div><p id="ctest-enable-modified-packages-only"><code class="docutils literal notranslate"><span class="pre">CTEST_ENABLE_MODIFIED_PACKAGES_ONLY=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then only packages that have changes pulled from the git
repos since the last time the build ran will be tested (in addition to
packages that failed in the last build).  If <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>, the set of
packages to be tested is determined by <a class="reference internal" href="#project-name-packages">${PROJECT_NAME}_PACKAGES</a> and
other variables as described above.</p>
</div></blockquote>
</div></blockquote>
<p id="setting-variables-in-the-inner-cmake-configure-tribits-ctest-driver"><strong>Setting variables in the inner CMake configure:</strong></p>
<p>It is important to understand that none of the CMake vars that get set in
the other CTest -S program that calls <code class="docutils literal notranslate"><span class="pre">tribits_ctest_driver()</span></code>
automatically get passed into the inner configure of the TriBITS CMake
project using the <code class="docutils literal notranslate"><span class="pre">ctest_configure()</span></code> command by CMake.  From the
perspective of raw CTest and CMake, these are completely separate programs.
However, the <code class="docutils literal notranslate"><span class="pre">tribits_ctest_driver()</span></code> function will forward subset of
variables documented below into the inner CMake configure.  The following
variables that are set in the outer CTest -S program will be passed into the
inner CMake configure by default (but their values they can be overridden by
options listed in <code class="docutils literal notranslate"><span class="pre">EXTRA_SYSTEM_CONFIGURE_OPTIONS</span></code> or
<code class="docutils literal notranslate"><span class="pre">EXTRA_CONFIGURE_OPTIONS</span></code>):</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">-D${PROJECT_NAME}_IGNORE_MISSING_EXTRA_REPOSITORIES=ON</span></code></p>
<blockquote>
<div><p>Missing extra repos are always ignored in the inner CMake configure.
This is because any problems reading an extra repo will be caught in the
outer CTest -S drivers script.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">-D${PROJECT_NAME}_ENABLE_ALL_OPTIONAL_PACKAGES:BOOL=ON</span></code></p>
<blockquote>
<div><p>Because of the behavior of the package-by-package mode, currently, this
is hard-coded to <code class="docutils literal notranslate"><span class="pre">ON</span></code>.  (This set may be removed in the future for the
all-at-once mode.)</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">-D${PROJECT_NAME}_ALLOW_NO_PACKAGES:BOOL=ON</span></code></p>
<blockquote>
<div><p>This is currently set for the package-by-package mode since some
packages may get disabled because required upstream dependent packages
may be disabled.  (This set may be removed in the future for the
all-at-once mode.)</p>
</div></blockquote>
</div></blockquote>
<p>The following variables set in the CTest -S driver script will be passed
down into the inner CMake configure through the <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code> variable to the
<code class="docutils literal notranslate"><span class="pre">ctest_configure()</span></code> command:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TRIBITS_DIR</span></code>: Direct pass-through</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_WARNINGS_AS_ERRORS_FLAGS</span></code>: Direct pass-through</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_DISABLE_ENABLED_FORWARD_DEP_PACKAGES</span></code>: Direct pass-through</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_DEPS_XML_OUTPUT_FILE</span></code>: Set to empty if
<code class="docutils literal notranslate"><span class="pre">CTEST_GENERATE_DEPS_XML_OUTPUT_FILE==FALSE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_SECONDARY_TESTED_CODE</span></code>: Direct pass-through</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_TESTS</span></code>: Set the the same value as
<a class="reference internal" href="#project-name-inner-enable-tests">${PROJECT_NAME}_INNER_ENABLE_TESTS</a> set in the outer ctest -S driver script</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SKIP_CTEST_ADD_TEST</span></code>: Direct pass-through</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MPI_EXEC_MAX_NUMPROCS</span></code>: Direct pass-through</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_COVERAGE_TESTING</span></code>: Set to <code class="docutils literal notranslate"><span class="pre">ON</span></code> if
<code class="docutils literal notranslate"><span class="pre">CTEST_DO_COVERAGE_TESTING==TRUE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_EXTRAREPOS_FILE</span></code>: Set to empty if
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_EXTRAREPOS_FILE=NONE</span></code>. Otherwise, passed through.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_KNOWN_EXTERNAL_REPOS_TYPE</span></code>: Direct pass-through</p></li>
<li><p><a class="reference internal" href="#project-name-generate-version-date-files">${PROJECT_NAME}_GENERATE_VERSION_DATE_FILES</a>: Only passed down if
non-empty value is set (default empty “”)</p></li>
</ul>
<p>Arbitrary options can be set to be passed into the inner CMake configure
after the above options are passed by setting the following variables:</p>
<blockquote>
<div><p id="extra-system-configure-options"><code class="docutils literal notranslate"><span class="pre">EXTRA_SYSTEM_CONFIGURE_OPTIONS</span></code></p>
<blockquote>
<div><p>Additional list of system-specific options to be passed to the inner
CMake configure.  This must be set in the CTest -S driver script with a
<code class="docutils literal notranslate"><span class="pre">set()</span></code> statement (i.e. env var is not read).  These options get added
after all of the above pass-through options so they can override any of
those options.  <strong>WARNING:</strong> Do not include any semicolons ‘;’ in these
arguments (see below WARNING).</p>
</div></blockquote>
<p id="extra-configure-options"><code class="docutils literal notranslate"><span class="pre">EXTRA_CONFIGURE_OPTIONS</span></code></p>
<blockquote>
<div><p>Additional list of extra cmake configure options to be passed to the
inner CMake configure.  This must be set in the CTest -S driver script
with a <code class="docutils literal notranslate"><span class="pre">set()</span></code> statement (i.e. env var is not read).  These options
get added after all of the above pass-through options and the options
listed in <code class="docutils literal notranslate"><span class="pre">EXTRA_SYSTEM_CONFIGURE_OPTIONS</span></code> so they can override any of
those options.  <strong>WARNING:</strong> Do not include any semicolons ‘;’ in these
arguments (see below WARNING).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_EXTRA_CONFIGURE_OPTIONS</span></code>:</p>
<blockquote>
<div><p>A yet additional list of extra cmake configure options to be passed to
the inner CMake configure after all of the others.  Unlike the above
options, this var is read from the env and allows the user to set
arbitrary configure options that overrides all others. <strong>WARNING:</strong> Do
not include any semicolons ‘;’ in these arguments (see below WARNING).</p>
</div></blockquote>
</div></blockquote>
<p>These configure options are passed into the <code class="docutils literal notranslate"><span class="pre">ctest_configure()</span></code> command in
the order:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;initial options&gt; ${EXTRA_SYSTEM_CONFIGURE_OPTIONS}} \
   ${EXTRA_CONFIGURE_OPTIONS} ${${PROJECT_NAME}_EXTRA_CONFIGURE_OPTIONS}
</pre></div>
</div>
<p><strong>WARNING:</strong> The options listed in <code class="docutils literal notranslate"><span class="pre">EXTRA_SYSTEM_CONFIGURE_OPTIONS</span></code>,
<code class="docutils literal notranslate"><span class="pre">EXTRA_CONFIGURE_OPTIONS</span></code>, and <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_EXTRA_CONFIGURE_OPTIONS</span></code>
should not contain any semi-colons ‘;’ or they will be interpreted as array
bounds and mess up the arguments when passed to the inner CMake configure.
To avoid problems with spaces and semicolons, it is usually a good idea to
put these cache vars into <code class="docutils literal notranslate"><span class="pre">*.cmake</span></code> file fragments and the pass them
through using the variable <a class="reference external" href="TribitsBuildReference.html#project-configure-options-file">&lt;Project&gt;_CONFIGURE_OPTIONS_FILE</a> as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span><span class="o">&lt;</span><span class="n">Project</span><span class="o">&gt;</span><span class="n">_CONFIGURE_OPTIONS_FILE</span><span class="o">=&lt;</span><span class="n">optionsfile1</span><span class="o">&gt;.</span><span class="n">cmake</span><span class="p">,</span><span class="o">&lt;</span><span class="n">optionsfile2</span><span class="o">&gt;.</span><span class="n">cmake</span><span class="p">,</span><span class="o">...</span>
</pre></div>
</div>
<p>or using the built-in CMake option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">C</span><span class="o">&lt;</span><span class="nb">abs</span><span class="o">-</span><span class="n">base</span><span class="o">&gt;/&lt;</span><span class="n">optionsfile1</span><span class="o">&gt;.</span><span class="n">cmake</span> <span class="o">-</span><span class="n">C</span><span class="o">&lt;</span><span class="nb">abs</span><span class="o">-</span><span class="n">base</span><span class="o">&gt;/&lt;</span><span class="n">optionsfile2</span><span class="o">&gt;.</span><span class="n">cmake</span> <span class="o">...</span>
</pre></div>
</div>
<p>NOTE: The full list of options passed into the inner CMake is printed out
before calling <code class="docutils literal notranslate"><span class="pre">ctest_configure()</span></code> so any issues setting options and the
ordering of options can be seen in that printout.</p>
<p id="determining-what-testing-related-actions-are-performed-tribits-ctest-driver"><strong>Determining what testing-related actions are performed (tribits_ctest_driver()):</strong></p>
<p>When run, <code class="docutils literal notranslate"><span class="pre">tribits_ctest_driver()</span></code> always performs a configure and build
but other actions are optional.  By default, a version control update (or
clone) is performed as well as running tests and submitting results to
CDash.  But the version control update, the running tests and submitting
results to CDash can be disabled.  Also, coverage testing and memory testing
are not performed by default but they can be turned on with results
submitted to CDash.  These actions are controlled by the following variables
(which can be set in the CTest -S script before calling
<code class="docutils literal notranslate"><span class="pre">tribits_ctest_driver()</span></code> and can be overridden by env vars of the same
name):</p>
<blockquote>
<div><p id="ctest-do-new-start"><code class="docutils literal notranslate"><span class="pre">CTEST_DO_NEW_START=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, <code class="docutils literal notranslate"><span class="pre">ctest_start()</span></code> is called to set up a new “dashboard”
(i.e. define a new CDash build with a unique Build Stamp defined in the
<code class="docutils literal notranslate"><span class="pre">Testing/TAG</span></code> file).  If <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>, then <code class="docutils literal notranslate"><span class="pre">ctest_start(...</span> <span class="pre">APPEND)</span></code>
is called which allows it this ctest -S invocation to append results to
an existing CDash build.  (See ???).  Default <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">CTEST_DO_UPDATES=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then the source repos will be updated as specified in
<a class="reference internal" href="#repository-updates-tribits-ctest-driver">Repository Updates (tribits_ctest_driver())</a>.  Default <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.</p>
</div></blockquote>
<p id="ctest-update-args"><code class="docutils literal notranslate"><span class="pre">CTEST_UPDATE_ARGS</span></code></p>
<blockquote>
<div><p>Any extra arguments to use with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span></code> to clone the base git repo.
The default value is empty “”.  This is only used for the base git repo
(not the extra repos).</p>
</div></blockquote>
<p id="ctest-update-version-only"><code class="docutils literal notranslate"><span class="pre">CTEST_UPDATE_VERSION_ONLY</span></code>:</p>
<blockquote>
<div><p>Built-in CTest variable that if set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> will change the default
behavior of <code class="docutils literal notranslate"><span class="pre">ctest_update()</span></code> such that it will not clone or pull from
the remove repo or update the local branch in any way.  This also skips
any actions on extra repos and skips the creation of the <code class="docutils literal notranslate"><span class="pre">Updates.txt</span></code>
or <code class="docutils literal notranslate"><span class="pre">UpdateCommandsOutput.txt</span></code> files.  Setting this to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> along
with <code class="docutils literal notranslate"><span class="pre">CTEST_DO_UPDATES=ON</span></code> and doing a submit to CDash will result
“Revision” column being present with the Git SHA1 of the base repo (and a
hyperlink to the commit in the public git repo).  This is useful when
using with a CI testing system that handles all of the git repo
manipulation like GitHub Actions, GitLab CI, or Jenkins.</p>
</div></blockquote>
<p id="ctest-start-with-empty-binary-directory"><code class="docutils literal notranslate"><span class="pre">CTEST_START_WITH_EMPTY_BINARY_DIRECTORY=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then if the binary directory <code class="docutils literal notranslate"><span class="pre">${CTEST_BINARY_DIRECTORY}</span></code>
already exists, then it will be clean out using the CTest command
<code class="docutils literal notranslate"><span class="pre">ctest_empty_binary_directory()</span></code>.  However, this can set to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>
in which case a rebuild (using existing object files, libraries, etc.)
will be performed which is useful when using an incremental CI server.
But this is ignored if <code class="docutils literal notranslate"><span class="pre">CTEST_DO_NEW_START=FALSE</span></code>. Default <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>
(which is the most robust option).</p>
</div></blockquote>
<p id="ctest-do-configure"><code class="docutils literal notranslate"><span class="pre">CTEST_DO_CONFIGURE=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then the selected packages will be configured.  If
<code class="docutils literal notranslate"><span class="pre">FALSE</span></code>, it is assumed that a relevant configure is already in place
in the binary directory if a build or running tests is to be done.  Note
that for the package-by-package mode, a configure is always done if a
build or any testing is to be done but results will not be sent to CDash
unless <code class="docutils literal notranslate"><span class="pre">CTEST_DO_CONFIGURE=TRUE</span></code>. Default <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.</p>
</div></blockquote>
<p id="ctest-wipe-cache"><code class="docutils literal notranslate"><span class="pre">CTEST_WIPE_CACHE=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then <code class="docutils literal notranslate"><span class="pre">${CTEST_BINARY_DIRECTORY}/CMakeCache.txt</span></code> and
<code class="docutils literal notranslate"><span class="pre">${CTEST_BINARY_DIRECTORY}/CMakeFiles/</span></code> will be deleted before
performing a configure.  (This value is set to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> by the <a class="reference external" href="TribitsBuildReference.html#dashboard-submissions">make
dashboard</a> target that does an experimental build, test, and submit to
CDash.)  Default <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> (which is the most robust option in general).</p>
</div></blockquote>
<p id="ctest-do-build"><code class="docutils literal notranslate"><span class="pre">CTEST_DO_BUILD=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then the selected packages will be build.  If <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>, it
is assumed that a relevant build is already in place in the binary
directory if any testing is to be done.  Default <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.</p>
</div></blockquote>
<p id="ctest-build-flags"><code class="docutils literal notranslate"><span class="pre">CTEST_BUILD_FLAGS</span></code></p>
<blockquote>
<div><p>Built-in CTest variable that gives the flags passed to the build command
called inside of the built-in CTest command <code class="docutils literal notranslate"><span class="pre">ctest_build()</span></code>.  The
default is <code class="docutils literal notranslate"><span class="pre">-j2</span></code> when <a class="reference internal" href="#ctest-cmake-generator">CTEST_CMAKE_GENERATOR</a> is set to <code class="docutils literal notranslate"><span class="pre">Unix</span>
<span class="pre">Makefiles</span></code>.  Otherwise, the default is empty “”.  Useful options to set
are <code class="docutils literal notranslate"><span class="pre">-j&lt;N&gt;</span></code> (to build on parallel) and <code class="docutils literal notranslate"><span class="pre">-k</span></code> (to keep going when
there are build errors so we can see all of the build errors).  When
<code class="docutils literal notranslate"><span class="pre">CTEST_CMAKE_GENERATOR</span></code> is set to <code class="docutils literal notranslate"><span class="pre">Ninja</span></code>, the <code class="docutils literal notranslate"><span class="pre">j&lt;N&gt;</span></code> option can
be left off (in which case all of the available unloaded cores are used
to build) and the option <code class="docutils literal notranslate"><span class="pre">-k</span> <span class="pre">999999</span></code> can be used to build all targets
when there are build failures.</p>
</div></blockquote>
<p id="ctest-do-install"><code class="docutils literal notranslate"><span class="pre">CTEST_DO_INSTALL=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then <code class="docutils literal notranslate"><span class="pre">-DCMAKE_SKIP_INSTALL_ALL_DEPENDENCY=ON</span></code> will be
passed th the inner CMake configure and the ‘install_package_by_package’
target will be built to install what has been configured and built by
the build step for the all-at-once mode
(i.e. <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_CTEST_DO_ALL_AT_ONCE=TRUE</span></code>).  If <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>,
then <code class="docutils literal notranslate"><span class="pre">-DCMAKE_SKIP_INSTALL_ALL_DEPENDENCY=ON</span></code> is <strong>not</strong> added to the
inner configure and no install is performed.  (NOTE: The cmake var
<code class="docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code> must be set on the inner cmake configure for
this to work correctly.  Also, the install is currently not implemented
for the package-by-package mode
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_CTEST_DO_ALL_AT_ONCE=FALSE</span></code> and this option will
simply be ignored in that case.)  Default <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>.</p>
</div></blockquote>
<p id="ctest-do-test"><code class="docutils literal notranslate"><span class="pre">CTEST_DO_TEST=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then <code class="docutils literal notranslate"><span class="pre">ctest_test()</span></code> will be called and test results will
be submitted to CDash.  This should be set to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> when one wanted
to only test the configure and build of a project but not run any tests
(e.g. when cross compiling or if the tests are too expensive to run).
The default value is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.</p>
</div></blockquote>
<p id="ctest-parallel-level"><code class="docutils literal notranslate"><span class="pre">CTEST_PARALLEL_LEVEL=&lt;num&gt;</span></code></p>
<blockquote>
<div><p>The parallel level passed in the <code class="docutils literal notranslate"><span class="pre">PARALLEL_LEVEL</span></code> argument to
<code class="docutils literal notranslate"><span class="pre">ctest_test()</span></code> AND <code class="docutils literal notranslate"><span class="pre">ctest_memcheck()</span></code>.  The default value is <code class="docutils literal notranslate"><span class="pre">1</span></code>
(one).</p>
</div></blockquote>
<p id="project-name-inner-enable-tests"><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_INNER_ENABLE_TESTS</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">OFF</span></code>, then <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_TESTS=OFF</span></code> will be passed to
the inner CMake configure.  This will avoid building of all tests and
examples for the enabled packages and also no CTest tests will be
defined using calls to <code class="docutils literal notranslate"><span class="pre">add_test()</span></code> in the inner project configure.
This results in just the building of the libraries and non-test,
non-example executables (which will be much faster for some projects).
The default value is <code class="docutils literal notranslate"><span class="pre">ON</span></code> (in which case all of the test and example
executable and other targets will get built for all of the explicitly
enabled packages and the associated ctest tests will be defined and
run).</p>
</div></blockquote>
<p id="project-name-skip-ctest-add-test"><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SKIP_CTEST_ADD_TEST</span></code>:</p>
<blockquote>
<div><p>If set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SKIP_CTEST_ADD_TEST=TRUE</span></code> is
passed in to the inner CMake configure.  This will result in all of the
test and example executables for the enabled packages to be built but no
ctest tests will get defined and run by skipping the inner CMake calls
to <code class="docutils literal notranslate"><span class="pre">add_test()</span></code>.  Setting this to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> allows all of the
libraries, production executables and the test and example executables
and other targets to get built, but no tests will be run.  However, when
<code class="docutils literal notranslate"><span class="pre">CTEST_DO_TEST=ON</span></code>, the <code class="docutils literal notranslate"><span class="pre">ctest_test()</span></code> command will still be run and
test results will still be submitted to CDash which will report zero
tests.  This avoids the test results being reported as missing on CDash
for tools like <code class="docutils literal notranslate"><span class="pre">ctest_analyze_and_report.py</span></code>.  The default value is
<code class="docutils literal notranslate"><span class="pre">FALSE</span></code> (in which case any enabled tests or examples in the explicitly
enabled packages will get run).</p>
</div></blockquote>
<p id="ctest-do-coverage-testing"><code class="docutils literal notranslate"><span class="pre">CTEST_DO_COVERAGE_TESTING=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then <code class="docutils literal notranslate"><span class="pre">ctest_coverage()</span></code> is called to collect coverage and
submit results generated from the previous <code class="docutils literal notranslate"><span class="pre">ctest_test()</span></code> command.
Setting this to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> also results in
<code class="docutils literal notranslate"><span class="pre">-D${PROJECT_NAME}_ENABLE_COVERAGE_TESTING=ON</span></code> getting passed down to
the inner CMake configure of the project (i.e. so that the executables
are instrumented to generate coverage data when run by the tests in the
<code class="docutils literal notranslate"><span class="pre">ctest_test()</span></code> command).  (Default is <code class="docutils literal notranslate"><span class="pre">OFF</span></code>)</p>
</div></blockquote>
<p id="ctest-coverage-command"><code class="docutils literal notranslate"><span class="pre">CTEST_COVERAGE_COMMAND</span></code></p>
<blockquote>
<div><p>Built-in CTest variable that determines the command that is run by
<code class="docutils literal notranslate"><span class="pre">ctest_coverage()</span></code> to collect coverage results.  That default value is
<code class="docutils literal notranslate"><span class="pre">gcov</span></code>.</p>
</div></blockquote>
<p id="ctest-do-memory-testing"><code class="docutils literal notranslate"><span class="pre">CTEST_DO_MEMORY_TESTING=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then <code class="docutils literal notranslate"><span class="pre">ctest_memcheck()</span></code> is called to run the test suite
with the memory checking tool and results submitted to CDash.</p>
</div></blockquote>
<p id="ctest-memorycheck-command"><code class="docutils literal notranslate"><span class="pre">CTEST_MEMORYCHECK_COMMAND</span></code></p>
<blockquote>
<div><p>Built-in CTest variable that determines the command that is used to run
the command for each test run by the <code class="docutils literal notranslate"><span class="pre">ctest_memcheck()</span></code> command.  If
<code class="docutils literal notranslate"><span class="pre">valgrind</span></code> is found on the local system, then that is used by default.
Otherwise, the default is empty “”.</p>
</div></blockquote>
<p id="ctest-memorycheck-command-options"><code class="docutils literal notranslate"><span class="pre">CTEST_MEMORYCHECK_COMMAND_OPTIONS</span></code></p>
<blockquote>
<div><p>Built-in CTest variable that determines what options are passed to the
memory checking command before the actual test command.  The default
value is empty “”.</p>
</div></blockquote>
<p id="ctest-generate-outer-deps-xml-output-file"><code class="docutils literal notranslate"><span class="pre">CTEST_GENERATE_OUTER_DEPS_XML_OUTPUT_FILE=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then <code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;PackageDependencies.xml</span></code> file will be
generated in the outer CTest -S program.  This file is used to help
determine what packages have changed and need to be tested when in CI
mode (e.g. when <code class="docutils literal notranslate"><span class="pre">CTEST_ENABLE_MODIFIED_PACKAGES_ONLY=TRUE</span></code> is set).
It is also needed to generate the <code class="docutils literal notranslate"><span class="pre">CDashSubprojectDependencies.xml</span></code>
file that gets submitted to CDash to inform it of the list of
subprojects and subproject dependencies (i.e. TriBITS packages).  The
default value is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.</p>
</div></blockquote>
<p id="ctest-submit-cdash-subprojects-deps-file"><code class="docutils literal notranslate"><span class="pre">CTEST_SUBMIT_CDASH_SUBPROJECTS_DEPS_FILE=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then CDash subprojects XML file is generated and submitted
to CDash.  This file tells CDash about the subproject (i.e. TriBITS
package) structure.  The default value is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.</p>
</div></blockquote>
<p id="ctest-do-submit"><code class="docutils literal notranslate"><span class="pre">CTEST_DO_SUBMIT=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then all of the results generated locally are submitted to
CDash using <code class="docutils literal notranslate"><span class="pre">ctest_submit()</span></code>.  One can set this to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> when
locally debugging a CTest -S driver script to avoid spamming CDash.  The
default value is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.  (NOTE: This may submit to more than one
CDash site as noted in <a class="reference internal" href="#specifying-where-the-results-go-to-cdash-tribits-ctest-driver">Specifying where the results go to CDash
(tribits_ctest_driver())</a>).</p>
</div></blockquote>
</div></blockquote>
<p id="determining-how-the-results-are-displayed-on-cdash-tribits-ctest-driver"><strong>Determining how the results are displayed on CDash (tribits_ctest_driver()):</strong></p>
<p>These options all primarily determine how VC update, configure, build, test,
and other results submitted are displayed on CDash (but not what CDash
site(s) or project(s) to which they are submitted, see <a class="reference internal" href="#specifying-where-the-results-go-to-cdash-tribits-ctest-driver">Specifying where the
results go to CDash (tribits_ctest_driver())</a>).  These options can all be
set in the CTest -S script using <code class="docutils literal notranslate"><span class="pre">set()</span></code> statements before
<code class="docutils literal notranslate"><span class="pre">tribits_ctest_driver()</span></code> is called and can be overridden in the env when
running the CTest -S driver script.</p>
<blockquote>
<div><p id="ctest-test-type"><code class="docutils literal notranslate"><span class="pre">CTEST_TEST_TYPE=[Nightly|Continuous|Experimental]</span></code></p>
<blockquote>
<div><p>Determines the model for build.  This value is passed in as the first
argument to the built-in CTest function <code class="docutils literal notranslate"><span class="pre">ctest_start()</span></code>.  Valid values
include <code class="docutils literal notranslate"><span class="pre">Nightly</span></code>, <code class="docutils literal notranslate"><span class="pre">Continuous</span></code>, and <code class="docutils literal notranslate"><span class="pre">Experimental</span></code>.  As far as
CTest is concerned, the only real impact this CTest “Model” has is on
setting the time stamp in the build stamp field (which is stored in the
file <code class="docutils literal notranslate"><span class="pre">Testing/TAG</span></code>).  For the model <code class="docutils literal notranslate"><span class="pre">Nightly</span></code>, the time stamp in the
build stamp is taken from the variable <code class="docutils literal notranslate"><span class="pre">CTEST_NIGHTLY_START_TIME</span></code> read
in from the file <a class="reference internal" href="#projectdir-ctestconfig-cmake">&lt;projectDir&gt;/CTestConfig.cmake</a> file.  Otherwise, the
time stamp used is the current build start time.  (The reason this is
significant is that builds on CDash that have the same site, buildname,
and build stamp are considered the same build and will combine results.)
This also defines the default value for <a class="reference internal" href="#project-name-track">${PROJECT_NAME}_TRACK</a> (see
below) as well as defines the default value for
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_KNOWN_EXTERNAL_REPOS_TYPE</span></code>.  The default value
is <code class="docutils literal notranslate"><span class="pre">Experimental</span></code>.</p>
</div></blockquote>
<p id="project-name-track"><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TRACK=&lt;cdash-group&gt;</span></code></p>
<blockquote>
<div><p>Specifies the testing track that specifies the CDash group for which
results are displayed under (i.e. the “Group” filter field on CDash).
This is the value used for the (deprecated) <code class="docutils literal notranslate"><span class="pre">TRACK</span></code> argument (renamed
<code class="docutils literal notranslate"><span class="pre">GROUP</span></code> in CMake/CTest versions 3.16+) of the built-in CTest function
<code class="docutils literal notranslate"><span class="pre">ctest_start()</span></code>.  The default value is set to <code class="docutils literal notranslate"><span class="pre">${CTEST_TEST_TYPE}</span></code>.
However, if <code class="docutils literal notranslate"><span class="pre">CTEST_TEST_TYPE==Experimental</span></code> (or <code class="docutils literal notranslate"><span class="pre">EXPERIMENTAL</span></code>),
then <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TRACK</span></code> is forced to <code class="docutils literal notranslate"><span class="pre">Experimental</span></code>, even if it
was set to a different value.  The default value can also be set in the
ctest -S driver script itself by setting <code class="docutils literal notranslate"><span class="pre">set(${PROJECT_NAME}_TRACK</span>
<span class="pre">&lt;cdash-group&gt;)</span></code>.  And, of course, if the environment variable <code class="docutils literal notranslate"><span class="pre">export</span>
<span class="pre">&lt;Project&gt;_TRACK=&lt;cdash-group&gt;</span></code> is set, then that value will be used for
the CDash Track/Group to submit results to.</p>
</div></blockquote>
<p id="ctest-site"><code class="docutils literal notranslate"><span class="pre">CTEST_SITE=&lt;site-name&gt;</span></code></p>
<blockquote>
<div><p>This is a built-in CTest variable that determines what is displayed for
the <code class="docutils literal notranslate"><span class="pre">site</span></code> field for the build on CDash.  This specified by default by
calling the built-in CMake/CTest function <code class="docutils literal notranslate"><span class="pre">site_name()</span></code>.</p>
</div></blockquote>
<p id="compiler-version"><code class="docutils literal notranslate"><span class="pre">COMPILER_VERSION=&lt;compiler-version&gt;</span></code></p>
<blockquote>
<div><p>Gives the name of the compiler that is used to compose a default
<a class="reference internal" href="#ctest-build-name">CTEST_BUILD_NAME</a>.  If <code class="docutils literal notranslate"><span class="pre">CTEST_BUILD_NAME</span></code> is explicitly set, then
this value is ignored.</p>
</div></blockquote>
<p id="ctest-build-name"><code class="docutils literal notranslate"><span class="pre">CTEST_BUILD_NAME=&lt;build-name&gt;</span></code></p>
<blockquote>
<div><p>This is a built-in CTest variable that determines the name of the build
on CDash.  Builds that have the same <code class="docutils literal notranslate"><span class="pre">CTEST_SITE</span></code>,
<code class="docutils literal notranslate"><span class="pre">CTEST_BUILD_NAME</span></code> and <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TRACK</span></code> are considered to be
related builds and CDash will relate them as “previous” and “next”
builds (good for showing number of added or removed tests, new test
failures, new passing tests, etc.).  If not specified, it is given the
default value <code class="docutils literal notranslate"><span class="pre">${HOST_TYPE}-${COMPILER_VERSION}-${BUILD_DIR_NAME}</span></code>.
Here, <code class="docutils literal notranslate"><span class="pre">HOST_TYPE</span></code> is determined automatically from the <code class="docutils literal notranslate"><span class="pre">uname</span></code>
system command using <code class="docutils literal notranslate"><span class="pre">find_program(uname)</span></code>.  The value of
<code class="docutils literal notranslate"><span class="pre">BUILD_DIR_NAME</span></code> is expected to be set in each specific CTest -S
driver script.</p>
</div></blockquote>
<p id="ctest-notes-files"><code class="docutils literal notranslate"><span class="pre">CTEST_NOTES_FILES=&quot;&lt;filepath1&gt;;&lt;filepath2&gt;;...&quot;</span></code></p>
<blockquote>
<div><p>Built-in CTest variable that specifies a semi-colon separated list of
files that will get uploaded to CDash as “notes files”.  This function
will also add notes files as well such as the file
<code class="docutils literal notranslate"><span class="pre">CMakeCache.clean.txt</span></code> (cleaned-up version of the CMakeCache.txt
file), the file <code class="docutils literal notranslate"><span class="pre">Updates.txt</span></code> (lists new git commits pulled in all the
git repos), the file <code class="docutils literal notranslate"><span class="pre">UpdateCommandsOutput.txt</span></code> (list of commands and
their output which are run by <code class="docutils literal notranslate"><span class="pre">ctest_update()</span></code> in the base git repo),
and the file <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}RepoVersion.txt</span></code> (gives version of all
the git repos being tested).</p>
</div></blockquote>
<p id="ctest-change-id"><code class="docutils literal notranslate"><span class="pre">CTEST_CHANGE_ID</span></code></p>
<blockquote>
<div><p>Built-in CTest variable that can be used to set to an integer for the
GitHub Pull Request (PR) ID or GitLab Merge Request (MR) ID (or other
such repository and development management system’s change control ID).
If the CDash project is properly configured to point to the GitHub or
GitLab (or other supported) repository for the project, then CDash will
put a hyper-linked icon beside the build name that links back to the PR
or MR issue with that ID.  It may also be used for other purposes as
well in the future.</p>
</div></blockquote>
</div></blockquote>
<p id="specifying-where-the-results-go-to-cdash-tribits-ctest-driver"><strong>Specifying where the results go to CDash (tribits_ctest_driver()):</strong></p>
<p>By default, the target CDash server and CDash project are specified by the
variables set in the file <a class="reference internal" href="#projectdir-ctestconfig-cmake">&lt;projectDir&gt;/CTestConfig.cmake</a>; specifically,
<code class="docutils literal notranslate"><span class="pre">CTEST_DROP_SITE</span></code>, <code class="docutils literal notranslate"><span class="pre">CTEST_PROJECT_NAME</span></code>, and <code class="docutils literal notranslate"><span class="pre">CTEST_DROP_LOCATION</span></code>.
If these are set using <a class="reference internal" href="#set-default-and-from-env">set_default_and_from_env()</a>, as shown in the
example <code class="docutils literal notranslate"><span class="pre">TribitsExampleProject/CTestConfig.cmake</span></code> file, then they can be
overridden with <code class="docutils literal notranslate"><span class="pre">set()</span></code> statements in the CTest -S script or as env vars;
simple enough.</p>
<p>In addition, results can be sent to a second CDash site using the variables:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">TRIBITS_2ND_CTEST_DROP_SITE</span></code></p>
<blockquote>
<div><p>CDash drop site for second upload of results.  If empty, then
<code class="docutils literal notranslate"><span class="pre">CTEST_DROP_SITE</span></code> is used.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">TRIBITS_2ND_CTEST_DROP_LOCATION</span></code></p>
<blockquote>
<div><p>Location for the second drop site.  If empty, then
<code class="docutils literal notranslate"><span class="pre">CTEST_DROP_LOCATION</span></code> is used.</p>
</div></blockquote>
</div></blockquote>
<p>At lease one of these vars must be set to non empty or a second submit will
not be performed.  For more details, see <a class="reference external" href="TribitsBuildReference.html#tribits-2nd-ctest-drop-site">TRIBITS_2ND_CTEST_DROP_SITE</a> and
<a class="reference external" href="TribitsBuildReference.html#tribits-2nd-ctest-drop-location">TRIBITS_2ND_CTEST_DROP_LOCATION</a>.</p>
<p id="links-to-results-on-cdash-tribits-ctest-driver"><strong>Links to results on CDash (tribits_ctest_driver()):</strong></p>
<p>Links to where the results will be posted on CDash are printed to STDOUT
before it performs any actions and at end after all of the actions and
submits have been completed.</p>
<p>The results are printed to STDOUT in a section that looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Link</span> <span class="n">to</span> <span class="n">this</span> <span class="n">build</span><span class="s1">&#39;s results on CDash:</span>

  <span class="o">&lt;</span><span class="n">cdash</span><span class="o">-</span><span class="n">build</span><span class="o">-</span><span class="n">url</span><span class="o">&gt;</span>

<span class="n">Link</span> <span class="n">to</span> <span class="nb">all</span> <span class="n">builds</span> <span class="k">for</span> <span class="n">this</span> <span class="n">repo</span> <span class="n">version</span> <span class="n">on</span> <span class="n">CDash</span><span class="p">:</span>

  <span class="o">&lt;</span><span class="n">cdash</span><span class="o">-</span><span class="n">revision</span><span class="o">-</span><span class="n">builds</span><span class="o">-</span><span class="n">url</span><span class="o">&gt;</span>

<span class="n">Link</span> <span class="n">to</span> <span class="nb">all</span> <span class="n">nonpassing</span> <span class="n">tests</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">builds</span> <span class="k">for</span> <span class="n">this</span> <span class="n">repo</span> <span class="n">version</span> <span class="n">on</span> <span class="n">CDash</span><span class="p">:</span>

  <span class="o">&lt;</span><span class="n">cdash</span><span class="o">-</span><span class="n">revision</span><span class="o">-</span><span class="n">nonpassing</span><span class="o">-</span><span class="n">tests</span><span class="o">-</span><span class="n">url</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The URL <code class="docutils literal notranslate"><span class="pre">&lt;cdash-build-url&gt;</span></code> is created from the buildname, site, and
buildstartime fields which is known from the TAG file created by CTest.
This allows access the results for this particular build on CDash by just
clicking that link.</p>
<p>The URL <code class="docutils literal notranslate"><span class="pre">&lt;cdash-revision-builds-url&gt;</span></code> provides a link to a CDash
<code class="docutils literal notranslate"><span class="pre">index.php</span></code> query that includes all of the builds with the same base Git
repo SHA1.  This allows comparing the results of this build for other builds
for this same version of the base Git repository.</p>
<p>The URL <code class="docutils literal notranslate"><span class="pre">&lt;cdash-revision-nonpassing-tests-url&gt;</span></code> gives a link to a CDash
<code class="docutils literal notranslate"><span class="pre">queryTests.php</span></code> query for all of the nonpassing tests for all of the
builds with this same base project Git repo SHA1.  This allows comparing
test failures across all of the builds for the same base project Git repo
version.</p>
<p>NOTE: The links <code class="docutils literal notranslate"><span class="pre">&lt;cdash-revision-builds-url&gt;</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;cdash-revision-nonpassing-tests-url&gt;</span></code> are only provided if the base
project Git repo has the <code class="docutils literal notranslate"><span class="pre">.git/</span></code> subdirectory and if <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">log</span></code>
successfully returns the SHA1 for that base Git repo.</p>
<p>NOTE: The links <code class="docutils literal notranslate"><span class="pre">&lt;cdash-revision-builds-url&gt;</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;cdash-revision-nonpassing-tests-url&gt;</span></code> only consider the Git SHA1 of the
base project Git repo.  For multi-repo projects (see <a class="reference internal" href="#multi-repository-support">Multi-Repository
Support</a>), you may get results for builds with different subrepo versions
and therefore may be comparing apples and oranges.  (Projects that commit a
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;SubRepoVersion.txt</span></code> file to their base Git repo or use Git
Submodules will have unique base project Git repo SHA1s for different
versions of the project’s repos.)</p>
<p>In addition, a text file <code class="docutils literal notranslate"><span class="pre">CDashResults.txt</span></code> will be written in the build
directory that contains this same CDash link information shown above.  This
allows a process to cat the file <code class="docutils literal notranslate"><span class="pre">CDashResults.txt</span></code> to get links to the
results on CDash.</p>
<p id="determining-what-tribits-repositories-are-included-tribits-ctest-driver"><strong>Determining what TriBITS repositories are included (tribits_ctest_driver()):</strong></p>
<p>This script is set up to process extra VC and TriBITS repos that contribute
additional TriBITS packages to the base TriBITS project.  This set of extra
repos is determined using the following vars (which can be set in the CTest
-S script or overridden with env vars of the same name):</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_EXTRAREPOS_FILE=&lt;extrarepos-file-path&gt;</span></code></p>
<blockquote>
<div><p>Points to a file that lists the extra VC and TriBITS repos. If not
explicitly set, then by default it will read from the file
<a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> unless
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_SKIP_EXTRAREPOS_FILE=TRUE</span></code> is set in the
<code class="docutils literal notranslate"><span class="pre">ProjectName.cmake</span></code> file in which case no extra repos file is read in.
See <a class="reference external" href="TribitsBuildReference.html#project-extrarepos-file">&lt;Project&gt;_EXTRAREPOS_FILE</a>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_KNOWN_EXTERNAL_REPOS_TYPE=[Nightly|Continuous|Experimental]</span></code></p>
<blockquote>
<div><p>The category of extra repos to process from the file
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_EXTRAREPOS_FILE</span></code> (see
<a class="reference external" href="TribitsBuildReference.html#project-enable-known-external-repos-type">&lt;Project&gt;_ENABLE_KNOWN_EXTERNAL_REPOS_TYPE</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_PRE_REPOSITORIES=&lt;reponame1&gt;,&lt;reponame2&gt;,...</span></code></p>
<blockquote>
<div><p>Subset of “pre” extra repos specified in the file
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_EXTRAREPOS_FILE</span></code> to process (see
<a class="reference external" href="TribitsBuildReference.html#project-pre-repositories">&lt;Project&gt;_PRE_REPOSITORIES</a>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_EXTRA_REPOSITORIES=&lt;reponame1&gt;,&lt;reponame2&gt;,...</span></code></p>
<blockquote>
<div><p>Subset of “post” extra repos specified in the file
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_EXTRAREPOS_FILE</span></code> to process (see
<a class="reference external" href="TribitsBuildReference.html#project-extra-repositories">&lt;Project&gt;_EXTRA_REPOSITORIES</a>).</p>
</div></blockquote>
</div></blockquote>
<p>The behavior for selecting extra repos using these variables is determined
as described in:</p>
<ul class="simple">
<li><p><a class="reference external" href="TribitsBuildReference.html#enabling-extra-repositories-through-a-file">Enabling extra repositories through a file</a></p></li>
</ul>
<p id="all-at-once-versus-package-by-package-mode-tribits-ctest-driver"><strong>All-at-once versus package-by-package mode (tribits_ctest_driver()):</strong></p>
<p>This function supports driving the configure, build, testing, and submitting
to CDash of the packages in the TriBITS project either all-at-once or
package-by-package, based on the vars (which can be set in the CTest -S
script and overridden by env vars):</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_CTEST_DO_ALL_AT_ONCE=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>If <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then single calls to <code class="docutils literal notranslate"><span class="pre">ctest_configure()</span></code>,
<code class="docutils literal notranslate"><span class="pre">ctest_build()</span></code> and <code class="docutils literal notranslate"><span class="pre">ctest_test()</span></code> are made for all of the packages
to be tested all at once with <code class="docutils literal notranslate"><span class="pre">ctest_submit()</span></code> called after each of
these.  If <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> then <code class="docutils literal notranslate"><span class="pre">ctest_configure()</span></code>, <code class="docutils literal notranslate"><span class="pre">ctest_build()</span></code> and
<code class="docutils literal notranslate"><span class="pre">ctest_test()</span></code> and <code class="docutils literal notranslate"><span class="pre">ctest_submit()</span></code> are called in a loop, once for
each package to be explicitly tested.</p>
</div></blockquote>
</div></blockquote>
<p>Both the all-at-once mode and the package-by-package mode should produce
equivalent builds of the project and submits to CDash (for correctly
constructed TriBITS projects and packages).  But the package-by-package mode
will disable packages with failing library builds when processing downstream
packages, and therefore reduce the propagation of failures to downstream
packages and therefore is more robust.  But the package-by-package mode is
more expensive in several respects for many projects.</p>
<p>For versions of CMake 3.17.0 and above and newer versions of CDash, the
CDash server for the all-at-once mode will break down build and test results
on a package-by-package basis on CDash together.</p>
<p id="multiple-ctest-s-invocations-tribits-ctest-driver"><strong>Multiple ctest -S invocations (tribits_ctest_driver()):</strong></p>
<p>By default, this function is meant to be used in a single invocation of the
<code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-S</span> <span class="pre">&lt;script&gt;.cmake</span></code> command in order to do everything from the
beginning and submit to CDash.  But there are times when one needs to do the
various steps in multiple <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-S</span></code> invocations that all send data to the
same CDash build.  For example, on some clusters, configure and build must
be done on “compile nodes” but the tests must be run on “compute nodes”.
Typically, these types of machines have a shared file system.  On a system
like this, one would use two different invocations as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start new dashboard, update, configure, and build on compile node</span>
<span class="n">env</span> <span class="n">CTEST_DO_TEST</span><span class="o">=</span><span class="n">OFF</span> \
  <span class="n">ctest</span> <span class="o">-</span><span class="n">S</span> <span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;.</span><span class="n">cmake</span>

<span class="c1"># Run tests only on compute node</span>
<span class="o">&lt;</span><span class="n">run</span><span class="o">-</span><span class="n">on</span><span class="o">-</span><span class="n">compute</span><span class="o">-</span><span class="n">node</span><span class="o">&gt;</span> \
  <span class="n">env</span> <span class="n">CTEST_DO_NEW_START</span><span class="o">=</span><span class="n">OFF</span> <span class="n">CTEST_DO_UPDATES</span><span class="o">=</span><span class="n">OFF</span> \
    <span class="n">CTEST_DO_CONFIGURE</span><span class="o">=</span><span class="n">OFF</span> <span class="n">CTEST_DO_BUILD</span><span class="o">=</span><span class="n">OFF</span> \
    <span class="n">CTEST_DO_TEST</span><span class="o">=</span><span class="n">ON</span> \
  <span class="n">ctest</span> <span class="o">-</span><span class="n">S</span> <span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;.</span><span class="n">cmake</span>
</pre></div>
</div>
<p>Above, <a class="reference internal" href="#ctest-do-new-start">CTEST_DO_NEW_START</a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">OFF</span></code> is needed to ensure that the test
results go to the same CDash build.  (NOTE: A CDash build is uniquely
determined by the site name, build name and build stamp.)</p>
<p>This approach works for both the all-at-once mode and the package-by-package
mode.</p>
<p>Also, one can run each of the basic steps in its own <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-S</span></code> invocation
starting with <code class="docutils literal notranslate"><span class="pre">CTEST_DO_NEW_START</span> <span class="pre">=</span> <span class="pre">ON</span></code>, then <a class="reference internal" href="#ctest-do-updates">CTEST_DO_UPDATES</a> <code class="docutils literal notranslate"><span class="pre">=</span>
<span class="pre">ON</span></code>, then <a class="reference internal" href="#ctest-do-configure">CTEST_DO_CONFIGURE</a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">ON</span></code>, then <a class="reference internal" href="#ctest-do-build">CTEST_DO_BUILD</a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">ON</span></code>,
then then <a class="reference internal" href="#ctest-do-test">CTEST_DO_TEST</a> <code class="docutils literal notranslate"><span class="pre">=</span> <span class="pre">ON</span></code>, etc.  While there is typically no
reason to split things up to this level of granularity, CTest and this
<code class="docutils literal notranslate"><span class="pre">tribits_ctest_driver()</span></code> function will support such usage.  All that is
required is that those steps be performed in that order.  For example, one
cannot do a build in one <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-S</span></code> invocation and then try to do a
configure in the next because the build will fail because a valid
configuration has not been performed yet.  And one cannot run just tests if
there is not a valid configuration and build already in place.</p>
<p id="repository-updates-tribits-ctest-driver"><strong>Repository Updates (tribits_ctest_driver()):</strong></p>
<p>Like the rest of TriBITS, <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">-S</span></code> scripts written using this function
support a collection of extra repositories in addition to the base git
repository.</p>
<p>Whether the local repos are updated (or left as is) is determined by the
variable:</p>
<blockquote>
<div><p id="ctest-do-updates"><code class="docutils literal notranslate"><span class="pre">CTEST_DO_UPDATES=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>If set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then each of the git repos will be cloned if they do
not already exist and if already present will be updated as described
below (and will wipe out any local changes).  If set to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>, then
the git repos will be left alone and must therefore already be cloned and
updated at the desired state.  For example, this should be set to
<code class="docutils literal notranslate"><span class="pre">FALSE</span></code> when running against a local development repo (e.g. the <a class="reference external" href="TribitsBuildReference.html#dashboard-submissions">make
dashboard</a> target sets this to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> automatically) or when other
logic is used to setup the source directories. <strong>WARNING:</strong> If you are
running against a local repo with local changes and you don’t set to
<code class="docutils literal notranslate"><span class="pre">FALSE</span></code>, then your local uncommitted changes will be wiped out and the
local branch will be hard reset to the remote tracking branch!  The
default value is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.</p>
</div></blockquote>
</div></blockquote>
<p><strong>WARNING:</strong> If you don’t want local changes in your git repos to get blown
away, then set <code class="docutils literal notranslate"><span class="pre">CTEST_DO_UPDATES</span></code> to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>!</p>
<p>If the base repo pointed to by <code class="docutils literal notranslate"><span class="pre">${CTEST_SOURCE_DIRECTORY}</span></code> is missing, it
cloned inside of the <code class="docutils literal notranslate"><span class="pre">ctest_start()</span></code> function using the custom command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>git clone [-b ${${PROJECT_NAME}_BRANCH}] \
  -o ${${PROJECT_NAME}_GIT_REPOSITORY_REMOTE} \
  ${${PROJECT_NAME}_REPOSITORY_LOCATION}
</pre></div>
</div>
<p>where:</p>
<blockquote>
<div><p id="project-name-repository-location"><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_REPOSITORY_LOCATION=&lt;repo-url&gt;</span></code></p>
<blockquote>
<div><p>The URL of the base git repo <code class="docutils literal notranslate"><span class="pre">&lt;repo-url&gt;</span></code> to clone inside of
<code class="docutils literal notranslate"><span class="pre">ctest_start()</span></code>.  The default is
<code class="docutils literal notranslate"><span class="pre">${${PROJECT_NAME}_REPOSITORY_LOCATION_NIGHTLY_DEFAULT}</span></code> when
<code class="docutils literal notranslate"><span class="pre">CTEST_TEST_TYPE=Nightly</span></code> and otherwise the default is
<code class="docutils literal notranslate"><span class="pre">${${PROJECT_NAME}_REPOSITORY_LOCATION_DEFAULT}</span></code>.</p>
</div></blockquote>
<p id="project-name-git-repository-remote"><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_GIT_REPOSITORY_REMOTE=&lt;remote-name&gt;</span></code></p>
<blockquote>
<div><p>The git remote name given to the cloned repo.  This is needed for robust
git operations as described below (Default ‘origin’).  If a repo is
already cloned, then a remote in the already existing repo must exist
with this name or</p>
</div></blockquote>
<p id="project-name-branch"><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_BRANCH=&lt;branch&gt;</span></code></p>
<blockquote>
<div><p>The branch of the base repo to explicitly checkout after clone (and on
each update).  The value of empty “” is allowed which results in the
default branch being checked out on clone (and the <code class="docutils literal notranslate"><span class="pre">-b</span> <span class="pre">&lt;branch&gt;</span></code>
argument to be omitted from the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span></code> command).  The default
value determined by the variable
<code class="docutils literal notranslate"><span class="pre">${${PROJECT_NAME}_REPOSITORY_BRANCH}}</span></code>.  The default value for
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_REPOSITORY_BRANCH</span></code> is empty.</p>
</div></blockquote>
</div></blockquote>
<p>If the base repo already exists, no initial clone is performed and it is
assumed that it is in a state to allow it to be updated as described below.</p>
<p>After the base repo is cloned, any missing extra git repositories are cloned
using CMake/CTest code in this <code class="docutils literal notranslate"><span class="pre">tribits_ctest_driver()</span></code> function (raw
CTest does not support cloning a list of extra repos) using the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>git clone [-b ${${PROJECT_NAME}_EXTRAREPO_BRANCH}] \
  -o ${${PROJECT_NAME}_GIT_REPOSITORY_REMOTE} \
  &lt;extrarepo_url&gt;
</pre></div>
</div>
<p>where:</p>
<blockquote>
<div><p id="project-name-extrarepos-branch"><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_EXTRAREPOS_BRANCH=&lt;extrarepo-branch&gt;</span></code></p>
<blockquote>
<div><p>The branch <code class="docutils literal notranslate"><span class="pre">&lt;extrarepo-branch&gt;</span></code> that each extra VC repo that is
checked out.  The default value is set to <code class="docutils literal notranslate"><span class="pre">${${PROJECT_NAME}_BRANCH}</span></code>.
If empty “”, then the <code class="docutils literal notranslate"><span class="pre">-b</span> <span class="pre">&lt;branch&gt;</span></code> argument is omitted from the <code class="docutils literal notranslate"><span class="pre">git</span>
<span class="pre">clone</span></code> command.  (NOTE: Checking out a separate branch on the extra
repos from the base repo was needed for backward compatibility for the
Trilinos project and is not recommended usage as it violates the “single
branch” approach for using <a class="reference internal" href="#gitdist">gitdist</a>.)</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">&lt;extrarepo_url&gt;</span></code></p>
<blockquote>
<div><p>The git repo remote URL given in the file
<a class="reference external" href="TribitsBuildReference.html#project-extrarepos-file">${PROJECT_NAME}_EXTRAREPOS_FILE</a>.</p>
</div></blockquote>
</div></blockquote>
<p>When <code class="docutils literal notranslate"><span class="pre">CTEST_DO_UPDATES=TRUE</span></code> (after a possible initial clone), the
function <code class="docutils literal notranslate"><span class="pre">ctest_update()</span></code> is called to update the base git repo.  The base
git repo is updated with the custom git commands executed inside of the
<code class="docutils literal notranslate"><span class="pre">ctest_update()</span></code> using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git fetch ${${PROJECT_NAME}_GIT_REPOSITORY_REMOTE}
$ git clean -fdx         # Remove untracked ignored files
$ git reset --hard HEAD  # Clean files and set ORIG_HEAD to HEAD
$ git checkout -B ${${PROJECT_NAME}_BRANCH} \
    --track origin/${${PROJECT_NAME}_BRANCH}   # Sets HEAD
</pre></div>
</div>
<p>The above set of commands are the maximally robust way to update a git repo.
They will correct any local state of the local repo and will put the local
repo on the requested local tracking branch.  It can handled hard-reset
remote branches, previous tracking branch now missing, etc.  The only
requirement is that the remote repo pointed to at
<code class="docutils literal notranslate"><span class="pre">${${PROJECT_NAME}_GIT_REPOSITORY_REMOTE}</span></code> is valid and has not changed
since the repo was first cloned.  (NOTE: A future version of TriBITS may
automate the update of this git remote.)</p>
<p>If <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_BRANCH</span></code> is empty “”, the last <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">-B</span>
<span class="pre">&lt;branch&gt;</span> <span class="pre">...</span></code> command is replaced with the git command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git reset --hard @{u}  # Sets HEAD
</pre></div>
</div>
<p>After the base git repo is updated inside of <code class="docutils literal notranslate"><span class="pre">ctest_update()</span></code> as described
above, each of the extra repos is updated using a similar set of git
commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git fetch ${${PROJECT_NAME}_GIT_REPOSITORY_REMOTE}
$ git clean -fdx         # Remove untracked ignored files
$ git reset --hard HEAD  # Clean files and set ORIG_HEAD to HEAD
$ git checkout -B ${${PROJECT_NAME}_EXTRAREPO_BRANCH} \
    --track origin/${${PROJECT_NAME}_EXTRAREPO_BRANCH}  # Sets HEAD
</pre></div>
</div>
<p>where if <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_EXTRAREPO_BRANCH</span></code> is empty, the last <code class="docutils literal notranslate"><span class="pre">git</span>
<span class="pre">checkout</span> <span class="pre">-B</span> <span class="pre">&lt;branch&gt;</span> <span class="pre">...</span></code> command replaced with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git reset --hard @{u}
</pre></div>
</div>
<p><strong>WARNING:</strong> This version of the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">-B</span> <span class="pre">&lt;branch&gt;</span> <span class="pre">...</span></code> command
is not supported in older versions of git.  Therefore, a newer version of
git is required when using named branches.</p>
<p>The command <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">-fdx</span></code> removes any untracked ignored files that may
have been created since the last update (either by the build process or by
someone messing around in that local git repository).  The command <code class="docutils literal notranslate"><span class="pre">git</span>
<span class="pre">reset</span> <span class="pre">--hard</span> <span class="pre">HEAD</span></code> removes any untracked non-ignored files, any modified
tracked files, and sets <code class="docutils literal notranslate"><span class="pre">ORIG_HEAD</span></code> to the current <code class="docutils literal notranslate"><span class="pre">HEAD</span></code>.  This sets
<code class="docutils literal notranslate"><span class="pre">ORIG_HEAD</span></code> after the initial clone (which is needed since <code class="docutils literal notranslate"><span class="pre">ORIG_HEAD</span></code>
is not set after the initial <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span></code> command).  This allows using the
range <code class="docutils literal notranslate"><span class="pre">ORIG_HEAD..HEAD</span></code> with <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">diff</span></code> and <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">log</span></code> commands even
after the initial clone.  (Directly after the initial clone, the range
<code class="docutils literal notranslate"><span class="pre">ORIG_HEAD..HEAD</span></code> will be empty). The git commands <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">-B</span>
<span class="pre">&lt;branch&gt;</span> <span class="pre">&lt;remote&gt;/&lt;branch&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">reset</span> <span class="pre">--hard</span> <span class="pre">&#64;{u}</span></code> are used to update
the local repo to match the remote tracking branch.  This is done to deal
with a possible forced push of the remote tracking branch or even changing
to different tracking branch (when using an explicit <code class="docutils literal notranslate"><span class="pre">&lt;branch&gt;</span></code> name).</p>
<p>Note that the repository updating approach described above using non-empty
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_BRANCH</span></code> is more robust, because it can recover from a
state where someone may have put a repo on a detached head or checked out a
different branch.  One of these repos might get into this state when a
person is messing around in the Nightly build and source directories to try
to figure out what happened and forgot to put the repos back on the correct
tracking branch.  Therefore, it is recommended to always set an explicit
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_BRANCH</span></code> to a non-null value like <code class="docutils literal notranslate"><span class="pre">master</span></code> or
<code class="docutils literal notranslate"><span class="pre">develop</span></code> for the git repos, even if this branch is the default repo
branch.</p>
<p id="other-ctest-driver-options-tribits-ctest-driver"><strong>Other CTest Driver options (tribits_ctest_driver()):</strong></p>
<p>Other miscellaneous vars that can be set in the CTest -S script or as env
vars are given below.</p>
<blockquote>
<div><p id="ctest-cmake-generator"><code class="docutils literal notranslate"><span class="pre">CTEST_CMAKE_GENERATOR=&quot;[Unix</span> <span class="pre">Makefiles|Ninja|..]&quot;</span></code></p>
<blockquote>
<div><p>Built-in CTest variable that determines the CMake generator used in the
inner configure.  If an existing <code class="docutils literal notranslate"><span class="pre">CMakeCache.txt</span></code> file exists, then
the default value for the generator will be read out of that file.
Otherwise, the default generator is selected to be <code class="docutils literal notranslate"><span class="pre">Unix</span> <span class="pre">Makefiles</span></code>.
Another popular option is <code class="docutils literal notranslate"><span class="pre">Ninja</span></code>.  The value of this variable
determines the type of generator used in the inner CMake configure done
by the command <code class="docutils literal notranslate"><span class="pre">ctest_configure(...)</span></code> called in this function.  This
is done implicitly by CTest.  The selected generator has an impact on
what flags can be used in <a class="reference internal" href="#ctest-build-flags">CTEST_BUILD_FLAGS</a> since <code class="docutils literal notranslate"><span class="pre">make</span></code> and
<code class="docutils literal notranslate"><span class="pre">ninja</span></code> accept different arguments in some cases.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_DEVELOPMENT_MODE=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>Puts TriBITS configure into development mode (vs. release mode) in the
outer CTest -S script.  The default is provided by
<code class="docutils literal notranslate"><span class="pre">${${PROJECT_NAME}_ENABLE_DEVELOPMENT_MODE_DEFAULT}}</span></code> (which is
typically set in the <a class="reference internal" href="#projectdir-version-cmake">&lt;projectDir&gt;/Version.cmake</a> file).  See
<a class="reference external" href="TribitsBuildReference.html#project-enable-development-mode">&lt;Project&gt;_ENABLE_DEVELOPMENT_MODE</a>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_VERBOSE_CONFIGURE=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>Make TriBITS run in verbose mode.  (Useful for debugging hard problems.)
See <a class="reference external" href="TribitsBuildReference.html#project-verbose-configure">&lt;Project&gt;_VERBOSE_CONFIGURE</a>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">CTEST_CONFIGURATION_UNIT_TESTING=[TRUE|FALSE]</span></code></p>
<blockquote>
<div><p>If set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then <code class="docutils literal notranslate"><span class="pre">tribits_ctest_driver()</span></code> is put in unit
testing mode and does not actually drive configure, build, test, and
submit.  This is used to drive automated testing of the code in
<code class="docutils literal notranslate"><span class="pre">tribits_ctest_driver()</span></code>.</p>
</div></blockquote>
</div></blockquote>
<p id="return-value-tribits-ctest-driver"><strong>Return value (tribits_ctest_driver()):</strong></p>
<p>Currently, the ctest -S script will return 0 if all of the requested
operations completed without failure.  That is, the update, configure,
build, tests, coverage, dynamic analysis and submits must pass with no CMake
errors in order for a 0 return code to be returned.  Therefore, the return
code from the ctest -S script can be used to drive other automated processes
that require all passing builds and tests.</p>
<p>ToDo: Add another mode that will return 0 if no errors are reported in the
ctest -S driver script but ignore configure, build, and test failures that
are submitted to a CDash site (and therefore will be reported there).</p>
<p>In: ctest_driver/TribitsCTestDriverCore.cmake:213</p>
</section>
<section id="tribits-determine-if-current-package-needs-rebuilt">
<h3><a class="toc-backref" href="#id139">tribits_determine_if_current_package_needs_rebuilt()</a><a class="headerlink" href="#tribits-determine-if-current-package-needs-rebuilt" title="Permalink to this heading"></a></h3>
<p>Determine at configure time if any of the upstream dependencies for a
package require the current package to be rebuilt.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_determine_if_current_package_needs_rebuilt</span><span class="p">(</span>
  <span class="p">[</span><span class="n">SHOW_MOST_RECENT_FILES</span><span class="p">]</span>
  <span class="p">[</span><span class="n">SHOW_OVERALL_MOST_RECENT_FILES</span><span class="p">]</span>
  <span class="n">CURRENT_PACKAGE_OUT_OF_DATE_OUT</span> <span class="o">&lt;</span><span class="n">currentPackageOutOfDate</span><span class="o">&gt;</span>
  <span class="p">)</span>
</pre></div>
</div>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">SHOW_MOST_RECENT_FILES</span></code></p>
<blockquote>
<div><p>If specified, then the most recently modified file for each individual
base source and binary directory searched will be will be printed the
STDOUT.  Setting this implies <code class="docutils literal notranslate"><span class="pre">SHOW_OVERALL_MOST_RECENT_FILE</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">SHOW_OVERALL_MOST_RECENT_FILE</span></code></p>
<blockquote>
<div><p>If specified, then only the most recent modified file over all of the
individual directories for each category (i.e. one for upstream SE
package source dirs, one for upstream SE package binary dirs, one for
the package’s source dir, and one for the package’s own binary dir) is
printed to STDOUT.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">CURRENT_PACKAGE_OUT_OF_DATE_OUT</span> <span class="pre">&lt;currentPackageOutOfDate&gt;</span></code></p>
<blockquote>
<div><p>On output, the local variable <code class="docutils literal notranslate"><span class="pre">&lt;currentPackageOutOfDate&gt;</span></code> will be set
to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> if any of the upstream most modified files are more recent
than the most modified file in the package’s binary directory.
Otherwise, this variable is set to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>.</p>
</div></blockquote>
</div></blockquote>
<p><strong>Description:</strong></p>
<p>This function is designed to help take an externally configured and built
piece of software (that generates libraries) and wrap it as a TriBITS
package or subpackage.  This function uses the lower-level functions:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#tribits-find-most-recent-source-file-timestamp">tribits_find_most_recent_source_file_timestamp()</a></p></li>
<li><p><a class="reference internal" href="#tribits-find-most-recent-binary-file-timestamp">tribits_find_most_recent_binary_file_timestamp()</a></p></li>
</ul>
<p>to determine the most recent modified files in the upstream TriBITS SE
packages’ source and binary directories as well as the most recent source
file for the current package.  It then compares these timestamps to the most
recent binary file timestamp in this package’s binary directory.  If any of
these three files are more recent than this package’s most recent binary
file, then the output variable <code class="docutils literal notranslate"><span class="pre">&lt;currentPackageOutOfDate&gt;</span></code> is set to
<code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.  Otherwise, it is set to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>.</p>
<p>NOTE: The source and binary directories for full packages are searched, not
individual subpackage dirs.  This is to reduce the number of dirs searched.
This will, however, result in changes in non-dependent subpackages being
considered as well.</p>
<p>See the demonstration of the usage of this function in the <code class="docutils literal notranslate"><span class="pre">WrapExternal</span></code>
package in <a class="reference internal" href="#tribitsexampleproject">TribitsExampleProject</a>.</p>
<p>In: core/package_arch/TribitsFindMostRecentFileTimestamp.cmake:471</p>
</section>
<section id="tribits-disable-package-on-platforms">
<h3><a class="toc-backref" href="#id140">tribits_disable_package_on_platforms()</a><a class="headerlink" href="#tribits-disable-package-on-platforms" title="Permalink to this heading"></a></h3>
<p>Disable a package automatically for a list of platforms.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_disable_package_on_platforms</span><span class="p">(</span> <span class="o">&lt;</span><span class="n">packageName</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">hosttype0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">hosttype1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>If any of the host-type arguments <code class="docutils literal notranslate"><span class="pre">&lt;hosttypei&gt;</span></code> matches the
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_HOSTTYPE</span></code> variable for the current platform, then package
<code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;</span></code> test group classification is changed to <code class="docutils literal notranslate"><span class="pre">EX</span></code>.  Changing
the package test group classification to <code class="docutils literal notranslate"><span class="pre">EX</span></code> results in the package being
disabled by default (see <a class="reference internal" href="#ex-se-packages-disabled-by-default">EX SE packages disabled by default</a>).  However,
an explicit enable can still enable the package.</p>
<p>In: core/package_arch/TribitsListHelpers.cmake:84</p>
</section>
<section id="tribits-exclude-files">
<h3><a class="toc-backref" href="#id141">tribits_exclude_files()</a><a class="headerlink" href="#tribits-exclude-files" title="Permalink to this heading"></a></h3>
<p>Exclude package files/dirs from the source distribution by appending
<code class="docutils literal notranslate"><span class="pre">CPACK_SOURCE_IGNORE_FILES</span></code>.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_exclude_files</span><span class="p">(</span><span class="o">&lt;</span><span class="n">file0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">file1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>This is called in the top-level parent package’s
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file and each file or directory name
<code class="docutils literal notranslate"><span class="pre">&lt;filei&gt;</span></code> is actually interpreted by CMake/CPack as a regex that is
prefixed by the project’s and package’s source directory names so as to not
exclude files and directories of the same name and path from other packages.
If <code class="docutils literal notranslate"><span class="pre">&lt;filei&gt;</span></code> is an absolute path it is not prefixed but is appended to
<code class="docutils literal notranslate"><span class="pre">CPACK_SOURCE_IGNORE_FILES</span></code> unmodified.</p>
<p>In general, do <strong>NOT</strong> put in excludes for files and directories that are
not under this package’s source tree.  If the given package is not enabled,
then this command will never be called! For example, don’t put in excludes
for PackageB’s files in PackageA’s <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file because if
PackageB is enabled but PackageA is not, the excludes for PackageB will
never get added to <code class="docutils literal notranslate"><span class="pre">CPACK_SOURCE_IGNORE_FILES</span></code>.</p>
<p>Also, be careful to note that the <code class="docutils literal notranslate"><span class="pre">&lt;filei&gt;</span></code> arguments are actually regexes
and one must be very careful to understand how CPack will use these regexes
to match files that get excluded from the tarball.  For more details, see
<a class="reference internal" href="#creating-source-distributions">Creating Source Distributions</a>.</p>
<p>In: core/package_arch/TribitsGlobalMacros.cmake:2462</p>
</section>
<section id="tribits-extpkg-define-dependencies">
<h3><a class="toc-backref" href="#id142">tribits_extpkg_define_dependencies()</a><a class="headerlink" href="#tribits-extpkg-define-dependencies" title="Permalink to this heading"></a></h3>
<p>Macro called from inside of a <a class="reference internal" href="#findtpl-tplname-dependencies-cmake">FindTPL&lt;tplName&gt;Dependencies.cmake</a> file to
define the direct upstream dependencies an external package/TPL.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_extpkg_define_dependencies</span><span class="p">(</span> <span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;</span>
  <span class="n">DEPENDENCIES</span> <span class="o">&lt;</span><span class="n">upstreamTpl_0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">upstreamTpl_1</span><span class="o">&gt;</span><span class="p">:</span><span class="o">&lt;</span><span class="n">vis_1</span><span class="o">&gt;</span> <span class="o">...</span> <span class="p">)</span>
</pre></div>
</div>
<p>The listed upstream dependencies <code class="docutils literal notranslate"><span class="pre">&lt;upstreamTpl_i&gt;</span></code> are other external
packages/TPLs listed before this external packages/TPL <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code> in a
<a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file.  Each upstream dependency can include a
visibility specification <code class="docutils literal notranslate"><span class="pre">&lt;vis_i&gt;</span></code> that can be added to the dependency
using a colon <code class="docutils literal notranslate"><span class="pre">:</span></code> with <code class="docutils literal notranslate"><span class="pre">&lt;upstreamTpl_1&gt;:&lt;vis_1&gt;</span></code> where <code class="docutils literal notranslate"><span class="pre">&lt;vis_i&gt;</span></code> can
take the allowed values:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PUBLIC</span></code>: The include directories along with the libraries will be
propagated downstream to clients of <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PRIVATE</span></code>: Only the libraries will be propagated downstream to clients
of <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code>.</p></li>
</ul>
<p>If <code class="docutils literal notranslate"><span class="pre">&lt;vis_i&gt;</span></code> is not specified, then the default is <code class="docutils literal notranslate"><span class="pre">PRIVATE</span></code>.  (If a
package needs the include directories from some external package/TPL, then
it should list that external package/TPL as a direct dependency and not
expect to get include directories from indirect dependencies.)</p>
<p>In: core/package_arch/TribitsPackageDependencies.cmake:59</p>
</section>
<section id="tribits-extpkg-get-dep-name-and-vis">
<h3><a class="toc-backref" href="#id143">tribits_extpkg_get_dep_name_and_vis()</a><a class="headerlink" href="#tribits-extpkg-get-dep-name-and-vis" title="Permalink to this heading"></a></h3>
<p>Extract <code class="docutils literal notranslate"><span class="pre">&lt;PkgName&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;Vis&gt;</span></code> from <code class="docutils literal notranslate"><span class="pre">&lt;PkgName&gt;[:&lt;Vis&gt;]</span></code> input with
default <code class="docutils literal notranslate"><span class="pre">&lt;Vis&gt;</span></code> of <code class="docutils literal notranslate"><span class="pre">PRIVATE</span></code>.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_extpkg_get_dep_name_and_vis</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">upstreamTplDepEntry</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">upstreamTplDepNameOut</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">upstreamTplDepVisOut</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>In: core/package_arch/TribitsPackageDependencies.cmake:171</p>
</section>
<section id="tribits-extpkg-create-imported-all-libs-target-and-config-file">
<h3><a class="toc-backref" href="#id144">tribits_extpkg_create_imported_all_libs_target_and_config_file()</a><a class="headerlink" href="#tribits-extpkg-create-imported-all-libs-target-and-config-file" title="Permalink to this heading"></a></h3>
<p>Call from a <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> module that calls inner
<code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> for external package that uses modern CMake
IMPORTED targets.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_extpkg_create_imported_all_libs_target_and_config_file</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;</span>
  <span class="n">INNER_FIND_PACKAGE_NAME</span> <span class="o">&lt;</span><span class="n">externalPkg</span><span class="o">&gt;</span>
  <span class="n">IMPORTED_TARGETS_FOR_ALL_LIBS</span> <span class="o">&lt;</span><span class="n">importedTarget0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">importedTarget1</span><span class="o">&gt;</span> <span class="o">...</span> <span class="p">)</span>
</pre></div>
</div>
<p>This function is called in a TriBITS <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> wrapper
module after it calls <code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code> and then creates the
IMPORTED target <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> from the list of IMPORTED targets
<code class="docutils literal notranslate"><span class="pre">&lt;importedTarget0&gt;</span> <span class="pre">&lt;importedTarget1&gt;</span> <span class="pre">...</span></code> which are defined from the call
<code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPkg&gt;)</span></code>.  This function also takes care of
generating the correct <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;Config.cmake</span></code> file under the directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${${PROJECT_NAME}_BINARY_DIR}/${${PROJECT_NAME}_BUILD_DIR_EXTERNAL_PKGS_DIR}
</pre></div>
</div>
<p>The generated <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;Config.cmake</span></code> file calls
<code class="docutils literal notranslate"><span class="pre">find_dependency(&lt;externalPkg&gt;)</span></code> (with no other argument) and then, again,
defines the correct imported library dependency.</p>
<p>For more details, see <a class="reference internal" href="#creating-findtpl-tplname-cmake-using-find-package-with-imported-targets">Creating FindTPL&lt;tplName&gt;.cmake using find_package()
with IMPORTED targets</a>.</p>
<p>In: core/package_arch/TribitsExternalPackageFindTplHelpers.cmake:41</p>
</section>
<section id="tribits-extpkg-write-config-file">
<h3><a class="toc-backref" href="#id145">tribits_extpkg_write_config_file()</a><a class="headerlink" href="#tribits-extpkg-write-config-file" title="Permalink to this heading"></a></h3>
<p>Write out a <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;Config.cmake</span></code> file given the list of include
directories and libraries for an external package/TPL.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_write_external_package_config_file</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">tplConfigFile</span><span class="o">&gt;</span> <span class="p">)</span>
</pre></div>
</div>
<p>The arguments are:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code>: Name of the external package/TPL</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;tplConfigFile&gt;</span></code>: Full file path for the <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;Config.cmake</span></code>
file that will be written out.</p>
</div></blockquote>
<p>This function just calls <a class="reference internal" href="#tribits-extpkg-write-config-file-str">tribits_extpkg_write_config_file_str()</a>
and writes that text to the file <code class="docutils literal notranslate"><span class="pre">&lt;tplConfigFile&gt;</span></code> so see that function
for more details.</p>
<p>In: core/package_arch/TribitsExternalPackageWriteConfigFile.cmake:49</p>
</section>
<section id="tribits-extpkg-write-config-file-str">
<h3><a class="toc-backref" href="#id146">tribits_extpkg_write_config_file_str()</a><a class="headerlink" href="#tribits-extpkg-write-config-file-str" title="Permalink to this heading"></a></h3>
<p>Create the text string for a <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;Config.cmake</span></code> file given the list of
include directories and libraries for an external package/TPL.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_extpkg_write_config_file_str</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">tplConfigFileStrOut</span><span class="o">&gt;</span> <span class="p">)</span>
</pre></div>
</div>
<p>The function arguments are:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code>: Name of the external package/TPL</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;tplConfigFileStrOut&gt;</span></code>: Name of variable that will contain the string
for the config file on output.</p>
</div></blockquote>
<p>This function reads from the (cache) variables</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_INCLUDE_DIRS</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_LIBRARIES</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIB_ENABLED_DEPENDENCIES</span></code></p></li>
</ul>
</div></blockquote>
<p>(which must already be set) and uses that information to produce the
contents of the <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;Config.cmake</span></code> which is returned as a string
variable that contains IMPORTED targets to represent these libraries and
include directories as well as <code class="docutils literal notranslate"><span class="pre">find_dependency()</span></code> calls for upstream
packages listed in <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIB_ENABLED_DEPENDENCIES</span></code>.</p>
<p>The arguments in <code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_LIBRARIES</span></code> are handled in special ways in
order to create the namespaced IMPORTED targets <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::&lt;libname&gt;</span></code> and
the <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> target that depends on these.  The types of
arguments that are handled and how the are interpreted:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&lt;abs-base-path&gt;/[lib]&lt;libname&gt;.&lt;longest-ext&gt;</span></code></p>
<blockquote>
<div><p>Arguments that are absolute file paths are treated as libraries and an
imported target name <code class="docutils literal notranslate"><span class="pre">&lt;libname&gt;</span></code> is derived from the file name (of the
form <code class="docutils literal notranslate"><span class="pre">lib&lt;libname&gt;.&lt;longest-ext&gt;</span></code> removing beginning <code class="docutils literal notranslate"><span class="pre">lib</span></code> and file
extension <code class="docutils literal notranslate"><span class="pre">.&lt;longest-ext&gt;</span></code>).  The IMPORTED target
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::&lt;libname&gt;</span></code> is created and the file path is set using the
<code class="docutils literal notranslate"><span class="pre">IMPORTED_LOCATION</span></code> target property.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">-l&lt;libname&gt;</span></code></p>
<blockquote>
<div><p>Arguments of the form <code class="docutils literal notranslate"><span class="pre">-l&lt;libname&gt;</span></code> are used to create IMPORTED
targets with the name <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::&lt;libname&gt;</span></code> using the
<code class="docutils literal notranslate"><span class="pre">IMPORTED_LIBNAME</span></code> target property.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">&lt;libname&gt;</span></code></p>
<blockquote>
<div><p>Arguments that are a raw name that matches the regex
<code class="docutils literal notranslate"><span class="pre">^[a-zA-Z_][a-zA-Z0-9_-]*$</span></code> are interpreted to be a library name
<code class="docutils literal notranslate"><span class="pre">&lt;libname&gt;</span></code> and is used to create an IMPORTED targets
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::&lt;libname&gt;</span></code> using the <code class="docutils literal notranslate"><span class="pre">IMPORTED_LIBNAME</span></code> target property.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">-L&lt;dir&gt;</span></code></p>
<blockquote>
<div><p>Link directories.  These are pulled off and added to the
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> using <code class="docutils literal notranslate"><span class="pre">target_link_options()</span></code>.  (The order of
these options is maintained.)</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">-&lt;any-option&gt;</span></code></p>
<blockquote>
<div><p>Any other option that starts with <code class="docutils literal notranslate"><span class="pre">-</span></code> is assumed to
be a link argument where the order does not matter in relation to the
libraries (but the order of these extra options are maintained w.r.t. each
other).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">&lt;unrecognized&gt;</span></code></p>
<blockquote>
<div><p>Any other argument that does not match one of the above patterns is
regarded as an error.</p>
</div></blockquote>
</div></blockquote>
<p>For more details on the handling of individual <code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_LIBRARIES</span></code>
arguments, see <a class="reference internal" href="#tribits-tpl-libraries-entry-type">tribits_tpl_libraries_entry_type()</a>.</p>
<p>The list of directories given in <code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_INCLUDE_DIRS</span></code> is added to
the <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> target using <code class="docutils literal notranslate"><span class="pre">target_include_directories()</span></code>.</p>
<p>Finally, for every <code class="docutils literal notranslate"><span class="pre">&lt;upstreamTplName&gt;</span></code> listed in
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIB_ENABLED_DEPENDENCIES</span></code>, a link dependency is created using
<code class="docutils literal notranslate"><span class="pre">target_link_library(&lt;tplName&gt;::all_libs</span> <span class="pre">INTERFACE</span> <span class="pre">&lt;upstreamTplName&gt;)</span></code>.</p>
<p>In: core/package_arch/TribitsExternalPackageWriteConfigFile.cmake:167</p>
</section>
<section id="tribits-find-most-recent-binary-file-timestamp">
<h3><a class="toc-backref" href="#id147">tribits_find_most_recent_binary_file_timestamp()</a><a class="headerlink" href="#tribits-find-most-recent-binary-file-timestamp" title="Permalink to this heading"></a></h3>
<p>Find the most modified binary file in a set of base directories and return
its timestamp.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_find_most_recent_binary_file_timestamp</span><span class="p">(</span>
  <span class="n">BINARY_BASE_DIRS</span> <span class="o">&lt;</span><span class="n">dir0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">dir1</span><span class="o">&gt;</span> <span class="o">...</span>
  <span class="p">[</span><span class="n">BINARY_BASE_BASE_DIR</span> <span class="o">&lt;</span><span class="nb">dir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">MOST_RECENT_TIMESTAMP_OUT</span>  <span class="o">&lt;</span><span class="n">mostRecentTimestamp</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">MOST_RECENT_FILEPATH_BASE_DIR_OUT</span> <span class="o">&lt;</span><span class="n">mostRecentFilepathBaseDir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">MOST_RECENT_RELATIVE_FILEPATH_OUT</span> <span class="o">&lt;</span><span class="n">mostRecentRelativeFilePath</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">SHOW_MOST_RECENT_FILES</span><span class="p">]</span>
  <span class="p">[</span><span class="n">SHOW_OVERALL_MOST_RECENT_FILE</span><span class="p">]</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>This function just calls <a class="reference internal" href="#tribits-find-most-recent-file-timestamp">tribits_find_most_recent_file_timestamp()</a>
passing in a set of basic exclude regexes like <code class="docutils literal notranslate"><span class="pre">CMakeFiles/</span></code>,
<code class="docutils literal notranslate"><span class="pre">[.]cmake$</span></code>, and <code class="docutils literal notranslate"><span class="pre">/Makefile$</span></code>, etc.  These types of files usually don’t
impact the build of downstream software in CMake projects.</p>
<p>In: core/package_arch/TribitsFindMostRecentFileTimestamp.cmake:382</p>
</section>
<section id="tribits-find-most-recent-file-timestamp">
<h3><a class="toc-backref" href="#id148">tribits_find_most_recent_file_timestamp()</a><a class="headerlink" href="#tribits-find-most-recent-file-timestamp" title="Permalink to this heading"></a></h3>
<p>Find the most modified file in a set of base directories and return its
timestamp.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_find_most_recent_file_timestamp</span><span class="p">(</span>
  <span class="n">BASE_DIRS</span> <span class="o">&lt;</span><span class="n">dir0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">dir1</span><span class="o">&gt;</span> <span class="o">...</span>
  <span class="p">[</span><span class="n">BASE_BASE_DIR</span> <span class="o">&lt;</span><span class="nb">dir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">EXCLUDE_REGEXES</span> <span class="s2">&quot;&lt;re0&gt;&quot;</span> <span class="s2">&quot;&lt;re1&gt;&quot;</span> <span class="o">...</span>
  <span class="p">[</span><span class="n">SHOW_MOST_RECENT_FILES</span><span class="p">]</span>
  <span class="p">[</span><span class="n">SHOW_OVERALL_MOST_RECENT_FILE</span><span class="p">]</span>
  <span class="p">[</span><span class="n">MOST_RECENT_TIMESTAMP_OUT</span>  <span class="o">&lt;</span><span class="n">mostRecentTimestamp</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">MOST_RECENT_FILEPATH_BASE_DIR_OUT</span> <span class="o">&lt;</span><span class="n">mostRecentFilepathBaseDir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">MOST_RECENT_RELATIVE_FILEPATH_OUT</span> <span class="o">&lt;</span><span class="n">mostRecentRelativeFilePath</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">)</span>
</pre></div>
</div>
<p><strong>Arguments:</strong></p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">BASE_DIRS</span> <span class="pre">&lt;dir0&gt;</span> <span class="pre">&lt;dir1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>Gives the absolute base directory paths that will be searched for the
most recently modified files, as described above.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">BASE_BASE_DIR</span> <span class="pre">&lt;dir&gt;`</span></code></p>
<blockquote>
<div><p>Absolute path for which to print file paths relative to.  This makes
outputting less verbose and easier to read (optional).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">EXCLUDE_REGEXES</span> <span class="pre">&quot;&lt;re0&gt;&quot;</span> <span class="pre">&quot;&lt;re1&gt;&quot;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>Gives the regular expressions that are used to exclude files from
consideration.  Each “&lt;rei&gt;” regex is used with a <cite>grep -v “&lt;rei&gt;”</cite>
filter to exclude files before sorting by time stamp.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">SHOW_MOST_RECENT_FILES</span></code></p>
<blockquote>
<div><p>If specified, then the most recently modified file for each individual
directory <code class="docutils literal notranslate"><span class="pre">&lt;dir0&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;dir1</span></code>, … will be printed the STDOUT.
Setting this implies <code class="docutils literal notranslate"><span class="pre">SHOW_OVERALL_MOST_RECENT_FILE</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">SHOW_OVERALL_MOST_RECENT_FILE</span></code></p>
<blockquote>
<div><p>If specified, then only the most recent modified file over all of the
individual directories is printed to STDOUT.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">MOST_RECENT_TIMESTAMP_OUT</span> <span class="pre">&lt;mostRecentTimestamp&gt;</span></code></p>
<blockquote>
<div><p>On output, the variable <cite>&lt;mostRecentTimestamp&gt;</cite> is set that gives the
timestamp of the most recently modified file over all the directories.
This number is given as the number of seconds since Jan. 1, 1970, 00:00
GMT.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">MOST_RECENT_FILEPATH_BASE_DIR_OUT</span> <span class="pre">&lt;mostRecentFilepathBaseDir&gt;</span></code></p>
<blockquote>
<div><p>On output, the variable <cite>&lt;mostRecentFilepathBaseDir&gt;</cite> gives absolute base
directory of the file with the most recent timestamp over all
directories.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">MOST_RECENT_RELATIVE_FILEPATH_OUT</span> <span class="pre">&lt;mostRecentRelativeFilePath&gt;</span></code></p>
<blockquote>
<div><p>On output, the variable <cite>&lt;mostRecentFilepathBaseDir&gt;</cite> gives the file
name with relative path to the file with the most recent timestamp over
all directories.</p>
</div></blockquote>
</div></blockquote>
<p><strong>Description:</strong></p>
<p>This function uses the Linux/Unix command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ find . -type f -printf &#39;%T@ %p\n&#39; \
    | grep -v &quot;&lt;re0&gt;&quot; | grep -v &quot;&lt;re1&gt;&quot; | ... \
    | sort -n | tail -1
</pre></div>
</div>
<p>to return the most recent file in each listed directory <code class="docutils literal notranslate"><span class="pre">&lt;dir0&gt;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&lt;dir1&gt;</span></code>, etc.  It then determines the most recently modified file over
all of the directories and prints and returns in the variables
<code class="docutils literal notranslate"><span class="pre">&lt;mostRecentTimestamp&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;mostRecentFilepathBaseDir&gt;</span></code>, and
<code class="docutils literal notranslate"><span class="pre">&lt;mostRecentRelativeFilePath&gt;</span></code>.</p>
<p>In: core/package_arch/TribitsFindMostRecentFileTimestamp.cmake:43</p>
</section>
<section id="tribits-find-most-recent-source-file-timestamp">
<h3><a class="toc-backref" href="#id149">tribits_find_most_recent_source_file_timestamp()</a><a class="headerlink" href="#tribits-find-most-recent-source-file-timestamp" title="Permalink to this heading"></a></h3>
<p>Find the most modified source file in a set of base directories and return
its timestamp.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_find_most_recent_source_file_timestamp</span><span class="p">(</span>
  <span class="n">SOURCE_BASE_DIRS</span> <span class="o">&lt;</span><span class="n">dir0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">dir1</span><span class="o">&gt;</span> <span class="o">...</span>
  <span class="p">[</span><span class="n">SOURCE_BASE_BASE_DIR</span> <span class="o">&lt;</span><span class="nb">dir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">SHOW_MOST_RECENT_FILES</span><span class="p">]</span>
  <span class="p">[</span><span class="n">SHOW_OVERALL_MOST_RECENT_FILE</span><span class="p">]</span>
  <span class="p">[</span><span class="n">MOST_RECENT_TIMESTAMP_OUT</span>  <span class="o">&lt;</span><span class="n">mostRecentTimestamp</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">MOST_RECENT_FILEPATH_BASE_DIR_OUT</span> <span class="o">&lt;</span><span class="n">mostRecentFilepathBaseDir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">MOST_RECENT_RELATIVE_FILEPATH_OUT</span> <span class="o">&lt;</span><span class="n">mostRecentRelativeFilePath</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>This function just calls <a class="reference internal" href="#tribits-find-most-recent-file-timestamp">tribits_find_most_recent_file_timestamp()</a>
passing in a set of basic exclude regexes like <code class="docutils literal notranslate"><span class="pre">[.]git/</span></code>, <code class="docutils literal notranslate"><span class="pre">[.]svn/</span></code>,
etc.  These types of version control files can not possibly directly impact
the source code.</p>
<p>In: core/package_arch/TribitsFindMostRecentFileTimestamp.cmake:296</p>
</section>
<section id="tribits-install-headers">
<h3><a class="toc-backref" href="#id150">tribits_install_headers()</a><a class="headerlink" href="#tribits-install-headers" title="Permalink to this heading"></a></h3>
<p>Function used to (optionally) install header files using <code class="docutils literal notranslate"><span class="pre">install()</span></code>
command.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_install_headers</span><span class="p">(</span>
  <span class="n">HEADERS</span> <span class="o">&lt;</span><span class="n">h0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span> <span class="o">...</span>
  <span class="p">[</span><span class="n">INSTALL_SUBDIR</span> <span class="o">&lt;</span><span class="n">subdir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">COMPONENT</span> <span class="o">&lt;</span><span class="n">component</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>The formal arguments are:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">HEADERS</span> <span class="pre">&lt;h0&gt;</span> <span class="pre">&lt;h1&gt;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>List of header files to install.  By default, these header files are
assumed to be in the current source directory.  They can also contain
the relative path or absolute path to the files if they are not in the
current source directory.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">INSTALL_SUBDIR</span> <span class="pre">&lt;subdir&gt;</span></code></p>
<blockquote>
<div><p>Optional subdirectory that the headers will be installed under the
standard installation directory.  If <code class="docutils literal notranslate"><span class="pre">&lt;subdir&gt;!=&quot;&quot;</span></code>, then the headers
will be installed under
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_INSTALL_INCLUDE_DIR}/&lt;subdir&gt;</span></code>.  Otherwise, they will
be installed under <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_INSTALL_INCLUDE_DIR}/</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">COMPONENT</span> <span class="pre">&lt;component&gt;</span></code></p>
<blockquote>
<div><p>If specified, then <code class="docutils literal notranslate"><span class="pre">COMPONENT</span> <span class="pre">&lt;component&gt;</span></code> will be passed into
<code class="docutils literal notranslate"><span class="pre">install()</span></code>.  Otherwise, <code class="docutils literal notranslate"><span class="pre">COMPONENT</span> <span class="pre">${PROJECT_NAME}</span></code> will get used.</p>
</div></blockquote>
</div></blockquote>
<p>If <a class="reference internal" href="#project-name-install-libraries-and-headers">${PROJECT_NAME}_INSTALL_LIBRARIES_AND_HEADERS</a> is <code class="docutils literal notranslate"><span class="pre">FASLE</span></code>, then the
headers will not get installed.</p>
<p>In: core/package_arch/TribitsInstallHeaders.cmake:44</p>
</section>
<section id="tribits-include-directories">
<h3><a class="toc-backref" href="#id151">tribits_include_directories()</a><a class="headerlink" href="#tribits-include-directories" title="Permalink to this heading"></a></h3>
<p>This function is to override the standard behavior of the built-in CMake
<code class="docutils literal notranslate"><span class="pre">include_directories()</span></code> command.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_include_directories</span><span class="p">(</span>
  <span class="p">[</span><span class="n">REQUIRED_DURING_INSTALLATION_TESTING</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">dir0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">dir1</span><span class="o">&gt;</span> <span class="o">...</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>If specified, <code class="docutils literal notranslate"><span class="pre">REQUIRED_DURING_INSTALLATION_TESTING</span></code> can appear anywhere
in the argument list.</p>
<p>This function allows overriding the default behavior of
<code class="docutils literal notranslate"><span class="pre">include_directories()</span></code> for installation testing, to ensure that include
directories will not be inadvertently added to the build lines for tests
during installation testing (see <a class="reference internal" href="#installation-and-backward-compatibility-testing">Installation and Backward Compatibility
Testing</a>). Normally we want the include directories to be handled as cmake
usually does.  However during TriBITS installation testing we do not want
most of the include directories to be used as the majority of the files
should come from the installation we are building against.  There is an
exception to this and that is when there are test only headers that are
needed.  For that case <code class="docutils literal notranslate"><span class="pre">REQUIRED_DURING_INSTALLATION_TESTING</span></code> must be
passed in to ensure the include paths are added for installation testing.</p>
<p>In: core/package_arch/TribitsIncludeDirectories.cmake:43</p>
</section>
<section id="id1">
<h3><a class="toc-backref" href="#id152">tribits_package()</a><a class="headerlink" href="#id1" title="Permalink to this heading"></a></h3>
<p>Macro called at the very beginning of a package’s top-level
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_package</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">packageName</span><span class="o">&gt;</span>
  <span class="p">[</span><span class="n">ENABLE_SHADOWING_WARNINGS</span><span class="p">]</span>
  <span class="p">[</span><span class="n">DISABLE_STRONG_WARNINGS</span><span class="p">]</span>
  <span class="p">[</span><span class="n">CLEANED</span><span class="p">]</span>
  <span class="p">[</span><span class="n">DISABLE_CIRCULAR_REF_DETECTION_FAILURE</span><span class="p">]</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#tribits-package-decl">tribits_package_decl()</a> for the documentation for the arguments and
<a class="reference internal" href="#tribits-package-decl">tribits_package_decl()</a> and <a class="reference internal" href="#id1">tribits_package()</a> for a description the
side-effects (and variables set) after calling this macro.</p>
<p>In: core/package_arch/TribitsPackageMacros.cmake:336</p>
</section>
<section id="tribits-package-decl">
<h3><a class="toc-backref" href="#id153">tribits_package_decl()</a><a class="headerlink" href="#tribits-package-decl" title="Permalink to this heading"></a></h3>
<p>Macro called at the very beginning of a package’s top-level
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file when a package has subpackages.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_package_decl</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">packageName</span><span class="o">&gt;</span>
  <span class="p">[</span><span class="n">ENABLE_SHADOWING_WARNINGS</span><span class="p">]</span>
  <span class="p">[</span><span class="n">DISABLE_STRONG_WARNINGS</span><span class="p">]</span>
  <span class="p">[</span><span class="n">CLEANED</span><span class="p">]</span>
  <span class="p">[</span><span class="n">DISABLE_CIRCULAR_REF_DETECTION_FAILURE</span><span class="p">]</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>The arguments are:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;</span></code></p>
<blockquote>
<div><p>Gives the name of the Package, mostly just for checking and
documentation purposes.  This must match the name of the package
provided in the <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> or an error is issued.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">ENABLE_SHADOWING_WARNINGS</span></code></p>
<blockquote>
<div><p>If specified, then shadowing warnings for the package’s sources will be
turned on for supported platforms/compilers.  The default is for
shadowing warnings to be turned off.  Note that this can be overridden
globally by setting the cache variable
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_SHADOWING_WARNINGS</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">DISABLE_STRONG_WARNINGS</span></code></p>
<blockquote>
<div><p>If specified, then all strong warnings for the package’s sources will be
turned off, if they are not already turned off by global cache
variables.  Strong warnings are turned on by default in development
mode.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">CLEANED</span></code></p>
<blockquote>
<div><p>If specified, then warnings will be promoted to errors for compiling the
package’s sources for all defined warnings.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">DISABLE_CIRCULAR_REF_DETECTION_FAILURE</span></code></p>
<blockquote>
<div><p>If specified, then the standard grep looking for RCPNode circular
references in <a class="reference internal" href="#tribits-add-test">tribits_add_test()</a> and <a class="reference internal" href="#tribits-add-advanced-test">tribits_add_advanced_test()</a>
that causes tests to fail will be disabled.  Note that if these warnings
are being produced then it means that the test is leaking memory and
user like may also be leaking memory.</p>
</div></blockquote>
</div></blockquote>
<p>There are several side-effects of calling this macro:</p>
<ul class="simple">
<li><p>The variables <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_LIB_TARGETS</span></code> (lists all of the package’s
targets) and <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_ALL_TARGETS</span></code> (lists all of the package’s
libraries) and are initialized to empty.</p></li>
<li><p>The local variables <code class="docutils literal notranslate"><span class="pre">PACKAGE_SOURCE_DIR</span></code> and <code class="docutils literal notranslate"><span class="pre">PACKAGE_BINARY_DIR</span></code> are
set for this package’s use in its CMakeLists.txt files.</p></li>
<li><p>Package-specific compiler options are set up in package-scope (i.e., the
package’s subdirs) in <code class="docutils literal notranslate"><span class="pre">CMAKE_&lt;LANG&gt;_FLAG</span></code>.</p></li>
<li><p>This packages’s cmake subdir <code class="docutils literal notranslate"><span class="pre">${PACKAGE_SOURCE_DIR}/cmake</span></code> is added to
<code class="docutils literal notranslate"><span class="pre">CMAKE_MODULE_PATH</span></code> locally so that the package’s try-compile modules
can be read in with just a raw <code class="docutils literal notranslate"><span class="pre">include()</span></code> leaving off the full path and
the <code class="docutils literal notranslate"><span class="pre">*.cmake</span></code> extension.</p></li>
</ul>
<p>If the package does not have subpackages, just call <a class="reference internal" href="#id1">tribits_package()</a>
which calls this macro.</p>
<p>In: core/package_arch/TribitsPackageMacros.cmake:106</p>
</section>
<section id="tribits-package-def">
<h3><a class="toc-backref" href="#id154">tribits_package_def()</a><a class="headerlink" href="#tribits-package-def" title="Permalink to this heading"></a></h3>
<p>Macro called in <a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> after subpackages are
processed in order to handle the libraries, tests, and examples of the
parent package.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_package_def</span><span class="p">()</span>
</pre></div>
</div>
<p>If the package does not have subpackages, just call <a class="reference internal" href="#id1">tribits_package()</a>
which calls this macro.</p>
<p>This macro has several side effects:</p>
<ul class="simple">
<li><p>The variable <code class="docutils literal notranslate"><span class="pre">PACKAGE_NAME</span></code> is set in the local scope for usage by the
package’s <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> files.</p></li>
<li><p>The intra-package dependency variables (i.e. list of include directories,
list of libraries, etc.) are initialized to empty.</p></li>
</ul>
<p>In: core/package_arch/TribitsPackageMacros.cmake:271</p>
</section>
<section id="tribits-package-define-dependencies">
<h3><a class="toc-backref" href="#id155">tribits_package_define_dependencies()</a><a class="headerlink" href="#tribits-package-define-dependencies" title="Permalink to this heading"></a></h3>
<p>Define the dependencies for a given <a class="reference internal" href="#tribits-se-package">TriBITS SE Package</a> (i.e. a top-level
<a class="reference internal" href="#tribits-package">TriBITS Package</a> or a <a class="reference internal" href="#tribits-subpackage">TriBITS Subpackage</a>) in the package’s
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> file.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_package_define_dependencies</span><span class="p">(</span>
   <span class="p">[</span><span class="n">LIB_REQUIRED_PACKAGES</span> <span class="o">&lt;</span><span class="n">pkg1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">pkg2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
   <span class="p">[</span><span class="n">LIB_OPTIONAL_PACKAGES</span> <span class="o">&lt;</span><span class="n">pkg1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">pkg2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
   <span class="p">[</span><span class="n">TEST_REQUIRED_PACKAGES</span> <span class="o">&lt;</span><span class="n">pkg1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">pkg2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
   <span class="p">[</span><span class="n">TEST_OPTIONAL_PACKAGES</span> <span class="o">&lt;</span><span class="n">pkg1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">pkg2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
   <span class="p">[</span><span class="n">LIB_REQUIRED_TPLS</span> <span class="o">&lt;</span><span class="n">tpl1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">tpl2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
   <span class="p">[</span><span class="n">LIB_OPTIONAL_TPLS</span> <span class="o">&lt;</span><span class="n">tpl1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">tpl2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
   <span class="p">[</span><span class="n">TEST_REQUIRED_TPLS</span> <span class="o">&lt;</span><span class="n">tpl1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">tpl2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
   <span class="p">[</span><span class="n">TEST_OPTIONAL_TPLS</span> <span class="o">&lt;</span><span class="n">tpl1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">tpl2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
   <span class="p">[</span><span class="n">REGRESSION_EMAIL_LIST</span>  <span class="o">&lt;</span><span class="n">regression</span><span class="o">-</span><span class="n">email</span><span class="o">-</span><span class="n">address</span><span class="o">&gt;</span><span class="p">]</span>
   <span class="p">[</span><span class="n">SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS</span>
     <span class="o">&lt;</span><span class="n">spkg1_name</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">spkg1_dir</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">spkg1_classifications</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">spkg1_optreq</span><span class="o">&gt;</span>
     <span class="o">&lt;</span><span class="n">spkg2_name</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">spkg2_dir</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">spkg2_classifications</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">spkg2_optreq</span><span class="o">&gt;</span>
     <span class="o">...</span>
     <span class="p">]</span>
   <span class="p">)</span>
</pre></div>
</div>
<p>Every argument in this macro is optional (that is, an SE package can have no
upstream dependencies).  The arguments that apply to all SE packages are:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">LIB_REQUIRED_PACKAGES</span></code></p>
<blockquote>
<div><p>List of required upstream SE packages that must be enabled in order to
build and use the libraries (or capabilities) in this SE package.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">LIB_OPTIONAL_PACKAGES</span></code></p>
<blockquote>
<div><p>List of additional optional upstream SE packages that can be used in
this SE package if enabled.  These upstream SE packages need not be
enabled in order to enable this SE package but not enabling one or more
of these optional upstream SE packages will result in diminished
capabilities of this SE package.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">TEST_REQUIRED_PACKAGES</span></code></p>
<blockquote>
<div><p>List of additional upstream SE packages that must be enabled in order to
build and/or run the tests and/or examples in this SE package.  If any
of these upstream SE packages are not enabled, then there will be no
tests or examples defined or run for this SE package.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">TEST_OPTIONAL_PACKAGES</span></code></p>
<blockquote>
<div><p>List of additional optional upstream SE packages that can be used by the
tests in this SE package.  These upstream SE packages need not be
enabled in order to run some basic tests or examples for this SE
package.  Typically, extra tests that depend on optional test SE
packages involve integration testing of some type.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">LIB_REQUIRED_TPLS</span></code></p>
<blockquote>
<div><p>List of required upstream TPLs that must be enabled in order to build
and use the libraries (or capabilities) in this SE package.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">LIB_OPTIONAL_TPLS</span></code></p>
<blockquote>
<div><p>List of additional optional upstream TPLs that can be used in this SE
package if enabled.  These upstream TPLs need not be enabled in order to
use this SE package but not enabling one or more of these optional
upstream TPLs will result in diminished capabilities of this SE package.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">TEST_REQUIRED_TPLS</span></code></p>
<blockquote>
<div><p>List of additional upstream TPLs that must be enabled in order to build
and/or run the tests and/or examples in this SE package.  If any of
these upstream TPLs are not enabled, then there will be no tests or
examples defined or run for this SE package.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">TEST_OPTIONAL_TPLS</span></code></p>
<blockquote>
<div><p>List of additional optional upstream TPLs that can be used by the tests
in this SE package.  These upstream TPLs need not be enabled in order to
run basic tests for this SE package.  Typically, extra tests that depend
on optional TPLs involve integration testing or some additional testing
of some type.</p>
</div></blockquote>
</div></blockquote>
<p>Only upstream SE packages can be listed (as defined by the order the SE
packages are listed in <a class="reference internal" href="#tribits-repository-define-packages">tribits_repository_define_packages()</a> in the
<a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> file).  Otherwise an error will occur and
processing will stop.  Misspelled SE package names are caught as well.</p>
<p>Only direct SE package dependencies need to be listed.  Indirect SE package
dependencies are automatically handled.  For example, if this SE package
directly depends on SE package <code class="docutils literal notranslate"><span class="pre">PKG2</span></code> which depends on SE package <code class="docutils literal notranslate"><span class="pre">PKG1</span></code>
(but this SE package does not directly depend on anything in <code class="docutils literal notranslate"><span class="pre">PKG1</span></code>) then
this SE package only needs to list a dependency on <code class="docutils literal notranslate"><span class="pre">PKG2</span></code>, not <code class="docutils literal notranslate"><span class="pre">PKG1</span></code>.
The dependency on <code class="docutils literal notranslate"><span class="pre">PKG1</span></code> will be taken care of automatically by the
TriBITS dependency management system.</p>
<p>However, currently, all TPL dependencies must be listed, even the indirect
ones.  This is a requirement that will be dropped in a future version of
TriBITS.</p>
<p>The SE packages listed in <code class="docutils literal notranslate"><span class="pre">LIB_REQUIRED_PACKAGES</span></code> are implicitly also
dependencies in <code class="docutils literal notranslate"><span class="pre">TEST_REQUIRED_PACKAGES</span></code>.  Likewise
<code class="docutils literal notranslate"><span class="pre">LIB_OPTIONAL_PACKAGES</span></code> are implicitly also dependencies in
<code class="docutils literal notranslate"><span class="pre">TEST_OPTIONAL_PACKAGES</span></code>.  Same goes for TPL dependencies.</p>
<p>The upstream dependencies within a single list do not need to be listed in
any order.  For example if <code class="docutils literal notranslate"><span class="pre">PKG2</span></code> depends on <code class="docutils literal notranslate"><span class="pre">PKG1</span></code>, and this given SE
package depends on both, then one can list:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LIB_REQUIRED_PACKAGES</span> <span class="n">PKG2</span> <span class="n">PKG1</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;LIB_REQUIRED_PACKAGES PKG1 PKG2</span>
</pre></div>
</div>
<p>Likewise the order that dependent TPLs are listed is not significant.</p>
<p>If some upstream SE packages are allowed to be missing, this can be specified
by calling the macro <a class="reference internal" href="#tribits-allow-missing-external-packages">tribits_allow_missing_external_packages()</a>.</p>
<p>A top-level <a class="reference internal" href="#tribits-package">TriBITS Package</a> can also be broken down into <a class="reference internal" href="#tribits-subpackages">TriBITS
Subpackages</a>.  In this case, the following argument must be passed in:</p>
<blockquote>
<div><p id="subpackages-dirs-classifications-optreqs"><code class="docutils literal notranslate"><span class="pre">SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS</span></code></p>
<blockquote>
<div><p>2D array with rows listing the subpackages where each row has the
columns:</p>
<ul class="simple">
<li><p><strong>SUBPACKAGE</strong> (Column 0): The name of the subpackage <code class="docutils literal notranslate"><span class="pre">&lt;spkg_name&gt;</span></code>.
The full SE package name is <code class="docutils literal notranslate"><span class="pre">${PARENT_PACKAGE_NAME}&lt;spkg_name&gt;</span></code>.
The full SE package name is what is used in listing dependencies in
other SE packages.</p></li>
<li><p><strong>DIRS</strong> (Column 1): The subdirectory <code class="docutils literal notranslate"><span class="pre">&lt;spkg_dir&gt;</span></code> relative to the
parent package’s base directory.  All of the contents of the
subpackage should be under this subdirectory.  This is assumed by the
TriBITS testing support software when mapping modified files to SE
packages that need to be tested (see <a class="reference internal" href="#checkin-test-py">checkin-test.py</a>).</p></li>
<li><p><strong>CLASSIFICATIONS</strong> (Column 2): The <a class="reference internal" href="#test-test-category">Test Test Category</a> <a class="reference internal" href="#pt">PT</a>,
<a class="reference internal" href="#st">ST</a>, <a class="reference internal" href="#ex">EX</a> and the maturity level <code class="docutils literal notranslate"><span class="pre">EP</span></code>, <code class="docutils literal notranslate"><span class="pre">RS</span></code>, <code class="docutils literal notranslate"><span class="pre">PG</span></code>, <code class="docutils literal notranslate"><span class="pre">PM</span></code>,
<code class="docutils literal notranslate"><span class="pre">GRS</span></code>, <code class="docutils literal notranslate"><span class="pre">GPG</span></code>, <code class="docutils literal notranslate"><span class="pre">GPM</span></code>, and <code class="docutils literal notranslate"><span class="pre">UM</span></code>, separated by a coma ‘,’ with no
spaces in between (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;PT,GPM&quot;</span></code>).  These have exactly the same
meaning as for full packages (see
<a class="reference internal" href="#tribits-repository-define-packages">tribits_repository_define_packages()</a>).</p></li>
<li><p><strong>OPTREQ</strong> (Column 3): Determines if the outer parent package has an
<code class="docutils literal notranslate"><span class="pre">OPTIONAL</span></code> or <code class="docutils literal notranslate"><span class="pre">REQUIRED</span></code> dependence on this subpackage.</p></li>
</ul>
</div></blockquote>
</div></blockquote>
<p>Other variables that this macro handles:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">REGRESSION_EMAIL_LIST</span></code></p>
<blockquote>
<div><p>The email list that is used to send CDash error messages.  If this
argument is missing, then the email list that CDash errors go to is
determined by other means (see <a class="reference internal" href="#cdash-regression-email-addresses">CDash regression email addresses</a>).</p>
</div></blockquote>
</div></blockquote>
<p>NOTE: All this macro really does is to just define the variables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">LIB_REQUIRED_DEP_PACKAGES</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LIB_OPTIONAL_DEP_PACKAGES</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TEST_REQUIRED_DEP_PACKAGES</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TEST_OPTIONAL_DEP_PACKAGES</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LIB_REQUIRED_DEP_TPLS</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LIB_OPTIONAL_DEP_TPLS</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TEST_REQUIRED_DEP_TPLS</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TEST_OPTIONAL_DEP_TPLS</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">REGRESSION_EMAIL_LIST</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS</span></code></p></li>
</ul>
<p>which are then read by the TriBITS cmake code to build the SE package
dependency graph.  The advantage of using this macro instead of just
directly setting the variables is that an SE package only needs to list
dependencies that exist.  Otherwise, the <code class="docutils literal notranslate"><span class="pre">Dependencies.cmake</span></code> file will
need to set all of the above local variables, even those that are empty.
This is an error checking property of the TriBITS system to avoid misspelling
the names of these variables.</p>
<p>In: core/package_arch/TribitsPackageDefineDependencies.cmake:43</p>
</section>
<section id="tribits-package-postprocess">
<h3><a class="toc-backref" href="#id156">tribits_package_postprocess()</a><a class="headerlink" href="#tribits-package-postprocess" title="Permalink to this heading"></a></h3>
<p>Macro called at the very end of a package’s top-level
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file that performs some critical
post-processing activities.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_package_postprocess</span><span class="p">()</span>
</pre></div>
</div>
<p>NOTE: This creates the aliased target <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}::all_libs</span></code> for all
libraries in all subdirectories that don’t have the TRIBITS_TESTONLY_LIB
target property set on them.</p>
<p>NOTE: It is unfortunate that this macro must be called in a package’s
top-level <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file but limitations of the CMake language make
it necessary to do so.</p>
<p>In: core/package_arch/TribitsPackageMacros.cmake:726</p>
</section>
<section id="tribits-process-subpackages">
<h3><a class="toc-backref" href="#id157">tribits_process_subpackages()</a><a class="headerlink" href="#tribits-process-subpackages" title="Permalink to this heading"></a></h3>
<p>Macro that processes the <a class="reference internal" href="#tribits-subpackages">TriBITS Subpackages</a> for a parent <a class="reference internal" href="#tribits-package">TriBITS
package</a> for packages that are broken down into subpackages.  This is
called in the parent packages top-level <a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_process_subpackages</span><span class="p">()</span>
</pre></div>
</div>
<p>This macro must be called after <a class="reference internal" href="#tribits-package-decl">tribits_package_decl()</a> but before
<a class="reference internal" href="#tribits-package-def">tribits_package_def()</a>.</p>
<p>In: core/package_arch/TribitsPackageMacros.cmake:836</p>
</section>
<section id="tribits-process-enabled-tpl">
<h3><a class="toc-backref" href="#id158">tribits_process_enabled_tpl()</a><a class="headerlink" href="#tribits-process-enabled-tpl" title="Permalink to this heading"></a></h3>
<p>Process an enabled TPL’s FindTPL${TPL_NAME}.cmake module.</p>
<p>In: core/package_arch/TribitsProcessEnabledTpl.cmake:52</p>
</section>
<section id="id2">
<h3><a class="toc-backref" href="#id159">tribits_project()</a><a class="headerlink" href="#id2" title="Permalink to this heading"></a></h3>
<p>Processes a <a class="reference internal" href="#tribits-project">TriBITS Project</a>’s files and configures its software which is
called from the project’s top-level <a class="reference internal" href="#projectdir-cmakelists-txt">&lt;projectDir&gt;/CMakeLists.txt</a> file.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_project</span><span class="p">()</span>
</pre></div>
</div>
<p>This macro requires that the variable <a class="reference internal" href="#project-name">PROJECT_NAME</a> be defined before
calling this macro.  All default values for project settings should be set
before calling this macro (see <a class="reference internal" href="#tribits-global-project-settings">TriBITS Global Project Settings</a>).  Also,
the variable <a class="reference internal" href="#project-name-tribits-dir">${PROJECT_NAME}_TRIBITS_DIR</a> must be set as well.</p>
<p>This macro then adds all of the necessary paths to <code class="docutils literal notranslate"><span class="pre">CMAKE_MODULE_PATH</span></code> and
then performs all processing of the TriBITS project files (see <a class="reference internal" href="#full-tribits-project-configuration">Full TriBITS
Project Configuration</a>).</p>
<p>In: core/package_arch/TribitsProject.cmake:73</p>
</section>
<section id="tribits-project-define-extra-repositories">
<h3><a class="toc-backref" href="#id160">tribits_project_define_extra_repositories()</a><a class="headerlink" href="#tribits-project-define-extra-repositories" title="Permalink to this heading"></a></h3>
<p>Declare a set of extra repositories for the <a class="reference internal" href="#tribits-project">TriBITS Project</a> (i.e. in the
project’s <a class="reference internal" href="#projectdir-cmake-extrarepositorieslist-cmake">&lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake</a> file).</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_project_define_extra_repositories</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">repo0_name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">repo0_dir</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">repo0_vctype</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">repo0_url</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">repo0_packstat</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">repo0_classif</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">repo1_name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">repo1_dir</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">repo1_vctype</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">repo1_url</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">rep10_packstat</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">repo1_classif</span><span class="o">&gt;</span>
  <span class="o">...</span>
 <span class="p">)</span>
</pre></div>
</div>
<p>This macro takes in a 2D array with 6 columns, where each row defines an
extra repository.  The 6 columns (ordered 0-5) are:</p>
<ol class="arabic simple" start="0">
<li><p><strong>REPO_NAME</strong> (<code class="docutils literal notranslate"><span class="pre">&lt;repoi_name&gt;</span></code>): The name given to the repository
<code class="docutils literal notranslate"><span class="pre">REPOSITORY_NAME</span></code>.</p></li>
<li><p><strong>REPO_DIR</strong> (<code class="docutils literal notranslate"><span class="pre">&lt;repoi_dir&gt;</span></code>): The relative directory for the repository
under the project directory <code class="docutils literal notranslate"><span class="pre">${PROJECT_SOURCE_DIR}</span></code> (or
<code class="docutils literal notranslate"><span class="pre">&lt;projectDir&gt;</span></code>).  If this is set to empty quoted string <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>, then
the relative directory name is assumed to be same as the repository name
<code class="docutils literal notranslate"><span class="pre">&lt;repoi_name&gt;</span></code>.  NOTE: If the repo is a <a class="reference internal" href="#tribits-repository">TriBITS Repository</a> (see
<code class="docutils literal notranslate"><span class="pre">REPO_PACKSTAT</span></code> below) then, currently, the repo dir must be the same
as the package name.</p></li>
<li><p><strong>REPO_VCTYPE</strong> (<code class="docutils literal notranslate"><span class="pre">&lt;repoi_vctype&gt;</span></code>): The version control (VC) type of
the repo.  Value choices include <code class="docutils literal notranslate"><span class="pre">GIT</span></code>, <code class="docutils literal notranslate"><span class="pre">SVN</span></code> (i.e. Subversion) or
empty <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> (in which case <code class="docutils literal notranslate"><span class="pre">&lt;repoi_url&gt;</span></code> must be empty as well).
WARNING: Only VC repos of type <code class="docutils literal notranslate"><span class="pre">GIT</span></code> can fully participate in the
TriBITS development tool workflows.  The other VC types are only
supported for basic cloning and updating using <a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a>
scripts.</p></li>
<li><p><strong>REPO_URL</strong> (<code class="docutils literal notranslate"><span class="pre">&lt;repoi_url&gt;</span></code>): The URL of the VC repo.  This info is
used to initially obtain the repo source code using the VC tool listed in
<code class="docutils literal notranslate"><span class="pre">&lt;repoi_vctype&gt;</span></code>.  If the repo does not need to be cloned for the
needed use cases, then this can be the empty quoted string <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.  Also,
this field must be the empty string <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code> if <code class="docutils literal notranslate"><span class="pre">&lt;repoi_vctype&gt;</span></code> is empty
<code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.</p></li>
<li><p><strong>REPO_PACKSTAT</strong> (<code class="docutils literal notranslate"><span class="pre">&lt;repoi_packstat&gt;</span></code>): Determines if the repository is
a <a class="reference internal" href="#tribits-repository">TriBITS Repository</a> and contains any TriBITS packages (or if it just
provides directories and files) and if its packages are listed before or
after the project’s own native packages.  If this is a TriBITS Repository
(and therefore contains <a class="reference internal" href="#tribits-repository-core-files">TriBITS Repository Core Files</a>) then this field
must contain the keyword <code class="docutils literal notranslate"><span class="pre">HASPACKAGES</span></code> or left empty.  If the listed
repository is <strong>not</strong> a TriBITS repository, and just provides directories
and files, then this field must contain the keyword <code class="docutils literal notranslate"><span class="pre">NOPACKAGES</span></code>.  The
default is assumed to be <code class="docutils literal notranslate"><span class="pre">HASPACKAGES</span></code> if neither of these keywords are
provided.  If the keyword <code class="docutils literal notranslate"><span class="pre">PRE</span></code> is provided, then the TriBITS packages
in this repo come before the project’s native packages.  If the keyword
<code class="docutils literal notranslate"><span class="pre">POST</span></code> is provided then the packages are listed after the project’s
native packages. The default is assumed to be <code class="docutils literal notranslate"><span class="pre">POST</span></code> if neither of
these keywords are provided.  The keywords must be separated by a comma
with no spaces such as with “<code class="docutils literal notranslate"><span class="pre">PRE,HASPACKAGES</span></code>”,
“<code class="docutils literal notranslate"><span class="pre">HASPACKAGES,POST</span></code>”, “<code class="docutils literal notranslate"><span class="pre">POST,NOPACKAGES</span></code>”, etc.  If no keywords are
provided, then the empty string “” must be used (which defaults to
<code class="docutils literal notranslate"><span class="pre">&quot;HASPACKAGES,POST&quot;</span></code>).</p></li>
<li><p><strong>REPO_CLASSIFICATION</strong> (<code class="docutils literal notranslate"><span class="pre">&lt;repoi_classif&gt;</span></code>): Gives the <a class="reference internal" href="#repository-test-classification">Repository Test
Classification</a> which also happens to be the CTest/CDash testing mode
and the default dashboard track.  Valid values are <code class="docutils literal notranslate"><span class="pre">Continuous</span></code>,
<code class="docutils literal notranslate"><span class="pre">Nightly</span></code>, and <code class="docutils literal notranslate"><span class="pre">Experimental</span></code>.  See <a class="reference internal" href="#repository-test-classification">Repository Test Classification</a>
for a detailed description.</p></li>
</ol>
<p>This command is used to put together one or more VC and/or TriBITS
repositories to construct a composite <a class="reference internal" href="#tribits-project">TriBITS Project</a>.  The option
<a class="reference external" href="TribitsBuildReference.html#project-extrarepos-file">&lt;Project&gt;_EXTRAREPOS_FILE</a> is used to point to files that call this macro.</p>
<p>Repositories with <code class="docutils literal notranslate"><span class="pre">&lt;repoi_packstat&gt;=NOPACKAGES</span></code> are <strong>not</strong> TriBITS
Repositories and are technically not considered at all during the basic
configuration of the a TriBITS project.  They are only listed in this file
so that they can be used in the version control logic for tools that perform
version control with the repositories (such as getting git versions,
cloning, updating, looking for changed files, etc.).  For example, a
non-TriBITS repo can be used to grab a set of directories and files that
fill in the definition of a package in an upstream repository (see <a class="reference internal" href="#how-to-insert-a-package-into-an-upstream-repo">How to
insert a package into an upstream repo</a>).  Also, non-TriBITS repos can be
used to provide extra test data for a given package or a set of packages so
that extra tests can be run.</p>
<p>Repositories with <code class="docutils literal notranslate"><span class="pre">&lt;repoi_repotype&gt;=''</span></code> are not VC repos.  This can be
used, for example, to represent the project’s native repos or it can be used
to point to a TriBITS repository that was cloned in an early listed VC repo.</p>
<p>NOTE: These repositories must be listed in the order of package
dependencies.  That is, all of the packages listed in repository <code class="docutils literal notranslate"><span class="pre">i</span></code> must
have upstream TPL and SE package dependencies listed before this package in
this repository or in upstream repositories <code class="docutils literal notranslate"><span class="pre">i-1</span></code>, <code class="docutils literal notranslate"><span class="pre">i-2</span></code>, etc.</p>
<p>NOTE: This module just sets the local variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PROJECT_NAME}_EXTRAREPOS_DIR_VCTYPE_REPOURL_PACKSTAT_CATEGORY
</pre></div>
</div>
<p>in the current scope.  The advantages of using this macro instead of
directly setting this variable are that the macro:</p>
<ul class="simple">
<li><p>Asserts that the variable <code class="docutils literal notranslate"><span class="pre">PROJECT_NAME</span></code> is defined and set.</p></li>
<li><p>Avoids misspelling the name of the variable
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_EXTRAREPOS_DIR_VCTYPE_REPOURL_PACKSTAT_CATEGORY</span></code>.  If
one misspells the name of a macro, it is an immediate error in CMake.  A
misspelled set variable is just ignored.</p></li>
<li><p>The variable name can change in the future as an implementation detail.</p></li>
</ul>
<p>In: core/package_arch/TribitsProcessExtraRepositoriesList.cmake:50</p>
</section>
<section id="tribits-project-enable-all">
<h3><a class="toc-backref" href="#id161">tribits_project_enable_all()</a><a class="headerlink" href="#tribits-project-enable-all" title="Permalink to this heading"></a></h3>
<p>Process a project where you enable all of the packages by default.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_project_enable_all</span><span class="p">()</span>
</pre></div>
</div>
<p>This macro just sets the global cache var
<a class="reference internal" href="#project-name-enable-all-packages">${PROJECT_NAME}_ENABLE_ALL_PACKAGES</a> to <code class="docutils literal notranslate"><span class="pre">ON</span></code> by default then calls
<a class="reference internal" href="#id2">tribits_project()</a>.  That is all.  This macro is generally used for
TriBITS projects that have just a single package or by default just want to
enable all packages.  This is especially useful when you have a TriBITS
project with just a single package.</p>
<p>In: core/package_arch/TribitsProjectImpl.cmake:327</p>
</section>
<section id="tribits-repository-define-packages">
<h3><a class="toc-backref" href="#id162">tribits_repository_define_packages()</a><a class="headerlink" href="#tribits-repository-define-packages" title="Permalink to this heading"></a></h3>
<p>Define the set of packages for a given <a class="reference internal" href="#tribits-repository">TriBITS Repository</a>.  This macro is
typically called from inside of a <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> file for a
given TriBITS repo.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_repository_define_packages</span><span class="p">(</span>
   <span class="o">&lt;</span><span class="n">pkg0</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">pkg0_dir</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">pkg0_classif</span><span class="o">&gt;</span>
   <span class="o">&lt;</span><span class="n">pkg1</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">pkg1_dir</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">pkg1_classif</span><span class="o">&gt;</span>
   <span class="o">...</span>
   <span class="p">)</span>
</pre></div>
</div>
<p>This macro sets up a 2D array of <code class="docutils literal notranslate"><span class="pre">NumPackages</span></code> by <code class="docutils literal notranslate"><span class="pre">NumColumns</span></code> listing
out the packages for a TriBITS repository.  Each row (with 3 column entries)
specifies a package which contains the columns (ordered 0-2):</p>
<ol class="arabic simple" start="0">
<li><p><strong>PACKAGE</strong> (<code class="docutils literal notranslate"><span class="pre">&lt;pkgi&gt;</span></code>): The name of the TriBITS package.  This name
must be unique across all other TriBITS packages in this or any other
TriBITS repo that might be combined into a single TriBITS project
meta-build (see <a class="reference internal" href="#globally-unique-tribits-package-names">Globally unique TriBITS package names</a>).  The name
should be a valid identifier (e.g. matches the regex
<code class="docutils literal notranslate"><span class="pre">[a-zA-Z_][a-zA-Z0-9_]*</span></code>).  The package names tend to use mixed case
(e.g. <code class="docutils literal notranslate"><span class="pre">`SomePackge</span></code> not <code class="docutils literal notranslate"><span class="pre">SOMEPACKGE</span></code>).</p></li>
<li><p><strong>DIR</strong> (<code class="docutils literal notranslate"><span class="pre">&lt;pkgi_dir&gt;</span></code>): The relative directory for the package
<code class="docutils literal notranslate"><span class="pre">&lt;packageDir&gt;</span></code>.  This directory is relative to the TriBITS repository
base directory <code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;</span></code>.  Under this directory will be a
package-specific <code class="docutils literal notranslate"><span class="pre">cmake/</span></code> directory with the file
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> and a base-level
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file.  The entire contents of the package
including all of the source code and all of the tests should be contained
under this directory.  The TriBITS testing infrastructure relies on the
mapping of changed files to these base directories when deciding what
packages are modified and need to be retested (along with downstream
packages).  For details, see <a class="reference internal" href="#checkin-test-py">checkin-test.py</a>.</p></li>
<li><p><strong>CLASSIFICATION</strong> (<code class="docutils literal notranslate"><span class="pre">&lt;pkgi_classif&gt;</span></code>): Gives the <a class="reference internal" href="#se-package-test-group">SE Package Test
Group</a> <a class="reference internal" href="#pt">PT</a>, <a class="reference internal" href="#st">ST</a>, or <a class="reference internal" href="#ex">EX</a> and the maturity level <code class="docutils literal notranslate"><span class="pre">EP</span></code>, <code class="docutils literal notranslate"><span class="pre">RS</span></code>,
<code class="docutils literal notranslate"><span class="pre">PG</span></code>, <code class="docutils literal notranslate"><span class="pre">PM</span></code>, <code class="docutils literal notranslate"><span class="pre">GRS</span></code>, <code class="docutils literal notranslate"><span class="pre">GPG</span></code>, <code class="docutils literal notranslate"><span class="pre">GPM</span></code>, <code class="docutils literal notranslate"><span class="pre">UM</span></code>.  These are separated
by a coma with no space in between such as <code class="docutils literal notranslate"><span class="pre">&quot;RS,PT&quot;</span></code> for a “Research
Stable”, “Primary Tested” package.  No spaces are allowed so that CMake
treats this a one field in the array.  The maturity level can be left off
in which case it is assumed to be <code class="docutils literal notranslate"><span class="pre">UM</span></code> for “Unspecified Maturity”.
This classification for individual packages can be changed to <code class="docutils literal notranslate"><span class="pre">EX</span></code> for
specific platforms by calling <a class="reference internal" href="#tribits-disable-package-on-platforms">tribits_disable_package_on_platforms()</a>.</p></li>
</ol>
<p><strong>IMPORTANT:</strong> The packages must be listed in increasing order of package
dependencies.  That is <a class="reference internal" href="#no-circular-dependencies-of-any-kind-are-allowed">No circular dependencies of any kind are allowed</a>
(see the <em>ADP (Acyclic Dependencies Principle)</em> in <a class="reference internal" href="#software-engineering-packaging-principles">Software Engineering
Packaging Principles</a>).  Package <code class="docutils literal notranslate"><span class="pre">i</span></code> can only list dependencies (in
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a>) for packages listed before this
package in this list (or in upstream TriBITS repositories).  This avoids an
expensive package sorting algorithm and makes it easy to flag packages with
circular dependencies or misspelling of package names.</p>
<p>NOTE: For some rare use cases, the package directory <code class="docutils literal notranslate"><span class="pre">&lt;pkgi_dir&gt;</span></code> is
allowed to be specified as an absolute directory but this absolute directory
must be a subdirectory of the project source base directory given by
<a class="reference internal" href="#project-source-dir">PROJECT_SOURCE_DIR</a>.  If not, <code class="docutils literal notranslate"><span class="pre">message(FATAL_ERROR</span> <span class="pre">...)</span></code> is called and
processing stops immediately.</p>
<p>NOTE: This macro just sets the variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${REPOSITORY_NAME}_PACKAGES_AND_DIRS_AND_CLASSIFICATIONS
</pre></div>
</div>
<p>in the current scope.  The advantages of using this macro instead of
directly setting this variable are that the macro:</p>
<ul class="simple">
<li><p>Asserts that the variable <code class="docutils literal notranslate"><span class="pre">REPOSITORY_NAME</span></code> is defined and set</p></li>
<li><p>Avoids having to hard-code the assumed repository name
<code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}</span></code>.  This provides more flexibility for how other
TriBITS projects choose to name a given TriBITS repo (i.e. the name of
repo subdirs).</p></li>
<li><p>Avoid misspelling the name of the variable
<code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}_PACKAGES_AND_DIRS_AND_CLASSIFICATIONS</span></code>.  If one
misspells the name of the macro, it is an immediate error in CMake.</p></li>
</ul>
<p>In: core/package_arch/TribitsProcessPackagesAndDirsLists.cmake:56</p>
</section>
<section id="tribits-repository-define-tpls">
<h3><a class="toc-backref" href="#id163">tribits_repository_define_tpls()</a><a class="headerlink" href="#tribits-repository-define-tpls" title="Permalink to this heading"></a></h3>
<p>Define the list of <a class="reference internal" href="#tribits-tpls">TriBITS TPLs</a> for a given <a class="reference internal" href="#tribits-repository">TriBITS Repository</a> which
includes the TPL name, find module, and classification .  This macro is
typically called from inside of the repository’s <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a>
file.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_repository_define_tpls</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">tpl0_name</span><span class="o">&gt;</span>   <span class="o">&lt;</span><span class="n">tpl0_findmod</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">tpl0_classif</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">tpl1_name</span><span class="o">&gt;</span>   <span class="o">&lt;</span><span class="n">tpl1_findmod</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">tpl1_classif</span><span class="o">&gt;</span>
  <span class="o">...</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>This macro sets up a 2D array of <code class="docutils literal notranslate"><span class="pre">NumTPLS</span></code> by <code class="docutils literal notranslate"><span class="pre">NumColumns</span></code> listing out
the <a class="reference internal" href="#tribits-tpls">TriBITS TPLs</a> for a <a class="reference internal" href="#tribits-repository">TriBITS Repository</a>.  Each row (with 3 entries)
specifies a TPL which contains the columns (ordered 0-2):</p>
<ol class="arabic simple" start="0">
<li><p><strong>TPL</strong> (<code class="docutils literal notranslate"><span class="pre">&lt;tpli_name&gt;</span></code>): The name of the TriBITS TPL <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code>.
This name must be unique across all other TriBITS TPLs in this or any
other TriBITS repo that might be combined into a single TriBITS project
meta-build (see <a class="reference internal" href="#globally-unique-tribits-tpl-names">Globally unique TriBITS TPL names</a>).  However, a TPL
can be redefined from an upstream repo (see below).  The name should be a
valid identifier (e.g. matches the regex <code class="docutils literal notranslate"><span class="pre">[a-zA-Z_][a-zA-Z0-9_]*</span></code>).
TPL names typically use mixed case (e.g. <code class="docutils literal notranslate"><span class="pre">SomeTpl</span></code> and not
<code class="docutils literal notranslate"><span class="pre">SOMETPL</span></code>).</p></li>
<li><p><strong>FINDMOD</strong> (<code class="docutils literal notranslate"><span class="pre">&lt;tpli_findmod&gt;</span></code>): The relative or absolute path for the
find module, usually with the name <a class="reference internal" href="#findtpl-tplname-cmake">FindTPL&lt;tplName&gt;.cmake</a>.  If it is a
relative path, it is considered relative to the repository base directory
<code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;</span></code>.  If just the base path for the find module is given,
ending with <code class="docutils literal notranslate"><span class="pre">&quot;/&quot;</span></code> (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;cmake/tpls/&quot;</span></code>), then the find module will
be assumed to be under that this directory with the standard name
<code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code>.  (See <a class="reference internal" href="#creating-the-findtpl-tplname-cmake-file">Creating the FindTPL&lt;tplName&gt;.cmake
file</a>.)</p></li>
<li><p><strong>CLASSIFICATION</strong> (<code class="docutils literal notranslate"><span class="pre">&lt;pkgi_classif&gt;</span></code>): Gives the <a class="reference internal" href="#se-package-test-group">SE Package Test
Group</a> <a class="reference internal" href="#pt">PT</a>, <a class="reference internal" href="#st">ST</a>, or <a class="reference internal" href="#ex">EX</a> and the maturity level <code class="docutils literal notranslate"><span class="pre">EP</span></code>, <code class="docutils literal notranslate"><span class="pre">RS</span></code>,
<code class="docutils literal notranslate"><span class="pre">PG</span></code>, <code class="docutils literal notranslate"><span class="pre">PM</span></code>, <code class="docutils literal notranslate"><span class="pre">GRS</span></code>, <code class="docutils literal notranslate"><span class="pre">GPG</span></code>, <code class="docutils literal notranslate"><span class="pre">GPM</span></code>, <code class="docutils literal notranslate"><span class="pre">UM</span></code>.  These are separated
by a coma with no space in between such as <code class="docutils literal notranslate"><span class="pre">&quot;RS,PT&quot;</span></code> for a “Research
Stable”, “Primary Tested” package.  No spaces are allowed so that CMake
treats this a one field in the array.  The maturity level can be left off
in which case it is assumed to be <code class="docutils literal notranslate"><span class="pre">UM</span></code> for “Unspecified Maturity”.</p></li>
</ol>
<p>A TPL defined in a upstream repo can listed again in a downstream repo,
which allows redefining the find module that is used to specify the TPL.
This allows downstream repos to add additional requirements for a given TPL
(i.e. add more libraries, headers, etc.).  However, the downstream repo’s
find module file must find the TPL components that are fully compatible with
the upstream’s find module.</p>
<p>This macro just sets the variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${REPOSITORY_NAME}_TPLS_FINDMODS_CLASSIFICATIONS
</pre></div>
</div>
<p>in the current scope.  The advantages of using this macro instead of
directly setting this variable are that the macro:</p>
<ul class="simple">
<li><p>Asserts that the variable <code class="docutils literal notranslate"><span class="pre">REPOSITORY_NAME</span></code> is defined and set</p></li>
<li><p>Avoids having to hard-code the assumed repository name
<code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}</span></code>.  This provides more flexibility for how other
TriBITS projects choose to name a given TriBITS repo (i.e. the name of
repo subdirs).</p></li>
<li><p>Avoids misspelling the name of the variable
<code class="docutils literal notranslate"><span class="pre">${REPOSITORY_NAME}_TPLS_FINDMODS_CLASSIFICATIONS</span></code>.  If one misspells
the name of a macro, it is an immediate error in CMake.</p></li>
</ul>
<p>In: core/package_arch/TribitsProcessTplsLists.cmake:48</p>
</section>
<section id="tribits-set-st-for-dev-mode">
<h3><a class="toc-backref" href="#id164">tribits_set_st_for_dev_mode()</a><a class="headerlink" href="#tribits-set-st-for-dev-mode" title="Permalink to this heading"></a></h3>
<p>Function that allows packages to easily make a feature <code class="docutils literal notranslate"><span class="pre">ST</span></code> for
development builds and <code class="docutils literal notranslate"><span class="pre">PT</span></code> for release builds by default.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_set_st_for_dev_mode</span><span class="p">(</span><span class="o">&lt;</span><span class="n">outputVar</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>This function is typically called in a package’s top-level
<a class="reference internal" href="#packagedir-cmakelists-txt">&lt;packageDir&gt;/CMakeLists.txt</a> file before defining other options for the
package.  The output variable <code class="docutils literal notranslate"><span class="pre">${&lt;outputVar&gt;}</span></code> is set to <code class="docutils literal notranslate"><span class="pre">ON</span></code> or <code class="docutils literal notranslate"><span class="pre">OFF</span></code>
based on the configure state.  In development mode
(i.e. <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_DEVELOPMENT_MODE==ON</span></code>), <code class="docutils literal notranslate"><span class="pre">${&lt;outputVar&gt;}</span></code>
will be set to <code class="docutils literal notranslate"><span class="pre">ON</span></code> only if <code class="docutils literal notranslate"><span class="pre">ST</span></code> code is enabled
(i.e. <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_SECONDARY_TESTED_CODE==ON</span></code>), otherwise it is
set to <code class="docutils literal notranslate"><span class="pre">OFF</span></code>. In release mode
(i.e. <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ENABLE_DEVELOPMENT_MODE==OFF</span></code>), <code class="docutils literal notranslate"><span class="pre">${&lt;outputVar&gt;}</span></code>
is always set to <code class="docutils literal notranslate"><span class="pre">ON</span></code>.  This allows some parts of a TriBITS package to be
considered <code class="docutils literal notranslate"><span class="pre">ST</span></code> for development mode (thereby reducing testing time by not
enabling the dependent features/tests), while still having important
functionality available to users by default in a release of the package.</p>
<p>In: core/package_arch/TribitsGeneralMacros.cmake:300</p>
</section>
<section id="id3">
<h3><a class="toc-backref" href="#id165">tribits_subpackage()</a><a class="headerlink" href="#id3" title="Permalink to this heading"></a></h3>
<p>Forward declare a <a class="reference internal" href="#tribits-subpackage">TriBITS Subpackage</a> called at the top of the
subpackage’s <a class="reference internal" href="#packagedir-spkgdir-cmakelists-txt">&lt;packageDir&gt;/&lt;spkgDir&gt;/CMakeLists.txt</a> file.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_subpackage</span><span class="p">(</span><span class="o">&lt;</span><span class="n">spkgName</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Once called, the following local variables are in scope:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">PARENT_PACKAGE_NAME</span></code></p>
<blockquote>
<div><p>The name of the parent package.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">SUBPACKAGE_NAME</span></code></p>
<blockquote>
<div><p>The local name of the subpackage (does not contain
the parent package name).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">SUBPACKAGE_FULLNAME</span></code></p>
<blockquote>
<div><p>The full project-level name of the subpackage (which includes the parent
package name at the beginning,
<code class="docutils literal notranslate"><span class="pre">${PARENT_PACKAGE_NAME}${SUBPACKAGE_NAME}</span></code>).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">PACKAGE_NAME</span></code></p>
<blockquote>
<div><p>Inside the subpackage, the same as <code class="docutils literal notranslate"><span class="pre">SUBPACKAGE_FULLNAME</span></code>.</p>
</div></blockquote>
</div></blockquote>
<p>In: core/package_arch/TribitsSubPackageMacros.cmake:44</p>
</section>
<section id="tribits-subpackage-postprocess">
<h3><a class="toc-backref" href="#id166">tribits_subpackage_postprocess()</a><a class="headerlink" href="#tribits-subpackage-postprocess" title="Permalink to this heading"></a></h3>
<p>Macro that performs standard post-processing after defining a <a class="reference internal" href="#tribits-subpackage">TriBITS
Subpackage</a> which is called at the bottom of a subpackage’s
<a class="reference internal" href="#packagedir-spkgdir-cmakelists-txt">&lt;packageDir&gt;/&lt;spkgDir&gt;/CMakeLists.txt</a> file.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_subpackage_postprocess</span><span class="p">()</span>
</pre></div>
</div>
<p>NOTE: This creates the aliased target <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}::all_libs</span></code> for all
libraries in all subdirectories that don’t have the TRIBITS_TESTONLY_LIB
target property set on them.</p>
<p>NOTE: It is unfortunate that a Subpackages’s CMakeLists.txt file must call
this macro but limitations of the CMake language make it necessary to do so.</p>
<p>In: core/package_arch/TribitsSubPackageMacros.cmake:143</p>
</section>
<section id="tribits-tpl-allow-pre-find-package">
<h3><a class="toc-backref" href="#id167">tribits_tpl_allow_pre_find_package()</a><a class="headerlink" href="#tribits-tpl-allow-pre-find-package" title="Permalink to this heading"></a></h3>
<p>Function that determines if a TriBITS find module file
<code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> is allowed to call <code class="docutils literal notranslate"><span class="pre">find_package(&lt;tplName&gt;</span>
<span class="pre">...)</span></code> before calling <a class="reference internal" href="#tribits-tpl-find-include-dirs-and-libraries">tribits_tpl_find_include_dirs_and_libraries()</a>.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_tpl_allow_pre_find_package</span><span class="p">(</span> <span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">allowPackagePrefindOut</span><span class="o">&gt;</span> <span class="p">)</span>
</pre></div>
</div>
<p>The required arguments are:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code> : The input name of the TriBITS TPL (e.g. <code class="docutils literal notranslate"><span class="pre">HDF5</span></code>).</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;allowPackagePrefindOut&gt;</span></code> : Name of a variable which will be set to
<code class="docutils literal notranslate"><span class="pre">TRUE</span></code> on output if <code class="docutils literal notranslate"><span class="pre">find_package(&lt;tplName&gt;</span> <span class="pre">...)</span></code> should be called to
find the TPL <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> if it should not be called.</p>
</div></blockquote>
<p>This function will set <code class="docutils literal notranslate"><span class="pre">&lt;allowPackagePrefindOut&gt;</span></code> to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> if any of
the variables <code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_INCLUDE_DIRS</span></code>, <code class="docutils literal notranslate"><span class="pre">${TPL_&lt;tplName&gt;_LIBRARIES</span></code>,
or <code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_LIBRARY_DIRS</span></code> are set.  This allows the user to override
the search for the library components and just specify the absolute
locations.  The function will also set <code class="docutils literal notranslate"><span class="pre">&lt;allowPackagePrefindOut&gt;</span></code> to
<code class="docutils literal notranslate"><span class="pre">FALSE</span></code> if <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_INCLUDE_DIRS</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIBRARY_NAMES</span></code>, or
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIBRARY_DIRS</span></code> is set and <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_FORCE_PRE_FIND_PACKAGE</span></code>
is set to <code class="docutils literal notranslate"><span class="pre">FALSE</span></code>.  Otherwise, if <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_FORCE_PRE_FIND_PACKAGE</span></code> is
set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, the function will not return <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> for
<code class="docutils literal notranslate"><span class="pre">&lt;allowPackagePrefindOut&gt;</span></code> no matter what the values of
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_INCLUDE_DIRS</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIBRARY_NAMES</span></code>, or
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIBRARY_DIRS</span></code>.  Finally, <code class="docutils literal notranslate"><span class="pre">&lt;allowPackagePrefindOut&gt;</span></code> is set to
<code class="docutils literal notranslate"><span class="pre">FALSE</span></code> if <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_ALLOW_PACKAGE_PREFIND=OFF</span></code> is set in the cache.</p>
<p>The variable <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_FORCE_PRE_FIND_PACKAGE</span></code> is needed to allow users
(or the <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> module itself) to avoid name clashes with
the variables <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_INCLUDE_DIRS</span></code> or <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIBRARY_DIRS</span></code> in
the usage of <code class="docutils literal notranslate"><span class="pre">find_package(&lt;tplName&gt;</span> <span class="pre">...)</span></code> because a lot of default
<code class="docutils literal notranslate"><span class="pre">Find&lt;tplName&gt;.cmake</span></code> modules also use these variables.  This function
sets <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_FORCE_PRE_FIND_PACKAGE</span></code> as a cache variable with default
value <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> to maintain backward compatibility with existing
<code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> modules.</p>
<p>The cache variable <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_ALLOW_PACKAGE_PREFIND</span></code> is to allow the user
to disable the prefind call to <code class="docutils literal notranslate"><span class="pre">find_package()</span></code> even if it would be
allowed otherwise.</p>
<p>See <a class="reference internal" href="#creating-findtpl-tplname-cmake-using-find-package-without-imported-targets">Creating FindTPL&lt;tplName&gt;.cmake using find_package() without IMPORTED
targets</a> for details in how to use this function to create a
<code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> module file.</p>
<p>In: core/package_arch/TribitsTplFindIncludeDirsAndLibraries.cmake:56</p>
</section>
<section id="tribits-tpl-find-include-dirs-and-libraries">
<h3><a class="toc-backref" href="#id168">tribits_tpl_find_include_dirs_and_libraries()</a><a class="headerlink" href="#tribits-tpl-find-include-dirs-and-libraries" title="Permalink to this heading"></a></h3>
<p>This function reads (cache) variables that specify where to find a <a class="reference internal" href="#tribits-tpl">TriBITS
TPL</a>’s headers and libraries and then creates IMPORTED targets, the
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> target, and writes the file
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;Config.cmake</span></code> into the standard location in the build directory.
This function is typically called inside of a <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code>
module file (see <a class="reference internal" href="#tpl-name-findmod">${TPL_NAME}_FINDMOD</a>).</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_tpl_find_include_dirs_and_libraries</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;</span>
  <span class="p">[</span><span class="n">REQUIRED_HEADERS</span> <span class="o">&lt;</span><span class="n">header1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">header2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">MUST_FIND_ALL_HEADERS</span><span class="p">]</span>
  <span class="p">[</span><span class="n">REQUIRED_LIBS_NAMES</span> <span class="o">&lt;</span><span class="n">libname1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">libname2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
  <span class="p">[</span><span class="n">MUST_FIND_ALL_LIBS</span><span class="p">]</span>
  <span class="p">[</span><span class="n">NO_PRINT_ENABLE_SUCCESS_FAIL</span><span class="p">]</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>This function can be called to specify/require header files and include
directories and/or a list of libraries.</p>
<p>The input arguments to this function are:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code></p>
<blockquote>
<div><p>Name of the TPL that is listed in a <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> file.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">REQUIRED_HEADERS</span></code></p>
<blockquote>
<div><p>List of header files that are searched in order to find the TPL’s
include directories files using <code class="docutils literal notranslate"><span class="pre">find_path()</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">MUST_FIND_ALL_HEADERS</span></code></p>
<blockquote>
<div><p>If set, then all of the header files listed in <code class="docutils literal notranslate"><span class="pre">REQUIRED_HEADERS</span></code> must
be found (unless <code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_INCLUDE_DIRS</span></code> is already set).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">REQUIRED_LIBS_NAMES</span></code></p>
<blockquote>
<div><p>List of libraries that are searched for when looking for the TPL’s
libraries using <code class="docutils literal notranslate"><span class="pre">find_library()</span></code>.  This list can be overridden by the
user by setting <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIBRARY_NAMES</span></code> (see below).</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">MUST_FIND_ALL_LIBS</span></code></p>
<blockquote>
<div><p>If set, then all of the library files listed in <code class="docutils literal notranslate"><span class="pre">REQUIRED_LIBS_NAMES</span></code>
must be found or the TPL is considered not found (unless
<code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_LIBRARIES</span></code> is already set).  If the global cache var
<code class="docutils literal notranslate"><span class="pre">&lt;Project&gt;_MUST_FIND_ALL_TPL_LIBS</span></code> is set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then this is
turned on as well.  WARNING: The default is not to require finding all
of the listed libs.  (This is to maintain backward compatibility with
some older <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;tplName&gt;.cmake</span></code> modules.)</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">NO_PRINT_ENABLE_SUCCESS_FAIL</span></code></p>
<blockquote>
<div><p>If set, then the final success/fail will not be printed</p>
</div></blockquote>
</div></blockquote>
<p>This function implements the TPL find behavior described in <a class="reference external" href="TribitsBuildReference.html#enabling-support-for-an-optional-third-party-library-tpl">Enabling
support for an optional Third-Party Library (TPL)</a>.</p>
<p>The following (cache) variables, if set, will be used by this function:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_INCLUDE_DIRS</span></code> (type <code class="docutils literal notranslate"><span class="pre">PATH</span></code>)</p>
<blockquote>
<div><p>List of paths to search first for header files defined in
<code class="docutils literal notranslate"><span class="pre">REQUIRED_HEADERS</span> <span class="pre">&lt;header1&gt;</span> <span class="pre">&lt;header2&gt;</span> <span class="pre">...</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIBRARY_DIRS</span></code> (type <code class="docutils literal notranslate"><span class="pre">PATH</span></code>)</p>
<blockquote>
<div><p>The list of directories to search first for libraries defined in
<code class="docutils literal notranslate"><span class="pre">REQUIRED_LIBS_NAMES</span> <span class="pre">&lt;libname1&gt;</span> <span class="pre">&lt;libname2&gt;</span> <span class="pre">...</span></code>.  If, for some reason,
no libraries should be linked in for this particular configuration, then
setting <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIBRARY_DIRS=OFF</span></code> or is empty will no special paths
will be searched.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIBRARY_NAMES</span></code> (type <code class="docutils literal notranslate"><span class="pre">STRING</span></code>)</p>
<blockquote>
<div><p>List of library names to be looked for instead of what is specified in
<code class="docutils literal notranslate"><span class="pre">REQUIRED_LIBS_NAMES</span> <span class="pre">&lt;libname1&gt;</span> <span class="pre">&lt;libname2&gt;</span> <span class="pre">...</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIB_ENABLED_DEPENDENCIES</span></code></p>
<blockquote>
<div><p>List of direct upstream external package/TPL dependencies that also
define <code class="docutils literal notranslate"><span class="pre">&lt;upstreamTplName&gt;::all_libs</span></code> targets.</p>
</div></blockquote>
</div></blockquote>
<p>An addition, the function will avoid calling the find operations if the
following (cache) variables are set on input:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_INCLUDE_DIRS</span></code> (type <code class="docutils literal notranslate"><span class="pre">PATH</span></code>)</p>
<blockquote>
<div><p>A list of common-separated full directory paths that contain the TPL’s
header files.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_LIBRARIES</span></code> (type <code class="docutils literal notranslate"><span class="pre">FILEPATH</span></code>)</p>
<blockquote>
<div><p>A list of commons-separated full library names (i.e. output from
<code class="docutils literal notranslate"><span class="pre">find_library()</span></code>) for all of the libraries for the TPL.</p>
</div></blockquote>
</div></blockquote>
<p>This function produces the following:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_NOT_FOUND</span></code> (type <code class="docutils literal notranslate"><span class="pre">BOOL</span></code>)</p>
<blockquote>
<div><p>Will be set to <code class="docutils literal notranslate"><span class="pre">ON</span></code> if all of the parts of the TPL could not be found.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::&lt;libname&gt;</span></code></p>
<blockquote>
<div><p>Namespaced IMPORTED target for every library found or specified in
<code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_LIBRARIES</span></code>.  These IMPORTED targets will have the
<code class="docutils literal notranslate"><span class="pre">&lt;upstreamTplName&gt;::all_libs</span></code> for the upstream external packages/TPLs
listed in <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIB_ENABLED_DEPENDENCIES</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code></p>
<blockquote>
<div><p>INTERFACE target that depends on all of the created IMPORTED targets.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">&lt;buildDir&gt;/external_packages/&lt;tplName&gt;/&lt;tplName&gt;Config.cmake</span></code></p>
<blockquote>
<div><p>A package configure file that contains all of the generated IMPORTED
targets <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::&lt;libname&gt;</span></code> and the <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> target.
This fill will also call <code class="docutils literal notranslate"><span class="pre">find_dependency()</span></code> to pull in
<code class="docutils literal notranslate"><span class="pre">&lt;upstreamTplName&gt;Config.cmake</span></code> files for upstream TPLs that are
listed in <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIB_ENABLED_DEPENDENCIES</span></code>.  (For more
information, see <a class="reference internal" href="#tribits-extpkg-write-config-file">tribits_extpkg_write_config_file()</a>.)</p>
</div></blockquote>
</div></blockquote>
<p>Note, if <code class="docutils literal notranslate"><span class="pre">TPL_TENTATIVE_ENABLE_&lt;tplName&gt;=ON</span></code>, then if all of the parts of
the TPL can’t be found, then <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_&lt;tplName&gt;</span></code> will be (forced) set
to <code class="docutils literal notranslate"><span class="pre">OFF</span></code> in the cache.  See <a class="reference internal" href="#tribits-tpl-tentatively-enable">tribits_tpl_tentatively_enable()</a>.</p>
<p>In: core/package_arch/TribitsTplFindIncludeDirsAndLibraries.cmake:159</p>
</section>
<section id="tribits-tpl-libraries-entry-type">
<h3><a class="toc-backref" href="#id169">tribits_tpl_libraries_entry_type()</a><a class="headerlink" href="#tribits-tpl-libraries-entry-type" title="Permalink to this heading"></a></h3>
<p>Returns the type of the library entry in the list TPL_&lt;tplName&gt;_LIBRARIES</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_tpl_libraries_entry_type</span><span class="p">(</span><span class="o">&lt;</span><span class="n">libentry</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">libEntryTypeOut</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Arguments:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&lt;libentry&gt;</span></code> [in]: Element of <code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_LIBRARIES</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;libEntryTypeOut&gt;</span></code> [out]: Variable set on output to the type of entry.</p>
</div></blockquote>
<p>The types of entries set on <code class="docutils literal notranslate"><span class="pre">libEntryTypeOut</span></code> include:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FULL_LIB_PATH</span></code>: A full library path</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LIB_NAME_LINK_OPTION</span></code>: A library name link option of the form
<code class="docutils literal notranslate"><span class="pre">-l&lt;libname&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LIB_NAME</span></code>: A library name of the form <code class="docutils literal notranslate"><span class="pre">&lt;libname&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LIB_DIR_LINK_OPTION</span></code>: A library directory search option of the form
<code class="docutils literal notranslate"><span class="pre">-L&lt;dir&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GENERAL_LINK_OPTION</span></code>: Some other general link option that starts with
<code class="docutils literal notranslate"><span class="pre">-</span></code> but is not <code class="docutils literal notranslate"><span class="pre">-l</span></code> or <code class="docutils literal notranslate"><span class="pre">-L</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UNSUPPORTED_LIB_ENTRY</span></code>: An unsupported lib option</p></li>
</ul>
</div></blockquote>
<p>In: core/package_arch/TribitsExternalPackageWriteConfigFile.cmake:458</p>
</section>
<section id="tribits-tpl-tentatively-enable">
<h3><a class="toc-backref" href="#id170">tribits_tpl_tentatively_enable()</a><a class="headerlink" href="#tribits-tpl-tentatively-enable" title="Permalink to this heading"></a></h3>
<p>Function that sets up for an optionally enabled TPL that is attempted to be
enabled but will be disabled if all of the parts are not found.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_tpl_tentatively_enable</span><span class="p">(</span><span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>This function can be called from any CMakeLists.txt file to put a TPL in
tentative enable mode.  But typically, it is called from an SE Package’s
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> file (see <a class="reference internal" href="#how-to-tentatively-enable-a-tpl">How to tentatively
enable a TPL</a>).</p>
<p>This should only be used for optional TPLs.  It will not work correctly for
required TPLs because any enabled packages that require this TPL will not be
disabled and instead will fail to configure or fail to build.</p>
<p>All this function does is to force set <code class="docutils literal notranslate"><span class="pre">TPL_ENABLE_&lt;tplName&gt;=ON</span></code> if it has
not already been set, and sets <code class="docutils literal notranslate"><span class="pre">TPL_TENTATIVE_ENABLE_&lt;tplName&gt;=ON</span></code> in the
cache.</p>
<p>NOTE: This function will only tentatively enable a TPL if its enable has not
be explicitly set on input, i.e. if <code class="docutils literal notranslate"><span class="pre">-D</span> <span class="pre">TPL_ENABLE_&lt;tplName&gt;=&quot;&quot;</span></code>.  If the
TPL has been explicitly enabled (i.e. <code class="docutils literal notranslate"><span class="pre">-D</span> <span class="pre">TPL_ENABLE_&lt;tplName&gt;=ON</span></code>) or
disabled (i.e. <code class="docutils literal notranslate"><span class="pre">-D</span> <span class="pre">TPL_ENABLE_&lt;tplName&gt;=OFF</span></code>), then this function has no
effect and the TPL will be unconditionally enabled or disabled.</p>
<p>In: core/package_arch/TribitsTplFindIncludeDirsAndLibraries.cmake:734</p>
</section>
<section id="tribits-write-flexible-package-client-export-files">
<h3><a class="toc-backref" href="#id171">tribits_write_flexible_package_client_export_files()</a><a class="headerlink" href="#tribits-write-flexible-package-client-export-files" title="Permalink to this heading"></a></h3>
<p>Utility function for writing <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}Config.cmake</span></code> files for
package <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code> with some greater flexibility than what is
provided by the function <code class="docutils literal notranslate"><span class="pre">tribits_write_package_client_export_files()</span></code> and
to allow unit testing the generation of these files..</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_write_flexible_package_client_export_files</span><span class="p">(</span>
  <span class="n">PACKAGE_NAME</span> <span class="o">&lt;</span><span class="n">packageName</span><span class="o">&gt;</span>
  <span class="p">[</span><span class="n">EXPORT_FILE_VAR_PREFIX</span> <span class="o">&lt;</span><span class="n">exportFileVarPrefix</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">PACKAGE_CONFIG_FOR_BUILD_BASE_DIR</span> <span class="o">&lt;</span><span class="n">packageConfigForBuildBaseDir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">[</span><span class="n">PACKAGE_CONFIG_FOR_INSTALL_BASE_DIR</span> <span class="o">&lt;</span><span class="n">packageConfigForInstallBaseDir</span><span class="o">&gt;</span><span class="p">]</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>The arguments are:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">PACKAGE_NAME</span> <span class="pre">&lt;packageName&gt;</span></code></p>
<blockquote>
<div><p>Gives the name of the TriBITS package for which the export files should
be created.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">EXPORT_FILE_VAR_PREFIX</span> <span class="pre">&lt;exportFileVarPrefix&gt;</span></code></p>
<blockquote>
<div><p>If specified, then all of the variables in the generated export files
will be prefixed with <code class="docutils literal notranslate"><span class="pre">&lt;exportFileVarPrefix&gt;_</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;_</span></code>.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">PACKAGE_CONFIG_FOR_BUILD_BASE_DIR</span> <span class="pre">&lt;packageConfigForBuildBaseDir&gt;</span></code></p>
<blockquote>
<div><p>If specified, then the package’s <code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;Config.cmake</span></code> file and
supporting files will be written under the directory
<code class="docutils literal notranslate"><span class="pre">&lt;packageConfigForBuildBaseDir&gt;/</span></code> (and any subdirs that does exist
will be created).  The generated file <code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;Config.cmake</span></code> is
for usage of the package in the build tree (not the install tree) and
points to include directories and libraries in the build tree.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">PACKAGE_CONFIG_FOR_INSTALL_BASE_DIR</span> <span class="pre">&lt;packageConfigForInstallBaseDir&gt;</span></code></p>
<blockquote>
<div><p>If specified, then the package’s <code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;Config_install.cmake</span></code>
file and supporting files will be written under the directory
<code class="docutils literal notranslate"><span class="pre">&lt;packageConfigForInstallBaseDir&gt;/</span></code> (and any subdirs that does exist
will be created).  The file <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}Config_install.cmake</span></code> is
meant to be installed renamed as <code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;Config.cmake</span></code> in the
install tree and it points to installed include directories and
libraries.</p>
</div></blockquote>
</div></blockquote>
<p>NOTE: This function does <em>not</em> contain any <code class="docutils literal notranslate"><span class="pre">install()</span></code> command itself
because CMake will not allow those to even be present in scripting mode that
is used for unit testing this function.  Instead, the commands to install
the files are added by the function
<code class="docutils literal notranslate"><span class="pre">tribits_write_package_client_export_files_install_targets()</span></code>.</p>
<p>In: core/package_arch/TribitsWriteClientExportFiles.cmake:83</p>
</section>
<section id="tribits-verbose-print-var">
<h3><a class="toc-backref" href="#id172">tribits_verbose_print_var()</a><a class="headerlink" href="#tribits-verbose-print-var" title="Permalink to this heading"></a></h3>
<p>print a variable giving its name then value if
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_VERBOSE_CONFIGURE=TRUE</span></code>.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_verbose_print_var</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>This prints:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">message</span><span class="p">(</span><span class="s2">&quot;-- &quot;</span> <span class="s2">&quot;$</span><span class="si">{VARIBLE_NAME}</span><span class="s2">=&#39;${$</span><span class="si">{VARIBLE_NAME}</span><span class="s2">}&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The variable <code class="docutils literal notranslate"><span class="pre">&lt;varName&gt;</span></code> can be defined or undefined or empty.  This uses
an explicit “– ” line prefix so that it prints nice even on Windows CMake.</p>
<p>In: core/package_arch/TribitsVerbosePrintVar.cmake:44</p>
</section>
</section>
<section id="general-utility-macros-and-functions">
<h2><a class="toc-backref" href="#id173"><span class="sectnum">11.3</span> General Utility Macros and Functions</a><a class="headerlink" href="#general-utility-macros-and-functions" title="Permalink to this heading"></a></h2>
<p>The following subsections give detailed documentation for some CMake macros
and functions which are <em>not</em> a core part of the TriBITS system but are
included in the TriBITS source tree, are used inside of the TriBITS system,
and are provided as a convenience to TriBITS project developers.  One will see
many of these functions and macros used throughout the implementation of
TriBITS and even in the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> files for different projects that
use TriBITS.</p>
<p>These macros and functions are <em>not</em> prefixed with <code class="docutils literal notranslate"><span class="pre">TRIBITS_</span></code>.  However,
there is really not a large risk to defining and using these non-namespaces
utility functions and macros.  It turns out that CMake allows one to redefine
any macro or function, even built-in ones, inside of one’s project.
Therefore, even if CMake did add new commands that clashed with these names,
there would be no conflict.  When overriding a built-in command,
e.g. <code class="docutils literal notranslate"><span class="pre">some_builtin_command()</span></code>, one can always access the original built-in
command as <code class="docutils literal notranslate"><span class="pre">_some_builtin_command()</span></code>.</p>
<section id="add-subdirectories">
<h3><a class="toc-backref" href="#id174">add_subdirectories()</a><a class="headerlink" href="#add-subdirectories" title="Permalink to this heading"></a></h3>
<p>Macro that adds a list of subdirectories all at once (removes boiler-plate
code).</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">add_subdirectories</span><span class="p">(</span><span class="o">&lt;</span><span class="n">dir1</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">dir2</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>instead of:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">add_subdirectory</span><span class="p">(</span><span class="o">&lt;</span><span class="n">dir1</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">add_subdirectory</span><span class="p">(</span><span class="o">&lt;</span><span class="n">dir2</span><span class="o">&gt;</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
<p>In: core/utils/AddSubdirectories.cmake:41</p>
</section>
<section id="advanced-option">
<h3><a class="toc-backref" href="#id175">advanced_option()</a><a class="headerlink" href="#advanced-option" title="Permalink to this heading"></a></h3>
<p>Macro that sets an option and marks it as advanced (removes boiler-plate and
duplication).</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">advanced_option</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">other</span> <span class="n">arguments</span><span class="p">])</span>
</pre></div>
</div>
<p>This just calls the built-in CMake commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">option</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">other</span> <span class="n">arguments</span><span class="p">])</span>
<span class="n">mark_as_advanced</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>In: core/utils/AdvancedOption.cmake:41</p>
</section>
<section id="advanced-set">
<h3><a class="toc-backref" href="#id176">advanced_set()</a><a class="headerlink" href="#advanced-set" title="Permalink to this heading"></a></h3>
<p>Macro that sets a variable and marks it as advanced (removes boiler-plate
and duplication).</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">advanced_set</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">other</span> <span class="n">arguments</span><span class="p">])</span>
</pre></div>
</div>
<p>This just calls the built-in commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">other</span> <span class="n">arguments</span><span class="p">])</span>
<span class="n">mark_as_advanced</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>In: core/utils/AdvancedSet.cmake:41</p>
</section>
<section id="append-cmndline-args">
<h3><a class="toc-backref" href="#id177">append_cmndline_args()</a><a class="headerlink" href="#append-cmndline-args" title="Permalink to this heading"></a></h3>
<p>Utility function that appends command-line arguments to a variable of
command-line arguments.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">append_cmndline_args</span><span class="p">(</span><span class="o">&lt;</span><span class="n">var</span><span class="o">&gt;</span> <span class="s2">&quot;&lt;extraArgs&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This function just appends the command-line arguments in the string
<code class="docutils literal notranslate"><span class="pre">&quot;&lt;extraArgs&gt;&quot;</span></code> but does not add an extra space if <code class="docutils literal notranslate"><span class="pre">&lt;var&gt;</span></code> is empty on
input.  This just makes the formatting of command-line arguments easier.</p>
<p>In: core/utils/AppendCmndlineArgs.cmake:41</p>
</section>
<section id="append-glob">
<h3><a class="toc-backref" href="#id178">append_glob()</a><a class="headerlink" href="#append-glob" title="Permalink to this heading"></a></h3>
<p>Utility macro that does a <code class="docutils literal notranslate"><span class="pre">file(GLOB</span> <span class="pre">...)</span></code> and appends to an existing list
(removes boiler-plate code).</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">append_glob</span><span class="p">(</span><span class="o">&lt;</span><span class="n">fileListVar</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">glob0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">glob1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>On output, <code class="docutils literal notranslate"><span class="pre">&lt;fileListVar&gt;</span></code> will have the list of glob files appended.</p>
<p>In: core/utils/AppendGlob.cmake:43</p>
</section>
<section id="append-global-set">
<h3><a class="toc-backref" href="#id179">append_global_set()</a><a class="headerlink" href="#append-global-set" title="Permalink to this heading"></a></h3>
<p>Utility macro that appends arguments to a global variable (reduces
boiler-plate code and mistakes).</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">append_global_set</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">arg0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">arg1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>NOTE: The variable <code class="docutils literal notranslate"><span class="pre">&lt;varName&gt;</span></code> must exist before calling this function.
To set it empty initially use <a class="reference internal" href="#global-null-set">global_null_set()</a>.</p>
<p>In: core/utils/AppendGlobalSet.cmake:44</p>
</section>
<section id="append-set">
<h3><a class="toc-backref" href="#id180">append_set()</a><a class="headerlink" href="#append-set" title="Permalink to this heading"></a></h3>
<p>Utility function to append elements to a variable (reduces boiler-plate
code).</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">append_set</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">arg0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">arg1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>This just calls:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">APPEND</span> <span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">arg0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">arg1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>There is better error reporting if one misspells <code class="docutils literal notranslate"><span class="pre">APPEND_SET</span></code> than if one
misspells <code class="docutils literal notranslate"><span class="pre">APPEND</span></code>.</p>
<p>In: core/utils/AppendSet.cmake:41</p>
</section>
<section id="append-string-var">
<h3><a class="toc-backref" href="#id181">append_string_var()</a><a class="headerlink" href="#append-string-var" title="Permalink to this heading"></a></h3>
<p>Append strings to an existing string variable (reduces boiler-place code and
reduces mistakes).</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">append_string_var</span><span class="p">(</span><span class="o">&lt;</span><span class="n">stringVar</span><span class="o">&gt;</span> <span class="s2">&quot;&lt;string1&gt;&quot;</span> <span class="s2">&quot;&lt;string2&gt;&quot;</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the usage of the characters <code class="docutils literal notranslate"><span class="pre">'['</span></code>, <code class="docutils literal notranslate"><span class="pre">']'</span></code>, <code class="docutils literal notranslate"><span class="pre">'{'</span></code>, <code class="docutils literal notranslate"><span class="pre">'}'</span></code> are
taken by CMake to bypass the meaning of ‘;’ to separate string characters.
If one wants to ignore the meaning of these special characters and are okay
with just adding one string at a time, then use <a class="reference internal" href="#append-string-var-ext">append_string_var_ext()</a>.</p>
<p><strong>DEPRECATED</strong>: Instead, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">string</span><span class="p">(</span><span class="n">APPEND</span> <span class="o">&lt;</span><span class="n">stringVar</span><span class="o">&gt;</span> <span class="s2">&quot;&lt;string1&gt;&quot;</span> <span class="s2">&quot;&lt;string2&gt;&quot;</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>In: core/utils/AppendStringVar.cmake:44</p>
</section>
<section id="append-string-var-ext">
<h3><a class="toc-backref" href="#id182">append_string_var_ext()</a><a class="headerlink" href="#append-string-var-ext" title="Permalink to this heading"></a></h3>
<p>Append a single string to an existing string variable, ignoring ‘;’ (reduces
boiler-place code and reduces mistakes).</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">append_string_var_ext</span><span class="p">(</span><span class="o">&lt;</span><span class="n">stringVar</span><span class="o">&gt;</span> <span class="s2">&quot;&lt;string&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Simply sets <code class="docutils literal notranslate"><span class="pre">&lt;stringVar&gt;</span> <span class="pre">=</span> <span class="pre">&quot;${&lt;stringVar&gt;}&lt;string&gt;&quot;</span></code> and leaves in <code class="docutils literal notranslate"><span class="pre">';'</span></code>
without creating new array elements.</p>
<p>In: core/utils/AppendStringVar.cmake:71</p>
</section>
<section id="append-string-var-with-sep">
<h3><a class="toc-backref" href="#id183">append_string_var_with_sep()</a><a class="headerlink" href="#append-string-var-with-sep" title="Permalink to this heading"></a></h3>
<p>Append strings to a given string variable, joining them using a separator
string.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">append_string_var_with_sep</span><span class="p">(</span><span class="o">&lt;</span><span class="n">stringVar</span><span class="o">&gt;</span> <span class="s2">&quot;&lt;sepStr&gt;&quot;</span> <span class="s2">&quot;&lt;str0&gt;&quot;</span> <span class="s2">&quot;&lt;str1&gt;&quot;</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Each of the strings <code class="docutils literal notranslate"><span class="pre">&lt;stri&gt;</span></code> are appended to <code class="docutils literal notranslate"><span class="pre">&lt;stringVar&gt;</span></code> using the
separation string <code class="docutils literal notranslate"><span class="pre">&lt;sepStr&gt;</span></code>.</p>
<p>In: core/utils/AppendStringVarWithSep.cmake:43</p>
</section>
<section id="assert-defined">
<h3><a class="toc-backref" href="#id184">assert_defined()</a><a class="headerlink" href="#assert-defined" title="Permalink to this heading"></a></h3>
<p>Assert that a variable is defined and if not call <code class="docutils literal notranslate"><span class="pre">message(SEND_ERROR</span>
<span class="pre">...)</span></code>.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">assert_defined</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>This is used to get around the problem of CMake not asserting the
dereferencing of undefined variables.  For example, how does one know if one
did not misspell the name of a variable in an if statement like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">SOME_VARBLE</span><span class="p">)</span>
  <span class="o">...</span>
<span class="n">endif</span><span class="p">()</span>
</pre></div>
</div>
<p>?</p>
<blockquote>
<div><p>If one misspelled the variable <code class="docutils literal notranslate"><span class="pre">SOME_VARBLE</span></code> (which is likely in this
case), then the if statement will always be false!  To avoid this problem
when one always expects that a variable is explicitly set, instead do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">assert_defined</span><span class="p">(</span><span class="n">SOME_VARBLE</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">SOME_VARBLE</span><span class="p">)</span>
  <span class="o">...</span>
<span class="n">endif</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p>Now if one misspells this variable, then CMake will asset and stop
processing.  This is not a perfect solution since one can misspell the
variable name in the following if statement but typically one would always
just copy and paste between the two statements so these names are always the
same.  This is the best that can be done in CMake unfortunately to catch
usage of misspelled undefined variables.</p>
<p>In: core/utils/AssertDefined.cmake:41</p>
</section>
<section id="combined-option">
<h3><a class="toc-backref" href="#id185">combined_option()</a><a class="headerlink" href="#combined-option" title="Permalink to this heading"></a></h3>
<p>Set up a <code class="docutils literal notranslate"><span class="pre">BOOL</span></code> cache variable (i.e. an option) based on a set of
dependent options.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">combined_option</span><span class="p">(</span> <span class="o">&lt;</span><span class="n">combinedOptionName</span><span class="o">&gt;</span>
  <span class="n">DEP_OPTIONS_NAMES</span> <span class="o">&lt;</span><span class="n">depOpName0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">depOptName1</span><span class="o">&gt;</span> <span class="o">...</span>
  <span class="n">DOCSTR</span> <span class="s2">&quot;&lt;docstr0&gt;&quot;</span> <span class="s2">&quot;&lt;docstr1&gt;&quot;</span> <span class="o">...</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>This sets up a <code class="docutils literal notranslate"><span class="pre">BOOL</span></code> cache variable <code class="docutils literal notranslate"><span class="pre">&lt;combinedOptionName&gt;</span></code> which is
defaulted to <code class="docutils literal notranslate"><span class="pre">ON</span></code> if all of the listed dependent option variables
<code class="docutils literal notranslate"><span class="pre">&lt;depOpName0&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;depOptName1&gt;</span></code>, … are all <code class="docutils literal notranslate"><span class="pre">ON</span></code>.  However, if
<code class="docutils literal notranslate"><span class="pre">&lt;combinedOptionName&gt;</span></code> is set to <code class="docutils literal notranslate"><span class="pre">ON</span></code> by the user and not all of the
dependent option variables are also <code class="docutils literal notranslate"><span class="pre">ON</span></code>, then this results in a fatal
error and all processing stops.</p>
<p>This is used by a CMake project to automatically turn on a feature that
requires a set of other features (when they are all enabled) but allows a
user to disable the feature if desired.</p>
<p>In: core/utils/CombinedOption.cmake:45</p>
</section>
<section id="concat-strings">
<h3><a class="toc-backref" href="#id186">concat_strings()</a><a class="headerlink" href="#concat-strings" title="Permalink to this heading"></a></h3>
<p>Concatenate a set of string arguments.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">concat_strings</span><span class="p">(</span><span class="o">&lt;</span><span class="n">outputVar</span><span class="o">&gt;</span> <span class="s2">&quot;&lt;str0&gt;&quot;</span> <span class="s2">&quot;&lt;str1&gt;&quot;</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>On output, <code class="docutils literal notranslate"><span class="pre">&lt;outputVar&gt;</span></code> is set to <code class="docutils literal notranslate"><span class="pre">&quot;&lt;str0&gt;&lt;str1&gt;...&quot;</span></code>.  This makes it
easier to format a long string over multiple CMake source code lines.</p>
<p>In: core/utils/ConcatStrings.cmake:43</p>
</section>
<section id="dual-scope-append-cmndline-args">
<h3><a class="toc-backref" href="#id187">dual_scope_append_cmndline_args()</a><a class="headerlink" href="#dual-scope-append-cmndline-args" title="Permalink to this heading"></a></h3>
<p>Utility function that appends command-line arguments to a variable of
command-line options and sets the result in current scope and parent scope.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dual_scope_append_cmndline_args</span><span class="p">(</span><span class="o">&lt;</span><span class="n">var</span><span class="o">&gt;</span> <span class="s2">&quot;&lt;extraArgs&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Just calls <a class="reference internal" href="#append-cmndline-args">append_cmndline_args()</a> and then <code class="docutils literal notranslate"><span class="pre">set(&lt;var&gt;</span> <span class="pre">${&lt;var&gt;}</span> <span class="pre">PARENT_SCOPE)</span></code>.</p>
<p>In: core/utils/DualScopeAppendCmndlineArgs.cmake:44</p>
</section>
<section id="dual-scope-prepend-cmndline-args">
<h3><a class="toc-backref" href="#id188">dual_scope_prepend_cmndline_args()</a><a class="headerlink" href="#dual-scope-prepend-cmndline-args" title="Permalink to this heading"></a></h3>
<p>Utility function that prepends command-line arguments to a variable of
command-line arguments and sets the result in current scope and parent
scope.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dual_scope_prepend_cmndline_args</span><span class="p">(</span><span class="o">&lt;</span><span class="n">var</span><span class="o">&gt;</span> <span class="s2">&quot;&lt;extraArgs&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Just calls <a class="reference internal" href="#prepend-cmndline-args">prepend_cmndline_args()</a> and then <code class="docutils literal notranslate"><span class="pre">set(&lt;var&gt;</span> <span class="pre">${&lt;var&gt;}</span> <span class="pre">PARENT_SCOPE)</span></code>.</p>
<p>In: core/utils/DualScopePrependCmndlineArgs.cmake:44</p>
</section>
<section id="dual-scope-set">
<h3><a class="toc-backref" href="#id189">dual_scope_set()</a><a class="headerlink" href="#dual-scope-set" title="Permalink to this heading"></a></h3>
<p>Macro that sets a variable name both in the current scope and the
parent scope.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dual_scope_set</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">other</span> <span class="n">args</span><span class="p">])</span>
</pre></div>
</div>
<p>It turns out that when one calls <code class="docutils literal notranslate"><span class="pre">add_subdirectory(&lt;someDir&gt;)</span></code> or enters a
<code class="docutils literal notranslate"><span class="pre">FUNCTION</span></code> that CMake actually creates a copy of all of the regular
non-cache variables in the current scope in order to create a new set of
variables for the <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file in <code class="docutils literal notranslate"><span class="pre">&lt;someDir&gt;</span></code>.  This means that
if you call <code class="docutils literal notranslate"><span class="pre">set(SOMEVAR</span> <span class="pre">Blah</span> <span class="pre">PARENT_SCOPE)</span></code> that it will not affect the
value of <code class="docutils literal notranslate"><span class="pre">SOMEVAR</span></code> in the current scope!  This macro therefore is designed
to set the value of the variable in the current scope and the parent scope
in one shot to avoid confusion.</p>
<p>Global variables are different.  When one moves to a subordinate
<code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file or enters a <code class="docutils literal notranslate"><span class="pre">FUNCTION</span></code>, then a local copy of the
variable is <em>not</em> created.  If one sets the variable locally, it will shadow
the global variable.  However, if one sets the global cache value with
<code class="docutils literal notranslate"><span class="pre">set(SOMEVAR</span> <span class="pre">someValue</span> <span class="pre">CACHE</span> <span class="pre">INTERNAL</span> <span class="pre">&quot;&quot;)</span></code>, then the value will get
changed in the current subordinate scope and in all parent scopes all in one
shot!</p>
<p>In: core/utils/DualScopeSet.cmake:41</p>
</section>
<section id="global-null-set">
<h3><a class="toc-backref" href="#id190">global_null_set()</a><a class="headerlink" href="#global-null-set" title="Permalink to this heading"></a></h3>
<p>Set a variable as a null internal global (cache) variable (removes
boiler-plate code).</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">global_null_set</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>This just calls:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span> <span class="s2">&quot;&quot;</span> <span class="n">CACHE</span> <span class="n">INTERNAL</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This avoid problems with misspelling <code class="docutils literal notranslate"><span class="pre">CACHE</span></code>.</p>
<p>In: core/utils/GlobalNullSet.cmake:41</p>
</section>
<section id="global-set">
<h3><a class="toc-backref" href="#id191">global_set()</a><a class="headerlink" href="#global-set" title="Permalink to this heading"></a></h3>
<p>Set a variable as an internal global (cache) variable (removes boiler-plate
code).</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">global_set</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">other</span> <span class="n">args</span><span class="p">])</span>
</pre></div>
</div>
<p>This just calls:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">other</span> <span class="n">args</span><span class="p">]</span> <span class="n">CACHE</span> <span class="n">INTERNAL</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This avoid misspelling <code class="docutils literal notranslate"><span class="pre">CACHE</span></code>.</p>
<p>In: core/utils/GlobalSet.cmake:41</p>
</section>
<section id="join">
<h3><a class="toc-backref" href="#id192">join()</a><a class="headerlink" href="#join" title="Permalink to this heading"></a></h3>
<p>Join a set of strings into a single string using a join string.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">join</span><span class="p">(</span><span class="o">&lt;</span><span class="n">outputStrVar</span><span class="o">&gt;</span> <span class="s2">&quot;&lt;sepStr&gt;&quot;</span> <span class="o">&lt;</span><span class="n">quoteElements</span><span class="o">&gt;</span>
  <span class="s2">&quot;&lt;string0&gt;&quot;</span> <span class="s2">&quot;&lt;string1&gt;&quot;</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Arguments:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&lt;outputStrVar&gt;</span></code></p>
<blockquote>
<div><p>The name of a variable that will hold the output string.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">&quot;&lt;sepStr&gt;&quot;</span></code></p>
<blockquote>
<div><p>A string to use to join the list of strings.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">&lt;quoteElements&gt;</span></code></p>
<blockquote>
<div><dl class="simple">
<dt>If <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then each <code class="docutils literal notranslate"><span class="pre">&lt;stringi&gt;</span></code> is quoted using an escaped quote</dt><dd><p>char <code class="docutils literal notranslate"><span class="pre">\&quot;</span></code>.  If <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> then no escaped quote is used.</p>
</dd>
</dl>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">&quot;&lt;string0&gt;&quot;</span> <span class="pre">&quot;&lt;string1&gt;&quot;</span> <span class="pre">...</span></code></p>
<blockquote>
<div><p>Zero or more string arguments to be joined.</p>
</div></blockquote>
</div></blockquote>
<p>On output, the variable <code class="docutils literal notranslate"><span class="pre">&lt;outputStrVar&gt;</span></code> is set to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;&lt;string0&gt;&lt;sepStr&gt;&lt;string1&gt;&lt;sepStr&gt;...&quot;</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">&lt;quoteElements&gt;=TRUE</span></code>, then <code class="docutils literal notranslate"><span class="pre">&lt;outputStrVar&gt;</span></code> is set to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&lt;string0&gt;</span><span class="se">\&quot;</span><span class="s2">&lt;sepStr&gt;</span><span class="se">\&quot;</span><span class="s2">&lt;string1&gt;</span><span class="se">\&quot;</span><span class="s2">&lt;sepStr&gt;...&quot;</span>
</pre></div>
</div>
<p>For example, the latter can be used to set up a set of command-line
arguments given a CMake array like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>join(CMND_LINE_ARGS &quot; &quot; TRUE ${CMND_LINE_ARRAY})
</pre></div>
</div>
<p>WARNING: Be careful to quote string arguments that have spaces because CMake
interprets those as array boundaries.</p>
<p>In: core/utils/Join.cmake:41</p>
</section>
<section id="message-wrapper">
<h3><a class="toc-backref" href="#id193">message_wrapper()</a><a class="headerlink" href="#message-wrapper" title="Permalink to this heading"></a></h3>
<p>Function that wraps the standard CMake/CTest <code class="docutils literal notranslate"><span class="pre">message()</span></code> function call in
order to allow unit testing to intercept the output.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">message_wrapper</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>This function takes exactly the same arguments as built-in <code class="docutils literal notranslate"><span class="pre">message()</span></code>
function.  However, when the variable <code class="docutils literal notranslate"><span class="pre">MESSAGE_WRAPPER_UNIT_TEST_MODE</span></code> is
set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>, then this function will not call <code class="docutils literal notranslate"><span class="pre">message(...)</span></code> but
instead will prepend set to the global variable <code class="docutils literal notranslate"><span class="pre">MESSAGE_WRAPPER_INPUT</span></code>
the input argument that would have gone to <code class="docutils literal notranslate"><span class="pre">message()</span></code>.  To capture just
this call’s input, first call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">global_null_set</span><span class="p">(</span><span class="n">MESSAGE_WRAPPER_INPUT</span><span class="p">)</span>
</pre></div>
</div>
<p>before calling this function (or the functions/macros that call this
function).</p>
<p>This function allows one to unit test other user-defined CMake macros and
functions that call this function to catch error conditions without stopping
the CMake program.  Otherwise, this is used to capture print messages to
verify that they say the right thing.</p>
<p>In: core/utils/MessageWrapper.cmake:44</p>
</section>
<section id="multiline-set">
<h3><a class="toc-backref" href="#id194">multiline_set()</a><a class="headerlink" href="#multiline-set" title="Permalink to this heading"></a></h3>
<p>Function to set a single string by concatenating a list of separate strings</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">multiline_set</span><span class="p">(</span><span class="o">&lt;</span><span class="n">outputStrVar</span><span class="o">&gt;</span>
  <span class="s2">&quot;&lt;string0&gt;&quot;</span>
  <span class="s2">&quot;&lt;string1&gt;&quot;</span>
  <span class="o">...</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>On output, the local variables <code class="docutils literal notranslate"><span class="pre">&lt;outputStrVar&gt;</span></code> is set to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;&lt;string0&gt;&lt;string1&gt;...&quot;</span>
</pre></div>
</div>
<p>The purpose of this is function to make it easier to set longer strings over
multiple lines.</p>
<p>This function is exactly the same as <a class="reference internal" href="#concat-strings">concat_strings()</a> and should not even
exist :-(</p>
<p>In: core/utils/MultilineSet.cmake:41</p>
</section>
<section id="prepend-cmndline-args">
<h3><a class="toc-backref" href="#id195">prepend_cmndline_args()</a><a class="headerlink" href="#prepend-cmndline-args" title="Permalink to this heading"></a></h3>
<p>Utility function that prepends command-line arguments to a variable of
command-line arguments.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">prepend_cmndline_args</span><span class="p">(</span><span class="o">&lt;</span><span class="n">var</span><span class="o">&gt;</span> <span class="s2">&quot;&lt;extraArgs&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This function just prepends the command-line arguments in the string
<code class="docutils literal notranslate"><span class="pre">&quot;&lt;extraArgs&gt;&quot;</span></code> but does not add an extra space if <code class="docutils literal notranslate"><span class="pre">&lt;var&gt;</span></code> is empty on
input.</p>
<p>In: core/utils/PrependCmndlineArgs.cmake:41</p>
</section>
<section id="prepend-global-set">
<h3><a class="toc-backref" href="#id196">prepend_global_set()</a><a class="headerlink" href="#prepend-global-set" title="Permalink to this heading"></a></h3>
<p>Utility macro that prepends arguments to a global variable (reduces
boiler-plate code and mistakes).</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">prepend_global_set</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">arg0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">arg1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>The variable <code class="docutils literal notranslate"><span class="pre">&lt;varName&gt;</span></code> must exist before calling this function.  To set
it empty initially use <a class="reference internal" href="#global-null-set">global_null_set()</a>.</p>
<p>In: core/utils/PrependGlobalSet.cmake:44</p>
</section>
<section id="print-nonempty-var">
<h3><a class="toc-backref" href="#id197">print_nonempty_var()</a><a class="headerlink" href="#print-nonempty-var" title="Permalink to this heading"></a></h3>
<p>Print a defined variable giving its name then value only if it is not empty.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">print_nonempty_var</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Calls <code class="docutils literal notranslate"><span class="pre">print_var(&lt;varName&gt;)</span></code> if <code class="docutils literal notranslate"><span class="pre">${&lt;varName&gt;}</span></code> is not empty.</p>
<p>In: core/utils/PrintNonemptyVar.cmake:44</p>
</section>
<section id="print-nonempty-var-with-spaces">
<h3><a class="toc-backref" href="#id198">print_nonempty_var_with_spaces()</a><a class="headerlink" href="#print-nonempty-var-with-spaces" title="Permalink to this heading"></a></h3>
<p>Print a defined variable giving its name then value printed with spaces
instead of <code class="docutils literal notranslate"><span class="pre">';'</span></code> but only if it is not empty.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">print_nonempty_var_with_spaces</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">printedVarInOut</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Prints the variable as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">ele0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ele1</span><span class="o">&gt;</span> <span class="o">...</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">$&lt;printedVarInOut&gt;</span></code> is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> on input, then the variable is not
touched. If however, the variable <code class="docutils literal notranslate"><span class="pre">$&lt;printedVarInOut&gt;</span></code> is not <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> on
input, then it is set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> on output.</p>
<p>In: core/utils/PrintNonemptyVarWithSpaces.cmake:44</p>
</section>
<section id="print-var">
<h3><a class="toc-backref" href="#id199">print_var()</a><a class="headerlink" href="#print-var" title="Permalink to this heading"></a></h3>
<p>Unconditionally print a variable giving its name then value.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">print_var</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>This prints:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">message</span><span class="p">(</span><span class="s2">&quot;-- &quot;</span> <span class="s2">&quot;$</span><span class="si">{VARIBLE_NAME}</span><span class="s2">=&#39;${$</span><span class="si">{VARIBLE_NAME}</span><span class="s2">}&#39;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The variable <code class="docutils literal notranslate"><span class="pre">&lt;varName&gt;</span></code> can be defined or undefined or empty.  This uses
an explicit “– ” line prefix so that it prints nice even on Windows CMake.</p>
<p>In: core/utils/PrintVar.cmake:42</p>
</section>
<section id="print-var-with-spaces">
<h3><a class="toc-backref" href="#id200">print_var_with_spaces()</a><a class="headerlink" href="#print-var-with-spaces" title="Permalink to this heading"></a></h3>
<p>Print a defined variable giving its name then value printed with spaces
instead of <code class="docutils literal notranslate"><span class="pre">';'</span></code>.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">print_var_with_spaces</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">printedVarInOut</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Prints the variable as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">ele0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">ele1</span><span class="o">&gt;</span> <span class="o">...</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">$&lt;printedVarInOut&gt;</span></code> is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> on input, then the variable is not
touched. If however, the variable <code class="docutils literal notranslate"><span class="pre">$&lt;printedVarInOut&gt;</span></code> is not <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> on
input, then it is set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> on output.</p>
<p>In: core/utils/PrintVarWithSpaces.cmake:44</p>
</section>
<section id="remove-global-duplicates">
<h3><a class="toc-backref" href="#id201">remove_global_duplicates()</a><a class="headerlink" href="#remove-global-duplicates" title="Permalink to this heading"></a></h3>
<p>Remove duplicate elements from a global list variable (removes boiler-plate
code and errors).</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">remove_global_duplicates</span><span class="p">(</span><span class="o">&lt;</span><span class="n">globalVarName</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>This function is necessary in order to preserve the “global” nature of the
variable.  If one just calls <code class="docutils literal notranslate"><span class="pre">list(REMOVE_DUPLICATES</span> <span class="pre">...)</span></code> it will
actually create a local variable of the same name and shadow the global
variable!  That is a fun bug to track down!  The variable
<code class="docutils literal notranslate"><span class="pre">&lt;globalVarName&gt;</span></code> must be defined before this function is called.  If
<code class="docutils literal notranslate"><span class="pre">&lt;globalVarName&gt;</span></code> is actually not a global cache variable before this
function is called it will be after it completes.</p>
<p>In: core/utils/RemoveGlobalDuplicates.cmake:44</p>
</section>
<section id="set-and-inc-dirs">
<h3><a class="toc-backref" href="#id202">set_and_inc_dirs()</a><a class="headerlink" href="#set-and-inc-dirs" title="Permalink to this heading"></a></h3>
<p>Set a variable to an include directory and call <code class="docutils literal notranslate"><span class="pre">include_directories()</span></code>
(removes boiler-plate code).</p>
<p>Usage:</p>
<blockquote>
<div><p>set_and_inc_dirs(&lt;dirVarName&gt; &lt;includeDir&gt;)</p>
</div></blockquote>
<p>On output, this sets <code class="docutils literal notranslate"><span class="pre">&lt;dirVarName&gt;</span></code> to <code class="docutils literal notranslate"><span class="pre">&lt;includeDir&gt;</span></code> in the local scope
and calls <code class="docutils literal notranslate"><span class="pre">include_directories(&lt;includeDir&gt;)</span></code>.</p>
<p>In: core/utils/SetAndIncDirs.cmake:41</p>
</section>
<section id="set-cache-on-off-empty">
<h3><a class="toc-backref" href="#id203">set_cache_on_off_empty()</a><a class="headerlink" href="#set-cache-on-off-empty" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">set_cache_on_off_empty</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">initialVal</span><span class="o">&gt;</span> <span class="s2">&quot;&lt;docString&gt;&quot;</span> <span class="p">[</span><span class="n">FORCE</span><span class="p">])</span>
</pre></div>
</div>
<p>Sets a special string cache variable with possible values “”, “ON”, or
“OFF”.  This results in a nice drop-down box in the CMake cache manipulation
GUIs.</p>
<p>In: core/utils/SetCacheOnOffEmpty.cmake:41</p>
</section>
<section id="set-default">
<h3><a class="toc-backref" href="#id204">set_default()</a><a class="headerlink" href="#set-default" title="Permalink to this heading"></a></h3>
<p>Give a local variable a default value if a non-empty value is not already
set.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">set_default</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">arg0</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">arg1</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>If on input <code class="docutils literal notranslate"><span class="pre">&quot;${&lt;varName&gt;}&quot;==&quot;&quot;</span></code>, then <code class="docutils literal notranslate"><span class="pre">&lt;varName&gt;</span></code> is set to the given
default <code class="docutils literal notranslate"><span class="pre">&lt;arg0&gt;</span> <span class="pre">&lt;arg1&gt;</span> <span class="pre">...</span></code>.  Otherwise, the existing non-empty value is
preserved.</p>
<p>In: core/utils/SetDefault.cmake:41</p>
</section>
<section id="set-default-and-from-env">
<h3><a class="toc-backref" href="#id205">set_default_and_from_env()</a><a class="headerlink" href="#set-default-and-from-env" title="Permalink to this heading"></a></h3>
<p>Set a default value for a local variable and override from an environment
variable of the same name if it is set.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">set_default_and_from_env</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">defaultVal</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>First calls <code class="docutils literal notranslate"><span class="pre">set_default(&lt;varName&gt;</span> <span class="pre">&lt;defaultVal&gt;)</span></code> and then looks for an
environment variable named <code class="docutils literal notranslate"><span class="pre">&lt;varName&gt;</span></code>, and if non-empty then overrides
the value of the local variable <code class="docutils literal notranslate"><span class="pre">&lt;varName&gt;</span></code>.</p>
<p>This macro is primarily used in CTest code to provide a way to pass in the
value of CMake variables.  Older versions of <code class="docutils literal notranslate"><span class="pre">ctest</span></code> did not support the
option <code class="docutils literal notranslate"><span class="pre">-D</span> <span class="pre">&lt;var&gt;:&lt;type&gt;=&lt;value&gt;</span></code> to allow variables to be set through the
command-line like <code class="docutils literal notranslate"><span class="pre">cmake</span></code> always allowed.</p>
<p>In: core/utils/SetDefaultAndFromEnv.cmake:45</p>
</section>
<section id="split">
<h3><a class="toc-backref" href="#id206">split()</a><a class="headerlink" href="#split" title="Permalink to this heading"></a></h3>
<p>Split a string variable into a string array/list variable.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;inputStr&gt;&quot;</span> <span class="s2">&quot;&lt;sepStr&gt;&quot;</span> <span class="o">&lt;</span><span class="n">outputStrListVar</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;sepStr&gt;</span></code> string is used with <code class="docutils literal notranslate"><span class="pre">string(REGEX</span> <span class="pre">...)</span></code> to replace all
occurrences of <code class="docutils literal notranslate"><span class="pre">&lt;sepStr&gt;</span></code> in <code class="docutils literal notranslate"><span class="pre">&lt;inputStr&gt;</span></code> with <code class="docutils literal notranslate"><span class="pre">&quot;;&quot;</span></code> and writing into
<code class="docutils literal notranslate"><span class="pre">&lt;outputStrListVar&gt;</span></code>.</p>
<p>WARNING: <code class="docutils literal notranslate"><span class="pre">&lt;sepStr&gt;</span></code> is interpreted as a regular expression (regex) so keep
that in mind when considering special regex chars like <code class="docutils literal notranslate"><span class="pre">'*'</span></code>, <code class="docutils literal notranslate"><span class="pre">'.'</span></code>,
etc!</p>
<p>In: core/utils/Split.cmake:41</p>
</section>
<section id="timer-get-raw-seconds">
<h3><a class="toc-backref" href="#id207">timer_get_raw_seconds()</a><a class="headerlink" href="#timer-get-raw-seconds" title="Permalink to this heading"></a></h3>
<p>Return the raw time in seconds (nano-second accuracy) since epoch, i.e.,
since 1970-01-01 00:00:00 UTC.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">timer_get_raw_seconds</span><span class="p">(</span><span class="o">&lt;</span><span class="n">rawSecondsVar</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>This function is used along with <a class="reference internal" href="#timer-get-rel-seconds">timer_get_rel_seconds()</a>, and
<a class="reference internal" href="#timer-print-rel-time">timer_print_rel_time()</a> to time big chunks of CMake code for timing and
profiling purposes.  See <a class="reference internal" href="#timer-print-rel-time">timer_print_rel_time()</a> for more details and an
example.</p>
<p>NOTE: This function runs an external process with <code class="docutils literal notranslate"><span class="pre">execute_process()</span></code> to
run the <code class="docutils literal notranslate"><span class="pre">date</span></code> command.  Therefore, it only works on Unix/Linux and other
systems that have a standard <code class="docutils literal notranslate"><span class="pre">date</span></code> command.  Since this uses
<code class="docutils literal notranslate"><span class="pre">execute_process()</span></code>, this function should only be used to time very
course-grained operations (i.e. that take longer than a second).  If the
<cite>date</cite> command does not exist, then ${&lt;rawSecondsVar&gt;} will be empty on
output!</p>
<p>In: core/utils/TimingUtils.cmake:50</p>
</section>
<section id="timer-get-rel-seconds">
<h3><a class="toc-backref" href="#id208">timer_get_rel_seconds()</a><a class="headerlink" href="#timer-get-rel-seconds" title="Permalink to this heading"></a></h3>
<p>Return the relative time between start and stop seconds.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">timer_get_rel_seconds</span><span class="p">(</span><span class="o">&lt;</span><span class="n">startSeconds</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">endSeconds</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">relSecondsOutVar</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>This simple function computes the relative number of seconds between
<code class="docutils literal notranslate"><span class="pre">&lt;startSeconds&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;endSeconds&gt;</span></code> (returned from
<a class="reference internal" href="#timer-get-raw-seconds">timer_get_raw_seconds()</a>) and sets the result in the local variable
<code class="docutils literal notranslate"><span class="pre">&lt;relSecondsOutVar&gt;</span></code>.</p>
<p>In: core/utils/TimingUtils.cmake:79</p>
</section>
<section id="timer-print-rel-time">
<h3><a class="toc-backref" href="#id209">timer_print_rel_time()</a><a class="headerlink" href="#timer-print-rel-time" title="Permalink to this heading"></a></h3>
<p>Print the relative time between start and stop timers in <code class="docutils literal notranslate"><span class="pre">&lt;min&gt;m&lt;sec&gt;s</span></code>
format.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">timer_print_rel_time</span><span class="p">(</span><span class="o">&lt;</span><span class="n">startSeconds</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">endSeconds</span><span class="o">&gt;</span> <span class="s2">&quot;&lt;messageStr&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Differences the raw times <code class="docutils literal notranslate"><span class="pre">&lt;startSeconds&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;endSeconds&gt;</span></code>
(i.e. gotten from <a class="reference internal" href="#timer-get-raw-seconds">timer_get_raw_seconds()</a>) and prints the time in
<code class="docutils literal notranslate"><span class="pre">&lt;min&gt;m&lt;sec&gt;s</span></code> format.</p>
<p>This is meant to be used with <a class="reference internal" href="#timer-get-raw-seconds">timer_get_raw_seconds()</a> to time expensive
blocks of CMake code like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>timer_get_raw_seconds(REAL_EXPENSIVE_START)

real_expensive(...)

timer_get_raw_seconds(REAL_EXPENSIVE_END)

timer_print_rel_time(${REAL_EXPENSIVE_START} ${REAL_EXPENSIVE_END}
   &quot;real_expensive() time&quot;)
</pre></div>
</div>
<p>This will print something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">real_expensive</span><span class="p">()</span> <span class="n">time</span><span class="p">:</span> <span class="mi">0</span><span class="n">m5</span><span class="mf">.235</span><span class="n">s</span>
</pre></div>
</div>
<p>In: core/utils/TimingUtils.cmake:116</p>
</section>
<section id="tribits-strip-quotes-from-str">
<h3><a class="toc-backref" href="#id210">tribits_strip_quotes_from_str()</a><a class="headerlink" href="#tribits-strip-quotes-from-str" title="Permalink to this heading"></a></h3>
<p>Remove one set of quotes from the outside of a string if they exist.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_strip_quotes_from_str</span><span class="p">(</span><span class="o">&lt;</span><span class="n">str_in</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">str_var_out</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">&lt;str_in&gt;</span></code> does not contain a quote char <code class="docutils literal notranslate"><span class="pre">'&quot;'</span></code> as the first and last
char, then the original <code class="docutils literal notranslate"><span class="pre">&lt;str_in&gt;</span></code> is returned in <code class="docutils literal notranslate"><span class="pre">&lt;str_var_out&gt;</span></code>.</p>
<p>In: core/utils/TribitsStripQuotesFromStr.cmake:1</p>
</section>
<section id="unittest-compare-const">
<h3><a class="toc-backref" href="#id211">unittest_compare_const()</a><a class="headerlink" href="#unittest-compare-const" title="Permalink to this heading"></a></h3>
<p>Perform a single unit test equality check and update overall test statistics</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unittest_compare_const</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">expectedValue</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">${&lt;varName&gt;}</span> <span class="pre">==</span> <span class="pre">&lt;expectedValue&gt;</span></code>, then the check passes, otherwise it
fails.  This prints the variable name and values and shows the test result.</p>
<p>This updates the global variables <code class="docutils literal notranslate"><span class="pre">UNITTEST_OVERALL_NUMRUN</span></code>,
<code class="docutils literal notranslate"><span class="pre">UNITTEST_OVERALL_NUMPASSED</span></code>, and <code class="docutils literal notranslate"><span class="pre">UNITTEST_OVERALL_PASS</span></code> which are used
by the unit test harness system to assess overall pass/fail.</p>
<p>In: core/utils/UnitTestHelpers.cmake:64</p>
</section>
<section id="unittest-has-substr-const">
<h3><a class="toc-backref" href="#id212">unittest_has_substr_const()</a><a class="headerlink" href="#unittest-has-substr-const" title="Permalink to this heading"></a></h3>
<p>Check that a given string var contains the given substring and update
overall test statistics</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unittest_has_substr_const</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">substr</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">${&lt;varName&gt;}</span></code> contains the substring <code class="docutils literal notranslate"><span class="pre">&lt;substr&gt;</span></code>, then the check
passes, otherwise it fails.  This prints the variable name and values and
shows the test result.</p>
<p>This updates the global variables <code class="docutils literal notranslate"><span class="pre">UNITTEST_OVERALL_NUMRUN</span></code>,
<code class="docutils literal notranslate"><span class="pre">UNITTEST_OVERALL_NUMPASSED</span></code>, and <code class="docutils literal notranslate"><span class="pre">UNITTEST_OVERALL_PASS</span></code> which are used
by the unit test harness system to assess overall pass/fail.</p>
<p>In: core/utils/UnitTestHelpers.cmake:348</p>
</section>
<section id="unittest-not-has-substr-const">
<h3><a class="toc-backref" href="#id213">unittest_not_has_substr_const()</a><a class="headerlink" href="#unittest-not-has-substr-const" title="Permalink to this heading"></a></h3>
<p>Check that a given string var does <strong>NOT</strong> contains the given substring and
update overall test statistics</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unittest_not_has_substr_const</span><span class="p">(</span><span class="o">&lt;</span><span class="n">varName</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">substr</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">${&lt;varName&gt;}</span></code> contains the substring <code class="docutils literal notranslate"><span class="pre">&lt;substr&gt;</span></code>, then the check
failed, otherwise it passes.  This prints the variable name and values and
shows the test result.</p>
<p>This updates the global variables <code class="docutils literal notranslate"><span class="pre">UNITTEST_OVERALL_NUMRUN</span></code>,
<code class="docutils literal notranslate"><span class="pre">UNITTEST_OVERALL_NUMPASSED</span></code>, and <code class="docutils literal notranslate"><span class="pre">UNITTEST_OVERALL_PASS</span></code> which are used
by the unit test harness system to assess overall pass/fail.</p>
<p>In: core/utils/UnitTestHelpers.cmake:394</p>
</section>
<section id="unittest-string-regex">
<h3><a class="toc-backref" href="#id214">unittest_string_regex()</a><a class="headerlink" href="#unittest-string-regex" title="Permalink to this heading"></a></h3>
<p>Perform a series of regexes on a given string and update overall test
statistics.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unittest_string_regex</span><span class="p">(</span>
  <span class="s2">&quot;&lt;inputString&gt;&quot;</span>
  <span class="n">REGEX_STRINGS</span> <span class="s2">&quot;&lt;str0&gt;&quot;</span> <span class="s2">&quot;&lt;str1&gt;&quot;</span> <span class="o">...</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">&lt;inputString&gt;</span></code> matches all of the of the regexs <code class="docutils literal notranslate"><span class="pre">&quot;&lt;str0&gt;&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;&lt;str1&gt;&quot;</span></code>, …, then the test passes.  Otherwise it fails.</p>
<p>This updates the global variables <code class="docutils literal notranslate"><span class="pre">UNITTEST_OVERALL_NUMRUN</span></code>,
<code class="docutils literal notranslate"><span class="pre">UNITTEST_OVERALL_NUMPASSED</span></code>, and <code class="docutils literal notranslate"><span class="pre">UNITTEST_OVERALL_PASS</span></code> which are used
by the unit test harness system to assess overall pass/fail.</p>
<p>In: core/utils/UnitTestHelpers.cmake:238</p>
</section>
<section id="unittest-string-var-regex">
<h3><a class="toc-backref" href="#id215">unittest_string_var_regex()</a><a class="headerlink" href="#unittest-string-var-regex" title="Permalink to this heading"></a></h3>
<p>Perform a series of regexes on a given string variable and update overall
test statistics.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unittest_string_var_regex</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">inputStringVar</span><span class="o">&gt;</span>
  <span class="n">REGEX_STRINGS</span> <span class="s2">&quot;&lt;str0&gt;&quot;</span> <span class="s2">&quot;&lt;str1&gt;&quot;</span> <span class="o">...</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">&quot;${&lt;inputStringVar&gt;}&quot;</span></code> matches all of the of the regexs
<code class="docutils literal notranslate"><span class="pre">&quot;&lt;str0&gt;&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;&lt;str1&gt;&quot;</span></code>, …, then the test passes.  Otherwise it fails.</p>
<p>This updates the global variables <code class="docutils literal notranslate"><span class="pre">UNITTEST_OVERALL_NUMRUN</span></code>,
<code class="docutils literal notranslate"><span class="pre">UNITTEST_OVERALL_NUMPASSED</span></code>, and <code class="docutils literal notranslate"><span class="pre">UNITTEST_OVERALL_PASS</span></code> which are used
by the unit test harness system to assess overall pass/fail.</p>
<p>In: core/utils/UnitTestHelpers.cmake:297</p>
</section>
<section id="unittest-file-regex">
<h3><a class="toc-backref" href="#id216">unittest_file_regex()</a><a class="headerlink" href="#unittest-file-regex" title="Permalink to this heading"></a></h3>
<p>Perform a series regexes of given strings and update overall test statistics.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unittest_file_regex</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">inputFileName</span><span class="o">&gt;</span>
  <span class="n">REGEX_STRINGS</span> <span class="s2">&quot;&lt;str1&gt;&quot;</span> <span class="s2">&quot;&lt;str2&gt;&quot;</span> <span class="o">...</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>The contents of <code class="docutils literal notranslate"><span class="pre">&lt;inputFileName&gt;</span></code> are read into a string and then passed
to <a class="reference internal" href="#unittest-string-regex">unittest_string_regex()</a> to assess pass/fail.</p>
<p>In: core/utils/UnitTestHelpers.cmake:440</p>
</section>
<section id="unittest-final-result">
<h3><a class="toc-backref" href="#id217">unittest_final_result()</a><a class="headerlink" href="#unittest-final-result" title="Permalink to this heading"></a></h3>
<p>Print final statistics from all tests and assert final pass/fail</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unittest_final_result</span><span class="p">(</span><span class="o">&lt;</span><span class="n">expectedNumPassed</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">${UNITTEST_OVERALL_PASS}==TRUE</span></code> and <code class="docutils literal notranslate"><span class="pre">${UNITTEST_OVERALL_NUMPASSED}</span> <span class="pre">==</span>
<span class="pre">&lt;expectedNumPassed&gt;</span></code>, then the overall test program is determined to have
passed and string:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Final UnitTests Result: PASSED&quot;</span>
</pre></div>
</div>
<p>is printed.  Otherwise, the overall test program is determined to have
failed, the string:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Final UnitTests Result: FAILED&quot;</span>
</pre></div>
</div>
<p>is printed, and <code class="docutils literal notranslate"><span class="pre">message(SEND_ERROR</span> <span class="pre">&quot;FAIL&quot;)</span></code> is called.</p>
<p>The reason that we require passing in the expected number of passed tests is
as an extra precaution to make sure that important unit tests are not left
out.  CMake is a very loosely typed language and it pays to be a little
paranoid.</p>
<p>In: core/utils/UnitTestHelpers.cmake:461</p>
</section>
</section>
</section>
<section id="tribits-system-maintainers-documentation">
<h1><a class="toc-backref" href="#id218"><span class="sectnum">12</span> TriBITS System Maintainers Documentation</a><a class="headerlink" href="#tribits-system-maintainers-documentation" title="Permalink to this heading"></a></h1>
<p>This section contains more detailed information about the internal
implementation of TriBITS.  This information is meant to make it easier to
understand and manipulate the data-structures and macros/functions that make
up internal implementation of TriBITS.</p>
<section id="tribits-system-data-structures">
<h2><a class="toc-backref" href="#id219"><span class="sectnum">12.1</span> TriBITS System Data Structures</a><a class="headerlink" href="#tribits-system-data-structures" title="Permalink to this heading"></a></h2>
<p>This section describes the global CMake variables that make up the
data-structures and the functions that create them that define the TriBITS
package dependency system.  These variables all exist at the base
project-level CMakeLists.txt file and are typically not cache variables (and
therefore are recomputed on every reconfigure).  These variables define a
graph of external packages (i.e. TPLs) and internal packages (i.e. buildable
CMake packages).  This information is meant for maintainers of the TriBITS
system itself and should not need to be known by TriBITS Project maintainers.</p>
<section id="basic-tribits-project-repository-package-and-subpackage-core-variables">
<h3><a class="toc-backref" href="#id220">Basic TriBITS Project, Repository, Package, and Subpackage Core Variables</a><a class="headerlink" href="#basic-tribits-project-repository-package-and-subpackage-core-variables" title="Permalink to this heading"></a></h3>
<p>The basic variables that define a TriBITS Project, Repository, Package and
Subpackage are listed at the below links:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#tribits-project-core-variables">TriBITS Project Core Variables</a></p></li>
<li><p><a class="reference internal" href="#tribits-repository-core-variables">TriBITS Repository Core Variables</a></p></li>
<li><p><a class="reference internal" href="#tribits-package-core-variables">TriBITS Package Core Variables</a></p></li>
<li><p><a class="reference internal" href="#tribits-subpackage-core-variables">TriBITS Subpackage Core Variables</a></p></li>
</ul>
<p>These are variables that can be accessed by <a class="reference internal" href="#tribits-project-developers">TriBITS Project Developers</a> but
are also used in the internal implementation of TriBITS functionality.</p>
</section>
<section id="lists-of-external-and-internal-packages">
<h3><a class="toc-backref" href="#id221">Lists of external and internal packages</a><a class="headerlink" href="#lists-of-external-and-internal-packages" title="Permalink to this heading"></a></h3>
<p id="project-name-defined-tpls">The original list of all defined external packages (TPLs) read from the
processed <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> files is given in the list variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PROJECT_NAME}_DEFINED_TPLS
</pre></div>
</div>
<p id="package-name-defined-internal-toplevel-packages">The original list of all defined internal top-level packages read in from the
processed <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> files is given in the list
variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PACKAGE_NAME}_DEFINED_INTERNAL_TOPLEVEL_PACKAGES
</pre></div>
</div>
<p>An internal TriBITS Package (i.e. a package that can be built from source)
will have a non-empty <a class="reference internal" href="#package-name-source-dir">${PACKAGE_NAME}_SOURCE_DIR</a> <code class="docutils literal notranslate"><span class="pre">!=</span> <span class="pre">&quot;&quot;</span></code> while an
external package (i.e. TPL that is pre-built and installed in some way) in
this list will have a non-empty <a class="reference internal" href="#package-name-findmod">${PACKAGE_NAME}_FINDMOD</a> <code class="docutils literal notranslate"><span class="pre">!=</span> <span class="pre">&quot;&quot;</span></code>.</p>
<p>The sizes of these lists is given by the variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PACKAGE_NAME}_NUM_DEFINED_TPLS
${PACKAGE_NAME}_NUM_DEFINED_INTERNAL_PACKAGES
</pre></div>
</div>
<p>The full list of defined external packages (TPLs) and top-level internal
packages (TriBITS packages) is stored in the project-level non-cache list
variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PROJECT_NAME}_ALL_DEFINED_TOPLEVEL_PACKAGES
</pre></div>
</div>
<p>The first set of elements in this list are the defined external packages
(TPLs) that are read in from the <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> files from each
processed TriBITS repository, in order.  This is followed by the set of
internal packages (TriBITS packages) that are defined in the
<a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> files from each processed TriBITS repository,
read in order.  This list does <strong>not</strong> include any subpackages.</p>
<p>Note that some of the packages listed in
<a class="reference internal" href="#package-name-defined-internal-toplevel-packages">${PACKAGE_NAME}_DEFINED_INTERNAL_TOPLEVEL_PACKAGES</a> may actually be treated
as external packages and not build from source code and instead will be found
out on the system as pre-built/pre-installed packages using
<code class="docutils literal notranslate"><span class="pre">find_package(&lt;externalPackageName&gt;)</span></code>.  The final decision for if a package
is treated as an internal or external package is determined by the variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PACKAGE_NAME}_PACKAGE_BUILD_STATUS=[INTERNAL|EXTERNAL]
</pre></div>
</div>
<p>which gets set various criteria as described in section <a class="reference internal" href="#determining-if-a-package-is-internal-or-external">Determining if a
package is internal or external</a>.  This variable determines what
pre-built/pre-installed packages must be found out on the system if enabled
and what internal packages need to be built if enabled.</p>
<p>The set of external packages, internal top-level packages, and internal
sub-packages are just called the list of “Packages”.  When the term “Packages”
is used with an adjective, it is usually meant in this more general context.</p>
<p>ToDo: Describe the data-structures of all “Packages” which includes
subpackages as well and the lists of enabled packages.</p>
<p>These data-structures as well as the package dependencies graph is built up in
the macro <a class="reference internal" href="#tribits-read-all-project-deps-files-create-deps-graph">tribits_read_all_project_deps_files_create_deps_graph()</a> with the
call graph described in the section <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing
package dependency graph</a>.</p>
<p>A set of enable/disable logic is applied in the macro
<a class="reference internal" href="#tribits-adjust-package-enables">tribits_adjust_package_enables()</a>.  Once all of this logic has been applied,
the final list of enabled external packages, internal packages, and all
enabled packages are given in the list variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PROJECT_NAME}_ALL_ENABLED_EXTERNAL_PACKAGES
${PROJECT_NAME}_ALL_ENABLED_INTERNAL_PACKAGES
${PROJECT_NAME}_ALL_ENABLED_PACKAGES
</pre></div>
</div>
<p>where:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>length( ${PROJECT_NAME}_ALL_ENABLED_EXTERNAL_PACKAGES )
+
length( ${PROJECT_NAME}_ALL_ENABLED_INTERNAL_PACKAGES )
=
length( ${PROJECT_NAME}_ALL_ENABLED_PACKAGES )
</pre></div>
</div>
<p>Note that the list <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ALL_ENABLED_EXTERNAL_PACKAGES</span></code> can
include both regular TPLs which have <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_FINDMOD</span> <span class="pre">!=</span> <span class="pre">&quot;&quot;</span></code> and
also packages that could be built as internal packages which have
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_SOURCE_DIR</span> <span class="pre">!=</span> <span class="pre">&quot;&quot;</span></code>.  Again, how such non-TPL external
packages are determined and found is the subject of section <a class="reference internal" href="#determining-if-a-package-is-internal-or-external">Determining if a
package is internal or external</a>.</p>
<p>When sorting lists of packages, one only needs to consider enabled packages,
and therefore only the list <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ALL_ENABLED_PACKAGES</span></code> needs to
be considered in those cases.</p>
<hr class="docutils" />
<p>ToDo: Deal with old data-structures below after the refactoring for #63 is
complete!</p>
<p>The full list of defined top-level parent packages is stored in the
project-level non-cache list variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PROJECT_NAME}_PACKAGES
</pre></div>
</div>
<p>This list does <strong>not</strong> include any subpackages.  This gets created from the
<a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> file from each processed TriBITS repository.</p>
<p>The full list of all of the defined packages and subpackages is stored in the
project-level non-cache list variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PROJECT_NAME}_SE_PACKAGES
</pre></div>
</div>
<p>That list is created from the information in the
<a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> and <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a>
files for the top-level packages read and processed in the macro
<a class="reference internal" href="#tribits-read-deps-files-create-deps-graph">tribits_read_deps_files_create_deps_graph()</a> using macros in the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TribitsAdjustPackageEnables</span><span class="o">.</span><span class="n">cmake</span>
</pre></div>
</div>
<p>One can determine if a package in this list is a top-level parent package or a
sub-subpackage based on the value of the variable
<a class="reference internal" href="#package-name-parent-package">${PACKAGE_NAME}_PARENT_PACKAGE</a>.  If the value is non empty, then
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code> is a subpackage.  If the value is empty “”, then
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code> is a parent package.</p>
<p>This full number of defined top-level parent packages (i.e. the number of
items in the array <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_PACKAGES</span></code>) is given in the variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PROJECT_NAME}_NUM_PACKAGES
</pre></div>
</div>
<p>and the 0-based index of the last package in the array
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_PACKAGES</span></code> (i.e. <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_NUM_PACKAGES</span> <span class="pre">-</span> <span class="pre">1</span></code>) is
given in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PROJECT_NAME}_LAST_PACKAGE_IDX
</pre></div>
</div>
<p>This data gets set in functions in the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TribitsProcessPackagesAndDirsLists</span><span class="o">.</span><span class="n">cmake</span>
</pre></div>
</div>
<p>The full list of defined TPLs is stored in the variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PROJECT_NAME}_TPLS
</pre></div>
</div>
<p>This list is created from the <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> files from each
defined TriBITS Repository.  Along with this, the following variables for each
of these TriBITS TPLs are defined::
* <a class="reference internal" href="#tpl-name-findmod">${TPL_NAME}_FINDMOD</a>
* <a class="reference internal" href="#tpl-name-testgroup">${TPL_NAME}_TESTGROUP</a></p>
<p>This data gets set in functions in the file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TribitsProcessTplsLists</span><span class="o">.</span><span class="n">cmake</span>
</pre></div>
</div>
<p>NOTE: The same external package (TPL) can be duplicated in multiple
<code class="docutils literal notranslate"><span class="pre">TPLsList.cmake</span></code> files.  This has the affect of allowing overrides of the
<code class="docutils literal notranslate"><span class="pre">FindTPL&lt;TPLName&gt;.cmake</span></code> module.  See the discussion in <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a> for
more details.</p>
</section>
<hr class="docutils" />
<section id="list-variables-defining-the-package-dependencies-graph">
<h3><a class="toc-backref" href="#id222">List variables defining the package dependencies graph</a><a class="headerlink" href="#list-variables-defining-the-package-dependencies-graph" title="Permalink to this heading"></a></h3>
<p>The following top-level non-cache variables are defined after reading in each
top-level package and subpackage <code class="docutils literal notranslate"><span class="pre">Dependencies.cmake</span></code> files and they are
used to define the basic dependencies that exist between packages in a project
to support the enable and disable logic described in section ???.  These
variables taken together constitute a bidirectional acyclic graph (DAG)
data-structure for package dependencies.</p>
<p>The following lists variables define the <strong>direct</strong> dependencies from a
package <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code> to its upstream packages which are directly set in
a package’s <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> file.  (These lists
should <strong>not</strong> contain any <em>indirect</em> dependencies as the dependency system
already handles these automatically.)</p>
<blockquote>
<div><p id="package-name-lib-required-dep-packages"><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_LIB_REQUIRED_DEP_PACKAGES</span></code></p>
<blockquote>
<div><p>List of <em>direct</em> package dependencies that are required for the libraries
and non-test executables built by <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code>.</p>
</div></blockquote>
<p id="package-name-lib-optional-dep-packages"><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_LIB_OPTIONAL_DEP_PACKAGES</span></code></p>
<blockquote>
<div><p>List of <em>direct</em> package dependencies that are only optional for the
libraries and non-test executables built by <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code>.</p>
</div></blockquote>
<p id="package-name-test-required-dep-packages"><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_TEST_REQUIRED_DEP_PACKAGES</span></code></p>
<blockquote>
<div><p>List of <em>direct</em> package dependencies that are required for the
tests/examples built by <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code>.  This list should <strong>not</strong>
contain any of the packages already listed in
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_LIB_REQUIRED_DEP_PACKAGES</span></code>.</p>
</div></blockquote>
<p id="package-name-test-optional-dep-packages"><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_TEST_OPTIONAL_DEP_PACKAGES`</span></code></p>
<blockquote>
<div><p>List of <em>direct</em> package dependencies that are optional for the
tests/examples built by <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code>.  This list should <strong>not</strong>
contain any of the SE packages listed in
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_LIB_REQUIRED_DEP_PACKAGES</span></code>,
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_LIB_OPTIONAL_DEP_PACKAGES</span></code>, or
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_TEST_REQUIRED_DEP_PACKAGES</span></code>.</p>
</div></blockquote>
</div></blockquote>
<p>Given the above upstream dependency list variables, the following derived list
variables are then constructed which provide navigation from a package to its
downstream/forward dependent packages:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_FORWARD_LIB_REQUIRED_DEP_PACKAGES</span></code></p>
<blockquote>
<div><p>For a given package <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code>, lists the names of all of the
forward packages <code class="docutils literal notranslate"><span class="pre">${FORWARD_PACKAGE_NAME}</span></code> that list this package in
their <code class="docutils literal notranslate"><span class="pre">${FORWARD_PACKAGE_NAME}_LIB_REQUIRED_DEP_PACKAGES</span></code> variables.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_FORWARD_LIB_OPTIONAL_DEP_PACKAGES</span></code></p>
<blockquote>
<div><p>For a given package <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code>, lists the names of all of the
forward packages <code class="docutils literal notranslate"><span class="pre">${FORWARD_PACKAGE_NAME}</span></code> that list this package in
their <code class="docutils literal notranslate"><span class="pre">${FORWARD_PACKAGE_NAME}_LIB_OPTIONAL_DEP_PACKAGES</span></code> variables.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_FORWARD_TEST_REQUIRED_DEP_PACKAGES</span></code></p>
<blockquote>
<div><p>For a given package <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code>, lists the names of all of the
forward packages <code class="docutils literal notranslate"><span class="pre">${FORWARD_PACKAGE_NAME}</span></code> that list this package in
their <code class="docutils literal notranslate"><span class="pre">${FORWARD_PACKAGE_NAME}_TEST_REQUIRED_DEP_PACKAGES</span></code> variables.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_FORWARD_TEST_OPTIONAL_DEP_PACKAGES</span></code></p>
<blockquote>
<div><p>For a given package <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code>, lists the names of all of the
forward packages <code class="docutils literal notranslate"><span class="pre">${FORWARD_PACKAGE_NAME}</span></code> that list this package in
their <code class="docutils literal notranslate"><span class="pre">${FORWARD_PACKAGE_NAME}_TEST_OPTIONAL_DEP_PACKAGES</span></code> variables.</p>
</div></blockquote>
</div></blockquote>
</section>
<section id="determining-if-a-package-is-internal-or-external">
<h3><a class="toc-backref" href="#id223">Determining if a package is internal or external</a><a class="headerlink" href="#determining-if-a-package-is-internal-or-external" title="Permalink to this heading"></a></h3>
<p>As mentioned above, some subset of packages listed in
<a class="reference internal" href="#package-name-defined-internal-toplevel-packages">${PACKAGE_NAME}_DEFINED_INTERNAL_TOPLEVEL_PACKAGES</a> (which all have
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_SOURCE_DIR</span> <span class="pre">!=</span> <span class="pre">&quot;&quot;</span></code>) may be chosen to be external packages.
Packages that could be built internally may be chosen to be treated as
external packages by setting:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">TPL_ENABLE_</span><span class="o">&lt;</span><span class="n">ExternalPackage</span><span class="o">&gt;=</span><span class="n">ON</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="o">&lt;</span><span class="n">ExternalPackage</span><span class="o">&gt;</span><span class="n">_ROOT</span><span class="o">=&lt;</span><span class="n">path</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The final status of whether a listed package is an internal package or an
external package is provided by the variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PACKAGE_NAME}_PACKAGE_BUILD_STATUS=[INTERNAL|EXTERNAL]
</pre></div>
</div>
<p>As a result, every other package upstream from any of these
<code class="docutils literal notranslate"><span class="pre">&lt;ExternalPackage&gt;</span></code> packages must therefore also be treated as external
packages automatically.</p>
<p>The primary TriBITS file that processes and defines these variables is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TribitsAdjustPackageEnables</span><span class="o">.</span><span class="n">cmake</span>
</pre></div>
</div>
<p>There are pretty good unit and regression tests to demonstrate and protect
this functionality in the directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TriBITS</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">core</span><span class="o">/</span>
</pre></div>
</div>
</section>
<section id="external-package-dependencies">
<h3><a class="toc-backref" href="#id224">External package dependencies</a><a class="headerlink" href="#external-package-dependencies" title="Permalink to this heading"></a></h3>
<p>ToDo: Document how dependencies between external packages/TPLs are determined
in <code class="docutils literal notranslate"><span class="pre">FindTPL&lt;ExternalPackage&gt;Dependencies.cmake</span></code> files and
<code class="docutils literal notranslate"><span class="pre">&lt;ExternalPackage&gt;_LIB_REQUIRED_DEP_PACKAGES_OVERRIDE</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;ExternalPackage&gt;_LIB_OPTIONAL_DEP_PACKAGES_OVERRIDE</span></code> variables that can be
overridden in the cache.</p>
</section>
<section id="flat-lists-of-direct-package-dependencies">
<h3><a class="toc-backref" href="#id225">Flat lists of direct package dependencies</a><a class="headerlink" href="#flat-lists-of-direct-package-dependencies" title="Permalink to this heading"></a></h3>
<p>TriBITS sets up the following lists of dependencies for each internal and
external package/TPL:</p>
<blockquote>
<div><p id="package-name-lib-all-dependencies"><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_LIB_ALL_DEPENDENCIES</span></code></p>
<blockquote>
<div><p>The list of all <strong>direct</strong> required and optional upstream internal and
external packages/TPL dependencies, regardless if they are enabled or not.
This is concatenation of lists
<a class="reference internal" href="#package-name-lib-required-dep-packages">${PACKAGE_NAME}_LIB_REQUIRED_DEP_PACKAGES</a>,
<a class="reference internal" href="#package-name-lib-optional-dep-packages">${PACKAGE_NAME}_LIB_OPTIONAL_DEP_PACKAGES</a>,
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_LIB_REQUIRED_DEP_TPLS</span></code>, and
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_LIB_OPTIONAL_DEP_TPLS</span></code> (with the latter two lists soon
to disappear as part of #63).  To determine if a given direct upstream
package <code class="docutils literal notranslate"><span class="pre">&lt;depPkg&gt;</span></code> in this list is enabled/supported or not for this
package <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code>, check the value of
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_ENABLE_&lt;depPkg&gt;</span></code>.  NOTE: The variables
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_ENABLE_&lt;depPkg&gt;</span></code> will be set even for required upstream
internal and external packages/tpls to allow for uniform loops involving
required and optional upstream dependencies.  (And for a parent package
with subpackages, it is possible for a required subpackage to <strong>not</strong> be
enabled and for <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_ENABLE_&lt;depPkg&gt;</span></code> to be <code class="docutils literal notranslate"><span class="pre">OFF</span></code> as
explained in <a class="reference internal" href="#subpackage-enable-does-not-auto-enable-the-parent-package">Subpackage enable does not auto-enable the parent
package</a>.)  This list will be set regardless of if the package
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code> is enabled or not.</p>
</div></blockquote>
<p id="package-name-lib-enabled-dependencies"><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_LIB_ENABLED_DEPENDENCIES</span></code></p>
<blockquote>
<div><p>List of all <strong>enabled</strong> <strong>direct</strong> required and optional upstream internal
and external packages/TPL dependencies.  This is strict subset
<a class="reference internal" href="#package-name-lib-all-dependencies">${PACKAGE_NAME}_LIB_ALL_DEPENDENCIES</a> (i.e. all of the <code class="docutils literal notranslate"><span class="pre">&lt;depPkg&gt;</span></code>
items in this list will have <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_ENABLE_&lt;depPkg&gt;</span></code> set to
<code class="docutils literal notranslate"><span class="pre">ON</span></code>).</p>
</div></blockquote>
<p id="package-name-test-all-dependencies"><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_TEST_ALL_DEPENDENCIES</span></code></p>
<blockquote>
<div><p>This list of all <strong>direct</strong> extra package test required and optional
upstream internal and external packages/TPLs.  This list includes just the
extra dependencies not already listed in
<a class="reference internal" href="#package-name-lib-all-dependencies">${PACKAGE_NAME}_LIB_ALL_DEPENDENCIES</a>.  This is a concatenation of the
lists <a class="reference internal" href="#package-name-test-required-dep-packages">${PACKAGE_NAME}_TEST_REQUIRED_DEP_PACKAGES</a>,
<a class="reference internal" href="#package-name-test-optional-dep-packages">${PACKAGE_NAME}_TEST_OPTIONAL_DEP_PACKAGES</a>,
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_TEST_REQUIRED_DEP_TPLS</span></code>, and
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_TEST_OPTIONAL_DEP_TPLS</span></code> (with the latter two lists soon
to disappear as part of #63).  This list is set regardless if the package
<code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}</span></code> is enabled or not.</p>
</div></blockquote>
<p id="package-name-test-enabled-dependencies"><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_TEST_ENABLED_DEPENDENCIES</span></code></p>
<blockquote>
<div><p>The list of all <strong>enabled</strong> <strong>direct</strong> extra required and optional
upstream internal and external packages/TPL dependencies.  This is a
strict subset of <a class="reference internal" href="#package-name-test-all-dependencies">${PACKAGE_NAME}_TEST_ALL_DEPENDENCIES</a>.  This list
includes just the extra dependencies not already listed in
<a class="reference internal" href="#package-name-lib-enabled-dependencies">${PACKAGE_NAME}_LIB_ENABLED_DEPENDENCIES</a>.</p>
</div></blockquote>
</div></blockquote>
</section>
<section id="list-variables-defining-include-directories-and-libraries">
<h3><a class="toc-backref" href="#id226">List variables defining include directories and libraries</a><a class="headerlink" href="#list-variables-defining-include-directories-and-libraries" title="Permalink to this heading"></a></h3>
<p>ToDo: Eliminate this section and these variables once we move to modern CMake
targets as part of #299.</p>
<p>The following global internal cache variables are used to communicate the
required header directory paths and libraries needed to build and link against
a given package’s capabilities:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_LIBRARIES</span></code></p>
<blockquote>
<div><p>Defines list of <em>only</em> the libraries associated with the given
(sub)package and does <em>not</em> list libraries in upstream packages.  Linkages
to upstream packages is taken care of with calls to
target_link_libraries(…) and the dependency management system in CMake
takes care of adding these to various link lines as needed (this is what
CMake does well).  However, when a package has no libraries of its own
(which is often the case for packages that have subpackages, for example),
then this list of libraries will contain the libraries to the direct
dependent upstream packages in order to allow the chain of dependencies to
be handled correctly in downstream packages and executables in the same
package.  In this case, ${PACKAGE_NAME}_HAS_NATIVE_LIBRARIES will be
false.  The primary purpose of this variable is to passe to
target_link_libraries(…) by downstream libraries and executables.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_HAS_NATIVE_LIBRARIES</span></code></p>
<blockquote>
<div><p>Will be true if a package has native libraries.  Otherwise, it will be
false.  This information is used to build export makefiles to avoid
duplicate libraries on the link line.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_FULL_ENABLED_DEP_PACKAGES</span></code></p>
<blockquote>
<div><p>Lists out, in order, all of the enabled upstream packages that the given
package depends on and support that package is enabled in the given
package.  This is only computed if
${PROJECT_NAME}_GENERATE_EXPORT_FILE_DEPENDENCIES=ON.  NOTE: This list
does <em>not</em> include the package itself.  This list is created after all of
the enable/disable logic is applied.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">${PARENT_PACKAGE_NAME}_LIB_TARGETS</span></code></p>
<blockquote>
<div><p>Lists all of the library targets for this package only that are as part of
this package added by the <a class="reference internal" href="#tribits-add-library">tribits_add_library()</a> function.  This is used
to define a target called ${PACKAGE_NAME}_libs that is then used by
<a class="reference internal" href="#tribits-ctest-driver">tribits_ctest_driver()</a> in the package-by-package mode.  If a package
has no libraries, then the library targets for all of the immediate
upstream direct dependent packages will be added.  This is needed for the
chain of dependencies to work correctly.  Note that subpackages don’t have
this variable defined for them.</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">${PARENT_PACKAGE_NAME}_ALL_TARGETS</span></code></p>
<blockquote>
<div><p>Lists all of the targets associated with this package.  This includes all
libraries and tests added with <a class="reference internal" href="#tribits-add-library">tribits_add_library()</a> and
<a class="reference internal" href="#tribits-add-executable">tribits_add_executable()</a>.  If this package has no targets (no libraries
or executables) this this will have the dependency only on
${PARENT_PACKAGE_NAME}_libs.  Note that subpackages don’t have this
variable defined for them.</p>
</div></blockquote>
</div></blockquote>
</section>
<section id="user-enable-disable-cache-variables">
<h3><a class="toc-backref" href="#id227">User enable/disable cache variables</a><a class="headerlink" href="#user-enable-disable-cache-variables" title="Permalink to this heading"></a></h3>
<p>The following variables can be set by the user to determine what packages get
enabled or disabled:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PROJECT_NAME}_ENABLE_ALL_PACKAGES

${PROJECT_NAME}_ENABLE_ALL_FORWARD_DEP_PACKAGES

${PROJECT_NAME}_ENABLE_ALL_OPTIONAL_PACKAGES

${PROJECT_NAME}_ENABLE_${PACKAGE_NAME}

${PROJECT_NAME}_ENABLE_TESTS

${PROJECT_NAME}_ENABLE_EXAMPLES

${PACKAGE_NAME}_ENABLE_${OPTIONAL_DEP_PACKAGE_NAME}

${PACKAGE_NAME}_ENABLE_TESTS

${PACKAGE_NAME}_ENABLE_EXAMPLES
</pre></div>
</div>
<p>according to the rules described in <a class="reference internal" href="#package-dependencies-and-enable-disable-logic">Package Dependencies and Enable/Disable
Logic</a>.</p>
<p>There are pretty good unit and regression tests to demonstrate and protect
this functionality in the directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TriBITS</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">core</span><span class="o">/</span>
</pre></div>
</div>
</section>
</section>
<section id="function-call-tree-for-constructing-package-dependency-graph">
<h2><a class="toc-backref" href="#id228"><span class="sectnum">12.2</span> Function call tree for constructing package dependency graph</a><a class="headerlink" href="#function-call-tree-for-constructing-package-dependency-graph" title="Permalink to this heading"></a></h2>
<p>Below is the CMake macro and function call graph for constructing the packages
lists and dependency data-structures described above.</p>
<div class="line-block">
<div class="line"><a class="reference internal" href="#tribits-read-all-project-deps-files-create-deps-graph">tribits_read_all_project_deps_files_create_deps_graph()</a></div>
<div class="line-block">
<div class="line"><a class="reference internal" href="#tribits-read-defined-external-and-internal-toplevel-packages-lists">tribits_read_defined_external_and_internal_toplevel_packages_lists()</a></div>
<div class="line-block">
<div class="line">Foreach <code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;</span></code> in <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ALL_REPOSITORIES</span></code>:</div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
<div class="line"><a class="reference internal" href="#tribits-process-tpls-lists">tribits_process_tpls_lists()</a></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
<div class="line"><a class="reference internal" href="#tribits-process-packages-and-dirs-lists">tribits_process_packages_and_dirs_lists()</a></div>
</div>
</div>
<div class="line"><a class="reference internal" href="#tribits-read-deps-files-create-deps-graph">tribits_read_deps_files_create_deps_graph()</a></div>
<div class="line-block">
<div class="line"><a class="reference internal" href="#tribits-process-all-repository-deps-setup-files">tribits_process_all_repository_deps_setup_files()</a></div>
<div class="line-block">
<div class="line">Foreach <code class="docutils literal notranslate"><span class="pre">&lt;repoDir&gt;</span></code> in <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_ALL_REPOSITORIES</span></code>:</div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#repodir-cmake-repositorydependenciessetup-cmake">&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
</div>
</div>
<div class="line"><a class="reference internal" href="#tribits-process-project-dependency-setup-file">tribits_process_project_dependency_setup_file()</a></div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">include(</span></code>  <a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
</div>
<div class="line"><a class="reference internal" href="#tribits-read-all-package-deps-files-create-deps-graph">tribits_read_all_package_deps_files_create_deps_graph()</a></div>
<div class="line-block">
<div class="line">Foreach  <code class="docutils literal notranslate"><span class="pre">EXTERNAL_PACKAGE</span></code> in <code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_DEFINED_TPLS</span></code>:</div>
<div class="line-block">
<div class="line"><a class="reference internal" href="#tribits-read-external-package-deps-files-add-to-graph">tribits_read_external_package_deps_files_add_to_graph()</a></div>
</div>
<div class="line">Foreach <code class="docutils literal notranslate"><span class="pre">TOPLEVEL_PACKAGE</span></code> in <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_DEFINED_INTERNAL_TOPLEVEL_PACKAGES</span></code>:</div>
<div class="line-block">
<div class="line"><a class="reference internal" href="#tribits-read-toplevel-package-deps-files-add-to-graph">tribits_read_toplevel_package_deps_files_add_to_graph()</a></div>
<div class="line-block">
<div class="line"><a class="reference internal" href="#tribits-prep-to-read-dependencies">tribits_prep_to_read_dependencies()</a></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
<div class="line"><a class="reference internal" href="#tribits-assert-read-dependency-vars">tribits_assert_read_dependency_vars()</a></div>
<div class="line"><a class="reference internal" href="#tribits-save-off-dependency-vars">tribits_save_off_dependency_vars()</a></div>
<div class="line"><a class="reference internal" href="#tribits-parse-subpackages-append-se-packages-add-options">tribits_parse_subpackages_append_se_packages_add_options()</a></div>
<div class="line"><a class="reference internal" href="#tribits-read-package-subpackage-deps-files-add-to-graph">tribits_read_package_subpackage_deps_files_add_to_graph()</a></div>
<div class="line-block">
<div class="line">Foreach <code class="docutils literal notranslate"><span class="pre">SUBPACKAGE</span></code>:</div>
<div class="line-block">
<div class="line"><a class="reference internal" href="#tribits-read-subpackage-deps-file-add-to-graph">tribits_read_subpackage_deps_file_add_to_graph()</a></div>
<div class="line-block">
<div class="line"><a class="reference internal" href="#tribits-prep-to-read-dependencies">tribits_prep_to_read_dependencies()</a></div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">include(</span></code> <a class="reference internal" href="#packagedir-spkgdir-cmake-dependencies-cmake">&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</a> <code class="docutils literal notranslate"><span class="pre">)</span></code></div>
<div class="line"><a class="reference internal" href="#tribits-assert-read-dependency-vars">tribits_assert_read_dependency_vars()</a></div>
<div class="line"><a class="reference internal" href="#tribits-process-package-dependencies-lists">tribits_process_package_dependencies_lists()</a></div>
<div class="line-block">
<div class="line">See same call stack for this macro as shown below</div>
</div>
</div>
</div>
</div>
<div class="line"><a class="reference internal" href="#tribits-read-back-dependencies-vars">tribits_read_back_dependencies_vars()</a></div>
<div class="line"><a class="reference internal" href="#tribits-process-package-dependencies-lists">tribits_process_package_dependencies_lists()</a></div>
<div class="line-block">
<div class="line"><a class="reference internal" href="#tribits-set-dep-packages">tribits_set_dep_packages()</a></div>
<div class="line-block">
<div class="line"><a class="reference internal" href="#tribits-abort-on-self-dep">tribits_abort_on_self_dep()</a></div>
<div class="line"><a class="reference internal" href="#tribits-abort-on-missing-package">tribits_abort_on_missing_package()</a></div>
</div>
<div class="line"><a class="reference internal" href="#tribits-append-forward-dep-packages">tribits_append_forward_dep_packages()</a></div>
<div class="line-block">
<div class="line"><a class="reference internal" href="#tribits-abort-on-missing-package">tribits_abort_on_missing_package()</a></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="notes-on-dependency-logic">
<h2><a class="toc-backref" href="#id229"><span class="sectnum">12.3</span> Notes on dependency logic</a><a class="headerlink" href="#notes-on-dependency-logic" title="Permalink to this heading"></a></h2>
<p>The logic used to define the intra-package linkage variables is complex due to
a number of factors:</p>
<ol class="arabic simple">
<li><p>Packages can have libraries or no libraries.</p></li>
<li><p>In installation-testing mode, the libraries for a package are read from a
file instead of generated in source.</p></li>
<li><p>A library can be a regular package library, or a test-only library, in
which case it will not be listed in <code class="docutils literal notranslate"><span class="pre">${PACKAGE_NAME}_LIBRARIES</span></code>.  The
above description does not even talk about how test-only libraries are
handed within the system except to say that they are excluded from the
package’s exported library dependencies.</p></li>
</ol>
<p>The management and usage of the intra-package linkage variables is spread
across a number of TriBITS <code class="docutils literal notranslate"><span class="pre">*.cmake</span></code> files but the primary ones are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TribitsPackageMacros</span><span class="o">.</span><span class="n">cmake</span>
<span class="n">TribitsSubPackageMacros</span><span class="o">.</span><span class="n">cmake</span>
<span class="n">TribitsLibraryMacros</span><span class="o">.</span><span class="n">cmake</span>
<span class="n">TribitsAddExecutable</span><span class="o">.</span><span class="n">cmake</span>
</pre></div>
</div>
<p>There are other TriBITS cmake files that also access these variables but these
are the key files.  The CMake code in these files all work together in
coordination to set up and use these variables in a way that allows for smooth
compiling and linking of source code for users of the TriBITS system.</p>
<p>Another file with complex dependency logic related to these variables is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TribitsWriteClientExportFiles</span><span class="o">.</span><span class="n">cmake</span>
</pre></div>
</div>
<p>The TriBITS cmake code in this file servers a very similar role for external
clients and therefore needs to be considered in this setting.</p>
<p>All of these variations and features makes this a bit of a complex system to
say the least.  Also, currently, there is essentially no unit or regression
testing in place for the CMake code in these files that manipulate these
intra-package dependency variables.  Because this logic is tied in with
actually building and linking code, there has not been a way set up yet to
allow it to be efficiently tested outside of the actual build.  But there are
a number of example projects that are part of the automated TriBITS test suite
that do test much of the logic used in these variables.</p>
</section>
<section id="tribits-system-macros-and-functions">
<h2><a class="toc-backref" href="#id230"><span class="sectnum">12.4</span> TriBITS System Macros and Functions</a><a class="headerlink" href="#tribits-system-macros-and-functions" title="Permalink to this heading"></a></h2>
<p>These are key macros and functions that are used to implement the guts of
TriBITS that TriBITS System Maintainers need to know about in order to
understand the internals of TriBITS.</p>
<section id="tribits-abort-on-missing-package">
<h3><a class="toc-backref" href="#id231">tribits_abort_on_missing_package()</a><a class="headerlink" href="#tribits-abort-on-missing-package" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_abort_on_missing_package</span><span class="p">(</span><span class="o">&lt;</span><span class="n">depPkg</span><span class="o">&gt;</span>  <span class="o">&lt;</span><span class="n">packageName</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">depPkgListName</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Function that creates error message about missing/misspelled package.  This
error message also suggests that the package might be defining an upstream
dependency on a downstream dependency (i.e. a circular dependency).</p>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a></p>
<p>In: core/package_arch/TribitsReadDepsFilesCreateDepsGraph.cmake:673</p>
</section>
<section id="tribits-abort-on-self-dep">
<h3><a class="toc-backref" href="#id232">tribits_abort_on_self_dep()</a><a class="headerlink" href="#tribits-abort-on-self-dep" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_abort_on_self_dep</span><span class="p">(</span><span class="o">&lt;</span><span class="n">packageName</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">depPkgListName</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Prints a fatal error message for an attempt for a self dependency
declaration and which list it comes from.</p>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a></p>
<p>In: core/package_arch/TribitsReadDepsFilesCreateDepsGraph.cmake:699</p>
</section>
<section id="tribits-adjust-package-enables">
<h3><a class="toc-backref" href="#id233">tribits_adjust_package_enables()</a><a class="headerlink" href="#tribits-adjust-package-enables" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<blockquote>
<div><p>tribits_adjust_package_enables()</p>
</div></blockquote>
<p>Macro that adjusts all of the package enables from what the user input to
the final set that will be used to enable packages.</p>
<p>In: core/package_arch/TribitsAdjustPackageEnables.cmake:1247</p>
</section>
<section id="tribits-append-forward-dep-packages">
<h3><a class="toc-backref" href="#id234">tribits_append_forward_dep_packages()</a><a class="headerlink" href="#tribits-append-forward-dep-packages" title="Permalink to this heading"></a></h3>
<p>Usage: tribits_append_forward_dep_packages(&lt;packageName&gt; &lt;listType&gt;)</p>
<p>Function that helps to set up forward package dependency lists for an
upstream package given that a downstream package declared a dependency on
it.  In particular, it appends the var:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">packageName</span><span class="o">&gt;</span><span class="n">_FORWARD_</span><span class="o">&lt;</span><span class="n">listType</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>for one of the vars listed in <a class="reference internal" href="#list-variables-defining-the-package-dependencies-graph">List variables defining the package
dependencies graph</a>.</p>
<p>This function is called multiple times to build up the forward package
dependencies for a given <code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;</span></code> by the downstream packages that
declare dependencies on it.</p>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a></p>
<p>In: core/package_arch/TribitsReadDepsFilesCreateDepsGraph.cmake:575</p>
</section>
<section id="tribits-assert-read-dependency-vars">
<h3><a class="toc-backref" href="#id235">tribits_assert_read_dependency_vars()</a><a class="headerlink" href="#tribits-assert-read-dependency-vars" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_assert_read_dependency_vars</span><span class="p">(</span><span class="o">&lt;</span><span class="n">packageName</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Assert that all of the required variables set by the function
<a class="reference internal" href="#tribits-package-define-dependencies">tribits_package_define_dependencies()</a> in the file
<a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> have been set.</p>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a></p>
<p>In: core/package_arch/TribitsReadDepsFilesCreateDepsGraph.cmake:369</p>
</section>
<section id="tribits-extpkg-add-find-upstream-dependencies-str">
<h3><a class="toc-backref" href="#id236">tribits_extpkg_add_find_upstream_dependencies_str()</a><a class="headerlink" href="#tribits-extpkg-add-find-upstream-dependencies-str" title="Permalink to this heading"></a></h3>
<p>Add code to call find_dependency() for all upstream external packages/TPLs
listed in <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIB_ENABLED_DEPENDENCIES</span></code>.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_extpkg_add_find_upstream_dependencies_str</span><span class="p">(</span><span class="n">tplName</span>
  <span class="n">configFileFragStrInOut</span><span class="p">)</span>
</pre></div>
</div>
<p>NOTE: This also requires that <code class="docutils literal notranslate"><span class="pre">&lt;upstreamTplName&gt;_DIR</span></code> be set for each
external package/TPL listed in <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIB_ENABLED_DEPENDENCIES</span></code>.</p>
<p>In: core/package_arch/TribitsExternalPackageWriteConfigFile.cmake:293</p>
</section>
<section id="tribits-extpkg-create-all-libs-target">
<h3><a class="toc-backref" href="#id237">tribits_extpkg_create_all_libs_target()</a><a class="headerlink" href="#tribits-extpkg-create-all-libs-target" title="Permalink to this heading"></a></h3>
<p>Creates the <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> target command text using input info and
from <code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_INCLUDE_DIRS</span></code>.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_extpkg_create_all_libs_target</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;</span>
  <span class="n">LIB_TARGETS_LIST</span> <span class="o">&lt;</span><span class="n">libTargetsList</span><span class="o">&gt;</span>
  <span class="n">LIB_LINK_FLAGS_LIST</span> <span class="o">&lt;</span><span class="n">libLinkFlagsList</span><span class="o">&gt;</span>
  <span class="n">CONFIG_FILE_STR_INOUT</span> <span class="o">&lt;</span><span class="n">configFileFragStrInOut</span><span class="o">&gt;</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>The arguments are:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code>: [in] Name of the external package/TPL</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;libTargetsList&gt;</span></code>: [in] List of targets created from processing
<code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_LIBRARIES</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;libLinkFlagsList&gt;</span></code>: [in] List of of <code class="docutils literal notranslate"><span class="pre">-L&lt;dir&gt;</span></code> library directory
paths entries found while processing <code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_LIBRARIES</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;configFileFragStrInOut&gt;</span></code>: [out] A string variable that will be
appended with the <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;::all_libs</span></code> target statements.</p>
</div></blockquote>
<p>In: core/package_arch/TribitsExternalPackageWriteConfigFile.cmake:727</p>
</section>
<section id="tribits-extpkg-install-config-file">
<h3><a class="toc-backref" href="#id238">tribits_extpkg_install_config_file()</a><a class="headerlink" href="#tribits-extpkg-install-config-file" title="Permalink to this heading"></a></h3>
<p>Install an already-generated <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;Config.cmake</span></code> file.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_write_external_package_install_config_file</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">tplConfigFile</span><span class="o">&gt;</span> <span class="p">)</span>
</pre></div>
</div>
<p>The arguments are:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code>: Name of the external package/TPL</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;tplConfigFile&gt;</span></code>: Full file path for the <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;Config.cmake</span></code>
file that will be installed into the correct location.</p>
</div></blockquote>
<p>In: core/package_arch/TribitsExternalPackageWriteConfigFile.cmake:116</p>
</section>
<section id="tribits-extpkg-install-config-version-file">
<h3><a class="toc-backref" href="#id239">tribits_extpkg_install_config_version_file()</a><a class="headerlink" href="#tribits-extpkg-install-config-version-file" title="Permalink to this heading"></a></h3>
<p>Install an already-generated <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;ConfigVersion.cmake</span></code> file.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_write_external_package_install_config_version_file</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">tplConfigVersionFile</span><span class="o">&gt;</span> <span class="p">)</span>
</pre></div>
</div>
<p>The arguments are:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code>: Name of the external package/TPL</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;tplConfigVersionFile&gt;</span></code>: Full file path for the
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;ConfigVersion.cmake</span></code> file that will be installed into the
correct location <code class="docutils literal notranslate"><span class="pre">${${PROJECT_NAME}_INSTALL_LIB_DIR}/external_packages/</span></code></p>
</div></blockquote>
<p>In: core/package_arch/TribitsExternalPackageWriteConfigFile.cmake:140</p>
</section>
<section id="tribits-extpkg-process-libraries-list">
<h3><a class="toc-backref" href="#id240">tribits_extpkg_process_libraries_list()</a><a class="headerlink" href="#tribits-extpkg-process-libraries-list" title="Permalink to this heading"></a></h3>
<p>Read the <code class="docutils literal notranslate"><span class="pre">TPL_&lt;tplName&gt;_LIBRARIES</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;_LIB_ENABLED_DEPENDENCIES</span></code> list variables and produce the string
for the IMPORTED targets commands with upstream linkages and return list of
targets and left over linker flags.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_extpkg_process_libraries_list</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;</span>
  <span class="n">LIB_TARGETS_LIST_OUT</span> <span class="o">&lt;</span><span class="n">libTargetsListOut</span><span class="o">&gt;</span>
  <span class="n">LIB_LINK_FLAGS_LIST_OUT</span> <span class="o">&lt;</span><span class="n">libLinkFlagsListOut</span><span class="o">&gt;</span>
  <span class="n">CONFIG_FILE_STR_INOUT</span> <span class="o">&lt;</span><span class="n">configFileFragStrInOut</span><span class="o">&gt;</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>The arguments are:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code>: [In] Name of the external package/TPL</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;libTargetsListOut&gt;</span></code>: [Out] Name of list variable that will be set with
the list of IMPORTED library targets generated from this list.</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;libLinkFlagsListOut&gt;</span></code>: [Out] Name of list variable that will be set
with the list of <code class="docutils literal notranslate"><span class="pre">-L&lt;dir&gt;</span></code> library directory paths.</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;configFileFragStrInOut&gt;</span></code>: [Inout] A string variable that will be
appended with the IMPORTED library commands for the list of targets given
in <code class="docutils literal notranslate"><span class="pre">&lt;libTargetsList&gt;</span></code>.</p>
</div></blockquote>
<p>In: core/package_arch/TribitsExternalPackageWriteConfigFile.cmake:368</p>
</section>
<section id="tribits-extpkg-setup-enabled-dependencies">
<h3><a class="toc-backref" href="#id241">tribits_extpkg_setup_enabled_dependencies()</a><a class="headerlink" href="#tribits-extpkg-setup-enabled-dependencies" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_extpkg_setup_enabled_dependencies</span><span class="p">(</span><span class="o">&lt;</span><span class="n">externalPkgName</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Macro that sets up the list of enabled external package/TPL dependencies</p>
<p>Takes the list <code class="docutils literal notranslate"><span class="pre">&lt;externalPkgName&gt;_LIB_ALL_DEPENDENCIES</span></code> and sets the
default entries of the non-cache var
<code class="docutils literal notranslate"><span class="pre">&lt;externalPkgName&gt;_LIB_ENABLED_DEPENDENCIES</span></code>.  However, if
<code class="docutils literal notranslate"><span class="pre">${&lt;externalPkgName&gt;_LIB_ALL_DEPENDENCIES}</span></code> is non-empty when this macro
is called, then it will not be changed.  That allows the user to override
the list of enabled TPL dependencies in the cache.  This also sets the
non-cache vars <code class="docutils literal notranslate"><span class="pre">&lt;externalPkgName&gt;_ENABLE_&lt;upstsreamPkgName&gt;=ON</span></code> for each
enabled package listed in <code class="docutils literal notranslate"><span class="pre">&lt;externalPkgName&gt;_LIB_ENABLED_DEPENDENCIES</span></code> and
to <code class="docutils literal notranslate"><span class="pre">OFF</span></code> for each <code class="docutils literal notranslate"><span class="pre">&lt;upstsreamPkgName&gt;</span></code> listed in
<code class="docutils literal notranslate"><span class="pre">&lt;externalPkgName&gt;_LIB_ENABLED_DEPENDENCIES</span></code> but not in
<code class="docutils literal notranslate"><span class="pre">&lt;externalPkgName&gt;_LIB_ENABLED_DEPENDENCIES</span></code>.</p>
<p>In: core/package_arch/TribitsPackageDependencies.cmake:115</p>
</section>
<section id="tribits-extpkg-write-config-version-file">
<h3><a class="toc-backref" href="#id242">tribits_extpkg_write_config_version_file()</a><a class="headerlink" href="#tribits-extpkg-write-config-version-file" title="Permalink to this heading"></a></h3>
<p>Write out a <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;ConfigVersion.cmake</span></code> file.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_write_external_package_config_version_file</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">tplConfigVersionFile</span><span class="o">&gt;</span> <span class="p">)</span>
</pre></div>
</div>
<p>ToDo: Add version arguments!</p>
<p>The arguments are:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code>: Name of the external package/TPL</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;tplConfigVersionFile&gt;</span></code>: Full file path for the
<code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;ConfigVersion.cmake</span></code> file that will be written out.</p>
</div></blockquote>
<p>In: core/package_arch/TribitsExternalPackageWriteConfigFile.cmake:76</p>
</section>
<section id="tribits-dump-package-dependencies-info">
<h3><a class="toc-backref" href="#id243">tribits_dump_package_dependencies_info()</a><a class="headerlink" href="#tribits-dump-package-dependencies-info" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<blockquote>
<div><p>tribits_dump_package_dependencies_info()</p>
</div></blockquote>
<p>Function that dumps (prints to STDOUT) the package dependency info if
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_DUMP_PACKAGE_DEPENDENCIES==TRUE</span></code>.</p>
<p>Does <strong>not</strong> modify state!</p>
<p>In: core/package_arch/TribitsPrintDependencyInfo.cmake:83</p>
</section>
<section id="tribits-print-initial-dependency-info">
<h3><a class="toc-backref" href="#id244">tribits_print_initial_dependency_info()</a><a class="headerlink" href="#tribits-print-initial-dependency-info" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_print_initial_dependency_info</span><span class="p">()</span>
</pre></div>
</div>
<p>Function that prints whatever initial dependency information that is
available that is requested by the user after the initial construction of
the package dependency graph but <strong>before</strong> the call of
<a class="reference internal" href="#tribits-adjust-package-enables">tribits_adjust_package_enables()</a>.</p>
<p>Calls:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#tribits-print-tentatively-enabled-tpls">tribits_print_tentatively_enabled_tpls()</a></p></li>
<li><p><a class="reference internal" href="#tribits-dump-package-dependencies-info">tribits_dump_package_dependencies_info()</a></p></li>
</ul>
<p>In: core/package_arch/TribitsPrintDependencyInfo.cmake:41</p>
</section>
<section id="tribits-print-tentatively-enabled-tpls">
<h3><a class="toc-backref" href="#id245">tribits_print_tentatively_enabled_tpls()</a><a class="headerlink" href="#tribits-print-tentatively-enabled-tpls" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_print_tentatively_enabled_tpls</span><span class="p">()</span>
</pre></div>
</div>
<p>Function that print the set of tentatively enabled TPLs.</p>
<p>Does <strong>not</strong> modify any state!</p>
<p>In: core/package_arch/TribitsPrintDependencyInfo.cmake:63</p>
</section>
<section id="tribits-parse-subpackages-append-se-packages-add-options">
<h3><a class="toc-backref" href="#id246">tribits_parse_subpackages_append_se_packages_add_options()</a><a class="headerlink" href="#tribits-parse-subpackages-append-se-packages-add-options" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_parse_subpackages_append_se_packages_add_options</span><span class="p">(</span><span class="o">&lt;</span><span class="n">toplevelPackageName</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Macro that parses the read-in variable
<code class="docutils literal notranslate"><span class="pre">SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS</span></code> set by the macro
<a class="reference internal" href="#tribits-package-define-dependencies">tribits_package_define_dependencies()</a> , add subpackages to the list of
defined packages, and define user cache var options for those subpackages.</p>
<p>This sets the list variables for the parent package <code class="docutils literal notranslate"><span class="pre">&lt;toplevelPackageName&gt;</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">parentPackageName</span><span class="o">&gt;</span><span class="n">_SUBPACKAGES</span>
<span class="o">&lt;</span><span class="n">parentPackageName</span><span class="o">&gt;</span><span class="n">_SUBPACKAGE_DIRS</span>
<span class="o">&lt;</span><span class="n">parentPackageName</span><span class="o">&gt;</span><span class="n">_SUBPACKAGE_OPTREQ</span>
</pre></div>
</div>
<p>For each subpackage <code class="docutils literal notranslate"><span class="pre">&lt;subpackageFullName&gt;</span></code>, this sets:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">subpackageFullName</span><span class="o">&gt;</span><span class="n">_SOURCE_DIR</span>
<span class="o">&lt;</span><span class="n">subpackageFullName</span><span class="o">&gt;</span><span class="n">_REL_SOURCE_DIR</span>
<span class="o">&lt;</span><span class="n">subpackageFullName</span><span class="o">&gt;</span><span class="n">_PARENT_PACKAGE</span>
<span class="o">&lt;</span><span class="n">subpackageFullName</span><span class="o">&gt;</span><span class="n">_PARENT_REPOSITORY</span>
</pre></div>
</div>
<p>And it appends for each subpackage to variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PROJECT_NAME}_SE_PACKAGES (old)
</pre></div>
</div>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a></p>
<p>In: core/package_arch/TribitsReadDepsFilesCreateDepsGraph.cmake:723</p>
</section>
<section id="tribits-prep-to-read-dependencies">
<h3><a class="toc-backref" href="#id247">tribits_prep_to_read_dependencies()</a><a class="headerlink" href="#tribits-prep-to-read-dependencies" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_prep_to_read_dependencies</span><span class="p">(</span><span class="o">&lt;</span><span class="n">packageName</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Macro that sets to undefined all of the variables that must be set by the
<a class="reference internal" href="#tribits-package-define-dependencies">tribits_package_define_dependencies()</a> macro.</p>
<p>It also sets to empty the forward dependency list vars:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">packageName</span><span class="o">&gt;</span><span class="n">_FORWARD_</span><span class="o">&lt;</span><span class="n">listType</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>for each of the forward/downstream in <a class="reference internal" href="#list-variables-defining-the-package-dependencies-graph">List variables defining the package
dependencies graph</a>.</p>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a></p>
<p>In: core/package_arch/TribitsReadDepsFilesCreateDepsGraph.cmake:329</p>
</section>
<section id="tribits-process-all-repository-deps-setup-files">
<h3><a class="toc-backref" href="#id248">tribits_process_all_repository_deps_setup_files()</a><a class="headerlink" href="#tribits-process-all-repository-deps-setup-files" title="Permalink to this heading"></a></h3>
<p>Process any dependency logic at the repo level by loading
<a class="reference internal" href="#repodir-cmake-repositorydependenciessetup-cmake">&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</a> files.</p>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a></p>
<p>In: core/package_arch/TribitsReadDepsFilesCreateDepsGraph.cmake:89</p>
</section>
<section id="tribits-process-package-dependencies-lists">
<h3><a class="toc-backref" href="#id249">tribits_process_package_dependencies_lists()</a><a class="headerlink" href="#tribits-process-package-dependencies-lists" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_process_package_dependencies_lists</span><span class="p">(</span><span class="o">&lt;</span><span class="n">packageName</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Sets up the upstream and downstream/forward package dependency list
variables for <code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;</span></code> described in <a class="reference internal" href="#list-variables-defining-the-package-dependencies-graph">List variables defining the
package dependencies graph</a>.  Note that the downstream/forward dependencies
of upstream packages on this package <code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;</span></code> are built up
incrementally.</p>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a></p>
<p>In: core/package_arch/TribitsReadDepsFilesCreateDepsGraph.cmake:447</p>
</section>
<section id="tribits-process-packages-and-dirs-lists">
<h3><a class="toc-backref" href="#id250">tribits_process_packages_and_dirs_lists()</a><a class="headerlink" href="#tribits-process-packages-and-dirs-lists" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_process_packages_and_dirs_lists</span><span class="p">()</span>
</pre></div>
</div>
<p>Macro that processes the list variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${REPOSITORY_NAME}_PACKAGES_AND_DIRS_AND_CLASSIFICATIONS
</pre></div>
</div>
<p>from a <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> file that just got read in and
creates/updates the variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PROJECT_NAME}_PACKAGES
${PROJECT_NAME}_NUM_PACKAGES
${PROJECT_NAME}_LAST_PACKAGE_IDX
${PROJECT_NAME}_REVERSE_PACKAGES
</pre></div>
</div>
<p>For each of the listed top-level (parent) packages ${PACKAGE_NAME}, it also
sets up constant variables defined in <a class="reference internal" href="#tribits-package-top-level-local-variables">TriBITS Package Top-Level Local
Variables</a> like:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#package-name-source-dir">${PACKAGE_NAME}_SOURCE_DIR</a></p></li>
<li><p><a class="reference internal" href="#package-name-rel-source-dir">${PACKAGE_NAME}_REL_SOURCE_DIR</a></p></li>
<li><p><a class="reference internal" href="#package-name-testgroup">${PACKAGE_NAME}_TESTGROUP</a></p></li>
</ul>
<p>and sets up some standard enable/disable vars with default values as defined
in <a class="reference internal" href="#tribits-package-cache-variables">TriBITS Package Cache Variables</a> like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PROJECT_NAME}_ENABLE_${PACKAGE_NAME}
</pre></div>
</div>
<p>NOTE: Set <code class="docutils literal notranslate"><span class="pre">TRIBITS_PROCESS_PACKAGES_AND_DIRS_LISTS_VERBOSE=TRUE</span></code> to see
really verbose debug output from this macro.</p>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a>.</p>
<p>In: core/package_arch/TribitsProcessPackagesAndDirsLists.cmake:365</p>
</section>
<section id="tribits-process-project-dependency-setup-file">
<h3><a class="toc-backref" href="#id251">tribits_process_project_dependency_setup_file()</a><a class="headerlink" href="#tribits-process-project-dependency-setup-file" title="Permalink to this heading"></a></h3>
<p>Process any dependency logic at the project level by loading the
<a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a> file</p>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a></p>
<p>In: core/package_arch/TribitsReadDepsFilesCreateDepsGraph.cmake:126</p>
</section>
<section id="tribits-process-tpls-lists">
<h3><a class="toc-backref" href="#id252">tribits_process_tpls_lists()</a><a class="headerlink" href="#tribits-process-tpls-lists" title="Permalink to this heading"></a></h3>
<p>This macro that processes the project-level variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${REPOSITORY_NAME}_TPLS_FINDMODS_CLASSIFICATIONS
</pre></div>
</div>
<p>and updates the project-level variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PROJECT_NAME}_TPLS
${PROJECT_NAME}_NUM_TPLS
${PROJECT_NAME}_REVERSE_TPLS
</pre></div>
</div>
<p>For each TPL, it also sets the variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${TPL_NAME}_FINDMOD
${TPL_NAME}_TESTGROUP
${TPL_NAME}_DEPENDENCIES_FILE
${TPL_NAME}_TPLS_LIST_FILE
</pre></div>
</div>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a></p>
<p>In: core/package_arch/TribitsProcessTplsLists.cmake:124</p>
</section>
<section id="tribits-read-all-package-deps-files-create-deps-graph">
<h3><a class="toc-backref" href="#id253">tribits_read_all_package_deps_files_create_deps_graph()</a><a class="headerlink" href="#tribits-read-all-package-deps-files-create-deps-graph" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_read_all_package_deps_files_create_deps_graph</span><span class="p">()</span>
</pre></div>
</div>
<p>This macro reads in all of the <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> and
<a class="reference internal" href="#packagedir-spkgdir-cmake-dependencies-cmake">&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</a> files for top-level
packages and subpackages, respectively, and builds the package dependency
graph variables.</p>
<p>This macro reads from the variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PROJECT_NAME}_ALL_REPOSITORIES
${PROJECT_NAME}_PACKAGES (old)
</pre></div>
</div>
<p>And writes to the variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PROJECT_NAME}_SE_PACKAGES (old)
</pre></div>
</div>
<p>as well creates the package dependency variables described in <a class="reference internal" href="#list-variables-defining-the-package-dependencies-graph">List
variables defining the package dependencies graph</a> that defines the
directed acyclic dependency (DAG) package dependency graph (with navigation
up and down the graph).</p>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a></p>
<p>In: core/package_arch/TribitsReadDepsFilesCreateDepsGraph.cmake:153</p>
</section>
<section id="tribits-read-all-project-deps-files-create-deps-graph">
<h3><a class="toc-backref" href="#id254">tribits_read_all_project_deps_files_create_deps_graph()</a><a class="headerlink" href="#tribits-read-all-project-deps-files-create-deps-graph" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_read_all_project_deps_files_create_deps_graph</span><span class="p">()</span>
</pre></div>
</div>
<p>Macro run at the top project-level scope that reads the lists of packages
and TPLs and creates the packages dependency graph.</p>
<p>On output, this creates all of the package lists and dependency
data-structures described in the section <a class="reference internal" href="#tribits-system-data-structures">TriBITS System Data Structures</a>
and more specifically the sections:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#lists-of-external-and-internal-packages">Lists of external and internal packages</a></p></li>
<li><p><a class="reference internal" href="#list-variables-defining-the-package-dependencies-graph">List variables defining the package dependencies graph</a></p></li>
<li><p><a class="reference internal" href="#tribits-package-top-level-local-variables">TriBITS Package Top-Level Local Variables</a></p></li>
<li><p><a class="reference internal" href="#tribits-subpackage-top-level-local-variables">TriBITS Subpackage Top-Level Local Variables</a></p></li>
<li><p><a class="reference internal" href="#tribits-package-cache-variables">TriBITS Package Cache Variables</a></p></li>
</ul>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a>.</p>
<p>In: core/package_arch/TribitsReadAllProjectDepsFilesCreateDepsGraph.cmake:52</p>
</section>
<section id="tribits-read-back-dependencies-vars">
<h3><a class="toc-backref" href="#id255">tribits_read_back_dependencies_vars()</a><a class="headerlink" href="#tribits-read-back-dependencies-vars" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_read_back_dependencies_vars</span><span class="p">(</span><span class="o">&lt;</span><span class="n">postfix</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Read back the local package dependency vars from the saved-off vars with
suffix <code class="docutils literal notranslate"><span class="pre">_&lt;postfix&gt;</span></code>.</p>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a></p>
<p>In: core/package_arch/TribitsReadDepsFilesCreateDepsGraph.cmake:421</p>
</section>
<section id="tribits-read-defined-external-and-internal-toplevel-packages-lists">
<h3><a class="toc-backref" href="#id256">tribits_read_defined_external_and_internal_toplevel_packages_lists()</a><a class="headerlink" href="#tribits-read-defined-external-and-internal-toplevel-packages-lists" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_read_defined_external_and_internal_toplevel_packages_lists</span><span class="p">()</span>
</pre></div>
</div>
<p>Macro run at the top project-level scope that reads in the contents of all
of the <a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a> and <a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a> files
to get the list of defined external packages (TPLs) and internal top-level
(TriBITS) packages.</p>
<p>On output, this produces the list variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PROJECT_NAME}_DEFINED_TPLS
${PROJECT_NAME}_DEFINED_INTERNAL_PACKAGES
${PROJECT_NAME}_ALL_DEFINED_TOPLEVEL_PACKAGES

${PROJECT_NAME}_NUM_DEFINED_TPLS
${PROJECT_NAME}_NUM_DEFINED_INTERNAL_PACKAGES
${PROJECT_NAME}_NUM_ALL_DEFINED_TOPLEVEL_PACKAGES

${PROJECT_NAME}_PACKAGES (old)
${PROJECT_NAME}_TPLS (old)
</pre></div>
</div>
<p>and related variables.</p>
<p>This includes the files:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="#repodir-tplslist-cmake">&lt;repoDir&gt;/TPLsList.cmake</a></p></li>
<li><p><a class="reference internal" href="#repodir-packageslist-cmake">&lt;repoDir&gt;/PackagesList.cmake</a></p></li>
</ul>
</div></blockquote>
<p>and calls the macros:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="#tribits-process-tpls-lists">tribits_process_tpls_lists()</a></p></li>
<li><p><a class="reference internal" href="#tribits-process-packages-and-dirs-lists">tribits_process_packages_and_dirs_lists()</a></p></li>
</ul>
</div></blockquote>
<p>which set their variables.</p>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a></p>
<p>In: core/package_arch/TribitsReadAllProjectDepsFilesCreateDepsGraph.cmake:87</p>
</section>
<section id="tribits-read-deps-files-create-deps-graph">
<h3><a class="toc-backref" href="#id257">tribits_read_deps_files_create_deps_graph()</a><a class="headerlink" href="#tribits-read-deps-files-create-deps-graph" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_read_deps_files_create_deps_graph</span><span class="p">()</span>
</pre></div>
</div>
<p>This macro reads of all the package dependencies and builds the package
dependency graph.  This first executes the logic in the files
<a class="reference internal" href="#repodir-cmake-repositorydependenciessetup-cmake">&lt;repoDir&gt;/cmake/RepositoryDependenciesSetup.cmake</a> (for each TriBITS repo)
and <a class="reference internal" href="#projectdir-cmake-projectdependenciessetup-cmake">&lt;projectDir&gt;/cmake/ProjectDependenciesSetup.cmake</a> and then reads in
all of the <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> and
<a class="reference internal" href="#packagedir-spkgdir-cmake-dependencies-cmake">&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</a> files and builds the
package dependency graph variables.</p>
<p>This macro reads from the variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PROJECT_NAME}_ALL_REPOSITORIES (old)
${PROJECT_NAME}_PACKAGES (old)
</pre></div>
</div>
<p>and writes to the variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PROJECT_NAME}_SE_PACKAGES (old)
</pre></div>
</div>
<p>as well creates the package dependency variables described in <a class="reference internal" href="#list-variables-defining-the-package-dependencies-graph">List
variables defining the package dependencies graph</a> that defines the
directed acyclic dependency (DAG) package dependency graph (with navigation
up and down the graph).</p>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a></p>
<p>In: core/package_arch/TribitsReadDepsFilesCreateDepsGraph.cmake:44</p>
</section>
<section id="tribits-read-external-package-deps-files-add-to-graph">
<h3><a class="toc-backref" href="#id258">tribits_read_external_package_deps_files_add_to_graph()</a><a class="headerlink" href="#tribits-read-external-package-deps-files-add-to-graph" title="Permalink to this heading"></a></h3>
<p>Reads in dependencies for the external packages/TPL <code class="docutils literal notranslate"><span class="pre">&lt;tplName&gt;</span></code> and
creates the package dependency graph entries for it.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_read_external_package_deps_files_add_to_graph</span><span class="p">(</span><span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>This reads in the file <code class="docutils literal notranslate"><span class="pre">${&lt;tplName&gt;_DEPENDENCIES_FILE}</span></code> and sets the
varaible:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">tplName</span><span class="o">&gt;</span><span class="n">_LIB_ALL_DEPENDENCIES</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a></p>
<p>In: core/package_arch/TribitsReadDepsFilesCreateDepsGraph.cmake:205</p>
</section>
<section id="tribits-read-package-subpackage-deps-files-add-to-graph">
<h3><a class="toc-backref" href="#id259">tribits_read_package_subpackage_deps_files_add_to_graph()</a><a class="headerlink" href="#tribits-read-package-subpackage-deps-files-add-to-graph" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_read_package_subpackage_deps_files_add_to_graph</span><span class="p">(</span><span class="o">&lt;</span><span class="n">toplevelPackageName</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Read in subpackages dependencies files and add to dependencies graph
variables.</p>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a></p>
<p>In: core/package_arch/TribitsReadDepsFilesCreateDepsGraph.cmake:864</p>
</section>
<section id="tribits-read-subpackage-deps-file-add-to-graph">
<h3><a class="toc-backref" href="#id260">tribits_read_subpackage_deps_file_add_to_graph()</a><a class="headerlink" href="#tribits-read-subpackage-deps-file-add-to-graph" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_read_subpackage_deps_file_add_to_graph</span><span class="p">(</span><span class="o">&lt;</span><span class="n">toplevelPackageName</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">subpackageName</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">subpackageDir</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Macro that reads in a single subpackage dependencies file
<a class="reference internal" href="#packagedir-spkgdir-cmake-dependencies-cmake">&lt;packageDir&gt;/&lt;spkgDir&gt;/cmake/Dependencies.cmake</a> and sets up the
dependency structure for it.</p>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a></p>
<p>In: core/package_arch/TribitsReadDepsFilesCreateDepsGraph.cmake:892</p>
</section>
<section id="tribits-read-toplevel-package-deps-files-add-to-graph">
<h3><a class="toc-backref" href="#id261">tribits_read_toplevel_package_deps_files_add_to_graph()</a><a class="headerlink" href="#tribits-read-toplevel-package-deps-files-add-to-graph" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_read_toplevel_package_deps_files_add_to_graph</span><span class="p">(</span><span class="o">&lt;</span><span class="n">packageName</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Macro that reads in package dependencies for a top-level package from the
file <a class="reference internal" href="#packagedir-cmake-dependencies-cmake">&lt;packageDir&gt;/cmake/Dependencies.cmake</a> and appends the forward
dependencies list vars for packages already read in for this package
<code class="docutils literal notranslate"><span class="pre">&lt;packageName&gt;</span></code>.</p>
<p>Modifies the global variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PACKAGE_NAME}_LIB_REQUIRED_DEP_PACKAGES
${PACKAGE_NAME}_LIB_OPTIONAL_DEP_PACKAGES
${PACKAGE_NAME}_TEST_REQUIRED_DEP_PACKAGES
${PACKAGE_NAME}_TEST_OPTIONAL_DEP_PACKAGES
${PACKAGE_NAME}_FORWARD_LIB_REQUIRED_DEP_PACKAGES
${PACKAGE_NAME}_FORWARD_LIB_OPTIONAL_DEP_PACKAGES
${PACKAGE_NAME}_FORWARD_TEST_REQUIRED_DEP_PACKAGES
${PACKAGE_NAME}_FORWARD_TEST_OPTIONAL_DEP_PACKAGES
</pre></div>
</div>
<p>It also appends the list variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>${PROJECT_NAME}_SE_PACKAGES (old)
</pre></div>
</div>
<p>as for the subpackage dependencies under this top-level package are read in
order and then this top-level package is appended and dependencies are
dependencies are created for them.</p>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a></p>
<p>In: core/package_arch/TribitsReadDepsFilesCreateDepsGraph.cmake:234</p>
</section>
<section id="tribits-save-off-dependency-vars">
<h3><a class="toc-backref" href="#id262">tribits_save_off_dependency_vars()</a><a class="headerlink" href="#tribits-save-off-dependency-vars" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_save_off_dependency_vars</span><span class="p">(</span><span class="o">&lt;</span><span class="n">postfix</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Saves off package dependency variables with variable suffix <code class="docutils literal notranslate"><span class="pre">_&lt;postfix&gt;</span></code>.</p>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a></p>
<p>In: core/package_arch/TribitsReadDepsFilesCreateDepsGraph.cmake:396</p>
</section>
<section id="tribits-set-dep-packages">
<h3><a class="toc-backref" href="#id263">tribits_set_dep_packages()</a><a class="headerlink" href="#tribits-set-dep-packages" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_set_dep_packages</span><span class="p">(</span><span class="o">&lt;</span><span class="n">packageName</span><span class="o">&gt;</span>  <span class="n">LIB</span><span class="o">|</span><span class="n">TEST</span>  <span class="n">REQUIRED</span><span class="o">|</span><span class="n">OPTIONAL</span><span class="p">)</span>
</pre></div>
</div>
<p>Function that helps to set up backward package dependency lists for a given
package given the vars read in from the macro
<a class="reference internal" href="#tribits-package-define-dependencies">tribits_package_define_dependencies()</a>.</p>
<p>Sets the upstream/backward dependency variables defined in the section <a class="reference internal" href="#list-variables-defining-the-package-dependencies-graph">List
variables defining the package dependencies graph</a>.</p>
<p>This also handles the several types of issues:</p>
<ul class="simple">
<li><p>A package declaring a dependency on itself
(<a class="reference internal" href="#tribits-abort-on-self-dep">tribits_abort_on_self_dep()</a>).</p></li>
<li><p>A missing upstream dependent package (either error out with
<a class="reference internal" href="#tribits-abort-on-missing-package">tribits_abort_on_missing_package()</a> or allow to be missing and disable
this package if this is a required dependency).</p></li>
</ul>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a></p>
<p>In: core/package_arch/TribitsReadDepsFilesCreateDepsGraph.cmake:481</p>
</section>
<section id="tribits-trace-file-processing">
<h3><a class="toc-backref" href="#id264">tribits_trace_file_processing()</a><a class="headerlink" href="#tribits-trace-file-processing" title="Permalink to this heading"></a></h3>
<p>Print trace of file processing when
<code class="docutils literal notranslate"><span class="pre">${PROJECT_NAME}_TRACE_FILE_PROCESSING</span></code> is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_trace_file_processing</span><span class="p">(</span> <span class="o">&lt;</span><span class="nb">type</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">processingType</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">filePath</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;type&gt;</span></code>: Allowed values “PROJECT”, “REPOSITORY”, “PACKAGE”, or “TPL”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;processingType&gt;</span></code>: Allowed values “INCLUDE”, “ADD_SUBDIR”, “READ”, or
“CONFIGURE”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;filePath&gt;</span></code>: Path of the file being processed</p></li>
</ul>
<p>In: core/package_arch/TribitsGeneralMacros.cmake:376</p>
</section>
<section id="tribits-write-package-client-export-files-install-targets">
<h3><a class="toc-backref" href="#id265">tribits_write_package_client_export_files_install_targets()</a><a class="headerlink" href="#tribits-write-package-client-export-files-install-targets" title="Permalink to this heading"></a></h3>
<p>Create the <code class="docutils literal notranslate"><span class="pre">&lt;Package&gt;ConfigTargets.cmake</span></code> file and install rules and the
install() target for the previously generated
<code class="docutils literal notranslate"><span class="pre">&lt;Package&gt;Config_install.cmake</span></code> files generated by the
<a class="reference internal" href="#tribits-write-flexible-package-client-export-files">tribits_write_flexible_package_client_export_files()</a> function.</p>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_write_package_client_export_files_install_targets</span><span class="p">(</span>
  <span class="n">PACKAGE_NAME</span> <span class="o">&lt;</span><span class="n">packageName</span><span class="o">&gt;</span>
  <span class="n">PACKAGE_CONFIG_FOR_BUILD_BASE_DIR</span> <span class="o">&lt;</span><span class="n">packageConfigForBuildBaseDir</span><span class="o">&gt;</span>
  <span class="n">PACKAGE_CONFIG_FOR_INSTALL_BASE_DIR</span> <span class="o">&lt;</span><span class="n">packageConfigForInstallBaseDir</span><span class="o">&gt;</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>The install() commands must be in a different subroutine or CMake will not
allow you to call the routine, even if you if() it out!</p>
<p>In: core/package_arch/TribitsWriteClientExportFiles.cmake:604</p>
</section>
<section id="tribits-write-xml-dependency-files">
<h3><a class="toc-backref" href="#id266">tribits_write_xml_dependency_files()</a><a class="headerlink" href="#tribits-write-xml-dependency-files" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_write_xml_dependency_files</span><span class="p">()</span>
</pre></div>
</div>
<p>Macro that output XML dependency files if asked based in the global project
package dependency graph previously constructed..</p>
<p>In: ci_support/TribitsWriteXmlDependenciesFiles.cmake:148</p>
</section>
<section id="tribits-write-xml-dependency-files-if-supported">
<h3><a class="toc-backref" href="#id267">tribits_write_xml_dependency_files_if_supported()</a><a class="headerlink" href="#tribits-write-xml-dependency-files-if-supported" title="Permalink to this heading"></a></h3>
<p>Usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tribits_write_xml_dependency_files_if_supported</span><span class="p">()</span>
</pre></div>
</div>
<p>Function that writes XML dependency files if support for that exists in this
instance of TriBITs.</p>
<p>See <a class="reference internal" href="#function-call-tree-for-constructing-package-dependency-graph">Function call tree for constructing package dependency graph</a></p>
<p>In: core/package_arch/TribitsReadAllProjectDepsFilesCreateDepsGraph.cmake:242</p>
</section>
</section>
</section>
<section id="references">
<h1><a class="toc-backref" href="#id268"><span class="sectnum">13</span> References</a><a class="headerlink" href="#references" title="Permalink to this heading"></a></h1>
<p id="agile-software-development-2003">Martin, Robert. <em>Agile Software Development (Principles, Patterns, and
Practices)</em>. Prentice Hall. 2003.</p>
<p id="integration-strategies-for-cse-2009">Bartlett, Roscoe. <em>Integration Strategies for Computational Science &amp;
Engineering Software</em>.  2009-0655, Second International Workshop on Software
Engineering for Computational Science and Engineering, 2009.  <a class="reference external" href="https://bartlettroscoe.github.io/publications/CSE_SoftwareIntegration_Strategies.pdf">https://bartlettroscoe.github.io/publications/CSE_SoftwareIntegration_Strategies.pdf</a>.</p>
<p id="scale-2011"><em>SCALE: A Comprehensive Modeling and Simulation Suite for Nuclear Safety Analysis and Design</em>, ORNL/TM-2005/39, Version 6.1, Oak Ridge National Laboratory, Oak Ridge, Tennessee, June 2011. Available from Radiation Safety Information Computational Center at Oak Ridge National Laboratory as CCC-785.  <a class="reference external" href="http://scale.ornl.gov/">http://scale.ornl.gov/</a></p>
<p id="professional-cmake">Scott, Craig.  <em>Professional CMake: A Practical Guide (5th Edition).</em> ISBN 978-1-925904-03-1. 2019.  <a class="reference external" href="https://crascit.com/">https://crascit.com/</a></p>
<p id="livev"><em>LiveV</em>  <a class="reference external" href="https://github.com/lifev/cmake">https://github.com/lifev/cmake</a></p>
</section>
<section id="faq">
<h1><a class="toc-backref" href="#id269"><span class="sectnum">14</span> FAQ</a><a class="headerlink" href="#faq" title="Permalink to this heading"></a></h1>
<p><strong>Q:</strong> Why does not TriBITS just use the standard CMake <code class="docutils literal notranslate"><span class="pre">Find&lt;PACKAGE_NAME&gt;.cmake</span></code>
modules and the standard <code class="docutils literal notranslate"><span class="pre">find_package()</span></code> function to find TPLs?</p>
<p><strong>A:</strong> The different “standard” CMake <code class="docutils literal notranslate"><span class="pre">Find&lt;PACKAGE_NAME&gt;.cmake</span></code> modules do not
have a standard set of outputs and therefore, can’t be handled in a uniform
way.  For example,</p>
</section>
<section id="appendix">
<h1><a class="toc-backref" href="#id270"><span class="sectnum">15</span> Appendix</a><a class="headerlink" href="#appendix" title="Permalink to this heading"></a></h1>
<section id="history-of-tribits">
<h2><a class="toc-backref" href="#id271"><span class="sectnum">15.1</span> History of TriBITS</a><a class="headerlink" href="#history-of-tribits" title="Permalink to this heading"></a></h2>
<p>TriBITS started development in November 2007 as a set of helper macros to
provide a CMake build system for a small subset of packages in Trilinos.  The
initial goal was to support a native Windows build (using Visual C++) to
compile and install these few Trilinos packages on Windows for usage by
another project (the Sandia Titan project which included VTK).  At that time,
Trilinos was using a highly customized and augmented autotools build system.
Initially, this CMake system was just a set of macros to streamline creating
executables and tests.  Some of the conventions started in that early effort
(e.g. naming conventions of variables and macros where functions use upper
case like old FORTRAN and variables are mixed case) were continued in later
efforts and are reflected in the current implementation.  Then, stating in
early 2008, a more detailed evaluation was performed to see if Trilinos should
switch over to CMake as the default (and soon only) supported build and test
system (see “Why CMake?” in <a class="reference external" href="../overview/TribitsOverview.pdf">TriBITS Overview</a>).  This lead to the initial
implementation of a scalable package-based architecture (PackageArch) for the
Trilinos CMake project in late 2008.  This Trilinos CMake PackageArch system
evolved over the next few years with development in the system slowing
into 2010.  This Trilinos CMake build system was then adopted as the build
infrastructure for the CASL VERA effort in 2011 where CASL VERA packages were
treated as add-on Trilinos packages (see Section <a class="reference internal" href="#multi-repository-support">Multi-Repository Support</a>).
Over the next year, there was significant development of the system to support
larger multi-repo projects in support of CASL VERA.  That lead to the decision
to formally generalize the Trilinos CMake PackageArch build system outside of
Trilinos and the name TriBITS was formally adopted in November 2011.  Work to
refactor the Trilinos CMake system into a general reusable stand-alone
CMake-based build system started in October 2011 and an initial implementation
was complete in December 2011 when it was used for the CASL VERA build system.
In early 2012, the ORNL CASL-related projects Denovo and SCALE (see [<a class="reference internal" href="#scale-2011">SCALE,
2011</a>]) adopted TriBITS as their native development build systems.  Shortly
after, TriBITS was adopted as the native build system for the CASL-related
University of Michigan code MPACT.  In addition to being used in CASL, all of
these codes also had a significant life outside of CASL.  Because they used
the same TriBITS build system, it proved relatively easy to keep these various
codes integrated together in the CASL VERA code meta-build.  At the same time,
TriBITS well served the independent development teams and non-CASL projects
independent from CASL VERA.  Since the initial extraction of TriBITS from
Trilinos, the TriBITS system was further extended and refined, driven by CASL
VERA development and expansion.  Independently, an early version of TriBITS
from 2012 was adopted by the LiveV
project (see [<a class="reference internal" href="#livev">LiveV</a>]) which was forked and extended
independently.</p>
</section>
<section id="why-a-tribits-package-is-not-a-cmake-package">
<h2><a class="toc-backref" href="#id272"><span class="sectnum">15.2</span> Why a TriBITS Package is not a CMake Package</a><a class="headerlink" href="#why-a-tribits-package-is-not-a-cmake-package" title="Permalink to this heading"></a></h2>
<p>Note that a <a class="reference internal" href="#tribits-package">TriBITS Package</a> is not the same thing as a “Package” in raw
CMake terminology.  In raw CMake, a “Package” is some externally provided bit
of software or other utility for which the current CMake project has an
optional or required dependency (see <a class="reference external" href="http://www.cmake.org/Wiki/CMake:How_To_Find_Libraries">CMake: How to Find Libraries</a>).  Therefore, a raw
CMake “Package” actually maps to a <a class="reference internal" href="#tribits-tpl">TriBITS TPL</a>.  A raw CMake “Package”
(e.g. Boost, CUDA, etc.)  can be found using a standard CMake find module
<code class="docutils literal notranslate"><span class="pre">Find&lt;rawPackageName&gt;.cmake</span></code> using the built-in CMake command
<code class="docutils literal notranslate"><span class="pre">find_package(&lt;rawPackageName&gt;)</span></code>.  It is unfortunate that the TriBITS and
the raw CMake definitions of the term “Package” are not exactly the same.
However, the term “Package” was coined by the Trilinos project long ago before
CMake was adopted as the Trilinos build system and Trilinos’ definition of
“Package” (going back to 1998) pre-dates the development of CMake (see
<a class="reference external" href="http://en.wikipedia.org/wiki/CMake#History">History of CMake</a>) and
therefore Trilinos dictated the terminology of TriBITS and the definition of
the term “Package” in the TriBITS system.  However, note that both meanings of
the term “Package” are consistent with the more general software engineering
definition of a “Package” according to <a class="reference internal" href="#software-engineering-packaging-principles">Software Engineering Packaging
Principles</a>.</p>
</section>
<section id="design-considerations-for-tribits">
<h2><a class="toc-backref" href="#id273"><span class="sectnum">15.3</span> Design Considerations for TriBITS</a><a class="headerlink" href="#design-considerations-for-tribits" title="Permalink to this heading"></a></h2>
<p>Some of the basic requirements and design goals for TriBITS are outlined in
the <a class="reference external" href="../overview/TribitsOverview.pdf">TriBITS Overview</a> document.</p>
<p>As stated in <a class="reference internal" href="#tribits-dependency-handling-behaviors">TriBITS Dependency Handling Behaviors</a>, <a class="reference internal" href="#no-circular-dependencies-of-any-kind-are-allowed">No circular
dependencies of any kind are allowed</a>.  That is, no TriBITS SE package (or
its tests) can declare a dependency on a <a class="reference internal" href="#downstream">downstream</a> SE package, period!  To
some, this might seem over constraining but adding support for circular
dependencies to the TriBITS system would add significant complexity and
space/time overhead and is a bad idea from a basic software engineering
perspective (see the <em>ADP (Acyclic Dependencies Principle)</em> in <a class="reference internal" href="#software-engineering-packaging-principles">Software
Engineering Packaging Principles</a>).  From a versioning, building, and
change-prorogation perspective, any packages involved in a circular dependency
would need to be treated as a single software engineering package anyway so
TriBITS forces development teams to glob all of this stuff together into a
single <a class="reference internal" href="#tribits-se-package">TriBITS SE Package</a> when cycles in software exist.  There are
numerous wonderful ways to break circular dependencies between packages that
are proven and well established in the SE community (for example, see [<a class="reference internal" href="#agile-software-development-2003">Agile
Software Development, 2003</a>]).</p>
</section>
<section id="clone-extra-repos-py-help">
<h2><a class="toc-backref" href="#id274"><span class="sectnum">15.4</span> clone_extra_repos.py –help</a><a class="headerlink" href="#clone-extra-repos-py-help" title="Permalink to this heading"></a></h2>
<p>Below is a snapshot of the output from <code class="docutils literal notranslate"><span class="pre">clone_extra_repos.py</span> <span class="pre">--help</span></code>.  For
more details on the usage of <code class="docutils literal notranslate"><span class="pre">clone_extra_repos.py</span></code>, see <a class="reference internal" href="#multi-repository-support">Multi-Repository
Support</a> and <a class="reference internal" href="#multi-repository-development-workflow">Multi-Repository Development Workflow</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Usage: clone_extra_repos.py [options]

This script clones one more extra repos listed in a TriBITS
ExtraRepositoriesList.cmake file.  The standard usage is:

  $ cd base &lt;projectDir&gt;
  $ ./cmake/tribits/ci_support/clone-extra-repos.py

where &lt;projectDir&gt; is the base TriBITS project dir and base git repo.

By default, this will clone all the &#39;Nightly&#39; extra repos that are listed in
the file:

  &lt;projectDir&gt;/cmake/ExtraRepositoriesList.cmake

(other repo types can be selected using --extra-repos-type).

The list of which repos to clone can be &quot;white-list&quot; selected with the option
--extra-repos (see options below for details).  Extra repos can in addition be
&quot;back-listed&quot; using the option --not-extra-repos.

To see the full list of repos that can be cloned, pass in just:

  --skip-clone --verbosity=more

That will print out a table like:

  ------------------------------------------------------------------------------
  | ID | Repo Name  | Repo Dir   | VC  | Repo URL                 | Category   |
  |----|------------|------------|-----|--------------------------|------------|
  |  1 | ExtraRepo1 | ExtraRepo1 | GIT | someurl.com.ExtraRepo1   | Continuous |
  |  2 | ExtraRepo3 | ExtraRepo3 | GIT | someurl3.com:/ExtraRepo3 | Continuous |
  ------------------------------------------------------------------------------

If the git repo server is using gitolite, one can set
--gitolite-root=&lt;gitolite-root&gt; and that will result in git repos being
selected only if the selected repos are listed in &#39;ssh &lt;gitolite-root&gt; info&#39;.
This allows one to automatically exclude repos from being cloned that the user
has no permissions to clone.  NOTE: See warning about the --gitolite-root option below!

TIP: After cloning the set of repos, a nice way to interact with the repos is
to use the tool &#39;gitdist&#39;.  If your project does not have a version controlled
.gitdist.default file, you can generate one using the
--create-gitdist-file=&lt;gitdist-file&gt; argument, for example with:

  --create-gitdist-file=.gitdist

This will restrict the list of repos processed by gitdist to just the repos cloned.


Options:
  -h, --help            show this help message and exit
  --extra-repos=EXTRAREPOS
                        List of names of extra repos to be cloned &lt;extra-
                        repos&gt; (i.e. &quot;repo0,repo1,,...&quot;).  When set to empty
                        &#39;&#39; (the default value) then all repos that match
                        &lt;extra-repos-type&gt; listed in &lt;extra-repos-file&gt; will
                        be selected.  But the repos listed in &lt;extra-repos&gt;
                        must always be a subset of the repos of type &lt;extra-
                        repos-type&gt; selected from &lt;extra-repos-file&gt;.
                        (Default &#39;&#39;)
  --not-extra-repos=NOTEXTRAREPOS
                        List of names of extra repos *NOT* to clone (i.e.
                        &quot;repo0,repo1,...&quot;).  (Default &#39;&#39;)
  --extra-repos-file=EXTRAREPOSFILE
                        The file path &lt;extra-repos-file&gt; for the
                        ExtraRepositoriesList.cmake file.  This can be an
                        absolute or relative path.  (Default =
                        &#39;cmake/ExtraRepositoriesList.cmake&#39;)
  --extra-repos-type=EXTRAREPOSTYPE
                        Type of extra repositories &lt;extra-repos-type&gt; to
                        select from &lt;extra-repos-file&gt;.  When --extra-repos is
                        set, then this argument is ignored. Choices =
                        (&#39;Continuous&#39;, &#39;Nightly&#39;, &#39;Experimental&#39;).  [default =
                        &#39;Nightly&#39;]
  --gitolite-root=GITOLITEROOT
                        Gives the root for a gitolite repos &lt;gitolite-root&gt;
                        (e.g. git@&lt;some-url&gt;).  If specified, then any git
                        repos with the &lt;gitolite-root&gt; listed as their root
                        will only be selected if they are listed with &#39;R&#39;
                        permissions returned from &#39;ssh &lt;gitolite-root&gt; info&#39;.
                        WARNING: Make sure that you have your gitoliote SSH
                        registered correctly before using this option by
                        typing the command &#39;ssh &lt;gitlite-root&gt; info&#39; and make
                        sure that it does *not* ask for a password! (Default =
                        &#39;&#39;)
  --with-cmake=WITHCMAKE
                        CMake executable to use with cmake -P scripts
                        internally (only set by unit testing code).  (Default
                        = &#39;cmake&#39;)
  --verbosity=VERBLEVEL
                        Verbosity of the script (levels are cumulative):  none
                        = no output at all (except for commands with --no-op).
                        minimal = print script args echo and clone commands.
                        more = print basic repo include/exclude logic and
                        print repo table.  most = print output from cmake
                        script called, the output from gitolite, and other
                        detailed info. Choices = (&#39;none&#39;, &#39;minimal&#39;, &#39;more&#39;,
                        &#39;most&#39;).  [default = &#39;more&#39;]
  --do-clone            Do the clone of the selected repos. [default]
  --skip-clone          Skip the clone of the repos and just show what would
                        be done.
  --do-op               Do the clone of the selected repos. [default]
  --no-op               Skip cloning the repos and just show the clone
                        commands.
  --create-gitdist-file=CREATEGITDISTFILE
                        If specified, the file &lt;gitdist-file&gt; will get
                        generated with the list of git repos (the same list
                        that is cloned with --do-clone).  (Default = &#39;&#39;)
  --show-defaults       Show the default option values and do nothing at all.
</pre></div>
</div>
</section>
<section id="gitdist-documentation">
<h2><a class="toc-backref" href="#id275"><span class="sectnum">15.5</span> gitdist documentation</a><a class="headerlink" href="#gitdist-documentation" title="Permalink to this heading"></a></h2>
<p>The sections below show snapshots of the output from the <a class="reference internal" href="#gitdist">gitdist</a> tool from
<a class="reference internal" href="#gitdist-help">gitdist –help</a> and <code class="docutils literal notranslate"><span class="pre">gitdist</span> <span class="pre">--dist-help=&lt;topic&gt;</span></code>:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#gitdist-help">gitdist –help</a></p></li>
<li><p><a class="reference internal" href="#gitdist-dist-help-overview">gitdist –dist-help=overview</a></p></li>
<li><p><a class="reference internal" href="#gitdist-dist-help-repo-selection-and-setup">gitdist –dist-help=repo-selection-and-setup</a></p></li>
<li><p><a class="reference internal" href="#gitdist-dist-help-dist-repo-status">gitdist –dist-help=dist-repo-status</a></p></li>
<li><p><a class="reference internal" href="#gitdist-dist-help-repo-versions">gitdist –dist-help=repo-versions</a></p></li>
<li><p><a class="reference internal" href="#gitdist-dist-help-aliases">gitdist –dist-help=aliases</a></p></li>
<li><p><a class="reference internal" href="#gitdist-dist-help-default-branch">gitdist –dist-help=default-branch</a></p></li>
<li><p><a class="reference internal" href="#gitdist-dist-help-move-to-base-dir">gitdist –dist-help=move-to-base-dir</a></p></li>
<li><p><a class="reference internal" href="#gitdist-dist-help-usage-tips">gitdist –dist-help=usage-tips</a></p></li>
<li><p><a class="reference internal" href="#gitdist-dist-help-script-dependencies">gitdist –dist-help=script-dependencies</a></p></li>
<li><p><a class="reference internal" href="#gitdist-dist-help-all">gitdist –dist-help=all</a></p></li>
</ul>
<p>For more details on the usage of <code class="docutils literal notranslate"><span class="pre">gitdist</span></code>, see <a class="reference internal" href="#multi-repository-support">Multi-Repository Support</a>
and <a class="reference internal" href="#multi-repository-development-workflow">Multi-Repository Development Workflow</a>.</p>
<section id="gitdist-help">
<h3><a class="toc-backref" href="#id276">gitdist –help</a><a class="headerlink" href="#gitdist-help" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Usage</span><span class="p">:</span> <span class="n">gitdist</span> <span class="p">[</span><span class="n">gitdist</span> <span class="n">arguments</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">raw</span><span class="o">-</span><span class="n">git</span><span class="o">-</span><span class="n">command</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">git</span> <span class="n">arguments</span><span class="p">]</span>
       <span class="n">gitdist</span> <span class="p">[</span><span class="n">gitdist</span> <span class="n">arguments</span><span class="p">]</span> <span class="n">dist</span><span class="o">-</span><span class="n">repo</span><span class="o">-</span><span class="n">status</span>
       <span class="n">gitdist</span> <span class="p">[</span><span class="n">gitdist</span> <span class="n">arguments</span><span class="p">]</span> <span class="n">dist</span><span class="o">-</span><span class="n">repo</span><span class="o">-</span><span class="n">versions</span><span class="o">-</span><span class="n">table</span>

<span class="n">Run</span> <span class="n">git</span> <span class="n">over</span> <span class="n">a</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">git</span> <span class="n">repos</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">multi</span><span class="o">-</span><span class="n">repository</span> <span class="n">git</span> <span class="n">project</span> <span class="p">(</span><span class="n">see</span>
<span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">help</span><span class="o">=</span><span class="n">overview</span> <span class="o">--</span><span class="n">help</span><span class="p">)</span><span class="o">.</span>  <span class="n">This</span> <span class="n">script</span> <span class="n">also</span> <span class="n">includes</span> <span class="n">other</span> <span class="n">tools</span> <span class="n">like</span>
<span class="n">printing</span> <span class="n">a</span> <span class="n">compact</span> <span class="n">repo</span> <span class="n">status</span> <span class="n">table</span> <span class="p">(</span><span class="n">see</span> <span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">help</span><span class="o">=</span><span class="n">dist</span><span class="o">-</span><span class="n">repo</span><span class="o">-</span><span class="n">status</span><span class="p">)</span> <span class="ow">and</span>
<span class="n">tracking</span> <span class="n">compatible</span> <span class="n">versions</span> <span class="n">through</span> <span class="n">multi</span><span class="o">-</span><span class="n">repository</span> <span class="n">SHA1</span> <span class="n">version</span> <span class="n">files</span> <span class="p">(</span><span class="n">see</span>
<span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">help</span><span class="o">=</span><span class="n">repo</span><span class="o">-</span><span class="n">versions</span><span class="p">)</span><span class="o">.</span>

<span class="n">The</span> <span class="n">options</span> <span class="ow">in</span> <span class="p">[</span><span class="n">gitdist</span> <span class="n">options</span><span class="p">]</span> <span class="n">are</span> <span class="n">prefixed</span> <span class="k">with</span> <span class="s1">&#39;--dist-&#39;</span> <span class="ow">and</span> <span class="n">are</span> <span class="n">pulled</span>
<span class="n">out</span> <span class="n">before</span> <span class="n">running</span> <span class="s1">&#39;git &lt;raw-git-command&gt; [git arguments]&#39;</span> <span class="ow">in</span> <span class="n">each</span> <span class="n">local</span> <span class="n">git</span>
<span class="n">repo</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">processed</span> <span class="p">(</span><span class="n">see</span> <span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">help</span><span class="o">=</span><span class="n">repo</span><span class="o">-</span><span class="n">selection</span><span class="o">-</span><span class="ow">and</span><span class="o">-</span><span class="n">setup</span><span class="p">)</span><span class="o">.</span>


<span class="n">Options</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">help</span><span class="o">=</span><span class="n">HELPTOPIC</span>
                        <span class="n">Print</span> <span class="n">a</span> <span class="n">gitdist</span> <span class="n">help</span> <span class="n">topic</span><span class="o">.</span>  <span class="n">Using</span> <span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">help</span><span class="o">=</span><span class="nb">all</span>
                        <span class="n">prints</span> <span class="nb">all</span> <span class="n">help</span> <span class="n">topics</span><span class="o">.</span>  <span class="n">If</span> <span class="o">--</span><span class="n">help</span> <span class="ow">is</span> <span class="n">also</span> <span class="n">specified</span><span class="p">,</span>
                        <span class="n">then</span> <span class="n">the</span> <span class="n">help</span> <span class="n">usage</span> <span class="n">header</span> <span class="ow">and</span> <span class="n">command</span><span class="o">-</span><span class="n">line</span> <span class="s1">&#39;options&#39;</span>
                        <span class="n">are</span> <span class="n">also</span> <span class="n">printed</span><span class="o">.</span> <span class="n">Choices</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;overview&#39;</span><span class="p">,</span> <span class="s1">&#39;repo-</span>
                        <span class="n">selection</span><span class="o">-</span><span class="ow">and</span><span class="o">-</span><span class="n">setup</span><span class="s1">&#39;, &#39;</span><span class="n">dist</span><span class="o">-</span><span class="n">repo</span><span class="o">-</span><span class="n">status</span><span class="s1">&#39;, &#39;</span><span class="n">repo</span><span class="o">-</span>
                        <span class="n">versions</span><span class="s1">&#39;, &#39;</span><span class="n">dist</span><span class="o">-</span><span class="n">repo</span><span class="o">-</span><span class="n">versions</span><span class="o">-</span><span class="n">table</span><span class="s1">&#39;, &#39;</span><span class="n">aliases</span><span class="s1">&#39;,</span>
                        <span class="s1">&#39;default-branch&#39;</span><span class="p">,</span> <span class="s1">&#39;move-to-base-dir&#39;</span><span class="p">,</span> <span class="s1">&#39;usage-tips&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;script-dependencies&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span>  <span class="p">[</span><span class="n">default</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
  <span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">use</span><span class="o">-</span><span class="n">git</span><span class="o">=</span><span class="n">USEGIT</span>
                        <span class="n">Path</span> <span class="n">to</span> <span class="n">the</span> <span class="n">git</span> <span class="n">executable</span> <span class="n">to</span> <span class="n">use</span> <span class="k">for</span> <span class="n">each</span> <span class="n">git</span> <span class="n">repo</span>
                        <span class="n">command</span><span class="o">.</span>  <span class="n">By</span> <span class="n">default</span><span class="p">,</span> <span class="n">gitdist</span> <span class="n">will</span> <span class="n">use</span> <span class="s1">&#39;git&#39;</span> <span class="ow">in</span> <span class="n">the</span>
                        <span class="n">environment</span><span class="o">.</span>  <span class="n">If</span> <span class="n">it</span> <span class="n">can</span><span class="s1">&#39;t find &#39;</span><span class="n">git</span><span class="s1">&#39; in the</span>
                        <span class="n">environment</span><span class="p">,</span> <span class="n">then</span> <span class="n">it</span> <span class="n">will</span> <span class="n">require</span> <span class="n">setting</span> <span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">use</span><span class="o">-</span>
                        <span class="n">git</span><span class="o">=&lt;</span><span class="n">path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">git</span><span class="o">&gt;.</span>  <span class="p">(</span><span class="n">Typically</span> <span class="n">only</span>  <span class="n">used</span> <span class="ow">in</span> <span class="n">automated</span>
                        <span class="n">testing</span><span class="o">.</span><span class="p">)</span> <span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;git&#39;</span><span class="p">)</span>
  <span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">repos</span><span class="o">=</span><span class="n">REPOS</span>    <span class="n">Comma</span><span class="o">-</span><span class="n">separated</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">repo</span> <span class="n">relative</span> <span class="n">paths</span>
                        <span class="s1">&#39;&lt;repo0&gt;,&lt;repo1&gt;,...&#39;</span><span class="o">.</span> <span class="n">The</span> <span class="n">base</span> <span class="n">repo</span> <span class="ow">is</span> <span class="n">specified</span> <span class="k">with</span>
                        <span class="s1">&#39;.&#39;</span> <span class="ow">and</span> <span class="n">should</span> <span class="n">usually</span> <span class="n">be</span> <span class="n">listed</span> <span class="n">first</span><span class="o">.</span> <span class="n">If</span> <span class="n">left</span> <span class="n">empty</span>
                        <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">then</span> <span class="n">the</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">repos</span> <span class="n">to</span> <span class="n">process</span> <span class="ow">is</span> <span class="n">taken</span> <span class="kn">from</span>
                        <span class="nn">the</span> <span class="n">file</span> <span class="o">./.</span><span class="n">gitdist</span> <span class="p">(</span><span class="n">which</span> <span class="n">lists</span> <span class="n">the</span> <span class="n">relative</span> <span class="n">path</span> <span class="n">of</span>
                        <span class="n">each</span> <span class="n">git</span> <span class="n">repo</span> <span class="n">separated</span> <span class="n">by</span> <span class="n">newlines</span><span class="p">)</span><span class="o">.</span>  <span class="n">If</span> <span class="n">the</span> <span class="n">file</span>
                        <span class="o">./.</span><span class="n">gitdist</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">exist</span><span class="p">,</span> <span class="n">then</span> <span class="n">the</span> <span class="n">repos</span> <span class="n">listed</span> <span class="ow">in</span>
                        <span class="n">the</span> <span class="n">file</span> <span class="o">./.</span><span class="n">gitdist</span><span class="o">.</span><span class="n">default</span> <span class="n">are</span> <span class="n">processed</span><span class="o">.</span>  <span class="n">If</span> <span class="n">the</span>
                        <span class="n">file</span> <span class="n">the</span> <span class="n">file</span> <span class="o">./.</span><span class="n">gitdist</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="n">missing</span><span class="p">,</span> <span class="n">then</span> <span class="n">no</span>
                        <span class="n">extra</span> <span class="n">repos</span> <span class="n">are</span> <span class="n">processed</span> <span class="ow">and</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">assumed</span> <span class="n">that</span> <span class="n">the</span>
                        <span class="n">base</span> <span class="n">repo</span> <span class="n">will</span> <span class="n">be</span> <span class="n">processed</span><span class="o">.</span> <span class="n">Also</span><span class="p">,</span> <span class="nb">any</span> <span class="n">git</span> <span class="n">repos</span>
                        <span class="n">listed</span> <span class="n">that</span> <span class="n">don</span><span class="s1">&#39;t exist are ignored. See --dist-</span>
                        <span class="n">help</span><span class="o">=</span><span class="n">repo</span><span class="o">-</span><span class="n">selection</span><span class="o">-</span><span class="ow">and</span><span class="o">-</span><span class="n">setup</span><span class="o">.</span> <span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
  <span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="ow">not</span><span class="o">-</span><span class="n">repos</span><span class="o">=</span><span class="n">NOTREPOS</span>
                        <span class="n">Comma</span><span class="o">-</span><span class="n">separated</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">extra</span> <span class="n">repo</span> <span class="n">relative</span> <span class="n">paths</span>
                        <span class="s1">&#39;&lt;repoX&gt;,&lt;repoY&gt;,...&#39;</span> <span class="n">to</span> <span class="o">*</span><span class="ow">not</span><span class="o">*</span> <span class="n">process</span><span class="o">.</span> <span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
  <span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">mod</span><span class="o">-</span><span class="n">only</span>       <span class="n">If</span> <span class="nb">set</span><span class="p">,</span> <span class="n">then</span> <span class="n">only</span> <span class="n">git</span> <span class="n">repos</span> <span class="n">that</span> <span class="n">have</span> <span class="n">changes</span> <span class="n">w</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">t</span><span class="o">.</span>
                        <span class="n">their</span> <span class="n">tracking</span> <span class="n">branches</span> <span class="n">will</span> <span class="n">be</span> <span class="n">processed</span><span class="o">.</span>  <span class="n">That</span> <span class="ow">is</span><span class="p">,</span>
                        <span class="n">only</span> <span class="n">repos</span> <span class="n">that</span> <span class="n">have</span> <span class="n">modified</span> <span class="ow">or</span> <span class="n">untracked</span> <span class="n">files</span> <span class="ow">or</span>
                        <span class="n">where</span> <span class="s1">&#39;git diff --name-only ^&lt;tracking-branch&gt;&#39;</span>
                        <span class="n">returns</span> <span class="n">non</span><span class="o">-</span><span class="n">empty</span> <span class="n">output</span> <span class="n">will</span> <span class="n">be</span> <span class="n">processed</span> <span class="p">(</span><span class="n">where</span>
                        <span class="o">&lt;</span><span class="n">tracking</span><span class="o">-</span><span class="n">branch</span><span class="o">&gt;</span> <span class="ow">is</span> <span class="n">returned</span> <span class="kn">from</span> <span class="s1">&#39;rev-parse</span>
                        <span class="o">--</span><span class="n">abbrev</span><span class="o">-</span><span class="n">ref</span> <span class="o">--</span><span class="n">symbolic</span><span class="o">-</span><span class="n">full</span><span class="o">-</span><span class="n">name</span> <span class="o">@</span><span class="p">{</span><span class="n">u</span><span class="p">})</span><span class="s1">&#39;.  If a local</span>
                        <span class="n">repo</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">have</span> <span class="n">a</span> <span class="n">tracking</span> <span class="n">branch</span><span class="p">,</span> <span class="n">then</span> <span class="n">the</span> <span class="n">repo</span>
                        <span class="n">will</span> <span class="n">be</span> <span class="n">skipped</span> <span class="k">as</span> <span class="n">well</span><span class="o">.</span>  <span class="n">Therefore</span><span class="p">,</span> <span class="n">be</span> <span class="n">careful</span> <span class="n">to</span>
                        <span class="n">first</span> <span class="n">run</span> <span class="s1">&#39;gitdist-status&#39;</span> <span class="p">(</span><span class="n">see</span> <span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">help</span><span class="o">=</span><span class="n">dist</span><span class="o">-</span><span class="n">repo</span><span class="o">-</span>
                        <span class="n">status</span><span class="p">)</span> <span class="n">to</span> <span class="n">see</span> <span class="n">the</span> <span class="n">status</span> <span class="n">of</span> <span class="n">each</span> <span class="n">local</span> <span class="n">git</span> <span class="n">repo</span> <span class="n">to</span>
                        <span class="n">know</span> <span class="n">which</span> <span class="n">repos</span> <span class="n">don</span><span class="s1">&#39;t have tracking branches.</span>
  <span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">legend</span>         <span class="n">If</span> <span class="nb">set</span><span class="p">,</span> <span class="n">then</span> <span class="n">a</span> <span class="n">legend</span> <span class="n">will</span> <span class="n">be</span> <span class="n">printed</span> <span class="n">below</span> <span class="n">the</span> <span class="n">repo</span>
                        <span class="n">summary</span> <span class="n">table</span> <span class="k">for</span> <span class="n">the</span> <span class="n">special</span> <span class="n">dist</span><span class="o">-</span><span class="n">repo</span><span class="o">-</span><span class="n">status</span>
                        <span class="n">command</span><span class="o">.</span>  <span class="n">Only</span> <span class="n">applicable</span> <span class="k">with</span> <span class="n">dist</span><span class="o">-</span><span class="n">repo</span><span class="o">-</span><span class="n">status</span> <span class="p">(</span><span class="n">see</span>
                        <span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">help</span><span class="o">=</span><span class="n">dist</span><span class="o">-</span><span class="n">repo</span><span class="o">-</span><span class="n">status</span><span class="p">)</span><span class="o">.</span>
  <span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">utf8</span><span class="o">-</span><span class="n">output</span>    <span class="n">If</span> <span class="nb">set</span><span class="p">,</span> <span class="n">use</span> <span class="n">UTF</span><span class="o">-</span><span class="mi">8</span> <span class="n">box</span> <span class="n">drawing</span> <span class="n">characters</span> <span class="n">instead</span> <span class="n">of</span>
                        <span class="n">ASCII</span> <span class="n">ones</span> <span class="n">when</span> <span class="n">creating</span> <span class="n">the</span> <span class="n">repo</span> <span class="n">summary</span> <span class="n">table</span><span class="o">.</span>
  <span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">version</span><span class="o">-</span><span class="n">file</span><span class="o">=</span><span class="n">VERSIONFILE</span>
                        <span class="n">Path</span> <span class="n">to</span> <span class="n">a</span> <span class="n">file</span> <span class="n">which</span> <span class="n">contains</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">extra</span> <span class="n">repo</span>
                        <span class="n">relative</span> <span class="n">directories</span> <span class="ow">and</span> <span class="n">git</span> <span class="n">versions</span> <span class="p">(</span><span class="n">replaces</span>
                        <span class="n">_VERSION_</span><span class="p">)</span><span class="o">.</span> <span class="p">(</span><span class="n">See</span> <span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">help</span><span class="o">=</span><span class="n">repo</span><span class="o">-</span><span class="n">versions</span><span class="o">.</span><span class="p">)</span>
                        <span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
  <span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">version</span><span class="o">-</span><span class="n">file2</span><span class="o">=</span><span class="n">VERSIONFILE2</span>
                        <span class="n">Path</span> <span class="n">to</span> <span class="n">a</span> <span class="n">second</span> <span class="n">file</span> <span class="n">contains</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">extra</span> <span class="n">repo</span>
                        <span class="n">relative</span> <span class="n">directories</span> <span class="ow">and</span> <span class="n">git</span> <span class="n">versions</span> <span class="p">(</span><span class="n">replaces</span>
                        <span class="n">_VERSION2_</span><span class="p">)</span><span class="o">.</span> <span class="p">(</span><span class="n">See</span> <span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">help</span><span class="o">=</span><span class="n">repo</span><span class="o">-</span><span class="n">versions</span><span class="o">.</span><span class="p">)</span>
                        <span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
  <span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">no</span><span class="o">-</span><span class="n">color</span>       <span class="n">If</span> <span class="nb">set</span><span class="p">,</span> <span class="n">don</span><span class="s1">&#39;t use color in the output for gitdist</span>
                        <span class="p">(</span><span class="n">better</span> <span class="k">for</span> <span class="n">output</span> <span class="n">to</span> <span class="n">a</span> <span class="n">file</span><span class="p">)</span><span class="o">.</span>
  <span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">debug</span>          <span class="n">If</span> <span class="nb">set</span><span class="p">,</span> <span class="n">then</span> <span class="n">debugging</span> <span class="n">info</span> <span class="ow">is</span> <span class="n">printed</span><span class="o">.</span>
  <span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">no</span><span class="o">-</span><span class="n">opt</span>         <span class="n">If</span> <span class="nb">set</span><span class="p">,</span> <span class="n">then</span> <span class="n">no</span> <span class="n">git</span> <span class="n">commands</span> <span class="n">will</span> <span class="n">be</span> <span class="n">run</span> <span class="n">but</span> <span class="n">instead</span>
                        <span class="n">will</span> <span class="n">just</span> <span class="n">be</span> <span class="n">printed</span><span class="o">.</span>
  <span class="o">--</span><span class="n">dist</span><span class="o">-</span><span class="n">short</span>          <span class="n">If</span> <span class="nb">set</span><span class="p">,</span> <span class="n">then</span> <span class="n">the</span> <span class="n">repo</span> <span class="n">versions</span> <span class="n">table</span> <span class="n">will</span> <span class="n">only</span> <span class="n">include</span>
                        <span class="n">the</span> <span class="n">Repo</span> <span class="n">Dir</span> <span class="ow">and</span> <span class="n">SHA1</span> <span class="n">columns</span><span class="p">;</span> <span class="n">Commit</span> <span class="n">Date</span><span class="p">,</span> <span class="n">Author</span><span class="p">,</span>
                        <span class="ow">and</span> <span class="n">Summary</span> <span class="n">will</span> <span class="n">be</span> <span class="n">omitted</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="gitdist-dist-help-overview">
<h3><a class="toc-backref" href="#id277">gitdist –dist-help=overview</a><a class="headerlink" href="#gitdist-dist-help-overview" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
OVERVIEW:

Running:

  $ gitdist [gitdist options] &lt;raw-git-command&gt; [git arguments]

will distribute git commands specified by &#39;&lt;raw-git-command&gt; [git arguments]&#39;
across the current base git repo and the set of git repos listed in the file
./.gitdist (or the file ./.gitdist.default, or the argument
--dist-repos=&lt;repo0&gt;,&lt;repo1&gt;,..., see
--dist-help=repo-selection-and-setup).

For example, consider the following base git repo &#39;BaseRepo&#39; with three other
&quot;extra&quot; git repos cloned under it:

  BaseRepo/
    .git/
    .gitdist
    ExtraRepo1/
      .git/
      ExtraRepo2/
        .git/
    ExtraRepo3/
      .git/

The file .gitdist shown above is created by the user and in this example
should have the contents (note the base repo entry &#39;.&#39;):

  .
  ExtraRepo1
  ExtraRepo1/ExtraRepo2
  ExtraRepo3

For this example, running the command:

  $ cd BaseRepo/
  $ gitdist status

results in the following commands:

  $ git status
  $ cd ExtraRepo1/ ; git status ; ..
  $ cd ExtraRepo1/ExtraRepo2/ ; git status ; ../..
  $ cd ExtraRepo3/ ; git status ; ..

which produces output like:

  *** Base Git Repo: BaseRepo
  On branch master
  Your branch is up-to-date with &#39;origin/master&#39;.
  nothing to commit, working directory clean
  
  *** Git Repo: ExtraRepo1
  On branch master
  Your branch is up-to-date with &#39;origin/master&#39;.
  nothing to commit, working directory clean
  
  *** Git Repo: ExtraRepo1/ExtraRepo2
  On branch master
  Your branch is up-to-date with &#39;origin/master&#39;.
  nothing to commit, working directory clean
  
  *** Git Repo: ExtraRepo3
  On branch master
  Your branch is up-to-date with &#39;origin/master&#39;.
  nothing to commit, working directory clean

The gitdist tool allows managing a set of git repos like one big integrated
git repo.  For example, after cloning a set of git repos, one can perform
basic operations like for single git repos such as creating a new release
branch and pushing it with:

  $ gitdist checkout master
  $ gitdist pull
  $ gitdist tag -a -m &quot;Start of the 2.3 release&quot; release-2.3-start
  $ gitdist checkout -b release-2.3 release-2.3-start
  $ gitdist push origin release-2.3-start
  $ gitdist push origin -u release 2.3
  $ gitdist checkout master

The above gitdist commands create the same tag &#39;release-2.3-start&#39; and the
same branch &#39;release-2.3&#39; in all of the local git repos and pushes these to
the remote &#39;origin&#39; for each git repo.

For more information about a certain topic, use &#39;--dist-help=&lt;topic-name&gt;
[--help]&#39; for &lt;topic-name&gt;:

* &#39;overview&#39;
* &#39;repo-selection-and-setup&#39;
* &#39;dist-repo-status&#39;
* &#39;repo-versions&#39;
* &#39;dist-repo-versions-table&#39;
* &#39;aliases&#39;
* &#39;default-branch&#39;
* &#39;move-to-base-dir&#39;
* &#39;usage-tips&#39;
* &#39;script-dependencies&#39;

To see full help with all topics, use &#39;--dist-help=all [--help]&#39;.

This script is self-contained and has no dependencies other than standard
python 2.6+ packages so it can be copied to anywhere and used.

</pre></div>
</div>
</section>
<section id="gitdist-dist-help-repo-selection-and-setup">
<h3><a class="toc-backref" href="#id278">gitdist –dist-help=repo-selection-and-setup</a><a class="headerlink" href="#gitdist-dist-help-repo-selection-and-setup" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
REPO SELECTION AND SETUP:

Before using the gitdist tool, one must first add the gitdist script to one&#39;s
default path.  On bash, the simplest way to do this is to source the
gitdist-setup.py script:

  $ source &lt;some-base-dir&gt;/TriBITS/tribits/python_utils/gitdist-setup.sh

This will set an alias to the gitdist script in that same directory by
default, will set up useful alias &#39;gitdist-status&#39;, &#39;gitdist-mod&#39;, and
&#39;gitdist-mod-status&#39;, and &#39;gitdist-repo-versions&#39;, and will set up
command-line completion just like for raw git (assuming that
git-completion.bash has been sourced first).  The files &#39;gitdist&#39; and
&#39;gitdist-setup.sh&#39; can also be copied to another directory (e.g. ~/bin) and
then &#39;gitdist-setup.sh&#39; can be sourced from there (as a simple &quot;install&quot;):

  $ cp &lt;some-base-dir&gt;/TriBITS/tribits/python_utils/gitdist \
       &lt;some-base-dir&gt;/TriBITS/tribits/python_utils/gitdist-setup.sh \
      ~/bin/
  $ source ~/bin/gitdist-setup.sh
  $ export PATH=$HOME/bin:$PATH

This script can also be set up manually, for example, by copying the gitdist
script to one&#39;s ~/bin/ directory:

  $ cp &lt;some-base-dir&gt;/TriBITS/tribits/python_utils/gitdist ~/bin/
  $ chmod a+x ~/bin/gitdist

and then adding $HOME/bin to one&#39;s &#39;PATH&#39; env var with:

  $ export PATH=$HOME/bin:$PATH

(i.e. in one&#39;s ~/.bash_profile file).  Then, one will want to set up some
useful shell aliases like &#39;gitdist-status&#39;, &#39;gitdist-mod&#39;, and
&#39;gitdist-mod-status&#39; and &#39;gitdist-repo-versions&#39; (see --dist-help=aliases).

The set of git repos processed by gitdist is determined by the argument:

  --dist-repos=&lt;repo0&gt;,&lt;repo1&gt;,...

or the files .gitdist or .gitdist.default.  If --dist-repos=&quot;&quot;, then the list
of repos to process will be read from the file &#39;.gitdist&#39; in the current
directory.  If the file &#39;.gitdist&#39; does not exist, then the list of repos to
process will be read from the file &#39;.gitdist.default&#39; in the current
directory.  The format of this files &#39;.gitdist&#39; and &#39;.gitdist.default&#39; is to
have one repo relative directory per line, for example:

  $ cat .gitdist
  .
  ExtraRepo1
  ExtraRepo1/ExtraRepo2
  ExtraRepo3

where each line is the relative path under the base git repo (i.e. under
&#39;BaseRepo/&#39;).  The file .gitdist.default is meant to be committed to the base
git repo (i.e. &#39;BaseRepo&#39;) so that gitdist is ready to use right away after
the base repo and the extra repos are cloned.

If an extra repository directory (i.e. listed in
--dist-repos=&lt;repo0&gt;,&lt;repo1&gt;,..., .gitdist, or .gitdist.default) does
not exist, then it will be ignored by the script.  Therefore, be careful to
manually verify that the script recognizes the repositories that you list.
The best way to do that is to run &#39;gitdist-status&#39; and see which repos are
listed.

Certain git repos can also be selectively excluded using the option
&#39;--dist-not-repos=&lt;repox&gt;,&lt;repoy&gt;,...&#39;.

Setting up to use gitdist on a specific set of local git repos first requires
cloning and organizing the local git repo. For the example listed here, one
would clone the base repo &#39;BaseRepo&#39; and the three extra git repos, set up a
.gitdist file, and then add ignores for the extra cloned repos like:

  # A) Clone and organize the git repos
  $ git clone git@some.url:BaseRepo.git
  $ cd BaseRepo/
  $ git clone git@some.url:ExtraRepo1.git
  $ cd ExtraRepo1/
  $ git clone git@some.url:ExtraRepo2.git
  $ cd ..
  $ git clone git@some.url:ExtraRepo3.git

  # B) Create .gitdist
  $ echo .                      &gt; .gitdist
  $ echo ExtraRepo1             &gt;&gt; .gitdist
  $ echo ExtraRepo1/ExtraRepo2  &gt;&gt; .gitdist
  $ echo ExtraRepo3             &gt;&gt; .gitdist

  # C) Add ignores in base repo
  $ echo /ExtraRepo1/ &gt;&gt; .git/info/exclude
  $ echo /ExtraRepo3/ &gt;&gt; .git/info/exclude

  # D) Add ignore in nested extra repo
  $ echo /ExtraRepo2/ &gt;&gt; ExtraRepo1/.git/info/exclude

(Note that one may instead add the above ignores to the version-controlled
files BaseRepo/.gitignore and ExtraRepo1/.gitignore.)

This produces the local repo structure:

  BaseRepo/
    .git/
    .gitdist
    ExtraRepo1/
      .git/
      ExtraRepo2/
        .git/
    ExtraRepo3/
      .git/

After this setup, running:

  $ gitdist &lt;raw-git-command&gt; [git arguments]

in the &#39;BaseRepo/ &#39;directory will automatically distribute a given command
across the base repo &#39;BaseRepo/ and the extra repos ExtraRepo1/,
ExtraRepo1/ExtraRepo2/, and ExtraRepo3/, in that order.

To simplify the setup for the usage of gitdist for a given set of local git
repos, one may choose to instead create the file .gitdist.default in the base
repo (i.e. `BaseRepo/`&#39;) and add the ignores for the extra repos to the
.gitignore files and commit the files to the repo(s).  That way, one does not
have to manually do any extra setup for every new set of local clones of the
repos.  But if the file .gitdist is present, then it will override the file
.gitdist.default as described above (which allows customization of what git
repos are processed at any time).

</pre></div>
</div>
</section>
<section id="gitdist-dist-help-dist-repo-status">
<h3><a class="toc-backref" href="#id279">gitdist –dist-help=dist-repo-status</a><a class="headerlink" href="#gitdist-dist-help-dist-repo-status" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
SUMMARY OF REPO STATUS:

The script gitdist also supports the special command &#39;dist-repo-status&#39; which
prints a compact table showing the current status of all the repos (see alias
&#39;gitdist-status&#39; in --dist-help=aliases).  For the example set of repos shown
in OVERVIEW (see --dist-help=overview), running:

  $ gitdist dist-repo-status    # alias &#39;gitdist-status&#39;

outputs a table like:

  ----------------------------------------------------------------------
  | ID | Repo Dir              | Branch | Tracking Branch | C | M  | ? |
  |----|-----------------------|--------|-----------------|---|----|---|
  |  0 | BaseRepo (Base)       | dummy  |                 |   |    |   |
  |  1 | ExtraRepo1            | master | origin/master   | 1 |  2 |   |
  |  2 | ExtraRepo1/ExtraRepo2 | HEAD   |                 |   | 25 | 4 |
  |  3 | ExtraRepo3            | master | origin/master   |   |    |   |
  ----------------------------------------------------------------------

If the option --dist-legend is also passed in, the output will include:

Legend:
* ID: Repository ID, zero based (order git commands are run)
* Repo Dir: Relative to base repo (base repo shown first with &#39;(Base)&#39;)
* Branch: Current branch (or detached HEAD)
* Tracking Branch: Tracking branch (or empty if no tracking branch exists)
* C: Number local commits w.r.t. tracking branch (empty if zero or no TB)
* M: Number of tracked modified (uncommitted) files (empty if zero)
* ?: Number of untracked, non-ignored files (empty if zero)

One can also show the status of only changed repos with the command:

  $ gitdist dist-repo-status --dist-mod-only  # alias &#39;gitdist-mod-status&#39;

which produces a table like:

  ----------------------------------------------------------------------
  | ID | Repo Dir              | Branch | Tracking Branch | C | M  | ? |
  |----|-----------------------|--------|-----------------|---|----|---|
  |  1 | ExtraRepo1            | master | origin/master   | 1 |  2 |   |
  |  2 | ExtraRepo1/ExtraRepo2 | HEAD   |                 |   | 25 | 4 |
  ----------------------------------------------------------------------

(see the alias &#39;gitdist-mod-status&#39; in --dist-help=aliases).

Note that rows for the repos BaseRepo and ExtraRepo2 were left out but the
repo indexes for the remaining repos are preserved.  This allows one to
compactly show the status of the changed local repos even when there are many
local git repos by filtering out rows for repos that have no changes
w.r.t. their tracking branches.  This allows one to get the status on a few
repos with changes out of a large number of local repos (i.e. 10s and even
100s of local git repos).

</pre></div>
</div>
</section>
<section id="gitdist-dist-help-repo-versions">
<h3><a class="toc-backref" href="#id280">gitdist –dist-help=repo-versions</a><a class="headerlink" href="#gitdist-dist-help-repo-versions" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
REPO VERSION FILES:

The script gitdist also supports the options --dist-version-file=&lt;versionFile&gt;
and --dist-version-file2=&lt;versionFile2&gt; which are used to provide different
SHA1 versions for each local git repo.  Each of these version files is
expected to represent a compatible set of versions of the repos (e.g. in the
same style as .gitmodule files used by the &#39;git submodule&#39; command).

The format of these repo version files is shown in the following example:

  *** Base Git Repo: BaseRepo
  e102e27 [Mon Sep 23 11:34:59 2013 -0400] &lt;author0@someurl.com&gt;
  First summary message
  *** Git Repo: ExtraRepo1
  b894b9c [Fri Aug 30 09:55:07 2013 -0400] &lt;author1@someurl.com&gt;
  Second summary message
  *** Git Repo: ExtraRepo1/ExtraRepo2
  97cf1ac [Thu Dec 1 23:34:06 2011 -0500] &lt;author2@someurl.com&gt;
  Third summary message
  *** Git Repo: ExtraRepo3
  6facf33 [Fri May 6 15:28:35 2013 -0400] &lt;author3@someurl.com&gt;
  Fourth summary message

Each repository entry can have a summary message or not (i.e. use two or three
lines per repo in the file).  A compatible repo version file can be generated
with this script listing three lines per repo (e.g. as shown above) using (for
example):

  $ gitdist --dist-no-color log -1 --pretty=format:&quot;%h [%ad] &lt;%ae&gt;%n%s&quot; \
    | grep -v &quot;^$&quot; &amp;&gt; RepoVersion.txt

(which is defined as the alias &#39;gitdist-repo-versions&#39; in the file
&#39;gitdist-setup.sh&#39;) or two lines per repo using (for example):

  $ gitdist --dist-no-color log -1 --pretty=format:&quot;%h [%ad] &lt;%ae&gt;&quot; \
    | grep -v &quot;^$&quot; &amp;&gt; RepoVersion.txt

This allows checking out consistent versions of the set git repos, diffing two
consistent versions of the set of git repos, etc.

To checkout an older set of consistent versions of the set of repos
represented by the set of versions given in a file RepoVersion.&lt;date&gt;.txt,
use:

  $ gitdist fetch origin
  $ gitdist --dist-version-file=RepoVersion.&lt;date&gt;.txt checkout _VERSION_

The string &#39;_VERSION_&#39; is replaced with the SHA1 for each of the repos listed
in the file &#39;RepoVersion.&lt;date&gt;.txt&#39;.  (NOTE: this puts the repos into a
detached head state so one has to know what that means.)

To tag a set of repos using a consistent set of versions, use (for example):

  $ gitdist --dist-version-file=RepoVersion.&lt;date&gt;.txt \
      tag -a -m &quot;&lt;message&gt;&quot; &lt;some_tag&gt; _VERSION_

To create a branch off of a consistent set of versions, use (for example):

  $ gitdist --dist-version-file=RepoVersion.&lt;date&gt;.txt \
      checkout -b some-branch _VERSION_

To diff two sets of versions of the repos, use (for example):

  $ gitdist \
      --dist-version-file=RepoVersion.&lt;new-date&gt;.txt \
      --dist-version-file2=RepoVersion.&lt;old-date&gt;.txt \
      diff _VERSION_ ^_VERSION2_

Here, _VERSION_ is replaced by the SHA1s listed in the file
&#39;RepoVersion.&lt;new-date&gt;.txt&#39; and _VERSION2_ is replaced by the SHA1s listed in
&#39;RepoVersion.&lt;old-date&gt;.txt&#39;.

One can construct any git command taking one or two different repo version
arguments (SHA1s) using this approach (which covers a huge number of different
git operations).

Note that the set of git repos listed in the &#39;RepoVersion.txt&#39; file must be a
super-set of those processed by this script or an error will occur and the
script will abort (before running any git commands).  If there are additional
repos RepoX, RepoY, etc. not listed in the &#39;RepVersion&#39;.txt file, then one can
exclude them with:

  $ gitdist --dist-not-repos=RepoX,RepoY,... \
    --dist-version-file=RepoVersion.txt \
    &lt;raw-git-comand&gt; [git arguments]

</pre></div>
</div>
</section>
<section id="gitdist-dist-help-aliases">
<h3><a class="toc-backref" href="#id281">gitdist –dist-help=aliases</a><a class="headerlink" href="#gitdist-dist-help-aliases" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
USEFUL ALIASES:

A few very useful (bash) shell aliases and setup commands to use with gitdist
include:

  $ alias gitdist-status=&quot;gitdist dist-repo-status&quot;
  $ alias gitdist-mod=&quot;gitdist --dist-mod-only&quot;
  $ alias gitdist-mod-status=&quot;gitdist dist-repo-status --dist-mod-only&quot;
  $ alias gitdist-repo-versions=&quot;gitdist --dist-no-color log -1 \
    --pretty=format:\&quot;%h [%ad] &lt;%ae&gt;%n%s\&quot; | grep -v \&quot;^$\&quot;&quot;

These are added by sourcing the provided file &#39;gitdist-setup.sh&#39; (which should
be sourced in your ~/.bash_profile file.) which also adds some useful
commandline tab completions.

This avoids lots of extra typing as these gitdist arguments are used a lot.
For example, to see the compact status table of all your local git repos, do:

  $ gitdist-status

To just see a compact status table of only changed repos, do:

  $ gitdist-mod-status

To process only repos that have changes and see commits in these repos
w.r.t. their tracking branches, do (for example):

  $ gitdist-mod log --name-status HEAD ^@{u}

or

  $ gitdist-mod local-stat

(where &#39;local-stat&#39; is a useful git alias defined in the script
&#39;git-config-alias.sh&#39; which adds these to your ~/.gitconf file).

</pre></div>
</div>
</section>
<section id="gitdist-dist-help-default-branch">
<h3><a class="toc-backref" href="#id282">gitdist –dist-help=default-branch</a><a class="headerlink" href="#gitdist-dist-help-default-branch" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">DEFAULT</span> <span class="n">BRANCH</span> <span class="n">SPECIFICATION</span><span class="p">:</span>

<span class="n">When</span> <span class="n">using</span> <span class="nb">any</span> <span class="n">git</span> <span class="n">command</span> <span class="n">that</span> <span class="n">accepts</span> <span class="n">a</span> <span class="n">reference</span> <span class="p">(</span><span class="n">a</span> <span class="n">SHA1</span><span class="p">,</span> <span class="ow">or</span> <span class="n">branch</span> <span class="ow">or</span> <span class="n">tag</span>
<span class="n">name</span><span class="p">),</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">possible</span> <span class="n">to</span> <span class="n">use</span> <span class="n">_DEFAULT_BRANCH_</span> <span class="n">instead</span><span class="o">.</span>  <span class="n">For</span> <span class="n">instance</span><span class="p">,</span>

    <span class="n">gitdist</span> <span class="n">checkout</span> <span class="n">_DEFAULT_BRANCH_</span>

<span class="n">will</span> <span class="n">check</span> <span class="n">out</span> <span class="n">the</span> <span class="n">default</span> <span class="n">development</span> <span class="n">branch</span> <span class="ow">in</span> <span class="n">each</span> <span class="n">repository</span> <span class="n">being</span> <span class="n">managed</span>
<span class="n">by</span> <span class="n">gitdist</span><span class="o">.</span>  <span class="n">You</span> <span class="n">can</span> <span class="n">specify</span> <span class="n">the</span> <span class="n">default</span> <span class="n">branch</span> <span class="k">for</span> <span class="n">each</span> <span class="n">repository</span> <span class="ow">in</span> <span class="n">your</span>
<span class="o">.</span><span class="n">gitdist</span><span class="p">[</span><span class="o">.</span><span class="n">default</span><span class="p">]</span> <span class="n">file</span><span class="o">.</span>  <span class="n">For</span> <span class="n">instance</span><span class="p">,</span> <span class="k">if</span> <span class="n">your</span> <span class="o">.</span><span class="n">gitdist</span> <span class="n">file</span> <span class="n">contains</span>

    <span class="o">.</span> <span class="n">master</span>
    <span class="n">extraRepo1</span> <span class="n">develop</span>
    <span class="n">extraRepo2</span> <span class="n">app</span><span class="o">-</span><span class="n">devel</span>

<span class="n">then</span> <span class="n">the</span> <span class="n">command</span> <span class="n">above</span> <span class="n">would</span> <span class="n">check</span> <span class="n">out</span> <span class="s1">&#39;master&#39;</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">base</span> <span class="n">repo</span><span class="p">,</span> <span class="s1">&#39;develop&#39;</span> <span class="ow">in</span>
<span class="n">extraRepo1</span><span class="p">,</span> <span class="ow">and</span> <span class="s1">&#39;app-devel&#39;</span> <span class="ow">in</span> <span class="n">extraRepo2</span><span class="o">.</span>  <span class="n">This</span> <span class="n">makes</span> <span class="n">it</span> <span class="n">convenient</span> <span class="n">when</span>
<span class="n">working</span> <span class="k">with</span> <span class="n">multiple</span> <span class="n">repositories</span> <span class="n">that</span> <span class="n">have</span> <span class="n">different</span> <span class="n">names</span> <span class="k">for</span> <span class="n">their</span> <span class="n">main</span>
<span class="n">development</span> <span class="n">branches</span><span class="o">.</span>  <span class="n">For</span> <span class="n">instance</span><span class="p">,</span> <span class="n">you</span> <span class="n">can</span> <span class="n">do</span> <span class="n">a</span> <span class="n">topic</span> <span class="n">branch</span> <span class="n">workflow</span> <span class="n">like</span><span class="p">:</span>

    <span class="n">gitdist</span> <span class="n">checkout</span> <span class="n">_DEFAULT_BRANCH_</span>
    <span class="n">gitdist</span> <span class="n">pull</span>
    <span class="n">gitdist</span> <span class="n">checkout</span> <span class="o">-</span><span class="n">b</span> <span class="n">newFeatureBranch</span>
    <span class="o">&lt;</span><span class="n">create</span> <span class="n">some</span> <span class="n">commits</span><span class="o">&gt;</span>
    <span class="n">gitdist</span> <span class="n">fetch</span>
    <span class="n">gitdist</span> <span class="n">merge</span> <span class="n">origin</span><span class="o">/</span><span class="n">_DEFAULT_BRANCH_</span>
    <span class="o">&lt;</span><span class="n">create</span> <span class="n">some</span> <span class="n">commits</span><span class="o">&gt;</span>
    <span class="n">gitdist</span> <span class="n">checkout</span> <span class="n">_DEFAULT_BRANCH_</span>
    <span class="n">gitdist</span> <span class="n">pull</span>
    <span class="n">gitdist</span> <span class="n">merge</span> <span class="n">newFeatureBranch</span>

<span class="ow">and</span> <span class="ow">not</span> <span class="n">worry</span> <span class="n">about</span> <span class="n">this</span> <span class="s1">&#39;newFeatureBranch&#39;</span> <span class="n">being</span> <span class="n">off</span> <span class="n">of</span> <span class="s1">&#39;master&#39;</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">root</span>
<span class="n">repo</span><span class="p">,</span> <span class="n">off</span> <span class="n">of</span> <span class="s1">&#39;develop&#39;</span> <span class="ow">in</span> <span class="n">extraRepo1</span><span class="p">,</span> <span class="ow">and</span> <span class="n">off</span> <span class="n">of</span> <span class="s1">&#39;app-devel&#39;</span> <span class="ow">in</span> <span class="n">extraRepo2</span><span class="o">.</span>

<span class="n">If</span> <span class="n">no</span> <span class="n">branch</span> <span class="n">name</span> <span class="ow">is</span> <span class="n">specified</span> <span class="k">for</span> <span class="nb">any</span> <span class="n">given</span> <span class="n">repository</span> <span class="ow">in</span> <span class="n">the</span>
<span class="o">.</span><span class="n">gitdist</span><span class="p">[</span><span class="o">.</span><span class="n">default</span><span class="p">]</span> <span class="n">file</span><span class="p">,</span> <span class="n">then</span> <span class="s1">&#39;master&#39;</span> <span class="ow">is</span> <span class="n">assumed</span><span class="o">.</span>

</pre></div>
</div>
</section>
<section id="gitdist-dist-help-move-to-base-dir">
<h3><a class="toc-backref" href="#id283">gitdist –dist-help=move-to-base-dir</a><a class="headerlink" href="#gitdist-dist-help-move-to-base-dir" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">MOVE</span> <span class="n">TO</span> <span class="n">BASE</span> <span class="n">DIRECTORY</span><span class="p">:</span>

<span class="n">By</span> <span class="n">default</span><span class="p">,</span> <span class="n">when</span> <span class="n">you</span> <span class="n">run</span> <span class="n">gitdist</span><span class="p">,</span> <span class="n">it</span> <span class="n">will</span> <span class="n">look</span> <span class="ow">in</span> <span class="n">your</span> <span class="n">current</span> <span class="n">working</span>
<span class="n">directory</span> <span class="k">for</span> <span class="n">a</span> <span class="o">.</span><span class="n">gitdist</span><span class="p">[</span><span class="o">.</span><span class="n">default</span><span class="p">]</span> <span class="n">file</span><span class="o">.</span>  <span class="n">If</span> <span class="n">it</span> <span class="n">fails</span> <span class="n">to</span> <span class="n">find</span> <span class="n">one</span><span class="p">,</span> <span class="n">it</span> <span class="n">will</span>
<span class="n">treat</span> <span class="n">the</span> <span class="n">current</span> <span class="n">directory</span> <span class="k">as</span> <span class="n">the</span> <span class="n">base</span> <span class="n">git</span> <span class="n">repository</span> <span class="p">(</span><span class="k">as</span> <span class="k">if</span> <span class="n">there</span> <span class="n">was</span> <span class="n">a</span>
<span class="o">.</span><span class="n">gitdist</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">it</span><span class="p">,</span> <span class="n">having</span> <span class="n">a</span> <span class="n">single</span> <span class="n">line</span> <span class="k">with</span> <span class="n">only</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">it</span><span class="p">)</span> <span class="ow">and</span> <span class="n">then</span> <span class="n">run</span> <span class="k">as</span>
<span class="n">usual</span><span class="o">.</span>  <span class="n">You</span> <span class="n">have</span> <span class="n">the</span> <span class="n">ability</span> <span class="n">to</span> <span class="n">change</span> <span class="n">this</span> <span class="n">behavior</span> <span class="n">by</span> <span class="n">setting</span> <span class="n">the</span>
<span class="n">GITDIST_MOVE_TO_BASE_DIR</span> <span class="n">environment</span> <span class="n">variable</span><span class="o">.</span>

<span class="n">To</span> <span class="n">describe</span> <span class="n">the</span> <span class="n">behavior</span> <span class="k">for</span> <span class="n">the</span> <span class="n">differ</span> <span class="n">net</span> <span class="n">options</span><span class="p">,</span> <span class="n">consider</span> <span class="n">the</span> <span class="n">following</span> <span class="nb">set</span>
<span class="n">of</span> <span class="n">nested</span> <span class="n">git</span> <span class="n">repositories</span> <span class="ow">and</span> <span class="n">directories</span><span class="p">:</span>

    <span class="n">BaseRepo</span><span class="o">/</span>
      <span class="o">.</span><span class="n">git</span>
      <span class="o">.</span><span class="n">gitdist</span>
      <span class="o">...</span>
      <span class="n">ExtraRepo</span><span class="o">/</span>
        <span class="o">.</span><span class="n">git</span>
        <span class="o">.</span><span class="n">gitdist</span>
        <span class="o">...</span>
        <span class="n">path</span><span class="o">/</span>
          <span class="o">...</span>
          <span class="n">to</span><span class="o">/</span>
            <span class="o">...</span>
            <span class="n">some</span><span class="o">/</span>
              <span class="o">...</span>
              <span class="n">directory</span><span class="o">/</span>
                <span class="o">...</span>


<span class="n">The</span> <span class="n">valid</span> <span class="n">settings</span> <span class="k">for</span> <span class="n">GITDIST_MOVE_TO_BASE_DIR</span> <span class="n">include</span><span class="p">:</span>

  <span class="s2">&quot;&quot;</span> <span class="p">(</span><span class="n">Empty</span><span class="p">)</span>

    <span class="n">This</span> <span class="n">gives</span> <span class="n">the</span> <span class="n">default</span> <span class="n">behavior</span> <span class="n">where</span> <span class="n">gitdist</span> <span class="n">runs</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">current</span> <span class="n">working</span>
    <span class="n">directory</span><span class="o">.</span>

  <span class="n">IMMEDIATE_BASE</span>

    <span class="n">In</span> <span class="n">this</span> <span class="n">case</span><span class="p">,</span> <span class="n">gitdist</span> <span class="n">will</span> <span class="n">start</span> <span class="n">moving</span> <span class="n">up</span> <span class="n">the</span> <span class="n">directory</span> <span class="n">tree</span> <span class="n">until</span> <span class="n">it</span>
    <span class="n">finds</span> <span class="n">a</span> <span class="o">.</span><span class="n">gitdist</span><span class="p">[</span><span class="o">.</span><span class="n">default</span><span class="p">]</span> <span class="n">file</span><span class="p">,</span> <span class="ow">and</span> <span class="n">then</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">directory</span> <span class="n">where</span> <span class="n">it</span>
    <span class="n">finds</span> <span class="n">it</span><span class="o">.</span>  <span class="n">In</span> <span class="n">the</span> <span class="n">above</span> <span class="n">example</span><span class="p">,</span> <span class="k">if</span> <span class="n">you</span> <span class="n">are</span> <span class="ow">in</span>
    <span class="n">BaseRepo</span><span class="o">/</span><span class="n">ExtraRepo</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">some</span><span class="o">/</span><span class="n">directory</span><span class="o">/</span> <span class="n">when</span> <span class="n">you</span> <span class="n">run</span> <span class="n">gitdist</span><span class="p">,</span> <span class="n">it</span> <span class="n">will</span>
    <span class="n">move</span> <span class="n">up</span> <span class="n">to</span> <span class="n">ExtraRepo</span> <span class="n">to</span> <span class="n">execute</span> <span class="n">the</span> <span class="n">command</span> <span class="n">you</span> <span class="n">give</span> <span class="n">it</span> <span class="kn">from</span> <span class="nn">there.</span>

  <span class="n">EXTREME_BASE</span><span class="p">:</span>

    <span class="n">In</span> <span class="n">this</span> <span class="n">case</span><span class="p">,</span> <span class="n">gitdist</span> <span class="n">will</span> <span class="k">continue</span> <span class="n">moving</span> <span class="n">up</span> <span class="n">the</span> <span class="n">directory</span> <span class="n">tree</span> <span class="n">until</span> <span class="n">it</span>
    <span class="n">finds</span> <span class="n">the</span> <span class="n">outer</span><span class="o">-</span><span class="n">most</span> <span class="n">repository</span> <span class="n">containing</span> <span class="n">a</span> <span class="o">.</span><span class="n">gitdist</span><span class="p">[</span><span class="o">.</span><span class="n">default</span><span class="p">]</span> <span class="n">file</span><span class="p">,</span> <span class="ow">and</span>
    <span class="n">then</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">that</span> <span class="n">directory</span><span class="o">.</span>  <span class="n">Given</span> <span class="n">the</span> <span class="n">directory</span> <span class="n">tree</span> <span class="n">above</span><span class="p">,</span> <span class="k">if</span> <span class="n">you</span> <span class="n">were</span>
    <span class="ow">in</span> <span class="n">BaseRepo</span><span class="o">/</span><span class="n">ExtraRepo</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">some</span><span class="o">/</span><span class="n">directory</span><span class="p">,</span> <span class="n">it</span> <span class="n">will</span> <span class="n">move</span> <span class="n">up</span> <span class="n">to</span> <span class="n">BaseRepo</span>
    <span class="n">to</span> <span class="n">execute</span> <span class="n">the</span> <span class="n">command</span> <span class="n">you</span> <span class="n">give</span> <span class="n">it</span><span class="o">.</span>

<span class="n">With</span> <span class="n">either</span> <span class="n">of</span> <span class="n">the</span> <span class="n">settings</span> <span class="n">above</span><span class="p">,</span> <span class="n">when</span> <span class="n">gitdist</span> <span class="ow">is</span> <span class="n">finished</span> <span class="n">running</span><span class="p">,</span> <span class="n">it</span> <span class="n">will</span>
<span class="n">leave</span> <span class="n">you</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">same</span> <span class="n">directory</span> <span class="n">you</span> <span class="n">were</span> <span class="ow">in</span> <span class="n">when</span> <span class="n">you</span> <span class="n">executed</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">the</span>
<span class="n">first</span> <span class="n">place</span><span class="o">.</span>  <span class="n">Additionally</span><span class="p">,</span> <span class="k">if</span> <span class="n">no</span> <span class="o">.</span><span class="n">gitdist</span><span class="p">[</span><span class="o">.</span><span class="n">default</span><span class="p">]</span> <span class="n">file</span> <span class="n">can</span> <span class="n">be</span> <span class="n">found</span><span class="p">,</span> <span class="n">gitdist</span>
<span class="n">will</span> <span class="n">execute</span> <span class="n">the</span> <span class="n">command</span> <span class="n">you</span> <span class="n">give</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">your</span> <span class="n">current</span> <span class="n">working</span> <span class="n">directory</span><span class="p">,</span> <span class="k">as</span> <span class="k">if</span>
<span class="n">GITDIST_MOVE_TO_BASE_DIR</span> <span class="n">hadn</span><span class="s1">&#39;t been set.</span>

</pre></div>
</div>
</section>
<section id="gitdist-dist-help-usage-tips">
<h3><a class="toc-backref" href="#id284">gitdist –dist-help=usage-tips</a><a class="headerlink" href="#gitdist-dist-help-usage-tips" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
USAGE TIPS:

Since gitdist allows treating a set of git repos as one big git repo, almost
any git workflow that is used for a single git repo can be used for a set of
repos using gitdist.  The main difference is that one will typically need to
create commits individually for each repo.  Also, pulls and pushes are no
longer atomic like is guaranteed for a single git repo.

In general, the mapping between the commands for a single-repo git workflow
using raw git vs. a multi-repo git workflow using gitdist (using the shell
aliases &#39;gitdist-status&#39;, &#39;gitdist-mod-status&#39;, and &#39;gitdist-mod&#39;; see
--dist-help=aliases) is given by:

  git pull                          =&gt;  gitdist pull
  git checkout -b &lt;branch&gt; [&lt;ref&gt;]  =&gt;  gitdist checkout -b &lt;branch&gt; [&lt;ref&gt;]
  git checkout &lt;branch&gt;             =&gt;  gitdist checkout &lt;branch&gt;
  git tag -a -m &quot;&lt;message&gt;&quot; &lt;tag&gt;   =&gt;  gitdist tag -a -m &quot;&lt;message&gt;&quot; &lt;tag&gt;
  git status                        =&gt;  gitdist-mod status  # status details
                                    =&gt;  gitdist-status      # table for all
                                    =&gt;  gitdist-mod-status  # table for mod.
  git commit                        =&gt;  gitdist-mod commit
  git log HEAD ^@{u}                =&gt;  gitdist-mod log HEAD ^@{u} 
  git push                          =&gt;  gitdist-mod push
  git push [-u] &lt;remote&gt; &lt;branch&gt;   =&gt;  gitdist push [-u] &lt;remote&gt; &lt;branch&gt;
  git push &lt;remote&gt; &lt;tag&gt;           =&gt;  gitdist push &lt;remote&gt; &lt;tag&gt;

NOTE: The usage of &#39;gitdist-mod&#39; can be replaced with just &#39;gitdist&#39; in all of
the above commands.  It is just that in these cases gitdist-mod produces more
compact output and avoids do-nothing commands for repos that have no changes
with respect to their tracking branch.  But when it doubt, just use raw
&#39;gitdist&#39; if you are not sure.

A typical development iteration of the centralized workflow using using
multiple git repos looks like the following:

1) Update the local branches from the remote tracking branches:

    $ cd BaseRepo/
    $ gitdist pull

2) Make local modifications for each repo:

    $ emacs &lt;base-files&gt;
    $ cd ExtraRepo1/
    $ emacs &lt;files-in-extra-repo1&gt;
    $ cd ..
    $ cd ExtraRepo1/ExtraRepo2/
    $ emacs &lt;files-in-extra-repo2&gt;
    $ cd ../..
    $ cd ExtraRepo3/
    $ emacs &lt;files-in-extra-repo3&gt;
    $ cd ..

3) Build and test local modifications:

    $ cd BUILD/
    $ make -j16
    $ make test  # hopefully all pass!
    $ cd ..

4) View the modifications before committing:

    $ gitdist-mod-status   # Produces a summary table
    $ gitdist-mod status   # See status details

5) Make commits to each repo:

    $ gitdist-mod commit -a  # Opens editor for each repo in order

  or use the same commit message for all repos:

    $ emacs commitmsg.txt
    $ echo /commitmsg.txt &gt;&gt; .git/info/exclude
    $ gitdist-mod commit -a -F $PWD/commitmsg.txt

  or manually create the commits in each repo separately with raw git:

    $ cd BaseRepo/
    $ git commit -a
    $ cd ExtraRepo1/
    $ git commit -a
    $ cd ..
    $ cd ExtraRepo1/ExtraRepo2/
    $ git commit -a
    $ cd ../..
    $ cd ExtraRepo3/
    $ git commit -a
    $ cd ..

6) Examine the local commits that are about to be pushed:

    $ gitdist-mod-status  # Should be no unmodified or untracked files!
    $ gitdist-mod log --name-status HEAD ^@{u}  # or ...
    $ gitdist-mod local-stat    # alias defined in &#39;git-config-alias.sh&#39;

7) Rebase and push local commits to remote tracking branch:

    $ gitdist pull --rebase
    $ gitdist-mod push
    $ gitdist-mod-status   # Make sure all the pushes occurred!

Another example workflow is creating a new release branch as shown in the
OVERVIEW section (--dist-help=overview).

Other usage tips:

 - &#39;gitdist --help&#39; will run gitdist help, not git help.  If you want raw git
   help, then run &#39;git --help&#39;.

 - Be sure to run &#39;gitdist-status&#39; to make sure that each repo is on the
   correct local branch and is tracking the correct remote branch.

 - In general, for most workflows, one should use the same local branch name,
   remote repo name, and remote tracking branch name in each local git repo.
   That allows commands like &#39;gitdist checkout --track &lt;remote&gt;/&lt;branch&gt;&#39; and
   &#39;gitdist checkout &lt;branch&gt;&#39; to work correctly.

 - For many git commands, it is better to process only repos that are changed
   w.r.t. their tracking branch with &#39;gitdist-mod &lt;raw-git-command&gt; [git
   arguments]&#39;.  For example, to see the status of only changed repos use
   &#39;gitdist-mod status&#39;.  This allows the usage of gitdist to scale well when
   there are even 100s of git repos.

 - As an exception to the last item, a few different types of git commands
   tend to be run on all the git repos like &#39;gitdist pull&#39;, &#39;gitdist
   checkout&#39;, and &#39;gitdist tag&#39;.

 - If one is not sure whether to run &#39;gitdist&#39; or &#39;gitdist-mod&#39;, then just
   run &#39;gitdist&#39; to be safe.

</pre></div>
</div>
</section>
<section id="gitdist-dist-help-script-dependencies">
<h3><a class="toc-backref" href="#id285">gitdist –dist-help=script-dependencies</a><a class="headerlink" href="#gitdist-dist-help-script-dependencies" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">SCRIPT</span> <span class="n">DEPENDENCIES</span><span class="p">:</span>

<span class="n">The</span> <span class="n">Python</span> <span class="n">script</span> <span class="n">gitdist</span> <span class="n">only</span> <span class="n">depends</span> <span class="n">on</span> <span class="n">the</span> <span class="n">Python</span> <span class="mf">2.6</span><span class="o">+</span> <span class="n">standard</span> <span class="n">modules</span>
<span class="s1">&#39;sys&#39;</span><span class="p">,</span> <span class="s1">&#39;os&#39;</span><span class="p">,</span> <span class="s1">&#39;subprocess&#39;</span><span class="p">,</span> <span class="ow">and</span> <span class="s1">&#39;re&#39;</span><span class="o">.</span> <span class="n">Also</span><span class="p">,</span> <span class="n">of</span> <span class="n">course</span><span class="p">,</span> <span class="n">it</span> <span class="n">requires</span> <span class="n">some</span>
<span class="n">compatible</span> <span class="n">version</span> <span class="n">of</span> <span class="s1">&#39;git&#39;</span> <span class="ow">in</span> <span class="n">your</span> <span class="n">path</span> <span class="p">(</span><span class="n">but</span> <span class="n">gitdist</span> <span class="n">works</span> <span class="k">with</span> <span class="n">several</span>
<span class="n">versions</span> <span class="n">of</span> <span class="n">git</span> <span class="n">starting</span> <span class="k">as</span> <span class="n">far</span> <span class="n">back</span> <span class="k">as</span> <span class="n">git</span> <span class="mf">1.6</span><span class="o">+</span><span class="p">)</span><span class="o">.</span>

</pre></div>
</div>
</section>
<section id="gitdist-dist-help-all">
<h3><a class="toc-backref" href="#id286">gitdist –dist-help=all</a><a class="headerlink" href="#gitdist-dist-help-all" title="Permalink to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
OVERVIEW:

Running:

  $ gitdist [gitdist options] &lt;raw-git-command&gt; [git arguments]

will distribute git commands specified by &#39;&lt;raw-git-command&gt; [git arguments]&#39;
across the current base git repo and the set of git repos listed in the file
./.gitdist (or the file ./.gitdist.default, or the argument
--dist-repos=&lt;repo0&gt;,&lt;repo1&gt;,..., see
--dist-help=repo-selection-and-setup).

For example, consider the following base git repo &#39;BaseRepo&#39; with three other
&quot;extra&quot; git repos cloned under it:

  BaseRepo/
    .git/
    .gitdist
    ExtraRepo1/
      .git/
      ExtraRepo2/
        .git/
    ExtraRepo3/
      .git/

The file .gitdist shown above is created by the user and in this example
should have the contents (note the base repo entry &#39;.&#39;):

  .
  ExtraRepo1
  ExtraRepo1/ExtraRepo2
  ExtraRepo3

For this example, running the command:

  $ cd BaseRepo/
  $ gitdist status

results in the following commands:

  $ git status
  $ cd ExtraRepo1/ ; git status ; ..
  $ cd ExtraRepo1/ExtraRepo2/ ; git status ; ../..
  $ cd ExtraRepo3/ ; git status ; ..

which produces output like:

  *** Base Git Repo: BaseRepo
  On branch master
  Your branch is up-to-date with &#39;origin/master&#39;.
  nothing to commit, working directory clean
  
  *** Git Repo: ExtraRepo1
  On branch master
  Your branch is up-to-date with &#39;origin/master&#39;.
  nothing to commit, working directory clean
  
  *** Git Repo: ExtraRepo1/ExtraRepo2
  On branch master
  Your branch is up-to-date with &#39;origin/master&#39;.
  nothing to commit, working directory clean
  
  *** Git Repo: ExtraRepo3
  On branch master
  Your branch is up-to-date with &#39;origin/master&#39;.
  nothing to commit, working directory clean

The gitdist tool allows managing a set of git repos like one big integrated
git repo.  For example, after cloning a set of git repos, one can perform
basic operations like for single git repos such as creating a new release
branch and pushing it with:

  $ gitdist checkout master
  $ gitdist pull
  $ gitdist tag -a -m &quot;Start of the 2.3 release&quot; release-2.3-start
  $ gitdist checkout -b release-2.3 release-2.3-start
  $ gitdist push origin release-2.3-start
  $ gitdist push origin -u release 2.3
  $ gitdist checkout master

The above gitdist commands create the same tag &#39;release-2.3-start&#39; and the
same branch &#39;release-2.3&#39; in all of the local git repos and pushes these to
the remote &#39;origin&#39; for each git repo.

For more information about a certain topic, use &#39;--dist-help=&lt;topic-name&gt;
[--help]&#39; for &lt;topic-name&gt;:

* &#39;overview&#39;
* &#39;repo-selection-and-setup&#39;
* &#39;dist-repo-status&#39;
* &#39;repo-versions&#39;
* &#39;dist-repo-versions-table&#39;
* &#39;aliases&#39;
* &#39;default-branch&#39;
* &#39;move-to-base-dir&#39;
* &#39;usage-tips&#39;
* &#39;script-dependencies&#39;

To see full help with all topics, use &#39;--dist-help=all [--help]&#39;.

This script is self-contained and has no dependencies other than standard
python 2.6+ packages so it can be copied to anywhere and used.

REPO SELECTION AND SETUP:

Before using the gitdist tool, one must first add the gitdist script to one&#39;s
default path.  On bash, the simplest way to do this is to source the
gitdist-setup.py script:

  $ source &lt;some-base-dir&gt;/TriBITS/tribits/python_utils/gitdist-setup.sh

This will set an alias to the gitdist script in that same directory by
default, will set up useful alias &#39;gitdist-status&#39;, &#39;gitdist-mod&#39;, and
&#39;gitdist-mod-status&#39;, and &#39;gitdist-repo-versions&#39;, and will set up
command-line completion just like for raw git (assuming that
git-completion.bash has been sourced first).  The files &#39;gitdist&#39; and
&#39;gitdist-setup.sh&#39; can also be copied to another directory (e.g. ~/bin) and
then &#39;gitdist-setup.sh&#39; can be sourced from there (as a simple &quot;install&quot;):

  $ cp &lt;some-base-dir&gt;/TriBITS/tribits/python_utils/gitdist \
       &lt;some-base-dir&gt;/TriBITS/tribits/python_utils/gitdist-setup.sh \
      ~/bin/
  $ source ~/bin/gitdist-setup.sh
  $ export PATH=$HOME/bin:$PATH

This script can also be set up manually, for example, by copying the gitdist
script to one&#39;s ~/bin/ directory:

  $ cp &lt;some-base-dir&gt;/TriBITS/tribits/python_utils/gitdist ~/bin/
  $ chmod a+x ~/bin/gitdist

and then adding $HOME/bin to one&#39;s &#39;PATH&#39; env var with:

  $ export PATH=$HOME/bin:$PATH

(i.e. in one&#39;s ~/.bash_profile file).  Then, one will want to set up some
useful shell aliases like &#39;gitdist-status&#39;, &#39;gitdist-mod&#39;, and
&#39;gitdist-mod-status&#39; and &#39;gitdist-repo-versions&#39; (see --dist-help=aliases).

The set of git repos processed by gitdist is determined by the argument:

  --dist-repos=&lt;repo0&gt;,&lt;repo1&gt;,...

or the files .gitdist or .gitdist.default.  If --dist-repos=&quot;&quot;, then the list
of repos to process will be read from the file &#39;.gitdist&#39; in the current
directory.  If the file &#39;.gitdist&#39; does not exist, then the list of repos to
process will be read from the file &#39;.gitdist.default&#39; in the current
directory.  The format of this files &#39;.gitdist&#39; and &#39;.gitdist.default&#39; is to
have one repo relative directory per line, for example:

  $ cat .gitdist
  .
  ExtraRepo1
  ExtraRepo1/ExtraRepo2
  ExtraRepo3

where each line is the relative path under the base git repo (i.e. under
&#39;BaseRepo/&#39;).  The file .gitdist.default is meant to be committed to the base
git repo (i.e. &#39;BaseRepo&#39;) so that gitdist is ready to use right away after
the base repo and the extra repos are cloned.

If an extra repository directory (i.e. listed in
--dist-repos=&lt;repo0&gt;,&lt;repo1&gt;,..., .gitdist, or .gitdist.default) does
not exist, then it will be ignored by the script.  Therefore, be careful to
manually verify that the script recognizes the repositories that you list.
The best way to do that is to run &#39;gitdist-status&#39; and see which repos are
listed.

Certain git repos can also be selectively excluded using the option
&#39;--dist-not-repos=&lt;repox&gt;,&lt;repoy&gt;,...&#39;.

Setting up to use gitdist on a specific set of local git repos first requires
cloning and organizing the local git repo. For the example listed here, one
would clone the base repo &#39;BaseRepo&#39; and the three extra git repos, set up a
.gitdist file, and then add ignores for the extra cloned repos like:

  # A) Clone and organize the git repos
  $ git clone git@some.url:BaseRepo.git
  $ cd BaseRepo/
  $ git clone git@some.url:ExtraRepo1.git
  $ cd ExtraRepo1/
  $ git clone git@some.url:ExtraRepo2.git
  $ cd ..
  $ git clone git@some.url:ExtraRepo3.git

  # B) Create .gitdist
  $ echo .                      &gt; .gitdist
  $ echo ExtraRepo1             &gt;&gt; .gitdist
  $ echo ExtraRepo1/ExtraRepo2  &gt;&gt; .gitdist
  $ echo ExtraRepo3             &gt;&gt; .gitdist

  # C) Add ignores in base repo
  $ echo /ExtraRepo1/ &gt;&gt; .git/info/exclude
  $ echo /ExtraRepo3/ &gt;&gt; .git/info/exclude

  # D) Add ignore in nested extra repo
  $ echo /ExtraRepo2/ &gt;&gt; ExtraRepo1/.git/info/exclude

(Note that one may instead add the above ignores to the version-controlled
files BaseRepo/.gitignore and ExtraRepo1/.gitignore.)

This produces the local repo structure:

  BaseRepo/
    .git/
    .gitdist
    ExtraRepo1/
      .git/
      ExtraRepo2/
        .git/
    ExtraRepo3/
      .git/

After this setup, running:

  $ gitdist &lt;raw-git-command&gt; [git arguments]

in the &#39;BaseRepo/ &#39;directory will automatically distribute a given command
across the base repo &#39;BaseRepo/ and the extra repos ExtraRepo1/,
ExtraRepo1/ExtraRepo2/, and ExtraRepo3/, in that order.

To simplify the setup for the usage of gitdist for a given set of local git
repos, one may choose to instead create the file .gitdist.default in the base
repo (i.e. `BaseRepo/`&#39;) and add the ignores for the extra repos to the
.gitignore files and commit the files to the repo(s).  That way, one does not
have to manually do any extra setup for every new set of local clones of the
repos.  But if the file .gitdist is present, then it will override the file
.gitdist.default as described above (which allows customization of what git
repos are processed at any time).

SUMMARY OF REPO STATUS:

The script gitdist also supports the special command &#39;dist-repo-status&#39; which
prints a compact table showing the current status of all the repos (see alias
&#39;gitdist-status&#39; in --dist-help=aliases).  For the example set of repos shown
in OVERVIEW (see --dist-help=overview), running:

  $ gitdist dist-repo-status    # alias &#39;gitdist-status&#39;

outputs a table like:

  ----------------------------------------------------------------------
  | ID | Repo Dir              | Branch | Tracking Branch | C | M  | ? |
  |----|-----------------------|--------|-----------------|---|----|---|
  |  0 | BaseRepo (Base)       | dummy  |                 |   |    |   |
  |  1 | ExtraRepo1            | master | origin/master   | 1 |  2 |   |
  |  2 | ExtraRepo1/ExtraRepo2 | HEAD   |                 |   | 25 | 4 |
  |  3 | ExtraRepo3            | master | origin/master   |   |    |   |
  ----------------------------------------------------------------------

If the option --dist-legend is also passed in, the output will include:

Legend:
* ID: Repository ID, zero based (order git commands are run)
* Repo Dir: Relative to base repo (base repo shown first with &#39;(Base)&#39;)
* Branch: Current branch (or detached HEAD)
* Tracking Branch: Tracking branch (or empty if no tracking branch exists)
* C: Number local commits w.r.t. tracking branch (empty if zero or no TB)
* M: Number of tracked modified (uncommitted) files (empty if zero)
* ?: Number of untracked, non-ignored files (empty if zero)

One can also show the status of only changed repos with the command:

  $ gitdist dist-repo-status --dist-mod-only  # alias &#39;gitdist-mod-status&#39;

which produces a table like:

  ----------------------------------------------------------------------
  | ID | Repo Dir              | Branch | Tracking Branch | C | M  | ? |
  |----|-----------------------|--------|-----------------|---|----|---|
  |  1 | ExtraRepo1            | master | origin/master   | 1 |  2 |   |
  |  2 | ExtraRepo1/ExtraRepo2 | HEAD   |                 |   | 25 | 4 |
  ----------------------------------------------------------------------

(see the alias &#39;gitdist-mod-status&#39; in --dist-help=aliases).

Note that rows for the repos BaseRepo and ExtraRepo2 were left out but the
repo indexes for the remaining repos are preserved.  This allows one to
compactly show the status of the changed local repos even when there are many
local git repos by filtering out rows for repos that have no changes
w.r.t. their tracking branches.  This allows one to get the status on a few
repos with changes out of a large number of local repos (i.e. 10s and even
100s of local git repos).

REPO VERSION FILES:

The script gitdist also supports the options --dist-version-file=&lt;versionFile&gt;
and --dist-version-file2=&lt;versionFile2&gt; which are used to provide different
SHA1 versions for each local git repo.  Each of these version files is
expected to represent a compatible set of versions of the repos (e.g. in the
same style as .gitmodule files used by the &#39;git submodule&#39; command).

The format of these repo version files is shown in the following example:

  *** Base Git Repo: BaseRepo
  e102e27 [Mon Sep 23 11:34:59 2013 -0400] &lt;author0@someurl.com&gt;
  First summary message
  *** Git Repo: ExtraRepo1
  b894b9c [Fri Aug 30 09:55:07 2013 -0400] &lt;author1@someurl.com&gt;
  Second summary message
  *** Git Repo: ExtraRepo1/ExtraRepo2
  97cf1ac [Thu Dec 1 23:34:06 2011 -0500] &lt;author2@someurl.com&gt;
  Third summary message
  *** Git Repo: ExtraRepo3
  6facf33 [Fri May 6 15:28:35 2013 -0400] &lt;author3@someurl.com&gt;
  Fourth summary message

Each repository entry can have a summary message or not (i.e. use two or three
lines per repo in the file).  A compatible repo version file can be generated
with this script listing three lines per repo (e.g. as shown above) using (for
example):

  $ gitdist --dist-no-color log -1 --pretty=format:&quot;%h [%ad] &lt;%ae&gt;%n%s&quot; \
    | grep -v &quot;^$&quot; &amp;&gt; RepoVersion.txt

(which is defined as the alias &#39;gitdist-repo-versions&#39; in the file
&#39;gitdist-setup.sh&#39;) or two lines per repo using (for example):

  $ gitdist --dist-no-color log -1 --pretty=format:&quot;%h [%ad] &lt;%ae&gt;&quot; \
    | grep -v &quot;^$&quot; &amp;&gt; RepoVersion.txt

This allows checking out consistent versions of the set git repos, diffing two
consistent versions of the set of git repos, etc.

To checkout an older set of consistent versions of the set of repos
represented by the set of versions given in a file RepoVersion.&lt;date&gt;.txt,
use:

  $ gitdist fetch origin
  $ gitdist --dist-version-file=RepoVersion.&lt;date&gt;.txt checkout _VERSION_

The string &#39;_VERSION_&#39; is replaced with the SHA1 for each of the repos listed
in the file &#39;RepoVersion.&lt;date&gt;.txt&#39;.  (NOTE: this puts the repos into a
detached head state so one has to know what that means.)

To tag a set of repos using a consistent set of versions, use (for example):

  $ gitdist --dist-version-file=RepoVersion.&lt;date&gt;.txt \
      tag -a -m &quot;&lt;message&gt;&quot; &lt;some_tag&gt; _VERSION_

To create a branch off of a consistent set of versions, use (for example):

  $ gitdist --dist-version-file=RepoVersion.&lt;date&gt;.txt \
      checkout -b some-branch _VERSION_

To diff two sets of versions of the repos, use (for example):

  $ gitdist \
      --dist-version-file=RepoVersion.&lt;new-date&gt;.txt \
      --dist-version-file2=RepoVersion.&lt;old-date&gt;.txt \
      diff _VERSION_ ^_VERSION2_

Here, _VERSION_ is replaced by the SHA1s listed in the file
&#39;RepoVersion.&lt;new-date&gt;.txt&#39; and _VERSION2_ is replaced by the SHA1s listed in
&#39;RepoVersion.&lt;old-date&gt;.txt&#39;.

One can construct any git command taking one or two different repo version
arguments (SHA1s) using this approach (which covers a huge number of different
git operations).

Note that the set of git repos listed in the &#39;RepoVersion.txt&#39; file must be a
super-set of those processed by this script or an error will occur and the
script will abort (before running any git commands).  If there are additional
repos RepoX, RepoY, etc. not listed in the &#39;RepVersion&#39;.txt file, then one can
exclude them with:

  $ gitdist --dist-not-repos=RepoX,RepoY,... \
    --dist-version-file=RepoVersion.txt \
    &lt;raw-git-comand&gt; [git arguments]

REPO VERSION TABLE:

The script gitdist also supports the special command
&#39;dist-repo-versions-table&#39;, which prints a Markdown-formatted table of
repositories and corresponding commit information for easy inclusion in an
issue tracking system.  For instance, running:

  $ gitdist dist-repo-versions-table

outputs a table like:

  | Repository     | SHA1    | Commit Date         | Author                 | Summary                                        |
  |:-------------- |:-------:|:------------------- |:---------------------- |:---------------------------------------------- |
  | MockProjectDir | e2dc488 | 2019-10-23 10:16:07 | user@domain.com        | Merge Pull Request #1234 from user/repo/branch |
  | ExtraRepo1     | f671414 | 2019-10-22 11:18:47 | wile.e.coyote@acme.com | Fixed a Bug                                    |
  | ExtraRepo2     | 50bbf3e | 2019-10-17 16:32:15 | someone@somwhere.com   | Did Some Work                                  |

If the option --dist-short is also passed in, the output will be limited to:

  | Repository     | SHA1    |
  |:-------------- |:-------:|
  | MockProjectDir | e2dc488 |
  | ExtraRepo1     | f671414 |
  | ExtraRepo2     | 50bbf3e |

USEFUL ALIASES:

A few very useful (bash) shell aliases and setup commands to use with gitdist
include:

  $ alias gitdist-status=&quot;gitdist dist-repo-status&quot;
  $ alias gitdist-mod=&quot;gitdist --dist-mod-only&quot;
  $ alias gitdist-mod-status=&quot;gitdist dist-repo-status --dist-mod-only&quot;
  $ alias gitdist-repo-versions=&quot;gitdist --dist-no-color log -1 \
    --pretty=format:\&quot;%h [%ad] &lt;%ae&gt;%n%s\&quot; | grep -v \&quot;^$\&quot;&quot;

These are added by sourcing the provided file &#39;gitdist-setup.sh&#39; (which should
be sourced in your ~/.bash_profile file.) which also adds some useful
commandline tab completions.

This avoids lots of extra typing as these gitdist arguments are used a lot.
For example, to see the compact status table of all your local git repos, do:

  $ gitdist-status

To just see a compact status table of only changed repos, do:

  $ gitdist-mod-status

To process only repos that have changes and see commits in these repos
w.r.t. their tracking branches, do (for example):

  $ gitdist-mod log --name-status HEAD ^@{u}

or

  $ gitdist-mod local-stat

(where &#39;local-stat&#39; is a useful git alias defined in the script
&#39;git-config-alias.sh&#39; which adds these to your ~/.gitconf file).

DEFAULT BRANCH SPECIFICATION:

When using any git command that accepts a reference (a SHA1, or branch or tag
name), it is possible to use _DEFAULT_BRANCH_ instead.  For instance,

    gitdist checkout _DEFAULT_BRANCH_

will check out the default development branch in each repository being managed
by gitdist.  You can specify the default branch for each repository in your
.gitdist[.default] file.  For instance, if your .gitdist file contains

    . master
    extraRepo1 develop
    extraRepo2 app-devel

then the command above would check out &#39;master&#39; in the base repo, &#39;develop&#39; in
extraRepo1, and &#39;app-devel&#39; in extraRepo2.  This makes it convenient when
working with multiple repositories that have different names for their main
development branches.  For instance, you can do a topic branch workflow like:

    gitdist checkout _DEFAULT_BRANCH_
    gitdist pull
    gitdist checkout -b newFeatureBranch
    &lt;create some commits&gt;
    gitdist fetch
    gitdist merge origin/_DEFAULT_BRANCH_
    &lt;create some commits&gt;
    gitdist checkout _DEFAULT_BRANCH_
    gitdist pull
    gitdist merge newFeatureBranch

and not worry about this &#39;newFeatureBranch&#39; being off of &#39;master&#39; in the root
repo, off of &#39;develop&#39; in extraRepo1, and off of &#39;app-devel&#39; in extraRepo2.

If no branch name is specified for any given repository in the
.gitdist[.default] file, then &#39;master&#39; is assumed.

MOVE TO BASE DIRECTORY:

By default, when you run gitdist, it will look in your current working
directory for a .gitdist[.default] file.  If it fails to find one, it will
treat the current directory as the base git repository (as if there was a
.gitdist file in it, having a single line with only &quot;.&quot; in it) and then run as
usual.  You have the ability to change this behavior by setting the
GITDIST_MOVE_TO_BASE_DIR environment variable.

To describe the behavior for the differ net options, consider the following set
of nested git repositories and directories:

    BaseRepo/
      .git
      .gitdist
      ...
      ExtraRepo/
        .git
        .gitdist
        ...
        path/
          ...
          to/
            ...
            some/
              ...
              directory/
                ...


The valid settings for GITDIST_MOVE_TO_BASE_DIR include:

  &quot;&quot; (Empty)

    This gives the default behavior where gitdist runs in the current working
    directory.

  IMMEDIATE_BASE

    In this case, gitdist will start moving up the directory tree until it
    finds a .gitdist[.default] file, and then run in the directory where it
    finds it.  In the above example, if you are in
    BaseRepo/ExtraRepo/path/to/some/directory/ when you run gitdist, it will
    move up to ExtraRepo to execute the command you give it from there.

  EXTREME_BASE:

    In this case, gitdist will continue moving up the directory tree until it
    finds the outer-most repository containing a .gitdist[.default] file, and
    then run in that directory.  Given the directory tree above, if you were
    in BaseRepo/ExtraRepo/path/to/some/directory, it will move up to BaseRepo
    to execute the command you give it.

With either of the settings above, when gitdist is finished running, it will
leave you in the same directory you were in when you executed command in the
first place.  Additionally, if no .gitdist[.default] file can be found, gitdist
will execute the command you give it in your current working directory, as if
GITDIST_MOVE_TO_BASE_DIR hadn&#39;t been set.

USAGE TIPS:

Since gitdist allows treating a set of git repos as one big git repo, almost
any git workflow that is used for a single git repo can be used for a set of
repos using gitdist.  The main difference is that one will typically need to
create commits individually for each repo.  Also, pulls and pushes are no
longer atomic like is guaranteed for a single git repo.

In general, the mapping between the commands for a single-repo git workflow
using raw git vs. a multi-repo git workflow using gitdist (using the shell
aliases &#39;gitdist-status&#39;, &#39;gitdist-mod-status&#39;, and &#39;gitdist-mod&#39;; see
--dist-help=aliases) is given by:

  git pull                          =&gt;  gitdist pull
  git checkout -b &lt;branch&gt; [&lt;ref&gt;]  =&gt;  gitdist checkout -b &lt;branch&gt; [&lt;ref&gt;]
  git checkout &lt;branch&gt;             =&gt;  gitdist checkout &lt;branch&gt;
  git tag -a -m &quot;&lt;message&gt;&quot; &lt;tag&gt;   =&gt;  gitdist tag -a -m &quot;&lt;message&gt;&quot; &lt;tag&gt;
  git status                        =&gt;  gitdist-mod status  # status details
                                    =&gt;  gitdist-status      # table for all
                                    =&gt;  gitdist-mod-status  # table for mod.
  git commit                        =&gt;  gitdist-mod commit
  git log HEAD ^@{u}                =&gt;  gitdist-mod log HEAD ^@{u} 
  git push                          =&gt;  gitdist-mod push
  git push [-u] &lt;remote&gt; &lt;branch&gt;   =&gt;  gitdist push [-u] &lt;remote&gt; &lt;branch&gt;
  git push &lt;remote&gt; &lt;tag&gt;           =&gt;  gitdist push &lt;remote&gt; &lt;tag&gt;

NOTE: The usage of &#39;gitdist-mod&#39; can be replaced with just &#39;gitdist&#39; in all of
the above commands.  It is just that in these cases gitdist-mod produces more
compact output and avoids do-nothing commands for repos that have no changes
with respect to their tracking branch.  But when it doubt, just use raw
&#39;gitdist&#39; if you are not sure.

A typical development iteration of the centralized workflow using using
multiple git repos looks like the following:

1) Update the local branches from the remote tracking branches:

    $ cd BaseRepo/
    $ gitdist pull

2) Make local modifications for each repo:

    $ emacs &lt;base-files&gt;
    $ cd ExtraRepo1/
    $ emacs &lt;files-in-extra-repo1&gt;
    $ cd ..
    $ cd ExtraRepo1/ExtraRepo2/
    $ emacs &lt;files-in-extra-repo2&gt;
    $ cd ../..
    $ cd ExtraRepo3/
    $ emacs &lt;files-in-extra-repo3&gt;
    $ cd ..

3) Build and test local modifications:

    $ cd BUILD/
    $ make -j16
    $ make test  # hopefully all pass!
    $ cd ..

4) View the modifications before committing:

    $ gitdist-mod-status   # Produces a summary table
    $ gitdist-mod status   # See status details

5) Make commits to each repo:

    $ gitdist-mod commit -a  # Opens editor for each repo in order

  or use the same commit message for all repos:

    $ emacs commitmsg.txt
    $ echo /commitmsg.txt &gt;&gt; .git/info/exclude
    $ gitdist-mod commit -a -F $PWD/commitmsg.txt

  or manually create the commits in each repo separately with raw git:

    $ cd BaseRepo/
    $ git commit -a
    $ cd ExtraRepo1/
    $ git commit -a
    $ cd ..
    $ cd ExtraRepo1/ExtraRepo2/
    $ git commit -a
    $ cd ../..
    $ cd ExtraRepo3/
    $ git commit -a
    $ cd ..

6) Examine the local commits that are about to be pushed:

    $ gitdist-mod-status  # Should be no unmodified or untracked files!
    $ gitdist-mod log --name-status HEAD ^@{u}  # or ...
    $ gitdist-mod local-stat    # alias defined in &#39;git-config-alias.sh&#39;

7) Rebase and push local commits to remote tracking branch:

    $ gitdist pull --rebase
    $ gitdist-mod push
    $ gitdist-mod-status   # Make sure all the pushes occurred!

Another example workflow is creating a new release branch as shown in the
OVERVIEW section (--dist-help=overview).

Other usage tips:

 - &#39;gitdist --help&#39; will run gitdist help, not git help.  If you want raw git
   help, then run &#39;git --help&#39;.

 - Be sure to run &#39;gitdist-status&#39; to make sure that each repo is on the
   correct local branch and is tracking the correct remote branch.

 - In general, for most workflows, one should use the same local branch name,
   remote repo name, and remote tracking branch name in each local git repo.
   That allows commands like &#39;gitdist checkout --track &lt;remote&gt;/&lt;branch&gt;&#39; and
   &#39;gitdist checkout &lt;branch&gt;&#39; to work correctly.

 - For many git commands, it is better to process only repos that are changed
   w.r.t. their tracking branch with &#39;gitdist-mod &lt;raw-git-command&gt; [git
   arguments]&#39;.  For example, to see the status of only changed repos use
   &#39;gitdist-mod status&#39;.  This allows the usage of gitdist to scale well when
   there are even 100s of git repos.

 - As an exception to the last item, a few different types of git commands
   tend to be run on all the git repos like &#39;gitdist pull&#39;, &#39;gitdist
   checkout&#39;, and &#39;gitdist tag&#39;.

 - If one is not sure whether to run &#39;gitdist&#39; or &#39;gitdist-mod&#39;, then just
   run &#39;gitdist&#39; to be safe.

SCRIPT DEPENDENCIES:

The Python script gitdist only depends on the Python 2.6+ standard modules
&#39;sys&#39;, &#39;os&#39;, &#39;subprocess&#39;, and &#39;re&#39;. Also, of course, it requires some
compatible version of &#39;git&#39; in your path (but gitdist works with several
versions of git starting as far back as git 1.6+).

</pre></div>
</div>
</section>
</section>
<section id="snapshot-dir-py-help">
<span id="snapshot-dir-py"></span><h2><a class="toc-backref" href="#id287"><span class="sectnum">15.6</span> snapshot-dir.py –help</a><a class="headerlink" href="#snapshot-dir-py-help" title="Permalink to this heading"></a></h2>
<p>Below is a snapshot of the output from <code class="docutils literal notranslate"><span class="pre">snapshot-dir.py</span> <span class="pre">--help</span></code>.  For more
details on the usage of <code class="docutils literal notranslate"><span class="pre">snapshot-dir.py</span></code>, specifically for snapshotting the
<a class="reference internal" href="#projectdir-cmake-tribits">&lt;projectDir&gt;/cmake/tribits/</a> directory, see <a class="reference internal" href="#tribits-directory-snapshotting">TriBITS directory
snapshotting</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>usage: snapshot-dir.py [-h] [--show-defaults] [--orig-dir ORIGDIR]
                       [--dest-dir DESTDIR] [--exclude [EXCLUDE ...]]
                       [--assert-clean-orig-dir] [--allow-dirty-orig-dir]
                       [--assert-clean-dest-dir] [--allow-dirty-dest-dir]
                       [--clean-ignored-files-orig-dir]
                       [--no-clean-ignored-files-orig-dir] [--do-commit]
                       [--skip-commit] [--verify-commit] [--no-verify-commit]
                       [--no-op]

This tool uses rsync and some git commands to snapshot the contents of an
origin directory (&#39;orig-dir&#39;) in one Git repo to destination directory
(&#39;dest-dir&#39;) in another Git repo and logs version information in a new Git
commit message.

WARNING: Because this tool uses &#39;rsync --delete&#39;, it can be quite destructive
to the contents of dest-dir if one is not careful and selects the wrong
orig-dir or wrong dest-dir!  Therefore, please carefully read this entire help
message and especially the warnings given below and always start by running
with --no-op!

To sync between any two arbitrary directories between two different git repos
invoking this script from any directory location, one can do:

  $ &lt;some-base-dir&gt;/snapshot-dir.py \
    --orig-dir=&lt;dest-dir&gt; \
    --dest-dir=&lt;dest-dir&gt; \
    [--no-op]

(where --no-op should be used on the initial trial run to check that the
correct rsync and other commands will be run, see below).

To describe how this script is used, consider the desire to snapshot the
directory tree from one git repo:

  &lt;some-orig-base-dir&gt;/orig-dir/

and exactly duplicate it in another git repo under:

  &lt;some-dest-base-dir&gt;/dest-dir/

Here, the directories can be any two directories from local git repos with any
names. (Note if the paths don&#39;t end with &#39;/&#39;, then &#39;/&#39; will be added.
Otherwise, rsync will copy the contents from &#39;orig-dir&#39; into a subdir of
&#39;dest-dir&#39; which is usually not what you want.)

A typical case is to have snapshot-dir.py soft linked into orig-dir/ to allow
a simple sync process.  The linked-in location of snapshot-dir.py gives the
default &#39;orig-dir&#39; directory automatically (but can be overridden with
--orig-dir=&lt;orig-dir&gt; option).

When snapshot-dir.py is soft-linked into the &#39;orig-dir&#39; directory base, the
way to run this script would be:

  $ cd &lt;some-dest-base-dir&gt;/dest-dir/
  $ &lt;some-orig-base-dir&gt;/orig-dir/snapshot-dir.py

By default, this assumes that git repos are used for both the &#39;orig-dir&#39; and
&#39;dest-dir&#39; locations.  The info about the origin of the snapshot from
&#39;orig-dir&#39; is recorded in the commit message of the &#39;dest-dir&#39; git repo to
provide tractability for the versions (see below).

By default, this script does the following:

1) Assert that &#39;orig-dir&#39; in its git repo is clean (i.e. no uncommitted
   files).  (Can be disabled by passing in --allow-dirty-orig-dir.)

2) Assert that &lt;dest-dir&gt;/ in its git repo is clean (same checks as for
   &#39;orig-dir&#39; above).  (Can be disabled by passing in --allow-dirty-dest-dir.
   Also, this must be skipped on the initial snapshot where &lt;some-dist-dir&gt;/
   does not exist yet.)

3) Clean out the ignored files from &lt;some-source-dir&gt;/orig-dir using &#39;git
   clean -xdf&#39; run in that directory.  (Only if --clean-ignored-files-orig-dir
   is passed.)

4) Run &#39;rsync -cav --delete [other options] &lt;orig-dir&gt;/ &lt;dest-dir&gt;/&#39; to copy
   the contents from &#39;orig-dir&#39; to &#39;dest-dir&#39;, excluding the &#39;.git/&#39; directory
   if it exists in either git repo dir.  After this runs, &lt;dest-dir&gt;/ should
   be an exact duplicate of &lt;orig-dir&gt;/ (except for otherwise noted excluded
   files).  This rsync will delete any files in &#39;dest-dir&#39; that are not in
   &#39;orig-dir&#39;.  Note that if there are any ignored untracked files in
   &#39;orig-dir&#39; that get copied over, then the copied .gitignore files should
   avoid treating them as tracked files in the &#39;dest-dir&#39; git repo.  (The
   rsync command is skipped if the argument --no-op is passed.)

5) Run &#39;git add .&#39; in &lt;dest-dir&gt;/ to stage any files copied over.  (Note that
   git will automatically stage deletes for any files removed by the &#39;rsync
   -cav --delete&#39; command.  Also note that any untracked, unknown or ignored
   files in &#39;orig-dir&#39; that get copied over and are not ignored in &#39;dist-dir&#39;
   in the copied-over &#39;.gitignore&#39; files, or other git ignore files in
   &#39;dist-dir&#39;, then they will be added to the new commit in &#39;dist-dir&#39;.)

6) Get the git remote URL from the orig-dir git repo, and the git log for the
   last commit for the directory orig-dir from its git repo.  (If the orig-dir
   repo is on a tracking branch, then this remote will be guaranteed to be
   correct.  However, if the orig-dir repo not on a tracking branch, then the
   first remote returned from &#39;git remote -v&#39; will be used. This information
   is used to provide tractability of the version info back to the originating
   git repo in the commit created in the dest-dir repo.)

7) Commit the updated dest-dir directory using a commit message with the
   orig-dir snapshot version info.  (This will only commit files in &#39;dest-dir&#39;
   and not in other directories in the destination git repo!)  (The &#39;git
   commit&#39; will be skipped if the options --skip-commit or --no-op are
   passed.)

NOTES:

* When first running this tool, use the --no-op option to see what commands
  would be run without actually performing any mutable operations.  Especially
  pay attention to the rsync command that would be run and make sure it is
  operating on the desired directories.

* On the first creation of &lt;dest-dir&gt;/, one must pass in
  --allow-dirty-dest-dir to avoid checks of &lt;dest-dir&gt;/ (because it does not yet
  exist).

* This script allows the syncing between base git repos or subdirs within git
  repos.  This is allowed because the rsync command is told to ignore the
  .git/ directory when syncing.

* The cleaning of orig-dir/ using &#39;git clean -xdf&#39; may be somewhat dangerous
  but it is recommended by passing in --clean-ignored-files-orig-dir to avoid
  copying locally-ignored files in orig-dir/ (e.g. ignored in
  .git/info/excludes and not ignored in a committed .gitignore file in
  orig-dir/) that get copied to and then committed in the dest-dir/ repo.
  Therefore, be sure you don&#39;t have any of these type of ignored files in
  orig-dir/ that you want to keep before you run this tool with the option
  --clean-ignored-files-orig-dir!

* Snapshotting with this script will create an exact duplicate of &#39;orig-dir&#39;
  in &#39;dest-dir&#39; and therefore if there are any local changes to the files or
  changes after the last snapshot, they will get wiped out.  To avoid this,
  one can the snapshot on a branch in the &#39;dest-dir&#39; git repo, then merge that
  branch into the main branch (e.g. &#39;master&#39;) in &#39;dest-dir&#39; repo.  As long as
  there are no merge conflicts, this will preserve local changes for the
  mirrored directories and files.  This strategy can work well as a way to
  allow for local modifications but still do snapshotting.

WARNINGS:

* Make sure that orig-dir is a non-ignored subdir of the origin git repo and
  that it does not contain any ignored subdirs and files that are ignored by
  listing them in the .git/info/exclude file instead of .gitignore files that
  would get copied over to dist-dir.  (If ignored files are ignored using
  .gitignore files within orig-dir, then those files will be copied by the
  rsync command along with the rest of the files from orig-dir and those files
  will also be ignored after being copied to dest-dir.  However, if these
  files and dirs are ignored because of being listed in the .git/info/exclude
  file in orig-dir, then those files will not be ignored when copied over to
  dest-dir and will therefore be added to the git commit in the dist-dir git
  repo.  That is why it is recommended to run with
  --clean-ignored-files-orig-dir to ensure that all ignore files are removed
  from orig-dir before doing the rsync.)

* Make sure that the top commit in orig-dir has been pushed (or will be
  pushed) to the listed remote git repo showed in the output line &#39;origin
  remote name&#39; or &#39;origin remote URL&#39;.  Otherwise, others will not be able to
  trace that exact version by cloning that repo and traceability is lost.

* Make sure that dest-dir is a non-ignored subdir of the destination git repo
  and does not contain any ignored subdirs or files that you don&#39;t care if
  they are deleted.  (Otherwise, the &#39;rsync --delete&#39; command will delete any
  files in dest-dir that are not also in orig-dir and since these non-ignored
  files in dest-dir are not under version control, they will not be
  recoverable.)

* As a corollary to the above warnings about ignored files and directories, do
  not snapshot from an orig-dir or to a dest-dir that contain build
  directories or other generated files that you want to keep!  Even if those
  files and directories are ignored in copied-over .gitignore files, the copy
  of those ignored files will still occur. (Just another reason to keep your
  build directories completely outside of the source tree!)

optional arguments:
  -h, --help            show this help message and exit
  --show-defaults       Show the default option values and do nothing at all.
  --orig-dir ORIGDIR    Original directory that is the source for the
                        snapshotted directory. If a trailing &#39;/&#39; is missing
                        then it will be added. The default is the directory
                        where this script lives (or is soft-linked). [default:
                        &#39;&lt;orig-dir&gt;&#39;]
  --dest-dir DESTDIR    Destination directory that is the target for the
                        snapshoted directory. If a trailing &#39;/&#39; is missing
                        then it will be added. The default dest-dir is current
                        working directory. [default: &#39;&lt;dest-dir&gt;&#39;]
  --exclude [EXCLUDE ...]
                        List of files/directories/globs to exclude from orig-
                        dir when snapshotting.
  --assert-clean-orig-dir
                        Check that orig-dir is committed and clean. [default]
  --allow-dirty-orig-dir
                        Skip clean check of orig-dir.
  --assert-clean-dest-dir
                        Check that dest-dir is committed and clean. [default]
  --allow-dirty-dest-dir
                        Skip clean check of dest-dir.
  --clean-ignored-files-orig-dir
                        Clean out the ignored files from orig-dir/ before
                        snapshotting.
  --no-clean-ignored-files-orig-dir
                        Do not clean out orig-dir/ ignored files before
                        snapshotting. [default]
  --do-commit           Actually do the commit. [default]
  --skip-commit         Skip the commit.
  --verify-commit       Do not pass --no-verify to git commit. [default]
  --no-verify-commit    Pass --no-verify to git commit.
  --no-op               Don&#39;t actually run any commands that would change the
                        state other (other than the natural side-effects of
                        running git query commands)
</pre></div>
</div>
</section>
<section id="checkin-test-py-help">
<h2><a class="toc-backref" href="#id288"><span class="sectnum">15.7</span> checkin-test.py –help</a><a class="headerlink" href="#checkin-test-py-help" title="Permalink to this heading"></a></h2>
<p>Below is a snapshot of the output from <code class="docutils literal notranslate"><span class="pre">checkin-test.py</span> <span class="pre">--help</span></code>.  This
<code class="docutils literal notranslate"><span class="pre">--help</span></code> output contains a lot of information about the recommended
development workflow (mostly related to pushing commits) and outlines a number
of different use cases for using the tool.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Usage: checkin-test.py [OPTIONS]

This tool does testing of a TriBITS-based project using CTest and this script
can actually do the push itself using git in a safe way.  In fact, it is
recommended that one uses this script to push since it will amend the last
commit message with a (minimal) summary of the builds and tests run with
results and/or send out a summary email about the builds/tests performed.


QUICKSTART
-----------

In order to do a safe push, perform the following recommended workflow
(different variations on this workflow are described in the COMMON USE CASES
section below):

1) Commit changes in the local repo:

  # 1.a) See what files are changed, newly added, etc.
  $ git status

  # 1.b) Stage the files you want to commit
  $ git stage &lt;files you want to commit&gt;

  # 1.c) Create your local commits
  $ git commit -- SOMETHING
  $ git commit -- SOMETHING_ELSE
  ...

  # 1.d) Stash whatever changes are left you don&#39;t want to test/push
  $ git stash

  NOTE: You can group your commits any way that you would like (see the basic
  git documentation).

  NOTE: When multiple repos are involved, use the &#39;gitdist&#39; command instead of
  &#39;git&#39;.  This script is provided at tribits/python_utils/gitdist.  See
  gitdist --help for details.

2) Review the changes that you have made to make sure it is safe to push:

  $ cd $PROJECT_HOME
  $ git local-stat | less               # Look at the full status of local repo
  $ git diff --name-status HEAD ^@{u}   # [Optional] Look at the files that have changed

  NOTE: The command &#39;local-stat&#39; is a git alias that can be installed with the
  script tribits/python_utils/git-config-alias.sh.  This command is
  recommended over just a raw &#39;git status&#39; or &#39;git log&#39; to review commits
  before attempting to test/push commits.  If you have not installed these
  alias, then run the following commands instead:

    $ git status
    $ git log --oneline --name-status HEAD ^@{u}

  NOTE: If you see any files/directories that are listed as &#39;unknown&#39; returned
  from &#39;git local-stat&#39;, then you will need to do an &#39;git add&#39; to track them or
  add them to an ignore list *before* you run the checkin-test.py script.
  The git script will not allow you to push if there are new &#39;unknown&#39; files or
  uncommitted changes to tracked files.

  NOTE: When multiple repos are involved, use &#39;gitdist-mod-status&#39; to see the
  state of your repos before pushing.  See gitdist --help for details.

3) Set up the checkin base build directory (first time only):

  $ cd $PROJECT_HOME
  $ echo CHECKIN &gt;&gt; .git/info/exclude
  $ mkdir CHECKIN
  $ cd CHECKIN

  NOTE: You may need to set up some configuration files if CMake cannot find
  the right compilers, MPI, and TPLs by default (see detailed documentation
  below).

  NOTE: You might want to set up a simple shell driver script for your common
  use cases.

  NOTE: You can set up a CHECKIN directory of any name in any location
  you want.  If you create one outside of the main source dir, then
  you will not have to add the git exclude shown above.

4) Do the pull, configure, build, test, and push:

  $ cd $PROJECT_HOME
  $ cd CHECKIN
  $ ../checkin-test.py -j4 --do-all --push

  NOTE: The above will: a) pull updates from the tracking branch, b)
  automatically enable the correct packages based on changed files, c)
  configure and build the changed and downstream packages, d) run the tests,
  e) send you emails about what happened, f) do a final pull from the global
  repo, g) optionally amend the last local commit with the test results, and
  h) finally push local commits to the tracking branch if everything passes.

  NOTE: The repo must be on a branch (not a detached head state) with a
  tracking branch &#39;&lt;remoterepo&gt;/&lt;remotebranch&gt;&#39; so that a raw &#39;git pull&#39; can
  be performed to get updates and to push changes.  Also, the push is done
  explicitly to the tracking branch using:

    git push &lt;remoterepo&gt; &lt;remotebranch&gt;

  NOTE: You must not have any uncommitted changes or the script will stop
  right away.  To run the script, you will may need to first use &#39;git stash&#39;
  to stash away your unstagged/uncommitted changes *before* running this
  script.

  NOTE: You need to have SSH public/private keys set up to the remote repo
  machines for the git commands invoked in the script to work without you
  having to type a password.  If the &#39;git pull&#39; fails, the detailed output is
  generally in a pull*.out file (see the checkin-test.out log file for
  details).

  NOTE: You can do the final push in a second invocation of the script with a
  follow-up run with --push and removing --do-all (it will remember the
  results from the build/test cases just ran).  For more details, see detailed
  documentation below.

  NOTE: Once you start running the checkin-test.py script, you can go off and
  do something else and just check your email to see if all the builds and
  tests passed and if the push happened or not.

  NOTE: The commands &#39;cmake&#39;, &#39;ctest&#39;, and &#39;make&#39; must be in your default path
  before running this script.

  NOTE: Defaults like -j4 can be set using a local-checkin-test-defaults.py
  file (see below).

For more details on using this script, see the detailed documentation below.


DETAILED DOCUMENTATION
-----------------------

The following approximate steps are performed by this script:

----------------------------------------------------------------------------

1) Check to see if the local repo(s) are clean:

  $ git status

  NOTE: If any modified or any unknown files are shown, the process will be
  aborted.  The local repo(s) working directory must be clean and ready to
  push *everything* that is not stashed away.

2) Do a &#39;git pull&#39; to update the repo (done if --pull or --do-all is set):

  NOTE: If not doing a pull, use --allow-no-pull or --local-do-all.

3) Select the list of packages to enable forward/downstream based on the
package directories where there are changed files (or from a list of packages
passed in by the user).

  NOTE: The automatic enable behavior can be overridden or modified using the
  options --enable-all-packages=on/off, --enable-packages=&lt;p0&gt;,&lt;p1&gt;,... ,
  --disable-packages=&lt;p0&gt;,&lt;p1&gt;,... , and/or --no-enable-fwd-packages.

4) For each build/test case &lt;BUILD_NAME&gt; (e.g. MPI_DEBUG, SERIAL_RELEASE,
extra builds specified with --st-extra-builds and --extra-builds):

  4.a) Configure a build directory &lt;BUILD_NAME&gt; in a standard way for all of
  the packages that have changed and all of the packages that depend on these
  packages forward/downstream. You can manually select which packages get
  enabled (see the enable options above).  (done if --configure, --do-all, or
  --local-do-all is set.)

  4.b) Build all configured code with &#39;make&#39; (e.g. with -jN set through
  -j or --make-options).  (done if --build, --do-all, or --local-do-all is set.)

  4.c) Run all BASIC tests for enabled packages.  (done if --test, --do-all,
  or --local-do-all is set.)

  4.d) Analyze the results of the pull, configure, build, and tests and send
  email about results.  (emails only sent out if --send-emails-to!=&quot;&quot;)

5) Do final pull and rebase, append test results to last commit message, and
push (done if --push or --do-all is set)

  5.a) Do a final &#39;git pull&#39; (done if --pull or --do-all is set)

  5.b) Do &#39;git rebase &lt;remoterepo&gt;/&lt;remotebranch&gt;&#39; (done if --rebase is set)

  5.c) Amend commit message of the most recent commit with the summary of the
  testing performed.  (done if --append-test-results is set.)

  5.d) Push the local commits to the global repo (done if --push is set)

6) Send out final on actions (i.e. &#39;DID PUSH&#39; email if a push occurred).
(done if --send-email-to!=&quot;&quot; is set and --send-email-only-on-failure is *not*
set)

----------------------------------------------------------------------------

The recommended way to use this script is to create a new base CHECKIN test
directory apart from your standard build directories such as with:

  $ $PROJECT_HOME
  $ mkdir CHECKIN
  $ echo CHECKIN &gt;&gt; .git/info/exclude

The most basic way to do pre-push testing is with:

  $ cd CHECKIN
  $ ../checkin-test.py --do-all [other options]

If your MPI installation, other compilers, and standard TPLs can be found
automatically, then this is all you will need to do.  However, if the setup
cannot be determined automatically, then you can add a set of CMake variables
that will get read in the files:

  COMMON.config
  MPI_DEBUG.config
  SERIAL_RELEASE.config

(or whatever your standard --default-builds are).

Actually, for built-in build/test cases, skeletons of these files will
automatically be written out with typical CMake cache variables (commented
out) that you would need to set out.  Any CMake cache variables listed in
these files will be read into and passed on the configure line to &#39;cmake&#39;.

WARNING: Please do not add any extra CMake cache variables than what are
needed to get the Primary Tested (PT) --default-builds builds to work.  Adding
other enables/disables will make the builds non-standard and can break these
PT builds.  The goal of these configuration files is to allow you to specify
the minimum environment to find MPI, your compilers, and the required TPLs
(e.g. BLAS, LAPACK, etc.).  If you need to fudge what packages are enabled,
please use the script arguments --enable-packages, --enable-extra-pacakges,
--disable-packages, --no-enable-fwd-packages, and/or --enable-all-packages to
control this, not the *.config files!

WARNING: Please do not add any CMake cache variables in the *.config files
that will alter what packages or TPLs are enabled or what tests are run.
Actually, the script will not allow you to change TPL enables in these
standard *.config files because to do so deviates from a consistent build
configuration for Primary Tested (PT) Code.

NOTE: All tentatively-enabled TPLs (e.g. Pthreads and BinUtils) are hard
disabled in order to avoid different behaviors between machines where they
would be enabled and machines where they would be disabled.

NOTE: If you want to add extra build/test cases that do not conform to
the standard build/test configurations described above, then you need
to create extra builds with the --extra-builds and/or
--st-extra-builds options (see below).

NOTE: Before running this script, you should first do an &#39;git status&#39; and &#39;git
diff --name-status HEAD ^@{u}&#39; and examine what files are changed to make sure
you want to push what you have in your local working directory.  Also, please
look out for unknown files that you may need to add to the git repository with
&#39;git add&#39; or add to your ignores list.  There cannot be any uncommitted
changes in the local repo before running this script.

NOTE: You don&#39;t need to run this script if you have not changed any files that
affect the build or the tests.  For example, if all you have changed are
documentation files, then you don&#39;t need to run this script before pushing
manually.

NOTE: To see detailed debug-level information, set
TRIBITS_CHECKIN_TEST_DEBUG_DUMP=ON in the env before running this script.


COMMON USE CASES (EXAMPLES):
----------------------------

(*) Basic full testing with integrating with global repo(s) without push:

  ../checkin-test.py --do-all

  NOTE: This will result in a set of emails getting sent to your email address
  for the different configurations and an overall push readiness status email.

  NOTE: If everything passed, you can follow this up with a --push (see
  below).

(*) Basic full testing with integrating with local repo and push:

  ../checkin-test.py --do-all --push

  NOTE: By default this will rebase your local commits and amend the last
  commit with a short summary of test results.  This is appropriate for
  pushing commits that only exist in your local repo and are not shared with
  any remote repo.

(*) Push to global repo after a completed set of tests have finished:

  ../checkin-test.py [other options] --push

  NOTE: This will pick up the results for the last completed test runs with
  [other options] and append the results of those tests to the log of the most
  recent commit.

  NOTE: Take the action options for the prior run and replace --do-all with
  --push but keep all of the rest of the options the same.  For example, if
  you did:

    ../checkin-test.py --enable-packages=Blah --default-builds=MPI_DEBUG --do-all

  then follow that up with:

    ../checkin-test.py --enable-packages=Blah --default-builds=MPI_DEBUG --push

  NOTE: This is a common use case when some tests are failing which aborted
  the initial push but you determine it is okay to push anyway and do so with
  --force-push.

(*) Test only the packages modified and not the forward dependent packages:

  ../checkin-test.py --do-all --no-enable-fwd-packages

  NOTE: This is a safe thing to do when only tests in the modified packages
  are changed and not library code.  This can speed up the testing process and
  is to be preferred over not running this script at all.  It would be very
  hard to make this script automatically determine if only test code has
  changed because every package does not follow a set pattern for
  tests and test code.

(*) Run the most important default (e.g. MPI_DEBUG) build/test only:

  ../checkin-test.py --do-all --default-builds=MPI_DEBUG

(*) The minimum acceptable testing when code has been changed:

  ../checkin-test.py \
    --do-all --enable-all-packages=off --no-enable-fwd-packages \
    --default-builds=MPI_DEBUG

  NOTE: This will do only an MPI DEBUG build and will only build and run the
  tests for the packages that have directly been changed and not any forward
  packages.  Replace &quot;MPI_DEBUG&quot; with whatever your most important default
  build is.

(*) Test only a specific set of packages and no others:

  ../checkin-test.py \
    --enable-packages=&lt;P0&gt;,&lt;P1&gt;,&lt;P2&gt; --no-enable-fwd-packages \
    --do-all

  NOTE: This will override all logic in the script about which packages will
  be enabled based on file changes and only the given packages will be
  enabled.  When there are tens of thousands of changed files and hundreds of
  defined packages, this auto-detection algorithm can be very expensive!

  NOTE: You might also want to pass in --enable-all-packages=off in case the
  script wants to enable all the packages (see the output in the
  checkin-test.py log file for details) and you think it is not necessary to
  do so.

  NOTE: Using these options is greatly preferred to not running this script at
  all and should not be any more expensive than the testing you would already
  do manually before a push.

(*) Test changes locally without pulling updates:

  ../checkin-test.py --local-do-all

  NOTE: This will just configure, build, test, and send an email notification
  without updating or changing the status of the local git repo in any way and
  without any communication with the global repo.  Hence, you can have
  uncommitted changes and still run configure, build, test without having to
  commit or having to stash changes.

  NOTE: This will determine what packages to enable and test based on changes
  w.r.t. to the tracking branch.  If not on a tracking branch, or in a
  detached head state, see below.

  NOTE: This is typically not a sufficient level of testing in order to push
  the changes to a shared branch because you have not fully integrated your
  changes yet with other developers.  However, this would be a sufficient
  level of testing in order to do a commit on the local machine and then pull
  to a remote machine for further testing and a push (see below).

(*) Local test of repo version on a detached head or with no tracking branch:

  ../checkin-test.py --enable-all-packages=[on|off] \
    --enable-packages=&lt;P0&gt;,... --local-do-all

  By specifying what packages are enabled and not doing a pull or push, the
  script allows the repo(s) to be in a detached head state or on a branch that
  does not have a tracking branch.  This allows the checkin-test.py script to
  be used, for example, to test versions using &#39;git bisect&#39;.

(*) Adding extra build/test cases:

  Often you will be working on Secondary Tested (ST) Code or Experimental (EX)
  Code and want to include the testing of this in your pre-push testing
  process along with the standard --default-builds build/test cases which can
  only include Primary Tested (PT) Code.  In this case you can run with:

    ../checkin-test.py --extra-builds=&lt;BUILD1&gt;,&lt;BUILD2&gt;,... [other options]

  For example, if you have a build that enables the TPL CUDA you would do:

    echo &quot;
    -DTPL_ENABLE_MPI:BOOL=ON
    -DTPL_ENABLE_CUDA:BOOL=ON
    &quot; &gt; MPI_DEBUG_CUDA.config

  and then run with:

    ../checkin-test.py --extra-builds=MPI_DEBUG_CUDA --do-all

  This will do the standard --default-builds (e.g. MPI_DEBUG and
  SERIAL_RELEASE) build/test cases along with your non-standard MPI_DEBUG_CUDA
  build/test case.

  NOTE: You can disable the default build/test cases with --default-builds=&quot;&quot;.
  However, please only do this when you are not going to push because you need
  at least one default build/test case (the most important default PT case,
  e.g. MPI_DEBUG) to do a safe push.

(*) Including extra repos and extra packages:

  You can also use the checkin-test.py script to continuously integrate
  multiple git repos containing add-on packages. To do so, just run:

    ../checkin-test.py --extra-repos=&lt;REPO1&gt;,&lt;REPO2&gt;,... [options]

  NOTE: You have to create local commits in all of the extra repos where there
  are changes or the script will abort.

  NOTE: Extra repos can be specified with more flexibility using the
  --extra-repos-file and --extra-repos-type arguments (also see
  --ignore-missing-extra-repos).

  NOTE: Each of the last local commits in each of the changed repos will get
  amended with the appended summary of what was enabled in the build/test (if
  --append-test-results is set).

(*) Avoid changing any of the local commit SHA1s:

  If you are pushing commits from a shared branch, it is critical that you do
  not change any of the SHA1s of the commits.  Changing the SHA1s for any of
  the commits will mess up various multi-repo, multi-branch workflows.  To
  avoid changing any of the SHA1s of the local commits, one must run with:

    ../checkin-test.py --no-rebase --no-append-test-results [options]

(*) Performing a remote test/push:

  If you develop on a slow machine like your laptop, doing an appropriate
  level of testing can take a long time.  In this case, you can pull the
  changes to another faster remote workstation and do a more complete set of
  tests and push from there.  If you are knowledgeable with git, this will be
  easy and natural to do, without any help from this script.  However, this
  script can still help and automate the steps and can do so in one command
  invocation on the part of the developer.

  On your slow local development machine &#39;mymachine&#39;, do the limited testing
  with:

    ../checkin-test.py --do-all --no-enable-fwd-packages

  On your fast remote test machine, do a full test and push with:

    ../checkin-test.py \
      --extra-pull-from=&lt;remote-repo&gt;:master \
      --do-all --push

  where &lt;remote-name&gt; is a git remote repo name pointing to
  mymachine:/some/dir/to/your/src (see &#39;git help remote&#39;).

  NOTE: You can of course adjust the packages and/or build/test cases that get
  enabled on the different machines.

  NOTE: Once you invoke the checkin-test.py script on the remote test machine
  and it has pulled the commits from mymachine, then you can start changing
  files again on your local development machine and just check your email to
  see what happens on the remote test machine.

  NOTE: If something goes wrong on the remote test machine, you can either
  work on fixing the problem there or you can fix the problem on your local
  development machine and then do the process over again.

  NOTE: If you alter the commits on the remote machine (such as squashing
  commits), you will have trouble merging back on our local machine.
  Therefore, if you have to to fix problems, make new commits and don&#39;t alter
  the ones you pulled from your local machine (but rebasing them should be
  okay as long as the local commits on mymachine are not pushed to other
  repos).

  NOTE: Git will resolve the duplicated commits when you pull the commits
  pushed from the remote machine.  Git knows that the commits are the same and
  will do the right thing when rebasing (or just merging).

  NOTE: This would also work for multiple repos if the remote name
  &#39;&lt;remote-repo&gt;&#39; pointed to the right remote repo in all the local repos.

(*) Check push readiness status:

  ../checkin-test.py

  This will examine results for the last testing process and send out an email
  stating if the a push is ready to perform or not.

(*) See the default option values without doing anything:

  ../checkin-test.py --show-defaults

  This is the easiest way to figure out what all of the default options are.

Hopefully the above documentation, the example use cases, the documentation of
the command-line arguments below, and some experimentation will be enough to
get you going using this script for all of your pre-push testing and pushes.
If that is not sufficient, send email to your development support team to ask
for help.


LOCAL DEFAULT COMMAND LINE DEFAULTS
-----------------------------------

If the file local-checkin-test-defaults.py exists in the current directory,
then it will be read in and will change the project defaults for the
command-line arguments.  For example, a valid local-checkin-test-defaults.py
file would look like:

  defaults = [
    &quot;-j10&quot;,
    &quot;--no-rebase&quot;,
    &quot;--ctest-options=-E &#39;(PackageA_Test1|PackageB_Test2)&#39;&quot;
    ]

Any of the project&#39;s checkin-test.py command-line argument defaults can be
changed in this way.  The updated defaults can be observed by running:

  ./checkin-test.py --show-defaults

Any command-line arguments explicitly passed in will override these local
defaults.


HANDLING OF PT, ST, AND EX CODE IN BUILT-IN AND EXTRA BUILDS:
-------------------------------------------------------------

This script will only process PT (Primary Tested) packages in the
--default-builds (e.g. MPI_DEBUG and SERIAL_RELEASE) builds.  This is to avoid
problems of side-effects of turning on ST packages that would impact PT
packages (e.g. an ST package getting enabled that enables an ST TPL which
turns on support for that TPL in a PT package producing different code which
might work but the pure PT build without the extra TPL may actually be broken
and not know it).  Therefore, any non-PT packages that are enabled (either
implicitly through changed files or explicitly by listing in --enable-packages)
will be turned off in the --default-builds builds.  If none of the enabled
packages are PT, then they will all be disabled and the --default-builds
builds will be skipped.

In order to better support the development of ST and EX packages, this script
allows you to define some extra builds that will be invoked and used to
determine overall pass/fail before a potential push.  The option
--st-extra-builds is used to specify extra builds that will test ST packages
(and also PT packages if any are enabled).  If only PT packages are enabled
then the builds specified in --st-extra-builds will still be run.  The
reasoning is that PT packages may contain extra ST features and therefore if
the goal is to test these ST builds it is desirable to also run these builds
because they also my impact downstream ST packages.

Finally, the option --extra-builds will test all enabled packages, including
EX packages, regardless of their test group.  Therefore, when using
--extra-builds, be careful that you watch what packages are enabled.  If you
change an EX package, it will be enabled in --extra-builds builds.

A few use cases might help better demonstrate the behavior.  Consider
the following input arguments specifying extra builds

  --st-extra-builds=MPI_DEBUG_ST --extra-builds=INTEL_DEBUG

with the packages Teuchos, Phalanx, and Meros where Teuchos is PT, Phalanx is
ST, and Meros is EX.

Here is what packages would be enabled in each of the builds:

  --default-builds=MPI_DEBUG,SERIAL_RELEASE \
  --st-extra-builds=MPI_DEBUG_ST \
  --extra-builds=INTEL_DEBUG

and which packages would be excluded:

A) --enable-packages=Teuchos:
   MPI_DEBUG:       [Teuchos]
   SERIAL_RELEASE:  [Teuchos]
   MPI_DEBUG_ST:    [Teuchos]
   INTEL_DEBUG:     [Teuchos]     Always enabled!

B) --enable-packages=Phalanx:
   MPI_DEBUG:       []            Skipped, no PT packages!
   SERIAL_RELEASE:  []            Skipped, no PT packages!
   MPI_DEBUG_ST:    [Phalanx]
   INTEL_DEBUG:     [Phalanx]

C) --enable-packages=Meros:
   MPI_DEBUG:       []            Skipped, no PT packages!
   SERIAL_RELEASE:  []            Skipped, no PT packages!
   MPI_DEBUG_ST:    []            Skipped, no PT or ST packages!
   INTEL_DEBUG:     [Meros]

D) --enable-packages=Teuchos,Phalanx:
   MPI_DEBUG:       [Teuchos]
   SERIAL_RELEASE:  [Teuchos]
   MPI_DEBUG_ST:    [Teuchos,Phalanx]
   INTEL_DEBUG:     [Teuchos,Phalanx]

E) --enable-packages=Teuchos,Phalanx,Meros:
   MPI_DEBUG:       [Teuchos]
   SERIAL_RELEASE:  [Teuchos]
   MPI_DEBUG_ST:    [Teuchos,Phalanx]
   INTEL_DEBUG:     [Teuchos,Phalanx,Meros]

The --extra-builds=INTEL_DEBUG build is always performed with all of the
enabled packages.  This logic given above must be understood in order to
understand the output given in the script.


CONVENTIONS FOR COMMAND-LINE ARGUMENTS:
---------------------------------------

The command-line arguments are segregated into three broad categories: a)
action commands, b) aggregate action commands, and c) others.

a) The action commands are those such as --build, --test, etc. and are shown
with [ACTION] in their documentation.  These action commands have no off
complement.  If the action command appears, then the action will be performed.

b) Aggregate action commands such as --do-all and --local-do-all turn on sets
of other action commands and are shown with [AGGR ACTION] in their
documentation.  The sub-actions that these aggregate action commands turn on
cannot be disabled with other arguments.

c) Other arguments are those that are not marked with [ACTION] or [AGGR
ACTION] tend to either pass in data and turn control flags on or off.


EXIT CODE:
---------

This script returns 0 if the actions requested are successful.  This does not
necessarily imply that it is okay to do a push or that a push was done.  For
example, if only --pull is passed in and is successful, then 0 will be
returned but that does *not* mean that it is okay to do a push.  Therefore, a
return value of is a necessary but not sufficient condition for readiness to
push, it depends on the requested actions.



Options:
  -h, --help            show this help message and exit
  --project-configuration=PROJECTCONFIGURATION
                        Custom file to provide configuration defaults for the
                        project.  By default, the file project-checkin-test-
                        config.py is looked for in &lt;checkin-test-path&gt; (in
                        case it is symlinked into &lt;projectDir&gt;/checkin-
                        test.py) if not found there, then it is looked for in
                        &lt;checkin-test-path&gt;/../../..  (assuming default
                        TriBITS snapshot
                        &lt;projectDir&gt;/cmake/tribits/ci_support/) If this file
                        is set to a location that is not in the project&#39;s base
                        directory, then --src-dir must be set to point to the
                        project&#39;s base directory.
  --show-defaults       Show the default option values and do nothing at all.
  --project-name=PROJECTNAME
                        Set the project&#39;s name. This is used to locate various
                        files.  If not set, then it reads the project name
                        from the PROJECT_NAME variable set in the file
                        SRCDIR/ProjectName.cmake.
  --src-dir=SRCDIR      The source base directory for code to be tested.  The
                        default is determined by the location of the found
                        project-checkin-test-config.py file.
  --default-builds=DEFAULTBUILDS
                        Comma separated list of builds that should always be
                        run by default.
  --extra-repos-file=EXTRAREPOSFILE
                        File path to an extra repositories list file.  If set
                        to &#39;project&#39;, then
                        &lt;project_dir&gt;/cmake/ExtraRepositoriesList.cmake is
                        read.  See the argument --extra-repos for details on
                        how this list is used (default empty &#39;&#39;)
  --extra-repos-type=EXTRAREPOSTYPE
                        The test type of repos to read from
                        &lt;extra_repos_file&gt;. Choices = (&#39;&#39;, &#39;Continuous&#39;,
                        &#39;Nightly&#39;, &#39;Experimental&#39;).  [default = &#39;&#39;]
  --extra-repos=EXTRAREPOS
                        List of comma separated extra repositories containing
                        extra  packages that can be enabled.  The order these
                        repos is listed in not important.  This option
                        overrides --extra-repos-file.
  --ignore-missing-extra-repos
                        If set, then extra repos read in from
                        &lt;extra_repos_file&gt; will be ignored and removed from
                        list.  This option is not applicable if
                        &lt;extra_repos_file&gt;==&#39;&#39; or &lt;extra_repos_type&gt;==&#39;&#39;.
  --require-extra-repos-exist
                        If set, then all listed extra repos must exist or the
                        script will exit. [default]
  --with-cmake=WITHCMAKE
                        CMake executable to use with cmake -P scripts
                        internally (only set by unit testing code).
  --skip-deps-update    If set, skip the update of the dependency XML file.
                        If the package structure has not changed since the
                        last invocation, then it is safe to use this option.
  --enable-packages=ENABLEPACKAGES
                        List of comma separated packages to test changes for
                        (example, &#39;Teuchos,Epetra&#39;).  If this list of packages
                        is empty, then the list of packages to enable will be
                        determined automatically by examining the set of
                        modified files from the version control update log.
                        Note that this will skip the auto-detection of changed
                        packages based on changed files.
  --enable-extra-packages=ENABLEEXTRAPACKAGES
                        List of comma separated packages to test in addition
                        to the packages that are enabled determined
                        automatically by examining the set of modified files
                        from the version control update log.  This option is
                        mostly just used in ACI sync servers.
  --disable-packages=DISABLEPACKAGES
                        List of comma separated packages to explicitly disable
                        (example, &#39;Tpetra,NOX&#39;).  This list of disables will
                        be appended after all of the listed enables no matter
                        how they are determined (see --enable-packages
                        option).  NOTE: Only use this option to remove
                        packages that will not build for some reason.  You can
                        disable tests that run by using the CTest option -E
                        passed through the --ctest-options argument in this
                        script.
  --enable-all-packages=ENABLEALLPACKAGES
                        Determine if all packages are enabled &#39;on&#39;, or &#39;off&#39;,
                        or &#39;auto&#39; (let other logic decide).  Setting to &#39;off&#39;
                        is appropriate when the logic in this script
                        determines that a global build file has changed but
                        you know that you don&#39;t need to rebuild and test every
                        package for a reasonable test.  Setting --enable-
                        packages effectively disables this option.  Setting
                        this to &#39;off&#39; does *not* stop the forward enabling of
                        downstream packages for packages that are modified or
                        set by --enable-packages. Setting this to &#39;on&#39; will
                        skip the automatic detection of changed packages based
                        on changed files.  It can be helpful to stop the auto-
                        detection changed packages when there are thousands of
                        changed files and hundreds of defined packages.
                        Choices = (&#39;auto&#39;, &#39;on&#39;, &#39;off&#39;).  [default = &#39;auto&#39;]
  --enable-fwd-packages
                        Enable forward packages. [default]
  --no-enable-fwd-packages
                        Do not enable forward packages.
  --continue-if-no-updates
                        If set, then the script will continue if no updates
                        are pulled from any repo. [default]
  --abort-gracefully-if-no-changes-pulled
                        If set, then the script will abort gracefully if no
                        updates are pulled from any repo.
  --continue-if-no-changes-to-push
                        If set, then the script will continue if no changes to
                        push from any repo. [default]
  --abort-gracefully-if-no-changes-to-push
                        If set, then the script will abort gracefully if no
                        changes to push from any repo.
  --continue-if-no-enables
                        If set, then the script will continue if no packages
                        are enabled. [default]
  --abort-gracefully-if-no-enables
                        If set, then the script will abort gracefully if no
                        packages are enabled.
  --extra-cmake-options=EXTRACMAKEOPTIONS
                        Extra options to pass to &#39;cmake&#39; after all other
                        options. This should be used only as a last resort.
                        To disable packages, instead use --disable-packages.
                        To change test categories, use --test-categories.
  --test-categories=TESTCATEGORIES
                        . Change the test categories.  Can be &#39;BASIC&#39;,
                        &#39;CONTINUOUS&#39;,  &#39;NIGHTLY&#39;, or &#39;HEAVY&#39; (default set by
                        project, see --show-defaults).
  -j OVERALLNUMPROCS, --parallel=OVERALLNUMPROCS
                        The options to pass to make and ctest (e.g. -j4).
  --use-makefiles       If set, then -G&#39;Unix Makfiles&#39; used for backend build
                        tool. Note: The command &#39;make&#39; must be in the default
                        path. [default]
  --use-ninja           If set, then -GNinja used for backend build tool.
                        Note: The command &#39;ninja&#39; must be in the default path.
  --make-options=MAKEOPTIONS
                        The options to pass to &#39;make&#39; (e.g. -j4) or ninja (if
                        --use-ninja given).
  --ctest-options=CTESTOPTIONS
                        Extra options to pass to &#39;ctest&#39; (e.g. -j2).
  --ctest-timeout=CTESTTIMEOUT
                        timeout (in seconds) for each single &#39;ctest&#39; test
                        (e.g. 180 for three minutes).  This sets the CMake
                        cache var DART_TESTING_TIMEOUT which becomes the
                        default timeout for tests, even when running raw
                        ctest.  This value can be overridden using the ctest
                        argument --timeout.  Individual tests may have their
                        own timeouts set which will not be impacted by this
                        default global timeout.  See the configure variable
                        &lt;Project&gt;_SCALE_TEST_TIMEOUT to scale up timeouts for
                        all tests, even those that have individuals timeouts
                        set.
  --show-all-tests      Show all of the tests in the summary email and in the
                        commit message summary (see --append-test-results).
  --no-show-all-tests   Don&#39;t show all of the test results in the summary
                        email. [default]
  --without-default-builds
                        Skip the default builds (same as --default-builds=&#39;&#39;).
                        You would use option along with --extra-
                        builds=BUILD1,BUILD2,... to run your own local custom
                        builds.
  --st-extra-builds=STEXTRABUILDS
                        List of comma-separated ST extra build names.  For
                        each of the build names in --st-extra-
                        builds=&lt;BUILD1&gt;,&lt;BUILD2&gt;,..., there must be a file
                        &lt;BUILDN&gt;.config in the local directory along side the
                        COMMON.config file that defines the special build
                        options for the extra build.
  --ss-extra-builds=SSEXTRABUILDS
                        DEPRECATED!  Use --st-extra-builds instead!. (Default
                        empty )
  --extra-builds=EXTRABUILDS
                        List of comma-separated extra build names.  For each
                        of the build names in --extra-
                        builds=&lt;BUILD1&gt;,&lt;BUILD2&gt;,..., there must be a file
                        &lt;BUILDN&gt;.config in the local directory along side the
                        COMMON.config file that defines the special build
                        options for the extra build.
  --log-file=LOGFILE    File used for detailed log info.
  --send-email-to=SENDEMAILTO
                        List of comma-separated email addresses to send email
                        notification to after every build/test case finishes
                        and at the end for an overall summary and push status.
                        By default, this is the email address you set for git
                        returned by `git config --get user.email`.  In order
                        to turn off email notification, just set --send-email-
                        to=&#39;&#39; and no email will be sent.
  --skip-case-send-email
                        If set then if a build/test case is skipped for some
                        reason (i.e. because no packages are enabled) then an
                        email will go out for that case. [default]
  --skip-case-no-email  If set, then if a build/test case is skipped for some
                        reason (i.e. because no packages are enabled) then no
                        email will go out for that case. (opposite of --skip-
                        case-send-email) [default]
  --send-build-case-email=SENDBUILDCASEEMAIL
                        Determines when email goes out to --send-email-
                        to=&lt;email&gt; for a build case.  But the final status
                        email will still go out if --send-email-to=&lt;email&gt; is
                        not empty. [default = &#39;always&#39;] Choices = (&#39;always&#39;,
                        &#39;only-on-failure&#39;, &#39;never&#39;).  [default = &#39;always&#39;]
  --send-email-for-all  If set, then emails will get sent out for all
                        operations. [default]
  --send-email-only-on-failure
                        If set, then emails will only get sent out for
                        failures.
  --send-email-to-on-push=SENDEMAILTOONPUSH
                        List of comma-separated email addresses to send email
                        notification to on a successful push.  This is used to
                        log pushes to a central list.  In order to turn off
                        this email notification, just set --send-email-to-on-
                        push=&#39;&#39; and no email will be sent to these email
                        lists.
  --force-push          Force the local push even if there are build/test
                        errors. WARNING: Only do this when you are 100%
                        certain that the errors are not caused by your code
                        changes.  This only applies when --push is specified
                        and this script.
  --no-force-push       Do not force a push if there are failures. [default]
  --do-push-readiness-check
                        Check the push readiness status at the end and send
                        email if not actually pushing. [default]
  --skip-push-readiness-check
                        Skip push status check.
  --rebase              Rebase the local commits on top of
                        &lt;remoterepo&gt;/&lt;remotebranch&gt; before amending the last
                        commit and pushing.  Rebasing keeps a nice linear
                        commit history like with CVS or SVN and will work
                        perfectly for the basic workflow of adding commits to
                        the &#39;master&#39; branch and then syncing up with
                        &lt;remoterepo&gt;/&lt;remotebranch&gt; before the final push.
                        [default]
  --no-rebase           Do *not* rebase the local commits on top of
                        &lt;remoterepo&gt;/&lt;remotebranch&gt; before amending the final
                        commit and pushing.  This allows for some more
                        complex workflows involving local branches with
                        multiple merges.  However, this will result in non-
                        linear history and will allow for trivial merge
                        commits with &lt;remoterepo&gt;/&lt;remotebranch&gt; to get
                        pushed.  This mode should only be used in cases where
                        the rebase mode will not work or  when it is desired
                        to use a merge commit to integrate changes on a branch
                        that you wish be able to easily back out.  For
                        sophisticated users of git, this may in fact be the
                        preferred mode.
  --append-test-results
                        Before the final push, amend the most recent local
                        commit by appending a summary of the test results.
                        This provides a record of what builds and tests were
                        performed in order to test the local changes.  This is
                        only  performed if --push is also set.  NOTE: If the
                        same local commit is amended more than once, the prior
                        test summary sections will be overwritten with the
                        most recent test results from the current run.
                        [default]
  --no-append-test-results
                        Do not amend the last local commit with test results.
                        NOTE: If you have uncommitted local changes that you
                        do not want this script to commit then you must select
                        this option to avoid this last amending commit.  Also,
                        if you are pushing commits from a shared branch and
                        don&#39;t want to change any of the SHA1s for the commits,
                        then you must set this option!
  --extra-pull-from=EXTRAPULLFROM
                        Optional extra git pull(s) to merge in changes from
                        after pulling in changes from the tracking branch.
                        The format of this argument is: ...,&lt;local-
                        repoi&gt;:&lt;remote-repoi&gt;:&lt;remote-branchi&gt;,... where each
                        pull specification gives the name (not the directory)
                        of the local repo &lt;local-repoi&gt;, the remote repo name
                        &lt;remote-repoi&gt;, and the branch in the remote repo to
                        pull &lt;remote-branchi&gt;.  If only two semicolons &#39;:&#39; are
                        given then an pull field takes the form ...,&lt;remote-
                        repo&gt;:&lt;remote-branch&gt;,... where the remote &lt;remote-
                        name&gt; must be defined in all the repos and the branch
                        &lt;remote-branch&gt; must exist in all the remote repos.
                        If the &lt;remote-repoi&gt; is empty such as with
                        ...,:&lt;remote-repoi&gt;:&lt;remote-branchi&gt;,... then this
                        matches the base git repo.  The extra pull(s) are only
                        done if --pull is also specified.  NOTE: when using
                        --extra-repos=&lt;repo0&gt;,&lt;repo1&gt;,... the &lt;local-repoi&gt;
                        must be a named repository that is present in all of
                        the git repos or it will be an error.
  --allow-no-pull       Allowing for there to be no pull performed and still
                        doing the other actions.  This option is useful for
                        testing against local changes without having to get
                        the updates from the global repo.  However, if you
                        don&#39;t pull, you can&#39;t push your changes to the global
                        repo.  WARNING: This does *not* stop a pull attempt
                        from being performed by --pull or --do-all!
  --wipe-clean          [ACTION] Blow existing build directories and
                        build/test results.  The action can be performed on
                        its own or with other actions in which case the wipe
                        clean will be performed before any other actions.
                        NOTE: This will only wipe clean the builds that are
                        specified and will not touch those being ignored (e.g.
                        SERIAL_RELEASE will not be removed if --default-
                        builds=MPI_DEBUG is specified).
  --pull                [ACTION] Do the pull from the tracking branch and
                        optionally also merge in changes from the repo pointed
                        to by --extra-pull-from.
  --configure           [ACTION] Do the configure step.
  --build               [ACTION] Do the build step.
  --test                [ACTION] Do the running of the enabled tests.
  --local-do-all        [AGGR ACTION] Do configure, build, and test with no
                        pull (same as setting --allow-no-pull ---configure
                        --build --test).  This is the same as --do-all except
                        it does not do --pull and also allows for no pull.
  --do-all              [AGGR ACTION] Do update, configure, build, and test
                        (same as --pull --configure --build --test).  NOTE:
                        This will do a --pull regardless if --allow-no-pull is
                        set or not.  To avoid the pull, use --local-do-all.
  --push                [ACTION] Push the committed changes in the local repo
                        into to remote repo pointed to by the tracking branch.
  --execute-on-ready-to-push=EXECUTEONREADYTOPUSH
                        [ACTION] A command to execute on successful execution
                        and &#39;READY TO PUSH&#39; status from this script.  This can
                        be used to do a remote SSH invocation to a remote
                        machine to do a remote pull/test/push after this
                        machine finishes.
</pre></div>
</div>
</section>
<section id="is-checkin-tested-commit-py-help">
<span id="is-checkin-tested-commit-py"></span><h2><a class="toc-backref" href="#id289"><span class="sectnum">15.8</span> is_checkin_tested_commit.py –help</a><a class="headerlink" href="#is-checkin-tested-commit-py-help" title="Permalink to this heading"></a></h2>
<p>Below is a snapshot of the output from <code class="docutils literal notranslate"><span class="pre">is_checkin_tested_commit.py</span> <span class="pre">--help</span></code>.
For more details see <a class="reference internal" href="#using-git-bisect-with-checkin-test-py-workflows">Using Git Bisect with checkin-test.py workflows</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  File &quot;/home/runner/work/TriBITS/TriBITS/tribits/doc/guides/../../ci_support/is_checkin_tested_commit.py&quot;, line 57
    print &quot;NOTE: TRIBITS_IS_CHECKIN_TESTED_COMMIT=ON set in env, doing debug dump ...&quot;
          ^
SyntaxError: Missing parentheses in call to &#39;print&#39;. Did you mean print(&quot;NOTE: TRIBITS_IS_CHECKIN_TESTED_COMMIT=ON set in env, doing debug dump ...&quot;)?
</pre></div>
</div>
</section>
<section id="get-tribits-packages-from-files-list-py-help">
<span id="get-tribits-packages-from-files-list-py"></span><h2><a class="toc-backref" href="#id290"><span class="sectnum">15.9</span> get-tribits-packages-from-files-list.py –help</a><a class="headerlink" href="#get-tribits-packages-from-files-list-py-help" title="Permalink to this heading"></a></h2>
<p>Below is a snapshot of the output from
<code class="docutils literal notranslate"><span class="pre">get-tribits-packages-from-files-list.py</span> <span class="pre">--help</span></code>.  For more details see
<a class="reference internal" href="#tribits-project-dependencies-xml-file-and-tools">TriBITS Project Dependencies XML file and tools</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Usage</span><span class="p">:</span> <span class="n">get</span><span class="o">-</span><span class="n">tribits</span><span class="o">-</span><span class="n">packages</span><span class="o">-</span><span class="n">from</span><span class="o">-</span><span class="n">files</span><span class="o">-</span><span class="nb">list</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">deps</span><span class="o">-</span><span class="n">xml</span><span class="o">-</span><span class="n">file</span><span class="o">=&lt;</span><span class="n">DEPS_XML_FILE</span><span class="o">&gt;</span> \
    <span class="o">--</span><span class="n">files</span><span class="o">-</span><span class="nb">list</span><span class="o">-</span><span class="n">file</span><span class="o">=&lt;</span><span class="n">FILES_LIST_FILE</span><span class="o">&gt;</span> <span class="p">[</span><span class="o">--</span><span class="n">project</span><span class="o">-</span><span class="nb">dir</span><span class="o">=&lt;</span><span class="n">projectDir</span><span class="o">&gt;</span><span class="p">]</span>

<span class="n">This</span> <span class="n">script</span> <span class="n">returns</span> <span class="n">a</span> <span class="n">comma</span><span class="o">-</span><span class="n">seprated</span> <span class="nb">list</span> <span class="n">of</span> <span class="nb">all</span> <span class="n">of</span> <span class="n">the</span> <span class="n">project</span><span class="s1">&#39;s TriBITS SE</span>
<span class="n">packages</span> <span class="n">that</span> <span class="n">must</span> <span class="n">be</span> <span class="n">directly</span> <span class="n">tested</span> <span class="k">for</span> <span class="n">changes</span> <span class="ow">in</span> <span class="n">the</span> <span class="nb">input</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">files</span><span class="o">.</span>
<span class="n">This</span> <span class="n">may</span> <span class="n">also</span> <span class="n">include</span> <span class="n">the</span> <span class="n">special</span> <span class="n">package</span> <span class="n">name</span> <span class="s1">&#39;ALL_PACKAGES&#39;</span> <span class="n">which</span> <span class="n">means</span> <span class="n">that</span>
<span class="n">at</span> <span class="n">least</span> <span class="n">one</span> <span class="n">changed</span> <span class="n">file</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="o">&lt;</span><span class="n">projectDir</span><span class="o">&gt;/</span><span class="n">CMakeLists</span><span class="o">.</span><span class="n">txt</span><span class="p">)</span> <span class="n">should</span> <span class="n">result</span> <span class="ow">in</span>
<span class="n">having</span> <span class="n">to</span> <span class="n">test</span> <span class="nb">all</span> <span class="n">of</span> <span class="n">the</span> <span class="n">TriBITS</span> <span class="n">packages</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">project</span><span class="o">.</span>  <span class="n">The</span> <span class="n">logic</span> <span class="k">for</span>
<span class="n">which</span> <span class="n">file</span> <span class="n">changes</span> <span class="n">should</span> <span class="n">trigger</span> <span class="n">testing</span> <span class="nb">all</span> <span class="n">packages</span> <span class="n">can</span> <span class="n">be</span> <span class="n">specialized</span> <span class="k">for</span>
<span class="n">the</span> <span class="n">project</span> <span class="n">through</span> <span class="n">the</span> <span class="n">Python</span> <span class="n">module</span><span class="p">:</span>

  <span class="o">&lt;</span><span class="n">projectDir</span><span class="o">&gt;/</span><span class="n">cmake</span><span class="o">/</span><span class="n">ProjectCiFileChangeLogic</span><span class="o">.</span><span class="n">py</span>

<span class="p">(</span><span class="k">if</span> <span class="n">that</span> <span class="n">file</span> <span class="n">exists</span><span class="p">)</span><span class="o">.</span>

<span class="n">This</span> <span class="n">script</span> <span class="ow">is</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">continuous</span> <span class="n">integration</span> <span class="n">testing</span> <span class="n">workflows</span> <span class="n">involving</span>
<span class="n">TriBITS</span> <span class="n">projects</span> <span class="n">where</span> <span class="n">only</span> <span class="n">packages</span> <span class="n">impacted</span> <span class="n">by</span> <span class="n">the</span> <span class="n">changes</span> <span class="n">are</span> <span class="n">tested</span><span class="o">.</span>  <span class="n">For</span>
<span class="n">such</span> <span class="n">a</span> <span class="n">scenario</span><span class="p">,</span> <span class="n">the</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">changed</span> <span class="n">files</span> <span class="n">can</span> <span class="n">come</span> <span class="n">from</span><span class="p">:</span>

  <span class="n">git</span> <span class="n">diff</span> <span class="o">--</span><span class="n">name</span><span class="o">-</span><span class="n">only</span> <span class="o">&lt;</span><span class="n">upstream</span><span class="o">&gt;..&lt;</span><span class="n">branch</span><span class="o">-</span><span class="n">tip</span><span class="o">&gt;</span>  <span class="o">&gt;</span>  <span class="n">changed</span><span class="o">-</span><span class="n">files</span><span class="o">.</span><span class="n">txt</span>

<span class="n">where</span> <span class="o">&lt;</span><span class="n">upstream</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">origin</span><span class="o">/</span><span class="n">master</span><span class="p">)</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">commit</span> <span class="n">reference</span> <span class="n">that</span> <span class="n">the</span> <span class="n">local</span>
<span class="n">branch</span> <span class="n">was</span> <span class="n">created</span> <span class="kn">from</span> <span class="nn">and</span> <span class="o">&lt;</span><span class="n">branch</span><span class="o">-</span><span class="n">tip</span><span class="o">&gt;</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">tip</span> <span class="n">of</span> <span class="n">the</span> <span class="n">topic</span> <span class="n">branch</span><span class="o">.</span>


<span class="n">Options</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">--</span><span class="n">deps</span><span class="o">-</span><span class="n">xml</span><span class="o">-</span><span class="n">file</span><span class="o">=</span><span class="n">DEPSXMLFILE</span>
                        <span class="n">File</span> <span class="n">containing</span> <span class="n">TriBITS</span><span class="o">-</span><span class="n">generated</span> <span class="n">XML</span> <span class="n">data</span><span class="o">-</span><span class="n">structure</span>
                        <span class="n">the</span> <span class="n">listing</span> <span class="n">of</span> <span class="n">packages</span><span class="p">,</span> <span class="nb">dir</span> <span class="n">names</span><span class="p">,</span> <span class="n">dependencies</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span>
  <span class="o">--</span><span class="n">files</span><span class="o">-</span><span class="nb">list</span><span class="o">-</span><span class="n">file</span><span class="o">=</span><span class="n">FILESLISTFILE</span>
                        <span class="n">File</span> <span class="n">containing</span> <span class="n">the</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">modified</span> <span class="n">files</span> <span class="n">relative</span> <span class="n">to</span>
                        <span class="n">project</span> <span class="n">base</span> <span class="n">directory</span><span class="p">,</span> <span class="n">one</span> <span class="n">file</span> <span class="n">per</span> <span class="n">line</span><span class="o">.</span>
  <span class="o">--</span><span class="n">project</span><span class="o">-</span><span class="nb">dir</span><span class="o">=</span><span class="n">PROJECTDIR</span>
                        <span class="n">Base</span> <span class="n">project</span> <span class="n">directory</span><span class="o">.</span>  <span class="n">Used</span> <span class="n">to</span> <span class="n">access</span> <span class="n">more</span>
                        <span class="n">specialized</span> <span class="n">logic</span> <span class="n">beyond</span> <span class="n">what</span> <span class="ow">is</span> <span class="n">known</span> <span class="ow">in</span> <span class="n">the</span>
                        <span class="o">&lt;</span><span class="n">DEPSXMLFILE</span><span class="o">&gt;.</span>  <span class="n">If</span> <span class="n">empty</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">then</span> <span class="n">it</span> <span class="n">will</span> <span class="n">be</span> <span class="nb">set</span>
                        <span class="n">automatically</span> <span class="k">if</span> <span class="n">TriBITS</span> <span class="ow">is</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">standard</span> <span class="n">location</span>
                        <span class="n">w</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">t</span><span class="o">.</span> <span class="n">the</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">relation</span> <span class="n">to</span> <span class="n">this</span> <span class="n">script</span> <span class="n">run</span> <span class="kn">from</span>
                        <span class="nn">the</span> <span class="n">TriBITS</span> <span class="nb">dir</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="get-tribits-packages-from-last-tests-failed-py-help">
<span id="get-tribits-packages-from-last-tests-failed-py"></span><h2><a class="toc-backref" href="#id291"><span class="sectnum">15.10</span> get-tribits-packages-from-last-tests-failed.py –help</a><a class="headerlink" href="#get-tribits-packages-from-last-tests-failed-py-help" title="Permalink to this heading"></a></h2>
<p>Below is a snapshot of the output from
<code class="docutils literal notranslate"><span class="pre">get-tribits-packages-from-last-tests-failed.py</span> <span class="pre">--help</span></code>.  For more details
see <a class="reference internal" href="#tribits-project-dependencies-xml-file-and-tools">TriBITS Project Dependencies XML file and tools</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Usage</span><span class="p">:</span> <span class="n">get</span><span class="o">-</span><span class="n">tribits</span><span class="o">-</span><span class="n">packages</span><span class="o">-</span><span class="n">from</span><span class="o">-</span><span class="n">last</span><span class="o">-</span><span class="n">tests</span><span class="o">-</span><span class="n">failed</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">deps</span><span class="o">-</span><span class="n">xml</span><span class="o">-</span><span class="n">file</span><span class="o">=&lt;</span><span class="n">file</span><span class="o">&gt;</span> \
  <span class="o">--</span><span class="n">last</span><span class="o">-</span><span class="n">tests</span><span class="o">-</span><span class="n">failed</span><span class="o">-</span><span class="n">file</span><span class="o">=&lt;</span><span class="n">file</span><span class="o">&gt;</span>

<span class="n">This</span> <span class="n">returns</span> <span class="n">a</span> <span class="n">comma</span><span class="o">-</span><span class="n">separated</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">TriBITS</span> <span class="n">packages</span> <span class="n">that</span> <span class="n">correspond</span> <span class="n">to</span> <span class="n">the</span>
<span class="nb">list</span> <span class="n">of</span> <span class="n">failing</span> <span class="n">tests</span> <span class="n">provided</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">passed</span><span class="o">-</span><span class="ow">in</span> <span class="n">file</span> <span class="n">LastTestsFailed</span><span class="o">*.</span><span class="n">log</span>
<span class="n">generated</span> <span class="n">by</span> <span class="n">ctest</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">directory</span> <span class="o">&lt;</span><span class="n">build</span><span class="o">-</span><span class="nb">dir</span><span class="o">&gt;/</span><span class="n">Testing</span><span class="o">/</span><span class="n">Temporary</span><span class="o">/.</span>


<span class="n">Options</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">--</span><span class="n">deps</span><span class="o">-</span><span class="n">xml</span><span class="o">-</span><span class="n">file</span><span class="o">=</span><span class="n">DEPSXMLFILE</span>
                        <span class="n">File</span> <span class="n">containing</span> <span class="n">the</span> <span class="n">listing</span> <span class="n">of</span> <span class="n">packages</span><span class="p">,</span> <span class="nb">dir</span> <span class="n">names</span><span class="p">,</span>
                        <span class="n">dependencies</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span>
  <span class="o">--</span><span class="n">last</span><span class="o">-</span><span class="n">tests</span><span class="o">-</span><span class="n">failed</span><span class="o">-</span><span class="n">file</span><span class="o">=</span><span class="n">LASTTESTSFAILEDFILE</span>
                        <span class="n">Path</span> <span class="n">to</span> <span class="n">file</span> <span class="n">LastTestsFailed</span><span class="o">*.</span><span class="n">log</span> <span class="n">file</span> <span class="n">generated</span> <span class="n">by</span>
                        <span class="n">CTest</span> <span class="n">under</span> <span class="o">&lt;</span><span class="n">build</span><span class="o">-</span><span class="nb">dir</span><span class="o">&gt;/</span><span class="n">Testing</span><span class="o">/</span><span class="n">Temporary</span><span class="o">/.</span>
</pre></div>
</div>
</section>
<section id="filter-packages-list-py-help">
<span id="filter-packages-list-py"></span><h2><a class="toc-backref" href="#id292"><span class="sectnum">15.11</span> filter-packages-list.py –help</a><a class="headerlink" href="#filter-packages-list-py-help" title="Permalink to this heading"></a></h2>
<p>Below is a snapshot of the output from <code class="docutils literal notranslate"><span class="pre">filter-packages-list.py</span> <span class="pre">--help</span></code>.
For more details see <a class="reference internal" href="#tribits-project-dependencies-xml-file-and-tools">TriBITS Project Dependencies XML file and tools</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Usage</span><span class="p">:</span> <span class="nb">filter</span><span class="o">-</span><span class="n">packages</span><span class="o">-</span><span class="nb">list</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">deps</span><span class="o">-</span><span class="n">xml</span><span class="o">-</span><span class="n">file</span><span class="o">=&lt;</span><span class="n">PROJECT_DEPS_FILE</span><span class="o">&gt;</span> \
  <span class="o">--</span><span class="nb">input</span><span class="o">-</span><span class="n">packages</span><span class="o">-</span><span class="nb">list</span><span class="o">=&lt;</span><span class="n">P1</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="n">P2</span><span class="o">&gt;</span><span class="p">,</span><span class="o">...</span> <span class="o">--</span><span class="n">keep</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">categories</span><span class="o">=&lt;</span><span class="n">T1</span><span class="o">&gt;</span><span class="p">,</span><span class="o">&lt;</span><span class="n">T2</span><span class="o">&gt;</span><span class="p">,</span><span class="o">...</span>

<span class="n">This</span> <span class="n">script</span> <span class="n">takes</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">comma</span><span class="o">-</span><span class="n">separated</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">TriBITS</span> <span class="n">package</span> <span class="n">names</span> <span class="ow">in</span>
<span class="o">--</span><span class="nb">input</span><span class="o">-</span><span class="n">packages</span><span class="o">-</span><span class="nb">list</span><span class="o">=</span><span class="s1">&#39;&lt;P1&gt;,&lt;P2&gt;,...&#39;</span> <span class="ow">and</span> <span class="n">then</span> <span class="n">filters</span> <span class="n">out</span> <span class="n">the</span> <span class="n">names</span> <span class="k">for</span>
<span class="n">packages</span> <span class="n">that</span> <span class="n">don</span><span class="s1">&#39;t match the set categories listed in</span>
<span class="o">--</span><span class="n">keep</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">categories</span><span class="o">=</span><span class="s1">&#39;&lt;T1&gt;,&lt;T2&gt;,...&#39;</span> <span class="p">(</span><span class="n">where</span> <span class="n">each</span> <span class="n">package</span><span class="s1">&#39;s test test</span>
<span class="n">category</span> <span class="ow">is</span> <span class="n">given</span> <span class="n">the</span> <span class="nb">input</span> <span class="n">TriBITS</span><span class="o">-</span><span class="n">generated</span> <span class="n">project</span> <span class="n">dependencies</span> <span class="n">file</span>
<span class="o">--</span><span class="n">deps</span><span class="o">-</span><span class="n">xml</span><span class="o">-</span><span class="n">file</span><span class="o">=&lt;</span><span class="n">PROJECT_DEPS_FILE</span><span class="o">&gt;</span><span class="p">)</span><span class="o">.</span>  <span class="n">The</span> <span class="n">filtered</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">packages</span> <span class="ow">is</span>
<span class="n">printed</span> <span class="n">to</span> <span class="n">STDOUT</span> <span class="k">as</span> <span class="n">a</span> <span class="n">comma</span><span class="o">-</span><span class="n">separated</span> <span class="nb">list</span><span class="o">.</span>

<span class="n">For</span> <span class="n">example</span><span class="p">,</span> <span class="n">to</span> <span class="n">keep</span> <span class="n">only</span> <span class="n">the</span> <span class="n">Primary</span> <span class="n">Tested</span> <span class="p">(</span><span class="n">PT</span><span class="p">)</span> <span class="n">packages</span><span class="p">,</span> <span class="n">use</span><span class="p">:</span>

  <span class="nb">filter</span><span class="o">-</span><span class="n">packages</span><span class="o">-</span><span class="nb">list</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">keep</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">categories</span><span class="o">=</span><span class="n">PT</span> <span class="p">[</span><span class="n">other</span> <span class="n">args</span><span class="p">]</span>

<span class="n">To</span> <span class="n">keep</span> <span class="n">both</span> <span class="n">Primary</span> <span class="n">Tested</span> <span class="ow">and</span> <span class="n">Secondary</span> <span class="n">Tested</span> <span class="n">packages</span><span class="p">,</span> <span class="n">use</span><span class="p">:</span>

  <span class="nb">filter</span><span class="o">-</span><span class="n">packages</span><span class="o">-</span><span class="nb">list</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">keep</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">categories</span><span class="o">=</span><span class="n">PT</span><span class="p">,</span><span class="n">ST</span> <span class="p">[</span><span class="n">other</span> <span class="n">args</span><span class="p">]</span>

<span class="n">To</span> <span class="n">keep</span> <span class="nb">all</span> <span class="n">packages</span><span class="p">,</span> <span class="n">use</span><span class="p">:</span>

  <span class="nb">filter</span><span class="o">-</span><span class="n">packages</span><span class="o">-</span><span class="nb">list</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">keep</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">categories</span><span class="o">=</span><span class="n">PT</span><span class="p">,</span><span class="n">ST</span><span class="p">,</span><span class="n">EX</span> <span class="p">[</span><span class="n">other</span> <span class="n">args</span><span class="p">]</span>

<span class="p">(</span><span class="ow">or</span> <span class="n">don</span><span class="s1">&#39;t bother running the script).</span>


<span class="n">Options</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">--</span><span class="n">deps</span><span class="o">-</span><span class="n">xml</span><span class="o">-</span><span class="n">file</span><span class="o">=</span><span class="n">DEPSXMLFILE</span>
                        <span class="n">TriBITS</span> <span class="n">generated</span> <span class="n">XML</span> <span class="n">file</span> <span class="n">containing</span> <span class="n">the</span> <span class="n">listing</span> <span class="n">of</span>
                        <span class="n">packages</span><span class="p">,</span> <span class="nb">dir</span> <span class="n">names</span><span class="p">,</span> <span class="n">dependencies</span><span class="p">,</span> <span class="n">etc</span><span class="o">.</span>
  <span class="o">--</span><span class="nb">input</span><span class="o">-</span><span class="n">packages</span><span class="o">-</span><span class="nb">list</span><span class="o">=</span><span class="n">INPUTPACKAGESLIST</span>
                        <span class="n">Comma</span><span class="o">-</span><span class="n">seprated</span> <span class="n">List</span> <span class="n">of</span> <span class="n">packages</span> <span class="n">that</span> <span class="n">needs</span> <span class="n">to</span> <span class="n">be</span>
                        <span class="n">filtered</span> <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span> <span class="s2">&quot;P1,P2,...&quot;</span><span class="p">)</span><span class="o">.</span>
  <span class="o">--</span><span class="n">keep</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">test</span><span class="o">-</span><span class="n">categories</span><span class="o">=</span><span class="n">KEEPTESTTESTCATEGORIES</span>
                        <span class="n">List</span> <span class="n">of</span> <span class="n">package</span> <span class="n">types</span> <span class="n">to</span> <span class="n">keep</span> <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span> <span class="s2">&quot;PT,ST,EX&quot;</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="install-devtools-py-help">
<h2><a class="toc-backref" href="#id293"><span class="sectnum">15.12</span> install_devtools.py –help</a><a class="headerlink" href="#install-devtools-py-help" title="Permalink to this heading"></a></h2>
<p>Below is a snapshot of the output from <code class="docutils literal notranslate"><span class="pre">install_devtools.py</span> <span class="pre">--help</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Usage: install-devtools.py [OPTIONS]

This script drives the installation of a number of tools needed by many
TriBITS-based projects.  The most typical usage is to first create a scratch
directory with::

  mkdir scratch
  cd scratch

and then run:

  install-devtools.py --install-dir=&lt;dev_env_base&gt; \
   --parallel=&lt;num-procs&gt; --do-all

By default, this installs the following tools in the dev env install
directory:

  &lt;dev_env_base&gt;/
    common_tools/
      autoconf-&lt;autoconf-version&gt;/
      cmake-&lt;cmake-version&gt;/
      gitdist
    gcc-&lt;gcc-version&gt;/
      load_dev_env.[sh,csh]
      toolset/
        gcc-&lt;gcc-version&gt;/
        mpich-&lt;mpich-version&gt;/

The default versions of the tools installed are:

* autoconf-2.69
* cmake-3.3.2
* gcc-4.8.3
* mpich-3.1.3

The tools installed under common_tools/ only need to be installed once
independent of any compilers that may be used to build TriBITS-based projects.

The tools installed under gcc-&lt;gcc-version&gt;/ are specific to a GCC compiler
and MPICH configuration and build.

The download and install of each of these tools is drive by its own
install-&lt;toolname&gt;.py script in the same directory as install-devtools.py.

Before running this script, some version of a C and C++ compiler must already
be installed on the system.  

At a high level, this script performs the following actions.

1) Create the base directories (if they don&#39;t already exist) and install
   load_dev_env.sh (csh).  (if --initial-setup is passed in.)

2) Download the sources for all of the requested common tools and compiler
   toolset.  (if --download is passed in.)

3) Configure, build, and install the requested common tools under
   common_tools/. (if --install is passed in.)

4) Configure, build, and install the downloaded GCC and MPICH tools.  First
   install GCC then MPICH using the installed GCC and install under
   gcc-&lt;gcc-version&gt;/.  (if --install is passed in.)

The informational arguments to this function are:

  --install-dir=&lt;dev_env_base&gt;

    The base directory that will be used for the install.  There is not
    default.  If this is not specified then it will abort.

  --source-git-url-base=&lt;url_base&gt;
  
    Gives the base URL for to get the tool sources from.  The default is:
  
      https://github.com/tribitsdevtools/
  
    This is used to build the full git URL as:
  
      &lt;url_base&gt;&lt;tool_name&gt;-&lt;tool_version&gt;-base
  
    This can also accomidate gitolite repos and other directory structures,
    for example, with:
  
      git@&lt;host-name&gt;:prerequisites/
  
  --common-tools=all
  
    Specifies the tools to download and install under common_tools/.  One can
    pick specific tools with:
  
      --common-tools=autoconf,cmake,...
  
    This will download and install the default versions of these tools.  To
    select specific versions, use:
  
      --common-tools=autoconf:2.69,cmake:3.3.2,...

    The default is &#39;all&#39;.  To install none of these, pass in empty:

      --common-tools=&#39;&#39;

    (NOTE: A version of &#39;git&#39; is *not* installed using this script but can be
    installed using the script install-git.py.  But note the extra packages
    that must be installed on a system in order to fully install git and its
    documentation.  All of the git-related TriBITS tools can use any recent
    version of git and most systems will already have a current-enough version
    of git so there is no need to install one to be effective doing
    development.)
  
  --compiler-toolset=all
  
    Specifies GCC and MPICH (and other compiler-specific tools) to download
    and install under gcc-&lt;gcc-version&gt;/toolset/.  One can pick specific
    components with:
  
      --compiler-toolset=gcc,mpich
  
    or specific versions with:
  
      --compiler-toolset=gcc:4.8.3,mpich:3.1.3
  
    Of course if one is only installing GCC with an existing installed MPICH,
    one will need to also reinstall MPICH as well.

    The default is &#39;all&#39;.  To install none of these, pass in empty:

      --compiler-toolset=&#39;&#39;

The action arguments are:

  --initial-setup: Create &lt;dev_env_base&gt;/ directories and install
    load_dev_env.sh
  
  --download: Download all of the requested tools
  
  --install: Configure, build, and install all of the requested tools
  
  --do-all: Do everything.  Implies --initial-setup --downlaod --install

To change modify the permissions of the installed files, see the options
--install-owner, --install-group, and --install-for-all.

Note that the user can see what operations and command would be run without
actually running them by passing in --no-op.  This can be used to show how to
run each of the individual install command so that the user can run it for
him/her-self and customize it as needed.

If the user needs more customization, then they can just run with --do-all
--no-op and see what commands are run to install things and then they can run
the commands themselves manually and make whatever modifications they need.

NOTE: The actual tool installs are performed using the scripts:

* install-autoconf.py
* install-cmake.py
* install-gcc.py
* install-git.py
* install-mpich.py
* install-openmpi.py

More information about what versions are installed, how they are installed,
etc. is found in these scripts.  Note that some of these scripts apply patches
for certain versions.  For details, look at the --help output from these
scripts and look at the implementation of these scripts.


Options:
  -h, --help            show this help message and exit
  --install-dir=INSTALLDIR
                        The base directory &lt;dev_env_base&gt; that will be used
                        for the install.  There is not default.  If this is
                        not specified then will abort.
  --install-owner=INSTALLOWNER
                        If set, then &#39;chown -R &lt;install-owner&gt; &lt;install-dir&gt;&#39;
                        will be run after install.  Note that you can only
                        change the owner when running this script as sudo.
  --install-group=INSTALLGROUP
                        If set, then &#39;chgrp -R &lt;install-group&gt; &lt;install-dir&gt;&#39;
                        and &#39;chmod -R g+rX &lt;install-dir&gt; will be run after
                        install.  Note that you can only change a to a group
                        that the owner is a member of.
  --install-for-all     If set, then &#39;chmod -R a+rX &lt;install-dir&gt;&#39; will be run
                        after install.
  --no-install-for-all  If set, then &lt;install-dir&gt; is not opened up to
                        everyone.
  --source-git-url-base=SOURCEGITURLBASE
                        Gives the base URL &lt;url_base&gt; for the git repos to
                        object the source from.
  --load-dev-env-file-base-name=LOADDEVENVFILEBASENAME
                        Base name of the load dev env script that will be
                        installed.  (Default = &#39;load_dev_env&#39;)
  --common-tools=COMMONTOOLS
                        Specifies the common tools to download and install
                        under common_tools/.  Can be &#39;all&#39;, or empty &#39;&#39;, or
                        any combination of &#39;gitdist,autoconf,cmake&#39; (separated
                        by commas, no spaces).
  --compiler-toolset=COMPILERTOOLSET
                        Specifies GCC and MPICH and other compiler-specific
                        tools to download and install under gcc-&lt;gcc-
                        version&gt;/toolset/.  Can be &#39;all&#39;, or empty &#39;&#39;, or any
                        combination of &#39;gcc,mpich&#39; (separated by commas, no
                        spaces).
  --parallel=PARALLELLEVEL
                        Number of parallel processes to use in the build.  The
                        default is just &#39;1&#39;.  Use something like &#39;8&#39; to get
                        faster parallel builds.
  --do-op               Do all of the requested actions [default].
  --no-op               Skip all of the requested actions and just print what
                        would be done.
  --show-defaults       [ACTION] Show the defaults and exit.
  --initial-setup       [ACTION] Create base directories under &lt;dev_env_base&gt;/
                        and install load_dev_env.[sh,csh].
  --download            [ACTION] Download all of the tools specified by
                        --common-tools and --compiler-toolset.  WARNING:  If
                        the source for a tool has already been downloaded, it
                        will be deleted (along with the build directory) and
                        downloaded from scratch!
  --install             [ACTION] Configure, build, and install all of the
                        tools specified by --common-tools and --compiler-
                        toolset.
  --show-final-instructions
                        [ACTION] Show final instructions for using the
                        installed dev env.
  --do-all              [AGGR ACTION] Do everything.  Implies --initial-setup
                        --downlaod --install --show-final-instructions
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Roscoe A. Bartlett.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>