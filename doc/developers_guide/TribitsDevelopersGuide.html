<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
<title>TriBITS Developers Guide</title>
<meta name="author" content="Roscoe A. Bartlett (bartlettra&#64;ornl.gov)" />
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 5951 2009-05-18 18:03:10Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left{
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: left }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="tribits-developers-guide">
<h1 class="title">TriBITS Developers Guide</h1>
<table class="docinfo" frame="void" rules="none">
<col class="docinfo-name" />
<col class="docinfo-content" />
<tbody valign="top">
<tr><th class="docinfo-name">Author:</th>
<td>Roscoe A. Bartlett (<a class="reference external" href="mailto:bartlettra&#64;ornl.gov">bartlettra&#64;ornl.gov</a>)</td></tr>
</tbody>
</table>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="auto-toc simple">
<li><a class="reference internal" href="#introduction" id="id3">1&nbsp;&nbsp;&nbsp;Introduction</a></li>
<li><a class="reference internal" href="#structure-of-a-tribits-project" id="id4">2&nbsp;&nbsp;&nbsp;Structure of a TriBITS Project</a></li>
<li><a class="reference internal" href="#tribits-global-project-settings" id="id5">3&nbsp;&nbsp;&nbsp;TriBITS Global Project Settings</a></li>
<li><a class="reference internal" href="#tribits-macros-and-functions" id="id6">4&nbsp;&nbsp;&nbsp;TriBITS Macros and Functions</a><ul class="auto-toc">
<li><a class="reference internal" href="#tribits-define-repository-packages-dirs-classifications" id="id7">4.1&nbsp;&nbsp;&nbsp;TRIBITS_DEFINE_REPOSITORY_PACKAGES_DIRS_CLASSIFICATIONS()</a></li>
<li><a class="reference internal" href="#tribits-define-repository-tpls-findmods-classifications" id="id8">4.2&nbsp;&nbsp;&nbsp;TRIBITS_DEFINE_REPOSITORY_TPLS_FINDMODS_CLASSIFICATIONS()</a></li>
<li><a class="reference internal" href="#tribits-define-package-dependencies" id="id9">4.3&nbsp;&nbsp;&nbsp;TRIBITS_DEFINE_PACKAGE_DEPENDENCIES()</a></li>
<li><a class="reference internal" href="#tribits-allow-missing-external-packages" id="id10">4.4&nbsp;&nbsp;&nbsp;TRIBITS_ALLOW_MISSING_EXTERNAL_PACKAGES()</a></li>
<li><a class="reference internal" href="#tribits-tpl-declare-libraries" id="id11">4.5&nbsp;&nbsp;&nbsp;TRIBITS_TPL_DECLARE_LIBRARIES()</a></li>
<li><a class="reference internal" href="#tribits-package" id="id12">4.6&nbsp;&nbsp;&nbsp;TRIBITS_PACKAGE()</a></li>
<li><a class="reference internal" href="#tribits-package-decl" id="id13">4.7&nbsp;&nbsp;&nbsp;TRIBITS_PACKAGE_DECL()</a></li>
<li><a class="reference internal" href="#tribits-package-def" id="id14">4.8&nbsp;&nbsp;&nbsp;TRIBITS_PACKAGE_DEF()</a></li>
<li><a class="reference internal" href="#tribits-process-subpackages" id="id15">4.9&nbsp;&nbsp;&nbsp;TRIBITS_PROCESS_SUBPACKAGES()</a></li>
<li><a class="reference internal" href="#tribits-add-test-directories" id="id16">4.10&nbsp;&nbsp;&nbsp;TRIBITS_ADD_TEST_DIRECTORIES()</a></li>
<li><a class="reference internal" href="#tribits-add-example-directories" id="id17">4.11&nbsp;&nbsp;&nbsp;TRIBITS_ADD_EXAMPLE_DIRECTORIES()</a></li>
<li><a class="reference internal" href="#tribits-set-st-for-dev-mode" id="id18">4.12&nbsp;&nbsp;&nbsp;TRIBITS_SET_ST_FOR_DEV_MODE()</a></li>
<li><a class="reference internal" href="#tribits-add-library" id="id19">4.13&nbsp;&nbsp;&nbsp;TRIBITS_ADD_LIBRARY()</a></li>
<li><a class="reference internal" href="#tribits-add-executable" id="id20">4.14&nbsp;&nbsp;&nbsp;TRIBITS_ADD_EXECUTABLE()</a></li>
<li><a class="reference internal" href="#tribits-add-test" id="id21">4.15&nbsp;&nbsp;&nbsp;TRIBITS_ADD_TEST()</a></li>
<li><a class="reference internal" href="#tribits-add-advanced-test" id="id22">4.16&nbsp;&nbsp;&nbsp;TRIBITS_ADD_ADVANCED_TEST()</a></li>
<li><a class="reference internal" href="#tribits-package-postprocess" id="id23">4.17&nbsp;&nbsp;&nbsp;TRIBITS_PACKAGE_POSTPROCESS()</a></li>
</ul>
</li>
<li><a class="reference internal" href="#references" id="id24">5&nbsp;&nbsp;&nbsp;References</a></li>
<li><a class="reference internal" href="#appendix" id="id25">6&nbsp;&nbsp;&nbsp;Appendix</a><ul class="auto-toc">
<li><a class="reference internal" href="#history-of-tribits" id="id26">6.1&nbsp;&nbsp;&nbsp;History of TriBITS</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h1><a class="toc-backref" href="#id3">1&nbsp;&nbsp;&nbsp;Introduction</a></h1>
<p>This document describes the usage of the TriBITS (Tribal Build, Integration,
Test System) to develop software projects.  An initial overview of TriBITS is
provided in the <a class="reference external" href="../overview/TribitsOverview.pdf">TriBITS Overview</a> document
which contains the big picture and provides a high-level road map to what
TriBITS provides.  This particular document, however, describes the details on
how to use the TriBITS system to create a CMake build system for a set of
compiled software packages.</p>
<p>TriBITS is a fairly extensive framework that is build on
CMake/CTest/CPack/CDash which in of itself is a very extensive system of
software and tools.  The most important thing to remember is that software
project that use TriBITS are really just CMake projects.  TriBITS makes no
attent to hide that either from the TriBITS project developers or from the
users that need to configure and build the software.  Therefore, to make
effective usage of TriBITS, one must learn the basics of CMake.  In
particular, CMake is a Turning complete programming lanauge with local and
global variables (with strange scoping rules), macros, functions, targets,
commands, and other features.  One needs to understand how to define and use
variables, macros, functions in CMake.  One needs to know how to debug
CMakeLists.txt files and CMake code in general (i.e. using <tt class="docutils literal">MESSAGE()</tt> print
statements).  One needs to understand how CMake defines and uses targets for
various qualities like libraries, executables, etc.  Without this basic
understanding of CMake, one will have trouble resolving problems when they
might occur.</p>
</div>
<div class="section" id="structure-of-a-tribits-project">
<h1><a class="toc-backref" href="#id4">2&nbsp;&nbsp;&nbsp;Structure of a TriBITS Project</a></h1>
<p>???</p>
</div>
<div class="section" id="tribits-global-project-settings">
<h1><a class="toc-backref" href="#id5">3&nbsp;&nbsp;&nbsp;TriBITS Global Project Settings</a></h1>
<p>TriBITS defines a number of global project-level settings that can be set by
the user and can have their default determined by each individual TriBITS
project.  If a given TriBITS project does not define its own default, a
reasonble default is set by the TriBITS system automatically.</p>
<p>ToDo: Document what parameters influence the entire TriBITS project, what
parameters can have project-specific defaults, etc.</p>
</div>
<div class="section" id="tribits-macros-and-functions">
<h1><a class="toc-backref" href="#id6">4&nbsp;&nbsp;&nbsp;TriBITS Macros and Functions</a></h1>
<p>The following subsections give detailed documentation for the macros and
functions that make up the core TriBITS system.  These are what are used by
TriBITS project developers in their <tt class="docutils literal">CMakeLists.txt</tt> and other files.  These
are listed in approximately the order they will be encounted in a project or
packages <tt class="docutils literal">CMakeLists.txt</tt> and other files.</p>
<!-- WARNING: The file TribitsDetailedMacroFunctionDoc.rst is autogenerated from -->
<!-- the file TribitsDetailedMacroFunctionDocTemplate.rst in the script -->
<!-- generate-dev-guide.sh.  Only the file TribitsDetailedMacroFunctionDoc.rst -->
<!-- should be directly modified! -->
<div class="section" id="tribits-define-repository-packages-dirs-classifications">
<h2><a class="toc-backref" href="#id7">4.1&nbsp;&nbsp;&nbsp;TRIBITS_DEFINE_REPOSITORY_PACKAGES_DIRS_CLASSIFICATIONS()</a></h2>
<p>Define the set of packages for a given TriBIT repo.  This macro is typically
called from inside of a PackagesList.cmake file for a given TriBITS repo.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_DEFINE_REPOSITORY_PACKAGES_DIRS_CLASSIFICATIONS(
   &lt;pkg0&gt;  &lt;pkg0_dir&gt;  &lt;pkg0_classifications&gt;
   ...
   &lt;pkgnm1&gt;  &lt;pkgnm1_dir&gt;  &lt;pkgnm1_classifications&gt;
   )
</pre>
<p>This macro sets up a 2D array of NumPackages by NumColumns listing out the
packages for a TriBITS repository.  Each row (with 3 entries) specifies a
package which contains the three columns:</p>
<ul class="simple">
<li><strong>PACKAGE</strong>: The name of the TriBITS package.  This name must be unique
across all other TriBITS packages in this or any other TriBITS repo that
might be combined into a single TriBITS project meta-build.  The name
should be a valid identifier (e.g. matches the regex
<tt class="docutils literal"><span class="pre">[a-zA-Z_][a-zA-Z0-9_]*</span></tt>).</li>
<li><strong>DIR</strong>: The relative directory for the package.  This is relative to the
TriBITS repository base directory.  Under this directory will be a
package-specific 'cmake/' directory with file 'cmake/Dependencies.cmake'
and a base-level CMakeLists.txt file.  The entire contents of the package
including all of the source code and all of the tests should be contained
under this directory.  The TriBITS testing infrastructure relies on the
mapping of changed files to these base directories when deciding what
packages are modified and need to be retested (along with downstream
packages).</li>
<li><strong>CLASSIFICATION</strong>: Gives the testing group PT, ST, EX and
the maturity level EP, RS, PG, PM, GRS, GPG, GPM, UM.  These are seprated
by a coma with no space in between such as &quot;RS,PT&quot; for a &quot;Research
Stable&quot;, &quot;Primary Tested&quot; package.  No spaces are allowed so that CMake
treats this a one field in the array.  The maturity level can be left off
in which case it is assumed to be UM for &quot;Unspecified Maturity&quot;.</li>
</ul>
<blockquote>
<p>NOTE: This macro just sets the varaible
${REPOSITORY_NAME}_PACKAGES_AND_DIRS_AND_CLASSIFICATIONS in the current
scope.  The advantages of using this macro instead of directly setting this
varible include:</p>
<ul class="simple">
<li>Asserts that REPOSITORY_NAME is defined and set</li>
<li>Avoids having to hard-code the assumed repository name
${REPOSITORY_NAME}.  This provides more flexibility for how other TriBITS
project name a given TriBITS repo (i.e. the name of repo subdirs).</li>
<li>Avoid mispelling the name of the varible
${REPOSITORY_NAME}_PACKAGES_AND_DIRS_AND_CLASSIFICATIONS.  If you misspell
the name of the macro, it is an immediate error in CMake.</li>
</ul>
</blockquote>
</div>
<div class="section" id="tribits-define-repository-tpls-findmods-classifications">
<h2><a class="toc-backref" href="#id8">4.2&nbsp;&nbsp;&nbsp;TRIBITS_DEFINE_REPOSITORY_TPLS_FINDMODS_CLASSIFICATIONS()</a></h2>
<p>Define the list of TPLs, find modules, and classifications for a given
TriBITS repository.  This macro is typically called from inside of a
TPLsList.cmake fil for a given TriBITS repo.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_DEFINE_REPOSITORY_TPLS_FINDMODS_CLASSIFICATIONS(
  &lt;tpl0_name&gt;   &lt;tpl0_findmod&gt;  &lt;tpl0_classification&gt;
  ...
  &lt;tplnm1_name&gt;   &lt;tplnm1_findmod&gt;  &lt;tplnm1_classification&gt;
</pre>
<p>This macro sets up a 2D array of NumTPLS by NumColumns listing out the
TPLs for a TriBITS repository.  Each row (with 3 entries) specifies a
package which contains the three columns:</p>
<ul class="simple">
<li><strong>TPL</strong>: The name of the TriBITS TPL &lt;TPL_NAME&gt;.  This name must be unique
across all other TriBITS TPLs in this or any other TriBITS repo that might
be combined into a single TriBITS project meta-build.  However, a TPL can
be redefined (see below).  The name should be a valid identifier
(e.g. matches the regex <tt class="docutils literal"><span class="pre">[a-zA-Z_][a-zA-Z0-9_]*</span></tt>).</li>
<li><strong>FINDMOD</strong>: The relative directory for the find module, usually with the
name FindTPL&lt;TPL_NAME&gt;.cmake.  This is relative to the repository base
directory.  If just the base path for the find module is given, ending
with &quot;/&quot; (e.g. &quot;cmake/tpls/&quot;) then the find module will be assumed to be
under that this directory with the standard name
(e.g. &quot;cmake/tpls/FindTPL&lt;TPL_NAME&gt;.cmake&quot;).  A standard way to write a
FindTPL&lt;TPL_NAME&gt;.cmake module is to use the function
<a class="reference internal" href="#tribits-tpl-declare-libraries">TRIBITS_TPL_DECLARE_LIBRARIES()</a>.</li>
<li><strong>CLASSIFICATION</strong>: Gives the testing group PT, ST, EX and the maturity
level EP, RS, PG, PM, GRS, GPG, GPM, UM.  These are seprated by a coma
with no space in between such as &quot;RS,PT&quot; for a &quot;Research Stable&quot;, &quot;Primary
Tested&quot; package.  No spaces are allowed so that CMake treats this a one
field in the array.  The maturity level can be left off in which case it
is assumed to be UM for &quot;Unspecified Maturity&quot;.</li>
</ul>
<p>NOTE: A TPL defined in a upstream repo can listed again, which allows
redefining the find module that is used to specificy the TPL.  This allows
downstream repos to add additional requirements on a given TPL.  However,
the downstream repo's find module file must find the TPL components that are
fully compatible with the upstream's find module.</p>
<p>NOTE: This macro just sets the varaible
${REPOSITORY_NAME}_TPLS_FINDMODS_CLASSIFICATIONS in the current
scope.  The advantages of using this macro instead of directly setting this
varible include:</p>
<ul class="simple">
<li>Asserts that REPOSITORY_NAME is defined and set</li>
<li>Avoids having to hard-code the assumed repository name ${REPOSITORY_NAME}.
This provides more flexibility for how other TriBITS project name a given
TriBITS repo (i.e. the name of repo subdirs).</li>
<li>Avoid mispelling the name of the varible
${REPOSITORY_NAME}_.  If you misspell
the name of the macro, it is an immediate error in CMake.</li>
</ul>
</div>
<div class="section" id="tribits-define-package-dependencies">
<h2><a class="toc-backref" href="#id9">4.3&nbsp;&nbsp;&nbsp;TRIBITS_DEFINE_PACKAGE_DEPENDENCIES()</a></h2>
<p>Define the dependenices for a given TriBITS SE package (i.e. a top-level
package or a subpackage).</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_DEFINE_PACKAGE_DEPENDENCIES(
   [LIB_REQUIRED_PACKAGES &lt;pkg1&gt; &lt;pkg2&gt; ...]
   [LIB_OPTIONAL_PACKAGES &lt;pkg1&gt; &lt;pkg2&gt; ...]
   [TEST_REQUIRED_PACKAGES &lt;pkg1&gt; &lt;pkg2&gt; ...]
   [TEST_OPTIONAL_PACKAGES &lt;pkg1&gt; &lt;pkg2&gt; ...]
   [LIB_REQUIRED_TPLS &lt;tpl1&gt; &lt;tpl2&gt; ...]
   [LIB_OPTIONAL_TPLS &lt;tpl1&gt; &lt;tpl2&gt; ...]
   [TEST_REQUIRED_TPLS &lt;tpl1&gt; &lt;tpl2&gt; ...]
   [TEST_OPTIONAL_TPLS &lt;tpl1&gt; &lt;tpl2&gt; ...]
   [REGRESSION_EMAIL_LIST  &lt;regression-email-address&gt;
   [SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS
     &lt;spkg1_name&gt;  &lt;spkg1_dir&gt;  &lt;spkg1_classifications&gt;  &lt;spkg1_optreq&gt;
     &lt;spkg2_name&gt;  &lt;spkg2_dir&gt;  &lt;spkg2_classifications&gt;  &lt;spkg2_optreq&gt;
     ...
     ]
   )
</pre>
<p>Every argument in this macro is optional.  The arguments that apply a package
itself are:</p>
<ul class="simple">
<li><strong>LIB_REQUIRED_PACKAGES:</strong> List of upstream packages that must be enabled
in order to build and use the libraries (or capabilities) in this
package.</li>
<li><strong>LIB_OPTIONAL_PACKAGES:</strong> List of additional optional upstream packages
that can be used in this package if enabled.  These upstream packages need
not be enabled in order to use this package but not enabling one or more
of these optional upstream packages will result in diminished capabilities
of this package.</li>
<li><strong>TEST_REQUIRED_PACKAGES:</strong> List of additional upstream packages that must
be enabled in order to build and/or run the tests and/or examples in this
packages.  If any of these upstream packages is not enabled, then there
will be no tests or examples defined or run for this package.</li>
<li><strong>TEST_OPTIONAL_PACKAGES:</strong> List of additional optional upstream packages
that can be used by the tests in this package.  These upstream packages
need not be enabled in order to run basic tests for this package.
Typically, extra tests that depend on optional test packages involve
integration testing of some type.</li>
<li><strong>LIB_REQUIRED_TPLS:</strong> List of upstream TPLs that must be enabled in order
to build and use the libraries (or capabilities) in this package.</li>
<li><strong>LIB_OPTIONAL_TPLS:</strong> List of additional optional upstream TPLs that can
be used in this package if enabled.  These upstream TPLs need not be
enabled in order to use this package but not enabling one or more of these
optional upstream TPLs will result in diminished capabilities of this
package.</li>
<li><strong>TEST_REQUIRED_TPLS:</strong> List of additional upstream TPLs that must
be enabled in order to build and/or run the tests and/or examples in this
packages.  If any of these upstream TPLs is not enabled, then there
will be no tests or examples defined or run for this package.</li>
<li><strong>TEST_OPTIONAL_TPLS:</strong> List of additional optional upstream TPLs
that can be used by the tests in this package.  These upstream TPLs
need not be enabled in order to run basic tests for this package.
Typically, extra tests that depend on optional test TPLs involve
integration testing of some type.</li>
</ul>
<p>Only direct package dependenices need to be listed.  Indirect package
dependencies are automatically handled.  For example, if this SE package
directly depends on PKG2 which depends on PKG1 (but this SE package does not
directly depend on anything in PKG1) then this package only needs to list a
dependency on PKG2, not PKG1.  The dependnecy on PKG1 will be taken care of
automatically by the TriBITS dependency tracking system.</p>
<p>However, currently, all TPL dependendies must be listed, even the indirect
ones.  This is a requirement that will be dropped in the future.</p>
<p>The packages listed in LIB_REQUIRED_PACKAGES are implicitly also
dependenices in TEST_REQUIRED_PACKAGES.  Likewise LIB_OPTIONAL_PACKAGES are
implicitly also dependenices in TEST_OPTIONAL_PACKAGES.  Same goes for TPL
dependencies.</p>
<p>The dependencies within a single list do not need to be listed in any order.
For example if PKG2 depends on PKG1, and this given SE package depends on
both, one can list &quot;LIB_REQUIRED_PACKAGES PKG2 PKG1&quot; or
&quot;LIB_REQUIRED_PACKAGES PKG1 PKG2&quot;.  Likewise the listing of TPLs order is
not important.</p>
<p>If some upstream packages are allowed to be missing, this can be specified
by calling the macro <a class="reference internal" href="#tribits-allow-missing-external-packages">TRIBITS_ALLOW_MISSING_EXTERNAL_PACKAGES()</a>.</p>
<p>A top-level package can also have subpackages.  In this case, the following
varible must be set:</p>
<ul class="simple">
<li><strong>SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS:</strong> 2D array with rows listing
the subpackages and the columns:<ul>
<li><strong>SUBPACKAGE:</strong> The name of the subpackage &lt;spkg_name&gt;.  The full SE
package name is &quot;${PARENT_PACKAGE_NAME}&lt;spkg_name&gt;&quot;.  The full SE
package name is what is used in listing dependenices in other SE
packages.</li>
<li><strong>DIRS:</strong> The subdirectory &lt;spkg_dir&gt; relative to the parent package's
base directory.  All of the contents of the subpackage should be under
this subdirectory.  This is assumed by the TriBITS testing support
software when mapping modified files to SE packages that need to be
tested.</li>
<li><strong>CLASSIFICATIONS*</strong>: The test group PT, ST, EX and the maturity level
EP, RS, PG, PM, GRS, GPG, GPM, and UM, separated by a coma ',' with no
spaces in between (e.g. &quot;PT,GPM&quot;).  These have exactly the name meaning
as for full packages (see
<a class="reference internal" href="#tribits-define-repository-packages-dirs-classifications">TRIBITS_DEFINE_REPOSITORY_PACKAGES_DIRS_CLASSIFICATIONS()</a>).</li>
<li><strong>OPTREQ:</strong> Determines if the outer parent package has an OPTIONAL or
REQUIRED dependence on this subpackage.</li>
</ul>
</li>
</ul>
<p>Other variables that this macro handles:</p>
<ul class="simple">
<li><strong>REGRESSION_EMAIL_LIST:</strong> The email list that is used to send CDash error
messages.  If this is missing, then the email list that CDash errors go to
is determined by other means (see ???).</li>
</ul>
<p>NOTE: All this macro really does is to just define the variables:</p>
<ul class="simple">
<li>LIB_REQUIRED_DEP_PACKAGES</li>
<li>LIB_OPTIONAL_DEP_PACKAGES</li>
<li>TEST_REQUIRED_DEP_PACKAGES</li>
<li>TEST_OPTIONAL_DEP_PACKAGES</li>
<li>LIB_REQUIRED_DEP_TPLS</li>
<li>LIB_OPTIONAL_DEP_TPLS</li>
<li>TEST_REQUIRED_DEP_TPLS</li>
<li>TEST_OPTIONAL_DEP_TPLS</li>
<li>REGRESSION_EMAIL_LIST</li>
<li>SUBPACKAGES_DIRS_CLASSIFICATIONS_OPTREQS</li>
</ul>
<p>which are then read by the TriBITS cmake code to build the package
dependency graph.  The advantage of using this macro instead of just
directly setting the varibles is that you only need to list the dependencies
you have.  Otherwise, you need to set all of these varibles, even those that
are empty.  This is a error checking property of the TriBITS system to avoid
misspelling the names of these variables.</p>
</div>
<div class="section" id="tribits-allow-missing-external-packages">
<h2><a class="toc-backref" href="#id10">4.4&nbsp;&nbsp;&nbsp;TRIBITS_ALLOW_MISSING_EXTERNAL_PACKAGES()</a></h2>
<p>Macro used in Dependencies.cmake files to allow some upstream dependent packages
to be missing.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_ALLOW_MISSING_EXTERNAL_PACKAGES(&lt;pack_1&gt; &lt;pack_2&gt; ...)
</pre>
<p>If the missing upstream SE package &lt;pack_i&gt; is optional, then the effect
will be to simply ignore the missing package and remove it from the
dependency list.  However, if the missing upstream SE package &lt;pack_i&gt; is
required, then in addition to ignoring the missing package, the current SE
(sub)package will also ee hard disabled,
i.e. ${PROJECT_NAME}_ENABLE_{CURRENT_PACKAGE}=OFF.</p>
<p>This function is typically used in packages in external TriBITS repos that
are depend on other packages in other exteral TriBITS repos that might be
missing.</p>
<p>NOTE: Using this function effectively turns off error checking for
misspelled package names so it is important to only use it when it
absolutely is needed.</p>
</div>
<div class="section" id="tribits-tpl-declare-libraries">
<h2><a class="toc-backref" href="#id11">4.5&nbsp;&nbsp;&nbsp;TRIBITS_TPL_DECLARE_LIBRARIES()</a></h2>
<p>Function that sets up cache variables for users to specify where to find a
TPL's headers and libraries.  This function is typically called inside of a
file <tt class="docutils literal"><span class="pre">FindTPL&lt;tpl_name&gt;.cmake</span></tt> file.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_TPL_DECLARE_LIBRARIES(
  &lt;tpl_name&gt;
  [REQUIRED_HEADERS &lt;header1&gt; &lt;header2&gt; ...]
  [MUST_FIND_ALL_HEADERS]
  [REQUIRED_LIBS_NAMES &lt;libname1&gt; &lt;libname2&gt; ...]
  [MUST_FIND_ALL_LIBS]
  [NO_PRINT_ENABLE_SUCCESS_FAIL]
  )
</pre>
<p>This function can set up a with header files and/or libraries.</p>
<p>The input arguments to this function are:</p>
<ul>
<li><p class="first"><tt class="docutils literal">&lt;tpl_name&gt;</tt>: Name of the TPL that is listed in a TPLsList.cmake file.
Below, this is referted to as the local CMake variable <tt class="docutils literal">TPL_NAME</tt>.</p>
</li>
<li><p class="first"><tt class="docutils literal">REQUIRED_HEADERS</tt>: List of header files that are searched for the TPL
using <tt class="docutils literal">FIND_PATH()</tt>.</p>
</li>
<li><p class="first"><tt class="docutils literal">MUST_FIND_ALL_HEADERS</tt>:  If set, then all of the header files listed in
REQUIRED_HEADERS must be found in order for TPL_${TPL_NAME}_INCLUDE_DIRS
to be defined.</p>
</li>
<li><p class="first"><tt class="docutils literal">REQUIRED_LIBS_NAMES</tt>: List of libraries that are searched for when
looked for the TPLs libraries with FIND_LIBRARY(...).</p>
</li>
<li><p class="first"><tt class="docutils literal">MUST_FIND_ALL_LIBS</tt>:  If set, then all of the library files listed in
REQUIRED_LIBS_NAMES must be found or the TPL is considered not
found!</p>
</li>
<li><dl class="first docutils">
<dt><tt class="docutils literal">NO_PRINT_ENABLE_SUCCESS_FAIL</tt>: If set, then the final success/fail</dt>
<dd><p class="first last">will not be printed</p>
</dd>
</dl>
</li>
</ul>
<p>The following cache variables, if set, will be used by that this function:</p>
<ul class="simple">
<li><tt class="docutils literal">${TPL_NAME}_INCLUDE_DIRS:PATH</tt>: List of paths to search first for
header files defined in <tt class="docutils literal">REQUIRED_HEADERS</tt>.</li>
<li><tt class="docutils literal">${TPL_NAME}_INCLUDE_NAMES:STIRNG</tt>: List of include names to be looked
for instead of what is specified in REQUIRED_HEADERS.</li>
<li><tt class="docutils literal">${TPL_NAME}_LIBRARY_DIRS:PATH</tt>: The list of directories to search first
for libraies defined in REQUIRED_LIBS_NAMES.</li>
<li><tt class="docutils literal">${TPL_NAME}_LIBRARY_NAMES:STIRNG</tt>: List of library names to be looked
for instead of what is specified in REQUIRED_LIBS_NAMES.</li>
</ul>
<p>This function sets global varibles to return state so it can be called from
anywhere in the call stack.  The following cache variables defined that are
intended for the user to set and/or use:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">TPL_${TPL_NAME}_INCLUDE_DIRS</span></tt>: A list of common-separated full
directory paths that contain the TPLs headers.  If this varible is set
before calling this function, then no headers are searched for and this
variable will be assumed to have the correct list of header paths.</li>
<li><tt class="docutils literal"><span class="pre">TPL_${TPL_NAME}_LIBRARIES</span></tt>: A list of commons-seprated full library
names (output from FIND_LIBRARY(...)) for all of the libraries found for
the TPL.  IF this varible is set before calling this function, no
libraries are searched for and this varaible will be assumed to have the
correct list of libraries to link to.</li>
</ul>
</div>
<div class="section" id="tribits-package">
<h2><a class="toc-backref" href="#id12">4.6&nbsp;&nbsp;&nbsp;TRIBITS_PACKAGE()</a></h2>
<p>Macro called at the very beginning of a ${PROJECT_NAME} package's top-level
CMakeLists.txt file.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_PACKAGE(
  &lt;packageName&gt;
  [ENABLE_SHADOWING_WARNINGS]
  [DISABLE_STRONG_WARNINGS]
  [CLEANED]
  [DISABLE_CIRCULAR_REF_DETECTION_FAILURE]
  )
</pre>
<p>See <a class="reference internal" href="#tribits-package-decl">TRIBITS_PACKAGE_DECL()</a> for the documentation for the arguments and
<a class="reference internal" href="#tribits-package-decl">TRIBITS_PACKAGE_DECL()</a> and <a class="reference internal" href="#tribits-package">TRIBITS_PACKAGE()</a> for a description of the
arguments and the side-effects (and varibles set) of calling this macro.</p>
</div>
<div class="section" id="tribits-package-decl">
<h2><a class="toc-backref" href="#id13">4.7&nbsp;&nbsp;&nbsp;TRIBITS_PACKAGE_DECL()</a></h2>
<p>Macro called at the very beginning of a ${PROJECT_NAME}
package's top-level CMakeLists.txt file when a packages has subpackages.</p>
<p>If the package does not have subpackages, just call <a class="reference internal" href="#tribits-package">TRIBITS_PACKAGE()</a>
which calls this macro.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_PACKAGE_DECL(
  &lt;packageName&gt;
  [ENABLE_SHADOWING_WARNINGS]
  [DISABLE_STRONG_WARNINGS]
  [CLEANED]
  [DISABLE_CIRCULAR_REF_DETECTION_FAILURE]
  )
</pre>
<p>The arguments are:</p>
<ul class="simple">
<li><tt class="docutils literal">&lt;packageName&gt;</tt>: Gives the name of the Package, mostly just for checking
and documentation purposes.  This much match the name of the package
provided in the PackagesLists.cmake or it is an error.</li>
<li><tt class="docutils literal">ENABLE_SHADOWING_WARNINGS</tt>:If specified, then shadowing warnings will
be turned on for supported platforms/compilers.  The default is for
shadowing warnings to be turned off.  Note that this can be overridden
globally by setting the cache variable
${PROJECT_NAME}_ENABLE_SHADOWING_WARNINGS.</li>
<li><tt class="docutils literal">DISABLE_STRONG_WARNINGS</tt>: If specified, then all strong warnings will
be turned off, if they are not already turned off by global cache
variables.  Strong warnings are turned on by default in development mode.</li>
<li><tt class="docutils literal">CLEANED</tt>:If specified, then warnings will be promoted to errors for all
defined warnings.</li>
<li><tt class="docutils literal">DISABLE_CIRCULAR_REF_DETECTION_FAILURE</tt>: If specified, then the
standard grep looking for RCPNode circular references that causes tests to
fail will be disabled.  Note that if these warnings are being produced
then it means that the test is leaking memory and user like may also be
leaking memory.</li>
</ul>
<p>There are several side-effects of calling this macro:</p>
<ul class="simple">
<li>The package's list of targets varibles aree initialized to emtpy.</li>
<li>The local varibles <tt class="docutils literal">PACKAGE_SOURCE_DIR</tt> and <tt class="docutils literal">PACKAGE_BINARY_DIR</tt> are
set for this package's use in its CMakeLists.txt files.</li>
<li>Package-specific compiler options are set up in package-scoped (i.e., the
package's subdir and its subdirs) in <tt class="docutils literal">CMAKE_&lt;LANG&gt;_FLAG</tt>.</li>
<li>This packages's cmake subdir is added to <tt class="docutils literal">CMAKE_MODULE_PATH</tt> so that the
package's try-compile modules can be read in with just a raw <tt class="docutils literal">INCLUDE()</tt>
leaving off the full path and the <tt class="docutils literal">*.cmake</tt> extension.</li>
</ul>
</div>
<div class="section" id="tribits-package-def">
<h2><a class="toc-backref" href="#id14">4.8&nbsp;&nbsp;&nbsp;TRIBITS_PACKAGE_DEF()</a></h2>
<p>Macro called after subpackages are processed in order to
handle the libraries, tests, and examples of the final package.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_PACKAGE_DEF()
</pre>
<p>If the package does not have subpackages, just call <a class="reference internal" href="#tribits-package">TRIBITS_PACKAGE()</a>
which calls this macro.</p>
<p>This macro has several side effects:</p>
<ul class="simple">
<li>The varible <tt class="docutils literal">PACKAGE_NAME</tt> is set in the local scope for usage by the
package's CMakeLists.txt files.</li>
<li>The intra-package dependency varibles (i.e. list of include directoires,
list of libraries, etc.) are initialized to emtpy.</li>
</ul>
</div>
<div class="section" id="tribits-process-subpackages">
<h2><a class="toc-backref" href="#id15">4.9&nbsp;&nbsp;&nbsp;TRIBITS_PROCESS_SUBPACKAGES()</a></h2>
<p>Macro that processes subpackages for packages that have them.  This is
called in the parent packages top-level CMakeLists.txt file.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_PROCESS_SUBPACKAGES()
</pre>
<p>Must be called after <a class="reference internal" href="#tribits-package-decl">TRIBITS_PACKAGE_DECL()</a> but before
<a class="reference internal" href="#tribits-package-def">TRIBITS_PACKAGE_DEF()</a>.</p>
</div>
<div class="section" id="tribits-add-test-directories">
<h2><a class="toc-backref" href="#id16">4.10&nbsp;&nbsp;&nbsp;TRIBITS_ADD_TEST_DIRECTORIES()</a></h2>
<p>Macro called to add a set of test directories for an SE package.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_ADD_TEST_DIRECTORIES(&lt;dir1&gt; &lt;dir2&gt; ...)
</pre>
<p>This macro only needs to be called from the top most CMakeList.txt file for
which all subdirectories are all &quot;tests&quot;.</p>
<p>This macro can be called several times within a package and it will have the
right effect.</p>
<p>Currently, really all it does macro does is to call
<tt class="docutils literal"><span class="pre">ADD_SUBDIRECTORY(&lt;diri&gt;)</span></tt> if <tt class="docutils literal">${PACKAGE_NAME}_ENABLE_TESTS</tt> or
<tt class="docutils literal">${PARENT_PACKAGE_NAME}_ENABLE_TESTS</tt> are true. However, this macro may be
extended in the futgure in order to modify behavior related to adding tests
and examples in a uniform way..</p>
</div>
<div class="section" id="tribits-add-example-directories">
<h2><a class="toc-backref" href="#id17">4.11&nbsp;&nbsp;&nbsp;TRIBITS_ADD_EXAMPLE_DIRECTORIES()</a></h2>
<p>Macro called to conditionally add a set of example directories for an SE
package.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_ADD_EXAMPLE_DIRECTORIES(&lt;dir1&gt; &lt;dir2&gt; ...)
</pre>
<p>This macro only needs to be called from the top most CMakeList.txt file for
which all subdirectories are all &quot;examples&quot;.</p>
<p>This macro can be called several times within a package and it will have the
right effect.</p>
<p>Currently, really all it does macro does is to call
<tt class="docutils literal"><span class="pre">ADD_SUBDIRECTORY(&lt;diri&gt;)</span></tt> if <tt class="docutils literal">${PACKAGE_NAME}_ENABLE_EXAMPLES</tt> or
<tt class="docutils literal">${PARENT_PACKAGE_NAME}_ENABLE_EXAMPLES</tt> are true. However, this macro may
be extended in the futgure in order to modify behavior related to adding
tests and examples in a uniform way..</p>
</div>
<div class="section" id="tribits-set-st-for-dev-mode">
<h2><a class="toc-backref" href="#id18">4.12&nbsp;&nbsp;&nbsp;TRIBITS_SET_ST_FOR_DEV_MODE()</a></h2>
<p>Function that allows packages to easily make a feature <tt class="docutils literal">ST</tt> for
development builds and <tt class="docutils literal">PT</tt> for release builds by default.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_SET_ST_FOR_DEV_MODE(&lt;outputVar&gt;)
</pre>
<p><tt class="docutils literal"><span class="pre">${&lt;outputVar&gt;}</span></tt> is set to <tt class="docutils literal">ON</tt> or <tt class="docutils literal">OFF</tt> based on the configure state.
In development mode it will be set to <tt class="docutils literal">ON</tt> only if <tt class="docutils literal">ST</tt> code is enabled,
otherwise it is set to <tt class="docutils literal">OFF</tt>. In release mode it is always set to <tt class="docutils literal">ON</tt>.
This allows some sections of a TriBITS package to be considered <tt class="docutils literal">ST</tt> for
development mode reducing testing time which includes only <tt class="docutils literal">PT</tt> code.,
while still having important functionality available to users by default in
a release.</p>
</div>
<div class="section" id="tribits-add-library">
<h2><a class="toc-backref" href="#id19">4.13&nbsp;&nbsp;&nbsp;TRIBITS_ADD_LIBRARY()</a></h2>
<p>Function used to add a CMake library target using <tt class="docutils literal">ADD_LIBRARY()</tt>.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_ADD_LIBRARY(
  &lt;libName&gt;
  [HEADERS &lt;h1&gt; &lt;h&gt; ...]
  [NOINSTALLHEADERS &lt;nih1&gt; &lt;hih2&gt; ...]
  [SOURCES &lt;src1&gt; &lt;src2&gt; ...]
  [DEPLIBS &lt;deplib1&gt; &lt;deplib2&gt; ...]
  [IMPORTEDLIBS &lt;ideplib1&gt; &lt;ideplib2&gt; ...]
  [DEFINES -D&lt;define1&gt; -D&lt;define2&gt; ...]
  [TESTONLY]
  [NO_INSTALL_LIB_OR_HEADERS]
  [CUDALIBRARY]
  )
</pre>
<p>ToDo: Document each argument!</p>
<p>This function has a number of side-effects after it finishes running:</p>
<ul class="simple">
<li>An install target for the library is created by default using
<tt class="docutils literal">INSTALL(TARGETS &lt;libName&gt; <span class="pre">...)</span></tt>.  However, this install target will not
get created if <tt class="docutils literal">${PROJECT_NAME}_INSTALL_LIBRARIES_AND_HEADERS=FALSE</tt> and
<tt class="docutils literal">BUILD_SHARD_LIBS=OFF</tt>.  However, when <tt class="docutils literal">BUILD_SHARD_LIBS=ON</tt>, the
install target will get created.  Also, this install target will <em>not</em> get
created if <tt class="docutils literal">TESTONLY</tt> or <tt class="docutils literal">NO_INSTALL_LIB_OR_HEADERS</tt> are passed in.</li>
<li>An install target for the headers listed in <tt class="docutils literal">HEADERS</tt> will get created
using <tt class="docutils literal">INSTALL(FILES &lt;h1&gt; &lt;h2&gt; <span class="pre">...)</span></tt>.  NOTE: An install target will
<em>not</em> get created for the headers listed in <tt class="docutils literal">NOINSTALLHEADERS</tt>.</li>
</ul>
<p>ToDo: Document other side-effects!</p>
<p>NOTE: IF the library is added, a CMake library target <tt class="docutils literal">&lt;libName&gt;</tt> gets
created through calling the build-in command <tt class="docutils literal"><span class="pre">ADD_LIBRARY(&lt;libName&gt;</span> <span class="pre">...)</span></tt>.</p>
</div>
<div class="section" id="tribits-add-executable">
<h2><a class="toc-backref" href="#id20">4.14&nbsp;&nbsp;&nbsp;TRIBITS_ADD_EXECUTABLE()</a></h2>
<p>Function used to create an executable (typically for a test or example),
using the built-in CMake comamnd <tt class="docutils literal">ADD_EXECUTABLE()</tt>.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_ADD_EXECUTABLE(
  &lt;exeRootName&gt;  [NOEXEPREFIX]  [NOEXESUFFIX]
  SOURCES &lt;src1&gt; &lt;src2&gt; ...
  [CATEGORIES &lt;category1&gt;  &lt;category2&gt; ...]
  [HOST &lt;host1&gt; &lt;host2&gt; ...]
  [XHOST &lt;host1&gt; &lt;host2&gt; ...]
  [HOSTTYPE &lt;hosttype1&gt; &lt;hosttype2&gt; ...]
  [XHOSTTYPE &lt;hosttype1&gt; &lt;hosttype2&gt; ...]
  [DIRECTORY &lt;dir&gt; ]
  [DEPLIBS &lt;lib1&gt; &lt;lib2&gt; ... ]
  [COMM [serial] [mpi] ]
  [LINKER_LANGUAGE [C|CXX|Fortran] ]
  [ADD_DIR_TO_NAME]
  [DEFINES -DS&lt;someDefine&gt;]
  [INSTALLABLE]
  )
</pre>
<p><strong>Formal Arguments:</strong></p>
<blockquote>
<p><tt class="docutils literal">&lt;exeRootName&gt;</tt></p>
<blockquote>
The base name of the exectuable and CMake target.</blockquote>
</blockquote>
<p>ToDo: Document other arguments!</p>
<p id="executable-and-target-name"><strong>Executable and Target Name:</strong></p>
<p>By default, the actual name of the executable and target will be:</p>
<pre class="literal-block">
${PACKAGE_NAME}_&lt;exeRootName&gt;${${PROJECT_NAME}_CMAKE_EXECUTABLE_SUFFIX}
</pre>
<p>If the option <tt class="docutils literal">NOEXEPREFIX</tt> is pased in, the prefix <tt class="docutils literal">${PACKAGE_NAME}_</tt>
is removed.  If the option <tt class="docutils literal">NOEXESUFFIX</tt> is passed in, the suffix
<tt class="docutils literal"><span class="pre">${${PROJECT_NAME}_CMAKE_EXECUTABLE_SUFFIX}</span></tt> is removed.</p>
<p>The reason that a default prefix is appended to the executable name is
because the primary reason to create an executable is typically to create a
test or an example that is private to the package.  This prefix helps to
namespace the exexutable and its target so as to avoid name clashes with
targets in other packages.  Also, if <tt class="docutils literal">INSTALLABLE</tt> is set and this
executable gets installed into the <tt class="docutils literal"><span class="pre">&lt;install&gt;/bin/</span></tt> directory, then this
prefix helps to avoid clashing with executables installed by other packages.</p>
<p><strong>Postcondition:</strong></p>
<p>ToDo: Document post conditions!</p>
</div>
<div class="section" id="tribits-add-test">
<h2><a class="toc-backref" href="#id21">4.15&nbsp;&nbsp;&nbsp;TRIBITS_ADD_TEST()</a></h2>
<p>Add a test or a set of tests for a single executable or command.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_ADD_TEST(
  &lt;exeRootName&gt;  [NOEXEPREFIX]  [NOEXESUFFIX]
  [NAME &lt;testName&gt; | NAME_POSTFIX &lt;testNamePostfix&gt;]
  [DIRECTORY &lt;directory&gt;]
  [ADD_DIR_TO_NAME]
  [ARGS &quot;&lt;arg1&gt; &lt;arg2&gt; ...&quot; &quot;&lt;arg3&gt; &lt;arg4&gt; ...&quot; ...
    | POSTFIX_AND_ARGS_0 &lt;postfix&gt; &lt;arg1&gt; &lt;arg2&gt; ...
      POSTFIX_AND_ARGS_1 ... ]
  [COMM [serial] [mpi]]
  [NUM_MPI_PROCS &lt;numProcs&gt;]
  [CATEGORIES &lt;category1&gt;  &lt;category2&gt; ...]
  [HOST &lt;host1&gt; &lt;host2&gt; ...]
  [XHOST &lt;host1&gt; &lt;host2&gt; ...]
  [HOSTTYPE &lt;hosttype1&gt; &lt;hosttype2&gt; ...]
  [XHOSTTYPE &lt;hosttype1&gt; &lt;hosttype2&gt; ...]
  [STANDARD_PASS_OUTPUT
    | PASS_REGULAR_EXPRESSION &quot;&lt;regex1&gt;;&lt;regex2&gt;;...&quot;]
  [FAIL_REGULAR_EXPRESSION &quot;&lt;regex1&gt;;&lt;regex2&gt;;...&quot;]
  [WILL_FAIL]
  [ENVIRONMENT &lt;var1&gt;=&lt;value1&gt; &lt;var2&gt;=&lt;value2&gt; ...]
  )
</pre>
<p><strong>Formal Arguments:</strong></p>
<blockquote>
<p><tt class="docutils literal">&lt;exeRootName&gt;</tt></p>
<blockquote>
The name of the exectuble or path to the exectuable to run for the test
(see <a class="reference internal" href="#determining-the-exectuable-or-command-to-run">Determining the Exectuable or Command to Run</a>).  This name is
also the default root name for the test (see <a class="reference internal" href="#determining-the-full-test-name">Determining the Full Test
Name</a>).</blockquote>
<p><tt class="docutils literal">NOEXEPREFIX</tt></p>
<blockquote>
If specified, then the prefix <tt class="docutils literal">${PACKAGE_NAME}_</tt> is not assumed to be
prepended to <tt class="docutils literal">&lt;exeRootName&gt;</tt>.</blockquote>
<p><tt class="docutils literal">NOEXESUFFIX</tt></p>
<blockquote>
If specified, then the postfix
<tt class="docutils literal"><span class="pre">${${PROJECT_NAME}_CMAKE_EXECUTABLE_SUFFIX}</span></tt> is not assumed to be
post-pended to <tt class="docutils literal">&lt;exeRootName&gt;</tt>.</blockquote>
<p><tt class="docutils literal">NAME &lt;testRootName&gt;</tt></p>
<blockquote>
If specified, gives the root name of the test.
If not specified, then <tt class="docutils literal">&lt;testRootName&gt;</tt> is taken to be
<tt class="docutils literal">&lt;exeRootName&gt;</tt>.  The actual test name will always prefixed as
<tt class="docutils literal">${PACKAGE_NAME}_&lt;testRootName&gt;</tt> passed into the call to the built-in
CMake command <tt class="docutils literal"><span class="pre">ADD_TEST(...)</span></tt>.  The main purpose of this argument is to
allow multiple tests to be defined for the same executable.  CTest
requires all test names to be globally unique in a single project.</blockquote>
<p><tt class="docutils literal">NAME_POSTFIX &lt;testNamePostfix&gt;</tt></p>
<blockquote>
If specified, gives a postfix that will be added to the standard test
name based on <tt class="docutils literal">&lt;exeRootName&gt;</tt> (appended as <tt class="docutils literal">_&lt;NAME_POSTFIX&gt;</tt>).  If
the <tt class="docutils literal">NAME &lt;testRootName&gt;</tt> argument is given, this argument is ignored.</blockquote>
<p><tt class="docutils literal">DIRECTORY &lt;dir&gt;</tt></p>
<blockquote>
If specified, then the executable is assumed to be in the directory
given by by <tt class="docutils literal">&lt;dir&gt;</tt>.  The directory <tt class="docutils literal">&lt;dir&gt;</tt> can either be a relative
or absolute path.  If not specified, the executable is assumed to be in
the current bindary directory.</blockquote>
<p><tt class="docutils literal">ADD_DIR_TO_NAME</tt></p>
<blockquote>
If specified, then the directory name that this test resides in will be
added into the name of the test after the package name is added and
before the root test name (see below).  The directory will have the
package's base directory stripped off so only the unique part of the
test directory will be used.  All directory seperators will be changed
into underscores.</blockquote>
<p><tt class="docutils literal">RUN_SERIAL</tt></p>
<blockquote>
If specified then no other tests will be allowed to run while this test
is running. This is useful for devices(like cuda cards) that require
exclusive access for processes/threads.  This just sets the CTest test
property <tt class="docutils literal">RUN_SERIAL</tt> using the built-in CMake function
<tt class="docutils literal">SET_TESTS_PROPERTIES()</tt>.</blockquote>
<p><tt class="docutils literal">ARGS &quot;&lt;arg1&gt; &lt;arg2&gt; <span class="pre">...&quot;</span> &quot;&lt;arg3&gt; &lt;arg4&gt; <span class="pre">...&quot;</span> ...</tt></p>
<blockquote>
If specified, then a set of arguments can be passed in quotes.  If
multiple groups of arguments are passed in different quoted clusters of
arguments then a different test will be added for each set of arguments.
In this way, many different tests can be added for a single executable
in a single call to this function.  Each of these separate tests will be
named <tt class="docutils literal">${TEST_NAME}_xy</tt> where <tt class="docutils literal">xy</tt> = <tt class="docutils literal">00</tt>, <tt class="docutils literal">01</tt>, <tt class="docutils literal">02</tt>, and so
on.</blockquote>
<p><tt class="docutils literal">POSTFIX_AND_ARGS_&lt;IDX&gt; &lt;postfix&gt; &lt;arg1&gt; &lt;arg2&gt; ...</tt></p>
<blockquote>
<p>If specified, gives a sequence of sets of test postfix names and arguments
lists for different tests.  For example, a set of three different tests
with argument lists can be specified as:</p>
<pre class="literal-block">
POSTIFX_AND_ARGS_0 postfix1 --arg1 --arg2=&quot;dummy&quot;
POSTIFX_AND_ARGS_1 postfix2  --arg2=&quot;fly&quot;
POSTIFX_AND_ARGS_3 postfix3  --arg2=&quot;bags&quot;
</pre>
<p>This will create three different test cases with the postfix names
<tt class="docutils literal">postfix1</tt>, <tt class="docutils literal">postfix2</tt>, and <tt class="docutils literal">postfix3</tt>.  The indexes must be
consecutive starting a <tt class="docutils literal">0</tt> and going up to (currently) <tt class="docutils literal">19</tt>.  The main
advantages of using these arguments instead of just 'ARGS' are that you
can give meaningful name to each test case and you can specify multiple
arguments without having to quote them and you can allow long argument
lists to span multiple lines.</p>
</blockquote>
<p><tt class="docutils literal">COMM [serial] [mpi]</tt></p>
<blockquote>
If specified, selects if the test will be added in serial and/or MPI
mode.  If the <tt class="docutils literal">COMM</tt> argument is missing, the test will be added in
both serial and MPI builds of the code.</blockquote>
<p><tt class="docutils literal">NUM_MPI_PROCS &lt;numProcs&gt;</tt></p>
<blockquote>
If specified, gives the number of processes that the test will be
defined to run.  If <tt class="docutils literal">&lt;numProcs&gt;</tt> is greater than
<tt class="docutils literal">${MPI_EXEC_MAX_NUMPROCS}</tt> then the test will be excluded.  If not
specified, then the default number of processes for an MPI build will be
<tt class="docutils literal">${MPI_EXEC_DEFAULT_NUMPROCS}</tt>.  For serial builds, this argument is
ignored.</blockquote>
<p><tt class="docutils literal">HOST &lt;host1&gt; &lt;host2&gt; ...</tt></p>
<blockquote>
If specified, gives a list of hostnames where the test will be included.
The current hostname is determined by the built-in CMake command
<tt class="docutils literal"><span class="pre">SITE_NAME(${PROJECT_NAME}_HOSTNAME)</span></tt>.  On Linux/Unix systems, this is
typically the value returned by 'uname -n'.  If this list is given, the
value of <tt class="docutils literal"><span class="pre">${${PROJECT_NAME}_HOSTNAME}</span></tt> must equal one of the listed
host names <tt class="docutils literal">&lt;hosti&gt;</tt> or test will not be added.  The value of
<tt class="docutils literal">${PROJECT_NAME}_HOSTNAME</tt> gets printed out in the TriBITS cmake
output under the section <tt class="docutils literal">Probing the environment</tt>.</blockquote>
<p><tt class="docutils literal">XHOST &lt;host1&gt; &lt;host2&gt; ...</tt></p>
<blockquote>
If specified, gives a list of hostnames (see <tt class="docutils literal">HOST</tt> argument) where
the test will <em>not</em> be added.  This check is performed after the check
for the hostnames in the <tt class="docutils literal">HOST</tt> list if it should exist.  Therefore,
this list exclusion list overrides the 'HOST' inclusion list.</blockquote>
<p><tt class="docutils literal">CATEGORIES &lt;category1&gt; &lt;category2&gt; ...</tt></p>
<blockquote>
If specified, gives the specific categories of the test.  Valid test
categories include <tt class="docutils literal">BASIC</tt>, <tt class="docutils literal">CONTINUOUS</tt>, <tt class="docutils literal">NIGHTLY</tt>, <tt class="docutils literal">WEEKLY</tt>
and <tt class="docutils literal">PERFORMANCE</tt>.  By default, the category is <tt class="docutils literal">BASIC</tt>.  When the
test category does not match <tt class="docutils literal">${PROJECT_NAME}_TEST_CATEGORIES</tt>, then
the test is not added.  When the <tt class="docutils literal">CATEGORIES</tt> is <tt class="docutils literal">BASIC</tt> it will
match <tt class="docutils literal">${PROJECT_NAME}_TEST_CATEGORIES</tt> eqaual to <tt class="docutils literal">CONTINUOUS</tt>,
<tt class="docutils literal">NIGHTLY</tt>, and <tt class="docutils literal">WEEKLY</tt>.  When the <tt class="docutils literal">CATEGORIES</tt> contains
<tt class="docutils literal">CONTINUOUS</tt> it will match <tt class="docutils literal">${PROJECT_NAME}_TEST_CATEGORIES</tt> equal
to <tt class="docutils literal">CONTINUOUS</tt>, <tt class="docutils literal">NIGHTLY</tt>, and <tt class="docutils literal">WEEKLY</tt>.  When the <tt class="docutils literal">CATEGORIES</tt>
is <tt class="docutils literal">NIGHTLY</tt> it will match <tt class="docutils literal">${PROJECT_NAME}_TEST_CATEGORIES</tt> equal
to <tt class="docutils literal">NIGHTLY</tt> and <tt class="docutils literal">WEEKLY</tt>.  When the <tt class="docutils literal">CATEGORIES</tt> is
<tt class="docutils literal">PERFORMANCE</tt> it will match
<tt class="docutils literal">${PROJECT_NAME}_TEST_CATEGORIES=PERFORMANCE</tt> only.</blockquote>
<p><tt class="docutils literal">HOSTTYPE &lt;hosttype1&gt; &lt;hosttype2&gt; ...</tt></p>
<blockquote>
If specified, gives the names of the host system type (given by
<tt class="docutils literal">CMAKE_HOST_SYSTEM_NAME</tt> which is printed in the TriBITS cmake
confgiure output in the section <tt class="docutils literal">Probing the environment</tt>) to include
the test.  Typical host system type names include <tt class="docutils literal">Linux</tt>, <tt class="docutils literal">Darwain</tt>
etc.</blockquote>
<p><tt class="docutils literal">XHOSTTYPE &lt;hosttype1&gt; &lt;hosttype2&gt; ...</tt></p>
<blockquote>
If specified, gives the names of the host system type to <em>not</em> include
the test.  This check is performed after the check for the host system
names in the <tt class="docutils literal">HOSTTYPE</tt> list if it should exist.  Therefore, this list
exclusion list overrides the <tt class="docutils literal">HOSTTYPE</tt> inclusion list.</blockquote>
<p><tt class="docutils literal">STANDARD_PASS_OUTPUT</tt></p>
<blockquote>
If specified, then the standard test output <tt class="docutils literal">End Result: TEST PASSED</tt>
is greped for to determine success.  This is needed for MPI tests on
some platforms since the return value is unreliable.  This is set using
the built-in ctest property <tt class="docutils literal">PASS_REGULAR_EXPRESSION</tt>.</blockquote>
<p><tt class="docutils literal">PASS_REGULAR_EXPRESSION <span class="pre">&quot;&lt;regex1&gt;;&lt;regex2&gt;;...&quot;</span></tt></p>
<blockquote>
If specified, then a test will be assumed to pass only if one of the
regular expressions <tt class="docutils literal">&lt;regex1&gt;</tt>, <tt class="docutils literal">&lt;regex2&gt;</tt> etc. match the output.
Otherwise, the test will fail.  This is set using the built-in test
property <tt class="docutils literal">PASS_REGULAR_EXPRESSION</tt>.  Consult standard CMake
documentation.</blockquote>
<p><tt class="docutils literal">FAIL_REGULAR_EXPRESSION <span class="pre">&quot;&lt;regex1&gt;;&lt;regex2&gt;;...&quot;</span></tt></p>
<blockquote>
If specified, then a test will be assumed to fail if one of the regular
expressions <tt class="docutils literal">&lt;regex1&gt;</tt>, <tt class="docutils literal">&lt;regex2&gt;</tt> etc. match the output.
Otherwise, the test will pass.  This is set using the built-in test
property <tt class="docutils literal">FAIL_REGULAR_EXPRESSION</tt>.</blockquote>
<p><tt class="docutils literal">WILL_FAIL</tt></p>
<blockquote>
If passed in, then the pass/fail criteria will be inverted.  This is set
using the built-in test property <tt class="docutils literal">WILL_FAIL</tt>.</blockquote>
<p><tt class="docutils literal">ENVIRONMENT <span class="pre">&lt;var1&gt;=&lt;value1&gt;</span> <span class="pre">&lt;var2&gt;=&lt;value2&gt;</span> ...</tt></p>
<blockquote>
If passed in, the listed environment varaibles will be set before
calling the test.  This is set using the built-in test property
<tt class="docutils literal">ENVIRONMENT</tt>.</blockquote>
</blockquote>
<p>In the end, this function just calls the built-in CMake commands
<tt class="docutils literal"><span class="pre">ADD_TEST(${TEST_NAME}</span> <span class="pre">...)</span></tt> and <tt class="docutils literal"><span class="pre">SET_TESTS_PROPERTIES(${TEST_NAME}</span>
<span class="pre">...)</span></tt> to set up a executable process for <tt class="docutils literal">ctest</tt> to run and determine
pass/fail.  Therefore, this wrapper funtion does not provide any
fundamentally new features that is avaiable in the basic usage if
CMake/CTes.  However, this wrapper function takes care of many of the
details and boiler-plate CMake code that it takes to add such as test (or
tests) and enforces consistency across a large project for how tests are
defined, run, and named (to avoid test name clashes).</p>
<p>If more flexibility or control is needed when defining tests, then the
function <tt class="docutils literal">TRIBITS_ADD_ADVANCED_TEST()</tt> should be used instead.</p>
<p>In the following subsections, more details on how tests are defined and run
is given.</p>
<p id="determining-the-exectuable-or-command-to-run"><strong>Determining the Exectuable or Command to Run:</strong></p>
<p>This funtion is primarily designed to make it easy to run tests for
exectaubles built usign the function <tt class="docutils literal">TRIBITS_ADD_EXECUTABLE()</tt>.  To set
up tests to run arbitrary executables, see below.</p>
<p>By default, the command to run for the executable is determined by first
getting the exectuable name which by default is assumed to be:</p>
<pre class="literal-block">
${PACKAGE_NAME}_&lt;exeRootName&gt;${${PROJECT_NAME}_CMAKE_EXECUTABLE_SUFFIX}
</pre>
<p>which is (by no coincidence) idential to how it is selected in
<tt class="docutils literal">TRIBITS_ADD_EXECUTABLE()</tt> (see <a class="reference internal" href="#executable-and-target-name">Executable and Target Name</a>).</p>
<p>If <tt class="docutils literal">NONEXEPREFIX</tt> is passed in, the prefix <tt class="docutils literal">${PACKAGE_NAME}_</tt> is not
prepended to the assumed name.  If <tt class="docutils literal">NOEXESUFFIX</tt> is passed in, then
<tt class="docutils literal"><span class="pre">${${PROJECT_NAME}_CMAKE_EXECUTABLE_SUFFIX}</span></tt> is not assumed to be appended
to the name.</p>
<p>By default, this executable is assumed to be in the current CMake binary
directory <tt class="docutils literal">${CMAKE_CURRENT_BINARY_DIR}</tt> but the directory location can be
changed using the <tt class="docutils literal">DIRECTORY &lt;dir&gt;</tt> argument.</p>
<p>If an arbitrary exectuable is to be run for the test, then pass in
<tt class="docutils literal">NOEXEPREFIX</tt> and <tt class="docutils literal">NOEXESUFFIX</tt> and set <tt class="docutils literal">&lt;exeRootName&gt;</tt> to the
relative or absolute path of the exeutable to be run.  If <tt class="docutils literal">&lt;exeRootName&gt;</tt>
is not an absolute path, then <tt class="docutils literal"><span class="pre">${CMAKE_CURRENT_BINARY_DIR}/&lt;exeRootName&gt;</span></tt>
is set as the executable to run.</p>
<p>Whatever executable path is specified using this logic, if the executable is
not found, then when <tt class="docutils literal">ctest</tt> goes to run the test, it will mark it as
<tt class="docutils literal">NOT RUN</tt>.</p>
<p id="determining-the-full-test-name"><strong>Determining the Full Test Name:</strong></p>
<p>By default, the base test name is selected to be:</p>
<pre class="literal-block">
${PACKAGE_NAME}_&lt;exeRootName&gt;
</pre>
<p>If <tt class="docutils literal">NAME &lt;testRootName&gt;</tt> is passed in, then <tt class="docutils literal">&lt;testRootName&gt;</tt> is used
instead of <tt class="docutils literal">&lt;exeRootName&gt;</tt>.</p>
<p>If <tt class="docutils literal">NAME_POSTFIX &lt;testNamePostfix&gt;</tt> is passed in, then the base test name
is selected to be:</p>
<pre class="literal-block">
${PACKAGE_NAME}_&lt;exeRootName&gt;_&lt;testNamePostfix&gt;
</pre>
<p>If <tt class="docutils literal">ADD_DIR_TO_NAME</tt> is passed in, then the directory name realtive to the
package directory name is added to the name as well to help disambiguate the
test name (see the above).</p>
<p>Let the test name determined by this process be <tt class="docutils literal">TEST_NAME</tt>.  If no
arguments or one set of arguments are passed in through <tt class="docutils literal">ARGS</tt>, then this
is the test name actaully passed in to <tt class="docutils literal">ADD_TEST()</tt>.  If multiple tests
are defined, then this name becomes the base test name for each of the
tests. See below.</p>
<p><strong>Adding Multiple Tests:</strong></p>
<dl class="docutils">
<dt>ToDo: Explain how multiple tests can be added with different sets of</dt>
<dd>arguments in one of two ways.</dd>
</dl>
<p><strong>Determining Pass/Fail:</strong></p>
<p>ToDo: Fill in!</p>
<p><strong>Debugging and Examining Test Generation:</strong></p>
<p>ToDo: Describe setting ${PROJECT_NAME}_VERBOSE_CONFIGURE=ON and seeing what
info it prints out.</p>
<p>ToDo: Describe how to examine the generated CTest files to see what test(s)
actually got added (or not added) and what the pass/fail criteria is.</p>
<p><strong>Disabling Tests Externally:</strong></p>
<p>The test can be disabled externally by setting the CMake cache variable
<tt class="docutils literal">${FULL_TEST_NAME}_DISABLE=TRUE</tt>.  This allows tests to be disable on a
case-by-case basis.  This is the <em>exact</em> name that shows up in 'ctest -N'
when running the test.  If multiple tests are added in this funtion through
multiple argument sets to <tt class="docutils literal">ARGS</tt> or through multiple
<tt class="docutils literal">POSTFIX_AND_ARGS_&lt;IDX&gt;</tt> arguments, then
<tt class="docutils literal">${FULL_TEST_NAME}_DISABLE=TRUE</tt> must be set for each test individually.</p>
</div>
<div class="section" id="tribits-add-advanced-test">
<h2><a class="toc-backref" href="#id22">4.16&nbsp;&nbsp;&nbsp;TRIBITS_ADD_ADVANCED_TEST()</a></h2>
<p>Function that creates an advanced test defined using one or more executable
commands that is run as a separate CMake script.</p>
<p>This function allows you to add a single CTest test as a single unit that is
actually a sequence of one or more separate commands strung together in some
way to define the final pass/fail.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_ADD_ADVANCED_TEST(
  &lt;testName&gt;
  TEST_0 (EXEC &lt;execTarget0&gt; | CMND &lt;cmndExec0&gt;) ...
  [TEST_1 (EXEC &lt;execTarget1&gt; | CMND &lt;cmndExec1&gt;) ...]
  ...
  [TEST_N (EXEC &lt;execTargetN&gt; | CMND &lt;cmndExecN&gt;) ...]
  [OVERALL_WORKING_DIRECTORY (&lt;overallWorkingDir&gt; | TEST_NAME)]
  [FAIL_FAST]
  [KEYWORDS &lt;keyword1&gt; &lt;keyword2&gt; ...]
  [COMM [serial] [mpi]]
  [OVERALL_NUM_MPI_PROCS &lt;overallNumProcs&gt;]
  [CATEGORIES &lt;category1&gt; &lt;category2&gt; ...]
  [HOST &lt;host1&gt; &lt;host2&gt; ...]
  [XHOST &lt;host1&gt; &lt;host2&gt; ...]
  [HOSTTYPE &lt;hosttype1&gt; &lt;hosttype2&gt; ...]
  [XHOSTTYPE &lt;hosttype1&gt; &lt;hosttype2&gt; ...]
  [FINAL_PASS_REGULAR_EXPRESSION &lt;regex&gt; | FINAL_FAIL_REGULAR_EXPRESSION &lt;regex&gt;]
  [ENVIRONMENT &lt;var1&gt;=&lt;value1&gt; &lt;var2&gt;=&lt;value2&gt; ...]
  )
</pre>
<p>Each and every atomic test or command needs to pass (as defined below) in
order for the overall test to pass.</p>
<p>Each atomic test case is either a package-built executable or just a basic
command.  An atomic test command takes the form:</p>
<pre class="literal-block">
TEST_&lt;i&gt;
   EXEC &lt;exeRootName&gt; [NOEXEPREFIX] [NOEXESUFFIX] [ADD_DIR_TO_NAME] [DIRECTORY &lt;dir&gt;]
      | CMND &lt;cmndExec&gt;
   [ARGS &lt;arg1&gt; &lt;arg2&gt; ... &lt;argn&gt;]
   [MESSAGE &quot;&lt;message&gt;&quot;]
   [WORKING_DIRECTORY &lt;workingDir&gt;]
   [NUM_MPI_PROCS &lt;numProcs&gt;]
   [OUTPUT_FILE &lt;outputFile&gt;]
   [NO_ECHO_OUTPUT]]
   [PASS_ANY
     | PASS_REGULAR_EXPRESSION &quot;&lt;regex&gt;&quot;
     | PASS_REGULAR_EXPRESSION_ALL &quot;&lt;regex1&gt;&quot; &quot;&lt;regex2&gt;&quot; ... &quot;&lt;regexn&gt;&quot;
     | FAIL_REGULAR_EXPRESSION &quot;&lt;regex&gt;&quot;
     | STANDARD_PASS_OUTPUT
     ]
</pre>
<p>ToDO: Add documnetation for [X]HOST[TYPE]</p>
<p>Some overall arguments are:</p>
<blockquote>
<p><tt class="docutils literal">&lt;testName&gt;</tt></p>
<blockquote>
The name of the test (which will have <tt class="docutils literal">${PACKAGE_NAME}_</tt> prepended to
the name) that will be used to name the output CMake script file as well
as the CTest test name passed into <tt class="docutils literal">ADD_TEST()</tt>.</blockquote>
<p><tt class="docutils literal">TEST_&lt;i&gt; (EXEC &lt;execTarget0&gt; | CMND &lt;cmndExec0&gt;) ...</tt></p>
<blockquote>
Defines test command to be run for the ith test command.  Each of these
test commands must be in sequential order.  The details for each atomic
test are given below.</blockquote>
<p><tt class="docutils literal">OVERALL_WORKING_DIRECTORY &lt;overallWorkingDir&gt;</tt></p>
<blockquote>
If specified, then the working directory <tt class="docutils literal">&lt;overallWorkingDir&gt;</tt> will be
created and all of the test commands by default will be run from within
this directory.  If the value <tt class="docutils literal"><span class="pre">&lt;overallWorkingDir&gt;=TEST_NAME</span></tt> is
given, then the working directory will be given the name
<tt class="docutils literal">${PACKAGE_NAME}_&lt;testName&gt;</tt>.  If the directory
<tt class="docutils literal">&lt;overallWorkingDir&gt;</tt> exists before the test runs, it will be deleted
and created again.  Therefore, if you want to preserve the contents of
this directory between test runs you need to copy the files it somewhere
else.</blockquote>
<p><tt class="docutils literal">FAIL_FAST</tt></p>
<blockquote>
If specified, then the remaining test commands will be aborted when any
test command fails.  Otherwise, all of the test cases will be run.</blockquote>
<p><tt class="docutils literal">RUN_SERIAL</tt></p>
<blockquote>
If specified then no other tests will be allowed to run while this test
is running.  This is useful for devices(like cuda cards) that require
exclusive access for processes/threads.  This just sets the CTest test
property <tt class="docutils literal">RUN_SERIAL</tt> using the built-in CMake function
<tt class="docutils literal">SET_TESTS_PROPERTIES()</tt>.</blockquote>
<p><tt class="docutils literal">COMM [serial] [mpi]</tt></p>
<blockquote>
If specified, selects if the test will be added in serial and/or MPI
mode.  See the <tt class="docutils literal">COMM</tt> argument in the script
<a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a> for more details.</blockquote>
<p><tt class="docutils literal">OVERALL_NUM_MPI_PROCS &lt;overallNumProcs&gt;</tt></p>
<blockquote>
If specified, gives the default number of processes that each executable
command runs on.  If <tt class="docutils literal">&lt;numProcs&gt;</tt> is greater than
<tt class="docutils literal">${MPI_EXEC_MAX_NUMPROCS}</tt> then the test will be excluded.  If not
specified, then the default number of processes for an MPI build will be
<tt class="docutils literal">${MPI_EXEC_DEFAULT_NUMPROCS}</tt>.  For serial builds, this argument is
ignored.</blockquote>
<p><tt class="docutils literal">CATEGORIES &lt;category1&gt; &lt;category2&gt; ...</tt></p>
<blockquote>
Gives the test categories this test will be added.  See
<tt class="docutils literal">TRIBITS_ADD_TEST()</tt> for more details.</blockquote>
<p><tt class="docutils literal">ENVIRONMENT <span class="pre">&lt;var1&gt;=&lt;value1&gt;</span> <span class="pre">&lt;var2&gt;=&lt;value2&gt;</span> ..</tt>.</p>
<blockquote>
If passed in, the listed environment varaibles will be set before
calling the test.  This is set using the built-in test property
<tt class="docutils literal">ENVIRONMENT</tt>.</blockquote>
</blockquote>
<p>Each test command is either package-built test executable or some general
command executable and is defined as either <tt class="docutils literal">EXEC &lt;exeRootName&gt;</tt> or <tt class="docutils literal">CMND
&lt;cmndExec&gt;</tt>:</p>
<blockquote>
<p><tt class="docutils literal">EXEC &lt;exeRootName&gt; [NOEXEPREFIX] [NOEXESUFFIX] [ADD_DIR_TO_NAME] [DIRECTORY &lt;dir&gt;]</tt></p>
<blockquote>
If specified, then <tt class="docutils literal">&lt;exeRootName&gt;</tt> gives the the name of an executable
target that will be run as the command.  The full executable path is
determined in exactly the same way it is in the <a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a>
function (see <a class="reference internal" href="#determining-the-exectuable-or-command-to-run">Determining the Exectuable or Command to Run</a>).
If this is an MPI build, then the executable will be run with MPI using
<tt class="docutils literal">NUM_MPI_PROCS &lt;numProcs&gt;</tt> or <tt class="docutils literal">OVERALL_NUM_MPI_PROCS
&lt;overallNumProcs&gt;</tt> (if <tt class="docutils literal">NUM_MPI_PROCS</tt> is not set for this test
case).  If the number of maximum MPI processes allowed is less than this
number of MPI processes, then the test will <em>not</em> be run.  Note that
<tt class="docutils literal">EXEC &lt;exeRootName&gt;</tt> is basically equivalent to <tt class="docutils literal">CMND &lt;cmndExec&gt;</tt>
when <tt class="docutils literal">NOEXEPREFIX</tt> and <tt class="docutils literal">NOEXESUFFIX</tt> are specified.  In this case,
you can pass in <tt class="docutils literal">&lt;exeRootName&gt;</tt> to any command you would like and it
will get run with MPI in MPI mode just link any other command.</blockquote>
<p><tt class="docutils literal">CMND &lt;cmndExec&gt;</tt></p>
<blockquote>
If specified, then <tt class="docutils literal">&lt;cmndExec&gt;</tt> gives the executable for a command to
be run.  In this case, MPI will never be used to run the executable even
when configured in MPI mode (i.e. TPL_ENABLE_MPI=ON).</blockquote>
</blockquote>
<p>By default, the output (stdout/stderr) for each test command is captured and
is then echoed to stdout for the overall test.  This is done in order to be
able to grep the result to determine pass/fail.</p>
<p>Other miscellaneous arguments for each <tt class="docutils literal">TEST_&lt;i&gt;</tt> block include:</p>
<blockquote>
<p><tt class="docutils literal">DIRECTORY &lt;dir&gt;</tt></p>
<blockquote>
If specified, then the executable is assumed to be in the directory
given by relative &lt;dir&gt;.  See <a class="reference internal" href="#tribits-add-test">TRIBITS_ADD_TEST()</a>.</blockquote>
<p><tt class="docutils literal">MESSAGE &quot;&lt;message&gt;&quot;</tt></p>
<blockquote>
If specified, then the string in <tt class="docutils literal">&quot;&lt;message&gt;&quot;</tt> will be print before
this test command is run.  This allows adding some documentation about
each individual test invocation to make the test output more
understandable.</blockquote>
<p><tt class="docutils literal">WORKING_DIRECTORY &lt;workingDir&gt;</tt></p>
<blockquote>
If specified, then the working directory <tt class="docutils literal">&lt;workingDir&gt;</tt> will be
created and the test will be run from within this directory.  If the
value <tt class="docutils literal">&lt;workingDir&gt; = TEST_NAME</tt> is given, then the working directory
will be given the name <tt class="docutils literal">${PACKAGE_NAME}_&lt;testName&gt;</tt>.  If the directory
&lt;workingDir&gt; exists before the test runs, it will be deleted and created
again.  Therefore, if you want to preserve the contents of this
directory between test runs you need to copy it somewhere else.  Using
<tt class="docutils literal">WORKING_DIRECTORY` for individual test commands allows creating
independent working directories for each test case.&nbsp; This would be
useful if a single ``OVERALL_WORKING_DIRECTORY</tt> was not sufficient for
some reason.</blockquote>
<p><tt class="docutils literal">NUM_MPI_PROCS &lt;numProcs&gt;</tt></p>
<blockquote>
If specified, then &lt;<tt class="docutils literal">numProcs&gt;</tt> is the number of processors used for MPI
executables.  If not specified, this will default to <tt class="docutils literal">&lt;overallNumProcs&gt;</tt>
from <tt class="docutils literal">OVERALL_NUM_MPI_PROCS &lt;overallNumProcs&gt;</tt>.</blockquote>
<p><tt class="docutils literal">OUTPUT_FILE &lt;outputFile&gt;</tt></p>
<blockquote>
If specified, then stdout and stderr for the test case will be sent to
<tt class="docutils literal">&lt;outputFile&gt;</tt>.</blockquote>
<p><tt class="docutils literal">NO_ECHO_OUTPUT</tt></p>
<blockquote>
If specified, then the output for the test command will not be echoed to
the output for the entire test command.</blockquote>
</blockquote>
<p>By default, an atomic test line is assumed to pass if the executable returns
a non-zero value.  However, a test case can also be defined to pass based
on:</p>
<blockquote>
<p><tt class="docutils literal">PASS_ANY</tt></p>
<blockquote>
If specified, the test command 'i' will be assumed to pass reguardless
of the return value or any other output.  This would be used when a
command that is to follow will determine pass or fail based on output
from this command in some way.</blockquote>
<p><tt class="docutils literal">PASS_REGULAR_EXPRESSION &quot;&lt;regex&gt;&quot;</tt></p>
<blockquote>
If specified, the test command 'i' will be assumed to pass if it matches
the given regular expression.  Otherwise, it is assumed to fail.</blockquote>
<p><tt class="docutils literal">PASS_REGULAR_EXPRESSION_ALL &quot;&lt;regex1&gt;&quot; &quot;&lt;regex2&gt;&quot; ... &quot;&lt;regexn&gt;&quot;</tt></p>
<blockquote>
If specified, the test command 'i' will be assumed to pas if the output
matches all of the provided regular expressions.  Note that this is not
a capability of raw ctest and represents an extension provided by
TriBITS.</blockquote>
<p><tt class="docutils literal">FAIL_REGULAR_EXPRESSION &quot;&lt;regex&gt;&quot;</tt></p>
<blockquote>
If specified, the test command 'i' will be assumed to fail if it matches
the given regular expression.  Otherwise, it is assumed to pass.</blockquote>
<p><tt class="docutils literal">STANDARD_PASS_OUTPUT</tt></p>
<blockquote>
If specified, the test command 'i' will be assumed to pass if the string
expression &quot;Final Result: PASSED&quot; is found in the ouptut for the test.</blockquote>
</blockquote>
<p>By default, the overall test will be assumed to pass if it prints:</p>
<pre class="literal-block">
&quot;OVERALL FINAL RESULT: TEST PASSED&quot;
</pre>
<p>However, this can be changed by setting one of the following optional arguments:</p>
<blockquote>
<p><tt class="docutils literal">FINAL_PASS_REGULAR_EXPRESSION &lt;regex&gt;</tt></p>
<blockquote>
If specified, the test will be assumed to pass if the output matches
&lt;regex&gt;.  Otherwise, it will be assumed to fail.</blockquote>
<p>FINAL_FAIL_REGULAR_EXPRESSION &lt;regex&gt;</p>
<blockquote>
If specified, the test will be assumed to fail if the output matches
&lt;regex&gt;.  Otherwise, it will be assumed to fail.</blockquote>
</blockquote>
<p><strong>Implementation Details:</strong></p>
<p>ToDo: Describe the generation of the <tt class="docutils literal">*.cmake</tt> file and what gets added
with ADD_TEST().</p>
<p><strong>Debugging and Examining Test Generation:</strong></p>
<p>ToDo: Describe setting <tt class="docutils literal">${PROJECT_NAME}_VERBOSE_CONFIGURE=ON</tt> and seeing
what info it prints out.</p>
<p>ToDo: Describe how to examine the generated CTest files to see what test(s)
actually got added (or not added) and what the pass/fail criteria is.</p>
<p><strong>Disabling Tests Externally:</strong></p>
<p>The test can be disabled externally by setting the CMake cache variable
<tt class="docutils literal">${FULL_TEST_NAME}_DISABLE=TRUE</tt>.  This allows tests to be disable on a
case-by-case basis.  This is the <em>exact</em> name that shows up in 'ctest -N'
when running the test.</p>
</div>
<div class="section" id="tribits-package-postprocess">
<h2><a class="toc-backref" href="#id23">4.17&nbsp;&nbsp;&nbsp;TRIBITS_PACKAGE_POSTPROCESS()</a></h2>
<p>Macro called at the very end of a package's top-level CMakeLists.txt file.
This macro performs some critical post-processing activities before
downstream packages are processed.</p>
<p>Usage:</p>
<pre class="literal-block">
TRIBITS_PACKAGE_POSTPROCESS()
</pre>
<p>NOTE: It is unfortunate that a packages's CMakeLists.txt file must call this
macro but limitations of the CMake language make it necessary to do so.</p>
</div>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id24">5&nbsp;&nbsp;&nbsp;References</a></h1>
<table class="docutils citation" frame="void" id="scale" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[SCALE]</a></td><td><a class="reference external" href="http://scale.ornl.gov/">http://scale.ornl.gov/</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="appendix">
<h1><a class="toc-backref" href="#id25">6&nbsp;&nbsp;&nbsp;Appendix</a></h1>
<div class="section" id="history-of-tribits">
<h2><a class="toc-backref" href="#id26">6.1&nbsp;&nbsp;&nbsp;History of TriBITS</a></h2>
<p>TriBITS started development in November 2007 as a set of helper macros to
provide a CMake build system for a small subset of packages in Trilinos.  The
initial goal was to just to support a native Windows build (using Visual C++)
to compile and install these few Trilinos packages on Windows for usage by
another project (the Sandia Titan project which included VTK).  At that time,
Trilinos was using a highly customized autotools build system.  Initially,
this CMake system was just a set of macros to streamline creating executables
and tests.  Some of the conventions started in that early effort (e.g. naming
conventions of variables and macros where functions use upper case like old
FORTRAN and variables are mixed case) were continued in later efforts and are
reflected in the current.  Then, stating in early 2008, a more detailed
evaluation was performed to see if Trilinos should stitch over to CMake as the
default (and soon only) supported build and test system (see &quot;Why CMake?&quot; in
<a class="reference external" href="../overview/TribitsOverview.pdf">TriBITS Overview</a>).  This lead to the
initial implementation of a scale-able package-based architecture
(PackageArch) for the Trilinos CMake project in late 2008.  This Trilinos
CMake PackageArch system evolved over the next few years with development in
the system slowing into 2010.  This Trilinos CMake build system was then
adopted as the build infrastructure for the CASL VERA effort in 2011 where
CASL VERA packages were treated as add-on Trilinos packages (see Section ???).
Over the next year, there was significant development of the system to support
larger multi-repo projects in support of CASL VERA.  That lead to the decision
to formally generalize the Trilinos CMake PackageArch build system outside of
Trilinos and the name TriBITS was formally adopted in November 2011.  Work to
refactor the Trilinos CMake system into a general reusable stand-alone
CMake-based build system started in October 2011 and an initial implementation
was complete in December 2011 when it was used for the CASL VERA build system.
In early 2012, the ORNL CASL-related projects Denovo and SCALE (<a class="citation-reference" href="#scale" id="id2">[SCALE]</a>)
adopted TriBITS as their native development build systems.  Shortly after
TriBITS was adopted the native build system for the the CASL-related
University of Michigan code MPACT.  In addition to being used in CASL, all of
these codes also had a significant life outside of CASL.  Because they used
the same TriBITS build system, it proved relatively easy to keep these various
codes integrated together in the CASL VERA code meta-build.  At the same time,
TriBITS well served the independent development teams and non-CASL projects
independent from CASL VERA.  Since the initial extraction of TriBITS from
Trilinos, the TriBITS system was further extended and refined, driven by CASL
VERA development and expansion.  Independently, an early version of TriBITS
from 2012 was adopted by the LiveV
projectfootnote{<a class="reference external" href="https://github.com/lifev/cmake">https://github.com/lifev/cmake</a>} which was forked and extended
independently.</p>
</div>
</div>
</div>
</body>
</html>
