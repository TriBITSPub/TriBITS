TRIBITS_ADD_EXECUTABLE( b_test SOURCES b_test.cpp )

SET(EXPECTED_B_DEPS)
ASSERT_DEFINED(${PACKAGE_NAME}_ENABLE_PackageWithSubpackagesSubpackageA)
IF(${PACKAGE_NAME}_ENABLE_PackageWithSubpackagesSubpackageA)
  SET(EXPECTED_B_DEPS "${EXPECTED_B_DEPS} A no_deps")
ENDIF()
SET(EXPECTED_B_DEPS "${EXPECTED_B_DEPS} no_deps")

TRIBITS_ADD_ADVANCED_TEST( test_of_b
  OVERALL_NUM_MPI_PROCS 1
  TEST_0 EXEC b_test
    PASS_REGULAR_EXPRESSION_ALL 
      "B label is: B"
      "B deps are:${EXPECTED_B_DEPS}"
  )

# Create a test-only lib
ADD_SUBDIRECTORY(testlib)

ASSERT_DEFINED(${PACKAGE_NAME}_ENABLE_MixedLanguage)
IF (${PACKAGE_NAME}_ENABLE_MixedLanguage)

  # Define these vars to see invalid usage checking and errors!
  IF (SPKB_SHOW_TESTONLY_INSTALLABLE_ERROR)
    SET(EXTRA_TAEAT_ARGS INSTALLABLE)
  ENDIF()
  IF (SPKB_SHOW_NON_TESTONLY_LIB_ERROR)
    SET(EXTRA_TAEAT_EXTRA_TESTONLYLIBS simplecxx)
  ENDIF()
  IF (SPKB_SHOW_IMPORTED_LIBS_THIS_PKG_ERROR)
    SET(EXTRA_TAEAT_ARGS IMPORTEDLIBS pws_b)
  ENDIF()
  IF (SPKB_SHOW_TESTONLY_DEBLIBS_WARNING) # Deprecated
    SET(EXTRA_TAEAT_ARGS  DEPLIBS b_mixed_lang)
  ENDIF()
  IF (SPKB_SHOW_NONTESTONLY_DEBLIBS_WARNING) # Deprecated
    SET(EXTRA_TAEAT_ARGS  DEPLIBS pws_b)
  ENDIF()
  PRINT_NONEMPTY_VAR(EXTRA_TAEAT_ARGS)
  PRINT_NONEMPTY_VAR(EXTRA_TAEAT_EXTRA_TESTONLYLIBS)

  TRIBITS_ADD_EXECUTABLE_AND_TEST( test_of_b_mixed_lang
    SOURCES b_mixed_lang_test.cpp
    ${EXTRA_TAEAT_ARGS}
    TESTONLYLIBS b_mixed_lang
    ${EXTRA_TAEAT_EXTRA_TESTONLYLIBS}
    #IMPORTEDLIBS pws_b
    #DEPLIBS simplecxx
    #IMPORTEDLIBS simplecxx
    #DEPLIBS pws_b
    NUM_MPI_PROCS 1
    PASS_REGULAR_EXPRESSION 
      "B Mixed Language"
     )

ENDIF()
